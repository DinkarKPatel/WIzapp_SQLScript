

IF NOT EXISTS (SELECT CONFIG_OPTION FROM CONFIG WHERE  CONFIG_OPTION='DAILOGFILE_ROWID_VARCHAR' AND VALUE=1)
BEGIN
	DECLARE @CLOCID VARCHAR(5),@CCMD NVARCHAR(MAX)
	
	SELECT @CLOCID=VALUE FROM CONFIG WHERE CONFIG_OPTION='LOCATION_ID'

	ALTER TABLE DAILOGFILE DROP COLUMN ROWID

	ALTER TABLE DAILOGFILE ADD ROWID VARCHAR(40)

	SET @CCMD=N'UPDATE DAILOGFILE SET ROWID='''+@CLOCID+'''+CONVERT(VARCHAR(38),NEWID())'
	EXEC SP_EXECUTESQL @CCMD
	
	IF DB_ID(DB_NAME()+'_WIZCOM') IS NOT NULL
	BEGIN
		SET @CCMD=N'IF OBJECT_ID('''+DB_NAME()+'_WIZCOM..DAILOGFILE'',''U'') IS NOT NULL DROP TABLE  '+DB_NAME()+'_WIZCOM.DBO.DAILOGFILE'
		EXEC SP_EXECUTESQL @CCMD
	END
	
	IF NOT EXISTS (SELECT CONFIG_OPTION FROM CONFIG WHERE CONFIG_OPTION='DAILOGFILE_ROWID_VARCHAR')
		INSERT CONFIG (CONFIG_OPTION,VALUE,ROW_ID,LAST_UPDATE)
			   VALUES ('DAILOGFILE_ROWID_VARCHAR','1','',GETDATE())	
	ELSE
		UPDATE CONFIG SET VALUE='1' WHERE CONFIG_OPTION='DAILOGFILE_ROWID_VARCHAR'

END	

