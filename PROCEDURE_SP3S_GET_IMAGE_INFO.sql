create PROCEDURE [DBO].[SP3S_GET_IMAGE_INFO]  
(
	@NQUERYID INT /*1 : IMAGE; 2 : DOCUMENT*/
)
AS  
BEGIN  
	DECLARE @CPICPATH VARCHAR(MAX),@CCMD NVARCHAR(MAX)
	IF(@NQUERYID=1)
	BEGIN 
		SELECT TOP 1 @CPICPATH =VALUE  
		FROM CONFIG WHERE CONFIG_OPTION ='ART_PICT_PATH' 
		--SELECT @CPICPATH   
		SET @CCMD=N'SELECT DISTINCT A.*,B.SECTION_NAME,C.SUB_SECTION_NAME,D.ARTICLE_NO,  
		P1.PARA1_NAME,P2.PARA2_NAME,P3.PARA3_NAME,P4.PARA4_NAME,P5.PARA5_NAME,P6.PARA6_NAME  
		,'''+ISNULL(@CPICPATH,'')+'''+''\''+IMAGE_SUBFOLDER+''\''+IMAGE_NAME AS IMAGE_PATH ,CAST(0 AS BIT) AS CHK  
		FROM IMAGE_INFO A  (NOLOCK)
		JOIN SECTIONM B (NOLOCK) ON B.SECTION_CODE=A.SECTION_CODE  
		JOIN SECTIOND C (NOLOCK) ON C.SUB_SECTION_CODE=A.SUB_SECTION_CODE  
		JOIN ARTICLE D (NOLOCK) ON D.ARTICLE_CODE=A.ARTICLE_CODE  
		JOIN PARA1 P1 (NOLOCK) ON P1.PARA1_CODE=A.PARA1_CODE  
		JOIN PARA2 P2 (NOLOCK) ON P2.PARA2_CODE=A.PARA2_CODE  
		JOIN PARA3 P3 (NOLOCK) ON P3.PARA3_CODE=A.PARA3_CODE  
		JOIN PARA4 P4 (NOLOCK) ON P4.PARA4_CODE=A.PARA4_CODE  
		JOIN PARA5 P5 (NOLOCK) ON P5.PARA5_CODE=A.PARA5_CODE  
		JOIN PARA6 P6 (NOLOCK) ON P6.PARA6_CODE=A.PARA6_CODE 
		--LEFT OUTER JOIN '+DB_NAME()+'_IMAGE..IMAGE_INFO  Z (NOLOCK) ON 
		--Z.SECTION_CODE=A.SECTION_CODE 
		--AND Z.SUB_SECTION_CODE=A.SUB_SECTION_CODE 
		--AND Z.ARTICLE_CODE=A.ARTICLE_CODE
		--AND Z.PARA1_CODE=A.PARA1_CODE
		--AND Z.PARA2_CODE=A.PARA2_CODE
		--AND Z.PARA3_CODE=A.PARA3_CODE
		--AND Z.PARA4_CODE=A.PARA4_CODE
		--AND Z.PARA5_CODE=A.PARA5_CODE
		--AND Z.PARA6_CODE=A.PARA6_CODE
		--AND Z.PRODUCT_CODE=A.PRODUCT_CODE
		WHERE 1=2' --AND Z.PRODUCT_CODE IS NULL AND '''+ISNULL(@CPICPATH,'')+'''<>''''  '
		PRINT @CCMD
		EXECUTE SP_EXECUTESQL @CCMD
	END
	ELSE IF(@NQUERYID=2)
	BEGIN
		SELECT TOP 1 @CPICPATH =VALUE 
		FROM CONFIG WHERE CONFIG_OPTION LIKE 'DOC_PATH'
		--SELECT @CPICPATH   
		SET @CCMD=N'SELECT DISTINCT A.*,A.MODULENAME AS XN_TYPE,A.MEMONO AS MEMO_ID,A.[FILENAME] AS IMAGE_NAME
		,'''+ISNULL(@CPICPATH,'')+'''+''\''+A.[FILENAME] AS IMAGE_PATH ,CAST(0 AS BIT) AS CHK  
		FROM DAILOGFILE A (NOLOCK)  
		LEFT OUTER JOIN '+DB_NAME() +'_IMAGE..IMAGE_INFO_DOC  Z (NOLOCK)  ON 
		Z.XN_TYPE=A.MODULENAME
		AND Z.MEMO_ID=A.MEMONO
		WHERE 1=2 AND Z.XN_TYPE IS NULL AND '''+ISNULL(@CPICPATH,'')+'''<>''''  '
		PRINT @CCMD
		EXECUTE SP_EXECUTESQL @CCMD
	END
END
