CREATE VIEW VW_EMP_INCOMPLETE_ENTRIES
--WITH ENCRYPTION
AS
SELECT	YEAR(A.ATTENDANCE_DT) AS ATT_YEAR, MONTH(A.ATTENDANCE_DT) AS ATT_MONTH, A.ATTENDANCE_DT,
		A.DEPT_ID, D.DEPT_NAME, D.DEPT_ALIAS, A.EMP_ID, B.REF_ID,  B.EMP_FNAME + ' ' + B.EMP_LNAME AS EMP_NAME,
		C.DEPARTMENT_ID, C.DEPARTMENT_NAME, A.TIME_IN, A.TIME_OUT, A.LOG_ABSENT_STATUS,
		A.SHIFT_ID, E.SHIFT_NAME, A.SHIFT_TIME_IN, A.SHIFT_TIME_OUT, A.HALFDAY_CUTOFF, B.EMP_STATUS
FROM EMP_ATTENDANCE A
JOIN EMP_MST B ON A.EMP_ID = B.EMP_ID
JOIN EMP_DEPARTMENT C ON B.DEPARTMENT_ID = C.DEPARTMENT_ID
JOIN LOCATION D ON A.DEPT_ID = D.DEPT_ID
JOIN EMP_SHIFTS E ON A.SHIFT_ID = E.SHIFT_ID
WHERE 
( 
	( A.TIME_IN = '' AND A.TIME_OUT <> '') OR 
	( A.TIME_OUT = '' AND A.TIME_IN <> '' ) OR 
	( A.TIME_IN = '' AND A.TIME_OUT = '' AND A.LOG_ABSENT_STATUS = 0 ) 	
) AND A.ATTENDANCE_DT >= B.DATE_OF_JOINING
