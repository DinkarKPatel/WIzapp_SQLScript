

DECLARE @CCURLOCID CHAR(2),@CHOLOCID CHAR(2),@BPURLOC BIT,@CREPORTINGSOURCE VARCHAR(2)

SELECT TOP 1 @CCURLOCID = VALUE FROM CONFIG WHERE CONFIG_OPTION = 'LOCATION_ID'
SELECT TOP 1 @CHOLOCID = VALUE FROM CONFIG WHERE CONFIG_OPTION = 'HO_LOCATION_ID'
SELECT TOP 1 @BPURLOC=PUR_LOC FROM LOCATION WHERE DEPT_ID=@CCURLOCID

SET @CREPORTINGSOURCE=(CASE WHEN @CCURLOCID<>@CHOLOCID AND @BPURLOC=0 THEN '1' ELSE '2' END)
 
PRINT 'RESETTING REPORTING SOURCE OF XTREME TO OPTIMIZED MODE' 
IF NOT EXISTS(SELECT CONFIG_OPTION FROM CONFIG WHERE  CONFIG_OPTION='REPORTING_SOURCE')
    INSERT CONFIG (CONFIG_OPTION,VALUE,ROW_ID,LAST_UPDATE)
    VALUES ('REPORTING_SOURCE',@CREPORTINGSOURCE,'',GETDATE())	
ELSE	
	UPDATE CONFIG SET VALUE=@CREPORTINGSOURCE WHERE CONFIG_OPTION='REPORTING_SOURCE'	
