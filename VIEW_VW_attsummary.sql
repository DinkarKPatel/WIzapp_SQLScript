CREATE VIEW VW_ATTSUMMARY
--WITH ENCRYPTION
AS
SELECT YEAR(ATTENDANCE_DT) AS ATT_YEAR, MONTH(ATTENDANCE_DT) AS ATT_MONTH, EMP_ID,   
 SUM(CASE WHEN REPLACE(ATTSTATUS,'W','')='P' THEN 1 ELSE 0 END) AS P,  
 SUM(CASE WHEN ATTSTATUS LIKE '%H%' THEN 1 ELSE 0 END) AS H,  
 SUM(CASE WHEN ATTSTATUS LIKE '%E%' THEN 1 ELSE 0 END) AS E,  
 SUM(CASE WHEN ATTSTATUS LIKE '%L%' AND ATTSTATUS NOT LIKE '%LV%' THEN 1 ELSE 0 END) AS L,  
 SUM(CASE WHEN REPLACE(ATTSTATUS,'W','')='' AND (ATTSTATUS = 'W') THEN 1 ELSE 0 END) AS W,  
 SUM(CASE WHEN REPLACE(ATTSTATUS,'W','')='A' THEN 1 ELSE 0 END) AS A,  
 SUM(CASE WHEN ATTSTATUS LIKE '%LV%' THEN 1 ELSE 0 END) AS LV, 
 SUM(CASE WHEN ATTSTATUS LIKE '%B%' THEN 1 ELSE 0 END) AS B, 
 DEPT_ID, 
 DEPARTMENT_ID, CO_ALIAS
FROM VW_ATTREGISTER  
GROUP BY YEAR(ATTENDANCE_DT), MONTH(ATTENDANCE_DT), EMP_ID, DEPT_ID, DEPARTMENT_ID, CO_ALIAS
