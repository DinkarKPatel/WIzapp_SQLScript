create PROCEDURE SP_PARTYRATE  
@NQUERYID NUMERIC(2,0),           
@CMEMOID  NVARCHAR(MAX),      
@CWHERE VARCHAR(100)=''   
--WITH ENCRYPTION   
AS      
BEGIN    
  --(dinkar) Replace  left(memoid,2) to Location_code 
DECLARE @CLOCID CHAR(4) ,@CCMD NVARCHAR(MAX),@CDBNAME VARCHAR(100)
      
IF @NQUERYID = 1      
GOTO LBLGETMST      
      
ELSE IF @NQUERYID = 2      
GOTO LBLGETDETAILS   
        
ELSE      
GOTO LAST      

LBLGETMST:     
       
	SELECT A.*,  U.USERNAME,
	(CASE WHEN MST_BASE_PRICE=1 THEN 'WSP'  WHEN MST_BASE_PRICE=2 THEN 'MRP'  WHEN MST_BASE_PRICE=3 THEN 'PURCHASE PRICE'   ELSE 'WSP' END) AS  MST_BASE_PRICE_NAME,
    (CASE WHEN MST_CAL_MODE=1 THEN 'ADD' WHEN MST_CAL_MODE=2 THEN 'LESS' ELSE 'LESS' END) AS  MST_CAL_MODE_NAME

	FROM PARTY_RATE_MST A     	 
	JOIN USERS U ON U.USER_CODE = A.USER_CODE 
	WHERE A.MEMO_ID = @CMEMOID  
	         
 GOTO LAST      
      
      
LBLGETDETAILS:   
   
	SELECT A.*,B.ARTICLE_NAME,CC.SUB_SECTION_NAME,DD.SECTION_NAME,    
    B.ARTICLE_NO,C.PARA1_NAME,D.PARA2_NAME,E.PARA3_NAME, F.PARA4_NAME, G.PARA5_NAME, H.PARA6_NAME,D.PARA2_ORDER,C.PARA1_ORDER ,  
    B.ALIAS AS ARTICLE_ALIAS,
    (CASE WHEN BASE_PRICE=1 THEN 'WSP'  WHEN BASE_PRICE=2 THEN 'MRP' ELSE 'PURCHASE PRICE' END) AS  BASE_PRICE_NAME,
    (CASE WHEN CAL_MODE=1 THEN 'ADD' WHEN CAL_MODE=2 THEN 'LESS' ELSE 'FLAT' END) AS  CAL_MODE_NAME,
    (CASE WHEN GIVE_CREDIT_VAT=1 THEN 'YES' ELSE 'NO' END) AS  GIVE_CREDIT_VAT_NAME,
    (CASE WHEN BASE_PRICE_VAT_CREDIT=1 THEN 'WSP'  WHEN BASE_PRICE_VAT_CREDIT=2 THEN 'MRP' ELSE 'PURCHASE PRICE' END) AS  BASE_PRICE_VAT_CREDIT_NAME       
    FROM PARTY_RATE_DET A (NOLOCK) 
    LEFT OUTER JOIN ARTICLE B (NOLOCK)  ON A.ARTICLE_CODE = B.ARTICLE_CODE
    LEFT OUTER JOIN SECTIOND CC ON CC.SUB_SECTION_CODE = A.SUB_SECTION_CODE
	JOIN SECTIONM DD ON DD.SECTION_CODE = A.SECTION_CODE      
    JOIN PARA1 C (NOLOCK)  ON A.PARA1_CODE = C.PARA1_CODE      
    JOIN PARA2 D (NOLOCK)  ON A.PARA2_CODE = D.PARA2_CODE       
    JOIN PARA3 E (NOLOCK)  ON A.PARA3_CODE = E.PARA3_CODE       
    JOIN PARA4 F (NOLOCK)  ON A.PARA4_CODE = F.PARA4_CODE       
    JOIN PARA5 G (NOLOCK)  ON A.PARA5_CODE = G.PARA5_CODE       
    JOIN PARA6 H (NOLOCK) ON A.PARA6_CODE = H.PARA6_CODE      
    WHERE A.MEMO_ID = @CMEMOID  ORDER BY TS   
        
 GOTO LAST    
 LAST:      
    	
END
