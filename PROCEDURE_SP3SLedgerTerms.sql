CREATE PROCEDURE SP3SLEDGERTERMS
(
	@BONLYAPPROVED BIT=0
)
AS
BEGIN
	SELECT LMV.AC_NAME AS LEDGERNAME
			,(CASE WHEN APPROVED=1 THEN 'APP' ELSE 'PND' END) AS STATUS
			 ,LT.TERMS AS TERMS
			  ,LT.TERMS_NAME AS TERMSNAME
			   ,(CASE WHEN LT.PAYMENT_TYPE=1 THEN 'PAYMENT AGAINST PURCHASE' ELSE 'PAYMENT AGAINST SALE' END) AS TERMSMODE
			    ,(CASE WHEN LT.PURCHASE_TYPE=1 THEN 'FRESH' ELSE 'EOSS' END) AS TERMSTYPE
			     ,LT.GROSS_MARGIN AS GROSSMARGIN
			      ,LT.CREDIT_DAYS AS CREDITDAYS
			       ,LT.CD AS PREVATDISCOUNT
			        ,LT.CASHDISCOUNT AS CASHDISCOUNT
			         ,LT.REMARKS AS TERMSREMARK
			          ,LT.REIMUBURSE_PURCHASE_TAX 
			           ,LT.REIMUBURSE_FREIGHT
			            ,LT.REIMUBURSE_INSURANCE
			             ,LT.APPLYCDONTOTAL AS APPLYCASHDISCOUNTONTOTALAMT
			              ,LT.EOSS_DISCOUNT_SHARE AS EOSSDISCOUNTSHARE
			               ,LT.EOSS_DISCOUNT_PER AS EOSSDISCOUNTPER
			                ,LT.INACTIVE AS INACTIVE
			                ,(CASE WHEN LT.AOS=1 THEN 'APPROVE' WHEN LT.AOS=2 THEN 'OUTRIGHT' WHEN LT.AOS=3 THEN 'STOCK CORRECTION' ELSE  '' END) AS AOS
			                ,COALESCE(LT.AOS_PCT,'-') AS AOS_PCT
			                
	FROM LMV01106 LMV
	 JOIN LM_TERMS LMT ON LMV.AC_CODE=LMT.AC_CODE
	  JOIN LEDGER_TERMS LT ON LMT.TERMS_CODE=LT.TERMS_CODE
	   WHERE LMT.APPROVED=(CASE WHEN @BONLYAPPROVED=1 THEN 1 ELSE LMT.APPROVED END)
	   ORDER BY LMV.AC_NAME
END
--END OF PROCEDURE - SP3SLEDGERTERMS
