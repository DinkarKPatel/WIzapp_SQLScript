CREATE FUNCTION DBO.GST_SLS_PARTY_NAME(@CCODE VARCHAR(100),@XNTYPE VARCHAR(10)='SLS',@TYPE VARCHAR(100)='CUS')  
RETURNS VARCHAR(1000)  
AS  
BEGIN  
DECLARE @NAME VARCHAR(1000)  
SET @NAME=''  

IF ISNULL(@TYPE,'CUS')='AC'
   GOTO GETLEDGERNAME
    
IF (SELECT TOP 1 IS_FNAME FROM GST_SLS_CUSTOMER_CONFIG WHERE XN_TYPE=@XNTYPE)=1    
   SELECT TOP 1 @NAME+=ISNULL(CUSTOMER_FNAME,'')  
   FROM CUSTDYM (NOLOCK) WHERE CUSTOMER_CODE=@CCODE  AND @TYPE='CUS'
     
IF (SELECT TOP 1 IS_LNAME FROM GST_SLS_CUSTOMER_CONFIG WHERE XN_TYPE=@XNTYPE)=1    
   SELECT TOP 1 @NAME+=CASE LEN(@NAME) WHEN 0 THEN '' ELSE CASE LEN(CUSTOMER_LNAME) WHEN 0 THEN '' ELSE ' ' END END+ISNULL(CUSTOMER_LNAME+' ','')  
   FROM CUSTDYM (NOLOCK) WHERE CUSTOMER_CODE=@CCODE  AND @TYPE='CUS'
     
IF (SELECT TOP 1 IS_LNAME FROM GST_SLS_CUSTOMER_CONFIG WHERE XN_TYPE=@XNTYPE)=1    
   SELECT TOP 1 @NAME+=CASE LEN(@NAME) WHEN 0 THEN '' ELSE CASE LEN(USER_CUSTOMER_CODE) WHEN 0 THEN '' ELSE ' ' END END+ISNULL('( '+USER_CUSTOMER_CODE+' )','')  
   FROM CUSTDYM (NOLOCK) WHERE CUSTOMER_CODE=@CCODE AND @TYPE='CUS'
SET @NAME=ISNULL(@NAME,'')+';CUS'   
GOTO RET_VALUE   

GETLEDGERNAME:
   SELECT @NAME=AC_NAME+CASE LEN(AC_NAME) WHEN 0 THEN '' ELSE +' ('+AC_CODE+')' END FROM LM01106 WHERE AC_CODE=@CCODE
   SET @NAME=ISNULL(@NAME,'')+';AC'
GOTO RET_VALUE   
RET_VALUE:  
RETURN @NAME  
END
