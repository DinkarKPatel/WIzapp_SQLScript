CREATE FUNCTION DBO.FNIT_USERHEADS(@CUSER_CODE VARCHAR(10))
RETURNS @USERS TABLE(USER_CODE VARCHAR(10))	
--WITH ENCRYPTION
AS
BEGIN
	DECLARE @BEXISTS BIT 
	
	INSERT @USERS(USER_CODE)
	SELECT MAJOR_USER_CODE FROM USERS WHERE USER_CODE=@CUSER_CODE
	
	SET @BEXISTS=1
	WHILE @BEXISTS=1
	BEGIN
		INSERT @USERS(USER_CODE)
		SELECT MAJOR_USER_CODE
		FROM USERS WHERE USER_CODE IN (SELECT USER_CODE FROM @USERS) 
		AND MAJOR_USER_CODE NOT IN (SELECT USER_CODE FROM @USERS)
		
		IF NOT EXISTS(SELECT TOP 1 USER_CODE FROM USERS WHERE USER_CODE IN (SELECT USER_CODE FROM @USERS) 
					  AND MAJOR_USER_CODE NOT IN (SELECT USER_CODE FROM @USERS))
		SET @BEXISTS=0			  
	END	
RETURN	
END
---END OF FUNCTION - FNIT_USERHEADS
