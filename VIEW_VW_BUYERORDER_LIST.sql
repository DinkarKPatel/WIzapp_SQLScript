create VIEW VW_BUYERORDER_LIST

AS
SELECT B.AC_NAME,B.CITY,B.STATE,A.ORDER_NO ,A.ORDER_DT,A.ORDER_ID,(CASE WHEN A.CANCELLED = 1 THEN 0 ELSE ISNULL(C.TOTAL_QUANTITY,0) END) AS TOTAL_QUANTITY,
(CASE WHEN A.CANCELLED = 1 THEN 0 ELSE A.SUBTOTAL END) AS SUBTOTAL,
(CASE WHEN A.CANCELLED = 1 THEN 0 ELSE A.TOTAL_AMOUNT END) AS TOTAL_AMOUNT,
(CASE WHEN A.CANCELLED = 1 THEN 0 ELSE A.ROUND_OFF END) AS ROUND_OFF,
(CASE WHEN A.CANCELLED = 1 THEN 0 ELSE A.DISCOUNT_PERCENTAGE END) AS DISCOUNT_PERCENTAGE,
(CASE WHEN A.CANCELLED = 1 THEN 0 ELSE A.DISCOUNT_AMOUNT END) AS DISCOUNT_AMOUNT,
(CASE WHEN A.CANCELLED = 1 THEN 'CANCELLED' ELSE '' END) AS CANCELLED
,A.REF_NO,A.FIN_YEAR 
,ISNULL(EMP.EMP_TITLE,'') + ' ' + ISNULL(EMP.EMP_FNAME,'') + ' ' + ISNULL(EMP.EMP_LNAME,'') AS ALLOCATED_TO 
,CASE WHEN A.APPROVED =1 THEN 'APPROVED' ELSE '' END AS STATUS
,CUST.CUSTOMER_FNAME +' '+ CUST.CUSTOMER_LNAME AS CUSTOMER_NAME ,
(CASE WHEN ISNULL(D.ORDER_ID,'') =''  THEN '' ELSE 'PO RAISED' END) AS PO_RAISED
FROM WSL_ORDER_MST A (NOLOCK) 
LEFT JOIN LMV01106 B (NOLOCK) ON A.AC_CODE = B.AC_CODE
LEFT JOIN custdym CUST (NOLOCK) ON A.CUSTOMER_CODE = CUST.CUSTOMER_CODE
LEFT OUTER JOIN EMP_MST EMP (NOLOCK) ON EMP.EMP_ID = A.EMP_CODE
LEFT OUTER JOIN
(SELECT ORDER_ID,SUM(QUANTITY) AS TOTAL_QUANTITY FROM WSL_ORDER_DET GROUP BY ORDER_ID) C ON C.ORDER_ID = A.ORDER_ID
LEFT OUTER JOIN
(
 SELECT  ORDER_ID   
 FROM WSL_ORDER_DET A 
 JOIN POD01106 B ON  A.ROW_ID = B.WOD_ROW_ID  
) D ON A.ORDER_ID = D.ORDER_ID
