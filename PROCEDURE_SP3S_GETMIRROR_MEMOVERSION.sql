CREATE PROCEDURE SP3S_GETMIRROR_MEMOVERSION 
@CXNTYPE VARCHAR(10),
@CMEMOID VARCHAR(40)
AS
BEGIN
	
BEGIN TRY
	
	DECLARE @CERRORMSG VARCHAR(MAX),@CSTEP VARCHAR(10),@CMASTERTABLENAME VARCHAR(200),@NVERSIONNO INT,
	@CCMD NVARCHAR(MAX),@CKEYFIELD VARCHAR(200)
	
	SET @CSTEP=10
	
	SET @CERRORMSG=''
	
	IF @CXNTYPE IN ('PUR','PRT','SLS','WSL','WSR','DOCWSL','DOCPRT','DOCPO')
	BEGIN
	  EXEC SP3S_DEL_FROM_MIRROR_TABLES @CMEMOID,@CXNTYPE
	  RETURN
	END
			
	IF @CXNTYPE='OPS'
		SELECT @CMASTERTABLENAME='OPS_OPS01106_MIRROR',@CKEYFIELD='PRODUCT_CODE'
	ELSE
	IF @CXNTYPE='PO'
		SELECT @CMASTERTABLENAME='PO_POM01106_MIRROR',@CKEYFIELD='PO_ID'
	ELSE
	--IF @CXNTYPE='PUR'
	--	SELECT @CMASTERTABLENAME='PUR_PIM01106_MIRROR',@CKEYFIELD='MRR_ID'
	--ELSE
	IF @CXNTYPE='DNPS'
		SELECT @CMASTERTABLENAME='DNPS_DNPS_MST_MIRROR',@CKEYFIELD='PS_ID'
	ELSE
	--IF @CXNTYPE IN ('PRT')
	--	SELECT @CMASTERTABLENAME='PRT_RMM01106_MIRROR',@CKEYFIELD='RM_ID'
	--ELSE
	--IF @CXNTYPE IN ('DOCPRT')
	--	SELECT @CMASTERTABLENAME='DOCPRT_RMM01106_MIRROR',@CKEYFIELD='RM_ID'
	--ELSE
	IF @CXNTYPE IN ('DOCGV')
		SELECT @CMASTERTABLENAME='DOCGV_STKXFER_MST_MIRROR',@CKEYFIELD='RM_ID'
	ELSE		
	IF @CXNTYPE='WPS'
		SELECT @CMASTERTABLENAME='WPS_WPS_MST_MIRROR',@CKEYFIELD='PS_ID'
	ELSE
	--IF @CXNTYPE IN ('WSL','DOCWSL')
	--	SELECT @CMASTERTABLENAME=@CXNTYPE+'_INM01106_MIRROR',@CKEYFIELD='INV_ID'
	--ELSE
	--IF @CXNTYPE='WSR'
	--	SELECT @CMASTERTABLENAME='WSR_CNM01106_MIRROR',@CKEYFIELD='CN_ID'
	--ELSE
	--IF @CXNTYPE='SLS'
	--BEGIN
	--  EXEC SP3S_DEL_FROM_MIRROR_TABLES @CMEMOID,@CXNTYPE
	--  RETURN
	--END
		--SELECT @CMASTERTABLENAME='SLS_CMM01106_MIRROR',@CKEYFIELD='CM_ID'
	--ELSE
	IF @CXNTYPE='APP'
		SELECT @CMASTERTABLENAME='APP_APM01106_MIRROR',@CKEYFIELD='MEMO_ID'
	ELSE
	IF @CXNTYPE='APR'
		SELECT @CMASTERTABLENAME='APR_APPROVAL_RETURN_MST_MIRROR',@CKEYFIELD='MEMO_ID'
	ELSE
	IF @CXNTYPE='IRR'
		SELECT @CMASTERTABLENAME='IRR_IRM01106_MIRROR',@CKEYFIELD='IRM_MEMO_ID'
	ELSE
	IF @CXNTYPE='CNC'
		SELECT @CMASTERTABLENAME='CNC_ICM01106_MIRROR',@CKEYFIELD='CNC_MEMO_ID'
	ELSE
	IF @CXNTYPE='BCO'
		SELECT @CMASTERTABLENAME='BCO_FLOOR_ST_MST_MIRROR',@CKEYFIELD='MEMO_ID'
	ELSE
	IF @CXNTYPE='RPS'
		SELECT @CMASTERTABLENAME='RPS_RPS_MST_MIRROR',@CKEYFIELD='CM_ID'
	ELSE
	IF @CXNTYPE IN ('ADV','ARC')
		SELECT @CMASTERTABLENAME='ARC_ARC01106_MIRROR',@CKEYFIELD='ADV_REC_ID'
	ELSE
	IF @CXNTYPE='WSLORD'
		SELECT @CMASTERTABLENAME='WSLORD_WSL_ORDER_MST_MIRROR',@CKEYFIELD='ORDER_ID'
	ELSE
	IF @CXNTYPE='ATD'
		SELECT @CMASTERTABLENAME='ATD_EMP_WPAYATT_MIRROR',@CKEYFIELD='ROW_ID'
	ELSE
	IF @CXNTYPE='ACT'
		SELECT @CMASTERTABLENAME='ACT_VM01106_MIRROR',@CKEYFIELD='VM_ID'
	ELSE
	IF @CXNTYPE='SCF'
		SELECT @CMASTERTABLENAME='SCF_SCM01106_MIRROR',@CKEYFIELD='MEMO_ID'
	ELSE
	IF @CXNTYPE='PTC'
		SELECT @CMASTERTABLENAME='PTC_PEM01106_MIRROR',@CKEYFIELD='PEM_MEMO_ID'
	ELSE
	IF @CXNTYPE='DOCPOADJ'
		SELECT @CMASTERTABLENAME='DOCPOADJ_PO_ADJ_MST_MIRROR',@CKEYFIELD='MEMO_ID'	
	ELSE
	IF @CXNTYPE='SNC'
		SELECT @CMASTERTABLENAME='SNC_SNC_MST_MIRROR',@CKEYFIELD='MEMO_ID'	
	ELSE
	IF @CXNTYPE='CUS'
		SELECT @CMASTERTABLENAME='CUS_CUSTDYM_MIRROR',@CKEYFIELD='CUSTOMER_CODE'
	ELSE
	IF @CXNTYPE='STREC'
		SELECT @CMASTERTABLENAME='STREC_STK_RECON_HIST_MST_MIRROR',@CKEYFIELD='RECON_ID'
	ELSE
	IF @CXNTYPE='PSHBD'
		SELECT @CMASTERTABLENAME='PSHBD_HOLD_BACK_DELIVER_MST_MIRROR',@CKEYFIELD='MEMO_ID'
	ELSE
	IF @CXNTYPE='PSJWI'
		SELECT @CMASTERTABLENAME='PSJWI_POST_SALES_JOBWORK_ISSUE_MST_MIRROR',@CKEYFIELD='ISSUE_ID'
	ELSE
	IF @CXNTYPE='PSJWR'
		SELECT @CMASTERTABLENAME='PSJWR_POST_SALES_JOBWORK_RECEIPT_MST_MIRROR',@CKEYFIELD='RECEIPT_ID'
	ELSE
	IF @CXNTYPE='PSDLV'
		SELECT @CMASTERTABLENAME='PSDLV_SLS_DELIVERY_MST_MIRROR',@CKEYFIELD='MEMO_ID'	
	ELSE
	IF @CXNTYPE='PCI'
		SELECT @CMASTERTABLENAME='PCI_PCI_MST_MIRROR',@CKEYFIELD='MEMO_ID'
	ELSE
	IF @CXNTYPE='PCO'
		SELECT @CMASTERTABLENAME='PCO_PCO_MST_MIRROR',@CKEYFIELD='MEMO_ID'
	ELSE
	IF @CXNTYPE='SCH'
		SELECT @CMASTERTABLENAME='SCH_SCHEME_SETUP_MST_MIRROR',@CKEYFIELD='MEMO_NO'															
	ELSE
	IF @CXNTYPE='DSM'
		SELECT @CMASTERTABLENAME='DSM_DSM01106_MIRROR',@CKEYFIELD='DS_ID'									
	ELSE
	IF @CXNTYPE IN ('DOCMBAPP')
		SELECT @CMASTERTABLENAME='DOCMBAPP_CMD_MANUALBILL_ERRORS_MIRROR',@CKEYFIELD='CMD_ROW_ID'
	ELSE
	IF @CXNTYPE IN ('PRCL')
		SELECT @CMASTERTABLENAME='PRCL_PARCEL_MST_MIRROR',@CKEYFIELD='PARCEL_MEMO_ID'
	ELSE
	IF @CXNTYPE IN ('DOCIRT')
		SELECT @CMASTERTABLENAME='DOCIRT_IRM01106_MIRROR',@CKEYFIELD='IRM_MEMO_ID'
	
	ELSE 
	IF @CXNTYPE IN ('WPL')
		SELECT @CMASTERTABLENAME='WPL_WSL_PICKLIST_MST_MIRROR',@CKEYFIELD='PICK_LIST_ID'	
	ELSE 
	IF @CXNTYPE IN ('WBO')
		SELECT @CMASTERTABLENAME='WBO_BUYER_ORDER_MST_MIRROR',@CKEYFIELD='ORDER_ID'		
    IF @CXNTYPE IN ('DOCPCO')
		SELECT @CMASTERTABLENAME='DOCPCO_PCI_MST_MIRROR',@CKEYFIELD='MEMO_ID'		
	ELSE
	IF @CXNTYPE IN ('DOCPRCL')
		SELECT @CMASTERTABLENAME='DOCPRCL_PARCEL_MST_MIRROR',@CKEYFIELD='PARCEL_MEMO_ID'	
	ELSE
	IF @CXNTYPE IN ('XNSLM')
		SELECT @CMASTERTABLENAME='XNSLM_LM01106_MIRROR',@CKEYFIELD='AC_CODE'	
	ELSE
	IF @CXNTYPE IN ('XNSEMP')
		SELECT @CMASTERTABLENAME='XNSEMP_EMPLOYEE_MIRROR',@CKEYFIELD='EMP_CODE'	
	ELSE 
	IF @CXNTYPE IN ('TLF')
		SELECT @CMASTERTABLENAME='TLF_TILL_LIFTS_MIRROR',@CKEYFIELD='MEMO_ID'		
	ELSE 	
	IF @CXNTYPE IN ('SHF')
		SELECT @CMASTERTABLENAME='SHF_TILL_SHIFT_MST_MIRROR',@CKEYFIELD='SHIFT_ID'	
	ELSE 	
	IF @CXNTYPE IN ('BKT')
		SELECT @CMASTERTABLENAME='BKT_TILL_BANK_TRANSFER_MIRROR',@CKEYFIELD='MEMO_ID'	
	ELSE 	
	IF @CXNTYPE IN ('TEX')
		SELECT @CMASTERTABLENAME='TEX_TILL_EXPENSE_MST_MIRROR',@CKEYFIELD='MEMO_ID'	
	ELSE 	
	IF @CXNTYPE IN ('PTCAPP')
		SELECT @CMASTERTABLENAME='PTCAPP_PED_XN_APPROVAL_MIRROR',@CKEYFIELD='PED_ROW_ID'	
	ELSE 	
	IF @CXNTYPE IN ('DOCPO')
		SELECT @CMASTERTABLENAME='DOCPO_POM01106_MIRROR',@CKEYFIELD='PO_ID'																																																	
	ELSE 	
	IF @CXNTYPE IN ('CNC')
		SELECT @CMASTERTABLENAME='CNC_ICM01106_MIRROR',@CKEYFIELD='CNC_MEMO_ID'	
		
	ELSE 	
	IF @CXNTYPE IN ('PFI')
		SELECT @CMASTERTABLENAME='PFI_ORD_PLAN_MST_MIRROR',@CKEYFIELD='MEMO_ID'	
	ELSE 	
	IF @CXNTYPE IN ('MIS')
		SELECT @CMASTERTABLENAME='MIS_BOM_ISSUE_MST_MIRROR',@CKEYFIELD='ISSUE_ID'
	ELSE 	
	IF @CXNTYPE IN ('TTM')
		SELECT @CMASTERTABLENAME='TTM_TRANSFER_TO_TRADING_MST_MIRROR',@CKEYFIELD='MEMO_ID'
	ELSE 	
	IF @CXNTYPE IN ('SLRRECON')
		SELECT @CMASTERTABLENAME='SLRRECON_SLR_RECON_MST_MIRROR',@CKEYFIELD='MEMO_ID'
    ELSE 	
	IF @CXNTYPE IN ('DOCASN')
		SELECT @CMASTERTABLENAME='DOCASN_ASN_MST_MIRROR',@CKEYFIELD='MEMO_ID'	
	ELSE 	
	IF @CXNTYPE IN ('GRNPS')
		SELECT @CMASTERTABLENAME='GRNPS_GRN_PS_MST_MIRROR',@CKEYFIELD='MEMO_ID'	
    ELSE 	
	IF @CXNTYPE IN ('DOCWBO')
		SELECT @CMASTERTABLENAME='DOCWBO_BUYER_ORDER_MST_MIRROR',@CKEYFIELD='ORDER_ID'	
    ELSE
	IF @CXNTYPE='JWI'
		SELECT @CMASTERTABLENAME='JWI_JOBWORK_ISSUE_MST_MIRROR',@CKEYFIELD='ISSUE_ID'																																																												
																																																
	
	EXEC SP3S_REFRESH_DOCDATA 
	@CXNTYPE=@CXNTYPE,
	@CMEMOID=@CMEMOID,
	@CERRMSG=@CERRORMSG OUTPUT
		
END TRY

BEGIN CATCH
	SET @CERRORMSG='P:SP3S_GETMIRROR_MEMOVERSION, STEP:'+@CSTEP+', MESSAGE:'+ERROR_MESSAGE()
	GOTO END_PROC
END CATCH

END_PROC:
	SELECT 	ISNULL(@NVERSIONNO,0)+1 AS VERSION_NO,@CERRORMSG AS ERRMSG	
END
---- END OF PROCEDURE - SP3S_GETMIRROR_MEMOVERSION'
