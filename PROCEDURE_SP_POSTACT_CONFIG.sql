CREATE PROC SP_POSTACT_CONFIG
(
	@NQUERYID NUMERIC (3,0) ,   
	@CWHERE VARCHAR(500) = ''
)
AS
BEGIN
IF @NQUERYID = 1  
GOTO LBL1
ELSE IF @NQUERYID = 2  
GOTO  LBL2 
ELSE IF @NQUERYID = 3  
GOTO  LBL3 
ELSE  
GOTO LAST  

/*
	FORM_MODE : 1 FOR PURCHASE,2 FOR SALE AND 3 FOR BOTH
	
*/

LBL1:

	SELECT  XN_TYPE,A.FORM_ID,POSTING_PARA_NAME,POSTING_PARA_DESC,POSTING_PARA_TYPE,POSTING_PARA_VAL,
	      FILTER_HEAD_CODE,ROW_ID,ISNULL(B.FORM_NAME,'') AS FORM_NAME,
	     (CASE WHEN POSTING_PARA_TYPE= 2 THEN CASE WHEN POSTING_PARA_VAL ='1' 
	           THEN 'YES' ELSE 'NO' END   ELSE  C.AC_NAME END) AS PARA_NAME 
	     ,ISNULL(B.FORM_MODE,3) AS FORM_MODE,A.VALUETYPE,A.ROWORDER      
	FROM POSTACT_CONFIG A 
	LEFT OUTER JOIN FORM B ON A.FORM_ID = B.FORM_ID 
	LEFT OUTER JOIN LM01106  C ON A.POSTING_PARA_VAL = C.AC_CODE 
	WHERE A.VALUETYPE IN (1,3) 
	
	UNION ALL
	 
	SELECT XN_TYPE,A.FORM_ID,POSTING_PARA_NAME,POSTING_PARA_DESC,POSTING_PARA_TYPE,POSTING_PARA_VAL,
	      FILTER_HEAD_CODE,ROW_ID,
	      ISNULL(B.PAYMODE_NAME,'')  AS FORM_NAME,
	     (CASE WHEN POSTING_PARA_TYPE= 2 THEN CASE WHEN POSTING_PARA_VAL ='1' 
	           THEN 'YES' ELSE 'NO' END   ELSE  C.AC_NAME END) AS PARA_NAME 
	     ,3 AS FORM_MODE,A.VALUETYPE,A.ROWORDER            
	FROM POSTACT_CONFIG A 
	LEFT OUTER JOIN PAYMODE_MST  B ON A.FORM_ID = B.PAYMODE_CODE  
	LEFT OUTER JOIN LM01106  C ON A.POSTING_PARA_VAL = C.AC_CODE 
	WHERE A.VALUETYPE=2
	ORDER BY XN_TYPE,FORM_NAME,ROWORDER 
	 
	GOTO LAST

LBL2:
    
    SELECT 'PUR' AS XN_TYPE, 'PURCHASE' AS XN_NAME
    UNION ALL
    SELECT 'SLS' AS XN_TYPE, 'SALE' AS XN_NAME
    UNION ALL
    SELECT 'WSL' AS XN_TYPE, 'WHOLESALE' AS XN_NAME
    UNION ALL
    SELECT 'PTC' AS XN_TYPE, 'PETTY CASH EXPENSES' AS XN_NAME
    UNION ALL
    SELECT 'JWR' AS XN_TYPE, 'JOBWORK RECEIVE' AS XN_NAME
	
	GOTO LAST
	
LBL3:

	DECLARE @CHEADCODE VARCHAR(4000) 
	SET @CHEADCODE=DBO.FN_ACT_TRAVTREE(@CWHERE) 
	
	SELECT AC_CODE, AC_NAME
	FROM LMV01106 (NOLOCK) 
	WHERE CHARINDEX(HEAD_CODE,@CHEADCODE)>0  AND ISNULL(INACTIVE,0)=0 
    
    GOTO LAST
    
LAST:

END
