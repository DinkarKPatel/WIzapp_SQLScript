CREATE  PROCEDURE SP_GETBINUSERS
(
	@CUSERCODE	VARCHAR(10),
	@CDEPT_ID	VARCHAR(10)
)

AS
BEGIN
	IF @CUSERCODE<>'0000000'
	BEGIN
		SELECT DISTINCT A.BIN_ID,A.BIN_NAME,A.BIN_ALIAS,@CUSERCODE AS [USER_CODE] 
		FROM BIN A (NOLOCK)
		JOIN BIN_LOC C (NOLOCK) ON C.BIN_ID=A.BIN_ID
		JOIN BINUSERS B (NOLOCK) ON B.BIN_ID=A.BIN_ID 
		JOIN LOCATION D(NOLOCK) ON C.DEPT_ID= D.DEPT_ID
		WHERE A.BIN_ID= A.MAJOR_BIN_ID AND A.INACTIVE=0 AND B.USER_CODE =@CUSERCODE 
		AND C.DEPT_ID=@CDEPT_ID   AND isnull(A.rack_bin,0) =0
		/*AND ISNULL(D.ENABLE_BIN,0)=1 Rohit 03-10-2024 Meeting with sir , vivek and KV : There is no need of this*/
		UNION 
		SELECT '000' AS BIN_ID,'DEFAULT BIN' AS BIN_NAME,'DB' AS BIN_ALIAS,@CUSERCODE AS [USER_CODE] 
		FROM LOCATION(NOLOCK) WHERE DEPT_ID=@CDEPT_ID AND ISNULL(ENABLE_BIN,0)=0
	END		
	ELSE
	BEGIN
		SELECT DISTINCT A.BIN_ID,A.BIN_NAME,A.BIN_ALIAS,@CUSERCODE AS [USER_CODE] 
		FROM BIN A (NOLOCK)
		LEFT OUTER JOIN BIN_LOC C (NOLOCK) ON C.BIN_ID=A.BIN_ID AND C.DEPT_ID=@CDEPT_ID
		LEFT OUTER JOIN LOCATION D(NOLOCK) ON C.DEPT_ID= D.DEPT_ID
		WHERE A.BIN_ID= A.MAJOR_BIN_ID AND A.INACTIVE=0 AND A.BIN_ID=(CASE WHEN C.DEPT_ID IS NULL THEN '000' ELSE A.BIN_ID END)
		AND ISNULL(C.DEPT_ID,@CDEPT_ID)=@CDEPT_ID  AND isnull(A.rack_bin,0) =0
		--AND ISNULL(D.ENABLE_BIN,0)=1
		UNION 
		SELECT '000' AS BIN_ID,'DEFAULT BIN' AS BIN_NAME,'DB' AS BIN_ALIAS,@CUSERCODE AS [USER_CODE] 
		FROM LOCATION (NOLOCK) WHERE DEPT_ID=@CDEPT_ID AND ISNULL(ENABLE_BIN,0)=0
		
	END
END
