create VIEW VW_WHOLESALEPACKSLIP_REPORT      
AS         
SELECT       
T1.PS_ID,      
T1.AC_CODE        
,T1.PS_NO        
,T1.PS_DT        
,T1.SUBTOTAL        
,T1.REMARKS        
,T1.CANCELLED        
,T1.CHECKED_BY        
,T1.USER_CODE        
,T1.LAST_UPDATE        
,T1.TS        
,T1.FIN_YEAR        
,T1.PARTY_DEPT_ID        
,T1.WAY_BILL  
,T1.PAY_TYPE  
,T1.SHIPPING_ADDRESS  
,T1.SHIPPING_ADDRESS2  
,T1.SHIPPING_ADDRESS3  
,T1.SHIPPING_AREA_NAME  
,T1.SHIPPING_PIN  
,T1.SHIPPING_CITY_NAME  
,T1.SHIPPING_STATE_NAME  
--,DBO.FN_GET_PC_WO_BATCHID(T2.PRODUCT_CODE)PRODUCT_CODE
,t2.PRODUCT_CODE
,T2.QUANTITY        
,T2.RATE        
,T2.ROW_ID  
,RIGHT(T2.ORDER_ID,10) AS ORDER_NO        
,T3.AC_NAME        
,T3.ALIAS        
,T3.HEAD_CODE        
,T3.CLOSING_BALANCE        
,T3.CLOSING_BALANCE_CR_DR        
,T3.PRINT_LEDGER        
,T3.PRINT_NAME        
,T3.CREDIT_DAYS        
,T3.BILL_BY_BILL        
,T3.ON_HOLD        
,T3.THROUGH_BROKER        
,T3.BROKER_COMM_PERCENT        
,T3.CREDIT_LIMIT        
,T3.ALLOW_CREDITOR_DEBTOR        
,T3.DPWEF_DT        
,T3.CST_PERCENTAGE        
,T3.PAN_NO        
,T3.GLN_NO        
,T3.MP_PERCENTAGE        
,T3.MRP_CALC_MODE        
,T3.TDS_CODE        
,T3.INV_RATE_TYPE        
,T3.OUTSTATION_PARTY        
,T3.SALES_AC_CODE        
,T3.USERNAME        
,T3.EDT_USERNAME       
,T3.ADDRESS0      
,T3.ADDRESS1      
,T3.ADDRESS2 
,T3.AREA_NAME      
,T3.CITY      
,T3.STATE      
,T3.CST_NO      
,T3.SST_NO      
,T3.TIN_NO      
,T3.PHONES_R      
,T3.PHONES_O      
,T3.PHONES_FAX      
,T3.MOBILE      
,T3.E_MAIL
,T3.AC_GST_NO  
,T3.PINCODE    
,T4.FORM_NAME        
,T4.PURCHASE_AC_CODE        
,T4.SALE_AC_CODE        
,T4.TAX_AC_CODE        
,T4.POST_TAX_SEPARATELY        
,T4.PUR_RETURN_AC_CODE        
,T4.SALE_RETURN_AC_CODE        
,T4.PHYSICAL_FORM        
,T4.SERIES        
,T4.EXCISE_EDU_CESS_AC_CODE        
,T4.EXCISE_HEDU_CESS_AC_CODE        
,T4.EXCISE_DUTY_AC_CODE        
,T5.EMP_NAME        
,T5.EMP_ALIAS        
,T5.EMP_HEAD        
,T6.PARA1_CODE      
,P1.PARA1_NAME        
,T6.PARA2_CODE      
,P2.PARA2_NAME      
,T6.PARA3_CODE      
,P3.PARA3_NAME      
,P4.PARA4_NAME      
,P6.PARA6_NAME      
,T6.PURCHASE_PRICE        
,T6.RECEIPT_DT        
,T6.PARA6_CODE        
,T6.DT_CREATED        
,T6.WS_PRICE        
,T2.WS_PRICE  AS WPS_WS_PRICE      
,T6.IMAGE_NAME        
,T6.CHALLAN_NO        
,T6.FIX_MRP        
,T7.CODING_SCHEME        
,T7.UOM_CODE        
,T7.PARA1_SET        
,T7.PARA2_SET        
,T7.INACTIVE        
,T7.SKU_CODE        
,T7.SUB_SECTION_CODE        
,T7.DISCON        
,T7.WHOLESALE_PRICE        
,T7.WSP_PERCENTAGE        
,T7.MIN_PRICE        
,T7.STOCK_NA        
,T7.ARTICLE_TYPE        
,T7.CREATED_ON        
,T7.ARTICLE_GROUP_CODE        
,T7.GENERATE_BARCODES_WITHARTICLE_PREFIX        
,T7.ARTICLE_GEN_MODE        
,T7.ARTICLE_PRD_MODE        
,T7.ARTICLE_SET_CODE        
,T7.OH_PERCENTAGE        
,T7.OH_AMOUNT        
,T8.SECTION_CODE        
,T8.MFG_CATEGORY        
,COM.COMPANY_CODE      
,COM.EMAIL_ID AS COMP_EMAILID 
,COM.PWD AS COMP_PWD  
,COM.CONTACT_NAME AS COMP_CONTACTNAME          
,COM.TDS_AC_NO AS COMP_TDSACNO      
,COM.COMPANY_NAME AS COMP_COMPANYNAME  
,com.PHONES_FAX AS COMP_PHONES_FAX      
,COM.LOGO_PATH AS COMP_LOGOPATH 
,COM.WEB_ADDRESS AS COMP_WEBADDRESS      
,COM.SSPL_FIRST_HDSR AS COMP_SSPLFIRSTHDSR      
,COM.POLICY_NO AS COMP_POLICYNO      
,COM.GRP_NAME AS COMP_GRPNAME       
,COM.CIN AS COMP_CIN 
,com.SST_NO AS COMP_SSTNO      
,com.SST_DT AS COMP_SSTDT 
,com.PRINT_ADDRESS AS COMP_PRINTADDRESS      
,com.WORKABLE AS COMP_WORKABLE 
,com.GRP_CODE AS COMP_GRPCODE      

,loc.PAN_NO AS COMP_PANNO      
,loc.STATE AS COMP_STATE       
,loc.COUNTRY_NAME AS COMP_CONTRY      
,loc.phone AS COMP_MOBILE    
,loc.DEPT_ALIAS AS COMP_ALIAS      
,loc.ADDRESS1 AS COMP_ADDRESS1      
,loc.ADDRESS2 AS COMP_ADDRESS2       
,loc.CITY AS COMP_CITY      
,loc.TAN_NO AS COMP_TANNO      
,loc.CST_DT AS COMP_CST_DT           
,CAST('' AS VARCHAR(100)) AS COMP_ADDRESS9    
,loc.AREA_CODE AS COMP_AREACODE           
,loc.PINCODE  AS COMP_PIN      
          
,BRD.AC_NAME AS BROKER_NAME    
,BIN.BIN_NAME   
,BIN.BIN_ID  
,ANG.ANGADIA_NAME AS TRANSPORT_NAME ,ANG.INSURANCE_PERCENTAGE AS TSPRT_INS_PERCENT,T1.ANGADIA_CODE         
,T6.PRODUCT_NAME,T7.ARTICLE_NO,T7.ARTICLE_NAME,      
(T2.QUANTITY * T2.RATE) AS CAL_AMOUNT,T6.MRP AS CAL_MRP,      
T2.MRP  AS WPS_MRP,      
T1.SUBTOTAL AS MST_NET_AMOUNT,      
T8.SUB_SECTION_NAME,T9.SECTION_NAME,ISNULL(T2.BOX_NO,0)AS BOX_NO, T2.BOX_DT,T2.SRNO       
,T2.MRP AS MRP
,P2.PARA2_ORDER
,Z.TOTAL_BOX 
,X.BUYER_ORDER_NO,X.BUYER_ORDER_DT,X.BUYER_ORDER_REF_NO,X.JOB_CARD_NO,X.JOB_CARD_DT
,p1.alias as para1_alias, P2.ALIAS AS PARA2_ALIAS,
p3.alias  as  PARA3_ALIAS, p4.alias as  PARA4_ALIAS, p5.alias as  PARA5_ALIAS,p6.alias as PARA6_ALIAS
,com.gST_NO AS COMP_gstNO 
,loc.loc_gst_no AS COMP_loc_gstno ,
T7.alias  as article_alias,t8.alias as sub_Section_alias,t9.alias as section_alias,
cast('' as varchar(max)) as PickListNoList
,T2.HSN_CODE AS HSN_CODE   
,T2.GST_PERCENTAGE AS GST_PERCENTAGE  
,T2.XN_VALUE_WITHOUT_GST  AS XN_VALUE_WITHOUT_GST  
,T2.XN_VALUE_WITH_GST AS XN_VALUE_WITH_GST  
,T2.IGST_AMOUNT AS IGST_AMOUNT  
,T2.CGST_AMOUNT AS CGST_AMOUNT  
,T2.SGST_AMOUNT AS SGST_AMOUNT   
,t3.ac_gst_state_code 
,t2.Remarks as Item_remarks,t7.ARTICLE_PACK_SIZE SN_ARTICLE_PACK_SIZE
,t3.registered_gst_dealer,t3.PAN_NO  PARTY_PAN_NO,t3.party_erp_code 
,t3.LMP_MSME,t3.LMP_MSME_NO 

FROM WPS_MST T1     (NOLOCK)   
JOIN WPS_DET T2 (NOLOCK) ON T1.PS_ID = T2.PS_ID        
JOIN LMV01106 T3 (NOLOCK) ON T3.AC_CODE = T1.AC_CODE        
JOIN FORM   T4 (NOLOCK) ON T4.FORM_ID = T2.ITEM_FORM_ID        
JOIN EMPLOYEE T5 (NOLOCK) ON T5.EMP_CODE = T2.EMP_CODE        
JOIN SKU T6 (NOLOCK) ON T6.PRODUCT_CODE = T2.PRODUCT_CODE        
JOIN ARTICLE T7 (NOLOCK) ON T7.ARTICLE_CODE=T6.ARTICLE_CODE        
JOIN SECTIOND T8 (NOLOCK) ON T8.SUB_SECTION_CODE=T7.SUB_SECTION_CODE        
JOIN SECTIONM T9 (NOLOCK) ON T9.SECTION_CODE=T8.SECTION_CODE        
JOIN PARA1 P1 (NOLOCK) ON P1.PARA1_CODE=T6.PARA1_CODE        
JOIN PARA2 P2 (NOLOCK) ON P2.PARA2_CODE=T6.PARA2_CODE        
JOIN PARA3 P3 (NOLOCK) ON P3.PARA3_CODE=T6.PARA3_CODE        
JOIN PARA4 P4 (NOLOCK) ON P4.PARA4_CODE=T6.PARA4_CODE        
JOIN PARA5 P5 (NOLOCK) ON P5.PARA5_CODE=T6.PARA5_CODE        
JOIN PARA6 P6 (NOLOCK) ON P6.PARA6_CODE=T6.PARA6_CODE  
JOIN BIN BIN (NOLOCK) ON T2.BIN_ID=BIN.BIN_ID  
JOIN UOM (NOLOCK) ON UOM.UOM_CODE = T7.UOM_CODE  
left join LOC_VIEW loc (nolock) on loc.dept_id =T1.location_code/*LEFT (T1.PS_ID,2)*//*Rohit 05-11-2024*/
JOIN 
(
	SELECT PS_ID,COUNT(DISTINCT BOX_NO) AS TOTAL_BOX FROM WPS_DET (NOLOCK)
	GROUP BY PS_ID
)Z ON Z.PS_ID=T2.PS_ID
LEFT OUTER JOIN LMV01106 BRD (NOLOCK) ON T1.BROKER_AC_CODE = BRD.AC_CODE      
LEFT OUTER JOIN ANGM ANG (NOLOCK) ON T1.ANGADIA_CODE =ANG.ANGADIA_CODE         
LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON T6.ARTICLE_CODE = ATTR.ARTICLE_CODE 
LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE
LEFT OUTER JOIN COMPANY COM (NOLOCK) ON 1=1 AND COM.COMPANY_CODE='01' 

LEFT OUTER JOIN
(
	SELECT BAR_DET.PRODUCT_CODE, A.ORDER_NO AS BUYER_ORDER_NO,A.ORDER_DT AS BUYER_ORDER_DT,A.REF_NO AS BUYER_ORDER_REF_NO
	,BMST.MEMO_NO AS JOB_CARD_NO,BMST.MEMO_DT AS JOB_CARD_DT
	FROM ORD_PLAN_BARCODE_DET BAR_DET (NOLOCK) 
	JOIN ORD_PLAN_DET BDET (NOLOCK) ON BDET.ROW_ID=BAR_DET.REFROW_ID
	JOIN ORD_PLAN_MST BMST (NOLOCK) ON BDET.MEMO_ID=BMST.MEMO_ID
	LEFT JOIN BUYER_ORDER_DET A1 (NOLOCK) ON BDET.WOD_ROW_ID=A1.ROW_ID
	LEFT JOIN BUYER_ORDER_MST A (NOLOCK) ON A1.ORDER_ID=A.ORDER_ID
	WHERE BMST.CANCELLED=0 AND A.CANCELLED=0
	GROUP BY BAR_DET.PRODUCT_CODE, A.ORDER_ID,A.ORDER_NO,A.ORDER_DT,A.REF_NO,BMST.MEMO_ID ,BMST.MEMO_NO,BMST.MEMO_DT
)X ON X.PRODUCT_CODE=T2.PRODUCT_CODE
WHERE T1.CANCELLED=0
