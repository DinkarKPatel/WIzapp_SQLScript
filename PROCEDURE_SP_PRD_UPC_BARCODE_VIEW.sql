CREATE PROCEDURE SP_PRD_UPC_BARCODE_VIEW
(
 @NQUERYID INT=1,
 @CORDER_ID VARCHAR(100)='',
 @CPARA1_CODE VARCHAR(100)='',
 @CPARA2_CODE VARCHAR(100)='',
 @CMEMO_ID VARCHAR(50)='',
 @CITEM_MERCHANT_CODE VARCHAR(10)='',
 @CAC_CODE VARCHAR(10)=''
 
)
AS
BEGIN
   
   IF @NQUERYID=1
      GOTO LBLISSUE
   ELSE IF @NQUERYID=2
       GOTO LBLREC
   ELSE IF @NQUERYID=3
       GOTO LBLTTT
   ELSE
   GOTO END_PROC
   
      LBLISSUE:
         
        
         
         SELECT  A.PRODUCT_CODE,P1.PARA1_NAME ,P2.PARA2_NAME,AC_NAME ,ITEM_MERCHANT_NAME AS MERCHANT_NAME    
         FROM PRD_UPCPMT A
         JOIN PRD_AGENCY_ISSUE_MATERIAL_UPC B ON A.PRODUCT_CODE =B.PRODUCT_CODE 
          JOIN
         (
           SELECT * FROM FN_WO_ALLOCATION('',@CORDER_ID)
           WHERE (@CAC_CODE='' OR AC_CODE =@CAC_CODE )
           AND (@CITEM_MERCHANT_CODE='' OR ITEM_MERCHANT_CODE =@CITEM_MERCHANT_CODE )
         ) C ON A.PRODUCT_CODE =C.PRODUCT_CODE 
         JOIN PARA1 P1 ON P1.PARA1_CODE =A.PARA1_CODE 
         JOIN PARA2 P2 ON P2.PARA2_CODE =A.PARA2_CODE 
         WHERE A.WO_ID =@CORDER_ID
         AND A.PARA1_CODE =@CPARA1_CODE
         AND A.PARA2_CODE =@CPARA2_CODE
         AND B.MEMO_ID=@CMEMO_ID
         
      
      
      GOTO END_PROC
       
      LBLREC:
         
         SELECT  A.PRODUCT_CODE,P1.PARA1_NAME ,P2.PARA2_NAME,AC_NAME ,ITEM_MERCHANT_NAME AS MERCHANT_NAME   
         FROM PRD_UPCPMT A
         JOIN PRD_AGENCY_MATERIAL_RECEIPT_UPC B ON A.PRODUCT_CODE =B.PRODUCT_CODE 
          JOIN
         (
           SELECT * FROM FN_WO_ALLOCATION('',@CORDER_ID)
           WHERE (@CAC_CODE='' OR AC_CODE =@CAC_CODE )
           AND (@CITEM_MERCHANT_CODE='' OR ITEM_MERCHANT_CODE =@CITEM_MERCHANT_CODE )
         ) C ON A.PRODUCT_CODE =C.PRODUCT_CODE 
         JOIN PARA1 P1 ON P1.PARA1_CODE =A.PARA1_CODE 
         JOIN PARA2 P2 ON P2.PARA2_CODE =A.PARA2_CODE 
         WHERE A.WO_ID =@CORDER_ID
         AND A.PARA1_CODE =@CPARA1_CODE
         AND A.PARA2_CODE =@CPARA2_CODE
         AND B.MEMO_ID=@CMEMO_ID
      
      
      GOTO END_PROC
      
       LBLTTT:
         
         SELECT   A.PRODUCT_CODE,P1.PARA1_NAME ,P2.PARA2_NAME,
         AC_NAME ,ITEM_MERCHANT_NAME   AS MERCHANT_NAME
         FROM PRD_UPCPMT A
         JOIN PRD_TRANSFER_TO_TRADING_UPC B ON A.PRODUCT_CODE =B.PRODUCT_CODE 
          JOIN
         (
           SELECT * FROM FN_WO_ALLOCATION('',@CORDER_ID)
           WHERE (@CAC_CODE='' OR AC_CODE =@CAC_CODE )
           AND (@CITEM_MERCHANT_CODE='' OR ITEM_MERCHANT_CODE =@CITEM_MERCHANT_CODE )
         ) C ON A.PRODUCT_CODE =C.PRODUCT_CODE 
         JOIN PARA1 P1 ON P1.PARA1_CODE =A.PARA1_CODE 
         JOIN PARA2 P2 ON P2.PARA2_CODE =A.PARA2_CODE 
         WHERE A.WO_ID =@CORDER_ID
         AND A.PARA1_CODE =@CPARA1_CODE
         AND A.PARA2_CODE =@CPARA2_CODE
         AND B.MEMO_ID=@CMEMO_ID
      
      
      GOTO END_PROC
      
   END_PROC:

END
