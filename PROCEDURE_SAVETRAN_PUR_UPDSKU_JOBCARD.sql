

-- PROCEDURE TO UPDATE PUR INFO IN SKU AND SKU_OH TABLES
CREATE PROCEDURE SAVETRAN_PUR_UPDSKU_JOBCARD
(
	@CMEMOID VARCHAR(40),
	@CERRORMSG VARCHAR(MAX) OUTPUT
)
--WITH ENCRYPTION
AS
BEGIN
    BEGIN TRY
    
	DECLARE @CCMD NVARCHAR(MAX),@CDETAILTABLE VARCHAR(100),@CMASTERTABLE VARCHAR(100),@CMEMOIDCOL VARCHAR(100) ,
	@CQTYCOL VARCHAR(100),@NSTEP INT
	
	SET @CERRORMSG=''
	
	SET @NSTEP=10

	
	-- UPDATING MASTER INFORMATION AND OTHER DETAILS IN SKU TABLE
	UPDATE A SET  	
		ARTICLE_CODE = B.ARTICLE_CODE,  	
		PARA1_CODE =CASE WHEN A.PARA1_CODE='0000000' THEN  B.PARA1_CODE ELSE A.PARA1_CODE END,  	
		PARA2_CODE =CASE WHEN A.PARA2_CODE='0000000' THEN  B.PARA2_CODE ELSE A.PARA2_CODE END,  
		PARA3_CODE = B.PARA3_CODE,  	
		PARA4_CODE = B.PARA4_CODE,  	
		PARA5_CODE = B.PARA5_CODE,  	
		PARA6_CODE = B.PARA6_CODE,  	
		AC_CODE		= a.AC_CODE, 	
		INV_NO		= C1.MEMO_NO, 
		INV_DT		= C1.MEMO_DT ,  	
		RECEIPT_DT	= C1.MEMO_DT, 
		PURCHASE_PRICE = B.PURCHASE_PRICE,
		MRP=B.MRP ,
		WS_PRICE=B.WHOLESALE_PRICE,
		hsn_code =B.hsn_code
	FROM SKU A
	JOIN ORD_PLAN_BARCODE_DET B1 ON A.PRODUCT_CODE = B1.PRODUCT_CODE
	JOIN ORD_PLAN_DET B ON B1.REFROW_ID = B.ROW_ID  
	JOIN ORD_PLAN_MST  C1 ON C1.MEMO_ID = B.MEMO_ID  
	WHERE  C1.MEMO_ID = @CMEMOID
	
	
	
	END TRY
	
	BEGIN CATCH
		SET @CERRORMSG = 'PROCEDURE SAVETRAN_UPDPUR_SKU_SNC: STEP- ' + LTRIM(STR(@NSTEP)) + ' SQL ERROR: #' + LTRIM(STR(ERROR_NUMBER())) + ' ' + ERROR_MESSAGE()
	
		GOTO END_PROC
	END CATCH
	
END_PROC:

END
--************************************************** END OF PROCEDURE SAVETRAN_PUR_UPDSKU
