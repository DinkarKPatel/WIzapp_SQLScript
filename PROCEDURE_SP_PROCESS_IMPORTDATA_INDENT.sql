CREATE PROCEDURE SP_PROCESS_IMPORTDATA_INDENT
@nSpId NUMERIC(4,0)=0
AS
BEGIN
    SET NOCOUNT ON	
	BEGIN TRY
	
	DECLARE @OUTPUT TABLE(TYPE VARCHAR(50),errmsg VARCHAR(200),VALUE VARCHAR(200)) 
	DECLARE @TERROR TABLE(SortOrder int,TYPE VARCHAR(50),errmsg VARCHAR(200),VALUE VARCHAR(200)) 
	DECLARE @TNUMCOLUM TABLE (NUMERICCOLUMN VARCHAR(100))

	DECLARE @CCMD NVARCHAR(MAX),@NSTEP INT,@CCOLNAME VARCHAR(100),@BPROCEED BIT
	,@bDoNotCreateMaster bit,@cPara1Name varchar(50),@cPara2Name varchar(50),@cPara3Name varchar(50)
	,@cPara4Name varchar(50),@cPara5Name varchar(50),@cPara6Name varchar(50),@cporowid varchar(max)
	,@cSearchBudgetPlan VARCHAR(200),@cPara1 VARCHAR(100),@cPara2 VARCHAR(100),@cPara3 VARCHAR(100)
	,@cPara4 VARCHAR(100),@cPara5 VARCHAR(100),@cPara6 VARCHAR(100),@CERRORMSG VARCHAR(MAX)
	,@CSOURCETABLE VARCHAR(300)
	
	SET @CSOURCETABLE='INDENT_EXCELIMPORT_UPLOAD'
	
	SET @NSTEP=10

		SELECT @CPARA1=ISNULL(VALUE,'PARA1')   
		FROM  CONFIG  
		WHERE CONFIG_OPTION='PARA1_caption' 
		  
		SELECT @CPARA2=ISNULL(VALUE,'PARA2')   
		FROM CONFIG  
		WHERE  CONFIG_OPTION='PARA2_caption'
		  
		SELECT @CPARA3=ISNULL(VALUE,'PARA3')   
		FROM CONFIG  
		WHERE  CONFIG_OPTION='PARA3_caption'
		  
		SELECT @CPARA4=ISNULL(VALUE,'PARA4')   
		FROM CONFIG  
		WHERE  CONFIG_OPTION='PARA4_caption'
		  
		SELECT @CPARA5=ISNULL(VALUE,'PARA5')   
		FROM CONFIG  
		WHERE  CONFIG_OPTION='PARA5_caption'
		  
		SELECT @CPARA6=ISNULL(VALUE,'PARA6')   
		FROM CONFIG  
		WHERE  CONFIG_OPTION='PARA6_caption'
					
		
		SET @NSTEP=20
		WHILE EXISTS (SELECT TOP 1 * FROM  @TNUMCOLUM)
		BEGIN
			 SET @CCOLNAME = (SELECT TOP 1 NUMERICCOLUMN FROM @TNUMCOLUM)

			 SET @CCMD=N'IF EXISTS(SELECT TOP 1 ''U'' FROM SYSCOLUMNS WHERE ID=OBJECT_ID('''+@CSOURCETABLE+''')
									   AND NAME='''+@CCOLNAME+''')		
							SET @BPROCEED=1
						 ELSE
							SET @BPROCEED=0'
			 EXEC SP_EXECUTESQL  @CCMD,N'@BPROCEED BIT OUTPUT',@BPROCEED OUTPUT
			 
			 
			 IF @BPROCEED=1
			 BEGIN
				 SET @NSTEP=30					 	 			   		 
				 SET @CCMD = N'SELECT DISTINCT ''ALERT'' AS TYPE, '''+@CCOLNAME+' SHOULD BE NUMERIC AND NOT NEGATIVE'' AS errmsg,'+@CCOLNAME+' AS VALUE
							   FROM '+@CSOURCETABLE+' WHERE  sp_id='''+ltrim(rtrim(str(@nSpId)))+''' AND (ISNUMERIC('+@CCOLNAME+') = 0 OR LEFT(LTRIM('+@CCOLNAME+'),1) = ''-'' OR CHARINDEX('','','+@CCOLNAME+')>0) AND '+@CCOLNAME+' IS NOT NULL' 
				 PRINT @CCMD
				 INSERT INTO @TERROR(TYPE,errmsg,VALUE)
				 EXEC SP_EXECUTESQL @CCMD
				
				 SET @NSTEP=35	
				 SET @CCMD = N'SELECT DISTINCT ''ALERT'' AS TYPE, '''+@CCOLNAME+' SHOULD BE NON ZERO'' AS errmsg,'+@CCOLNAME+' AS VALUE
						  FROM '+@CSOURCETABLE+' WHERE sp_id='''+ltrim(rtrim(str(@nSpId)))+''' AND CONVERT(NUMERIC(10,2),'+@CCOLNAME+')<=0  AND '+@CCOLNAME+' IS NOT NULL'  
				 PRINT @CCMD
				 INSERT INTO @TERROR(TYPE,errmsg,VALUE)
				 EXEC SP_EXECUTESQL @CCMD
				 
			 END
			
			 DELETE FROM @TNUMCOLUM WHERE NUMERICCOLUMN= @CCOLNAME
		END
			
		SET @NSTEP=40
		DECLARE @CROWID VARCHAR(200),@CFILTER VARCHAR(200),@NLOOP INT
		
		--SET @CCMD=N'UPDATE '+@CSOURCETABLE+' SET ROW_ID=''LATER_''+LTRIM(RTRIM(NEWID()))'
		--PRINT @CCMD
		--EXEC SP_EXECUTESQL @CCMD
		
		SET @NSTEP=50
		
	  	UPDATE a SET section_code=ISNULL(b.section_code,'') from INDENT_EXCELIMPORT_UPLOAD a
	  	LEFT OUTER JOIN sectionM b ON b.section_name=a.section_name
		WHERE a.sp_id=@nSpId 
		
		INSERT INTO @TERROR(TYPE,errmsg,VALUE)
		SELECT DISTINCT 'ALERT' AS TYPE,section_name+' not found in Section Masters' AS errmsg,'section_name' AS VALUE
		FROM INDENT_EXCELIMPORT_UPLOAD WHERE ISNULL(section_code,'')='' AND ISNULL(section_name,'')<>''
		AND sp_id=@nSpId 
		
		SET @NSTEP=60
	  	UPDATE a SET sub_section_code=ISNULL(b.sub_section_code,'') from INDENT_EXCELIMPORT_UPLOAD a
	  	LEFT OUTER JOIN sectiond b ON b.sub_section_name=a.sub_section_name
		WHERE a.sp_id=@nSpId 
		
		INSERT INTO @TERROR(TYPE,errmsg,VALUE)
		SELECT DISTINCT 'ALERT' AS TYPE,sub_section_name+'('+section_name+') not found in Sub-Section Masters' AS errmsg,'sub_section_name' AS VALUE
		FROM INDENT_EXCELIMPORT_UPLOAD WHERE ISNULL(sub_section_code,'')='' AND ISNULL(sub_section_name,'')<>''
		AND sp_id=@nSpId 
		
		SET @NSTEP=70		
	  	UPDATE a SET article_code=ISNULL(b.article_code,'') from INDENT_EXCELIMPORT_UPLOAD a
	  	LEFT OUTER JOIN article b ON b.article_no=a.article_no
		WHERE a.sp_id=@nSpId 
		
		INSERT INTO @TERROR(TYPE,errmsg,VALUE)
		SELECT DISTINCT 'ALERT' AS TYPE,article_no+' not found in Article Masters' AS errmsg,'article_no' AS VALUE
		FROM INDENT_EXCELIMPORT_UPLOAD WHERE ISNULL(article_code,'')='' AND ISNULL(article_no,'')<>''
		AND sp_id=@nSpId 
		
		SET @NSTEP=80
	  	UPDATE a SET para1_code=ISNULL(b.para1_code,'') from INDENT_EXCELIMPORT_UPLOAD a
	  	LEFT OUTER JOIN para1 b ON b.para1_name=a.para1_name
		WHERE a.sp_id=@nSpId 
		
		INSERT INTO @TERROR(TYPE,errmsg,VALUE)
		SELECT DISTINCT 'ALERT' AS TYPE,para1_name+' not found in '+ISNULL(@cPara1,'PARA1')+' Para Masters' AS errmsg,@cPara1 AS VALUE
		FROM INDENT_EXCELIMPORT_UPLOAD WHERE ISNULL(para1_code,'')='' AND ISNULL(para1_name,'')<>''
		AND sp_id=@nSpId 
		
		SET @NSTEP=90
	  	UPDATE a SET para2_code=ISNULL(b.para2_code,'') from INDENT_EXCELIMPORT_UPLOAD a
	  	LEFT OUTER JOIN para2 b ON b.para2_name=a.para2_name
		WHERE a.sp_id=@nSpId 
		
		INSERT INTO @TERROR(TYPE,errmsg,VALUE)
		SELECT DISTINCT 'ALERT' AS TYPE,para2_name+' not found in '+ISNULL(@cPara2,'PARA2')+' Para Masters' AS errmsg,@cPara2 AS VALUE
		FROM INDENT_EXCELIMPORT_UPLOAD WHERE ISNULL(para2_code,'')='' AND ISNULL(para2_name,'')<>''
		AND sp_id=@nSpId 
		
		SET @NSTEP=100
	  	UPDATE a SET para3_code=ISNULL(b.para3_code,'') from INDENT_EXCELIMPORT_UPLOAD a
	  	LEFT OUTER JOIN para3 b ON b.para3_name=a.para3_name
		WHERE a.sp_id=@nSpId 
		
		INSERT INTO @TERROR(TYPE,errmsg,VALUE)
		SELECT DISTINCT 'ALERT' AS TYPE,para3_name+' not found in '+ISNULL(@cPara3,'PARA3')+' Para Masters' AS errmsg,@cPara3 AS VALUE
		FROM INDENT_EXCELIMPORT_UPLOAD WHERE ISNULL(para3_code,'')='' AND ISNULL(para3_name,'')<>''
		AND sp_id=@nSpId 
		
		SET @NSTEP=110
	  	UPDATE a SET para4_code=ISNULL(b.para4_code,'') from INDENT_EXCELIMPORT_UPLOAD a
	  	LEFT OUTER JOIN para4 b ON b.para4_name=a.para4_name
		WHERE a.sp_id=@nSpId 
		
		INSERT INTO @TERROR(TYPE,errmsg,VALUE)
		SELECT DISTINCT 'ALERT' AS TYPE,para4_name+' not found in '+ISNULL(@cPara4,'PARA4')+' Para Masters' AS errmsg,@cPara4 AS VALUE
		FROM INDENT_EXCELIMPORT_UPLOAD WHERE ISNULL(para4_code,'')='' AND ISNULL(para4_name,'')<>''
		AND sp_id=@nSpId 
		
		SET @NSTEP=120
	  	UPDATE a SET para5_code=ISNULL(b.para5_code,'') from INDENT_EXCELIMPORT_UPLOAD a
	  	LEFT OUTER JOIN para5 b ON b.para5_name=a.para5_name
		WHERE a.sp_id=@nSpId 
		
		INSERT INTO @TERROR(TYPE,errmsg,VALUE)
		SELECT DISTINCT 'ALERT' AS TYPE,para5_name+' not found in '+ISNULL(@cPara5,'PARA5')+' Para Masters' AS errmsg,@cPara5 AS VALUE
		FROM INDENT_EXCELIMPORT_UPLOAD WHERE sp_id=@nSpId AND ISNULL(para5_code,'')='' AND ISNULL(para5_name,'')<>''
		
		
		SET @NSTEP=130
	  	UPDATE a SET para6_code=ISNULL(b.para6_code,'') from INDENT_EXCELIMPORT_UPLOAD a
	  	LEFT OUTER JOIN para6 b ON b.para6_name=a.para6_name
	  	WHERE a.sp_id=@nSpId 

		INSERT INTO @TERROR(TYPE,errmsg,VALUE)
		SELECT DISTINCT 'ALERT' AS TYPE,para6_name+' not found in '+ISNULL(@cPara6,'PARA6')+' Para Masters' AS errmsg,@cPara6 AS VALUE
		FROM INDENT_EXCELIMPORT_UPLOAD WHERE sp_id=@nSpId 
		AND ISNULL(para6_code,'')='' AND ISNULL(para6_name,'')<>''
		
		DECLARE @ATTR INT=1
		WHILE @ATTR<=25
		  BEGIN
		     SET @NSTEP=140+@ATTR*10
		     SET @CCMD=N'UPDATE A SET ATTR'+CAST(@ATTR AS VARCHAR)+'_KEY_CODE=ISNULL(B.ATTR'+CAST(@ATTR AS VARCHAR)+'_KEY_CODE,'''') 
		   	 FROM INDENT_EXCELIMPORT_UPLOAD A
	  	     LEFT JOIN ATTR'+CAST(@ATTR AS VARCHAR)+'_MST B ON B.ATTR'+CAST(@ATTR AS VARCHAR)+'_KEY_NAME=A.ATTR'+CAST(@ATTR AS VARCHAR)+'_KEY_NAME
	  	     WHERE A.SP_ID='+CAST(@nSpId AS VARCHAR)
			 PRINT '--Step '+CAST(@NSTEP AS VARCHAR)+'A - Attr '+CAST(@ATTR AS VARCHAR)+' : '+CHAR(13)+@CCMD
			 EXEC(@CCMD)
			 
			 SET @CCMD=N'SELECT DISTINCT ''ALERT'' AS TYPE,A.ATTR'+CAST(@ATTR AS VARCHAR)+'_KEY_NAME+'' not found in ''+B.TABLE_CAPTION+'' Attributes'' AS errmsg,B.TABLE_CAPTION AS VALUE
			 FROM INDENT_EXCELIMPORT_UPLOAD A
			 JOIN (SELECT TABLE_CAPTION FROM CONFIG_ATTR WHERE TABLE_NAME=''ATTR'+CAST(@ATTR AS VARCHAR)+'_MST'')B ON 2=2
			 LEFT JOIN ATTR'+CAST(@ATTR AS VARCHAR)+'_MST C ON C.ATTR'+CAST(@ATTR AS VARCHAR)+'_KEY_NAME=A.ATTR'+CAST(@ATTR AS VARCHAR)+'_KEY_NAME
			 WHERE A.SP_ID='+CAST(@nSpId AS VARCHAR)+' 
			 AND ISNULL(A.ATTR'+CAST(@ATTR AS VARCHAR)+'_KEY_CODE,'''')='''' 
			 AND ISNULL(A.ATTR'+CAST(@ATTR AS VARCHAR)+'_KEY_NAME,'''')<>''''
			 AND ISNULL(C.ATTR'+CAST(@ATTR AS VARCHAR)+'_KEY_NAME,'''')='''';'
		     PRINT CHAR(13)+'--Step '+CAST(@NSTEP AS VARCHAR)+'B - Attr '+CAST(@ATTR AS VARCHAR)+' : '+CHAR(13)+@CCMD+CHAR(13)
		     INSERT INTO @TERROR(TYPE,ERRMSG,VALUE)
		     EXEC(@CCMD)
		     --NEXT TABLE
		     SET @ATTR=@ATTR+1
		  END		
		GOTO END_PROC
		
	END TRY
	
	BEGIN CATCH
		SET @CERRORMSG = 'PROCEDURE SP_PROCESS_IMPORTDATA_ARSPLAN : STEP- ' + LTRIM(STR(@NSTEP)) + ' SQL ERROR: #' + LTRIM(STR(ERROR_NUMBER())) + ' ' + ERROR_MESSAGE()
		GOTO END_PROC
	END CATCH
	
END_PROC:

IF ISNULL (@CERRORMSG,'') = '' AND NOT EXISTS (SELECT TOP 1 * FROM @TERROR)
BEGIN
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET SECTION_CODE=REPLICATE('0',7) WHERE ISNULL(SECTION_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET SUB_SECTION_CODE=REPLICATE('0',7) WHERE ISNULL(SUB_SECTION_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ARTICLE_CODE=REPLICATE('0',8) WHERE ISNULL(ARTICLE_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET PARA1_CODE=REPLICATE('0',7) WHERE ISNULL(PARA1_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET PARA2_CODE=REPLICATE('0',7) WHERE ISNULL(PARA2_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET PARA3_CODE=REPLICATE('0',7) WHERE ISNULL(PARA3_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET PARA4_CODE=REPLICATE('0',7) WHERE ISNULL(PARA4_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET PARA5_CODE=REPLICATE('0',7) WHERE ISNULL(PARA5_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET PARA6_CODE=REPLICATE('0',7) WHERE ISNULL(PARA6_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR1_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR1_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR2_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR2_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR3_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR3_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR4_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR4_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR5_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR5_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR6_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR6_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR7_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR7_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR8_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR8_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR9_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR9_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR10_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR10_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR11_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR11_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR12_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR12_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR13_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR13_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR14_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR14_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR15_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR15_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR16_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR16_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR17_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR17_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR18_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR18_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR19_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR19_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR20_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR20_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR21_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR21_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR22_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR22_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR23_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR23_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR24_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR24_KEY_CODE,'')='' AND SP_ID=@nSpId
	UPDATE INDENT_EXCELIMPORT_UPLOAD WITH (ROWLOCK) SET ATTR25_KEY_CODE=REPLICATE('0',7) WHERE ISNULL(ATTR25_KEY_CODE,'')='' AND SP_ID=@nSpId

	SELECT CONVERT(VARCHAR(2),'') AS ERRMSG,A.*,'LATER' AS INDENT_ID,CONVERT(VARCHAR(40),NEWID()) AS ROW_ID
	FROM INDENT_EXCELIMPORT_UPLOAD A
	WHERE A.SP_ID=@NSPID
END	
ELSE
BEGIN
	INSERT @OUTPUT ( TYPE, errmsg,VALUE) VALUES('ERROR',@CERRORMSG,'')

	IF  EXISTS (SELECT TOP 1 * FROM @TERROR)
		SELECT TYPE,VALUE,errmsg FROM @TERROR
		ORDER BY SortOrder
	 ELSE	
		SELECT * FROM @OUTPUT
	END
SET NOCOUNT OFF	
END
---END OF PROCEDURE - SP_PROCESS_IMPORTDATA_INDENT
