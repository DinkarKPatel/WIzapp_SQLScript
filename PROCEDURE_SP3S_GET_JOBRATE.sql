create PROCEDURE SP3S_GET_JOBRATE
(
	@CPRODUCTCODE		VARCHAR(50),
	@CJOBWORKERCODE		VARCHAR(MAX),
	@CJOBCODE			VARCHAR(50)
	
)
AS
BEGIN

	DECLARE @CCMD	NVARCHAR(MAX),@CJOB_RATE	NUMERIC(10,2)
	
	IF OBJECT_ID('TEMPDB..#SP3S_GET_JOBRATE','U') IS NOT NULL
		DROP TABLE #SP3S_GET_JOBRATE
	
	SELECT PRODUCT_CODE,ARTICLE_CODE 
	INTO #SP3S_GET_JOBRATE
	FROM SKU (NOLOCK) 
	WHERE PRODUCT_CODE=@CPRODUCTCODE
	
	SELECT TOP 1 @CJOB_RATE=RATE
	FROM JOB_RATE_DET A (NOLOCK)
	JOIN ARTICLE B (NOLOCK) ON B.ARTICLE_CODE=A.ARTICLE_CODE
	JOIN PRD_AGENCY_MST C (NOLOCK) ON C.AGENCY_CODE=A.AGENCY_CODE
	JOIN #SP3S_GET_JOBRATE X ON X.ARTICLE_CODE=A.ARTICLE_CODE
	WHERE C.AGENCY_CODE=@CJOBWORKERCODE AND A.JOB_CODE=@CJOBCODE
	and 1=2
	
	IF(@@ROWCOUNT=0)
	BEGIN
		SELECT TOP 1 @CJOB_RATE=RATE
		FROM JOB_RATE_DET A(NOLOCK)
		JOIN ARTICLE B (NOLOCK) ON B.ARTICLE_CODE=A.ARTICLE_CODE
		JOIN #SP3S_GET_JOBRATE X ON X.ARTICLE_CODE=A.ARTICLE_CODE
		WHERE ISNULL(A.AGENCY_CODE,'')='' AND A.JOB_CODE=@CJOBCODE			
	END
	
	SELECT CAST(ISNULL(@CJOB_RATE,0) AS NUMERIC(10,2)) AS JOB_RATE
END
