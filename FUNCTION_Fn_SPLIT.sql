CREATE FUNCTION DBO.FN_SPLIT(@STRING VARCHAR(MAX), @SEPARATOR CHAR(1))
RETURNS @STRINGVAL TABLE(VALUE VARCHAR(MAX))
----WITH ENCRYPTION
AS
BEGIN
	--DECLARE LOCAL VARIABLE
	DECLARE @LOOPSTART INT, @COMPLETESTR VARCHAR(MAX),@FINDSEPARATOR INT
	
	IF LEN(@STRING) <> 0 OR LEN(@SEPARATOR) <> 0
		SET @COMPLETESTR = @STRING+@SEPARATOR;

	WHILE LEN(@COMPLETESTR) > 1
	BEGIN
		SET @FINDSEPARATOR = CHARINDEX(@SEPARATOR,@COMPLETESTR)
		INSERT INTO @STRINGVAL SELECT LTRIM(RTRIM(SUBSTRING(@COMPLETESTR,1,@FINDSEPARATOR-1)))

		SET @COMPLETESTR = SUBSTRING(@COMPLETESTR,@FINDSEPARATOR+1,LEN(@COMPLETESTR)-@FINDSEPARATOR)
	END

	RETURN
END
