CREATE PROCEDURE SP3S_GVSCHEME_SETUP
(
 @NQUERY    NUMERIC(2),        
 @CWHERE    NVARCHAR(MAX)='' 
)
   AS 
  BEGIN
  
IF @NQUERY=2        
GOTO LBLMST        
ELSE IF @NQUERY=3        
GOTO LBLDET        
ELSE IF @NQUERY=4        
GOTO LBLLOC 
ELSE IF @NQUERY=5        
GOTO LBLSTATE
ELSE IF @NQUERY=6        
GOTO LBLSTATELOC


LBLMST:

	  SELECT * FROM GV_SCHEME_MST  WHERE SCHEME_CODE=@CWHERE 
	  
	  GOTO ENDPROC 
  
LBLDET:

		SELECT COALESCE(MRP_FROM,0) AS MRP_FROM,      
		COALESCE(MRP_TO,0) AS MRP_TO ,      
		COALESCE(GV1_AMOUNT,0) AS GV1_AMOUNT,      
		COALESCE(GV2_AMOUNT,0) AS GV2_AMOUNT,      
		COALESCE(GV3_AMOUNT,0) AS GV3_AMOUNT ,      
		COALESCE(SCHEME_CODE,'') AS SCHEME_CODE, CONVERT(VARCHAR(40),ROW_ID) AS ROW_ID FROM GV_SCHEME_1      
		WHERE SCHEME_CODE= @CWHERE 
		GOTO ENDPROC 
		
		    
LBLLOC:

          SELECT CAST(1 AS BIT) AS [CHK], A.DEPT_ID,B.DEPT_NAME,A.SCHEME_CODE    
          FROM GV_SCHEME_LOCS A          
		  JOIN LOCATION B ON A.DEPT_ID=B.DEPT_ID          
		  WHERE A.SCHEME_CODE=@CWHERE        
		      
		  UNION ALL    
		      
		  SELECT CAST(0 AS BIT) AS [CHK],DEPT_ID, DEPT_NAME,'' AS MEMO_NO          
		  FROM LOCATION         
		  WHERE DEPT_ID = MAJOR_DEPT_ID AND INACTIVE=0        
		  AND DEPT_ID NOT IN (SELECT DEPT_ID FROM GV_SCHEME_LOCS WHERE SCHEME_CODE =@CWHERE)    
		  ORDER BY DEPT_ID ASC
		   
		  GOTO ENDPROC
		  		  
LBLSTATE:
		SELECT STATE AS STATE_NAME,STATE_CODE  FROM STATE  WHERE INACTIVE=0
		GOTO ENDPROC


LBLSTATELOC:
				
		SELECT A.DEPT_NAME,A.DEPT_ID FROM LOCATION A 
		JOIN AREA B ON A.AREA_CODE=B.AREA_CODE
		JOIN CITY C ON C.CITY_CODE=B.CITY_CODE
		JOIN STATE D ON D.STATE_CODE=C.STATE_CODE
		WHERE  (@CWHERE='' OR D.STATE_CODE=@CWHERE)
		GOTO ENDPROC

ENDPROC:
  
END
