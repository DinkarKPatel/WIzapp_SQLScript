create PROCEDURE  SP3S_ORDER_DETAILS_INV
(
	@CWHERE VARCHAR(100)=''
)
AS
BEGIN
	--DECLARE @CWHERE VARCHAR(100)=''
	;WITH ORD_PLAN
	AS
	(
		SELECT BMST.MEMO_ID,BMST.MEMO_NO,BMST.MEMO_DT,ISNULL(BDET.WOD_ROW_ID,G.BO_DET_ROW_ID) as WOD_ROW_ID
		FROM IND01106 G (NOLOCK)  --ON A.ISSUE_ID = G.ISSUE_ID                        
		LEFT JOIN ORD_PLAN_BARCODE_DET BAR_DET (NOLOCK) ON BAR_DET.PRODUCT_CODE=G.PRODUCT_CODE  --AND G.WIP_UID = BAR_DET.REFROW_ID
		LEFT  JOIN ORD_PLAN_DET BDET (NOLOCK) ON BDET.ROW_ID=BAR_DET.REFROW_ID
		LEFT  JOIN ORD_PLAN_MST BMST (NOLOCK) ON BDET.MEMO_ID=BMST.MEMO_ID
		WHERE G.INV_ID = @CWHERE  
		GROUP BY  BMST.MEMO_ID,BMST.MEMO_NO,BMST.MEMO_DT,ISNULL(BDET.WOD_ROW_ID,G.BO_DET_ROW_ID)
	)
	SELECT  A.ORDER_NO AS BUYER_ORDER_NO,A.ORDER_DT AS BUYER_ORDER_DT,A.REF_NO AS BUYER_ORDER_REF_NO
	,A2.MEMO_NO AS JOB_CARD_NO,A2.MEMO_DT AS JOB_CARD_DT
	FROM ORD_PLAN A2
	JOIN BUYER_ORDER_DET A1 (NOLOCK) ON A2.WOD_ROW_ID=A1.ROW_ID
	JOIN BUYER_ORDER_MST A (NOLOCK) ON A1.ORDER_ID=A.ORDER_ID
	GROUP BY A.ORDER_ID,A.ORDER_NO,A.ORDER_DT,A.REF_NO,A2.MEMO_ID ,A2.MEMO_NO,A2.MEMO_DT
END


