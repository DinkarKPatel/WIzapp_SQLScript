create PROCEDURE SP3S_PROFORMA_DETAILS
(
  @NMODE  INT,
  @CMEMO_ID VARCHAR(40)=''
)
as
begin


IF @NMODE=1
   GOTO LBLMST
ELSE IF @NMODE=2
    GOTO LBLDET
ELSE 
   GOTO END_PROC


   LBLMST:

       SELECT A.MEMO_NO,A.MEMO_DATE,A.FIN_YEAR,A.CANCELLED,A.MEMO_ID,A.SOURCE_DEPTID,
			  A.TARGET_DEPTID,A.VALID_DATE,A.LAST_UPDATE,A.DOC_SYNCH_LAST_UPDATE,A.APPROVEDLEVELNO ,
			  SL.DEPT_NAME AS SOURCELOCATION ,TL.DEPT_NAME AS TARGETLOCATION
	   FROM DEBITNOTE_PROFORMA_MST A (NOLOCK)
	   JOIN LOCATION SL ON SL.DEPT_ID =A.SOURCE_DEPTID
	   JOIN LOCATION TL ON TL.DEPT_ID =A.TARGET_DEPTID 
	   where a.Memo_Id =@CMEMO_ID


   GOTO END_PROC

   LBLDET:

       SELECT A.PRODUCT_CODE,A.ROW_ID,A.PRODUCT_CODE,A.QUANTITY,a.DN_QTY,
		     SN.ARTICLE_NO,SN.ARTICLE_NAME,SN.UOM,SN.SECTION_NAME,SN.SUB_SECTION_NAME
			,SN.PARA1_NAME,SN.PARA2_NAME,SN.PARA3_NAME,SN.PARA4_NAME,SN.PARA5_NAME,SN.PARA6_NAME
			,SN.ATTR1_KEY_NAME,SN.ATTR2_KEY_NAME,SN.ATTR3_KEY_NAME,SN.ATTR4_KEY_NAME,SN.ATTR5_KEY_NAME
			,SN.ATTR6_KEY_NAME,SN.ATTR7_KEY_NAME,SN.ATTR8_KEY_NAME,SN.ATTR9_KEY_NAME,SN.ATTR10_KEY_NAME
			,SN.ATTR11_KEY_NAME,SN.ATTR12_KEY_NAME,SN.ATTR13_KEY_NAME,SN.ATTR14_KEY_NAME,SN.ATTR15_KEY_NAME
			,SN.ATTR16_KEY_NAME,SN.ATTR17_KEY_NAME,SN.ATTR18_KEY_NAME,SN.ATTR19_KEY_NAME,SN.ATTR20_KEY_NAME
			,SN.ATTR21_KEY_NAME,SN.ATTR22_KEY_NAME,SN.ATTR23_KEY_NAME,SN.ATTR24_KEY_NAME,SN.ATTR25_KEY_NAME
		
	   FROM DEBITNOTE_PROFORMA_DET A (NOLOCK)
	   JOIN SKU_NAMES SN ON SN.PRODUCT_CODE =A.PRODUCT_CODE 
	   WHERE A.MEMO_ID =@CMEMO_ID


   GOTO END_PROC


   END_PROC:
END