DECLARE @CLOCATIONID VARCHAR(2)

IF NOT EXISTS(SELECT TOP 1 * FROM SERIES_SETUP_MST)
BEGIN
	IF NOT EXISTS(SELECT TOP 1 * FROM SERIES_SETUP_XNTYPES)
		INSERT SERIES_SETUP_XNTYPES	( XN_TYPE, DESCRIPTION )  
		SELECT 'PO' AS XN_TYPE,'PURCHASE ORDER' AS DESCRIPTION
		UNION
		SELECT 'PUR' AS XN_TYPE,'PARTY PURCHASE' AS DESCRIPTION
		UNION
		SELECT 'PUR_GRP' AS XN_TYPE,'GROUP PURCHASE' AS DESCRIPTION
		UNION
		SELECT 'PRT' AS XN_TYPE,'PARTY DEBIT NOTE' AS DESCRIPTION
		UNION
		SELECT 'PRT_GRP' AS XN_TYPE,'GROUP DEBIT NOTE' AS DESCRIPTION
		UNION
		SELECT 'WSL' AS XN_TYPE,'PARTY WHOLESALE INVOICE' AS DESCRIPTION
		UNION
		SELECT 'WSL_GRP' AS XN_TYPE,'GROUP WHOLESALE INVOICE' AS DESCRIPTION
		UNION
		SELECT 'WSR' AS XN_TYPE,'PARTY CREDIT NOTE' AS DESCRIPTION
		UNION
		SELECT 'WSR_GRP' AS XN_TYPE,'GROUP CREDIT NOTE' AS DESCRIPTION
		UNION
		SELECT 'BOX' AS XN_TYPE,'BOX/BUNDLE' AS DESCRIPTION

	SELECT TOP 1 @CLOCATIONID=VALUE FROM CONFIG WHERE CONFIG_OPTION='LOCATION_ID'

	INSERT SERIES_SETUP_MST	( DEPT_ID, XN_TYPE, SERIES_SETUP_MODE, PREFIX_APPLICABLE, PREFIX_USER_ALIAS, PREFIX_FINYEAR,
	IGST_XN_PREFIX, CGST_XN_PREFIX, DELIVERY_CHALLAN_PREFIX, PREFIX_DESTINATION_LOCID, START_FROM, MEMO_ID )  
	SELECT @CLOCATIONID AS DEPT_ID,XN_TYPE,2 AS SERIES_SETUP_MODE,0 AS PREFIX_APPLICABLE,0 AS PREFIX_USER_ALIAS,
	0 AS PREFIX_FINYEAR,'' AS IGST_XN_PREFIX,'' AS CGST_XN_PREFIX,'' AS DELIVERY_CHALLAN_PREFIX,
	(CASE WHEN GENERATE_AUTO_SERIES=1 AND XN_TYPE IN ('WSL_GRP','PRT_GRP') THEN 1 ELSE 0 END) AS  PREFIX_DESTINATION_LOCID,0 AS  START_FROM,NEWID() AS ROW_ID 
	FROM LOCATION,SERIES_SETUP_XNTYPES
	WHERE DEPT_ID=@CLOCATIONID

END


IF NOT EXISTS (SELECT TOP 1 * FROM SERIES_SETUP_XNTYPES WHERE XN_TYPE='PO')
BEGIN
	INSERT SERIES_SETUP_XNTYPES	( XN_TYPE, DESCRIPTION,SNO )  
	SELECT 'PO' AS XN_TYPE,'PURCHASE ORDER' AS DESCRIPTION,9
END	

IF NOT EXISTS (SELECT TOP 1 * FROM SERIES_SETUP_XNTYPES WHERE XN_TYPE='QC')
BEGIN
	INSERT SERIES_SETUP_XNTYPES	( XN_TYPE, DESCRIPTION,SNO )  
	SELECT 'QC' AS XN_TYPE,'QUALITY CONTROL' AS DESCRIPTION,10
END	

IF NOT EXISTS (SELECT TOP 1 * FROM SERIES_SETUP_XNTYPES WHERE XN_TYPE='ASN')
BEGIN
	INSERT SERIES_SETUP_XNTYPES	( XN_TYPE, DESCRIPTION,SNO )  
	SELECT 'ASN' AS XN_TYPE,'ADVANCE SHIPMENT NOTE' AS DESCRIPTION,10
END	

IF NOT EXISTS (SELECT TOP 1 * FROM SERIES_SETUP_XNTYPES WHERE XN_TYPE='JWI')
BEGIN
	INSERT SERIES_SETUP_XNTYPES	( XN_TYPE, DESCRIPTION,SNO )  
	SELECT 'JWI' AS XN_TYPE,'JOB WORK ISSUE' AS DESCRIPTION,12
END	

IF NOT EXISTS (SELECT TOP 1 * FROM SERIES_SETUP_XNTYPES WHERE XN_TYPE='JWR')
BEGIN
	INSERT SERIES_SETUP_XNTYPES	( XN_TYPE, DESCRIPTION,SNO )  
	SELECT 'JWR' AS XN_TYPE,'JOB WORK RECEIPT' AS DESCRIPTION,13
END	

IF NOT EXISTS (SELECT TOP 1 * FROM SERIES_SETUP_XNTYPES WHERE XN_TYPE='MIS')
BEGIN
	INSERT SERIES_SETUP_XNTYPES	( XN_TYPE, DESCRIPTION,SNO )  
	SELECT 'MIS' AS XN_TYPE,'MATERIAL ISSUE' AS DESCRIPTION,13
END	

IF NOT EXISTS (SELECT TOP 1 * FROM SERIES_SETUP_XNTYPES WHERE XN_TYPE='JOB_CARD')
BEGIN
	INSERT SERIES_SETUP_XNTYPES	( XN_TYPE, DESCRIPTION,SNO )  
	SELECT 'JOB_CARD' AS XN_TYPE,'JOB CARD' AS DESCRIPTION,13
END	

IF NOT EXISTS (SELECT TOP 1 * FROM SERIES_SETUP_XNTYPES (NOLOCK) WHERE RIGHT(xn_type,3)='_FR')
BEGIN
	INSERT SERIES_SETUP_XNTYPES	( XN_TYPE, DESCRIPTION,SNO )  
	SELECT 'PUR_GRP_FR' AS XN_TYPE,'GROUP PURCHASE AT FRANCHISE' AS DESCRIPTION,6
	UNION
	SELECT 'PRT_GRP_FR' AS XN_TYPE,'GROUP DEBIT NOTE TO FRANCHISE' AS DESCRIPTION,7
	UNION
	SELECT 'WSL_GRP_FR' AS XN_TYPE,'GROUP WHOLESALE INVOICE TO FRANCHISE' AS DESCRIPTION,5
	UNION
	SELECT 'WSR_GRP_FR' AS XN_TYPE,'GROUP CREDIT NOTE AT FRANCHISE' AS DESCRIPTION,8
END	


IF NOT EXISTS (SELECT TOP 1 * FROM SERIES_SETUP_MST (NOLOCK) WHERE RIGHT(xn_type,3)='_FR')
BEGIN
	INSERT series_Setup_mst	( DEPT_ID, XN_TYPE, SERIES_SETUP_MODE, Prefix_applicable, Prefix_user_alias, Prefix_finyear, 
	igst_xn_prefix, cgst_xn_prefix, delivery_challan_prefix, Prefix_destination_locid, start_from,memo_id, 
	XN_ITEM_TYPE, igst_fr_xn_prefix, cgst_fr_xn_prefix )  
	SELECT 	DEPT_ID, XN_TYPE+'_FR' AS xn_type, SERIES_SETUP_MODE, Prefix_applicable, Prefix_user_alias, Prefix_finyear, igst_xn_prefix, 
	cgst_xn_prefix, delivery_challan_prefix, Prefix_destination_locid, start_from,NEWID() AS memo_id, XN_ITEM_TYPE, 
	igst_fr_xn_prefix, cgst_fr_xn_prefix FROM series_Setup_mst
	WHERE RIGHT(XN_TYPE,4)='_GRP' AND DEPT_ID<>''
	
	INSERT series_Setup_manual_det	( memo_id, row_Id, prefix, inactive, start_from )  
	SELECT  c.memo_id, newid() as row_Id, prefix, inactive, a.start_from 
	FROM series_Setup_manual_det a 
	join series_setup_mst b on a.memo_id=b.memo_id
	JOIN series_Setup_mst c ON c.xn_type=b.xn_type+'_fr' AND c.dept_id=b.dept_id
	WHERE b.xn_type IN ('PUR_GRP','PRT_GRP','WSL_GRP','WSR_GRP')
	order by c.xn_type,c.memo_id
		
	UPDATE SERIES_SETUP_XNTYPES SET description='GROUP DEBIT NOTE TO COMPANY OWNED LOC' WHERE xn_type='PRT_GRP'
	UPDATE SERIES_SETUP_XNTYPES SET description='GROUP WHOLESALE TO COMPANY OWNED LOC' WHERE xn_type='WSL_GRP'
	UPDATE SERIES_SETUP_XNTYPES SET description='GROUP PURCHASE AT COMPANY OWNED LOC' WHERE xn_type='PUR_GRP'
	UPDATE SERIES_SETUP_XNTYPES SET description='GROUP CREDIT NOTE AT COMPANY OWNED LOC' WHERE xn_type='WSR_GRP'
END


IF NOT EXISTS (SELECT TOP 1 * FROM SERIES_SETUP_XNTYPES WHERE XN_TYPE='FDN')
BEGIN
	INSERT SERIES_SETUP_XNTYPES	( XN_TYPE, DESCRIPTION,SNO )  
	SELECT 'FDN' AS XN_TYPE,'PARTY DEBIT NOTE(FINANCIAL)' AS DESCRIPTION,13
END	

IF NOT EXISTS (SELECT TOP 1 * FROM SERIES_SETUP_XNTYPES WHERE XN_TYPE='FCN')
BEGIN
	INSERT SERIES_SETUP_XNTYPES	( XN_TYPE, DESCRIPTION,SNO )  
	SELECT 'FCN' AS XN_TYPE,'PARTY CREDIT NOTE(FINANCIAL)' AS DESCRIPTION,13
END	

IF NOT EXISTS (SELECT TOP 1 * FROM SERIES_SETUP_XNTYPES WHERE XN_TYPE='BOX')
BEGIN
	INSERT SERIES_SETUP_XNTYPES	( XN_TYPE, DESCRIPTION,SNO )  
	SELECT 'BOX' AS XN_TYPE,'BOX/BUNDLE' AS DESCRIPTION,15
END