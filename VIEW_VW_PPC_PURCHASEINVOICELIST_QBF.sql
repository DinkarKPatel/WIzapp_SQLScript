CREATE  VIEW VW_PPC_PURCHASEINVOICELIST_QBF 

AS         
 	SELECT C.MRR_ID,C.MRR_NO,C.RECEIPT_DT AS MRR_DT,C.CANCELLED, 
	       THAN_NO ,A.PRODUCT_CODE ,A.QUANTITY,
	       B.ARTICLE_CODE ,ART.ARTICLE_NO,
	       B.PARA1_CODE,P1.PARA1_NAME ,
	       B.PARA2_CODE,P2.PARA2_NAME ,
	       B.PARA3_CODE,P3.PARA3_NAME,
	       SD.SUB_SECTION_CODE,SD.SUB_SECTION_NAME ,
	       SM.SECTION_CODE,SM.SECTION_NAME ,
	       ISNULL(BO.PO_NO,'') AS PO_NO,
	       ISNULL(BO.PO_DT,'') AS PO_DT  ,
	       ISNULL(BO.PO_ID,'') AS PO_ID ,
	       ISNULL(BO.ORDER_NO  ,'') AS ORDER_NO,
	       UOM.UOM_NAME,
	       ISNULL(BO.WSL_REMARKS,'') AS WSL_REMARKS
	FROM PPC_PID01106_BARCODE A
	JOIN PPC_PID01106 B ON A.PID_ROW_ID =B.ROW_ID 
	JOIN PPC_PIM01106 C ON B.MRR_ID=C.MRR_ID
	JOIN ARTICLE ART ON ART.ARTICLE_CODE=B.ARTICLE_CODE 
	JOIN SECTIOND SD ON SD.SUB_SECTION_CODE =ART.SUB_SECTION_CODE
	JOIN SECTIONM SM ON SD.SECTION_CODE =SM.SECTION_CODE 
	JOIN PARA1 P1 ON P1.PARA1_CODE =B.PARA1_CODE 
	JOIN PARA2 P2 ON P2.PARA2_CODE =B.PARA2_CODE 
	JOIN PARA3 P3 ON P3.PARA3_CODE =B.PARA3_CODE 
	JOIN UOM ON UOM.UOM_CODE=ART.UOM_CODE
	LEFT OUTER JOIN
	(
	 SELECT B.PO_NO,B.PO_DT  ,B.PO_ID ,A.ROW_ID,C.ORDER_NO ,C.WSL_REMARKS 
	 FROM PPC_POD01106  A
	 JOIN PPC_POM01106  B ON A.PO_ID =B.PO_ID
	 LEFT OUTER JOIN 
	 (
	   SELECT C.ROW_ID ,B.BILL_NO AS ORDER_NO ,
	          A.ITEM_REMARKS AS WSL_REMARKS
	   FROM PPC_BUYER_ORDER_DET A
	   JOIN PPC_BUYER_ORDER_MST B ON A.ORDER_ID =B.ORDER_ID
	   JOIN PPC_BO_ART_BOM C ON A.ROW_ID=C.REF_ROW_ID 
	   WHERE B.CANCELLED =0
	   GROUP BY  C.ROW_ID ,B.BILL_NO, A.ITEM_REMARKS
	 ) C ON A.BO_BOM_ROW_ID =C.ROW_ID 
	 WHERE B.CANCELLED =0
	) BO ON BO.ROW_ID =B.PO_ROW_ID
