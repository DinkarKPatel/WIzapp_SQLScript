CREATE PROCEDURE SP3S_ALTERATION    
(    
 @nQueryID  INT,    
 @cDeptID  VARCHAR(50),    
 @cCMID   VARCHAR(50),    
 @cWhere   VARCHAR(50)='',    
 @cWhere1  VARCHAR(50)=''    
)    
AS    
BEGIN    
 IF @nQueryID=1    
 BEGIN    
  SELECT A.JOB_NAME,A.JOB_CODE,BASE_NRV,JOBRATE_LESSTHAN_NRV,JOBRATE_MORETHAN_NRV,VENDOR_RATE     
  FROM jobs A (NOLOCK)    
  JOIN ALTERATIONSETUP B (NOLOCK) ON B.JOB_CODE=A.job_code    
  WHERE B.DEPT_ID=@cDeptID AND B.SUB_SECTION_CODE=@cWhere AND A.job_name LIKE @cWhere1      
 END    
 ELSE IF @nQueryID=2    
 BEGIN    
  SELECT ROW_NUMBER() OVER (PARTITION BY A.PRODUCT_CODE ORDER BY A.PRODUCT_CODE) AS SR_NO, A.CM_ID,A.PRODUCT_CODE,    
  A.JOB_CODE,A.SYS_RATE,A.RATE,A.REMARKS,A.LAST_UPDATE,A.ROW_ID,D.SUB_SECTION_CODE,D.SUB_SECTION_NAME,E.JOB_NAME    
  FROM CMM_ALTERATION A (NOLOCK)    
  JOIN SKU B (NOLOCK) ON B.product_code=A.Product_code    
  JOIN ARTICLE C (NOLOCK) ON C.article_code=B.article_code    
  JOIN SECTIOND D (NOLOCK) ON C.SUB_SECTION_CODE=D.SUB_SECTION_CODE    
  JOIN JOBS E (NOLOCK) ON E.JOB_CODE=A.JOB_CODE    
  WHERE A.CM_ID=@cCMID     
 END    
 ELSE IF @nQueryID=3    
 BEGIN    
  EXEC SP3S_GETDATA_FOR_ALTERATION @CMID = @cCMID     
 END    
 ELSE IF @nQueryID=99    
 BEGIN    
  SELECT TOP 50 CM_ID,CM_NO,CONVERT(VARCHAR,CM_DT,105) AS CM_DT ,B.USER_CUSTOMER_CODE    
  FROM CMM01106 A (NOLOCK)  
  JOIN CUSTDYM B  (NOLOCK) ON B.customer_code   =A.CUSTOMER_CODE  
  WHERE CANCELLED=0 AND cm_id LIKE @cCMID    
  ORDER BY CM_DT ,CM_NO    
 END    
END 
