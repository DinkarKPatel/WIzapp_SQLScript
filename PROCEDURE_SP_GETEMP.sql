CREATE PROCEDURE SP_GETEMP  
(  
 @CQUERYID  NUMERIC(2),    
 @CWHERE   VARCHAR(MAX)=''  
)  
--WITH ENCRYPTION

AS  
BEGIN  
  
 IF @CQUERYID=1   
  GOTO LBLLOOKUP  
 ELSE  
 IF @CQUERYID=2   
  GOTO LBLEMPMST   
 ELSE  
 IF @CQUERYID=3   
  GOTO LBLAREA   
 ELSE  
 IF @CQUERYID=4  
  GOTO LBLSETREFID  
 ELSE  
 IF @CQUERYID=5  
  GOTO LBLGETAREA  
 ELSE  
 IF @CQUERYID=6  
  GOTO LBLGETREFID  
 ELSE  
 IF @CQUERYID=7  
  GOTO LBLQBF  
 ELSE  
 IF @CQUERYID=8  
  GOTO LBLPRINT  
 ELSE  
GOTO LAST  
  
LBLLOOKUP:  
 SELECT EMP_ID ,REF_ID,REF_ID AS MST_MEMO_NO FROM EMP_MST     
    WHERE EMP_ID <> '0000000' ORDER BY REF_ID  
GOTO LAST  
  
LBLEMPMST:  
 SELECT T0.*, T3.AREA_NAME, T3.PINCODE,T4.CITY_CODE,T4.CITY,T5.STATE_CODE,         
 T5.STATE,          
 T10.AREA_NAME AS MAILING_AREA_NAME,T11.CITY_CODE AS MAILING_CITY_CODE,            
 T11.CITY AS MAILING_CITY,T12.STATE_CODE AS MAILING_STATE_CODE, T12.STATE AS MAILING_STATE,          
 T10.PINCODE AS MAILING_PINCODE,T13.USERNAME,   
 (B.DEPT_ID + '-' + B.DEPT_NAME) AS DEPT_NAME ,
  ISNULL(T6.DESIG_NAME,'') AS DESIG_NAME  ,T14.USERNAME AS REF_USERNAME     
 FROM EMP_MST T0         
 LEFT  JOIN AREA T3 ON T3.AREA_CODE = T0.AREA_CODE         
 LEFT JOIN CITY T4 ON T4.CITY_CODE = T3.CITY_CODE         
 LEFT JOIN STATE T5 ON T5.STATE_CODE = T4.STATE_CODE         
 LEFT JOIN AREA T10 ON T0.MAILING_AREA_CODE = T10.AREA_CODE         
 LEFT JOIN CITY T11 ON T11.CITY_CODE = T10.CITY_CODE         
 LEFT JOIN STATE T12 ON T11.STATE_CODE  = T12.STATE_CODE         
 LEFT JOIN USERS T13 ON T13.USER_CODE = T0.USER_CODE  
 LEFT JOIN USERS T14 ON T14.USER_CODE = T0.REF_USERCODE      
 LEFT JOIN LOCATION B ON T0.DEPT_ID=B.DEPT_ID 
 LEFT JOIN EMP_DESIG T6 ON T0.DESIG_ID = T6.DESIG_ID              
 WHERE T0.EMP_ID = @CWHERE  
GOTO LAST  
LBLAREA:  
  SELECT A.AREA_CODE, A.AREA_NAME, A.PINCODE, B.CITY, C.STATE FROM AREA A         
  JOIN CITY B ON A.CITY_CODE = B.CITY_CODE        
  JOIN STATE C ON B.STATE_CODE = C.STATE_CODE         
  WHERE A.AREA_NAME <> '' ORDER BY A.AREA_NAME  
GOTO LAST  
LBLSETREFID:  
 SELECT MAX(REF_ID) AS MAX_REF_ID FROM EMP_MST  
GOTO LAST  
  
LBLGETAREA:  
 SELECT A.AREA_NAME,A.AREA_CODE , A.PINCODE, B.CITY,        
  B.CITY_CODE, C.STATE,C.STATE_CODE FROM AREA A          
  JOIN  CITY B ON A.CITY_CODE=B.CITY_CODE        
  JOIN STATE C ON B.STATE_CODE=C.STATE_CODE         
  WHERE A.AREA_CODE = @CWHERE   
GOTO LAST   
  
LBLGETREFID:  
SELECT EMP_ID FROM EMP_MST WHERE REF_ID =@CWHERE   
GOTO LAST   
  
LBLQBF:  
 DECLARE @CQUERY NVARCHAR(MAX)  
 SET @CQUERY = N'SELECT EMP_ID,MST_REF_ID AS REF_ID FROM VW_EMPMASTER ' + @CWHERE + ''   
 EXEC SP_EXECUTESQL @CQUERY  
GOTO LAST  
  
LBLPRINT:  
SELECT * FROM VW_EMP WHERE EMP_ID = @CWHERE  
GOTO LAST  
  
LAST:  
  
END
