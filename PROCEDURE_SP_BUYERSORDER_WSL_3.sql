CREATE PROCEDURE SP_BUYERSORDER_WSL_3
@CMEMOID VARCHAR(40),  
@CWHERE VARCHAR(500),  
@CFINYEAR VARCHAR(10),  
@NNAVMODE NUMERIC(2,0),
@CARTICLECODE CHAR(9)='',  
@CPARA2CODE CHAR(7)='',
@DTWHERE DATETIME ='',
@cLocId VARCHAR(5)=''
--WITH ENCRYPTION
 
AS    
BEGIN 

	-----------------CHANGE

	  SELECT ROW_ID =CAST('' AS VARCHAR(100)),CAST(0 AS NUMERIC(14,2)) AS FC_NET,CAST(0 AS NUMERIC(14,2)) AS FC_GST_PERCENTAGE,CAST(0 AS INT) AS FC_TAX_METHOD,CAST(0 AS BIT) AS IS_IGST,
	       CAST(0 AS NUMERIC(14,2)) AS FC_XN_VALUE_WITHOUT_GST,CAST(0 AS NUMERIC(10,2)) AS FC_IGST_AMOUNT,CAST(0 AS NUMERIC(10,2)) AS FC_CGST_AMOUNT,
		   CAST(0 AS NUMERIC(10,2)) AS FC_SGST_AMOUNT,CAST(0 AS NUMERIC(14,2)) AS FC_XN_VALUE_WITH_GST
	   INTO #TMPFCRATE
	 WHERE 1=2

	IF EXISTS ( SELECT 1 'U' FROM CONFIG WHERE CONFIG_OPTION='ENABLE_MULTI_CURRENCY' AND VALUE='1')
	begin
	      
		  EXEC SP3S_CALCULATE_FCNET_WSLORD @CMEMOID, 1
	    		
	end
	


   IF  EXISTS(select top 1 COLUMN_NAME from CONFIG_BUYERORDER where COLUMN_NAME = 'PRODUCT_CODE' AND OPEN_KEY =1)	
   BEGIN
         

		IF OBJECT_ID('TEMPDB..#TMPBO','U') IS NOT NULL
		DROP TABLE #TMPBO

        SELECT R.AC_CODE, B.ARTICLE_NAME,A.*,  0 AS SERIAL_NO,    
		B.ARTICLE_NO,C.PARA1_NAME,D.PARA2_NAME,D.PARA2_ORDER,C.PARA1_ORDER ,  E.PARA3_NAME,
		(A.QUANTITY * A.WS_PRICE) AS AMOUNT,B.UOM_CODE,UOM.UOM_NAME,UOM.UOM_TYPE,B.DT_CREATED  
		,B.CODING_SCHEME,B.PARA1_SET,B.PARA2_SET, B.ALIAS AS ARTICLE_ALIAS,
		'' as  ITEM_EMP_NAME,
		EMP1.EMP_NAME AS ITEM_MERCHANT_NAME ,
		-- ISNULL(WPS.WPS_QTY,0) AS WPS_QTY,
		SR=ROW_NUMBER() OVER (PARTITION BY A.ORDER_ID, A.ARTICLE_CODE,R.AC_CODE,A.PARA1_CODE,A.PARA2_CODE,A.PARA3_CODE,A.PARA4_CODE,
		A.PARA5_CODE,A.PARA6_CODE ORDER BY A. TS ),
		F.PARA4_NAME,
		G.PARA5_NAME,
		H.PARA6_NAME,sd.sub_section_name ,sm.section_name ,Angadia_name,fc_name,
		(FROM_UOM_NAME+ ' - ' +TO_UOM_NAME) AS AREA_UOM_NAME,
			ISNULL(AR_UOM.SQUARE_UNIT,0) AS SQUARE_UNIT,
			ISNULL(AR_UOM.BASE_UNIT,0) AS BASE_UNIT,
			ISNULL(AR_UOM.FROM_UOM_NAME,'''') AS FROM_UOM_NAME,
			ISNULL(AR_UOM.TO_UOM_NAME,'''') AS TO_UOM_NAME,I.PARA7_NAME 
			
			
			INTO #TMPBO
		FROM BUYER_ORDER_DET A  (NOLOCK) 
		JOIN SKU S ON A.PRODUCT_CODE   = S.product_code
		JOIN ARTICLE B (NOLOCK)  ON S.ARTICLE_CODE = B.ARTICLE_CODE 
		join Sectiond sd (nolock) on  sd.sub_section_code =B.sub_section_code 
		join Sectionm sm (nolock) on  sm.section_code=  sd.SECTION_CODE 
		LEFT OUTER JOIN PARA1 C (NOLOCK)  ON S.PARA1_CODE = C.PARA1_CODE      
		LEFT OUTER JOIN PARA2 D (NOLOCK)  ON s.PARA2_CODE = D.PARA2_CODE  
		LEFT OUTER JOIN PARA3 E (NOLOCK)  ON s.PARA3_CODE = E.PARA3_CODE
		LEFT OUTER JOIN PARA4 F (NOLOCK)  ON s.PARA4_CODE = F.PARA4_CODE
		LEFT OUTER JOIN PARA5 G (NOLOCK)  ON s.PARA5_CODE = G.PARA5_CODE
		LEFT OUTER JOIN PARA6 H (NOLOCK)  ON s.PARA6_CODE = H.PARA6_CODE  
		LEFT OUTER JOIN PARA7 I (NOLOCK)  ON s.PARA7_CODE = I.PARA7_CODE  
		JOIN UOM (NOLOCK) ON UOM.UOM_CODE=B.UOM_CODE         
		JOIN BUYER_ORDER_MST R ON R.ORDER_ID= A.ORDER_ID 
		--LEFT OUTER JOIN EMPLOYEE EMP (NOLOCK) ON EMP.EMP_CODE=A.ITEM_EMP_CODE   
		LEFT OUTER JOIN EMPLOYEE EMP1 (NOLOCK) ON EMP1.EMP_CODE=A.ITEM_MERCHANT_CODE  
		LEFT OUTER JOIN ANGM ANG (NOLOCK) ON ANG.Angadia_code=A.Angadia_code
		LEFT OUTER JOIN FC  (NOLOCK) ON FC.fc_code=A.FC_CODE
		LEFT OUTER JOIN STANDARD_UOM AR_UOM (NOLOCK) ON A.AREA_UOM_CODE= AR_UOM.UOM_CODE 
		WHERE A.ORDER_ID = @CMEMOID 


		IF OBJECT_ID('TEMPDB..#TMPWSP','U') IS NOT NULL
		DROP TABLE #TMPWSP

	SELECT B.AC_CODE, A.ORDER_ID,A.BO_DET_ROW_ID,
	--,A.PACKSLIP_ARTICLE_CODE, A.PACKSLIP_PARA1_CODE, A.PACKSLIP_PARA2_CODE,
	SUM(QUANTITY) AS WPS_QTY
	INTO #TMPWSP
	FROM WPS_DET A
	JOIN WPS_MST B ON A.PS_ID=B.PS_ID
	WHERE B.CANCELLED=0 AND A.ORDER_ID<>''
	AND A.ORDER_ID=@CMEMOID
	GROUP BY B.AC_CODE,A.ORDER_ID,A.BO_DET_ROW_ID
	--A.PACKSLIP_ARTICLE_CODE , A.PACKSLIP_PARA1_CODE, A.PACKSLIP_PARA2_CODE

	SELECT A.ARTICLE_NAME,A.ORDER_ID,A.PARA1_CODE,A.PARA2_CODE,A.QUANTITY
	,A.ROW_ID,A.LAST_UPDATE,A.WS_PRICE,A.RFNET,A.ARTICLE_CODE
	,A.GROSS_WSP,A.DISCOUNT_PERCENTAGE,A.DISCOUNT_AMOUNT,A.REMARKS
	,A.PRODUCT_CODE,A.MANUAL_DISCOUNT,A.PARA3_CODE,A.ONLINE_PRODUCT_CODE
	,A.ITEM_EMP_CODE,A.ITEM_MERCHANT_CODE,A.SERIAL_NO,A.ARTICLE_NO,A.PARA1_NAME,
	A.PARA2_NAME,A.PARA2_ORDER,A.PARA1_ORDER,A.PARA3_NAME,A.AMOUNT,A.UOM_CODE,A.UOM_NAME,A.UOM_TYPE
	,A.DT_CREATED,A.CODING_SCHEME,A.PARA1_SET,A.PARA2_SET,A.ARTICLE_ALIAS,A.ITEM_EMP_NAME,
	A.ITEM_MERCHANT_NAME,A.ADJ_QTY,A.SR_NO,A.HSN_CODE,A.GST_PERCENTAGE ,A.XN_VALUE_WITHOUT_GST ,A.XN_VALUE_WITH_GST ,
	A.IGST_AMOUNT ,A.CGST_AMOUNT ,A.SGST_AMOUNT ,
	A.SR,
	A.QUANTITY AS CUMM_SUM,
	ISNULL(WPS.WPS_QTY,0) AS WPS_QTY, (A.QUANTITY-ISNULL(WPS.WPS_QTY,0)) AS PEND_QTY,
	CASE WHEN  (A.QUANTITY-ISNULL(WPS.WPS_QTY,0)) =0 THEN 2
		WHEN  (A.QUANTITY-ISNULL(WPS.WPS_QTY,0)) >0 AND (A.QUANTITY-ISNULL(WPS.WPS_QTY,0))<> A.QUANTITY THEN 1
		ELSE 0 END AS  TYPE,
	CAST(0 AS INT) AS SP_ID,A.TS,A.GROSS_QUANTITY,A.PL_QTY,A.INV_QTY,
	A.PARA4_CODE ,A.PARA4_NAME ,
	A.PARA5_CODE ,A.PARA5_NAME ,
	A.PARA6_CODE ,A.PARA6_NAME, sub_section_name ,section_name
	,ISNULL(A1.ATTR1_KEY_NAME,'') as ATTR1_KEY_NAME   ,ISNULL(A2.ATTR2_KEY_NAME,'')  as ATTR2_KEY_NAME
	,ISNULL(A3.ATTR3_KEY_NAME,'') as ATTR3_KEY_NAME  ,ISNULL(A4.ATTR4_KEY_NAME,'') as ATTR4_KEY_NAME
	,ISNULL(A5.ATTR5_KEY_NAME,'') as ATTR5_KEY_NAME,ISNULL(A6.ATTR6_KEY_NAME,'') as ATTR6_KEY_NAME
	,ISNULL(A7.ATTR7_KEY_NAME,'')  ATTR7_KEY_NAME ,ISNULL(A8.ATTR8_KEY_NAME,'')  ATTR8_KEY_NAME
	,ISNULL(A9.ATTR9_KEY_NAME,'')  ATTR9_KEY_NAME ,ISNULL(A10.ATTR10_KEY_NAME,'') ATTR10_KEY_NAME
	,ISNULL(A11.ATTR11_KEY_NAME,'') ATTR11_KEY_NAME,ISNULL(A12.ATTR12_KEY_NAME,'') ATTR12_KEY_NAME
	,ISNULL(A13.ATTR13_KEY_NAME,'') ATTR13_KEY_NAME ,ISNULL(A14.ATTR14_KEY_NAME,'') ATTR14_KEY_NAME
	,ISNULL(A15.ATTR15_KEY_NAME,'') ATTR15_KEY_NAME     
	,ISNULL(A16.ATTR16_KEY_NAME,'') ATTR16_KEY_NAME,ISNULL(A17.ATTR17_KEY_NAME,'') ATTR17_KEY_NAME
	,ISNULL(A18.ATTR18_KEY_NAME,'') ATTR18_KEY_NAME,ISNULL(A19.ATTR19_KEY_NAME,'') ATTR19_KEY_NAME
	,ISNULL(A20.ATTR20_KEY_NAME,'')  ATTR20_KEY_NAME  ,ISNULL(A21.ATTR21_KEY_NAME,'') ATTR21_KEY_NAME
	 ,ISNULL(A22.ATTR22_KEY_NAME,'') as ATTR22_KEY_NAME,ISNULL(A23.ATTR23_KEY_NAME,'') as ATTR23_KEY_NAME
	 ,ISNULL(A24.ATTR24_KEY_NAME,'') ATTR24_KEY_NAME,ISNULL(A25.ATTR25_KEY_NAME,'')  ATTR25_KEY_NAME     	  
	 ,a.ATTR1_KEY_CODE,a.ATTR2_KEY_CODE,a.ATTR3_KEY_CODE,a.ATTR4_KEY_CODE,a.ATTR5_KEY_CODE
     ,a.ATTR6_KEY_CODE,a.ATTR7_KEY_CODE,a.ATTR8_KEY_CODE,a.ATTR9_KEY_CODE,a.ATTR10_KEY_CODE
	 ,a.ATTR11_KEY_CODE,a.ATTR12_KEY_CODE,a.ATTR13_KEY_CODE,a.ATTR14_KEY_CODE,a.ATTR15_KEY_CODE
     ,a.ATTR16_KEY_CODE,a.ATTR17_KEY_CODE,a.ATTR18_KEY_CODE,a.ATTR19_KEY_CODE,a.ATTR20_KEY_CODE
     ,a.ATTR21_KEY_CODE,a.ATTR22_KEY_CODE,a.ATTR23_KEY_CODE,a.ATTR24_KEY_CODE,a.ATTR25_KEY_CODE
     ,a.SUB_SECTION_CODE,a.SECTION_CODE,a.From_mrp,a.to_mrp,A.Gst_Cess_Amount ,A.Gst_Cess_Percentage 
	 ,Angadia_name,fc_name,A.Angadia_code,fc_code,item_delivery_dt,po_qty,0 box_no, manual_rate,0 pi_qty,
	 A.AREA_UOM_NAME,		A. SQUARE_UNIT,			A. BASE_UNIT,		A.FROM_UOM_NAME,			A.TO_UOM_NAME,
	 area_length,area_width,area_sqare,area_rate_pp,RATE_AREA_SQUARE,area_uom_code,
	TMP.FC_NET,TMP.FC_XN_VALUE_WITHOUT_GST,TMP.FC_IGST_AMOUNT,TMP.FC_CGST_AMOUNT,TMP.FC_SGST_AMOUNT,TMP.FC_XN_VALUE_WITH_GST,A.PARA7_NAME,A.PARA7_CODE 
	,A.replaceable_para1_code,a.tax_round_off,A.AutoRate
	FROM #TMPBO A
	LEFT JOIN #TMPFCRATE TMP ON TMP.ROW_id=a.row_id
	LEFT JOIN #TMPWSP WPS ON A.ORDER_ID=WPS.ORDER_ID
	AND A.AC_CODE=WPS.AC_CODE AND A.ROW_ID=WPS.BO_DET_ROW_ID 
	LEFT JOIN ATTR1_MST A1 (NOLOCK) ON A1.ATTR1_KEY_CODE=a.attr1_KEY_CODE      
	LEFT JOIN ATTR2_MST A2 (NOLOCK) ON A2.ATTR2_KEY_CODE=a.attr2_KEY_CODE      
	LEFT JOIN ATTR3_MST A3 (NOLOCK) ON A3.ATTR3_KEY_CODE=a.attr3_KEY_CODE      
	LEFT JOIN ATTR4_MST A4 (NOLOCK) ON A4.ATTR4_KEY_CODE=a.attr4_KEY_CODE      
	LEFT JOIN ATTR5_MST A5 (NOLOCK) ON A5.ATTR5_KEY_CODE=a.attr5_KEY_CODE      
	LEFT JOIN ATTR6_MST A6 (NOLOCK) ON A6.ATTR6_KEY_CODE=a.attr6_KEY_CODE      
	LEFT JOIN ATTR7_MST A7 (NOLOCK) ON A7.ATTR7_KEY_CODE=a.attr7_KEY_CODE      
	LEFT JOIN ATTR8_MST A8 (NOLOCK) ON A8.ATTR8_KEY_CODE=a.attr8_KEY_CODE      
	LEFT JOIN ATTR9_MST A9 (NOLOCK) ON A9.ATTR9_KEY_CODE=a.attr9_KEY_CODE      
	LEFT JOIN ATTR10_MST A10 (NOLOCK) ON A10.ATTR10_KEY_CODE=a.attr10_KEY_CODE      
	LEFT JOIN ATTR11_MST A11 (NOLOCK) ON A11.ATTR11_KEY_CODE=a.attr11_KEY_CODE      
	LEFT JOIN ATTR12_MST A12 (NOLOCK) ON A12.ATTR12_KEY_CODE=a.attr12_KEY_CODE      
	LEFT JOIN ATTR13_MST A13 (NOLOCK) ON A13.ATTR13_KEY_CODE=a.attr13_KEY_CODE      
	LEFT JOIN ATTR14_MST A14 (NOLOCK) ON A14.ATTR14_KEY_CODE=a.attr14_KEY_CODE      
	LEFT JOIN ATTR15_MST A15 (NOLOCK) ON A15.ATTR15_KEY_CODE=a.attr15_KEY_CODE      
	LEFT JOIN ATTR16_MST A16 (NOLOCK) ON A16.ATTR16_KEY_CODE=a.attr16_KEY_CODE      
	LEFT JOIN ATTR17_MST A17 (NOLOCK) ON A17.ATTR17_KEY_CODE=a.attr17_KEY_CODE      
	LEFT JOIN ATTR18_MST A18 (NOLOCK) ON A18.ATTR18_KEY_CODE=a.attr18_KEY_CODE      
	LEFT JOIN ATTR19_MST A19 (NOLOCK) ON A19.ATTR19_KEY_CODE=a.attr19_KEY_CODE      
	LEFT JOIN ATTR20_MST A20 (NOLOCK) ON A20.ATTR20_KEY_CODE=a.attr20_KEY_CODE      
	LEFT JOIN ATTR21_MST A21 (NOLOCK) ON A21.ATTR21_KEY_CODE=a.attr21_KEY_CODE      
	LEFT JOIN ATTR22_MST A22 (NOLOCK) ON A22.ATTR22_KEY_CODE=a.attr22_KEY_CODE      
	LEFT JOIN ATTR23_MST A23 (NOLOCK) ON A23.ATTR23_KEY_CODE=a.attr23_KEY_CODE      
	LEFT JOIN ATTR24_MST A24 (NOLOCK) ON A24.ATTR24_KEY_CODE=a.attr24_KEY_CODE      
	LEFT JOIN ATTR25_MST A25 (NOLOCK) ON A25.ATTR25_KEY_CODE=a.ATTR25_KEY_CODE 
	ORDER BY A.SR_NO,A.TS


		END
 ELSE
 BEGIN

       
    SELECT R.AC_CODE, B.ARTICLE_NAME,A.*,  0 AS SERIAL_NO,    
	B.ARTICLE_NO,C.PARA1_NAME,D.PARA2_NAME,D.PARA2_ORDER,C.PARA1_ORDER ,  E.PARA3_NAME,
	(A.QUANTITY * A.WS_PRICE) AS AMOUNT,B.UOM_CODE,UOM.UOM_NAME,UOM.UOM_TYPE,B.DT_CREATED  
	,B.CODING_SCHEME,B.PARA1_SET,B.PARA2_SET, B.ALIAS AS ARTICLE_ALIAS,
	EMP.EMP_NAME AS ITEM_EMP_NAME,
	EMP1.EMP_NAME AS ITEM_MERCHANT_NAME ,
	-- ISNULL(WPS.WPS_QTY,0) AS WPS_QTY,
	SR=ROW_NUMBER() OVER (PARTITION BY A.ORDER_ID, A.ARTICLE_CODE,R.AC_CODE,A.PARA1_CODE,A.PARA2_CODE,
	A.PARA3_CODE,A.PARA4_CODE,A.PARA5_CODE,A.PARA6_CODE ORDER BY A. TS ),
	F.PARA4_NAME,
	G.PARA5_NAME,
	H.PARA6_NAME,sd.sub_section_name ,sm.section_name  ,Angadia_name,fc_name ,
	(FROM_UOM_NAME+ ' - ' +TO_UOM_NAME) AS AREA_UOM_NAME,
			ISNULL(AR_UOM.SQUARE_UNIT,0) AS SQUARE_UNIT,
			ISNULL(AR_UOM.BASE_UNIT,0) AS BASE_UNIT,
			ISNULL(AR_UOM.FROM_UOM_NAME,'''') AS FROM_UOM_NAME,
			ISNULL(AR_UOM.TO_UOM_NAME,'''') AS TO_UOM_NAME,I.para7_name
	INTO #TMPBO1
	FROM BUYER_ORDER_DET A  (NOLOCK)   
	JOIN ARTICLE B (NOLOCK)  ON A.ARTICLE_CODE = B.ARTICLE_CODE     
	join Sectiond sd (nolock) on  sd.sub_section_code =CASE WHEN A.SUB_SECTION_CODE <>'0000000' THEN A.SUB_SECTION_CODE ELSE B.SUB_SECTION_CODE END
	join Sectionm sm (nolock) on  sm.section_code= CASE WHEN A.SECTION_CODE <>'0000000' THEN A.SECTION_CODE ELSE sd.SECTION_CODE END
	LEFT OUTER JOIN PARA1 C (NOLOCK)  ON A.PARA1_CODE = C.PARA1_CODE      
	LEFT OUTER JOIN PARA2 D (NOLOCK)  ON A.PARA2_CODE = D.PARA2_CODE  
	LEFT OUTER JOIN PARA3 E (NOLOCK)  ON A.PARA3_CODE = E.PARA3_CODE
	LEFT OUTER JOIN PARA4 F (NOLOCK)  ON A.PARA4_CODE = F.PARA4_CODE
	LEFT OUTER JOIN PARA5 G (NOLOCK)  ON A.PARA5_CODE = G.PARA5_CODE
	LEFT OUTER JOIN PARA6 H (NOLOCK)  ON A.PARA6_CODE = H.PARA6_CODE  
	LEFT OUTER JOIN PARA7 I (NOLOCK)  ON A.PARA7_CODE = I.PARA7_CODE  
	JOIN UOM (NOLOCK) ON UOM.UOM_CODE=B.UOM_CODE         
	JOIN BUYER_ORDER_MST R ON R.ORDER_ID= A.ORDER_ID 
	LEFT OUTER JOIN EMPLOYEE EMP (NOLOCK) ON EMP.EMP_CODE=A.ITEM_EMP_CODE   
	LEFT OUTER JOIN EMPLOYEE EMP1 (NOLOCK) ON EMP1.EMP_CODE=A.ITEM_MERCHANT_CODE  
	LEFT OUTER JOIN ANGM ANG (NOLOCK) ON ANG.Angadia_code=A.Angadia_code
	LEFT OUTER JOIN FC  (NOLOCK) ON FC.fc_code=A.FC_CODE
	 LEFT OUTER JOIN STANDARD_UOM AR_UOM (NOLOCK) ON A.AREA_UOM_CODE= AR_UOM.UOM_CODE 
	 WHERE A.ORDER_ID = @CMEMOID 


	IF OBJECT_ID('TEMPDB..#TMPWSP1','U') IS NOT NULL
		DROP TABLE #TMPWSP1

	SELECT B.AC_CODE, A.ORDER_ID,A.BO_DET_ROW_ID,
	--,A.PACKSLIP_ARTICLE_CODE, A.PACKSLIP_PARA1_CODE, A.PACKSLIP_PARA2_CODE,
	SUM(QUANTITY) AS WPS_QTY
	INTO #TMPWSP1
	FROM WPS_DET A
	JOIN WPS_MST B ON A.PS_ID=B.PS_ID
	WHERE B.CANCELLED=0 AND A.ORDER_ID<>''
	AND A.ORDER_ID=@CMEMOID
	GROUP BY B.AC_CODE,A.ORDER_ID,A.BO_DET_ROW_ID
	--A.PACKSLIP_ARTICLE_CODE , A.PACKSLIP_PARA1_CODE, A.PACKSLIP_PARA2_CODE

	SELECT A.ARTICLE_NAME,A.ORDER_ID,A.PARA1_CODE,A.PARA2_CODE,A.QUANTITY
	,A.ROW_ID,A.LAST_UPDATE,A.WS_PRICE,A.RFNET,A.ARTICLE_CODE
	,A.GROSS_WSP,A.DISCOUNT_PERCENTAGE,A.DISCOUNT_AMOUNT,A.REMARKS
	,A.PRODUCT_CODE,A.MANUAL_DISCOUNT,A.PARA3_CODE,A.ONLINE_PRODUCT_CODE
	,A.ITEM_EMP_CODE,A.ITEM_MERCHANT_CODE,A.SERIAL_NO,A.ARTICLE_NO,A.PARA1_NAME,
	A.PARA2_NAME,A.PARA2_ORDER,A.PARA1_ORDER,A.PARA3_NAME,A.AMOUNT,A.UOM_CODE,A.UOM_NAME,A.UOM_TYPE
	,A.DT_CREATED,A.CODING_SCHEME,A.PARA1_SET,A.PARA2_SET,A.ARTICLE_ALIAS,A.ITEM_EMP_NAME,
	A.ITEM_MERCHANT_NAME,A.ADJ_QTY,A.SR_NO,A.HSN_CODE,A.GST_PERCENTAGE ,A.XN_VALUE_WITHOUT_GST ,A.XN_VALUE_WITH_GST ,
	A.IGST_AMOUNT ,A.CGST_AMOUNT ,A.SGST_AMOUNT ,
	A.SR,
	A.QUANTITY AS CUMM_SUM,
	ISNULL(WPS.WPS_QTY,0) AS WPS_QTY, (A.QUANTITY-ISNULL(WPS.WPS_QTY,0)) AS PEND_QTY,
	CASE WHEN  (A.QUANTITY-ISNULL(WPS.WPS_QTY,0)) =0 THEN 2
		WHEN  (A.QUANTITY-ISNULL(WPS.WPS_QTY,0)) >0 AND (A.QUANTITY-ISNULL(WPS.WPS_QTY,0))<> A.QUANTITY THEN 1
		ELSE 0 END AS  TYPE,
	CAST(0 AS INT) AS SP_ID,A.TS,A.GROSS_QUANTITY,A.PL_QTY,A.INV_QTY,
	A.PARA4_CODE ,A.PARA4_NAME ,
	A.PARA5_CODE ,A.PARA5_NAME ,
	A.PARA6_CODE ,A.PARA6_NAME, sub_section_name ,section_name
	,ISNULL(A1.ATTR1_KEY_NAME,'') as ATTR1_KEY_NAME   ,ISNULL(A2.ATTR2_KEY_NAME,'')  as ATTR2_KEY_NAME
	,ISNULL(A3.ATTR3_KEY_NAME,'') as ATTR3_KEY_NAME  ,ISNULL(A4.ATTR4_KEY_NAME,'') as ATTR4_KEY_NAME
	,ISNULL(A5.ATTR5_KEY_NAME,'') as ATTR5_KEY_NAME,ISNULL(A6.ATTR6_KEY_NAME,'') as ATTR6_KEY_NAME
	,ISNULL(A7.ATTR7_KEY_NAME,'')  ATTR7_KEY_NAME ,ISNULL(A8.ATTR8_KEY_NAME,'')  ATTR8_KEY_NAME
	,ISNULL(A9.ATTR9_KEY_NAME,'')  ATTR9_KEY_NAME ,ISNULL(A10.ATTR10_KEY_NAME,'') ATTR10_KEY_NAME
	,ISNULL(A11.ATTR11_KEY_NAME,'') ATTR11_KEY_NAME,ISNULL(A12.ATTR12_KEY_NAME,'') ATTR12_KEY_NAME
	,ISNULL(A13.ATTR13_KEY_NAME,'') ATTR13_KEY_NAME ,ISNULL(A14.ATTR14_KEY_NAME,'') ATTR14_KEY_NAME
	,ISNULL(A15.ATTR15_KEY_NAME,'') ATTR15_KEY_NAME     
	,ISNULL(A16.ATTR16_KEY_NAME,'') ATTR16_KEY_NAME,ISNULL(A17.ATTR17_KEY_NAME,'') ATTR17_KEY_NAME
	,ISNULL(A18.ATTR18_KEY_NAME,'') ATTR18_KEY_NAME,ISNULL(A19.ATTR19_KEY_NAME,'') ATTR19_KEY_NAME
	,ISNULL(A20.ATTR20_KEY_NAME,'')  ATTR20_KEY_NAME  ,ISNULL(A21.ATTR21_KEY_NAME,'') ATTR21_KEY_NAME
	 ,ISNULL(A22.ATTR22_KEY_NAME,'') as ATTR22_KEY_NAME,ISNULL(A23.ATTR23_KEY_NAME,'') as ATTR23_KEY_NAME
	 ,ISNULL(A24.ATTR24_KEY_NAME,'') ATTR24_KEY_NAME,ISNULL(A25.ATTR25_KEY_NAME,'')  ATTR25_KEY_NAME     	  
	 ,a.ATTR1_KEY_CODE,a.ATTR2_KEY_CODE,a.ATTR3_KEY_CODE,a.ATTR4_KEY_CODE,a.ATTR5_KEY_CODE
     ,a.ATTR6_KEY_CODE,a.ATTR7_KEY_CODE,a.ATTR8_KEY_CODE,a.ATTR9_KEY_CODE,a.ATTR10_KEY_CODE
	 ,a.ATTR11_KEY_CODE,a.ATTR12_KEY_CODE,a.ATTR13_KEY_CODE,a.ATTR14_KEY_CODE,a.ATTR15_KEY_CODE
     ,a.ATTR16_KEY_CODE,a.ATTR17_KEY_CODE,a.ATTR18_KEY_CODE,a.ATTR19_KEY_CODE,a.ATTR20_KEY_CODE
     ,a.ATTR21_KEY_CODE,a.ATTR22_KEY_CODE,a.ATTR23_KEY_CODE,a.ATTR24_KEY_CODE,a.ATTR25_KEY_CODE
     ,a.SUB_SECTION_CODE,a.SECTION_CODE,a.From_mrp,a.to_mrp,A.Gst_Cess_Amount ,A.Gst_Cess_Percentage 
	  ,Angadia_name,fc_name,A.Angadia_code,fc_code,item_delivery_dt,po_qty,0 box_no,
	   manual_rate,0 pi_qty, A.AREA_UOM_NAME,		A. SQUARE_UNIT,			A. BASE_UNIT,		A.FROM_UOM_NAME,			A.TO_UOM_NAME,
	  area_length,area_width,area_sqare,area_rate_pp,RATE_AREA_SQUARE,area_uom_code,
      TMP.FC_NET,TMP.FC_XN_VALUE_WITHOUT_GST,TMP.FC_IGST_AMOUNT,TMP.FC_CGST_AMOUNT,TMP.FC_SGST_AMOUNT,TMP.FC_XN_VALUE_WITH_GST,
	  A.para7_code,A.PARA7_NAME,A.replaceable_para1_code,a.tax_round_off,A.AutoRate
	FROM #TMPBO1 A
	LEFT JOIN #TMPWSP1 WPS ON A.ORDER_ID=WPS.ORDER_ID AND A.AC_CODE=WPS.AC_CODE 
	AND A.ROW_ID=WPS.BO_DET_ROW_ID 
	LEFT JOIN #TMPFCRATE TMP ON TMP.ROW_id=a.row_id	
	LEFT JOIN ATTR1_MST A1 (NOLOCK) ON A1.ATTR1_KEY_CODE=a.attr1_KEY_CODE      
	LEFT JOIN ATTR2_MST A2 (NOLOCK) ON A2.ATTR2_KEY_CODE=a.attr2_KEY_CODE      
	LEFT JOIN ATTR3_MST A3 (NOLOCK) ON A3.ATTR3_KEY_CODE=a.attr3_KEY_CODE      
	LEFT JOIN ATTR4_MST A4 (NOLOCK) ON A4.ATTR4_KEY_CODE=a.attr4_KEY_CODE      
	LEFT JOIN ATTR5_MST A5 (NOLOCK) ON A5.ATTR5_KEY_CODE=a.attr5_KEY_CODE      
	LEFT JOIN ATTR6_MST A6 (NOLOCK) ON A6.ATTR6_KEY_CODE=a.attr6_KEY_CODE      
	LEFT JOIN ATTR7_MST A7 (NOLOCK) ON A7.ATTR7_KEY_CODE=a.attr7_KEY_CODE      
	LEFT JOIN ATTR8_MST A8 (NOLOCK) ON A8.ATTR8_KEY_CODE=a.attr8_KEY_CODE      
	LEFT JOIN ATTR9_MST A9 (NOLOCK) ON A9.ATTR9_KEY_CODE=a.attr9_KEY_CODE      
	LEFT JOIN ATTR10_MST A10 (NOLOCK) ON A10.ATTR10_KEY_CODE=a.attr10_KEY_CODE      
	LEFT JOIN ATTR11_MST A11 (NOLOCK) ON A11.ATTR11_KEY_CODE=a.attr11_KEY_CODE      
	LEFT JOIN ATTR12_MST A12 (NOLOCK) ON A12.ATTR12_KEY_CODE=a.attr12_KEY_CODE      
	LEFT JOIN ATTR13_MST A13 (NOLOCK) ON A13.ATTR13_KEY_CODE=a.attr13_KEY_CODE      
	LEFT JOIN ATTR14_MST A14 (NOLOCK) ON A14.ATTR14_KEY_CODE=a.attr14_KEY_CODE      
	LEFT JOIN ATTR15_MST A15 (NOLOCK) ON A15.ATTR15_KEY_CODE=a.attr15_KEY_CODE      
	LEFT JOIN ATTR16_MST A16 (NOLOCK) ON A16.ATTR16_KEY_CODE=a.attr16_KEY_CODE      
	LEFT JOIN ATTR17_MST A17 (NOLOCK) ON A17.ATTR17_KEY_CODE=a.attr17_KEY_CODE      
	LEFT JOIN ATTR18_MST A18 (NOLOCK) ON A18.ATTR18_KEY_CODE=a.attr18_KEY_CODE      
	LEFT JOIN ATTR19_MST A19 (NOLOCK) ON A19.ATTR19_KEY_CODE=a.attr19_KEY_CODE      
	LEFT JOIN ATTR20_MST A20 (NOLOCK) ON A20.ATTR20_KEY_CODE=a.attr20_KEY_CODE      
	LEFT JOIN ATTR21_MST A21 (NOLOCK) ON A21.ATTR21_KEY_CODE=a.attr21_KEY_CODE      
	LEFT JOIN ATTR22_MST A22 (NOLOCK) ON A22.ATTR22_KEY_CODE=a.attr22_KEY_CODE      
	LEFT JOIN ATTR23_MST A23 (NOLOCK) ON A23.ATTR23_KEY_CODE=a.attr23_KEY_CODE      
	LEFT JOIN ATTR24_MST A24 (NOLOCK) ON A24.ATTR24_KEY_CODE=a.attr24_KEY_CODE      
	LEFT JOIN ATTR25_MST A25 (NOLOCK) ON A25.ATTR25_KEY_CODE=a.ATTR25_KEY_CODE 
	ORDER BY  article_no,para1_name,para2_order, para2_name, A.SR_NO,A.TS

	END

	
END		

