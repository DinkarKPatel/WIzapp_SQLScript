CREATE PROCEDURE USP_GP_ISSUE_PRINT
(
 @CMEMO_ID VARCHAR(50) = ''
)
AS
  BEGIN
		SELECT CHK,MEMO_ID,MEMO_NO,INV_ID
		  ,INV_NO,INV_DT,AC_NAME,QUANTITY
		  ,[WEIGHT],TOTAL_BOXES
		  ,FIN_YEAR,USER_CODE,LAST_UPDATE,EDT_USER_CODE
		  ,[REMARKS_MST],[REMARKS_DET],HANDOVER_USER_CODE
		  ,HANDOVER_LAST_UPDATE
		  ,ISNULL(LTRIM(RTRIM(ANGADIA_ADD1)),'')+' '+ISNULL(LTRIM(RTRIM(ANGADIA_ADD2)),'')+' ' 
		  + ISNULL(LTRIM(RTRIM(AREA_NAME)),'')+' '+ISNULL(LTRIM(RTRIM(CITY)),'')
		  AS [ADDRESS],DELIVERED_BY,[TRANSPOTER NAME], [MEMO_DT],[WAY_BILL],[LMVCITY]
	       FROM 
	       (
			SELECT 1 AS CHK,GPD.MEMO_ID,GPM.MEMO_NO,GPD.INV_ID
				  ,INM.INV_NO,INM.INV_DT,LM.AC_NAME
				  ,CAST(SUM(IND.QUANTITY) AS NUMERIC(10,2))AS QUANTITY
				  ,PRb.QTY AS [WEIGHT],0 as TOTAL_BOXES
				  ,GPM.FIN_YEAR,GPM.USER_CODE,GPM.LAST_UPDATE,GPM.EDT_USER_CODE
				  ,GPM.REMARKS AS [REMARKS_MST],GPD.REMARKS AS [REMARKS_DET],GPM.HANDOVER_USER_CODE
				  ,HANDOVER_LAST_UPDATE,AGM.ANGADIA_ADD1,AGM.ANGADIA_ADD2,AR.AREA_NAME,CT.CITY
				  ,GPM.DELIVERED_BY,AGM.ANGADIA_NAME AS [TRANSPOTER NAME]
				  ,GPM.MEMO_DT AS [MEMO_DT],INM.WAY_BILL,LM.CITY AS [LMVCITY]
			FROM DBO.TBL_GP_ISSUE_MST GPM WITH(NOLOCK)
				JOIN DBO.TBL_GP_ISSUE_DET GPD WITH(NOLOCK) ON GPM.MEMO_ID=GPD.MEMO_ID
				JOIN IND01106 IND WITH(NOLOCK) ON GPD.INV_ID=IND.INV_ID
				JOIN INM01106 INM WITH(NOLOCK) ON IND.INV_ID=INM.INV_ID
				JOIN PARCEL_DET PRB WITH(NOLOCK) ON INM.INV_ID=PRB.REF_MEMO_ID
				JOIN PARCEL_MST PRM WITH(NOLOCK) ON PRB.PARCEL_MEMO_ID=PRM.PARCEL_MEMO_ID
				JOIN LMV01106 LM WITH(NOLOCK) ON INM.AC_CODE=LM.AC_CODE
				JOIN DBO.ANGM AGM WITH(NOLOCK) ON PRM.ANGADIA_CODE=AGM.ANGADIA_CODE
				JOIN DBO.AREA AR WITH(NOLOCK) ON AGM.AREA_CODE=AR.AREA_CODE
				JOIN DBO.CITY CT WITH(NOLOCK) ON AR.CITY_CODE=CT.CITY_CODE
		    WHERE (@CMEMO_ID  = '' OR GPM.MEMO_ID=@CMEMO_ID)
			GROUP BY GPD.MEMO_ID,GPD.INV_ID,GPD.REMARKS
				  ,INM.INV_NO,INM.INV_DT,LM.AC_NAME
				  ,PRb.QTY
				  ,GPM.FIN_YEAR,GPM.USER_CODE,GPM.LAST_UPDATE,GPM.EDT_USER_CODE
				  ,GPM.REMARKS ,GPM.HANDOVER_USER_CODE
				  ,HANDOVER_LAST_UPDATE
				,AGM.ANGADIA_ADD1,AGM.ANGADIA_ADD2,AR.AREA_NAME,CT.CITY
				,GPM.DELIVERED_BY,AGM.ANGADIA_NAME,GPM.MEMO_NO,GPM.MEMO_DT,INM.WAY_BILL,LM.CITY
		  )T

  END
