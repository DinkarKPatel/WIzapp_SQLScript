CREATE PROCEDURE SP_GETMEMONO_PARCEL
@CXN_TYPE	VARCHAR(10),
@CAC_CODE	VARCHAR(20),
@CMEMO_NO	VARCHAR(50)
--WITH ENCRYPTION

AS
BEGIN

	SELECT INV_NO AS [MEMO_NO],INV_DT  AS [MEMO_DT],INV_ID  AS [MEMO_ID] 
	FROM INM01106
	WHERE CANCELLED=0 AND ISNULL(THROUGH,'')='' AND 'WSL'=@CXN_TYPE
	AND AC_CODE=@CAC_CODE AND INV_NO LIKE @CMEMO_NO
	UNION ALL 
	SELECT MRR_NO AS [MEMO_NO],INV_DT  AS [MEMO_DT],MRR_ID  AS [MEMO_ID] 
	FROM PIM01106 A
	LEFT OUTER JOIN PARCEL_DET C ON C.REF_MEMO_ID=A.MRR_ID
	LEFT OUTER JOIN PARCEL_MST B ON C.PARCEL_MEMO_ID=B.PARCEL_MEMO_ID AND B.CANCELLED=0 AND B.XN_TYPE='PUR'
	WHERE A.CANCELLED=0 AND 'PUR'=@CXN_TYPE
	AND A.AC_CODE=@CAC_CODE 
	AND B.PARCEL_MEMO_ID IS NULL
	AND MRR_NO LIKE @CMEMO_NO
	UNION ALL
	SELECT RM_NO AS [MEMO_NO],RM_DT  AS [MEMO_DT],RM_ID  AS [MEMO_ID] 
	FROM RMM01106
	WHERE CANCELLED=0 AND ISNULL(ANGADIA_DETAIL,'')='' AND 'PRT'=@CXN_TYPE
	AND AC_CODE=@CAC_CODE 
	AND RM_NO LIKE @CMEMO_NO
	UNION ALL
	SELECT CN_NO AS [MEMO_NO],CN_DT  AS [MEMO_DT],CN_ID  AS [MEMO_ID] 
	FROM CNM01106 A
	LEFT OUTER JOIN PARCEL_DET C ON C.REF_MEMO_ID=A.CN_ID
	LEFT OUTER JOIN PARCEL_MST B ON C.PARCEL_MEMO_ID=B.PARCEL_MEMO_ID AND B.CANCELLED=0 AND B.XN_TYPE='WSR'
	WHERE A.CANCELLED=0 AND 'WSR'=@CXN_TYPE
	AND A.AC_CODE=@CAC_CODE 
	AND B.PARCEL_MEMO_ID IS NULL 
	AND CN_NO LIKE @CMEMO_NO

END
