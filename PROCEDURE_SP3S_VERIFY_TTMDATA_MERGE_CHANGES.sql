CREATE PROCEDURE SP3S_VERIFY_TTMDATA_MERGE_CHANGES
@nSpId VARCHAR(50),
@cMemoId VARCHAR(40)
AS
BEGIN
	
	DECLARE @CFILTERCONDITION VARCHAR(1000),@CINSSPID VARCHAR(40),@CJOINSTR VARCHAR(500)
	PRINT 'gen tempdata for 1'
	SET @CFILTERCONDITION=' b.MEMO_ID='''+@cMemoId+''''
	set @CINSSPID=LEFT(@nSPId,38)+LEFT(@cMemoId,2)
	

	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB='',@CSOURCETABLE='TRANSFER_TO_TRADING_MST',@CDESTDB=''
								,@CDESTTABLE='TTM_TRANSFER_TO_TRADING_MST_upload',@CKEYFIELD1='MEMO_ID',@CKEYFIELD2='',@CKEYFIELD3=''
								,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION,@LUPDATEONLY=0
								,@BALWAYSUPDATE=0,@bUpdateXns=1,@CINSSPID=@cInSSPId,@CSEARCHTABLE='TRANSFER_TO_TRADING_MST'

	PRINT 'gen tempdata for 2'
	EXEC SP3S_GENFILTERED_UPDATESTR
	@cSpId=@nSpId ,
	@cInsSpId=@cInsSpId,
	@cTableName='TRANSFER_TO_TRADING_MST',
	@cUploadTableName='TTM_TRANSFER_TO_TRADING_MST_upload',
	@cKeyfield='MEMO_ID'
	


	PRINT 'gen tempdata for 3'
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB='',@CSOURCETABLE='TRANSFER_TO_TRADING_DET',@CDESTDB=''
								,@CDESTTABLE='TTM_TRANSFER_TO_TRADING_DET_UPLOAD',@CKEYFIELD1='MEMO_ID',@CKEYFIELD2='',@CKEYFIELD3=''
								,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION,@LUPDATEONLY=0
								,@BALWAYSUPDATE=0,@bUpdateXns=1,@CINSSPID=@cInsSPId,@CSEARCHTABLE='TRANSFER_TO_TRADING_DET'
	
	PRINT 'gen tempdata for 4'
	EXEC SP3S_GENFILTERED_UPDATESTR
	@cSpId=@nSpId ,
	@cInsSpId=@cInsSpId,
	@cTableName='TRANSFER_TO_TRADING_DET',
	@cUploadTableName='TTM_TRANSFER_TO_TRADING_DET_UPLOAD',
	@cKeyfield='row_id',
	@bDonotChkLastUpdate=1

	PRINT 'gen tempdata for 5'
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB='',@CSOURCETABLE='TRANSFER_TO_TRADING_SUB_DET',@CDESTDB=''
								,@CDESTTABLE='TTM_TRANSFER_TO_TRADING_SUB_DET_UPLOAD',@CKEYFIELD1='MEMO_ID',@CKEYFIELD2='',@CKEYFIELD3=''
								,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION,@LUPDATEONLY=0
								,@BALWAYSUPDATE=0,@bUpdateXns=1,@CINSSPID=@cInsSPId,@CSEARCHTABLE='TRANSFER_TO_TRADING_SUB_DET'
	
	PRINT 'gen tempdata for 6'
	EXEC SP3S_GENFILTERED_UPDATESTR
	@cSpId=@nSpId ,
	@cInsSpId=@cInsSpId,
	@cTableName='TRANSFER_TO_TRADING_SUB_DET',
	@cUploadTableName='TTM_TRANSFER_TO_TRADING_SUB_DET_UPLOAD',
	@cKeyfield='row_id',
	@bDonotChkLastUpdate=1


	
	PRINT 'gen tempdata for 7'
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB='',@CSOURCETABLE='TRANSFER_TO_TRADING_BOM',@CDESTDB=''
								,@CDESTTABLE='TTM_TRANSFER_TO_TRADING_BOM_UPLOAD',@CKEYFIELD1='MEMO_ID',@CKEYFIELD2='',@CKEYFIELD3=''
								,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION,@LUPDATEONLY=0
								,@BALWAYSUPDATE=0,@bUpdateXns=1,@CINSSPID=@cInsSPId,@CSEARCHTABLE='TRANSFER_TO_TRADING_BOM'
	
	PRINT 'gen tempdata for 8'
	EXEC SP3S_GENFILTERED_UPDATESTR
	@cSpId=@nSpId ,
	@cInsSpId=@cInsSpId,
	@cTableName='TRANSFER_TO_TRADING_BOM',
	@cUploadTableName='TTM_TRANSFER_TO_TRADING_BOM_UPLOAD',
	@cKeyfield='row_id',
	@bDonotChkLastUpdate=1

	PRINT 'gen tempdata for 9'
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB='',@CSOURCETABLE='TRANSFER_TO_TRADING_JOBS',@CDESTDB=''
								,@CDESTTABLE='TTM_TRANSFER_TO_TRADING_JOBS_UPLOAD',@CKEYFIELD1='MEMO_ID',@CKEYFIELD2='',@CKEYFIELD3=''
								,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION,@LUPDATEONLY=0
								,@BALWAYSUPDATE=0,@bUpdateXns=1,@CINSSPID=@cInsSPId,@CSEARCHTABLE='TRANSFER_TO_TRADING_JOBS'
	
	PRINT 'gen tempdata for 10'
	EXEC SP3S_GENFILTERED_UPDATESTR
	@cSpId=@nSpId ,
	@cInsSpId=@cInsSpId,
	@cTableName='TRANSFER_TO_TRADING_JOBS',
	@cUploadTableName='TTM_TRANSFER_TO_TRADING_JOBS_UPLOAD',
	@cKeyfield='row_id',
	@bDonotChkLastUpdate=1

END