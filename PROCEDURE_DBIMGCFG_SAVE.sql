CREATE PROCEDURE DBIMGCFG_SAVE(@nMode int,@SLS INT=0,@CBS INT=0,@WSL INT=0,@MRP_F FLOAT=0,@MRP_T FLOAT=0,@AGEING_PUR INT=0,@AGEING_CHALLAN INT=0,@DYS INT=0)
AS
BEGIN
SET NOCOUNT ON
BEGIN TRY
BEGIN TRANSACTION
DECLARE @ERR VARCHAR(999)='',@IMG_PER_PAGE INT
IF @nMode=1
   BEGIN
      IF EXISTS(SELECT TOP 1 IMG_PER_PAGE FROM DB_IMAGE_CONFIG WHERE IMG_PER_PAGE IS NOT NULL)
         SELECT TOP 1 @IMG_PER_PAGE=IMG_PER_PAGE FROM DB_IMAGE_CONFIG
      SET @IMG_PER_PAGE=CASE ISNULL(@IMG_PER_PAGE,0) WHEN 0 THEN 12 ELSE @IMG_PER_PAGE END 
      DELETE DB_IMAGE_CONFIG
      SELECT @SLS=ISNULL(@SLS,0),@CBS=ISNULL(@CBS,0),@WSL=ISNULL(@WSL,0),@MRP_F=ISNULL(@MRP_F,0),@MRP_T=ISNULL(@MRP_T,0),@AGEING_PUR=ISNULL(@AGEING_PUR,0),@AGEING_CHALLAN=ISNULL(@AGEING_CHALLAN,0),@DYS=ISNULL(@DYS,0)
      IF @AGEING_PUR+@AGEING_CHALLAN=0 SELECT @DYS=0
      INSERT DB_IMAGE_CONFIG (SLS,CBS,WSL,MRP_F,MRP_T,AGEING_PUR,AGEING_CHALLAN,DYS,IMG_PER_PAGE)
      SELECT @SLS,@CBS,@WSL,@MRP_F,@MRP_T,@AGEING_PUR,@AGEING_CHALLAN,@DYS,@IMG_PER_PAGE  
   END
IF @nMode=2
   BEGIN
      SELECT TOP 1 SLS,CBS,WSL,MRP_F,MRP_T,AGEING_PUR,AGEING_CHALLAN,DYS FROM DB_IMAGE_CONFIG
   END
END TRY

BEGIN CATCH
  SET @ERR=ERROR_MESSAGE()
END CATCH
IF ISNULL(@ERR,'')=''
   COMMIT
ELSE
   ROLLBACK   
SELECT ISNULL(@ERR,'')ERR_MSG
SET NOCOUNT OFF
END