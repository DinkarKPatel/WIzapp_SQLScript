CREATE VIEW SLSRF    
--WITH ENCRYPTION
AS    
SELECT A.PRODUCT_CODE, C.ARTICLE_CODE, C.PARA1_CODE, C.PARA2_CODE, C.PARA3_CODE, C.MRP,     
 /*LEFT(B.CM_NO,2)*//*Rohit 01-11-2024*/b.location_Code AS DEPT_ID, B.CM_NO AS XN_NO, B.CM_ID AS XN_ID,     
 B.CM_DT AS XN_DT, B.CM_TIME AS XN_TIME,
 ( CASE WHEN A.QUANTITY > 0 THEN 'SLS' ELSE 'SLR' END) XN_TYPE,     
 ABS(A.QUANTITY) AS XN_QTY,     
 A.MRP AS XN_PRICE,'T'+(CASE WHEN A.TAX_PERCENTAGE=0 THEN 'F' WHEN ROUND(A.TAX_PERCENTAGE,0)=A.TAX_PERCENTAGE THEN LTRIM(RTRIM(STR(A.TAX_PERCENTAGE)))
							 ELSE LTRIM(RTRIM(STR(A.TAX_PERCENTAGE,6,2))) END) AS TAX_STATUS,B.REMARKS,    
 ABS(ISNULL(A.RFNET,0)) AS XN_NET,     
 ABS(ISNULL(A.RFNET ,0)) AS TAX_AMOUNT,    
 ( CASE WHEN ABS(((A.QUANTITY*A.MRP)-(A.NET - (A.NET * B.DISCOUNT_PERCENTAGE/100))) * ( CASE WHEN A.QUANTITY>0 THEN 1 ELSE -1 END )) > 0     
     THEN LTRIM(STR(ROUND(((A.QUANTITY*A.MRP - ISNULL(A.RFNET,0))*100)/(A.QUANTITY*A.MRP),0)))    
     ELSE 0 END ) AS XN_DP,     
 ABS(((A.QUANTITY*A.MRP)-(A.NET - (A.NET * B.DISCOUNT_PERCENTAGE/100))) * ( CASE WHEN A.QUANTITY>0 THEN 1 ELSE -1 END )) AS XN_DA,     
 A.EMP_CODE, D.MAJOR_DEPT_ID,     
 B.CUSTOMER_CODE AS XN_PARTY_CODE,     
 C.AC_CODE AS PUR_PARTY_CODE,     
 C.INV_NO AS PUR_INV_NO,    
 C.INV_DT AS INV_DT,E.DT_NAME, 'NO' AS SLS_DISCOUNT_DISABLED, B.USER_CODE     
FROM CMD01106 A     
JOIN CMM01106 B ON B.CM_ID = A.CM_ID    
JOIN SKU C ON C.PRODUCT_CODE = A.PRODUCT_CODE    
JOIN LOCATION D ON D.DEPT_ID =b.location_Code/* LEFT(B.CM_NO,2) *//*Rohit 01-11-2024*/
JOIN DTM E ON B.DT_CODE=E.DT_CODE   
WHERE B.CANCELLED = 0 AND B.CM_MODE = 1
