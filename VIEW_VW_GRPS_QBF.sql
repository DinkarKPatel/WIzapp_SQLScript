create VIEW VW_GRPS_QBF     
AS         
SELECT     
A.MEMO_ID,     
A.MEMO_DT AS 'MST_XN_DT',     
A.MEMO_NO AS 'MST_MEMO_NO',     
U.USERNAME AS 'MST_USERNAME',    
B.AC_NAME AS 'MST_SUPP_NAME',      
B.ADDRESS0 AS 'MST_ADDRESS0',    
B.ADDRESS1 AS 'MST_ADDRESS1',    
B.ADDRESS2 AS 'MST_ADDRESS2',    
B.AREA_NAME AS 'MST_AREA_NAME',    
B.CITY AS 'MST_CITY',    
B.PINCODE AS 'MST_PINCODE',    
B.STATE AS 'MST_STATE',                
A.REMARKS AS 'MST_REMARKS',    
A.FIN_YEAR AS 'MST_FIN_YEAR',    
--DBO.FN_GET_PC_WO_BATCHID(C.PRODUCT_CODE) AS 'PRODUCT_CODE',  
LEFT(c.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',c.PRODUCT_CODE)-1,-1),LEN(c.PRODUCT_CODE ))) AS PRODUCT_CODE,
SKU.INV_NO AS BILL_NO,   
C.PRODUCT_CODE AS 'MST_PRODUCT_CODE',     
C.QUANTITY AS 'MST_QUANTITY',    
D.ARTICLE_NO AS 'ARTICLE_NO',     
D.ARTICLE_NAME AS 'ARTICLE_NAME',    
D.ARTICLE_DESC AS 'ARTICLE_DESC',    
P1.PARA1_NAME AS 'PARA1_NAME',     
P2.PARA2_NAME AS 'PARA2_NAME',     
P3.PARA3_NAME AS 'PARA3_NAME',  
P4.PARA4_NAME AS 'PARA4_NAME',    
P5.PARA5_NAME AS 'PARA5_NAME',     
P6.PARA6_NAME AS 'PARA6_NAME',       
C.QUANTITY AS 'QUANTITY',    
E.SUB_SECTION_NAME AS 'SUB_SECTION_NAME',       
F.SECTION_NAME AS 'SECTION_NAME',    
H.UOM_NAME AS 'UOM_NAME',    
SKU.INV_NO  AS 'INV_NO',    
SKU.INV_DT AS 'INV_DT',    
COM.COMPANY_CODE  
,A.MEMO_DT  AS MST_PS_DT 
,A.AC_CODE AS MST_AC_CODE  
,A.LAST_UPDATE AS MST_LAST_UPDATE  
,A.CANCELLED AS MST_CANCELLED  
,A.USER_CODE AS MST_USER_CODE  
,A.MODE AS MST_MODE 
,B.AC_NAME  
,B.ALIAS  
,B.HEAD_CODE  
,B.CLOSING_BALANCE  
,B.CLOSING_BALANCE_CR_DR  
,B.PRINT_LEDGER  
,B.INACTIVE  
,B.PRINT_NAME  
,B.ADDRESS0  
,B.ADDRESS1  
,B.ADDRESS2  
,B.AREA_CODE  
,B.AREA_NAME  
,B.PINCODE  
,B.CITY_CODE  
,B.CITY  
,B.STATE_CODE  
,B.STATE  
,B.CST_NO  
,B.CST_DT  
,B.SST_NO  
,B.SST_DT  
,B.TIN_NO  
,B.TIN_DT  
,B.PHONES_R  
,B.PHONES_O  
,B.PHONES_FAX  
,B.MOBILE  
,B.E_MAIL  
,B.TAX_CODE  
,B.CREDIT_DAYS  
,B.BILL_BY_BILL  
,B.ON_HOLD  
,B.THROUGH_BROKER  
,B.BROKER_AC_CODE  
,B.BROKER_COMM_PERCENT  
,B.CREDIT_LIMIT  
,B.ALLOW_CREDITOR_DEBTOR  
,B.DPWEF_DT  
,B.CST_PERCENTAGE  
,B.PAN_NO  
,B.CUSTOMER_CODE  
,B.GLN_NO  
,B.MP_PERCENTAGE  
,B.MRP_CALC_MODE  
,B.TDS_CODE  
,B.INV_RATE_TYPE  
,B.OUTSTATION_PARTY  
,B.SALES_AC_CODE  
,B.USERNAME  
,B.EDT_USERNAME  
,SKU.ARTICLE_CODE  
,SKU.PARA1_CODE  
,SKU.PARA2_CODE  
,SKU.PARA3_CODE  
,SKU.RECEIPT_DT  
,SKU.PARA4_CODE  
,SKU.PARA5_CODE  
,SKU.PARA6_CODE  
,SKU.MRP  
,SKU.DT_CREATED  
,SKU.WS_PRICE  
,SKU.IMAGE_NAME  
,SKU.CHALLAN_NO  
,SKU.FIX_MRP  
,D.CODING_SCHEME  
,D.PARA1_SET  
,D.PARA2_SET  
,D.SKU_CODE  
,D.SUB_SECTION_CODE  
,D.DISCON  
,D.WHOLESALE_PRICE  
,D.WSP_PERCENTAGE  
,D.MIN_PRICE  
,D.STOCK_NA  
,D.ARTICLE_TYPE  
,D.CREATED_ON  
,D.ARTICLE_GROUP_CODE  
,D.GENERATE_BARCODES_WITHARTICLE_PREFIX  
,D.ARTICLE_GEN_MODE  
,D.ARTICLE_PRD_MODE  
,D.ARTICLE_SET_CODE  
,D.OH_PERCENTAGE  
,D.OH_AMOUNT  
,E.SECTION_CODE  
,E.MFG_CATEGORY  
,U.MAJOR_USER_CODE  
,U.USER_ALIAS  
,U.DISCOUNT_PERCENTAGE_LEVEL  

,U.EMAIL  
,H.UOM_TYPE    

,B.AC_NAME AS SUPPLIER_AC_NAME  
,B.ALIAS AS SUPPLIER_ALIAS  

,B.PRINT_NAME AS SUPPLIER_PRINT_NAME  
,B.ADDRESS0 AS SUPPLIER_ADDRESS0  
,B.ADDRESS1 AS SUPPLIER_ADDRESS1  
,B.ADDRESS2 AS SUPPLIER_ADDRESS2  
,B.AREA_CODE AS SUPPLIER_AREA_CODE  
,B.AREA_NAME AS SUPPLIER_AREA_NAME  
,B.PINCODE AS SUPPLIER_PINCODE  
,B.CITY_CODE AS SUPPLIER_CITY_CODE  
,B.CITY AS SUPPLIER_CITY  
,B.STATE_CODE AS SUPPLIER_STATE_CODE  
,B.STATE AS SUPPLIER_STATE  
,B.CST_NO AS SUPPLIER_CST_NO  
,B.CST_DT AS SUPPLIER_CST_DT  
,B.SST_NO AS SUPPLIER_SST_NO  
,B.SST_DT AS SUPPLIER_SST_DT  
,B.TIN_NO AS SUPPLIER_TIN_NO  
,B.TIN_DT AS SUPPLIER_TIN_DT  
,B.PHONES_R AS SUPPLIER_PHONES_R  
,B.PHONES_O AS SUPPLIER_PHONES_O  
,B.PHONES_FAX AS SUPPLIER_PHONES_FAX  
,B.MOBILE AS SUPPLIER_MOBILE  
,B.E_MAIL AS SUPPLIER_E_MAIL  
,B.TAX_CODE AS SUPPLIER_TAX_CODE  
,B.CREDIT_DAYS AS SUPPLIER_CREDIT_DAYS  
,B.DISCOUNT_PERCENTAGE AS SUPPLIER_DISCOUNT_PERCENTAGE  
,B.BILL_BY_BILL AS SUPPLIER_BILL_BY_BILL  
,B.ON_HOLD AS SUPPLIER_ON_HOLD  
,B.THROUGH_BROKER AS SUPPLIER_THROUGH_BROKER  
,B.BROKER_AC_CODE AS SUPPLIER_BROKER_AC_CODE  
,B.BROKER_COMM_PERCENT AS SUPPLIER_BROKER_COMM_PERCENT  
,B.CREDIT_LIMIT AS SUPPLIER_CREDIT_LIMIT  
,B.ALLOW_CREDITOR_DEBTOR AS SUPPLIER_ALLOW_CREDITOR_DEBTOR  
,B.DPWEF_DT AS SUPPLIER_DPWEF_DT  
,B.CST_PERCENTAGE AS SUPPLIER_CST_PERCENTAGE  
,B.PAN_NO AS SUPPLIER_PAN_NO   
,SKU.PRODUCT_NAME 
,SKU.PURCHASE_PRICE
,ISNULL(PM.PARCEL_MEMO_NO,'') AS PARCEL_MEMO_NO
,ISNULL(PB.PARTY_INV_NO,'') AS PARTY_INV_NO
,ISNULL(PB.PARTY_INV_DT,'') AS PARTY_INV_DT
,ISNULL(PB.quantity,0) AS PARTY_INV_QTY
,ISNULL(PB.PARTY_INV_AMT,0) AS PARTY_INV_AMT
,(CASE WHEN PM.XN_TYPE='grn' and ref_grn_mode=1 THEN pb.REF_MEMO_NO END) AS ASN_NO
,(CASE WHEN PM.XN_TYPE='grn' and ref_grn_mode=1 THEN pom.po_no  ELSE pb.ref_memo_no END) AS PO_NO
,COM.GST_NO AS COMP_GST_NO
,COM.COMPANY_NAME  AS COMP_NAME
,B.AC_GST_NO AS AC_GST_NO
,(CASE WHEN ISNULL(A.MODE,0)=0 THEN  ISNULL(A.MODE,0)  ELSE A.MODE END)AS ENTERY_MODE
--ADDED ON 04 FEB 2019
,PB.PARTY_INV_NO INV_NO1
,PB.BOX_NO [No of Boxes]
,PB.PARTY_INV_DT INV_DT1
,PB.REF_MEMO_NO [Against No]
,PB.QUANTITY [TOTAL QTY]
,LCT.DEPT_ID AS LOCATION_DEPT_ID      
,LCT.DEPT_NAME AS LOCATION_DEPT_NAME      
,LCT.Dept_Print_Name AS LOCATION_Print_Name      
,LCT.ADDRESS1 AS LOCATION_ADDRESS1      
,LCT.ADDRESS2 AS LOCATION_ADDRESS2      
,LCT.CST_NO AS LOCATION_CST_NO      
,LCT.CST_DT AS LOCATION_CST_DT      
,LCT.LST_NO AS LOCATION_LST_NO      
,LCT.LST_DT AS LOCATION_LST_DT      
,LCT.DEPT_ALIAS AS LOCATION_DEPT_ALIAS      
,LCT.PHONE AS LOCATION_PHONE      
,LCT.LOC_TYPE AS LOCATION_LOC_TYPE                
,LCT.TIN_NO AS LOCATION_TIN_NO         
,LA.AREA_NAME AS LOCATION_AREA      
,LC.CITY AS LOCATION_CITY      
,LS.STATE AS LOCATION_STATE      
,LRG.REGION_NAME AS LOCATION_REGION ,
bin.BIN_NAME,zone.BIN_NAME as Zone_Name,A.location_Code
FROM GRN_PS_MST A (NOLOCK)           
JOIN LMV01106 B (NOLOCK)  ON A.AC_CODE = B.AC_CODE  
JOIN LOCATION LCT ON A.location_code/*LEFT(A.MEMO_ID   ,2)*//*Rohit 04-11-2024*/ =LCT.DEPT_ID           
JOIN AREA LA ON LCT.AREA_CODE=LA.AREA_CODE      
JOIN CITY LC ON LA.CITY_CODE=LC.CITY_CODE      
JOIN [STATE] LS ON LC.STATE_CODE=LS.STATE_CODE      
JOIN REGIONM LRG ON LS.REGION_CODE=LRG.REGION_CODE         
JOIN GRN_PS_DET C (NOLOCK) ON A.MEMO_ID  = C.MEMO_ID          
JOIN SKU (NOLOCK) ON C.PRODUCT_CODE = SKU.PRODUCT_CODE      
JOIN ARTICLE D (NOLOCK) ON SKU.ARTICLE_CODE = D.ARTICLE_CODE          
JOIN SECTIOND E (NOLOCK) ON D.SUB_SECTION_CODE = E.SUB_SECTION_CODE           
JOIN SECTIONM F (NOLOCK) ON E.SECTION_CODE = F.SECTION_CODE           
JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE = P1.PARA1_CODE          
JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE = P2.PARA2_CODE          
JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE = P3.PARA3_CODE   
JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE = P4.PARA4_CODE   
JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE = P5.PARA5_CODE     
JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE = P6.PARA6_CODE         
JOIN USERS U (NOLOCK)  ON A.USER_CODE = U.USER_CODE       
JOIN UOM H (NOLOCK)  ON D.UOM_CODE = H.UOM_CODE  
JOIN COMPANY COM ON 1=1 AND COM.COMPANY_CODE ='01'
join bin (nolock) on bin.BIN_ID =c.BIN_ID 
join bin zone (nolock) on zone.BIN_ID =bin.major_bin_id 
--CHANGED ON 21 NOV 2018
LEFT JOIN parcel_det  PB (NOLOCK) 
JOIN PARCEL_MST PM (NOLOCK) ON ISNULL(PM.PARCEL_MEMO_ID,'')=ISNULL(PB.PARCEL_MEMO_ID,'')
ON ISNULL(PB.row_ID,'')=ISNULL(A.REF_PARCEL_row_ID,'')
--CHANGED ON 21 NOV 2018
LEFT JOIN ASN_MST AM (NOLOCK) ON AM.MEMO_ID=PB.REF_MEMO_ID AND PM.XN_TYPE='grn' and pb.ref_grn_mode=1
LEFT JOIN POM01106 POM (NOLOCK) ON POM.PO_ID=AM.PO_ID

