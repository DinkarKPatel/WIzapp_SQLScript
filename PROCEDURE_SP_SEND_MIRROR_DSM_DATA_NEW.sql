CREATE PROCEDURE SP_SEND_MIRROR_DSM_DATA_NEW --(LocId 3 digit change only increased the parameter width by Sanjay:01-11-2024)
(	
	 @CREQXNID VARCHAR(50)
    ,@CCURLOCID VARCHAR(4)
	,@BACKNOWLEDGE BIT=0
	,@CERRMSG VARCHAR(1000) OUTPUT
)	
--WITH ENCRYPTION
AS
BEGIN
	DECLARE @DTSQL NVARCHAR(MAX),@CSPID VARCHAR(10),@CTEMPTABLE VARCHAR(500),@CMEMOID VARCHAR(50),
	@CTEMPMASTERTABLE VARCHAR(200),@CTEMPLMTABLE VARCHAR(200),@CTEMPLMPTABLE VARCHAR(200)
	,@CTEMPAREATABLE VARCHAR(200),@CTEMPCITYTABLE VARCHAR(200),@CTEMPCUSTABLE VARCHAR(200),@CTEMPEMPTABLE VARCHAR(200)
	,@CTEMPPAYTABLE VARCHAR(200),@CTEMPPMSTTABLE VARCHAR(200)
	,@DMEMOLASTUPDATE DATETIME,@CTABLENAME VARCHAR(100),@BRECFOUND BIT,@CSTEP VARCHAR(5),@CFILTERCONDITION VARCHAR(MAX),@CCUTOFFDATE VARCHAR(20)
	,@CKEYFIELD VARCHAR(100),@BPENDINGMSTFOUND BIT

	DECLARE @TXNSSENDINFO TABLE (ORG_TABLENAME VARCHAR(100),TMP_TABLENAME VARCHAR(100),XN_ID VARCHAR(40))  	

BEGIN TRY 	
	---- CALL ACKNOWLEDGEMENT OF MEMO SUCCESSFUL MERGING AT MIRRORING SERVER
	DECLARE @CTEMPDBNAME VARCHAR(40)
	
	SET @CSTEP=10
	SET @CMEMOID=@CREQXNID
	
	
	SET @CSTEP=220
	---- SEND THE ARC MEMO MASTER TABLE
	SELECT A.*,'DSM_DSM01106_UPLOAD' AS TARGET_TABLENAME FROM DSM01106 A (NOLOCK) WHERE DS_ID=@CMEMOID

	SET @CSTEP=230
	---- SEND THE WSL_ORDER_ADV_RECEIPT RELATED TO ARC TABLE  -
	SELECT A.*,'DSM_DSD01106_UPLOAD' AS TARGET_TABLENAME FROM DSD01106 A (NOLOCK) WHERE DS_ID=@CMEMOID
	
	
	
	GOTO END_PROC
END TRY
BEGIN CATCH
	SET @CERRMSG='P: SP_SEND_MIRROR_DSM_DATA_NEW, STEP:'+@CSTEP+', MESSAGE:'+ERROR_MESSAGE()
	GOTO END_PROC
END CATCH 		

END_PROC:

	
	
END
---END OF PROCEDURE - SP_SEND_MIRROR_DSM_DATA_NEW
