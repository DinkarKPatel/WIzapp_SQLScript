CREATE PROCEDURE SP3SGETPURCHASEDETAILS
(
	 @CMEMOID VARCHAR(30)
	,@NQUERYID NUMERIC(2)=1,
	@NGETTAXABLEVALUEDIFF INT=0
)
--WITH ENCRYPTION 
AS 
BEGIN
/*EXEC SP3SGETPURCHASEDETAILS 'HO0111600000HO00000003'*/

DECLARE @nMode NUMERIC(1,0),@bConvertedMrr BIT

GETPURCHASEHEADER:

	set @bConvertedMrr=0

	SELECT CAST('' AS VARCHAR(100)) AS MRR_ID
	INTO #TMPMRR WHERE 1=2

	IF EXISTS (SELECT TOP 1 'u' FROM PIM01106 WHERE MRR_ID= @CMEMOID AND PIM_MODE =5)
	begin
		     
		set @bConvertedMrr=1
		INSERT INTO #TMPMRR
		SELECT MRR_ID  FROM PIM01106 WHERE REF_CONVERTED_MRNTOBILL_MRRID =@CMEMOID AND CANCELLED=0

	end
	else
	begin
		insert into #TMPMRR
		select @CMEMOID
	
	end

	SET @nMode=(CASE WHEN @NGETTAXABLEVALUEDIFF=1 THEN 2 ELSE 1 END)
	
	IF EXISTS (SELECT TOP 1 a.mrr_id FROM #TMPMRR a JOIN pim01106 b ON a.MRR_ID=b.mrr_id
	where isnull(TERMS,'')<>'')
	BEGIN
		EXEC SP3S_GET_PURVALUE_AGST_TERMS
		@nMode=@nMode,
		@bConvertedMrr=@bConvertedMrr
	END

	DROP TABLE #TMPMRR

GOTO ENDPROC

ENDPROC:	
END
--END OF PROCEDURE - SP3SGETPURCHASEDETAILS