CREATE PROC VALIDATEXN_RPS_BEFORE_EDIT 
@CMEMOID VARCHAR(30),
@BCANCELXN BIT,
@CERRORMSG VARCHAR(200) OUTPUT,
@CEXPRERRORMSG VARCHAR(200) OUTPUT
--WITH ENCRYPTION
AS
BEGIN
	
	DECLARE @CTEXT VARCHAR(10)
	
	SET @CTEXT=(CASE WHEN @BCANCELXN=1 THEN 'CANCEL' ELSE 'EDIT' END)
		
	--IF EXISTS(SELECT TOP 1 A.CM_ID FROM PACK_SLIP_RF A JOIN RPS_MST B ON A.PACK_SLIP_ID=B.CM_ID
	--		  WHERE A.PACK_SLIP_ID=@CMEMOID AND B.CANCELLED=0 )				  
	
	--BEGIN
	--	SET @CERRORMSG='THIS PACKSLIP HAS BEEN SETTLED IN RETAIL SALES.........CAN NOT '+@CTEXT
	--	RETURN
	--END

	IF EXISTS(SELECT TOP 1 A.REF_CM_ID FROM RPS_MST A 
			  WHERE A.CM_ID=@CMEMOID AND A.CANCELLED=0 AND ISNULL(A.ref_cm_id,'')<>'')				  
	
	BEGIN
		SET @CERRORMSG='THIS PACKSLIP HAS BEEN SETTLED IN RETAIL SALES.........CAN NOT '+@CTEXT
		RETURN
	END
	
	
END
