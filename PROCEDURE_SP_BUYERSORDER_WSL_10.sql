CREATE PROCEDURE SP_BUYERSORDER_WSL_10
@CMEMOID VARCHAR(40),  
@CWHERE VARCHAR(500),  
@CFINYEAR VARCHAR(10),  
@NNAVMODE NUMERIC(2,0),
@CARTICLECODE CHAR(9)='',  
@CPARA2CODE CHAR(7)='',
@DTWHERE DATETIME ='',
@cLocId VARCHAR(5)=''
--WITH ENCRYPTION
 
AS    
BEGIN 
	DECLARE @CCMD NVARCHAR(MAX),@cHeadCode VARCHAR(MAX),@cHeadCode1 VARCHAR(MAX)    
	SET  @cHeadCode	= DBO.FN_ACT_TRAVTREE ('0000000018') ----ADD VARIABLE BY GAURI ON 17/4/2019	
	SET  @cHeadCode1   = DBO.FN_ACT_TRAVTREE ('0000000001') ---ADD VARIABLE BY GAURI ON 17/4/2019


	SELECT  A.AC_CODE,A.HEAD_CODE,  A.AC_NAME, ISNULL(A.CREDIT_DAYS, 0) AS CREDIT_DAYS,    
	ISNULL(A.DISCOUNT_PERCENTAGE, 0) AS DISCOUNT_PERCENTAGE, A.CITY, A.ADDRESS0 + ' ' +    
	A.ADDRESS1 + ' ' + A.ADDRESS2 + ' ' + A.AREA_NAME + ' ' + A.CITY + ' ' +    
	A.STATE + ' ' +   (CASE WHEN A.PINCODE = '' THEN '' ELSE 'PIN :' +A.PINCODE END) + ' ' + A.MOBILE + ' ' AS SUPP_ADDRESS, A.AC_NAME AS REPCOLNAME,A.DEFAULT_RATE_TYPE,
	A.BROKER_AC_CODE ,B.AC_NAME AS BROKER_AC_NAME ,A.TIN_NO,
	A.ADDRESS0,A.ADDRESS1,A.ADDRESS2,A.AREA_NAME,A.CITY,A.STATE,A.PINCODE,A.ANGADIA_CODE,A.ANGADIA_NAME,A.PARTY_RATE_MEMO_ID ,
	ISNULL(A.fc_code,'0000000') AS FC_CODE,FC.FC_NAME,FC.FC_RATE ,
	A.lm_REMARKS ,(case when A.freightPaidBy =2 then 'Party' else 'Company' end) as freightmethod
	FROM LMV01106 A (NOLOCK)  
	LEFT OUTER JOIN LMV01106 B ON A.BROKER_AC_CODE= B.AC_CODE      
	LEFT OUTER JOIN FC  ON FC.FC_CODE = A.FC_CODE    
	WHERE ( CHARINDEX ( A.HEAD_CODE, @cHeadCode)>0				----REPLACE VARIABLE FROM FUNCTION BY GAURI ON 17/4/2019
		   OR	CHARINDEX ( A.HEAD_CODE,@cHeadCode1)>0			----REPLACE VARIABLE FROM FUNCTION BY GAURI ON 17/4/2019
	OR A.ALLOW_CREDITOR_DEBTOR = 1 )           
	AND A.INACTIVE = 0 AND A.AC_CODE <> '0000000000' AND ISNULL(A.AC_NAME,'')<>''
    
END