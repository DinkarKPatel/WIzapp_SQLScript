CREATE PROCEDURE SP_LOC_SPACE_DETAILS
(
  @NQUERYID INT,
  @CMEMO_ID VARCHAR(50)=''
)
--WITH ENCRYPTION 
AS
BEGIN
IF @NQUERYID=1
GOTO LBL_ADDMODE
ELSE IF @NQUERYID=2
GOTO LBL_EDITMODE
ELSE
GOTO END_PROC

LBL_ADDMODE:
    SELECT MEMO_ID=CAST('' AS VARCHAR(100)), L.DEPT_ID ,DEPT_NAME,APRIL=CAST(0 AS NUMERIC(18,2)),
           MAY=CAST(0 AS NUMERIC(18,2)),
           JUNE=CAST(0 AS NUMERIC(18,2)),
           JULY=CAST(0 AS NUMERIC(18,2)),
           AUGUST=CAST(0 AS NUMERIC(18,2)),
           SEPTEMBER=CAST(0 AS NUMERIC(18,2)),
           OCTOBER=CAST(0 AS NUMERIC(18,2)),
           NOVEMBER=CAST(0 AS NUMERIC(18,2)),
           DECEMBER=CAST(0 AS NUMERIC(18,2)),
           JANUARY=CAST(0 AS NUMERIC(18,2)),
           FEBRUARY=CAST(0 AS NUMERIC(18,2)),
           MARCH=CAST(0 AS NUMERIC(18,2)),
           TOTAL =CAST(0 AS NUMERIC(18,2)),
           ROW_ID=NEWID(),
           LAST_UPDATE =GETDATE (),
           FIN_YEAR=CAST('' AS VARCHAR(100))
    FROM LOCATION L (NOLOCK)

GOTO END_PROC

LBL_EDITMODE:
     IF OBJECT_ID('TEMPDB..#TMPDETAIL','U') IS NOT NULL
        DROP TABLE #TMPDETAIL
        
		 SELECT MEMO_ID, L.DEPT_ID ,DEPT_NAME,APRIL,
			   MAY,JUNE,JULY,AUGUST,SEPTEMBER,
			   OCTOBER,NOVEMBER,
			   DECEMBER,JANUARY,FEBRUARY,MARCH,TOTAL,
			   ROW_ID=NEWID(),
			   LAST_UPDATE =GETDATE (),
			   FIN_YEAR=DET.FIN_YEAR 
		 INTO #TMPDETAIL
		 FROM LOCATION L (NOLOCK)
		 JOIN LOC_SPACE_DET DET ON L.DEPT_ID =DET.DEPT_ID  
         WHERE DET.MEMO_ID=@CMEMO_ID
     
     IF EXISTS (SELECT TOP 1 'U' FROM LOC_SPACE_MST WHERE MEMO_ID=@CMEMO_ID )
     BEGIN
		 SELECT * FROM #TMPDETAIL   
		 UNION ALL
		 SELECT MEMO_ID=CAST('' AS VARCHAR(100)),L.DEPT_ID ,L.DEPT_NAME,APRIL=CAST(0 AS NUMERIC(18,2)),
			   MAY=CAST(0 AS NUMERIC(18,2)),
			   JUNE=CAST(0 AS NUMERIC(18,2)),
			   JULY=CAST(0 AS NUMERIC(18,2)),
			   AUGUST=CAST(0 AS NUMERIC(18,2)),
			   SEPTEMBER=CAST(0 AS NUMERIC(18,2)),
			   OCTOBER=CAST(0 AS NUMERIC(18,2)),
			   NOVEMBER=CAST(0 AS NUMERIC(18,2)),
			   DECEMBER=CAST(0 AS NUMERIC(18,2)),
			   JANUARY=CAST(0 AS NUMERIC(18,2)),
		       FEBRUARY=CAST(0 AS NUMERIC(18,2)),
		       MARCH=CAST(0 AS NUMERIC(18,2)),
			   TOTAL =CAST(0 AS NUMERIC(18,2)),
			   ROW_ID=NEWID(),
			   LAST_UPDATE =GETDATE (),
			   FIN_YEAR=CAST('' AS VARCHAR(100))
		FROM LOCATION L (NOLOCK)
		LEFT JOIN #TMPDETAIL TMP ON L.DEPT_ID =TMP.DEPT_ID     
		WHERE TMP.DEPT_ID IS NULL
    END
    ELSE
    BEGIN
        SELECT * FROM #TMPDETAIL 
    END
END_PROC:
END
