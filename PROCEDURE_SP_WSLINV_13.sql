CREATE PROCEDURE SP_WSLINV_13--(LocId 3 digit change only increased the parameter width by Sanjay:04-11-2024)
	@CMEMOID	VARCHAR(40) = '',
	@CWHERE1	VARCHAR(500) = '',
	@NNAVMODE	NUMERIC(1,0) = 0,
	@CWHERE2	NVARCHAR(MAX)='',
	@DMEMODT DATETIME='',
	@CLOCID		VARCHAR(4)=''
----WITH ENCRYPTION
AS
BEGIN

    DECLARE @CQRY1 NVARCHAR(MAX),@CAPPLYWSPRATE VARCHAR(4)
	SELECT TOP 1 @CAPPLYWSPRATE=VALUE FROM CONFIG WHERE  CONFIG_OPTION='APPLY_WSP_RATE'
	
	
	SET @CQRY1=N'INSERT WSL_ITEM_DETAILS	(ROW_ID,BOX_NO, BOX_DT,PRODUCT_CODE,INVOICE_QUANTITY, ITEM_FORM_ID, SP_ID,PS_ID,
	AUTO_SRNO,RATE,MANUAL_RATE,BIN_ID )
	SELECT (''LATER''+LEFT(CONVERT(VARCHAR(38),NEWID()),35)) AS ROW_ID,BOX_NO,'''' AS BOX_DT,PRODUCT_CODE,
	QUANTITY AS INVOICE_QUANTITY,''0000000'' AS ITEM_FORM_ID,'+LTRIM(RTRIM(STR(@@SPID)))+' AS SP_ID,
	PS_ID,0 AS AUTO_SRNO,RATE,'+(CASE WHEN ISNULL(@CAPPLYWSPRATE,'')='1' THEN '1' ELSE '0' END)+' AS MANUAL_RATE, BIN_ID FROM WPS_DET  A (NOLOCK)   
	WHERE A.PS_ID IN ('+@CWHERE2+')'
		 
	PRINT @CQRY1
	EXEC SP_EXECUTESQL @CQRY1


	--DECLARE @cTableName NVARCHAR(100)
	--SET @cTableName=N'##WSL_ITEM_DETAILS_'+LTRIM(RTRIM(STR(@@SPID)))

	--SET @CQRY1=N'IF OBJECT_ID(''TEMPDB..'+@cTableName+''',''U'') is not null	
	--			DROP TABLE '+@cTableName
		 
	--PRINT @CQRY1
	--EXEC SP_EXECUTESQL @CQRY1


	--SET @CQRY1=N'SELECT (''LATER''+LEFT(CONVERT(VARCHAR(38),NEWID()),35)) AS ROW_ID,BOX_NO,'''' AS BOX_DT,PRODUCT_CODE,
	--QUANTITY ,''0000000'' AS ITEM_FORM_ID,'+LTRIM(RTRIM(STR(@@SPID)))+' AS SP_ID,
	--PS_ID,0 AS AUTO_SRNO,RATE,'+(CASE WHEN ISNULL(@CAPPLYWSPRATE,'')='1' THEN '1' ELSE '0' END)+' AS MANUAL_RATE, BIN_ID 
	--INTO '+@cTableName+' 
	--FROM WPS_DET  A (NOLOCK)   
	--WHERE A.PS_ID IN ('+@CWHERE2+')'
		 
	--PRINT @CQRY1
	--EXEC SP_EXECUTESQL @CQRY1

END