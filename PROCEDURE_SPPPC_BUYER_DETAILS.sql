CREATE PROCEDURE SPPPC_BUYER_DETAILS
(
  @CFG_ISSUE_ID VARCHAR(100)=''
)
AS
     
     SELECT    IM.MEMO_ID,
               IM.MEMO_NO,
               CONVERT (VARCHAR,IM.MEMO_DT,105) AS MEMO_DT,
               MST.BILL_NO,
			   MST.REF_NO,
			   LM1.AC_CODE ,
			   LM1.AC_NAME AS BUYER_NAME ,
			   LMP.ADDRESS0 +' '+LMP.ADDRESS1 AS BUYER_ADDRESS0,
               LA.AREA_NAME AS BUYER_AREA_NAME,
               LC.CITY AS BUYER_CITY,
               LS.STATE AS BUYER_STATE,
               '' AS PIN_CODE
               ,CMP.COMPANY_NAME
			   ,CMP.PIN
			   ,CMP.LOGO_PATH
			   ,CMP.ADDRESS1+ ' '+CMP.ADDRESS2+ ' '+CMP.ADDRESS9 AS COMPANY_ADDRESS
			   ,CA.AREA_NAME AS COMPANY_AREA
			   ,CC.CITY AS COMPANY_CITY
			   ,CS.STATE AS COMPANY_STATE
			   ,SUM(ID.QUANTITY) AS TOTAL_QTY,
			   'GST NO: '+ISNULL(CMP.GST_NO,'''')  AS GST_NO,
               'GST NO: '+ISNULL(LMP.AC_GST_NO,'''')  AS AC_GST_NO,
               ISNULL(IM.APPROVED,0) AS APPROVED,
               IM.CANCELLED 
		  FROM PPC_FGBCG_MST A
		  JOIN PPC_FGBCG_DET B ON A.MEMO_ID =B.MEMO_ID 
		  JOIN PPC_FG_SKU SKU ON SKU.PPC_FGBCG_DET_ROW_ID=B.ROW_ID 
		  JOIN PPC_FG_PMT PMT ON PMT.PRODUCT_CODE=SKU.PRODUCT_CODE 
		  JOIN ARTICLE ART ON ART.ARTICLE_CODE =SKU.ARTICLE_CODE 
		  JOIN PARA1 P1 ON P1.PARA1_CODE =SKU.PARA1_CODE 
		  JOIN PARA2 P2 ON P2.PARA2_CODE =SKU.PARA2_CODE 
		  JOIN PARA3 P3 ON P3.PARA3_CODE =SKU.PARA3_CODE 
		  JOIN PPC_SIZEGROUP SG ON SG.SIZEGROUP_CODE =SKU.SIZEGROUP_CODE 
		  JOIN PPC_AGENCY_ISSUE_FG_FIRST_DET ID ON ID.PRODUCT_CODE=PMT.PRODUCT_CODE
		  JOIN PPC_AGENCY_ISSUE_FG_FIRST_MST IM ON ID.MEMO_ID=IM.MEMO_ID
		  JOIN PPC_BUYER_ORDER_DET DET ON DET.ROW_ID =B.BO_DET_ROW_ID 
		  JOIN PPC_BUYER_ORDER_MST  MST ON MST.ORDER_ID  =DET .ORDER_ID
		  JOIN LM01106 LM1 ON LM1.AC_CODE=IM.AC_CODE 
		  JOIN LMP01106 LMP ON LMP.AC_CODE =LM1.AC_CODE 
		  JOIN AREA LA ON LMP.AREA_CODE = LA.AREA_CODE   
		  JOIN CITY LC ON LC.CITY_CODE = LA.CITY_CODE   
		  JOIN STATE LS ON LS.STATE_CODE = LC.STATE_CODE
		  LEFT JOIN COMPANY CMP ON CMP.COMPANY_CODE='01'
          LEFT JOIN AREA CA ON CMP.AREA_CODE=CA.AREA_CODE
          LEFT JOIN CITY CC ON CA.CITY_CODE=CC.CITY_CODE  
          LEFT JOIN STATE CS ON CC.CITY_CODE=CS.STATE_CODE
		  WHERE A.CANCELLED=0 AND IM.CANCELLED=0 AND MST.CANCELLED =0
		  AND (@CFG_ISSUE_ID='' OR IM.MEMO_ID=@CFG_ISSUE_ID)
		  GROUP BY IM.MEMO_ID,
               IM.MEMO_NO,
               CONVERT (VARCHAR,IM.MEMO_DT,105),
               LM1.AC_CODE,
			   LM1.AC_NAME ,
			   MST.BILL_NO,
			   MST.REF_NO,
			   LMP.ADDRESS0 ,
               LMP.ADDRESS1 ,
               LA.AREA_NAME ,
               LC.CITY ,
               LS.STATE ,CMP.COMPANY_NAME
			   ,CMP.PIN
			   ,CMP.LOGO_PATH
			   ,CMP.ADDRESS1+ ' '+CMP.ADDRESS2+ ' '+CMP.ADDRESS9 
			   ,CA.AREA_NAME 
			   ,CC.CITY ,CS.STATE ,
			    'GST NO: '+ISNULL(CMP.GST_NO,'''')  ,
               'GST NO: '+ISNULL(LMP.AC_GST_NO,''''),ISNULL(IM.APPROVED,0),
               IM.CANCELLED
