CREATE PRocEDURe SP_WSLINV_3--(LocId 3 digit change only increased the parameter width by Sanjay:04-11-2024)
	@CMEMOID	VARCHAR(40) = '',
	@CWHERE1	VARCHAR(500) = '',
	@NNAVMODE	NUMERIC(1,0) = 0,
	@CWHERE2	NVARCHAR(MAX)='',
	@DMEMODT DATETIME='',
	@CLOCID		VARCHAR(4)=''
----WITH ENCRYPTION
AS
BEGIN
        
		  SELECT ROW_ID =CAST('' AS VARCHAR(100)),CAST(0 AS NUMERIC(14,2)) AS FC_NET,CAST(0 AS NUMERIC(14,2)) AS FC_GST_PERCENTAGE,CAST(0 AS INT) AS FC_TAX_METHOD,CAST(0 AS BIT) AS IS_IGST,
	       CAST(0 AS NUMERIC(14,2)) AS FC_XN_VALUE_WITHOUT_GST,CAST(0 AS NUMERIC(10,2)) AS FC_IGST_AMOUNT,CAST(0 AS NUMERIC(10,2)) AS FC_CGST_AMOUNT,
		   CAST(0 AS NUMERIC(10,2)) AS FC_SGST_AMOUNT,CAST(0 AS NUMERIC(14,2)) AS FC_XN_VALUE_WITH_GST
	       INTO #TMPFCRATE
	      WHERE 1=2

	IF EXISTS ( SELECT 1 'U' FROM CONFIG WHERE CONFIG_OPTION='ENABLE_MULTI_CURRENCY' AND VALUE='1')
	begin
	      
		  exec SP3S_CALCULATE_FCNET_WSL @CMEMOID,1
	end
	

		SELECT T1.*,ROW_NUMBER() OVER (ORDER BY T1.BOX_NO,T1.PS_ID) AS S_NO,
		T1.PRODUCT_CODE, B.ARTICLE_CODE, B.ARTICLE_NO, B.ARTICLE_NAME, S.PARA1_CODE,  
		--C.PARA1_NAME,
		S.PARA2_CODE, --D.PARA2_NAME, 
		S.PARA3_CODE, --F.PARA3_NAME,
		E.UOM_NAME,    

		T1.DEPT_ID, S.BARCODE_CODING_SCHEME AS CODING_SCHEME, B.INACTIVE, 
		T1.INVOICE_QUANTITY+ISNULL(P.QUANTITY_IN_STOCK,0) AS QUANTITY_IN_STOCK,  
		S.PURCHASE_PRICE,  '' AS SCHEME_ID, --SM.SECTION_NAME, SD.SUB_SECTION_NAME,  
		S.PARA4_CODE,S.PARA5_CODE,S.PARA6_CODE,  
		--G.PARA4_NAME,H.PARA5_NAME,I.PARA6_NAME,
		E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],  
		B.DT_CREATED AS [ART_DT_CREATED],'' AS [PARA3_DT_CREATED],S.DT_CREATED AS [SKU_DT_CREATED],  
		B.STOCK_NA,(T1.INVOICE_QUANTITY*T1.NET_RATE) AS AMOUNT, BIN.BIN_NAME,(T1.INVOICE_QUANTITY*T1.MRP) AS AMOUNT_MRP,    
		T1.INVOICE_QUANTITY  AS PREVQTY,S.FIX_MRP,
		(CASE WHEN S.BARCODE_CODING_SCHEME=1 THEN S.PRODUCT_NAME ELSE B.ARTICLE_NAME END) AS [PRODUCT_NAME]
		,J.FORM_NAME,
		WPSM.PS_NO,WPSM.PS_DT ,EMP.EMP_NAME, EMP1.EMP_NAME AS EMP_NAME1,
		EMP2.EMP_NAME AS EMP_NAME2 ,B1.BIN_ID,B1.BIN_NAME 
		,ORDMST.ORDER_NO,ORDMST.ORDER_DT,OB.ARTICLE_NO AS ORDER_ARTICLE_NO,
		OSD.SUB_SECTION_NAME AS ORDER_SUB_SECTION_NAME,
		 OSM.SECTION_NAME AS ORDER_SECTION_NAME,OC.PARA1_NAME AS 

		 ORDER_PARA1_NAME,OD.PARA2_NAME AS ORDER_PARA2_NAME,
		 OF3.PARA3_NAME AS ORDER_PARA3_NAME,OG.PARA4_NAME AS ORDER_PARA4_NAME,OH.PARA5_NAME 

		 AS ORDER_PARA5_NAME,
		 OI.PARA6_NAME AS ORDER_PARA6_NAME,ISNULL(ORDDET.QUANTITY,0) AS 

		ORDER_QUANTITY,REFORD.ORDER_ROW_ID,REFORD.WSL_ROW_ID,
		 ORDDET.GROSS_WSP AS ORDER_RATE,B.ALIAS AS 

	ARTICLE_ALIAS,B.ARTICLE_NAME,OB.ARTICLE_NAME, RIGHT(T1.W8_CHALLAN_ID,10) AS CHALLAN_NO,
	ISNULL(J.FORM_TYPE,1) AS FORM_TYPE,S.ONLINE_PRODUCT_CODE AS ONLINE_BAR_CODE,S.VENDOR_EAN_NO AS VENDOR_EAN_NO,
	CAST('' AS varchar(40)) AS SP_ID,
	T1.PRODUCT_CODE AS ORG_PRODUCT_CODE, 
	 CAST(CASE WHEN CHARINDEX('@',T1.PRODUCT_CODE)=0 THEN '' ELSE 
	(SUBSTRING(T1.PRODUCT_CODE,CHARINDEX('@',T1.PRODUCT_CODE)+1,15)) END  AS VARCHAR(100)) AS BATCH_LOT_NO,
	   S.BATCH_NO,S.EXPIRY_DT ,
	 -- ,AT1.attr1_key_name,AT2.attr2_key_name,AT3.attr3_key_name,AT4.attr4_key_name,AT5.attr5_key_name,AT6.attr6_key_name,
	 --  AT7.attr7_key_name,AT8.attr8_key_name,AT9.attr9_key_name,AT10.attr10_key_name,AT11.attr11_key_name,AT12.attr12_key_name,
	 --  AT13.attr13_key_name,AT14.attr14_key_name,AT15.attr15_key_name,AT16.attr16_key_name,AT17.attr17_key_name,AT18.attr18_key_name,
	 --  AT19.attr19_key_name,AT20.attr20_key_name,AT21.attr21_key_name,AT22.attr22_key_name,AT23.attr23_key_name,AT24.attr24_key_name,
		--AT25.attr25_key_name ,
		T1.picklist_article_code AS packslip_article_code,
	   T1.picklist_PARA1_CODE AS packslip_para1_code,
		T1.picklist_PARA2_CODE AS packslip_para2_code,
		EMP.EMP_NAME,EMP1.EMP_NAME AS EMP1_NAME,EMP2.EMP_NAME AS EMP2_NAME,T1.LAST_UPDATE ,
		TMP.FC_NET,TMP.FC_XN_VALUE_WITHOUT_GST,TMP.FC_IGST_AMOUNT,TMP.FC_CGST_AMOUNT,TMP.FC_SGST_AMOUNT,TMP.FC_XN_VALUE_WITH_GST
		,sn.sku_item_type as ITEM_TYPE,T1.BIN_ID,sn.SN_Uom_type as UOM_TYPE,S.er_flag 
		,CAST(0 AS Numeric(14,2)) AS BASIC_DISCOUNT_AMOUNT,CAST(0 AS Numeric(14,2)) AS WEIGHTED_AVG_DISC_AMT,CAST(0 AS NUMERIC(14,2)) AS WEIGHTED_AVG_DISC_PCT,CASt('' as VARCHAR(100)) AS scheme_name
		,CASt('' as VARCHAR(100)) AS SLSDET_ROW_ID
		,CAST(0 AS BIT) AS barcodebased_flatdisc_applied,CAST(0 AS BIT) AS bngn_not_applied,CAST(0 AS BIT) AS happy_hours_applied,ISNULL(sn.SN_ARTICLE_PACK_SIZE,0) AS ARTICLE_PACK_SIZE,SN.*
		,B.sub_section_code
		FROM IND01106 T1 (NOLOCK)
		LEFT JOIN #TMPFCRATE TMP ON TMP.ROW_id=t1.row_id
		LEFT OUTER JOIN PMT01106 P (NOLOCK) ON T1.PRODUCT_CODE = P.PRODUCT_CODE AND 
		P.DEPT_ID=T1.DEPT_ID  AND P.BIN_ID=T1.BIN_ID and isnull(p.bo_order_id,'')=''  and isnull(p.Pick_list_id,'')=''
		JOIN SKU S (NOLOCK) ON S.PRODUCT_CODE = T1.PRODUCT_CODE   
		JOIN sku_names SN (NOLOCK) ON S.PRODUCT_CODE = SN.PRODUCT_CODE  
		JOIN ARTICLE B (NOLOCK) ON S.ARTICLE_CODE = B.ARTICLE_CODE    
		--JOIN SECTIOND SD (NOLOCK) ON B.SUB_SECTION_CODE = SD.SUB_SECTION_CODE  
		--JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE = SM.SECTION_CODE  
		--JOIN PARA1 C (NOLOCK) ON S.PARA1_CODE = C.PARA1_CODE    
		--JOIN PARA2 D (NOLOCK) ON S.PARA2_CODE = D.PARA2_CODE    
		--JOIN PARA3 F (NOLOCK) ON S.PARA3_CODE = F.PARA3_CODE    
		--JOIN PARA4 G (NOLOCK) ON S.PARA4_CODE = G.PARA4_CODE    
		--JOIN PARA5 H (NOLOCK) ON S.PARA5_CODE = H.PARA5_CODE    
		--JOIN PARA6 I (NOLOCK) ON S.PARA6_CODE = I.PARA6_CODE    
		JOIN UOM   E (NOLOCK) ON B.UOM_CODE = E.UOM_CODE 
		LEFT OUTER JOIN FORM J (NOLOCK)ON T1.ITEM_FORM_ID= J.FORM_ID
		LEFT OUTER JOIN BIN (NOLOCK) ON BIN.BIN_ID=T1.BIN_ID 	
		LEFT OUTER JOIN WPS_MST WPSM (NOLOCK) ON T1.PS_ID= WPSM.PS_ID  
		LEFT OUTER JOIN EMPLOYEE EMP (NOLOCK) ON T1.EMP_CODE= EMP.EMP_CODE    
		LEFT OUTER JOIN EMPLOYEE EMP1 (NOLOCK) ON T1.EMP_CODE1= EMP1.EMP_CODE    
		LEFT OUTER JOIN EMPLOYEE EMP2 (NOLOCK) ON T1.EMP_CODE2= EMP2.EMP_CODE    
		JOIN BIN B1 ON B1.BIN_ID=ISNULL(T1.BIN_ID,'000')
		LEFT OUTER JOIN WSL_ORDER_REF REFORD (NOLOCK) ON REFORD.WSL_ROW_ID=T1.ROW_ID  
		LEFT OUTER JOIN WSL_ORDER_DET ORDDET (NOLOCK) ON ORDDET.ROW_ID=REFORD.ORDER_ROW_ID 
		LEFT OUTER JOIN WSL_ORDER_MST ORDMST (NOLOCK) ON ORDMST.ORDER_ID=ORDDET.ORDER_ID
		LEFT OUTER JOIN ARTICLE OB (NOLOCK) ON ORDDET.ARTICLE_CODE = OB.ARTICLE_CODE      
		LEFT OUTER JOIN SECTIOND OSD (NOLOCK) ON OB.SUB_SECTION_CODE = OSD.SUB_SECTION_CODE    
		LEFT OUTER JOIN SECTIONM OSM (NOLOCK) ON OSD.SECTION_CODE = OSM.SECTION_CODE    
		LEFT OUTER JOIN PARA1 OC (NOLOCK) ON ORDDET.PARA1_CODE = OC.PARA1_CODE      
		LEFT OUTER JOIN PARA2 OD (NOLOCK) ON ORDDET.PARA2_CODE = OD.PARA2_CODE      
		LEFT OUTER JOIN PARA3 OF3 (NOLOCK) ON ORDDET.PARA3_CODE = OF3.PARA3_CODE      
		LEFT OUTER JOIN PARA4 OG (NOLOCK) ON ORDDET.PARA4_CODE = OG.PARA4_CODE      
		LEFT OUTER JOIN PARA5 OH (NOLOCK) ON ORDDET.PARA5_CODE = OH.PARA5_CODE      
		LEFT OUTER JOIN PARA6 OI (NOLOCK) ON ORDDET.PARA6_CODE = OI.PARA6_CODE 
		
		--LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON B.ARTICLE_CODE = ATTR.ARTICLE_CODE 
		--LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
		--LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
		--LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
		--LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
		--LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
		--LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
		--LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
		--LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
		--LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
		--LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
		--LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
		--LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
		--LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
		--LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
		--LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
		--LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
		--LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
		--LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
		--LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
		--LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
		--LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
		--LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
		--LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
		--LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
		--LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE	
		WHERE T1.INV_ID = @CMEMOID    
	ORDER BY t1.box_no, AUTO_SRNO--,T1.TS 

end