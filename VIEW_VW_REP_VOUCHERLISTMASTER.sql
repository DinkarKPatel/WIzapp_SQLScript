CREATE VIEW VW_REP_VOUCHERLISTMASTER
AS
SELECT DISTINCT VTYP.VOUCHER_TYPE,M.VOUCHER_NO,M.VOUCHER_DT,DRTOTAL,CRTOTAL,M.LAST_UPDATE POSTDATE
,REF_NO
,[CANCELLED]=CASE M.CANCELLED WHEN 0 THEN 'FALSE' ELSE 'TRUE' END   
,M.VM_ID MEMO_ID
,(SELECT TOP 1 AC.AC_NAME FROM VD01106 D(NOLOCK) JOIN LMV01106 AC(NOLOCK) ON AC.AC_CODE=D.AC_CODE WHERE M.VM_ID=D.VM_ID)AC_NAME
,(SELECT TOP 1 ISNULL(D.NARRATION,'') FROM VD01106 D(NOLOCK) WHERE M.VM_ID=D.VM_ID ORDER BY LEN(ISNULL(D.NARRATION,'')) DESC)NARRATION
,(CASE WHEN ISNULL(EDIT_COUNT,0)>0 THEN 'EDITED (' + RTRIM(LTRIM(STR(EDIT_COUNT)))+ ')' ELSE '' END ) AS EDIT_COUNT
FROM VM01106 M(NOLOCK)  
JOIN VCHTYPE VTYP (NOLOCK) ON VTYP.VOUCHER_CODE=M.VOUCHER_CODE
