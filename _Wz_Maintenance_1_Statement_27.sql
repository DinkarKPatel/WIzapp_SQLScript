IF NOT EXISTS (SELECT CONFIG_OPTION FROM CONFIG WHERE  CONFIG_OPTION='UPDATE_TOTAL_QUANTITY_1' AND VALUE=1)
BEGIN
	PRINT 'UPDATE TOTAL QUANTITY COL IN PUR,PRT,WSL,WSR'
	
	  -- UPDATING TOTALS IN PIM TABLE  
  UPDATE A SET TOTAL_QUANTITY=ISNULL(B.INVOICE_QUANTITY,0)  
  FROM PIM01106 A 
  left JOIN  
  (    
	   SELECT MRR_ID, SUM(QUANTITY) AS INVOICE_QUANTITY
	   FROM PID01106   
	   GROUP BY MRR_ID    
  ) B ON  A.MRR_ID = B.MRR_ID    
  WHERE ISNULL(A.TOTAL_QUANTITY,0)<> ISNULL(B.INVOICE_QUANTITY,0)
  
  
    -- UPDATING TOTALS IN RMM TABLE  
  UPDATE A SET TOTAL_QUANTITY=ISNULL(B.INVOICE_QUANTITY,0)  
  FROM RMM01106 A 
  LEFT  JOIN  
  (    
	   SELECT RM_ID, SUM(QUANTITY) AS INVOICE_QUANTITY
	   FROM RMD01106   
	   GROUP BY RM_ID    
  ) B ON  A.RM_ID = B.RM_ID    
  WHERE ISNULL(A.TOTAL_QUANTITY,0)<> ISNULL(B.INVOICE_QUANTITY,0)
  
  
   -- UPDATING TOTALS IN INM TABLE  
  UPDATE A SET TOTAL_QUANTITY=ISNULL(B.INVOICE_QUANTITY,0)  
  FROM INM01106 A 
  LEFT  JOIN  
  (    
	   SELECT INV_ID, SUM(QUANTITY) AS INVOICE_QUANTITY
	   FROM IND01106   
	   GROUP BY INV_ID    
  ) B ON  A.INV_ID = B.INV_ID    
  WHERE ISNULL(A.TOTAL_QUANTITY,0)<> ISNULL(B.INVOICE_QUANTITY,0)
  
  
     -- UPDATING TOTALS IN CNM TABLE  
  UPDATE A SET TOTAL_QUANTITY=ISNULL(B.INVOICE_QUANTITY,0)  
  FROM CNM01106 A 
  LEFT  JOIN  
  (    
	   SELECT CN_ID, SUM(QUANTITY) AS INVOICE_QUANTITY
	   FROM CND01106   
	   GROUP BY CN_ID    
  ) B ON  A.RM_ID = B.CN_ID    
  WHERE ISNULL(A.TOTAL_QUANTITY,0)<> ISNULL(B.INVOICE_QUANTITY,0)
      

	IF NOT EXISTS (SELECT CONFIG_OPTION FROM CONFIG WHERE  CONFIG_OPTION='UPDATE_TOTAL_QUANTITY_1')
		INSERT CONFIG (CONFIG_OPTION,VALUE,ROW_ID,LAST_UPDATE)
			   VALUES ('UPDATE_TOTAL_QUANTITY_1',1,'',GETDATE())	
	ELSE
		UPDATE CONFIG SET VALUE='1' WHERE CONFIG_OPTION='UPDATE_TOTAL_QUANTITY_1'
	
END		
