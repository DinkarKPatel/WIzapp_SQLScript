CREATE PROCEDURE SP3S_SUFFIX_ARTICLE
(
   @CPREFIX VARCHAR(100)
)
AS
BEGIN
   
         DECLARE @CPRESUFFIX VARCHAR(100),@LASTKEYVAL VARCHAR(5),@CZEROS VARCHAR(40)
         
        

       IF NOT EXISTS (SELECT TOP 1 * FROM SUFFIX_ARTICLE WHERE PREFIX=@CPREFIX)
          BEGIN
               INSERT INTO SUFFIX_ARTICLE (PREFIX,LASTKEYVAL)
               SELECT @CPREFIX,''
          END
      
         SELECT @LASTKEYVAL= CAST( RIGHT( LASTKEYVAL,5) AS BIGINT ) FROM SUFFIX_ARTICLE WHERE PREFIX=@CPREFIX
         
         SET @LASTKEYVAL = (@LASTKEYVAL + 1)
         SELECT @CZEROS = REPLICATE('0', 4 - LEN(@LASTKEYVAL))
         SELECT  @LASTKEYVAL = @CZEROS + LTRIM(RTRIM(CAST(@LASTKEYVAL AS VARCHAR(200))))
          
          UPDATE  SUFFIX_ARTICLE SET LASTKEYVAL=@LASTKEYVAL WHERE PREFIX=@CPREFIX
          
          SELECT @LASTKEYVAL
         
END
