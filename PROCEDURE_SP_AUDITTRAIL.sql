CREATE PROCEDURE SP_AUDITTRAIL      
(      
    @NQUERYID NUMERIC(3,0),        
 @CWHERE VARCHAR(500)='',      
 @CAUDITID VARCHAR(100)=''      
) 
--WITH ENCRYPTION
     
AS       
BEGIN      
      
      
IF @NQUERYID= 1              
   GOTO LBLAUDITPURCHASEINVOICE      
ELSE      
IF @NQUERYID=2              
   GOTO LBLCURRENTPURCHASEINVOICEMST       
ELSE      
IF @NQUERYID=3              
   GOTO LBLPURCHASEINVOICEMST       
ELSE      
IF @NQUERYID=4              
   GOTO LBLCURRENTPURCHASEINVOICEDET       
ELSE      
IF @NQUERYID=5             
   GOTO LBLPURCHASEINVOICEDET      
ELSE      
IF @NQUERYID=6             
   GOTO LBLAUDITDEBITNOTE      
ELSE       
IF @NQUERYID=7             
   GOTO LBLCURRENTTDEBITNOTEMST      
ELSE       
IF @NQUERYID=8             
   GOTO LBLDEBITNOTEMST      
ELSE       
IF @NQUERYID=9              
   GOTO LBLCURRENTTDEBITNOTEDET      
ELSE       
IF @NQUERYID=10             
   GOTO LBLDEBITNOTEDET          
ELSE 
IF @NQUERYID=11            
   GOTO LBLAUDITSALE
ELSE       
IF @NQUERYID=12             
   GOTO LBLCURRENTTDSALEMST      
ELSE       
IF @NQUERYID=13             
   GOTO LBLSALEMST      
ELSE       
IF @NQUERYID=14              
   GOTO LBLCURRENTTDSALEDET      
ELSE       
IF @NQUERYID=15             
   GOTO LBLSALEDET          
ELSE  
    
   GOTO LAST             
       
       
     
          
          
  LBLAUDITPURCHASEINVOICE:      
      
     DECLARE @CCMD NVARCHAR(4000)      
        
      SET @CCMD=  N'SELECT X.MRR_ID AS MEMO_ID, X.MRR_NO AS MEMO_NO, X.INV_DT AS MEMO_DT, Y.QUANTITY ,       
                   X.TOTAL_AMOUNT AS NET_AMOUNT,Z.AUDITID, Z.AUDITDATETIME, Z.USERNAME, Z.WINUSERNAME,       
                   Z.COMPUTERNAME,CAST(0 AS BIT)AS VISIT         
      FROM PIM01106 X (NOLOCK)          
      JOIN         
      (         
      SELECT MRR_ID, SUM(QUANTITY) AS QUANTITY         
      FROM PID01106 (NOLOCK)         
      GROUP BY MRR_ID         
      ) Y         
      ON X.MRR_ID = Y.MRR_ID         
      JOIN         
      (         
      SELECT A.MRR_ID, A.AUDITID, A.AUDITDATETIME, C.USERNAME, A.WINUSERNAME, A.COMPUTERNAME         
      FROM PIM01106_AUDIT A (NOLOCK)          
      JOIN         
      (         
       SELECT MRR_ID, MAX(AUDITDATETIME) AS AUDITDATETIME          
       FROM PIM01106_AUDIT (NOLOCK) GROUP BY MRR_ID         
      ) B          
      ON A.MRR_ID = B.MRR_ID AND A.AUDITDATETIME = B.AUDITDATETIME         
      JOIN USERS C (NOLOCK) ON A.WIZUSERCODE = C.USER_CODE         
      ) Z         
      ON X.MRR_ID = Z.MRR_ID ' + @CWHERE + '                                 
      ORDER BY X.INV_DT'       
         
      PRINT @CCMD                            
      EXEC SP_EXECUTESQL @CCMD        
                  
      GOTO LAST       
                  
                  
  LBLCURRENTPURCHASEINVOICEMST:       
        
		SELECT A.*,  B.AC_NAME ,  D.USERNAME,0 AS SUBTOTAL, 
		E.USERNAME AS EDIT_USERNAME, G.AC_NAME AS SUPP_NAME ,
		 G.ADDRESS1 + ' ' + G.ADDRESS2 + ', ' + G.AREA_NAME +     
    ' ' + G.CITY + ' ' + G.STATE AS 'SUPP_ADDRESS', 
     CAST(0 AS NUMERIC(10,2)) AS TOTALAMT, CAST(0 AS NUMERIC(10,2)) AS TOTALQTY,  
		DATEADD(MS, 999, A.LAST_UPDATE) AS AUDIT_DT,D.USERNAME AS CREATEBYUSER ,      
		D.USERNAME AS WIZUSERNAME, '' AS COMPUTERNAME,'' AS WINUSERNAME                     
		FROM PIM01106 A           
		JOIN LMV01106 B ON A.AC_CODE = B.AC_CODE          
		JOIN USERS D ON A.USER_CODE = D.USER_CODE          
		JOIN USERS E ON A.EDT_USER_CODE = E.USER_CODE           
		JOIN LMV01106 G ON A.AC_CODE = G.AC_CODE  
		WHERE A.MRR_ID =  @CWHERE      
         
   GOTO LAST       
         
         
  LBLPURCHASEINVOICEMST:       

		SELECT A.*, ''  AS 'SERIAL_NO', B.AC_NAME ,  D.USERNAME,0 AS SUBTOTAL,
		E.USERNAME AS EDIT_USERNAME, G.AC_NAME AS SUPP_NAME ,
		G.ADDRESS1 + ' ' + G.ADDRESS2 + ', ' + G.AREA_NAME +     
		' ' + G.CITY + ' ' + G.STATE AS 'SUPP_ADDRESS', 
		 CAST(0 AS NUMERIC(10,2)) AS TOTALAMT, CAST(0 AS NUMERIC(10,2)) AS TOTALQTY,     
		DATEADD(MS, 999, A.LAST_UPDATE) AS AUDIT_DT,D.USERNAME AS CREATEBYUSER ,      
		D.USERNAME ,AUDITDATETIME AS AUDIT_DT,D.USERNAME AS CREATEBYUSER      
		FROM PIM01106_AUDIT A           
		JOIN LMV01106 B ON A.AC_CODE = B.AC_CODE          
		JOIN USERS D ON A.USER_CODE = D.USER_CODE          
		JOIN USERS E ON A.EDT_USER_CODE = E.USER_CODE           
		JOIN USERS I ON A.WIZUSERCODE  = I.USER_CODE 
		JOIN LMV01106 G ON A.AC_CODE = G.AC_CODE          
		WHERE A.MRR_ID =  @CWHERE AND A.AUDITID=@CAUDITID       
         
         
   GOTO LAST       
         
  LBLCURRENTPURCHASEINVOICEDET:      
       
   SELECT A.* , ROW_NUMBER () OVER(  ORDER BY ROW_ID)  AS 'SERIAL_NO', B.PARA1_NAME ,C.PARA2_NAME ,
   D.PARA3_NAME ,E.PARA4_NAME ,F.PARA5_NAME , G.PARA6_NAME , (A.PURCHASE_PRICE * QUANTITY) AS 'AMOUNT',
   I.ARTICLE_NO ,  K.UOM_NAME
   FROM PID01106 A 
   JOIN  PARA1 B ON A.PARA1_CODE =  B.PARA1_CODE   
   JOIN  PARA2 C ON A.PARA2_CODE =  C.PARA2_CODE
   JOIN  PARA3 D ON A.PARA3_CODE =  D.PARA3_CODE
   JOIN  PARA4 E ON A.PARA4_CODE =  E.PARA4_CODE
   JOIN  PARA5 F ON A.PARA5_CODE =  F.PARA5_CODE
   JOIN  PARA6 G ON A.PARA6_CODE =  G.PARA6_CODE
   JOIN ARTICLE I ON A.ARTICLE_CODE = I.ARTICLE_CODE
   JOIN UOM K ON I.UOM_CODE = K.UOM_CODE
   WHERE A.MRR_ID =  @CWHERE      
   GOTO LAST       
                  
                  
                  
  LBLPURCHASEINVOICEDET:      
        
        
  SELECT A.*, ROW_NUMBER () OVER(  ORDER BY ROW_ID)  AS 'SERIAL_NO', B.PARA1_NAME ,C.PARA2_NAME ,D.PARA3_NAME ,E.PARA4_NAME ,F.PARA5_NAME , G.PARA6_NAME ,
   I.ARTICLE_NO , K.UOM_NAME, (A.PURCHASE_PRICE * QUANTITY) AS 'AMOUNT'
   FROM PID01106_AUDIT A 
   JOIN  PARA1 B ON A.PARA1_CODE =  B.PARA1_CODE   
   JOIN  PARA2 C ON A.PARA2_CODE =  C.PARA2_CODE
   JOIN  PARA3 D ON A.PARA3_CODE =  D.PARA3_CODE
   JOIN  PARA4 E ON A.PARA4_CODE =  E.PARA4_CODE
   JOIN  PARA5 F ON A.PARA5_CODE =  F.PARA5_CODE
   JOIN  PARA6 G ON A.PARA6_CODE =  G.PARA6_CODE
   JOIN ARTICLE I ON A.ARTICLE_CODE = I.ARTICLE_CODE
   JOIN UOM K ON I.UOM_CODE = K.UOM_CODE
   WHERE A.MRR_ID =  @CWHERE AND A.AUDITID=@CAUDITID      
  GOTO LAST       
LBLAUDITDEBITNOTE:      
            
   SET @CCMD=  N'SELECT X.RM_ID AS MEMO_ID, X.RM_NO AS MEMO_NO, X.RM_DT AS MEMO_DT, Y.QUANTITY ,       
                   X.TOTAL_AMOUNT AS NET_AMOUNT,Z.AUDITID, Z.AUDITDATETIME, Z.USERNAME, Z.WINUSERNAME,       
                   Z.COMPUTERNAME,CAST(0 AS BIT)AS VISIT         
      FROM RMM01106 X (NOLOCK)          
      JOIN         
      (         
      SELECT RM_ID, SUM(QUANTITY) AS QUANTITY         
      FROM RMD01106 (NOLOCK)         
      GROUP BY RM_ID         
      ) Y         
      ON X.RM_ID = Y.RM_ID         
      JOIN         
      (         
      SELECT A.RM_ID, A.AUDITID, A.AUDITDATETIME, C.USERNAME, A.WINUSERNAME, A.COMPUTERNAME         
      FROM RMM01106_AUDIT A (NOLOCK)          
      JOIN         
      (         
       SELECT RM_ID, MAX(AUDITDATETIME) AS AUDITDATETIME          
       FROM RMM01106_AUDIT (NOLOCK) GROUP BY RM_ID         
      ) B          
      ON A.RM_ID = B.RM_ID AND A.AUDITDATETIME = B.AUDITDATETIME         
      JOIN USERS C (NOLOCK) ON A.WIZUSERCODE = C.USER_CODE         
      ) Z         
      ON X.RM_ID = Z.RM_ID ' + @CWHERE + '                                 
      ORDER BY X.RM_DT'       
         
   PRINT @CCMD                            
            EXEC SP_EXECUTESQL @CCMD         
         
   GOTO LAST         
         
         
LBLCURRENTTDEBITNOTEMST:      
       
  SELECT A.*,B.AC_NAME AS SUPP_NAME ,
		B.ADDRESS1 + ' ' + B.ADDRESS2 + ', ' + B.AREA_NAME +     
		' ' + B.CITY + ' ' + B.STATE AS 'SUPP_ADDRESS' ,  D.USERNAME,0 AS SUBTOTAL, 
      E.USERNAME AS EDIT_USERNAME,  CAST(0 AS NUMERIC(10,2)) AS TOTALAMT, CAST(0 AS NUMERIC(10,2)) AS TOTALQTY,
     DATEADD(MS, 999, A.LAST_UPDATE) AS AUDIT_DT,D.USERNAME AS CREATEBYUSER ,      
     D.USERNAME AS WIZUSERNAME, '' AS COMPUTERNAME,'' AS WINUSERNAME            
    FROM RMM01106 A           
    JOIN LMV01106 B ON A.AC_CODE = B.AC_CODE          
    JOIN USERS D ON A.USER_CODE = D.USER_CODE          
    JOIN USERS E ON A.EDT_USER_CODE = E.USER_CODE           

    WHERE A.RM_ID =  @CWHERE    
       
       
           GOTO LAST      
                 
 LBLDEBITNOTEMST:     
       
   SELECT A.*,B.AC_NAME AS SUPP_NAME ,
		B.ADDRESS1 + ' ' + B.ADDRESS2 + ', ' + B.AREA_NAME +     
		' ' + B.CITY + ' ' + B.STATE AS 'SUPP_ADDRESS' ,  D.USERNAME,0 AS SUBTOTAL, '' AS FORM_NAME,          
      E.USERNAME AS EDIT_USERNAME, CAST(0 AS NUMERIC(10,2)) AS  TOTALAMT, CAST(0 AS NUMERIC(10,2)) AS TOTALQTY,     
     DATEADD(MS, 999, A.LAST_UPDATE) AS AUDIT_DT,D.USERNAME AS CREATEBYUSER     
    FROM RMM01106_AUDIT A           
    JOIN LMV01106 B ON A.AC_CODE = B.AC_CODE          
    JOIN USERS D ON A.USER_CODE = D.USER_CODE          
    JOIN USERS E ON A.EDT_USER_CODE = E.USER_CODE          
         
   WHERE A.RM_ID =  @CWHERE AND A.AUDITID=@CAUDITID       
       
       
   GOTO LAST      
                 
LBLCURRENTTDEBITNOTEDET:      
      
    --SELECT  A.*       
    --FROM RMD01106 A 
     SELECT A.*, ROW_NUMBER() OVER(ORDER BY ROW_ID)  AS 'SERIAL_NO', B.PARA1_NAME ,C.PARA2_NAME ,
     D.PARA3_NAME ,E.PARA4_NAME ,F.PARA5_NAME , G.PARA6_NAME ,
   I.ARTICLE_NO, I.ARTICLE_DESC , K.UOM_NAME,(A.QUANTITY*A.PURCHASE_PRICE) AS AMOUNT,
   CONVERT(VARCHAR, SKU.INV_DT, 105) AS 'INV_DT', SKU.INV_NO
   FROM RMD01106 A
   JOIN SKU ON A.PRODUCT_CODE = SKU.PRODUCT_CODE 
   JOIN  PARA1 B ON SKU.PARA1_CODE =  B.PARA1_CODE   
   JOIN  PARA2 C ON SKU.PARA2_CODE =  C.PARA2_CODE
   JOIN  PARA3 D ON SKU.PARA3_CODE =  D.PARA3_CODE
   JOIN  PARA4 E ON SKU.PARA4_CODE =  E.PARA4_CODE
   JOIN  PARA5 F ON SKU.PARA5_CODE =  F.PARA5_CODE
   JOIN  PARA6 G ON SKU.PARA6_CODE =  G.PARA6_CODE
   JOIN ARTICLE I ON SKU.ARTICLE_CODE = I.ARTICLE_CODE
   JOIN UOM K ON I.UOM_CODE = K.UOM_CODE
    WHERE A.RM_ID = @CWHERE       
      
   GOTO LAST      
                 
	LBLDEBITNOTEDET:      
			SELECT A.*, ROW_NUMBER() OVER(ORDER BY A.TS)  AS 'SERIAL_NO', B.PARA1_NAME ,C.PARA2_NAME ,D.PARA3_NAME ,E.PARA4_NAME ,F.PARA5_NAME , G.PARA6_NAME ,
			I.ARTICLE_NO , I.ARTICLE_DESC , K.UOM_NAME, A.PURCHASE_PRICE*A.QUANTITY AS AMOUNT,
			CONVERT(VARCHAR, SKU.INV_DT, 105) AS 'INV_DT',  SKU.INV_NO 
			FROM RMD01106_AUDIT A
			JOIN SKU ON A.PRODUCT_CODE = SKU.PRODUCT_CODE 
			JOIN  PARA1 B ON SKU.PARA1_CODE =  B.PARA1_CODE   
			JOIN  PARA2 C ON SKU.PARA2_CODE =  C.PARA2_CODE
			JOIN  PARA3 D ON SKU.PARA3_CODE =  D.PARA3_CODE
			JOIN  PARA4 E ON SKU.PARA4_CODE =  E.PARA4_CODE
			JOIN  PARA5 F ON SKU.PARA5_CODE =  F.PARA5_CODE
			JOIN  PARA6 G ON SKU.PARA6_CODE =  G.PARA6_CODE
			JOIN ARTICLE I ON SKU.ARTICLE_CODE = I.ARTICLE_CODE
			JOIN UOM K ON I.UOM_CODE = K.UOM_CODE
			WHERE A.RM_ID = @CWHERE  AND A.AUDITID=@CAUDITID      
   GOTO LAST  
   LBLAUDITSALE:      
		   SET @CCMD=  N'SELECT X.CM_ID AS MEMO_ID, X.CM_NO AS MEMO_NO, X.CM_DT AS MEMO_DT, Y.QUANTITY ,       
						   X.NET_AMOUNT AS NET_AMOUNT,Z.AUDITID, Z.AUDITDATETIME, Z.USERNAME, Z.WINUSERNAME,       
						   Z.COMPUTERNAME,CAST(0 AS BIT)AS VISIT         
						FROM CMM01106 X (NOLOCK)          
						JOIN         
							(         
								SELECT CM_ID, SUM(QUANTITY) AS QUANTITY         
								FROM CMD01106 (NOLOCK)         
								GROUP BY CM_ID         
							) Y ON X.CM_ID = Y.CM_ID         
						JOIN         
							(         
								SELECT A.CM_ID, A.AUDITID, A.AUDITDATETIME, C.USERNAME, A.WINUSERNAME, A.COMPUTERNAME         
								FROM CMM01106_AUDIT A (NOLOCK)          
								JOIN         
									(         
										SELECT CM_ID, MAX(AUDITDATETIME) AS AUDITDATETIME          
										FROM CMM01106_AUDIT (NOLOCK) GROUP BY CM_ID         
									) B ON A.CM_ID = B.CM_ID AND A.AUDITDATETIME = B.AUDITDATETIME         
									JOIN USERS C (NOLOCK) ON A.WIZUSERCODE = C.USER_CODE         
						 ) Z ON X.CM_ID = Z.CM_ID  ' + @CWHERE + '                                
						ORDER BY X.CM_DT'       
		         
		   PRINT @CCMD                            
		   EXEC SP_EXECUTESQL @CCMD         
   GOTO LAST  
   LBLCURRENTTDSALEMST:
			SELECT A.*, B.*, '' AS CUSTOMER_NAME, '' AS CREDIT_CARD_NAME , C.USERNAME, '' AS ADDRESS,  
			ISNULL(ST.STATE,'') AS [STATE],ISNULL(AR.AREA_NAME,'') AS  AREA,  
			ISNULL(CI.CITY,'') AS CITY,ISNULL(AR.PINCODE,'') AS PINCODE,CAST(0 AS BIT) AS CREDIT_REFUND ,
			C.USERNAME AS CREATEBYUSER,C.USERNAME AS WIZUSERNAME, '' AS COMPUTERNAME,'' AS WINUSERNAME ,   
			DATEADD(MS, 999, A.LAST_UPDATE) AS AUDIT_DT
			FROM CMM01106 A   
			JOIN CUSTDYM B ON B.CUSTOMER_CODE=A.CUSTOMER_CODE   
			LEFT OUTER JOIN AREA AR ON AR.AREA_CODE=B.AREA_CODE  
			LEFT OUTER JOIN CITY CI ON CI.CITY_CODE=AR.CITY_CODE  
			LEFT OUTER JOIN STATE ST ON ST.STATE_CODE=CI.STATE_CODE  
			JOIN USERS C ON C.USER_CODE=A.USER_CODE  
			WHERE  A.CM_ID=@CWHERE 
   GOTO LAST 
   LBLSALEMST:
			SELECT A.*, B.*, '' AS CUSTOMER_NAME, '' AS CREDIT_CARD_NAME , C.USERNAME, '' AS ADDRESS,  
			ISNULL(ST.STATE,'') AS [STATE],ISNULL(AR.AREA_NAME,'') AS  AREA,  
			ISNULL(CI.CITY,'') AS CITY,ISNULL(AR.PINCODE,'') AS PINCODE,CAST(0 AS BIT) AS CREDIT_REFUND ,
			C.USERNAME AS CREATEBYUSER  
			FROM CMM01106_AUDIT A   
			JOIN CUSTDYM B ON B.CUSTOMER_CODE=A.CUSTOMER_CODE   
			LEFT OUTER JOIN AREA AR ON AR.AREA_CODE=B.AREA_CODE  
			LEFT OUTER JOIN CITY CI ON CI.CITY_CODE=AR.CITY_CODE  
			LEFT OUTER JOIN STATE ST ON ST.STATE_CODE=CI.STATE_CODE  
			JOIN USERS C ON C.USER_CODE=A.USER_CODE  
			WHERE  A.CM_ID=@CWHERE 
   
   GOTO LAST 
   LBLCURRENTTDSALEDET:
			SELECT  A.*,ROW_NUMBER() OVER (ORDER BY A.TS) AS SRNO,  
			EMP.EMP_NAME, A.PRODUCT_CODE, B.ARTICLE_CODE, B.ARTICLE_NO, B.ARTICLE_NAME, S.PARA1_CODE,  
		   C.PARA1_NAME, S.PARA2_CODE, D.PARA2_NAME, S.PARA3_CODE, F.PARA3_NAME, E.UOM_NAME,     
		   LEFT(A.CM_ID,2) AS DEPT_ID, S.BARCODE_CODING_SCHEME AS CODING_SCHEME,  B.INACTIVE, 0 AS QUANTITY_IN_STOCK,  
		   S.PURCHASE_PRICE,  S.MRP,S.WS_PRICE,  '' AS SCHEME_ID, SM.SECTION_NAME, SD.SUB_SECTION_NAME,  
		   S.PARA4_CODE,S.PARA5_CODE,S.PARA6_CODE,  
		   PARA4_NAME,PARA5_NAME,PARA6_NAME,E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],  
		   B.DT_CREATED AS [ART_DT_CREATED],F.DT_CREATED AS [PARA3_DT_CREATED],S.DT_CREATED AS [SKU_DT_CREATED],  
		   B.STOCK_NA,   
			CONVERT (BIT,(CASE WHEN A.QUANTITY <0 THEN 1 ELSE 0 END)) AS SALERETURN ,CAST(0 AS BIT) AS CREDIT_REFUND  
			FROM  CMD01106  A   
			 JOIN SKU S ON A.PRODUCT_CODE = S.PRODUCT_CODE   
			 JOIN ARTICLE B ON S.ARTICLE_CODE = B.ARTICLE_CODE    
			 JOIN SECTIOND SD ON B.SUB_SECTION_CODE = SD.SUB_SECTION_CODE  
			 JOIN SECTIONM SM ON SD.SECTION_CODE = SM.SECTION_CODE  
			 JOIN PARA1 C ON S.PARA1_CODE = C.PARA1_CODE    
			 JOIN PARA2 D ON S.PARA2_CODE = D.PARA2_CODE    
			 JOIN PARA3 F ON S.PARA3_CODE = F.PARA3_CODE    
			 JOIN PARA4 G ON S.PARA4_CODE = G.PARA4_CODE    
			 JOIN PARA5 H ON S.PARA5_CODE = H.PARA5_CODE    
			 JOIN PARA6 I ON S.PARA6_CODE = I.PARA6_CODE    
			 JOIN UOM   E ON B.UOM_CODE = E.UOM_CODE   
			JOIN EMPLOYEE EMP ON A.EMP_CODE = EMP.EMP_CODE   
			WHERE A.CM_ID=@CWHERE     
			ORDER BY  ROW_NUMBER() OVER (ORDER BY A.TS)
   GOTO LAST 
   LBLSALEDET:
			SELECT  A.*,ROW_NUMBER() OVER (ORDER BY A.TS) AS SRNO,  
			EMP.EMP_NAME, A.PRODUCT_CODE, B.ARTICLE_CODE, B.ARTICLE_NO, B.ARTICLE_NAME, S.PARA1_CODE,  
		   C.PARA1_NAME, S.PARA2_CODE, D.PARA2_NAME, S.PARA3_CODE, F.PARA3_NAME, E.UOM_NAME,     
		   LEFT(A.CM_ID,2) AS DEPT_ID, S.BARCODE_CODING_SCHEME AS CODING_SCHEME,  B.INACTIVE, 0 AS QUANTITY_IN_STOCK,  
		   S.PURCHASE_PRICE,  S.MRP,S.WS_PRICE,  '' AS SCHEME_ID, SM.SECTION_NAME, SD.SUB_SECTION_NAME,  
		   S.PARA4_CODE,S.PARA5_CODE,S.PARA6_CODE,  
		   PARA4_NAME,PARA5_NAME,PARA6_NAME,E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],  
		   B.DT_CREATED AS [ART_DT_CREATED],F.DT_CREATED AS [PARA3_DT_CREATED],S.DT_CREATED AS [SKU_DT_CREATED],  
		   B.STOCK_NA,   
			CONVERT (BIT,(CASE WHEN A.QUANTITY <0 THEN 1 ELSE 0 END)) AS SALERETURN ,CAST(0 AS BIT) AS CREDIT_REFUND  
			FROM  CMD01106_AUDIT  A   
			 JOIN SKU S ON A.PRODUCT_CODE = S.PRODUCT_CODE   
			 JOIN ARTICLE B ON S.ARTICLE_CODE = B.ARTICLE_CODE    
			 JOIN SECTIOND SD ON B.SUB_SECTION_CODE = SD.SUB_SECTION_CODE  
			 JOIN SECTIONM SM ON SD.SECTION_CODE = SM.SECTION_CODE  
			 JOIN PARA1 C ON S.PARA1_CODE = C.PARA1_CODE    
			 JOIN PARA2 D ON S.PARA2_CODE = D.PARA2_CODE    
			 JOIN PARA3 F ON S.PARA3_CODE = F.PARA3_CODE    
			 JOIN PARA4 G ON S.PARA4_CODE = G.PARA4_CODE    
			 JOIN PARA5 H ON S.PARA5_CODE = H.PARA5_CODE    
			 JOIN PARA6 I ON S.PARA6_CODE = I.PARA6_CODE    
			 JOIN UOM   E ON B.UOM_CODE = E.UOM_CODE   
			JOIN EMPLOYEE EMP ON A.EMP_CODE = EMP.EMP_CODE   
			WHERE A.CM_ID=@CWHERE     
			ORDER BY  ROW_NUMBER() OVER (ORDER BY A.TS)
	GOTO LAST  
	LAST:        
END
