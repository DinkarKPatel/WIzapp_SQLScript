CREATE PROCEDURE SP_SAVEPARTYMRP_WSL
@CMEMO_ID VARCHAR(MAX),
@NSPID	NUMERIC(5)
--WITH ENCRYPTION

AS
BEGIN

	DECLARE @CTABLE1 VARCHAR(MAX),@CCMD NVARCHAR(MAX)
	DECLARE @CERRORMSG VARCHAR(MAX) 
	SET @CTABLE1='TEMP_IND01106_'+LTRIM(RTRIM(STR(@NSPID)))
	
	IF OBJECT_ID(@CTABLE1,'U') IS NULL
	BEGIN
		PRINT @CTABLE1 +' NOT FOUND '
		SET @CERRORMSG=@CTABLE1 +' NOT FOUND '
		GOTO END_PROC
	END
		
	BEGIN TRANSACTION  
   
	 BEGIN TRY 
		UPDATE IND01106 SET PARTY_MRP=0 WHERE INV_ID=@CMEMO_ID
		EXEC SP_EXECUTESQL @CCMD  

		SET @CCMD=N'UPDATE A SET A.PARTY_MRP=B.PARTY_MRP 
				FROM IND01106 A
				JOIN '+@CTABLE1+' B ON B.ROW_ID=A.ROW_ID
				WHERE A.INV_ID='''+@CMEMO_ID+''''
		EXEC SP_EXECUTESQL @CCMD  
	 END TRY  
	 BEGIN CATCH  
		SET @CERRORMSG = 'PROCEDURE SP_SAVEPARTYMRP_WSL:  SQL ERROR: #' + LTRIM(STR(ERROR_NUMBER())) + ' ' + ERROR_MESSAGE()  
		GOTO END_PROC  
	 END CATCH  
   
END_PROC:  

	IF @@TRANCOUNT>0   
	BEGIN  
		IF ISNULL(@CERRORMSG,'')=''  
			COMMIT TRANSACTION  
		ELSE  
			ROLLBACK  
	END  

	SELECT 	ISNULL(@CERRORMSG,'') AS [ERRMSG]	

END
