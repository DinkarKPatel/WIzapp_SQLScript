CREATE PROCEDURE SP3S_DROP_CONS_FOR_FN_CHECKNAMESLOC
AS
BEGIN
     DECLARE @CCMD NVARCHAR(MAX),@CTABLENAME VARCHAR(500),@CCONSTNAME VARCHAR(100),
     @CCAPTION VARCHAR(100)
IF CURSOR_STATUS('GLOBAL','FNCHKCONSTCUR') IN (0,1)  
		BEGIN  
		   CLOSE FNCHKCONSTCUR  
		   DEALLOCATE FNCHKCONSTCUR  
		END  
		
		DECLARE FNCHKCONSTCUR CURSOR FOR 
		SELECT OBJECT_NAME(B.PARENT_OBJ) AS TABLE_NAME,OBJECT_NAME(B.ID) AS CONSTRAINT_NAME
                            FROM SYS.SYSCONSTRAINTS A
                            JOIN SYS.SYSOBJECTS B ON B.ID=A.CONSTID
                            JOIN SYS.SYSCOMMENTS C ON C.ID=A.CONSTID
                            WHERE B.XTYPE='C' AND C.TEXT LIKE '%FN_CHECKNAMESLOC%' 
                            
        
        OPEN FNCHKCONSTCUR
		FETCH NEXT FROM FNCHKCONSTCUR INTO @CTABLENAME,@CCONSTNAME
		WHILE @@FETCH_STATUS=0
		BEGIN
			SET @CCMD=N'ALTER TABLE '+@CTABLENAME+' DROP CONSTRAINT '+@CCONSTNAME
			PRINT @CCMD
			
			EXEC SP_EXECUTESQL @CCMD
			
			
			FETCH NEXT FROM FNCHKCONSTCUR INTO @CTABLENAME,@CCONSTNAME
		END
		
		CLOSE FNCHKCONSTCUR
		DEALLOCATE FNCHKCONSTCUR
		
END
