CREATE VIEW DBO.VW_SPPPC_FG_ISSUE_BAROCDE
AS
SELECT CAST(PR.MISSING_PRODUCT_CODE AS BIT) AS CHK,  
   PR.MEMO_ID AS MEMO_ID,  
      ROW_ID=PR.ROW_ID,  
   A.AC_CODE,LM.AC_NAME ,  
   DET.BILL_NO,  
   DET.ARTICLE_CODE,ART.ARTICLE_NO,ART.ARTICLE_NAME,  
      B.SIZEGROUP_CODE,SG.SIZEGROUP_NAME ,  
      B.PARA1_CODE,P1.PARA1_NAME AS COLOR,  
   B.PARA3_CODE,P3.PARA3_NAME BUYER_STYLE_NO,  
   SKU.PARA2_CODE,P2.PARA2_NAME SIZE,  
   PR.JOB_CODE,  
   PR.JOB_NAME,  
   PR.PRODUCT_CODE,  
   PR.QUANTITY AS QUANTITY,  
   PR.MISSING_PRODUCT_CODE,  
   PR.MEMO_NO,PR.MEMO_DT,
   ISNULL(DET.WSL_REMARKS,'') AS WSL_REMARKS  
     FROM PPC_FGBCG_MST A  
  JOIN PPC_FGBCG_DET B ON A.MEMO_ID =B.MEMO_ID   
  JOIN PPC_FG_SKU SKU ON SKU.PPC_FGBCG_DET_ROW_ID=B.ROW_ID   
  JOIN  
  (  
    SELECT  B.AC_CODE,A.ARTICLE_CODE ,A.ITEM_REMARKS AS WSL_REMARKS,  
    ROW_ID,B.BILL_NO FROM PPC_BUYER_ORDER_DET A  
    JOIN PPC_BUYER_ORDER_MST B ON A.ORDER_ID=B.ORDER_ID  
    WHERE B.CANCELLED=0  
    GROUP BY B.AC_CODE,A.ARTICLE_CODE ,ROW_ID,B.BILL_NO,A.ITEM_REMARKS  
  ) DET ON DET.ROW_ID=B.BO_DET_ROW_ID   
  JOIN ARTICLE ART ON ART.ARTICLE_CODE =SKU.ARTICLE_CODE   
  JOIN PARA1 P1 ON P1.PARA1_CODE =SKU.PARA1_CODE   
  JOIN PARA2 P2 ON P2.PARA2_CODE =SKU.PARA2_CODE   
  JOIN PARA3 P3 ON P3.PARA3_CODE =SKU.PARA3_CODE   
  JOIN PPC_SIZEGROUP SG ON SG.SIZEGROUP_CODE =SKU.SIZEGROUP_CODE   
  JOIN LM01106 LM ON LM.AC_CODE =A.AC_CODE   
  JOIN  
  (  
   SELECT  A.MISSING_PRODUCT_CODE, JOBS.JOB_CODE,JOBS.JOB_NAME,A.ROW_ID,  
   B.MEMO_ID,B.MEMO_NO,B.MEMO_DT, PRODUCT_CODE,QUANTITY AS QUANTITY  
   FROM PPC_AGENCY_ISSUE_FG_DET  A  
   JOIN PPC_AGENCY_ISSUE_FG_MST B ON A.MEMO_ID =B.MEMO_ID   
   JOIN JOBS  ON B.JOB_CODE=JOBS.JOB_CODE  
   WHERE B.CANCELLED=0  
   --AND A.MEMO_ID=@CMEMO_ID  
  ) PR ON PR.PRODUCT_CODE =SKU.PRODUCT_CODE
