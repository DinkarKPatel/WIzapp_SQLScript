

--**** UPDATING DAY CLOSE DATE COLUMN IN LOCATION MASTER
IF NOT EXISTS (SELECT CONFIG_OPTION FROM CONFIG WHERE 
			   CONFIG_OPTION='UPDATE_DAYCLOSE_DATE_LOCATION' AND VALUE=1)
BEGIN
	PRINT 'RE-SETTING LOCDTR ENTRIES'
	DECLARE @CCURLOCID CHAR(2),@CHOLOCID CHAR(2),@CDAYCLOSEDATE VARCHAR(15),@CENDOFDAY VARCHAR(2)

	SELECT TOP 1 @CCURLOCID = VALUE FROM CONFIG WHERE CONFIG_OPTION = 'LOCATION_ID'
	SELECT TOP 1 @CHOLOCID = VALUE FROM CONFIG WHERE CONFIG_OPTION = 'HO_LOCATION_ID'

	SELECT TOP 1 @CENDOFDAY=VALUE FROM CONFIG WHERE  CONFIG_OPTION='ENABLE_END_OF_DAY'
	
	
	IF NOT EXISTS (SELECT CONFIG_OPTION FROM CONFIG WHERE CONFIG_OPTION='UPDATE_DAYCLOSE_DATE_LOCATION')
		INSERT CONFIG (CONFIG_OPTION,VALUE,ROW_ID,LAST_UPDATE)
			   VALUES ('UPDATE_DAYCLOSE_DATE_LOCATION',1,'',GETDATE())	
	ELSE
		UPDATE CONFIG SET VALUE=1 WHERE CONFIG_OPTION='UPDATE_DAYCLOSE_DATE_LOCATION'
	
	SELECT TOP 1 @CDAYCLOSEDATE= VALUE FROM CONFIG WHERE CONFIG_OPTION='LAST_RUN_DATE'
	ORDER BY LAST_UPDATE DESC
	
	IF @CCURLOCID<>@CHOLOCID
		UPDATE LOCATION SET DAY_CLOSE_DT=CONVERT(DATETIME,CONVERT(VARCHAR,GETDATE(),110),110)-1
		WHERE DEPT_ID=@CCURLOCID
	ELSE
		UPDATE LOCATION SET DAY_CLOSE_DT=CONVERT(DATETIME,CONVERT(VARCHAR,GETDATE(),110),110)-1
		
	DELETE FROM XFERLOG WHERE XN_TYPE='XNSDTR'	
	
	DELETE FROM LOC_DTRECON_REQ
	
	DELETE FROM LOC_DTRECON
END
