create PROCEDURE SP_SEND_MIRROR_WSLORD_DATA_NEW
(	
	 @CUPLOADEDXNID VARCHAR(50)
	,@CCURLOCID VARCHAR(5)	
	 ,@BACKNOWLEDGE BIT =0
	,@CERRMSG VARCHAR(1000) OUTPUT
)	
----WITH ENCRYPTION
AS
/*
	SP_SEND_MIRROR_WSLORD_DATA_NEW_208_05_02_14 : THIS PROCEDURE WILL SEND WHOLESALE ORDER DATA FROM LOCATION TO HO.
*/
BEGIN
	DECLARE @DTSQL NVARCHAR(MAX),@CSPID VARCHAR(10),@CTEMPTABLE VARCHAR(500),@CMEMOID VARCHAR(50),
	@CTEMPMASTERTABLE VARCHAR(200),@CTEMPLMTABLE VARCHAR(200),@CTEMPLMPTABLE VARCHAR(200)
	,@CTEMPAREATABLE VARCHAR(200),@CTEMPCITYTABLE VARCHAR(200),@CTEMPDETTABLE VARCHAR(200),@CTEMPEMPTABLE VARCHAR(200)
	,@CTEMPPAYTABLE VARCHAR(200),@CTEMPPMSTTABLE VARCHAR(200)
	,@DMEMOLASTUPDATE DATETIME,@CTABLENAME VARCHAR(100),@BRECFOUND BIT,@CSTEP VARCHAR(5),@CFILTERCONDITION VARCHAR(MAX)
	,@CKEYFIELD VARCHAR(100)

	DECLARE @TXNSSENDINFO TABLE (ORG_TABLENAME VARCHAR(500),TMP_TABLENAME VARCHAR(500),XN_ID VARCHAR(40))  	
BEGIN TRY 	
	---- CALL ACKNOWLEDGEMENT OF MEMO SUCCESSFUL MERGING AT MIRRORING SERVER
	SET @CSTEP=0
	DECLARE @CTEMPDBNAME VARCHAR(40)
	SET @CTEMPDBNAME=''
    		
    
    	
	SELECT TOP 1 @CCURLOCID=VALUE FROM CONFIG WHERE CONFIG_OPTION='LOCATION_ID'	
	SET @CSTEP=20
	--CHANGE BY BAIJNATH
	SET @CMEMOID=@CUPLOADEDXNID
 
	---- IF NO MEMO FOUND , JUST END THE PROCESS
	IF ISNULL(@CMEMOID,'')=''
		GOTO END_PROC
LBLTABLEINFO:
	SET @CSTEP=50

	SET @CSTEP=220
	---- SEND THE WSLORD MEMO MASTER TABLE
	
	SELECT DISTINCT  A.*,'WSLORD_WSL_ORDER_MST_UPLOAD' AS TARGET_TABLENAME FROM WSL_ORDER_MST A (NOLOCK)
	WHERE A.order_id =@CMEMOID
	
	SET @CSTEP=245
	---- SEND THE WSL_ORDER_DET RELATED TO WSLORD TABLE
	 SELECT DISTINCT A.*,'WSLORD_WSL_ORDER_DET_UPLOAD' AS TARGET_TABLENAME FROM WSL_ORDER_DET A (NOLOCK)
	 WHERE A.order_id =@CMEMOID

	SET @CSTEP=250
	---- SEND THE WSL_ORDER_BOM RELATED TO WSLORD TABLE

	 SELECT DISTINCT A.*,'WSLORD_WSL_ORDER_BOM_UPLOAD' AS TARGET_TABLENAME,@CMEMOID AS WSLORD_MEMO_ID FROM WSL_ORDER_BOM A (NOLOCK)
	 JOIN WSL_ORDER_DET B ON A.ref_row_id =B.row_id 
	 WHERE B.order_id=@CMEMOID

	SET @CSTEP=255
	---- SEND THE WSL_ORDER_ADV_RECEIPT RELATED TO WSLORD TABLE 
	SET @CTABLENAME='WSL_ORDER_ADV_RECEIPT'
	 SELECT DISTINCT A.*,'WSLORD_WSL_ORDER_ADV_RECEIPT_UPLOAD' AS TARGET_TABLENAME FROM WSL_ORDER_ADV_RECEIPT A (NOLOCK)
	 WHERE A.order_id =@CMEMOID
	
	SET @CSTEP=260
	---- SEND THE TDD01106 RELATED TO WSLORD TABLE
	
	 SELECT DISTINCT A.*,'WSLORD_TDD01106_UPLOAD' AS TARGET_TABLENAME,@CMEMOID AS WSLORD_MEMO_ID FROM TDD01106 A (NOLOCK)
	 JOIN WSL_ORDER_DET B (NOLOCK) ON A.tmd_row_id  =B.row_id 
	 WHERE B.order_id=@CMEMOID
	
	SET @CSTEP=320

	---- SEND THE ARTICLE RELATED TO WSLORD TABLE
	 SELECT DISTINCT A.*,'WSLORD_ARTICLE_UPLOAD' AS TARGET_TABLENAME,@CMEMOID AS WSLORD_MEMO_ID FROM ARTICLE A (NOLOCK)
	 JOIN WSL_ORDER_DET B ON A.ARTICLE_CODE  =B.ARTICLE_CODE 
	 WHERE B.order_id=@CMEMOID
	
	SET @CSTEP=330
	---- SEND THE PARA1 RELATED TO WSLORD TABLE
	 SELECT DISTINCT A.*,'WSLORD_PARA1_UPLOAD' AS TARGET_TABLENAME,@CMEMOID AS WSLORD_MEMO_ID FROM PARA1 A (NOLOCK)
	 JOIN WSL_ORDER_DET B (NOLOCK) ON A.PARA1_CODE  =B.PARA1_CODE 
	 WHERE B.order_id=@CMEMOID
	
	
	SET @CSTEP=340
	---- SEND THE PARA2 RELATED TO WSLORD TABLE
	 SELECT DISTINCT A.*,'WSLORD_PARA2_UPLOAD' AS TARGET_TABLENAME,@CMEMOID AS WSLORD_MEMO_ID FROM PARA2 A (NOLOCK)
	 JOIN WSL_ORDER_DET B (NOLOCK) ON A.PARA2_CODE  =B.PARA2_CODE 
	 WHERE B.order_id=@CMEMOID
	
	SET @CSTEP=350
	---- SEND THE PARA3 RELATED TO WSLORD TABLE
	SELECT DISTINCT A.*,'WSLORD_PARA3_UPLOAD' AS TARGET_TABLENAME,@CMEMOID AS WSLORD_MEMO_ID FROM PARA3 A (NOLOCK)
	 JOIN WSL_ORDER_DET B (NOLOCK) ON A.PARA3_CODE  =B.PARA3_CODE 
	 WHERE B.order_id=@CMEMOID
	
	SET @CSTEP=360
	---- SEND THE PARA4 RELATED TO WSLORD TABLE
	SELECT DISTINCT A.*,'WSLORD_PARA4_UPLOAD' AS TARGET_TABLENAME,@CMEMOID AS WSLORD_MEMO_ID FROM PARA4 A (NOLOCK)
	 JOIN WSL_ORDER_DET B (NOLOCK) ON A.PARA4_CODE  =B.PARA4_CODE 
	 WHERE B.order_id=@CMEMOID
	
	
	SET @CSTEP=370
	---- SEND THE PARA5 RELATED TO WSLORD TABLE
	SELECT DISTINCT A.*,'WSLORD_PARA5_UPLOAD' AS TARGET_TABLENAME,@CMEMOID AS WSLORD_MEMO_ID FROM PARA5 A (NOLOCK)
	 JOIN WSL_ORDER_DET B (NOLOCK) ON A.PARA5_CODE  =B.PARA5_CODE 
	 WHERE B.order_id=@CMEMOID
	
	
	SET @CSTEP=380
	---- SEND THE PARA6 RELATED TO WSLORD TABLE
	SELECT DISTINCT A.*,'WSLORD_PARA6_UPLOAD' AS TARGET_TABLENAME,@CMEMOID AS WSLORD_MEMO_ID FROM PARA6 A (NOLOCK)
	 JOIN WSL_ORDER_DET B (NOLOCK) ON A.PARA6_CODE  =B.PARA6_CODE 
	 WHERE B.order_id=@CMEMOID
	
	
	SET @CSTEP=390
	---- SEND THE EMPLOYEE RELATED TO WSLORD TABLE
	
	SELECT DISTINCT A.*,'WSLORD_EMPLOYEE_UPLOAD' AS TARGET_TABLENAME,@CMEMOID AS WSLORD_MEMO_ID FROM EMPLOYEE A (NOLOCK)
	JOIN WSL_ORDER_MST B (NOLOCK) ON A.emp_code  =B.emp_code 
	 WHERE B.order_id=@CMEMOID
	
	SET @CSTEP=395
	---- SEND THE CUSTOMER DATA

	SELECT DISTINCT A.*,'WSLORD_CUSTDYM_UPLOAD' AS TARGET_TABLENAME,@CMEMOID AS WSLORD_MEMO_ID FROM CUSTDYM A (NOLOCK)
	JOIN WSL_ORDER_MST B (NOLOCK) ON A.customer_code  =B.customer_code 
	WHERE B.order_id=@CMEMOID AND A.customer_code NOT IN('','000000000000')


	select DISTINCT A.*,'WSLORD_SKU_UPLOAD' AS TARGET_TABLENAME,@CMEMOID AS WSLORD_MEMO_ID from sku A (nolock)
	join WSL_ORDER_DET b on a.product_code =b.product_code 
	where a.product_code <>'' and  B.order_id=@CMEMOID



	GOTO END_PROC

END TRY
BEGIN CATCH
	SET @CERRMSG='P: SP_SEND_MIRROR_WSLORD_DATA_NEW, STEP:'+@CSTEP+', MESSAGE:'+ERROR_MESSAGE()
	GOTO END_PROC
END CATCH 		

END_PROC:
	
END
---END OF PROCEDURE - SP_SEND_MIRROR_WSLORD_DATA_NEW
