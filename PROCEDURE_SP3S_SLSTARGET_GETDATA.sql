CREATE PROCEDURE SP3S_SLSTARGET_GETDATA
(
 @NQUERYID INT=0,
 @NSP_ID INT,
 @MEMO_ID VARCHAR(100)=''
)
AS
BEGIN
              
	DECLARE @CCOLNAME VARCHAR(100),@DTSQL NVARCHAR(MAX)
	
IF @NQUERYID=1 
   GOTO LBLPARASET
ELSE IF @NQUERYID=2
   GOTO LBLEXPORTCOLUMNAME
ELSE IF @NQUERYID=3
   GOTO LBLMAPCOLUMN
ELSE IF @NQUERYID=4
   GOTO LBLMST
ELSE IF @NQUERYID=5
   GOTO LBLDET
ELSE IF @NQUERYID=6
   GOTO LBLDET
ELSE 
    GOTO END_PROC    

    LBLPARASET:
	    
	      SELECT DISTINCT SR,  CAST('LATER' AS VARCHAR(22)) AS MEMO_ID,A.SLSTARGET_PARA_NAME,
	            A.SLSTARGET_PARA_DESC,CAST(CASE  WHEN UP.SLSTARGET_PARA_NAME IS NOT NULL THEN 1  WHEN a.SLSTARGET_PARA_NAME= 'DEPT_NAME' THEN 1 ELSE 0 END  AS BIT) AS CHK          
		  FROM          
			 (     
			   SELECT 1 AS SR, 'SECTION_NAME' as SLSTARGET_PARA_NAME,'Section' as  SLSTARGET_PARA_DESC union all   
			   SELECT 2 AS SR, 'SUB_SECTION_NAME' as SLSTARGET_PARA_NAME,'Sub Section' as  SLSTARGET_PARA_DESC union all        
			   SELECT 3 AS SR, 'ARTICLE_NO' as SLSTARGET_PARA_NAME,'Article' as  SLSTARGET_PARA_DESC union all          
			   SELECT 4 AS SR, CONFIG_OPTION+'_NAME',VALUE FROM CONFIG WHERE  config_option LIKE 'PARA[3-6]'+'_caption' union all           
			   SELECT 4 AS SR,CONFIG_OPTION+'_NAME',VALUE FROM CONFIG WHERE  config_option LIKE 'PARA[1-2]'+'_caption' UNION ALL     
			   SELECT 5 AS SR, UPPER(COLUMN_NAME),TABLE_CAPTION FROM CONFIG_ATTR WHERE ISNULL(TABLE_CAPTION,'')<>''  UNION ALL
			   SELECT 6 AS SR, 'EMP_NAME' as SLSTARGET_PARA_NAME,'Employee Name' as  SLSTARGET_PARA_DESC   UNION ALL
			   SELECT 7 AS SR, 'MRP_FROM' as SLSTARGET_PARA_NAME,'Mrp From' as  SLSTARGET_PARA_DESC     UNION ALL     
			   SELECT 7 AS SR, 'MRP_TO' as SLSTARGET_PARA_NAME,'Mrp To' as  SLSTARGET_PARA_DESC UNION ALL
			     SELECT 8 AS SR, 'Dept_name' as SLSTARGET_PARA_NAME,'Location' as  SLSTARGET_PARA_DESC 
				      
			 ) a    
		  LEFT JOIN SLSTRG_SLSTARGET_SETUP_UPLOAD UP (NOLOCK) ON UP.SLSTARGET_PARA_NAME=A.SLSTARGET_PARA_NAME AND UP.SP_ID=@NSP_ID
		 ORDER BY SR,SLSTARGET_PARA_NAME 
	                
				      
	 GOTO END_PROC 
	   
     LBLEXPORTCOLUMNAME:
            
            	SELECT @CCOLNAME=ISNULL(@CCOLNAME+',','')+''''''+' AS'+QUOTENAME( SLSTARGET_PARA_NAME)
				FROM SLSTRG_SLSTARGET_SETUP_UPLOAD A (NOLOCK)
				WHERE SP_ID=@NSP_ID
			
		
            IF ISNULL(@CCOLNAME,'')<>''
		 	SET @DTSQL= N' SELECT CAST('''' AS VARCHAR(2)) AS  DEPT_ID,
		 	               CAST('''' AS DATETIME) AS TARGET_DT,
		 	               CAST(0 AS NUMERIC(10,3)) AS TARGET_QTY,
		 	               CAST(0 AS NUMERIC(14,2)) AS TARGET_VALUE,
		 	               
		 	 '+@CCOLNAME+' '
			PRINT @DTSQL
			EXEC SP_EXECUTESQL @DTSQL
     
     GOTO END_PROC 
     
     
     LBLMAPCOLUMN:
            IF ISNULL(@MEMO_ID,'')=''
            BEGIN
            
				    SELECT SLSTARGET_PARA_NAME AS TABLE_NAME
					FROM SLSTRG_SLSTARGET_SETUP_UPLOAD A (NOLOCK)
					WHERE SP_ID=@NSP_ID
			
			END
			ELSE
			BEGIN
			
			        SELECT SLSTARGET_PARA_NAME AS TABLE_NAME
					FROM SLSTARGET_SETUP A (NOLOCK)
					WHERE MEMO_ID =@MEMO_ID
			
			END
           
         
		

     
     GOTO END_PROC 
     
     
     LBLMST:
     
              SELECT A.*,U.USERNAME  
              FROM SLSTARGET_MST A (NOLOCK) 
              JOIN USERS U (NOLOCK) ON A.USER_CODE=U.USER_CODE 
              WHERE A.MEMO_ID=@MEMO_ID 
     
     GOTO END_PROC 
     
     LBLDET:
              
            SELECT A.*  ,
                   B.DEPT_NAME ,ART.ARTICLE_NO,SD.SUB_SECTION_NAME,SM.SECTION_NAME,
                   P1.PARA1_NAME ,P2.PARA2_NAME ,P3.PARA3_NAME ,P4.PARA4_NAME ,P5.PARA5_NAME ,P6.PARA6_NAME,Em.emp_name ,
                   ATTR1_MST.ATTR1_KEY_NAME,ATTR2_MST.ATTR2_KEY_NAME,ATTR3_MST.ATTR3_KEY_NAME,ATTR4_MST.ATTR4_KEY_NAME,ATTR5_MST.ATTR5_KEY_NAME,
                   ATTR6_MST.ATTR6_KEY_NAME,ATTR7_MST.ATTR7_KEY_NAME,ATTR8_MST.ATTR8_KEY_NAME,ATTR9_MST.ATTR9_KEY_NAME,ATTR10_MST.ATTR10_KEY_NAME,
                   ATTR11_MST.ATTR11_KEY_NAME,ATTR12_MST.ATTR12_KEY_NAME,ATTR13_MST.ATTR13_KEY_NAME,ATTR14_MST.ATTR14_KEY_NAME,ATTR15_MST.ATTR15_KEY_NAME,
                   ATTR16_MST.ATTR16_KEY_NAME,ATTR17_MST.ATTR17_KEY_NAME,ATTR18_MST.ATTR18_KEY_NAME,ATTR19_MST.ATTR19_KEY_NAME,ATTR20_MST.ATTR20_KEY_NAME,
                   ATTR21_MST.ATTR21_KEY_NAME,ATTR22_MST.ATTR22_KEY_NAME,ATTR23_MST.ATTR23_KEY_NAME,ATTR24_MST.ATTR24_KEY_NAME,ATTR25_MST.ATTR25_KEY_NAME
                    
            FROM SLSTARGET_DET A (NOLOCK)
            LEFT JOIN LOCATION B (NOLOCK) ON A.DEPT_ID =B.DEPT_ID 
            LEFT JOIN ARTICLE ART  (NOLOCK) ON ART.article_code   =A.article_code
            LEFT JOIN Sectiond SD (NOLOCK) ON SD.sub_section_CODE =A.SUB_SECTION_CODE
            LEFT JOIN SectionM SM (NOLOCK) ON SM.section_code =a.section_code
            LEFT JOIN PARA1 P1 (NOLOCK) ON P1.PARA1_CODE =A.PARA1_CODE
            LEFT JOIN PARA2 P2 (NOLOCK) ON P2.para2_code =a.PARA2_CODE 
            LEFT JOIN PARA3 P3 (NOLOCK) ON P3.para3_code =a.PARA3_CODE 
            LEFT JOIN PARA4 P4 (NOLOCK) ON P4.para4_code =a.para4_code
            LEFT JOIN PARA5 P5 (NOLOCK) ON P5.PARA5_CODE=a.PARA5_CODE
            LEFT JOIN PARA6 P6 (NOLOCK) ON P6.para6_code =a.para6_code
             LEFT JOIN EMPLOYEE EM (NOLOCK) ON EM.emp_code =A.emp_code
		    LEFT JOIN ATTR1_MST (NOLOCK) ON ATTR1_MST.attr1_KEY_CODE=A.ATTR1_KEY_CODE
			LEFT JOIN ATTR2_MST (NOLOCK) ON ATTR2_MST.ATTR2_KEY_CODE=A.ATTR2_KEY_CODE
			LEFT JOIN ATTR3_MST (NOLOCK) ON ATTR3_MST.ATTR3_KEY_CODE=A.ATTR3_KEY_CODE
			LEFT JOIN ATTR4_MST (NOLOCK) ON ATTR4_MST.ATTR4_KEY_CODE=A.ATTR4_KEY_CODE
			LEFT JOIN ATTR5_MST (NOLOCK) ON ATTR5_MST.ATTR5_KEY_CODE=A.ATTR5_KEY_CODE
			LEFT JOIN ATTR6_MST (NOLOCK) ON ATTR6_MST.ATTR6_KEY_CODE=A.ATTR6_KEY_CODE
			LEFT JOIN ATTR7_MST (NOLOCK) ON ATTR7_MST.ATTR7_KEY_CODE=A.ATTR7_KEY_CODE
			LEFT JOIN ATTR8_MST (NOLOCK) ON ATTR8_MST.ATTR8_KEY_CODE=A.ATTR8_KEY_CODE
			LEFT JOIN ATTR9_MST (NOLOCK) ON ATTR9_MST.ATTR9_KEY_CODE=A.ATTR9_KEY_CODE
			LEFT JOIN ATTR10_MST (NOLOCK) ON ATTR10_MST.ATTR10_KEY_CODE=A.ATTR10_KEY_CODE
			LEFT JOIN ATTR11_MST (NOLOCK) ON ATTR11_MST.ATTR11_KEY_CODE=A.ATTR11_KEY_CODE
			LEFT JOIN ATTR12_MST (NOLOCK) ON ATTR12_MST.ATTR12_KEY_CODE=A.ATTR12_KEY_CODE
			LEFT JOIN ATTR13_MST (NOLOCK) ON ATTR13_MST.ATTR13_KEY_CODE=A.ATTR13_KEY_CODE
			LEFT JOIN ATTR14_MST (NOLOCK) ON ATTR14_MST.ATTR14_KEY_CODE=A.ATTR14_KEY_CODE
			LEFT JOIN ATTR15_MST (NOLOCK) ON ATTR15_MST.ATTR15_KEY_CODE=A.ATTR15_KEY_CODE
			LEFT JOIN ATTR16_MST (NOLOCK) ON ATTR16_MST.ATTR16_KEY_CODE=A.ATTR16_KEY_CODE
			LEFT JOIN ATTR17_MST (NOLOCK) ON ATTR17_MST.ATTR17_KEY_CODE=A.ATTR17_KEY_CODE
			LEFT JOIN ATTR18_MST (NOLOCK) ON ATTR18_MST.ATTR18_KEY_CODE=A.ATTR18_KEY_CODE
			LEFT JOIN ATTR19_MST (NOLOCK) ON ATTR19_MST.ATTR19_KEY_CODE=A.ATTR19_KEY_CODE
			LEFT JOIN ATTR20_MST (NOLOCK) ON ATTR20_MST.ATTR20_KEY_CODE=A.ATTR20_KEY_CODE
			LEFT JOIN ATTR21_MST (NOLOCK) ON ATTR21_MST.ATTR21_KEY_CODE=A.ATTR21_KEY_CODE
			LEFT JOIN ATTR22_MST (NOLOCK) ON ATTR22_MST.ATTR22_KEY_CODE=A.ATTR22_KEY_CODE
			LEFT JOIN ATTR23_MST (NOLOCK) ON ATTR23_MST.ATTR23_KEY_CODE=A.ATTR23_KEY_CODE
			LEFT JOIN ATTR24_MST (NOLOCK) ON ATTR24_MST.ATTR24_KEY_CODE=A.ATTR24_KEY_CODE
			LEFT JOIN ATTR25_MST (NOLOCK) ON ATTR25_MST.ATTR25_KEY_CODE=A.ATTR25_KEY_CODE
            WHERE A.MEMO_ID =@MEMO_ID 
     GOTO END_PROC 
     
     --LBLNAVIGATE:
          
     --     exec SP_NAVIGATE_ARS 'SLSTARGET_MST',@NNAVMODE,'memo_no',@CFINYEAR,'LAST_UPDATE',''
     
     -- GOTO END_PROC 
     
     
  
  END_PROC:

END






