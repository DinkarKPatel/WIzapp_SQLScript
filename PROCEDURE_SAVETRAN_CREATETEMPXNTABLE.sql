-- PROCEDURE TO CREATE TEMPORARY DATABASE AND TABLE
-- WHICH WILL BE USED IN THE SAVETRAN PROCEDURE 
-- THIS PROCEDURE WILL DROP AND CREATE SINGLE TABLE 
CREATE PROCEDURE SAVETRAN_CREATETEMPXNTABLE
(
	@CORGTABLENAME VARCHAR(100)
)
--WITH ENCRYPTION
AS
BEGIN
	SET NOCOUNT ON 
	
	DECLARE @CCMD NVARCHAR(1000), 
			@CDBNAME VARCHAR(50),
			@CTEMPDBNAME VARCHAR(50),
			@NSPID INT,
			--@CORGTABLENAME VARCHAR(100), 
			@CTEMPTABLENAME VARCHAR(100)

	SET @CDBNAME = DB_NAME()
	SET @NSPID = @@SPID
	SET @CTEMPDBNAME = @CDBNAME



	SET @CTEMPTABLENAME = 'TEMP_' + @CORGTABLENAME + '_' + LTRIM(RTRIM(STR(@NSPID)))

	SET @CCMD = N'IF EXISTS ( SELECT NAME FROM ' + @CTEMPDBNAME + '.DBO.SYSOBJECTS 
							  WHERE XTYPE = ''U'' AND NAME = ''' + @CTEMPTABLENAME + ''' )
					DROP TABLE ' + @CTEMPDBNAME + '.DBO.' + @CTEMPTABLENAME + '
					
					SELECT * INTO ' + @CTEMPDBNAME + '.DBO.' + @CTEMPTABLENAME + ' 
					FROM ' + @CORGTABLENAME + ' WHERE 1=2'
--		PRINT @CCMD
	EXEC SP_EXECUTESQL @CCMD

END_PROC:

END
--************************************* END OF PROCEDURE SAVETRAN_CREATETEMPXNTABLE
