CREATE PROC SP_EMP_SALARY_PAY(@NSTEP INT, @EMPID VARCHAR(100), @XN_MONTH INT, @XN_YEAR INT)
AS
IF @NSTEP = 1
	GOTO DT_LOOKUP
ELSE IF @NSTEP = 2
	GOTO DT_EMP_PROFILE
ELSE IF @NSTEP = 3
	GOTO DT_ADDITION
ELSE IF @NSTEP = 4
	GOTO DT_DEDUCTION
ELSE IF @NSTEP = 5
	GOTO DT_HR_EMP_PAY
	
BEGIN

DT_LOOKUP:
	SELECT A.EMP_ID,
		'[' + A.REF_ID + '] ' + A.EMP_TITLE + ' ' + A.EMP_FNAME + ' ' + A.EMP_LNAME AS EMP_NAME,
		B.DEPARTMENT_NAME,C.DEPT_NAME AS LOCATION		
	FROM 
		EMP_MST A 
		JOIN EMP_DEPARTMENT B ON B.DEPARTMENT_ID= A.DEPARTMENT_ID 
		JOIN LOCATION C ON C.DEPT_ID = A.DEPT_ID	
	ORDER BY C.DEPT_NAME,B.DEPARTMENT_NAME
	
	
	GOTO PROC_END;

DT_EMP_PROFILE:
	SELECT 
		C.EMP_ID,C.REF_ID,		
		C.EMP_TITLE + ' ' + C.EMP_FNAME + ' ' + C.EMP_LNAME AS EMP_NAME,
		D.DEPARTMENT_NAME,E.DEPT_NAME AS LOCATION
	FROM EMP_MST C
		JOIN EMP_DEPARTMENT D ON D.DEPARTMENT_ID= C.DEPARTMENT_ID 
		JOIN LOCATION E ON E.DEPT_ID = C.DEPT_ID
	WHERE C.EMP_ID = @EMPID 
	
	GOTO PROC_END;

DT_ADDITION:
	SELECT 
		A.EMP_ID,B.PAY_ID,
		B.PAY_NAME,A.AMOUNT		
	FROM 
		HR_EMP_PAY A 
		JOIN EMP_PAY B ON B.PAY_ID = A.PAY_ID
		JOIN EMP_MST C ON C.EMP_ID = A.EMP_ID
	WHERE
		A.EMP_ID = @EMPID AND A.XN_MONTH=@XN_MONTH AND A.XN_YEAR = @XN_YEAR AND B.PAY_TYPE=1
	ORDER BY B.PAY_NAME
	
	GOTO PROC_END;
	
DT_DEDUCTION:
	SELECT 
		A.EMP_ID,B.PAY_ID,
		B.PAY_NAME,A.AMOUNT		
	FROM 
		HR_EMP_PAY A 
		JOIN EMP_PAY B ON B.PAY_ID = A.PAY_ID
		JOIN EMP_MST C ON C.EMP_ID = A.EMP_ID
	WHERE
		A.EMP_ID = @EMPID AND A.XN_MONTH=@XN_MONTH AND A.XN_YEAR = @XN_YEAR AND B.PAY_TYPE=2
	ORDER BY B.PAY_NAME
	
	GOTO PROC_END;	

DT_HR_EMP_PAY:
	SELECT * FROM HR_EMP_PAY 
	WHERE EMP_ID = @EMPID AND XN_MONTH=@XN_MONTH AND XN_YEAR = @XN_YEAR
	GOTO PROC_END;

PROC_END:

END
