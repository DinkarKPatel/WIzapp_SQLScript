CREATE PROCEDURE SP3S_LIST_ARS_LOCATIONS(@PLN VARCHAR(500),@LOC VARCHAR(100))
AS
BEGIN
SET NOCOUNT ON
DECLARE @SQL VARCHAR(MAX)
SET @SQL='SELECT *,LEFT(NEWID(),40) ROW_ID,CAST('''' AS VARCHAR(20))WH_LOCATION 
FROM
(SELECT DISTINCT CAST(1 AS INT) AS CHK,AD.DEPT_ID,L.DEPT_NAME,L.DEPT_ALIAS
FROM ARS_MST AM (NOLOCK) 
JOIN ARS_DET AD (NOLOCK) ON AM.ARS_ID=AD.ARS_ID 
JOIN LOCATION L (NOLOCK) ON L.DEPT_ID=AD.DEPT_ID
WHERE '+CASE @LOC WHEN '' THEN '' ELSE 'L.DEPT_ID '+@LOC+' AND ' END+' AM.INACTIVE=0 AND LTRIM(RTRIM(AM.PLAN_NAME))=LTRIM(RTRIM('''+@PLN+'''))
)T'
EXEC(@SQL)
SET NOCOUNT OFF
END
