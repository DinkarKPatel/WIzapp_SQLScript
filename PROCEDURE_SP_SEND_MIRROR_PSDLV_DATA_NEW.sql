create PROCEDURE SP_SEND_MIRROR_PSDLV_DATA_NEW
(	
	 @CUPLOADEDXNID VARCHAR(50)
	,@CCURLOCID VARCHAR(5)	
	,@BACKNOWLEDGE BIT=0
	,@CERRMSG VARCHAR(1000) OUTPUT
)
--WITH ENCRYPTION
AS
BEGIN
     DECLARE @DTSQL NVARCHAR(MAX),@CSTEP VARCHAR(10),@CFILTERCONDITION VARCHAR(MAX),
             @CMEMOID VARCHAR(50),@DMEMOLASTUPDATE DATETIME,
             @CTABLENAME VARCHAR(100),@CTEMPTABLE VARCHAR(100),@CTEMPMASTERTABLE VARCHAR(100),
             @CTEMPDETAILTABLE VARCHAR(100),@BRECFOUND BIT
     
     
BEGIN TRY
     DECLARE @CTEMPDBNAME VARCHAR(100)
	SET @CTEMPDBNAME=''
	 	 SET @CSTEP=10
		SET @CFILTERCONDITION=''	
    
	 SET @CSTEP=30
	 --CHNAGE BY BAIJNATH
	 SET @CMEMOID=@CUPLOADEDXNID
	 
    SET @CSTEP=40
	---- IF NO MEMO FOUND , JUST END THE PROCESS
	IF ISNULL(@CMEMOID,'')=''
		GOTO END_PROC
	
	
	SET @CSTEP=220
	---- SEND THE PSDLV MEMO MASTER TABLE
	SELECT A.*,'PSDLV_SLS_DELIVERY_MST_UPLOAD' AS TARGET_TABLENAME FROM SLS_DELIVERY_MST A (NOLOCK) WHERE A.memo_id =@CMEMOID 
	
	SET @CSTEP=250
	---- SEND THE PSDLV MEMO DETAIL TABLE
	SELECT A.*,'PSDLV_SLS_DELIVERY_DET_UPLOAD' AS TARGET_TABLENAME FROM SLS_DELIVERY_DET A (NOLOCK) WHERE A.memo_id =@CMEMOID 
	
	SET @CSTEP=270
	---- SEND THE PSDLV MEMO DETAIL TABLE
	SELECT A.*,'PSDLV_SLS_DELIVERY_CONS_UPLOAD' AS TARGET_TABLENAME FROM SLS_DELIVERY_CONS A (NOLOCK) WHERE A.memo_id =@CMEMOID 
	
	
	
	GOTO END_PROC
END TRY
BEGIN CATCH
	SET @CERRMSG='P: SP_SEND_MIRROR_PSDLV_DATA_NEW, STEP:'+@CSTEP+', MESSAGE:'+ERROR_MESSAGE()
	GOTO END_PROC
END CATCH 	
	
END_PROC:
	
	
END
