

-- LOOK UP TABLE FOR ALL TRANSACTION MODULES

CREATE PROCEDURE SP_RATEREVISION
	@NQUERYID NUMERIC(3,0),
	@CMEMOID VARCHAR(200),
	@CFINYEAR VARCHAR(5)
--WITH ENCRYPTION
AS
BEGIN

 DECLARE @CCMD NVARCHAR(4000)  


	IF @NQUERYID=1
		GOTO LBLNAVIGATE 
		
	ELSE IF @NQUERYID=2
		GOTO LBLMEMOMASTER 
	
	ELSE IF @NQUERYID =3
		GOTO LBLMEMODETAILS	
		
	ELSE IF @NQUERYID =4		
		GOTO LBLPARA1
		


LBLNAVIGATE:  --- TO FETCH NEXT MEMO NO FOR NAVIGATION
	SELECT IRM_MEMO_ID, IRM_MEMO_DT  FROM IRM01106  WHERE FIN_YEAR = @CFINYEAR
	
	GOTO LAST
		
LBLMEMOMASTER:
	SELECT A.*,B.USERNAME 
	FROM IRM01106 A
	JOIN USERS (NOLOCK) B ON A.USER_CODE = B.USER_CODE
	WHERE A.IRM_MEMO_ID = @CMEMOID

	GOTO LAST	

LBLMEMODETAILS:
	SELECT A.*, ART.ARTICLE_NO, ART.ARTICLE_NAME, ART.ARTICLE_DESC, SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME,P1.PARA1_NAME, 
			P2.PARA2_NAME,P3.PARA3_NAME, P4.PARA4_NAME,P5.PARA5_NAME, P6.PARA6_NAME,U.UOM_NAME,
			OP1.PARA1_NAME AS OLD_PARA1_NAME, OP2.PARA2_NAME AS OLD_PARA2_NAME,
			OP3.PARA3_NAME  AS OLD_PARA3_NAME, OP4.PARA4_NAME AS OLD_PARA4_NAME,
			OP5.PARA5_NAME AS OLD_PARA5_NAME, OP6.PARA6_NAME AS OLD_PARA6_NAME,
			OART.DT_CREATED AS [ART_DT_CREATED],P3.DT_CREATED AS [PARA3_DT_CREATED],SKU.DT_CREATED AS [SKU_DT_CREATED]
	FROM IRD01106 A (NOLOCK)
	JOIN IRM01106 B (NOLOCK) ON B.IRM_MEMO_ID=A.IRM_MEMO_ID
	JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=A.PRODUCT_CODE
	JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE=A.ARTICLE_CODE
	JOIN PARA1 P1 (NOLOCK) ON P1.PARA1_CODE=A.PARA1_CODE
	JOIN PARA2 P2 (NOLOCK) ON P2.PARA2_CODE=A.PARA2_CODE
	JOIN PARA3 P3 (NOLOCK) ON P3.PARA3_CODE=A.PARA3_CODE
	JOIN PARA4 P4 (NOLOCK) ON P4.PARA4_CODE=A.PARA4_CODE
	JOIN PARA5 P5 (NOLOCK) ON P5.PARA5_CODE=A.PARA5_CODE
	JOIN PARA6 P6 (NOLOCK) ON P6.PARA6_CODE=A.PARA6_CODE
	JOIN ARTICLE OART (NOLOCK) ON OART.ARTICLE_CODE=A.OLD_ARTICLE_CODE
	JOIN PARA1 OP1 (NOLOCK) ON OP1.PARA1_CODE=A.OLD_PARA1_CODE
	JOIN PARA2 OP2 (NOLOCK) ON OP2 .PARA2_CODE=A.OLD_PARA2_CODE
	JOIN PARA3 OP3 (NOLOCK) ON OP3.PARA3_CODE=A.OLD_PARA3_CODE
	JOIN PARA4 OP4 (NOLOCK) ON OP4.PARA4_CODE=A.OLD_PARA4_CODE
	JOIN PARA5 OP5 (NOLOCK) ON OP5.PARA5_CODE=A.OLD_PARA5_CODE
	JOIN PARA6 OP6 (NOLOCK) ON OP6.PARA6_CODE=A.OLD_PARA6_CODE	
	JOIN UOM U (NOLOCK) ON U.UOM_CODE=ART.UOM_CODE
	WHERE A.IRM_MEMO_ID = B.IRM_MEMO_ID
	AND B.IRM_MEMO_ID = @CMEMOID
	
	GOTO LAST

LBLPARA1:
	SELECT  '' AS PARA_CODE, '' AS PARA_NAME
	SELECT PARA1_CODE, PARA1_NAME FROM PARA1 WHERE PARA1_NAME <>'' ORDER BY PARA1_NAME 
	SELECT PARA2_CODE, PARA2_NAME FROM PARA2 WHERE PARA2_NAME <>'' ORDER BY PARA2_NAME 
	SELECT PARA3_CODE, PARA3_NAME FROM PARA3 WHERE PARA3_NAME <>'' ORDER BY PARA3_NAME 
	SELECT PARA4_CODE, PARA4_NAME FROM PARA4 WHERE PARA4_NAME <>'' ORDER BY PARA4_NAME 
	SELECT PARA5_CODE, PARA5_NAME FROM PARA5 WHERE PARA5_NAME <>'' ORDER BY PARA5_NAME 
	SELECT PARA6_CODE, PARA6_NAME FROM PARA6 WHERE PARA6_NAME <>'' ORDER BY PARA6_NAME 
	
	GOTO LAST
	
	LAST:
END
