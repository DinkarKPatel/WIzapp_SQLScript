CREATE PROCEDURE SP_WL_CUSTDYM_DATABINDING
(
	@CCUSTOMERCODE VARCHAR(15)='',
	@bIgnoreInactive	BIT=0
)
--WITH ENCRYPTION
AS

BEGIN
	SELECT A.* ,AREA.AREA_NAME ,CITY.CITY,STATE.STATE,REGIONM.REGION_NAME,(CASE WHEN ISNULL(AREA.PINCODE,'')='' THEN A.PIN ELSE AREA.PINCODE END) AS PINCODE,P.PREFIX_NAME,
	(CASE WHEN ISNULL(A.ADDRESS9,'')='' THEN ISNULL(A.ADDRESS1,'')+' '+ISNULL(A.ADDRESS2,'') ELSE ISNULL(A.ADDRESS9,'') END) AS ALLADDRESS,
	A1.USER_CUSTOMER_CODE AS [REF_USER_CUSTOMER_CODE],
	A1.CUSTOMER_TITLE+' ' +ISNULL(A1.CUSTOMER_FNAME,'')+' '+ISNULL(A1.CUSTOMER_LNAME,'')+' '+
	(CASE WHEN ISNULL(A1.ADDRESS9,'')='' THEN ISNULL(A1.ADDRESS1,'')+' '+ISNULL(A1.ADDRESS2,'') ELSE ISNULL(A1.ADDRESS9,'') END) AS REF_ADDRESS,
	GST.GST_STATE_CODE + ' ' + GST.GST_STATE_NAME AS GST_STATE_NAME,
	BM.CARD_NAME AS DISCOUNTED_CARD_TYPE,CT.COUNTRY_CODE,CT.COUNTRY_NAME
	,CITY.CITY_CODE,state.state_code,regionM.region_code,
	area.area_name as area,cp.countryname,E.USERNAME, F.USERNAME AS EDITUSERNAME
	FROM CUSTDYM A 
	JOIN AREA ON AREA.AREA_CODE=A.AREA_CODE
	JOIN CITY ON CITY.CITY_CODE=AREA.CITY_CODE
	JOIN STATE ON STATE.STATE_CODE=CITY.STATE_CODE
	JOIN REGIONM ON REGIONM.REGION_CODE=STATE.REGION_CODE
	LEFT OUTER JOIN PREFIX P ON P.PREFIX_CODE = A.PREFIX_CODE
	JOIN CUSTDYM A1 ON A1.CUSTOMER_CODE=A.REF_CUSTOMER_CODE
	JOIN AREA AR1 ON AR1.AREA_CODE=A1.AREA_CODE
	JOIN CITY C1 ON C1.CITY_CODE=AR1.CITY_CODE
	JOIN STATE S1 ON S1.STATE_CODE=C1.STATE_CODE
	JOIN REGIONM R1 ON R1.REGION_CODE=S1.REGION_CODE
	LEFT OUTER JOIN PREFIX P1 ON P1.PREFIX_CODE = A1.PREFIX_CODE
	LEFT OUTER JOIN GST_STATE_MST GST ON GST.GST_STATE_CODE = A.CUS_GST_STATE_CODE
	LEFT OUTER JOIN BWD_MST BM ON BM.MEMO_ID=A.CARD_CODE
	LEFT OUTER JOIN COUNTRY CT ON CT.COUNTRY_CODE=R1.COUNTRY_CODE
	LEFT OUTER JOIN countryPhoneCode CP (NOLOCK) ON A.countryCode = cp.phoneCode
	LEFT JOIN USERS E (NOLOCK) ON A.USER_CODE  = E.USER_CODE       
    LEFT JOIN USERS F (NOLOCK) ON A.EDT_USER_CODE = F.USER_CODE 
	WHERE A.CUSTOMER_CODE = @CCUSTOMERCODE
	AND (@bIgnoreInactive=0 OR ISNULL(A.inactive,0)=0)
END 
