UPDATE CMM01106 WITH (ROWLOCK) SET GST_ROUND_OFF=(NET_AMOUNT-(ISNULL(OTHER_CHARGES_TAXABLE_VALUE,0)+
	ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_IGST_AMOUNT,0)
	+ROUND_OFF+b.cmdval_withgst)) 
FROM cmm01106 a 
JOIN (SELECT cm_id,SUM( isnull(XN_VALUE_WITHOUT_GST,0)+isnull(IGST_AMOUNT,0)+isnull(CGST_AMOUNT,0)+isnull(SGST_AMOUNT,0)+
isnull(TAX_AMOUNT,0)+isnull(cess_amount,0)+isnull(gst_cess_amount,0)) cmdval_withgst 
FROM cmd01106 (NOLOCK) GROUP BY cm_id) b ON a.cm_id=b.cm_id
WHERE ISNULL(a.gst_round_off,0)<>(NET_AMOUNT-(ISNULL(OTHER_CHARGES_TAXABLE_VALUE,0)+
	ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_IGST_AMOUNT,0)
	+ROUND_OFF+b.cmdval_withgst)) and abs(NET_AMOUNT-(ISNULL(OTHER_CHARGES_TAXABLE_VALUE,0)+
	ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_IGST_AMOUNT,0)
	+ROUND_OFF+b.cmdval_withgst))<=1  


