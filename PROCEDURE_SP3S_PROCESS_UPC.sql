CREATE PROCEDURE SP3S_PROCESS_UPC
(
	@CTABLENAME	VARCHAR(MAX)
)
AS
BEGIN
	DECLARE @CCMD	NVARCHAR(MAX)
	DECLARE @TERROR TABLE(ITEM_VALUE  VARCHAR(MAX),ERR_MSG  VARCHAR(MAX))
	
	BEGIN TRY
	SET @CCMD=N'SELECT A.ARTICLE_NO AS [ITEM_VALUE],''ARTICLE NO NOT FOUND IN ARTICLE MASTER'' AS [ERR_MSG]
				FROM '+@CTABLENAME+' A
				LEFT OUTER JOIN ARTICLE B ON B.ARTICLE_NO=A.ARTICLE_NO
				WHERE B.ARTICLE_NO IS NULL
				UNION 
				SELECT A.PARA1_NAME AS [ITEM_VALUE],''PARA1 NAME NOT FOUND IN PARA1 MASTER'' AS [ERR_MSG]
				FROM '+@CTABLENAME+' A
				LEFT OUTER JOIN PARA1 B ON B.PARA1_NAME=A.PARA1_NAME
				WHERE B.PARA1_NAME IS NULL
				UNION 
				SELECT A.PARA2_NAME AS [ITEM_VALUE],''PARA2 NAME NOT FOUND IN PARA2 MASTER'' AS [ERR_MSG]
				FROM '+@CTABLENAME+' A
				LEFT OUTER JOIN PARA2 B ON B.PARA2_NAME=A.PARA2_NAME
				WHERE B.PARA2_NAME IS NULL
				UNION 
				SELECT A.PARA3_NAME AS [ITEM_VALUE],''PARA3 NAME NOT FOUND IN PARA3 MASTER'' AS [ERR_MSG]
				FROM '+@CTABLENAME+' A
				LEFT OUTER JOIN PARA3 B ON B.PARA3_NAME=A.PARA3_NAME
				WHERE B.PARA3_NAME IS NULL
				UNION 
				SELECT A.PARA4_NAME AS [ITEM_VALUE],''PARA4 NAME NOT FOUND IN PARA4 MASTER'' AS [ERR_MSG]
				FROM '+@CTABLENAME+' A
				LEFT OUTER JOIN PARA4 B ON B.PARA4_NAME=A.PARA4_NAME
				WHERE B.PARA4_NAME IS NULL
				UNION 
				SELECT A.PARA5_NAME AS [ITEM_VALUE],''PARA5 NAME NOT FOUND IN PARA5 MASTER'' AS [ERR_MSG]
				FROM '+@CTABLENAME+' A
				LEFT OUTER JOIN PARA5 B ON B.PARA5_NAME=A.PARA5_NAME
				WHERE B.PARA5_NAME IS NULL
				UNION 
				SELECT A.PARA6_NAME AS [ITEM_VALUE],''PARA6 NAME NOT FOUND IN PARA6 MASTER'' AS [ERR_MSG]
				FROM '+@CTABLENAME+' A
				LEFT OUTER JOIN PARA6 B ON B.PARA6_NAME=A.PARA6_NAME
				WHERE B.PARA6_NAME IS NULL'
				
	PRINT @CCMD
	INSERT INTO @TERROR(ITEM_VALUE  ,ERR_MSG)			
	EXEC SP_EXECUTESQL @CCMD
	
	IF(@@ROWCOUNT=0)
	BEGIN
	/*
	SELECT A1.ARTICLE_CODE,ART.ARTICLE_CODE,A1.PARA1_CODE,P1.PARA1_CODE,A1.PARA2_CODE,P2.PARA2_CODE
		,A1.MRP,ART.MRP,A1.WS_PRICE,ART.WHOLESALE_PRICE,A1.PURCHASE_PRICE,ART.PURCHASE_PRICE
		*/
		SET @CCMD=N'UPDATE A1 SET A1.ARTICLE_CODE=ART.ARTICLE_CODE,A1.PARA1_CODE=P1.PARA1_CODE,
					A1.PARA2_CODE=P2.PARA2_CODE,A1.MRP=A.MRP,A1.WS_PRICE=A.WS_PRICE,A1.PURCHASE_PRICE=A.PURCHASE_PRICE
					,A1.PARA3_CODE=P3.PARA3_CODE,A1.PARA4_CODE=P4.PARA4_CODE,A1.PARA5_CODE=P5.PARA5_CODE,
					A1.PARA6_CODE=P6.PARA6_CODE
					FROM SKU A1
					JOIN '+@CTABLENAME+' A ON A.PRODUCT_CODE=A1.PRODUCT_CODE
					JOIN ARTICLE ART ON ART.ARTICLE_NO=A.ARTICLE_NO
					JOIN PARA1 P1 ON P1.PARA1_NAME=A.PARA1_NAME
					JOIN PARA2 P2 ON P2.PARA2_NAME=A.PARA2_NAME
					JOIN PARA3 P3 ON P3.PARA3_NAME=A.PARA3_NAME
					JOIN PARA4 P4 ON P4.PARA4_NAME=A.PARA4_NAME
					JOIN PARA5 P5 ON P5.PARA5_NAME=A.PARA5_NAME
					JOIN PARA6 P6 ON P6.PARA6_NAME=A.PARA6_NAME'
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD


		EXEC SP3S_UPDATE_SKUNAMES '1','PUR',@CTABLENAME,'1'
					
	END
	END TRY
	BEGIN CATCH
			INSERT INTO @TERROR(ITEM_VALUE  ,ERR_MSG)			
			SELECT 'ERROR WHILE EXECUTING QUERY SP3S_PROCESS_UPC',ERROR_MESSAGE()
	END CATCH
	
	
	SELECT * FROM @TERROR

END
