
CREATE PROCEDURE [DBO].[SPPPC_FILL_ARTICLE]  
(  
 @NQUERYID   INT,    
 @VPARAMETER  VARCHAR(500)  
)  
AS      
BEGIN   
  
 DECLARE @CSTEP INT, @CCMD NVARCHAR(MAX), @ERRMSG_OUT VARCHAR(MAX)  
 BEGIN TRY  
  SET NOCOUNT ON;  
    
  SET @ERRMSG_OUT = ''  
    
  IF @NQUERYID = 1  
   -- GET ARTICLE LIST - ALL  
   GOTO LBLGETARTICLELIST  
     
  ELSE IF @NQUERYID = 2  
   -- GET ARTICLE LIST - ALL - USING LIKE  
   GOTO LBLGETARTICLELIKE  
    
  ELSE IF @NQUERYID = 3  
   -- GET ARTICLE LIST - ONLY FINISHED GOODS  
   GOTO LBLGETARTICLE_FG_LIST  
     
  ELSE IF @NQUERYID = 4  
   -- GET ARTICLE LIST - ONLY FINISHED GOODS - USING LIKE  
   GOTO LBLGETARTICLE_FG_LIKE  
   
  ELSE IF @NQUERYID = 5  
   -- GET ARTICLE LIST - ONLY FINISHED GOODS - USING LIKE  
   GOTO LBLGETARTICLE_RM_LIKE  
    
  ELSE IF @NQUERYID = 7  
   -- GET INFO BY ARTICLE NO  
   GOTO LBLGETINFOBYARTICLENO  
  
  ELSE  
   GOTO LAST  
  
-- GET ARTICLE LIST - ALL  
LBLGETARTICLELIST:  
  SET @CSTEP = 101  
  --SELECT A.SHIPPING_MODE, A.SHIPPING_NAME  
  --FROM [PPC_SHIPPING_DETAILS] A (NOLOCK)   
  --ORDER BY A.SHIPPING_MODE  
    
  GOTO LAST  
  
-- GET ARTICLE LIST - ALL - USING LIKE  
LBLGETARTICLELIKE:  
  SET @CSTEP = 102  
  --SELECT A.SHIPPING_MODE, A.SHIPPING_NAME  
  --FROM [PPC_SHIPPING_DETAILS] A (NOLOCK)   
  --WHERE A.SHIPPING_NAME LIKE '%'+ @VPARAMETER +'%'  
  --ORDER BY A.SHIPPING_NAME  
    
  GOTO LAST  
  
  
-- GET ARTICLE LIST - ONLY FINISHED GOODS  
LBLGETARTICLE_FG_LIST:  
  SET @CSTEP = 103  
  SELECT A.ARTICLE_CODE, A.ARTICLE_NO  
  FROM ARTICLE A (NOLOCK)     
  WHERE A.ARTICLE_TYPE =1  
  AND A.INACTIVE =0 AND ISNULL(A.ARTICLE_NO,'')<>''   
  ORDER BY A.ARTICLE_NO  
    
  GOTO LAST  
  
-- GET ARTICLE LIST - ONLY FINISHED GOODS - USING LIKE  
LBLGETARTICLE_FG_LIKE:  
  SET @CSTEP = 104  
  SELECT  A.ARTICLE_CODE, A.ARTICLE_NO  
  FROM ARTICLE A (NOLOCK)     
  WHERE A.ARTICLE_TYPE=1
  AND A.INACTIVE =0 AND ISNULL(A.ARTICLE_NO,'')<>''   
  AND A.ARTICLE_NO LIKE '%'+ @VPARAMETER +'%'  
  ORDER BY A.ARTICLE_NO  
    
  GOTO LAST  
  
  
-- GET INFO BY ARTICLE NO  
LBLGETINFOBYARTICLENO:  
  SET @CSTEP = 107  
  SELECT A.ARTICLE_CODE, A.ARTICLE_NO, A.ARTICLE_DESC,  A.UOM_CODE, U.UOM_NAME ,
  A.wholesale_price AS RATE 
  FROM ARTICLE A (NOLOCK) JOIN UOM U (NOLOCK)  ON A.UOM_CODE = U.UOM_CODE   
  WHERE A.ARTICLE_NO = @VPARAMETER  
    
  GOTO LAST  
  
  LBLGETARTICLE_RM_LIKE:  
 
  SELECT  A.ARTICLE_CODE, A.ARTICLE_NO  
  FROM ARTICLE A (NOLOCK)     
  WHERE A.ARTICLE_TYPE<>1
  AND A.INACTIVE =0 AND ISNULL(A.ARTICLE_NO,'')<>''   
  AND (@VPARAMETER='' OR A.ARTICLE_NO LIKE '%'+ @VPARAMETER +'%'  )
  ORDER BY A.ARTICLE_NO  
    
  GOTO LAST  
    
LAST:     
 GOTO END_PROC  
  
  SET NOCOUNT OFF;  
 END TRY    
 BEGIN CATCH    
  SET @ERRMSG_OUT='ERROR: [P]: SPPPC_FILL_ARTICLE, [STEP]: '+CAST(@CSTEP AS VARCHAR(5))+', [MESSAGE]: ' + ERROR_MESSAGE()  
  GOTO END_PROC    
 END CATCH     
  
END_PROC:    
 IF  ISNULL(@ERRMSG_OUT,'')<>''   
  SELECT @ERRMSG_OUT AS ERRORMSG  
END  
