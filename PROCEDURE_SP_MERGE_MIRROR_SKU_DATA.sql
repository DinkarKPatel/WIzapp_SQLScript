create PROCEDURE SP_MERGE_MIRROR_SKU_DATA
(
	@CPRODUCTCODEPARA VARCHAR(50),
	@CERRMSG VARCHAR(MAX) OUTPUT
	--,@BCALLEDFROMSLS BIT=0, ADD BACK THIS PARAMETER WHEN CHANGE DONE IN APPLICATION
)
--WITH ENCRYPTION
AS
BEGIN
	DECLARE @DTSQL NVARCHAR(MAX),@CTMP_TABLENAME VARCHAR(200),@BCALLEDFROMSLS BIT,
			@CJOINSTR VARCHAR(MAX),@CTABLESUFFIX VARCHAR(100),
			@CTABLENAME VARCHAR(200),@CSTEP VARCHAR(20),@CKEYFIELD VARCHAR(100),
			@CKEYFIELD1 VARCHAR(100),@CTABLE_SUFFIX VARCHAR(50),@CTABLESSTR VARCHAR(500),
			@BMSTINSERTONLY BIT,@CSOURCEDB VARCHAR(500),@CMERGEDB VARCHAR(500),@NDISCPCT NUMERIC(7,3),
			@CENABLEOPTIMIZEDSCHEMES BIT ,@NUPDATEMODENEW INT
	
	BEGIN TRY

	   SET @CSTEP = 10
		
	   SET @CERRMSG=''
	   
	   SET @CTABLESUFFIX=REPLACE(@CPRODUCTCODEPARA,'-','_')	
	   
	   SELECT @CSOURCEDB=DB_NAME()+'_TEMP.DBO.',@CMERGEDB=DB_NAME()+'.DBO.'		
	   
	   SET @BMSTINSERTONLY=1
	   
 	   BEGIN TRANSACTION
 	   
	   SET @CSTEP = 30
	   SET @CTABLE_SUFFIX=REPLACE(@CPRODUCTCODEPARA,'-','_')
	
	   SET @CSTEP = 40
	   SET @CTABLENAME='STATE'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='STATE_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=50

	   
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
			  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
			  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
			  ,@BALWAYSUPDATE=1 														
	
	   SET @CSTEP = 60
	   SET @CTABLENAME='CITY'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='CITY_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=70
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 													
	
	   SET @CSTEP = 80
	   SET @CTABLENAME='AREA'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='AREA_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=90
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 												
		
	   SET @CSTEP = 100
	   SET @CTABLENAME='HD01106'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='HEAD_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=110
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 											
		
	   SET @CSTEP = 120
	   SET @CTABLENAME='LM01106'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='AC_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=130
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 									
		
	   SET @CSTEP = 140
	   SET @CTABLENAME='LMP01106'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='AC_CODE'
	   SET @CKEYFIELD1=''
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 								

	   SET @CSTEP = 150
	   SET @CTABLENAME='FORM'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='FORM_ID'
	   SET @CSTEP=450
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 
	   
		
	   SET @CSTEP = 160
	   SET @CTABLENAME='UOM'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='UOM_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=170
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 							
							  
	   SET @CSTEP = 162
	   SET @CTABLENAME='SECTIONM'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='SECTION_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=164
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 											
							  
	   SET @CSTEP = 166
	   SET @CTABLENAME='SECTIOND'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='SUB_SECTION_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=168
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 																		  		  
		
	   SET @CSTEP = 180
	   SET @CTABLENAME='ARTICLE'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='ARTICLE_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=190
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 						
		
	   SET @CSTEP = 200
	   SET @CTABLENAME='PARA1'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='PARA1_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=210
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 					
	
	   SET @CSTEP = 220
	   SET @CTABLENAME='PARA2'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='PARA2_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=230
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 				
	
	   SET @CSTEP = 240
	   SET @CTABLENAME='PARA3'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='PARA3_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=350
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 			
	
	   SET @CSTEP = 260
	   SET @CTABLENAME='PARA4'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='PARA4_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=270
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 			

	   SET @CSTEP = 280
	   SET @CTABLENAME='PARA5'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='PARA5_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=290
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 			

	   SET @CSTEP = 300
	   SET @CTABLENAME='PARA6'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='PARA6_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=310
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 			

	   SET @CSTEP = 320
	   SET @CTABLENAME='ATTRM'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='ATTRIBUTE_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=330
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 		

	   SET @CSTEP = 340
	   SET @CTABLENAME='ATTR_KEY'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='KEY_CODE'
	   SET @CKEYFIELD1=''
	   SET @CSTEP=350
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1='ATTRIBUTE_CODE',@CKEYFIELD2='KEY_NAME',@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 	

	   SET @CSTEP = 360
	   SET @CTABLENAME='ART_ATTR'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='ARTICLE_CODE'
	   SET @CKEYFIELD1='ATTRIBUTE_CODE'
	   SET @CSTEP=370
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2=@CKEYFIELD1,@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 

	   SET @CSTEP = 380
	   SET @CTABLENAME='SKU'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   
	   SET @DTSQL=N'UPDATE SK SET SK.HSN_CODE= (CASE WHEN ISNULL(ART.HSN_CODE,'''')='''' 
	                THEN ''0000000000'' ELSE ART.HSN_CODE END) FROM '+@CSOURCEDB+@CTMP_TABLENAME+' SK
				JOIN ARTICLE(NOLOCK) ART ON SK.ARTICLE_CODE=ART.ARTICLE_CODE
				JOIN SECTIOND(NOLOCK) SD ON SD.SUB_SECTION_CODE=ART.SUB_SECTION_CODE
				WHERE ISNULL(SK.HSN_CODE,'''') IN (''0000000000'','''')'
	   EXEC SP_EXECUTESQL @DTSQL
	
	   SET @CKEYFIELD='PRODUCT_CODE'
	   SET @CSTEP=390
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 
	
	   
	   SET @CSTEP = 400
	   SET @CTABLENAME='SKU_OH'
	   SET @CTMP_TABLENAME='TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
	   SET @CKEYFIELD='PRODUCT_CODE'
	   SET @CSTEP=410
	   EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=@BMSTINSERTONLY,@CFILTERCONDITION='',@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1 
		
	   IF @BCALLEDFROMSLS=1
	   BEGIN
			SET @CSTEP=410	
   			SET @DTSQL=N'SELECT @NDISCPCT=DISCOUNT_PERCENTAGE FROM TMP_SKU_'+@CTABLENAME+'_'+LTRIM(RTRIM(@CTABLE_SUFFIX))
   			EXEC SP_EXECUTESQL @DTSQL,N'@NDISCPCT NUMERIC(7,3) OUTPUT',@NDISCPCT OUTPUT
   			
   			IF NOT EXISTS (SELECT TOP 1 PRODUCT_CODE FROM GR_HISTORY (NOLOCK) WHERE PRODUCT_CODE=@CPRODUCTCODEPARA)
   				INSERT GR_HISTORY (PRODUCT_CODE,STATUS,DISCOUNT_PERCENTAGE)
   				SELECT @CPRODUCTCODEPARA AS PRODUCT_CODE,1 AS STATUS,@NDISCPCT AS DISCOUNT_PERCENTAGE
   			ELSE 
   				UPDATE GR_HISTORY SET DISCOUNT_PERCENTAGE=@NDISCPCT,STATUS=1 
   				WHERE PRODUCT_CODE=@CPRODUCTCODEPARA
	   END	
	   
	 
	   
	END TRY
	BEGIN CATCH
		SET @CERRMSG='P:SP_MERGE_MIRROR_SKU_DATA, STEP:'+LTRIM(RTRIM(STR(@CSTEP)))+', MESSAGE:'+ERROR_MESSAGE()
	END CATCH

EXIT_PROC:
	IF @@TRANCOUNT>0
	BEGIN
		IF ISNULL(@CERRMSG,'')=''
			COMMIT
		ELSE
			ROLLBACK
	END
		
	SET @CTABLESSTR='STATE,CITY,AREA,HD01106,LM01106,LMP01106,FORM,UOM,ARTICLE,SECTIOND,SECTIONM,PARA1,PARA2,PARA3,PARA4,PARA5,PARA6,ATTRM,ART_ATTR,ATTR_KEY,SKU,SKU_OH,FORM'

    EXEC SP3S_DROPTEMPTABLES_MIRRORDATA
    @CXNTYPE='SKU',
    @CTABLESUFFIX=@CTABLESUFFIX,
    @CTABLESSTR=@CTABLESSTR

END	
---END OF PROCEDURE - SP_MERGE_MIRROR_SKU_DATA
