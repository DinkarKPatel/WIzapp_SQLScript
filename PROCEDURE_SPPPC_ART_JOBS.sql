CREATE  PROCEDURE SPPPC_ART_JOBS    
(    
 @CARTICLE_CODE VARCHAR(10)='',    
 @CROW_ID VARCHAR(100)=''    
)    
AS    
BEGIN    
   
  IF EXISTS( SELECT * FROM PPC_BO_ART_JOBS BJ WHERE BJ.REF_ROW_ID=@CROW_ID)
  BEGIN
  
      SELECT CAST (CASE WHEN BJ.JOB_CODE IS NULL THEN 0 ELSE 1 END AS BIT) AS CHK,    
         ART.ARTICLE_NO, A.ARTICLE_CODE, A.JOB_CODE,JOB_NAME,  
         JOB_ORDER=CASE WHEN COALESCE(BJ.JOB_ORDER,0)=0 THEN  
         A.JOB_ORDER  ELSE  BJ.JOB_ORDER  END,  
         A.JOB_RATE,    
         @CROW_ID AS REF_ROW_ID,START_DT=GETDATE(),    
         TARGET_DT=GETDATE(),    
         ROW_ID=CAST('LATER' AS VARCHAR(40)),LAST_UPDATE=GETDATE()    
  FROM ART_JOBS A    
  JOIN JOBS B ON A.JOB_CODE=B.JOB_CODE    
  JOIN ARTICLE ART ON ART.ARTICLE_CODE=A.ARTICLE_CODE    
  LEFT OUTER JOIN PPC_BO_ART_JOBS BJ ON BJ.JOB_CODE =A.JOB_CODE 
  AND BJ.REF_ROW_ID=@CROW_ID    
  WHERE A.ARTICLE_CODE=@CARTICLE_CODE  ORDER BY  A.JOB_ORDER 
  END

  ELSE
  BEGIN
   
       SELECT CAST(1  AS BIT) AS CHK,    
         ART.ARTICLE_NO, A.ARTICLE_CODE, A.JOB_CODE,JOB_NAME,  
         JOB_ORDER=CASE WHEN COALESCE(BJ.JOB_ORDER,0)=0 THEN  
         A.JOB_ORDER  ELSE  BJ.JOB_ORDER  END,  
         A.JOB_RATE,    
         @CROW_ID AS REF_ROW_ID,START_DT=GETDATE(),    
         TARGET_DT=GETDATE(),    
         ROW_ID=CAST('LATER' AS VARCHAR(40)),LAST_UPDATE=GETDATE()    
  FROM ART_JOBS A    
  JOIN JOBS B ON A.JOB_CODE=B.JOB_CODE    
  JOIN ARTICLE ART ON ART.ARTICLE_CODE=A.ARTICLE_CODE    
  LEFT OUTER JOIN PPC_BO_ART_JOBS BJ ON BJ.JOB_CODE =A.JOB_CODE 
  AND BJ.REF_ROW_ID=@CROW_ID    
  WHERE A.ARTICLE_CODE=@CARTICLE_CODE  ORDER BY  A.JOB_ORDER 
  END
    
END
