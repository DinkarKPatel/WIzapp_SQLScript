   




IF NOT EXISTS (SELECT CONFIG_OPTION FROM CONFIG WHERE CONFIG_OPTION='POPULATE_REPLOCS' AND VALUE=1)
BEGIN
	PRINT 'TRANSFERRING LINKED REPORTS INFO TO REPLOCS TABLE.....PLEASE STANDBY '

	DECLARE @CCURLOCID CHAR(2),@CHOLOCID CHAR(2)
	SELECT TOP 1 @CCURLOCID = VALUE FROM CONFIG (NOLOCK) WHERE CONFIG_OPTION='LOCATION_ID'	
	SELECT TOP 1 @CHOLOCID = VALUE FROM CONFIG (NOLOCK) WHERE CONFIG_OPTION='HO_LOCATION_ID'	
	
	IF @CCURLOCID=@CHOLOCID
	BEGIN
		INSERT REPLOCS	( DEPT_ID, REP_ID, USER_CODE )  
		SELECT DISTINCT @CCURLOCID AS DEPT_ID,A.REP_ID, A.USER_CODE FROM REF_REP_MST A
		LEFT OUTER JOIN REPLOCS B ON A.REP_ID=B.REP_ID AND A.USER_CODE=B.USER_CODE AND B.DEPT_ID=@CCURLOCID
		WHERE B.REP_ID IS NULL

		DELETE FROM REF_REP_MST
	END
		
	IF NOT EXISTS (SELECT CONFIG_OPTION FROM CONFIG WHERE CONFIG_OPTION='POPULATE_REPLOCS')
		INSERT CONFIG (CONFIG_OPTION,VALUE,ROW_ID,LAST_UPDATE)
			   VALUES ('POPULATE_REPLOCS',1,'',GETDATE())	
	ELSE
		UPDATE CONFIG SET VALUE=1 WHERE CONFIG_OPTION='POPULATE_REPLOCS'
END		
