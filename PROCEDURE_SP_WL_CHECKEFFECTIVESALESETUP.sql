-- RETURNS THE SALES SETUP DETAILS OF GIVEN BARCODE AT GIVEN DATE
CREATE PROCEDURE SP_WL_CHECKEFFECTIVESALESETUP--(LocId 3 digit change only increased the parameter width by Sanjay:01-11-2024)
(
	@CXNDT	DATETIME,
	@cLocationId VARCHAR(4)=''
)
--WITH ENCRYPTION
AS 
BEGIN
	DECLARE @BFLAG	BIT,@NCOUNT NUMERIC(10),@CAPPLYNEWEOSS VARCHAR(5),@CCURLOCID VARCHAR(5),@CHOLOCID VARCHAR(5),
			@bServerLoc BIT
	
	SET @BFLAG=0
	
	SELECT TOP 1 @CCURLOCID=DEPT_ID FROM NEW_APP_LOGIN_INFO (nolock) WHERE SPID=@@SPID 
	SELECT TOP 1 @CHOLOCID=VALUE FROM CONFIG (NOLOCK) WHERE CONFIG_OPTION='HO_LOCATION_ID'
	
	IF @cLocationId=''
		SET @cLocationId=@CCURLOCID
	
	SELECT @bServerLoc=isnull(server_loc,0) from location where dept_id=@cLocationId
	--SELECT ServerLoc=@bServerLoc,LocationId=@cLocationId
	SELECT TOP 1 @CAPPLYNEWEOSS=VALUE FROM CONFIG (NOLOCK) WHERE  CONFIG_OPTION='APPLY_NEW_EOSS'
	
	IF @bServerLoc=1
		SELECT  @NCOUNT=COUNT(*) FROM SCHEME_SETUP_MST A
		JOIN SCHEME_SETUP_DET D ON A.MEMO_NO = D.MEMO_NO 
		LEFT OUTER JOIN SCHEME_SETUP_LOC B ON A.MEMO_NO=B.MEMO_NO
		WHERE @CXNDT BETWEEN APPLICABLE_FROM_DT AND APPLICABLE_TO_DT AND (isnull(B.DEPT_ID,'')=@cLocationId OR b.dept_id IS NULL)
	ELSE
		SELECT  @NCOUNT=COUNT(*) FROM SCHEME_SETUP_MST A
		JOIN SCHEME_SETUP_DET D ON A.MEMO_NO = D.MEMO_NO 
		WHERE @CXNDT BETWEEN APPLICABLE_FROM_DT AND APPLICABLE_TO_DT
	
	IF(@NCOUNT>0)
		SET @BFLAG=1
		
	SELECT @BFLAG AS RESULT
END
--*************************************** END OF PROCEDURE SP_WL_GETSALESETUPDETAILS
