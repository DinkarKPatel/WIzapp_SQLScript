CREATE PROCEDURE SP_SEND_MIRROR_SHF_DATA_NEW
(	
	@CUPLOADEDXNID VARCHAR(50)
	,@CCURLOCID VARCHAR(4)	
	,@BACKNOWLEDGE BIT=0 
	,@CERRMSG VARCHAR(1000) OUTPUT
)	
--WITH ENCRYPTION
AS
/*
	SP_SEND_MIRROR_SHF_DATA_208_05_02_14 : THIS PROCEDURE WILL SEND APPROVAL RETURN DATA FROM LOCATION TO HO.
*/
BEGIN
	DECLARE @DTSQL NVARCHAR(MAX),@CSPID VARCHAR(10),@CTEMPTABLE VARCHAR(500),
	@CTEMPMASTERTABLE VARCHAR(200),@CTEMPLMTABLE VARCHAR(200),@CTEMPLMPTABLE VARCHAR(200)
	,@CTEMPAREATABLE VARCHAR(200),@CTEMPCITYTABLE VARCHAR(200),@CTEMPCUSTABLE VARCHAR(200),@CTEMPEMPTABLE VARCHAR(200)
	,@CTEMPPAYTABLE VARCHAR(200),@CTEMPPMSTTABLE VARCHAR(200),@CTEMPDETAILTABLE VARCHAR(200)
	,@DMEMOLASTUPDATE DATETIME,@CTABLENAME VARCHAR(100),@BRECFOUND BIT,@CSTEP VARCHAR(5),@CFILTERCONDITION VARCHAR(MAX),@CCUTOFFDATE VARCHAR(20)
	,@CKEYFIELD VARCHAR(100)
	DECLARE @TXNSSENDINFO TABLE (ORG_TABLENAME VARCHAR(50),TMP_TABLENAME VARCHAR(50),XN_ID VARCHAR(40))  	

BEGIN TRY 
	
	---- CALL ACKNOWLEDGEMENT OF MEMO SUCCESSFUL MERGING AT MIRRORING SERVER
	DECLARE @CTEMPDBNAME VARCHAR(40)
	
	SET @CTEMPDBNAME=1
		
	SET @CSTEP=10
	SET @CFILTERCONDITION=''
	SET @CFILTERCONDITION=@CFILTERCONDITION+'LEFT(A.SHIFT_ID,2)='''+@CCURLOCID+'''  AND DATEDIFF(DD,A.OPEN_TIME,GETDATE())<=370 AND  '

	SET @CSTEP=30

LBLTABLEINFO:
	SET @CSTEP=50
	---- POPULATE LIST OF TABLES 
/*TILL_LIFTS,LM01106,LMP01106,HD01106,CUSTDYM,AREA,CITY,STATE,EMPLOYEE,PAYMODE_XN_DET,PAYMODE_MST,PAYMODE_GRP_MST*/
	

    SET @CSTEP=120
    
	SELECT A.*,'SHF_TILL_SHIFT_MST_UPLOAD' AS TARGET_TABLENAME FROM TILL_SHIFT_MST A WHERE SHIFT_ID=@CUPLOADEDXNID
    
    SET @CSTEP=130
    
	SELECT A.*,'SHF_TILL_SHIFT_DET_UPLOAD' AS TARGET_TABLENAME FROM TILL_SHIFT_DET A WHERE SHIFT_ID=@CUPLOADEDXNID
    
    
	GOTO END_PROC
		
END TRY
BEGIN CATCH
	SET @CERRMSG='P: SP_SEND_MIRROR_SHF_DATA, STEP:'+@CSTEP+', MESSAGE:'+ERROR_MESSAGE()
	GOTO END_PROC
END CATCH 		
END_PROC:
	
END
---END OF PROCEDURE - SP_SEND_MIRROR_SHF_DATA
