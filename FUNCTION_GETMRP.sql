CREATE FUNCTION GETMRP
(
 @PRODUCTCODE VARCHAR(100),
 @CDEPTID CHAR(2)
)

RETURNS NUMERIC(14,2)
--WITH ENCRYPTION

AS
BEGIN

DECLARE @CMRP NUMERIC(14,2)

SELECT  TOP 1 @CMRP= ISNULL(B.MRP,A.MRP)          
FROM SKU A (NOLOCK)
LEFT OUTER JOIN LOCSKUSP  B (NOLOCK) ON  A.PRODUCT_CODE=B.PRODUCT_CODE  AND B.DEPT_ID  = @CDEPTID
WHERE A.PRODUCT_CODE = @PRODUCTCODE
ORDER BY B.LAST_UPDATE  DESC   

RETURN ISNULL(@CMRP,0)
END
