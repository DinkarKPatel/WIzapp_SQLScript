create PROCEDURE SPSIS_SEND_MIRROR_WSL_DATA
(
@CPANNO VARCHAR(10)='SOFTINFOSY'
,@CREQXNID VARCHAR(50)
,@CCURLOCID VARCHAR(5)/*Rohit 01-11-2024*/
,@BACKNOWLEDGE BIT=0
,@CERRMSG VARCHAR(1000) OUTPUT
)
--WITH ENCRYPTION
AS
BEGIN
/*CMM01106,CMM01106_AUDIT,CMD01106,CMD01106_AUDIT,rps_mst,CMR01106,CUSTDYM,PREFIX,EMPLOYEE,EMPLOYEE,EMPLOYEE
PAYMODE_XN_DET,PAYMODE_MST,PAYMODE_GRP_MST,SKU,LM01106,HD01106,LMP01106,AREA,CITY,STATE,DTM*/				

	DECLARE @DTSQL NVARCHAR(MAX),@CSPID VARCHAR(10),@CTEMPTABLE VARCHAR(500),@CMEMOID VARCHAR(50),
	@CTEMPEMPLOYEETABLE VARCHAR(200),@DMEMOLASTUPDATE DATETIME,@CTABLENAME VARCHAR(100),@BRECFOUND BIT,
	@CWHERECLAUSE VARCHAR(MAX),@CFILTERCONDITION VARCHAR(MAX),@CFILTERCONDITION1 VARCHAR(MAX),@CFILTERCONDITION2 VARCHAR(MAX),
	@CCUTOFFDATE VARCHAR(20),@CSTEP VARCHAR(5),@CTEMPMASTERTABLE VARCHAR(200),@CTEMPDETAILTABLE VARCHAR(200),@CTEMPLMTABLE VARCHAR(200),
	@CTEMPLMPTABLE VARCHAR(200),@CTEMPAREATABLE VARCHAR(200),@CTEMPCITYTABLE VARCHAR(200),
	@CTEMPPMODEXNTABLE VARCHAR(200),@CTEMPPMODETABLE VARCHAR(200),@CTEMPCUSTTABLE VARCHAR(200),
	@CTEMPCOUPONTABLE VARCHAR(200),@BPENDINGMSTFOUND BIT,@CTEMPAUDITTABLE VARCHAR(500),@NROWCOUNT INT


BEGIN TRY
	
	
	SET @CSTEP=10
	DECLARE @CTEMPDBNAME1 VARCHAR(40),@CTEMPDBNAME VARCHAR(40)


	set @CTEMPDBNAME1=''
	set @CTEMPDBNAME=''

	SET @CSTEP=15		
	SET @CMEMOID=@CREQXNID
	
	IF @BACKNOWLEDGE=1
		GOTO LBLTABLEINFO

	SET @CSTEP=20		
	
	

LBLTABLEINFO:
	DECLARE @cCols NVARCHAR(MAX),@cnullableCols NVARCHAR(MAX), @cCmdCols NVARCHAR(MAX)

	
	IF @BACKNOWLEDGE=1
		GOTO END_PROC
			
	SET @CSTEP=60
	SELECT @cCols=COALESCE(@cCols+',','')+colname 	FROM ebo_xnssending_cols WHERE tablename='INM01106' 

	SET @cCmdCols=N'
	   SELECT ''WSL_INM01106_upload'' AS TARGET_TABLENAME,'+@cCols+' FROM INM01106  (NOLOCK)   WHERE INV_ID='''+@CMEMOID+''''
	PRINT @cCmdCols

	EXEC SP_EXECUTESQL @cCmdCols

	SET @CSTEP=65	
	SET @cCols=NULL
	SELECT @cCols=COALESCE(@cCols+',','')+'IND01106.'+colname FROM ebo_xnssending_cols	WHERE tablename='IND01106' 

	SET @cCOls=REPLACE(@cCOls,'IND01106.PRODUCT_CODE','CASE WHEN ISNULL(C.VENDOR_EAN_NO,'''')<>'''' THEN C.VENDOR_EAN_NO ELSE IND01106.PRODUCT_CODE END AS PRODUCT_CODE')


	PRINT @cCOls
	SET @cCmdCols=N'
		SELECT ''WSL_IND01106_upload'' AS TARGET_TABLENAME,'+@cCols+' 
		FROM IND01106  (NOLOCK)   
		JOIN SKU C (NOLOCK) ON C.PRODUCT_CODE=IND01106.PRODUCT_CODE
		JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =C.AC_CODE
		WHERE SUBSTRING(LMP.AC_GST_NO,3,10)='''+@CPANNO+'''
		AND IND01106.INV_ID='''+@CMEMOID+''''
	
	PRINT @cCmdCols

	EXEC SP_EXECUTESQL @cCmdCols

	EXEC SPSIS_GET_CURSOR_SKUNAMES @cXNTYPE='WSL',@cTABLENAME='IND01106',@cKEYNAME='INV_ID',@cKEYVALUE=@CMEMOID,@CERRMSG=@CERRMSG OUTPUT 
	IF ISNULL(@CERRMSG,'')<>'' 
		GOTO END_PROC
	

	GOTO END_PROC

END TRY

BEGIN CATCH
	SET @CERRMSG='P: SPSIS_SEND_MIRROR_WSL_DATA, STEP:'+@CSTEP+', MESSAGE:'+ERROR_MESSAGE()
	GOTO END_PROC
END CATCH
		
END_PROC:

END
--- 'END OF CREATING PROCEDURE - SP_SEND_MIRROR_SLS_DATA_NEW'
