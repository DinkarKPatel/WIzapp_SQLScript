if exists (select constraint_name from information_schema.table_constraints where constraint_name='fk_gst_accounts_config_det_1_xntype')
	alter table gst_accounts_config_det_1 drop constraint fk_gst_accounts_config_det_1_xntype

if exists (select constraint_name from information_schema.table_constraints where constraint_name='fk_gst_accounts_config_det_2_xntype')
	alter table gst_accounts_config_det_2 drop constraint fk_gst_accounts_config_det_2_xntype

DECLARE @GST_ACCOUNTS_CONFIG_MST TABLE
(
	[SNO] NUMERIC(4,2),
	[XN_TYPE] [VARCHAR](20),
	[DISPLAY_XN_TYPE] [VARCHAR](200),
	[ENABLEPOSTING] [BIT],
	[CUTOFFDATE] [DATETIME],
	[POST_BILL_BY_BILL_REFTYPE] [NUMERIC](1, 0),
	[POST_BILL_BY_BILL_ADJ_EXCEPTION_TYPE] [NUMERIC](1, 0) ,
	[CREATE_LEDGER_FOR_EACHCUSTOMER] [BIT] ,
	[POSTXFRBILLDATE] [BIT] ,
	[POSTING_XN_TYPE] [VARCHAR](20),
	[DISPLAY_POSTING_XN_TYPE] [VARCHAR](200)
)

PRINT 'STEP-2'
INSERT @GST_ACCOUNTS_CONFIG_MST	( SNO,XN_TYPE,DISPLAY_XN_TYPE, ENABLEPOSTING, CUTOFFDATE, POST_BILL_BY_BILL_REFTYPE, 
POST_BILL_BY_BILL_ADJ_EXCEPTION_TYPE,CREATE_LEDGER_FOR_EACHCUSTOMER,POSTXFRBILLDATE,
POSTING_XN_TYPE,DISPLAY_POSTING_XN_TYPE )  

SELECT 9 AS SNO,'CHO_WSL_SAME_PANNO' AS XN_TYPE,'GROUP WHOLESALE (Same PAN No.)' AS DISPLAY_XN_TYPE,0 AS ENABLEPOSTING,'2017-07-01' AS CUTOFFDATE,0 AS POST_BILL_BY_BILL_REFTYPE,
0 AS  POST_BILL_BY_BILL_ADJ_EXCEPTION_TYPE,0 AS CREATE_LEDGER_FOR_EACHCUSTOMER,0 AS POSTXFRBILLDATE,'XFR' AS POSTING_XN_TYPE,'GROUP TRANSFER' AS DISPLAY_POSTING_XN_TYPE	
UNION ALL
SELECT 9 AS SNO,'CHO_WSL_DIFF_PANNO' AS XN_TYPE,'GROUP WHOLESALE (Different PAN No.)' AS DISPLAY_XN_TYPE,0 AS ENABLEPOSTING,'2017-07-01' AS CUTOFFDATE,0 AS POST_BILL_BY_BILL_REFTYPE,
0 AS  POST_BILL_BY_BILL_ADJ_EXCEPTION_TYPE,0 AS CREATE_LEDGER_FOR_EACHCUSTOMER,0 AS POSTXFRBILLDATE,'XFR' AS POSTING_XN_TYPE,'GROUP TRANSFER' AS DISPLAY_POSTING_XN_TYPE
UNION ALL
SELECT 9 AS SNO,'CHI_PUR_SAME_PANNO' AS XN_TYPE,'GROUP PURCHASE (Same PAN No.)' AS DISPLAY_XN_TYPE,0 AS ENABLEPOSTING,'2017-07-01' AS CUTOFFDATE,0 AS POST_BILL_BY_BILL_REFTYPE,
0 AS  POST_BILL_BY_BILL_ADJ_EXCEPTION_TYPE,0 AS CREATE_LEDGER_FOR_EACHCUSTOMER,0 AS POSTXFRBILLDATE,'XFR' AS POSTING_XN_TYPE,'GROUP TRANSFER' AS DISPLAY_POSTING_XN_TYPE
UNION ALL
SELECT 9 AS SNO,'CHI_PUR_DIFF_PANNO' AS XN_TYPE,'GROUP PURCHASE (Different PAN No.)' AS DISPLAY_XN_TYPE,0 AS ENABLEPOSTING,'2017-07-01' AS CUTOFFDATE,0 AS POST_BILL_BY_BILL_REFTYPE,
0 AS  POST_BILL_BY_BILL_ADJ_EXCEPTION_TYPE,0 AS CREATE_LEDGER_FOR_EACHCUSTOMER,0 AS POSTXFRBILLDATE,'XFR' AS POSTING_XN_TYPE,'GROUP TRANSFER' AS DISPLAY_POSTING_XN_TYPE
UNION ALL
SELECT 9 AS SNO,'CHO_PRT_SAME_PANNO' AS XN_TYPE,'GROUP DEBIT NOTE (Same PAN No.)' AS DISPLAY_XN_TYPE,0 AS ENABLEPOSTING,'2017-07-01' AS CUTOFFDATE,0 AS POST_BILL_BY_BILL_REFTYPE,
0 AS  POST_BILL_BY_BILL_ADJ_EXCEPTION_TYPE,0 AS CREATE_LEDGER_FOR_EACHCUSTOMER,0 AS POSTXFRBILLDATE,'XFR' AS POSTING_XN_TYPE,'GROUP TRANSFER' AS DISPLAY_POSTING_XN_TYPE	
UNION ALL
SELECT 9 AS SNO,'CHO_PRT_DIFF_PANNO' AS XN_TYPE,'GROUP DEBIT NOTE (Different PAN No.)' AS DISPLAY_XN_TYPE,0 AS ENABLEPOSTING,'2017-07-01' AS CUTOFFDATE,0 AS POST_BILL_BY_BILL_REFTYPE,
0 AS  POST_BILL_BY_BILL_ADJ_EXCEPTION_TYPE,0 AS CREATE_LEDGER_FOR_EACHCUSTOMER,0 AS POSTXFRBILLDATE,'XFR' AS POSTING_XN_TYPE,'GROUP TRANSFER' AS DISPLAY_POSTING_XN_TYPE
UNION ALL
SELECT 9 AS SNO,'CHI_WSR_SAME_PANNO' AS XN_TYPE,'GROUP CREDIT NOTE (Same PAN No.)' AS DISPLAY_XN_TYPE,0 AS ENABLEPOSTING,'2017-07-01' AS CUTOFFDATE,0 AS POST_BILL_BY_BILL_REFTYPE,
0 AS  POST_BILL_BY_BILL_ADJ_EXCEPTION_TYPE,0 AS CREATE_LEDGER_FOR_EACHCUSTOMER,0 AS POSTXFRBILLDATE,'XFR' AS POSTING_XN_TYPE,'GROUP TRANSFER' AS DISPLAY_POSTING_XN_TYPE	
UNION ALL
SELECT 9 AS SNO,'CHI_WSR_DIFF_PANNO' AS XN_TYPE,'GROUP CREDIT NOTE (Different PAN No.)' AS DISPLAY_XN_TYPE,0 AS ENABLEPOSTING,'2017-07-01' AS CUTOFFDATE,0 AS POST_BILL_BY_BILL_REFTYPE,
0 AS  POST_BILL_BY_BILL_ADJ_EXCEPTION_TYPE,0 AS CREATE_LEDGER_FOR_EACHCUSTOMER,0 AS POSTXFRBILLDATE,'XFR' AS POSTING_XN_TYPE,'GROUP TRANSFER' AS DISPLAY_POSTING_XN_TYPE	
UNION ALL	
SELECT 9 AS SNO,'CHI_XFR' AS XN_TYPE,'STOCK TRANSFER IN' AS DISPLAY_XN_TYPE,0 AS ENABLEPOSTING,'2017-07-01' AS CUTOFFDATE,0 AS POST_BILL_BY_BILL_REFTYPE,
0 AS  POST_BILL_BY_BILL_ADJ_EXCEPTION_TYPE,0 AS CREATE_LEDGER_FOR_EACHCUSTOMER,0 AS POSTXFRBILLDATE,'XFR' AS POSTING_XN_TYPE,'GROUP TRANSFER' AS DISPLAY_POSTING_XN_TYPE
UNION ALL
SELECT 9 AS SNO,'CHO_XFR' AS XN_TYPE,'STOCK TRANSFER OUT' AS DISPLAY_XN_TYPE,0 AS ENABLEPOSTING,'2017-07-01' AS CUTOFFDATE,0 AS POST_BILL_BY_BILL_REFTYPE,
0 AS  POST_BILL_BY_BILL_ADJ_EXCEPTION_TYPE,0 AS CREATE_LEDGER_FOR_EACHCUSTOMER,0 AS POSTXFRBILLDATE,'XFR' AS POSTING_XN_TYPE,'GROUP TRANSFER' AS DISPLAY_POSTING_XN_TYPE



DELETE a FROM gst_accounts_config_det_revenue a WITH (ROWLOCK) 
JOIN GST_ACCOUNTS_CONFIG_MST b (NOLOCK) ON a.xn_type=b.xn_type
WHERE posting_xn_type='XFR'

UPDATE a SET ENABLEPOSTING=b.ENABLEPOSTING FROM @GST_ACCOUNTS_CONFIG_MST A 
JOIN GST_ACCOUNTS_CONFIG_MST B ON LEFT(A.XN_TYPE,7)=LEFT(B.XN_TYPE,7) AND a.POSTING_XN_TYPE=b.posting_xn_type


DELETE FROM GST_ACCOUNTS_CONFIG_MST where posting_xn_type='XFR'


INSERT GST_ACCOUNTS_CONFIG_MST	( SNO,XN_TYPE,DISPLAY_XN_TYPE, ENABLEPOSTING, CUTOFFDATE, POST_BILL_BY_BILL_REFTYPE, 
POST_BILL_BY_BILL_ADJ_EXCEPTION_TYPE,CREATE_LEDGER_FOR_EACHCUSTOMER,POSTXFRBILLDATE,
POSTING_XN_TYPE,DISPLAY_POSTING_XN_TYPE ) 
SELECT A.SNO,A.XN_TYPE,A.DISPLAY_XN_TYPE, A.ENABLEPOSTING,A.CUTOFFDATE,A.POST_BILL_BY_BILL_REFTYPE, 
A.POST_BILL_BY_BILL_ADJ_EXCEPTION_TYPE,A.CREATE_LEDGER_FOR_EACHCUSTOMER,A.POSTXFRBILLDATE,
A.POSTING_XN_TYPE,A.DISPLAY_POSTING_XN_TYPE FROM @GST_ACCOUNTS_CONFIG_MST A 
LEFT OUTER JOIN GST_ACCOUNTS_CONFIG_MST B ON A.XN_TYPE=B.XN_TYPE
WHERE B.XN_TYPE IS NULL

--select * from  gst_accounts_config_mst where posting_xn_type='xfr'



