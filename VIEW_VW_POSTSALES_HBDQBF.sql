CREATE VIEW  VW_POSTSALES_HBDQBF --(LocId 3 digit change by Sanjay:07-11-2024)

AS
	SELECT  B.*,CONVERT(NVARCHAR,B.MEMO_DT,105) AS MST_MEMO_DT,B.MEMO_ID AS MST_MEMO_ID,
	B.MEMO_NO AS MST_MEMO_NO,E.CM_NO , D.PRODUCT_CODE,CUST.USER_CUSTOMER_CODE AS MST_USER_CUSTOMER_CODE, 
	(CUST.CUSTOMER_FNAME+' '+ CUST.CUSTOMER_LNAME ) AS MST_CUSTOMER_NAME,L.DEPT_NAME AS MST_DELIVERY_DEPT_NAME,
	D.QUANTITY,JOB.JOB_NAME,ART.ARTICLE_NO,P1.PARA1_NAME,P2.PARA2_NAME,P3.PARA3_NAME,
	P4.PARA4_NAME,P5.PARA5_NAME,P6.PARA6_NAME,UOM.UOM_NAME,ART.ARTICLE_NAME,ART.ALIAS AS ARTICLE_ALIAS,
	SD.SUB_SECTION_NAME,D.MRP,SM.SECTION_NAME,EMP.EMP_NAME,0 AS NET,C.DELIVERY_DT,C.DESCRIPTION,
	DELIVERED AS CHKDELIVER
	FROM HOLD_BACK_DELIVER_MST  B (NOLOCK) 
	JOIN HOLD_BACK_DELIVER_DET C (NOLOCK) ON B.MEMO_ID = C.MEMO_ID 
	JOIN CMD01106 D (NOLOCK) ON C.REF_CMD_ROW_ID = D.ROW_ID 
	JOIN CMM01106 E (NOLOCK) ON D.CM_ID = E.CM_ID 
	LEFT OUTER JOIN  CUSTDYM CUST (NOLOCK) ON CUST.CUSTOMER_CODE = B.CUSTOMER_CODE 
	LEFT OUTER JOIN LOCATION L (NOLOCK)ON L.DEPT_ID=B.DELIVERY_DEPT_ID 
	JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=D.PRODUCT_CODE      
	JOIN ARTICLE ART (NOLOCK) ON SKU.ARTICLE_CODE = ART.ARTICLE_CODE          
	JOIN SECTIOND SD (NOLOCK) ON ART.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
	JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE = SM.SECTION_CODE        
	JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE = P1.PARA1_CODE          
	JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE = P2.PARA2_CODE          
	JOIN PARA3 P3 (NOLOCK)ON SKU.PARA3_CODE = P3.PARA3_CODE          
	JOIN PARA4 P4 (NOLOCK)ON SKU.PARA4_CODE = P4.PARA4_CODE          
	JOIN PARA5 P5 (NOLOCK)ON SKU.PARA5_CODE = P5.PARA5_CODE          
	JOIN PARA6 P6 (NOLOCK)ON SKU.PARA6_CODE = P6.PARA6_CODE          
	JOIN UOM UOM (NOLOCK)ON ART.UOM_CODE = UOM.UOM_CODE   
	LEFT OUTER JOIN EMPLOYEE EMP (NOLOCK)ON D.EMP_CODE = EMP.EMP_CODE 
    LEFT OUTER JOIN JOBS JOB (NOLOCK) ON JOB.JOB_CODE =C.JOB_CODE  
    UNION ALL
    SELECT  B.*,CONVERT(NVARCHAR,B.MEMO_DT,105) AS MST_MEMO_DT,B.MEMO_ID AS MST_MEMO_ID,
	B.MEMO_NO AS MST_MEMO_NO,'' AS CM_NO , C.PRODUCT_CODE,CUST.USER_CUSTOMER_CODE AS MST_USER_CUSTOMER_CODE, 
	(CUST.CUSTOMER_FNAME+' '+ CUST.CUSTOMER_LNAME ) AS MST_CUSTOMER_NAME,L.DEPT_NAME AS MST_DELIVERY_DEPT_NAME,
	C.QUANTITY,JOB.JOB_NAME,ART.ARTICLE_NO,'' AS PARA1_NAME,'' AS PARA2_NAME,'' AS PARA3_NAME,
	'' AS PARA4_NAME,'' AS PARA5_NAME,'' AS PARA6_NAME,UOM.UOM_NAME,ART.ARTICLE_NAME,ART.ALIAS AS ARTICLE_ALIAS,
	SD.SUB_SECTION_NAME,0 AS MRP,SM.SECTION_NAME,'' AS EMP_NAME,0 AS NET,C.DELIVERY_DT,C.DESCRIPTION,
	DELIVERED AS CHKDELIVER
	FROM HOLD_BACK_DELIVER_MST  B (NOLOCK) 
	JOIN HOLD_BACK_DELIVER_DET C (NOLOCK) ON B.MEMO_ID = C.MEMO_ID 
	LEFT OUTER JOIN  CUSTDYM CUST (NOLOCK) ON CUST.CUSTOMER_CODE = B.CUSTOMER_CODE 
	LEFT OUTER JOIN LOCATION L (NOLOCK)ON L.DEPT_ID=B.DELIVERY_DEPT_ID 
	LEFT JOIN SKU_REPAIR SKU (NOLOCK) ON SKU.PRODUCT_CODE=C.PRODUCT_CODE      
	LEFT JOIN ARTICLE ART (NOLOCK) ON SKU.ARTICLE_CODE = ART.ARTICLE_CODE          
	LEFT JOIN SECTIOND SD (NOLOCK) ON ART.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
	LEFT JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE = SM.SECTION_CODE                
	LEFT JOIN UOM UOM (NOLOCK)ON ART.UOM_CODE = UOM.UOM_CODE   
    LEFT OUTER JOIN JOBS JOB (NOLOCK) ON JOB.JOB_CODE =C.JOB_CODE  
    WHERE B.MODE =2
