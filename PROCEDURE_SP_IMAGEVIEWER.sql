CREATE PROCEDURE SP_IMAGEVIEWER 
@NQUERYID NUMERIC(3,0),  
@CWHERE VARCHAR(2000)='',  
@DATE VARCHAR(15)='',
@CFINYEAR VARCHAR(5) ,
@CSOURCETABLE VARCHAR(100)='',
@CSOURCECOL VARCHAR(100)=''
--WITH ENCRYPTION
AS  
BEGIN  
  
 IF @NQUERYID=1   
  GOTO LBLMRR
 ELSE   
 IF @NQUERYID=2  
  GOTO LBLPRODUCTCODE    
 ELSE       
 IF @NQUERYID=3  
  GOTO LBLARTICLE
 ELSE
 IF @NQUERYID =4
  GOTO LBLPARA
 ELSE
 IF @NQUERYID =5
  GOTO LBLMRRPRODUCT
 ELSE
 IF @NQUERYID =6
  GOTO LBLMRRARTICLE
 ELSE
 IF @NQUERYID =7
  GOTO LBLMRRPARA3
 ELSE
 IF @NQUERYID =8
  GOTO LBLTXTPRODUCT 
 ELSE
 IF @NQUERYID =9
  GOTO LBLTXTARTICLE 
 ELSE
 IF @NQUERYID =10
  GOTO LBLTXTPARA3 
 ELSE
 IF @NQUERYID =11
  GOTO LBLUPDATEDT           
 
   
 LBLMRR:              
         
         SELECT MRR_ID AS MEMO_ID,MRR_NO  AS MEMO_NO,CONVERT(CHAR(10),INV_DT,105) AS MEMO_DT,RECEIPT_DT AS RECV_DT
         FROM PIM01106 
         WHERE FIN_YEAR = @CFINYEAR AND CANCELLED = 0 ORDER BY MRR_ID 
         
         GOTO LAST 
    
 LBLPRODUCTCODE:
 
         SELECT  SKU.PRODUCT_CODE, 
                (CASE WHEN ISNULL(SKU.DT_CREATED,'')= '' THEN  SKU.RECEIPT_DT ELSE SKU.DT_CREATED END) AS DT_CREATED 
         FROM SKU (NOLOCK) 
         WHERE SKU.PRODUCT_CODE = @CWHERE
           
         GOTO LAST  
         
 LBLARTICLE:
      
       SELECT ARTICLE.ARTICLE_NO,(CASE WHEN ISNULL(DT_CREATED,'')= '' THEN  LAST_UPDATE ELSE DT_CREATED END) AS DT_CREATED
       FROM ARTICLE (NOLOCK) 
       ORDER BY ARTICLE_NO 
       
       GOTO LAST
       
LBLPARA:

      SELECT  PARA3.PARA3_NAME,(CASE WHEN ISNULL(PARA3.DT_CREATED,'')= '' THEN 
              PARA3.LAST_UPDATE ELSE PARA3.DT_CREATED END) AS DT_CREATED 
      FROM  PARA3 ORDER BY PARA3.PARA3_NAME
     
      GOTO LAST
     
     
LBLMRRPRODUCT:
        
      SELECT A.PRODUCT_CODE AS IMAGE_NAME,'' AS IMAGE_PATH,CAST(0 AS BIT )AS SAVE_IMAGE,
               CAST(1 AS BIT )AS CHKIMG,(CASE WHEN ISNULL(B.DT_CREATED,'')= '' THEN B.RECEIPT_DT ELSE B.DT_CREATED END) AS DT_CREATED  
      FROM PID01106 A  (NOLOCK)
      JOIN SKU B (NOLOCK) ON A.PRODUCT_CODE= B.PRODUCT_CODE
      WHERE MRR_ID = @CWHERE  ORDER BY SRNO 
           
      GOTO LAST 
      
LBLMRRARTICLE:   
      
      SELECT DISTINCT (B.ARTICLE_NO) AS IMAGE_NAME,'' AS IMAGE_PATH,CAST(0 AS BIT )AS SAVE_IMAGE,
             CAST(1 AS BIT )AS CHKIMG,(CASE WHEN ISNULL(B.DT_CREATED,'')= '' THEN B.LAST_UPDATE 
             ELSE B.DT_CREATED END) AS DT_CREATED
      FROM PID01106 A  (NOLOCK)
      JOIN ARTICLE  B (NOLOCK) ON A.ARTICLE_CODE= B.ARTICLE_CODE
      WHERE MRR_ID = @CWHERE  
         
      GOTO LAST  
      
LBLMRRPARA3: 

      SELECT DISTINCT (B.PARA3_NAME) AS IMAGE_NAME,'' AS IMAGE_PATH,CAST(0 AS BIT )AS SAVE_IMAGE,
             CAST(1 AS BIT )AS CHKIMG,(CASE WHEN ISNULL(B.DT_CREATED,'')= '' THEN B.LAST_UPDATE 
             ELSE B.DT_CREATED END) AS DT_CREATED,A.SRNO  
      FROM PID01106 A  (NOLOCK)
      JOIN PARA3  B (NOLOCK) ON A.PARA3_CODE= B.PARA3_CODE
      WHERE MRR_ID = @CWHERE  ORDER BY SRNO 
         
      GOTO LAST  
        
            
LBLTXTPRODUCT:
        
        DECLARE @CCMD  NVARCHAR(4000)              
        SET @CCMD = N'SELECT PRODUCT_CODE AS IMAGE_NAME,'''' AS IMAGE_PATH,CAST(0 AS BIT )AS SAVE_IMAGE, 
                      CAST(1 AS BIT )AS CHKIMG,
                      (CASE WHEN ISNULL(DT_CREATED,'''')= '''' THEN RECEIPT_DT ELSE DT_CREATED END) 
                      AS DT_CREATED FROM SKU  (NOLOCK) ' +  
                      CASE WHEN  LEN(@CWHERE) >1 THEN  'WHERE PRODUCT_CODE IN ( ' + @CWHERE + ')'  ELSE ' WHERE 1=2 ' END 
                   
        PRINT @CCMD
        EXEC SP_EXECUTESQL @CCMD         
       
        GOTO LAST  
        
        
 LBLTXTARTICLE:
        
                  
        SET @CCMD = N'SELECT ARTICLE_NO AS IMAGE_NAME,'''' AS IMAGE_PATH,CAST(0 AS BIT )AS SAVE_IMAGE, 
                      CAST(1 AS BIT )AS CHKIMG,
                      (CASE WHEN ISNULL(DT_CREATED,'''')= '''' THEN LAST_UPDATE ELSE DT_CREATED END) 
                      AS DT_CREATED FROM ARTICLE  (NOLOCK) ' +  
                      CASE WHEN  LEN(@CWHERE) >1 THEN  'WHERE ARTICLE_NO IN ( ' + @CWHERE + ')'  ELSE ' WHERE 1=2 ' END 
                   
        PRINT @CCMD
        EXEC SP_EXECUTESQL @CCMD         
       
        GOTO LAST 
        
 LBLTXTPARA3:
        
                  
        SET @CCMD = N'SELECT PARA3_NAME AS IMAGE_NAME,'''' AS IMAGE_PATH,CAST(0 AS BIT )AS SAVE_IMAGE, 
                      CAST(1 AS BIT )AS CHKIMG,
                      (CASE WHEN ISNULL(DT_CREATED,'''')= '''' THEN LAST_UPDATE ELSE DT_CREATED END) 
                      AS DT_CREATED FROM PARA3  (NOLOCK) ' +  
                      CASE WHEN  LEN(@CWHERE) >1 THEN  'WHERE PARA3_NAME IN ( ' + @CWHERE + ')'  ELSE ' WHERE 1=2 ' END 
                   
        PRINT @CCMD
        EXEC SP_EXECUTESQL @CCMD         
       
        GOTO LAST         
        
        
        
 LBLUPDATEDT: 
 
        SET @CCMD=   N'UPDATE '+ @CSOURCETABLE + ' SET DT_CREATED = '+ @DATE +' 
                        WHERE '+@CSOURCECOL +' = '+ @CWHERE +' AND ISNULL(DT_CREATED,'''') = '''''
               
        PRINT @CCMD
        EXEC SP_EXECUTESQL @CCMD    
        
        
LAST:    
END
