CREATE PROCEDURE SPACT_GET_FIN_DETAILS
(
	@dtToday DATETIME='',
	@iNoofYears INT=5,
	@iNoofNextYears INT=-1
)
AS
BEGIN

	--DECLARE @dtToday DATETIME='',
	DECLARE @i  INT=5, @cFINYEAR VARCHAR(5), @cFINYEAR_PREV VARCHAR(5),@dtToday1 DATETIME='',@dtToday2 DATETIME=''
	DECLARE @dtFINYAER TABLE (FIN_YEAR VARCHAR(10),FROM_DT DATETIME,TO_DT DATETIME,FINYEAR_STR VARCHAR(20),FIN_YEAR_PREV VARCHAR(10),FROM_DT_PREV DATETIME,TO_DT_PREV DATETIME,FINYEAR_STR_PREV VARCHAR(20))
	
	SET @iNoofYears=ABS(@iNoofYears)

	if @iNoofYears=0
		SET @iNoofYears=1

	IF ISNULL(@dtToday,'')=''
		SET @dtToday =GETDATE()
	
	if(@iNoofNextYears=-1)
	SET @iNoofNextYears=@iNoofYears

	SET @i=@iNoofYears

	

	WHILE (@i>0)
	BEGIN
		SET @dtToday1 =DATEADD(YY,-@i,@dtToday)
		SET @cFINYEAR='01'+DBO.FN_GETFINYEAR(@dtToday1)
		SET @dtToday2 =DATEADD(YY,-1,@dtToday1)
		SET @cFINYEAR_PREV='01'+DBO.FN_GETFINYEAR(@dtToday2)
		INSERT INTO @dtFINYAER(FIN_YEAR ,FROM_DT ,TO_DT ,FINYEAR_STR,FIN_YEAR_PREV ,FROM_DT_PREV ,TO_DT_PREV ,FINYEAR_STR_PREV)
		SELECT @cFINYEAR AS FIN_YEAR,DBO.FN_GETFINYEARDATE(@cFINYEAR,1) AS FROM_DT,DBO.FN_GETFINYEARDATE(@cFINYEAR,2) AS TO_DT,DBO.FN_GETFINYEARSTR(@dtToday1) AS FINYEAR_STR
		,@cFINYEAR_PREV AS FIN_YEAR_PREV,DBO.FN_GETFINYEARDATE(@cFINYEAR_PREV,1) AS FROM_DT_PREV,DBO.FN_GETFINYEARDATE(@cFINYEAR_PREV,2) AS TO_DT_PREV,DBO.FN_GETFINYEARSTR(@dtToday2) AS FINYEAR_STR_PREV
		SET @i-=1
	END

		--SET @cFINYEAR='01'+DBO.FN_GETFINYEAR(@dtToday)
		--INSERT INTO @dtFINYAER(FIN_YEAR ,FROM_DT ,TO_DT ,FINYEAR_STR)
		--SELECT @cFINYEAR AS FIN_YEAR,DBO.FN_GETFINYEARDATE(@cFINYEAR,1) AS FROM_DT,DBO.FN_GETFINYEARDATE(@cFINYEAR,2) AS TO_DT,DBO.FN_GETFINYEARSTR(@dtToday) AS FINYEAR_STR


	WHILE (@i<=@iNoofNextYears)
	BEGIN
		SET @dtToday1 =DATEADD(YY,@i,@dtToday)
		SET @cFINYEAR='01'+DBO.FN_GETFINYEAR(@dtToday1)
		SET @dtToday2 =DATEADD(YY,-1,@dtToday1)
		SET @cFINYEAR_PREV='01'+DBO.FN_GETFINYEAR(@dtToday2)
		INSERT INTO @dtFINYAER(FIN_YEAR ,FROM_DT ,TO_DT ,FINYEAR_STR,FIN_YEAR_PREV ,FROM_DT_PREV ,TO_DT_PREV ,FINYEAR_STR_PREV)
		SELECT @cFINYEAR AS FIN_YEAR,DBO.FN_GETFINYEARDATE(@cFINYEAR,1) AS FROM_DT,DBO.FN_GETFINYEARDATE(@cFINYEAR,2) AS TO_DT,DBO.FN_GETFINYEARSTR(@dtToday1) AS FINYEAR_STR
		,@cFINYEAR_PREV AS FIN_YEAR_PREV,DBO.FN_GETFINYEARDATE(@cFINYEAR_PREV,1) AS FROM_DT_PREV,DBO.FN_GETFINYEARDATE(@cFINYEAR_PREV,2) AS TO_DT_PREV,DBO.FN_GETFINYEARSTR(@dtToday2) AS FINYEAR_STR_PREV
		SET @i+=1
	END

	SELECT * FROM @dtFINYAER 
END
