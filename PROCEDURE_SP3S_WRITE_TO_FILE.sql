CREATE PROCEDURE SP3S_WRITE_TO_FILE
@MSG VARCHAR(MAX),
@FILE VARCHAR(100),
@OVERWRITE BIT = 0
AS

/*
  DATE WRITTEN: JUNE 16TH 2015
 PURPOSE: TO LOG MESSAGES TO TEXT FILES FROM STORED PROCEDURES/TRIGGERS/SQL SCRIPTS
 INPUT PARAMETERS: MESSAGE, FILE NAME, OVERWRITE FLAG (1 TO OVERWRITE, 0 
TO APPEND TO FILE, 0 IS THE DEFAULT)
 EXAMPLE: EXEC SP3S_WRITE_TO_FILE 'DUPLICATES FOUND','C:\LOGFILE.TXT',0
 TESTED ON: SQL SERVER VERSION 2008 R2
 REMARKS: YOU SHOULD HAVE PERMISSIONS REQUIRED THROUGH ACCESS FILE SYSTEM THROUGH XP_CMDSHELL
 SEE SQL SERVER BOOKS ONLINE FOR XP_CMDSHELL IF YOU ARE HAVING PROBLEMS WITH THIS PROCEDURE
*/

BEGIN
	SET NOCOUNT ON
	DECLARE @EXECSTR VARCHAR(8000)
	SET @EXECSTR = RTRIM('ECHO ' + COALESCE(LTRIM(@MSG),'-') + CASE WHEN 
	(@OVERWRITE = 1) THEN ' > ' ELSE ' >> ' END + RTRIM(@FILE))
	EXEC MASTER..XP_CMDSHELL @EXECSTR, NO_OUTPUT
	SET NOCOUNT OFF
END
