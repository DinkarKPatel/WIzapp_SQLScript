CREATE PROCEDURE UPDATEPMTMRP (@CMRRID VARCHAR(22))
--WITH ENCRYPTION
AS
BEGIN
	--IF EXISTS (SELECT NAME FROM TEMPDB..SYSOBJECTS WHERE NAME LIKE '%TMPPMTIRR%')
	--		DROP TABLE #TMPPMTIRR

	--SELECT DISTINCT A.PRODUCT_CODE INTO #TMPPMTIRR FROM PID01106 A 
	--JOIN SKU B	ON A.PRODUCT_CODE=B.PRODUCT_CODE
	--JOIN IRD01106 C ON B.PRODUCT_CODE=C.PRODUCT_CODE
	--WHERE A.MRR_ID=@CMRRID AND A.MRP<>B.MRP AND B.MRP=C.NEW_MRP

--	UPDATE PMT01106 SET MRP = B.MRP ,WS_PRICE = B.WS_PRICE 
-- 	FROM PID01106 B JOIN ARTICLE C ON B.ARTICLE_CODE=C.ARTICLE_CODE 
--	WHERE B.MRR_ID=@CMRRID AND C.CODING_SCHEME<>1 
--    AND PMT01106.PRODUCT_CODE =B.PRODUCT_CODE AND B.PRODUCT_CODE NOT IN 
--  	(SELECT PRODUCT_CODE FROM #TMPPMTIRR)
	
	--UPDATE SKU SET MRP = B.MRP --,WS_PRICE = B.WS_PRICE 
	--FROM PID01106 B JOIN ARTICLE C ON B.ARTICLE_CODE=C.ARTICLE_CODE 
	--WHERE B.MRR_ID=@CMRRID AND C.CODING_SCHEME<>1 
	--AND SKU.PRODUCT_CODE =B.PRODUCT_CODE AND B.PRODUCT_CODE NOT IN 
	--(SELECT PRODUCT_CODE FROM #TMPPMTIRR) 

	UPDATE  A SET A.MRP = B.MRP ,A.WS_PRICE = B.WHOLESALE_PRICE 
	FROM SKU A
	JOIN PID01106 B ON A.PRODUCT_CODE=B.PRODUCT_CODE
	JOIN ARTICLE C ON B.ARTICLE_CODE=C.ARTICLE_CODE 
	LEFT OUTER JOIN 
	(
		SELECT DISTINCT A.PRODUCT_CODE FROM IRD01106 A
		JOIN PID01106 B ON A.PRODUCT_CODE=B.PRODUCT_CODE
		WHERE B.MRR_ID=@CMRRID 
		AND A.OLD_MRP<>A.NEW_MRP
		AND ISNULL(A.NEW_PRODUCT_CODE,'')=''
	) IRD ON B.PRODUCT_CODE = IRD.PRODUCT_CODE
	WHERE B.MRR_ID=@CMRRID 
	AND   A.BARCODE_CODING_SCHEME<>1 
	AND   IRD.PRODUCT_CODE IS NULL
	
	
	--AND SKU.PRODUCT_CODE =B.PRODUCT_CODE AND B.PRODUCT_CODE NOT IN 
	--(SELECT PRODUCT_CODE FROM #TMPPMTIRR) 

END
