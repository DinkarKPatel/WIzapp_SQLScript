CREATE PROCEDURE SP_SEND_MIRROR_XNSLM_DATA_NEW
(
	@CREQXNID VARCHAR(20)='', 
	@CERRMSG VARCHAR(MAX) OUTPUT  
)
AS
BEGIN
		DECLARE @CCMD NVARCHAR(MAX),@CSTEP VARCHAR(100),@CFILTERCONDITION VARCHAR(200),@CCUTOFFDATE VARCHAR(10),
				@CMEMOID VARCHAR(100),@CTEMPTABLE VARCHAR(100),@CTABLENAME VARCHAR(100),@CTEMPMASTERTABLE VARCHAR(100),
				@BRECFOUND BIT,@CCUST_CODE_STRING VARCHAR(MAX),@DMEMOLASTUPDATE DATETIME
		
		
		DECLARE @TXNSSENDINFO TABLE (ORG_TABLENAME VARCHAR(50),TMP_TABLENAME VARCHAR(50),XN_ID VARCHAR(40))
BEGIN TRY
	
	SET @CSTEP=110
	---- SEND THE LEDGER MASTER TABLE
	SELECT TOP 1  @CREQXNID AS check_ac_code, 'XNSLM_LM01106_UPLOAD' AS TARGET_TABLENAME,LM01106.*  FROM LM01106 WHERE AC_CODE=@CREQXNID

	SET @CSTEP=120
	SELECT TOP 1 @CREQXNID AS check_ac_code,'XNSLM_LMP01106_UPLOAD' AS TARGET_TABLENAME,LMP01106.*  FROM LMP01106 WHERE AC_CODE=@CREQXNID

	SET @CSTEP=130
	SELECT TOP 1 @CREQXNID AS check_ac_code,'XNSLM_AREA_UPLOAD' AS TARGET_TABLENAME,A.* FROM AREA  A JOIN LMP01106 B ON A.AREA_CODE = B.AREA_CODE
	WHERE ac_code=@CREQXNID
	
	SET @CSTEP=160
	SELECT TOP 1 @CREQXNID AS check_ac_code,'XNSLM_CITY_UPLOAD' AS TARGET_TABLENAME,A.* FROM CITY  A JOIN area b ON A.CITY_CODE = B.CITY_CODE
	JOIN LMP01106 c ON c.AREA_CODE = B.AREA_CODE
	WHERE ac_code=@CREQXNID

	SET @CSTEP=190
	SELECT TOP 1 @CREQXNID AS check_ac_code,'XNSLM_STATE_UPLOAD' AS TARGET_TABLENAME,A.*  FROM STATE  A JOIN CITY B ON A.STATE_CODE = B.STATE_CODE
	JOIN area c ON c.CITY_CODE = B.CITY_CODE
	JOIN LMP01106 d ON d.AREA_CODE = c.AREA_CODE
	WHERE ac_code=@CREQXNID

	SET @CSTEP=200
	SELECT TOP 1 @CREQXNID AS check_ac_code,'XNSLM_REGIONM_UPLOAD' AS TARGET_TABLENAME,A.* FROM REGIONM  A JOIN STATE  B	ON A.REGION_CODE = B.REGION_CODE
	JOIN CITY c ON c.STATE_CODE = B.STATE_CODE
	JOIN area d ON d.CITY_CODE = c.CITY_CODE
	JOIN LMP01106 e ON e.AREA_CODE = d.AREA_CODE
	WHERE ac_code=@CREQXNID AND a.region_code<>'0000000'

	

END TRY

BEGIN CATCH
	SET @CERRMSG='P: SP_SEND_MIRROR_XNSLM_DATA, STEP:'+@CSTEP+', MESSAGE:'+ERROR_MESSAGE()
	GOTO END_PROC
END CATCH

END_PROC:

END
--END OF THE PROCEDURE SP_SEND_MIRROR_XNSLM_DATA