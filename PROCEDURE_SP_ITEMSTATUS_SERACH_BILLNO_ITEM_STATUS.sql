CREATE PROCEDURE SP_ITEMSTATUS_SERACH_BILLNO_ITEM_STATUS
( 
  @cLocID varchar(10)='',
  @CFINYEAR VARCHAR(10)='',  
  @BILLNO VARCHAR(50)='' 
   
) 
--WITH ENCRYPTION

AS 
BEGIN
	DECLARE @CCMD NVARCHAR(MAX)  
 
	SELECT DISTINCT TOP 50 A.CM_NO,A.CM_ID
	FROM CMM01106 A (NOLOCK)
	JOIN CMD01106 B (NOLOCK) ON B.CM_ID=A.CM_ID
	LEFT OUTER JOIN HOLD_BACK_DELIVER_DET C (NOLOCK) ON C.REF_CMD_ROW_ID=B.ROW_ID
	LEFT OUTER JOIN HOLD_BACK_DELIVER_MST D (NOLOCK) ON C.MEMO_ID=D.MEMO_ID
	WHERE C.ref_cmd_row_id IS NOT NULL AND (a.location_Code = @cLocid  or @cLocID = '') and A.CANCELLED=0 
	AND ISNULL(D.CANCELLED,0)=0 AND A.FIN_YEAR=@CFINYEAR AND A.CM_NO LIKE @BILLNO
	ORDER BY A.CM_NO
  
 LAST:  
  
END
