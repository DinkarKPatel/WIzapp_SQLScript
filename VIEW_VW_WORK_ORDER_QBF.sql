CREATE VIEW VW_WORK_ORDER_QBF    
  
AS    
-----------CHANGE IF  EXIST----------  
SELECT MST.MEMO_NO AS MST_MEMO_NO,   
MST.MEMO_ID, MST.OVERHEAD_PER AS MST_OVERHEAD_PER,   
MST.MEMO_DT AS MST_MEMO_DT,    
MST.REMARKS AS MST_REMARKS,
B.REMARKS AS DET_REMARKS,   
MST.REF_NO AS MST_REF_NO,    
MST.FIN_YEAR AS MST_FIN_YEAR,  
AR1.ARTICLE_NO AS MST_ARTICLE_SET_NAME,    
AR1.ARTICLE_NO,   
AR2.ARTICLE_NO AS COMP_ARTICLE_NO,  
PARA1.PARA1_NAME AS FG_PARA1_NAME,  
PARA2.PARA2_NAME AS FG_PARA2_NAME,     
AR1.REMARKS,  
DET.QUANTITY AS ORD_QTY,  
AVG_QTY AS AVG_QTY,    
UOM.UOM_NAME,  
AR.ARTICLE_NO AS RM_ARTICLE_NO,  
AR.ARTICLE_NAME  AS RM_ARTICLE_NAME,  
P1.PARA1_NAME AS RM_PARA1_NAME,    
P2.PARA2_NAME AS RM_PARA2_NAME,  
SD.SUB_SECTION_NAME,  
SM.SECTION_NAME,  
COM.COMPANY_NAME AS COMPANYNAME,  
COM.ADDRESS1 AS COMP_ADDRESS1,  
COM.ADDRESS2 AS COMP_ADDRESS2,  
COM.CITY AS COMP_CITY,COM.PHONES_FAX AS COM_PHONES_FAX,  
COM.TIN_NO AS COM_TIN_NO,  
ISNULL(E.EMP_TITLE,'') + ' ' + ISNULL(E.EMP_FNAME,'') + ' ' + ISNULL(E.EMP_LNAME,'')  AS MST_EMP_NAME    
FROM PRD_WO_ART_BOM A (NOLOCK)        
JOIN PRD_WO_DET B (NOLOCK) ON A.REF_ROW_ID = B.ROW_ID  
JOIN PRD_WO_MST MST (NOLOCK) ON B.MEMO_ID=MST.MEMO_ID  
JOIN ARTICLE AR (NOLOCK) ON AR.ARTICLE_CODE =A.BOM_ARTICLE_CODE  
JOIN ARTICLE AR1 (NOLOCK) ON AR1.ARTICLE_CODE =MST.ARTICLE_SET_CODE   
JOIN ARTICLE AR2 (NOLOCK) ON AR2.ARTICLE_CODE =B.ARTICLE_CODE      
JOIN PARA1 P1 (NOLOCK) ON A.PARA1_CODE=P1.PARA1_CODE  
JOIN PARA2 P2 (NOLOCK) ON A.PARA2_CODE=P2.PARA2_CODE  
JOIN  
(  
  SELECT PARA1_CODE,PARA2_CODE,REF_ROW_ID,SUM(QUANTITY) AS QUANTITY   
  FROM PRD_WO_SUB_DET C  
   GROUP BY REF_ROW_ID,PARA1_CODE,PARA2_CODE  
) DET ON B.ROW_ID=DET.REF_ROW_ID  
JOIN ARTICLE C (NOLOCK) ON A.BOM_ARTICLE_CODE = C.ARTICLE_CODE   
JOIN UOM ON UOM.UOM_CODE=C.UOM_CODE  
JOIN  
(  
SELECT  REF_ROW_ID,SUM(QUANTITY) AS QUANTITY   
FROM PRD_WO_SUB_DET C  
GROUP BY REF_ROW_ID  
) DET1 ON B.ROW_ID=DET1.REF_ROW_ID  
JOIN ARTICLE T7 ON T7.ARTICLE_CODE = B.ARTICLE_CODE   
JOIN PARA1  (NOLOCK) ON DET.PARA1_CODE=PARA1.PARA1_CODE  
JOIN PARA2  (NOLOCK) ON DET.PARA2_CODE=PARA2.PARA2_CODE  
JOIN SECTIOND  SD (NOLOCK) ON SD.SUB_SECTION_CODE= T7.SUB_SECTION_CODE     
JOIN SECTIONM  SM (NOLOCK) ON SM.SECTION_CODE= SD.SECTION_CODE      
LEFT OUTER JOIN EMP_MST E ON MST.EMP_CODE= E.EMP_ID    
LEFT OUTER JOIN COMPANY COM ON 1=1 AND COM.COMPANY_CODE='01'
