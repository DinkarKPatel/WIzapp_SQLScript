CREATE PROCEDURE SPACT_GETENTRYLEDGERS
(
	 @CVOUCHERCODE  CHAR(10)
	,@CXNTYPE		VARCHAR(5)
)
--WITH ENCRYPTION 
AS
BEGIN
	DECLARE @THEADLIST TABLE(HEAD_CODE VARCHAR(10))
	DECLARE @CCHILDHEADCODES VARCHAR(MAX),@CCMD NVARCHAR(MAX)

IF @CVOUCHERCODE='0000000007' --SALES
	GOTO GETSALESAC
IF @CVOUCHERCODE='0000000006' --PURCHASE
	GOTO GETPURCHASEAC	
IF @CVOUCHERCODE='0000000002' --PAYMENT
	GOTO GETPAYMENTAC
IF @CVOUCHERCODE='0000000003' --RECEIPT
	GOTO GETRECEIPTAC	
IF @CVOUCHERCODE='0000000001' --JOURNAL
	GOTO GETJOURNALAC		
IF @CVOUCHERCODE='0000000008' --CONTRA
	GOTO GETCONTRAAC
IF @CVOUCHERCODE='0000000005' --DEBITNOTE
	GOTO GETDEBITNOTEAC
IF @CVOUCHERCODE='0000000004' --CREDITNOTE
	GOTO GETCREDITNOTEAC					
ELSE 
	GOTO ENDPROC

GETSALESAC:

	IF @CXNTYPE='DR'
	BEGIN
		SET @CCHILDHEADCODES=(SELECT DBO.FN_ACT_TRAVTREE('0000000013'))
							+','+(SELECT DBO.FN_ACT_TRAVTREE('0000000014'))
							+','+(SELECT DBO.FN_ACT_TRAVTREE('0000000018'))
							+','+(SELECT DBO.FN_ACT_TRAVTREE('0000000021'))
							+','+(SELECT DBO.FN_ACT_TRAVTREE('0000000022'))
	
		
		SET @CCMD=N'SELECT AC_CODE,AC_NAME FROM LMV01106 WHERE HEAD_CODE IN ('+@CCHILDHEADCODES+') 
					AND AC_CODE<>''0000000000'''
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD
	END
	ELSE IF @CXNTYPE='CR' 
	BEGIN
		SET @CCHILDHEADCODES=(SELECT DBO.FN_ACT_TRAVTREE('0000000030'))+','+(SELECT DBO.FN_ACT_TRAVTREE('0000000019'))
		
		SET @CCMD=N'SELECT AC_CODE,AC_NAME FROM LMV01106 WHERE HEAD_CODE IN ('+@CCHILDHEADCODES+')
					AND AC_CODE<>''0000000000'''
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD	
	END
	ELSE 
		GOTO ENDPROC
GOTO ENDPROC

GETPURCHASEAC:

	IF @CXNTYPE='CR'
	BEGIN
		SET @CCHILDHEADCODES=(SELECT DBO.FN_ACT_TRAVTREE('0000000013'))
							+','+(SELECT DBO.FN_ACT_TRAVTREE('0000000014'))
							+','+(SELECT DBO.FN_ACT_TRAVTREE('0000000018'))
							+','+(SELECT DBO.FN_ACT_TRAVTREE('0000000021'))
							+','+(SELECT DBO.FN_ACT_TRAVTREE('0000000022'))
	
		
		SET @CCMD=N'SELECT AC_CODE,AC_NAME FROM LMV01106 WHERE HEAD_CODE IN ('+@CCHILDHEADCODES+') 
					AND AC_CODE<>''0000000000'''
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD
	END
	ELSE IF @CXNTYPE='DR' 
	BEGIN
		SET @CCHILDHEADCODES=(SELECT DBO.FN_ACT_TRAVTREE('0000000029'))+','+(SELECT DBO.FN_ACT_TRAVTREE('0000000019'))
		
		SET @CCMD=N'SELECT AC_CODE,AC_NAME FROM LMV01106 WHERE HEAD_CODE IN ('+@CCHILDHEADCODES+')
					AND AC_CODE<>''0000000000'''
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD	
	END
	ELSE 
		GOTO ENDPROC
GOTO ENDPROC	

GETPAYMENTAC:
	IF @CXNTYPE='DR'
	BEGIN
		SET @CCHILDHEADCODES=(SELECT DBO.FN_ACT_TRAVTREE('0000000014'))
							+','+(SELECT DBO.FN_ACT_TRAVTREE('0000000013'))
		
		SET @CCMD=N'SELECT AC_CODE,AC_NAME FROM LMV01106 WHERE HEAD_CODE NOT IN ('+@CCHILDHEADCODES+') 
					AND AC_CODE<>''0000000000'''
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD
	END
	ELSE IF @CXNTYPE='CR' 
	BEGIN
		SET @CCMD=N'SELECT AC_CODE,AC_NAME FROM LMV01106 WHERE AC_CODE<>''0000000000'''
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD	
	END
	ELSE 
		GOTO ENDPROC
GOTO ENDPROC

GETRECEIPTAC:
	IF @CXNTYPE='CR'
	BEGIN
		SET @CCHILDHEADCODES=(SELECT DBO.FN_ACT_TRAVTREE('0000000014'))
							+','+(SELECT DBO.FN_ACT_TRAVTREE('0000000013'))
		
		SET @CCMD=N'SELECT AC_CODE,AC_NAME FROM LMV01106 WHERE HEAD_CODE NOT IN ('+@CCHILDHEADCODES+') 
					AND AC_CODE<>''0000000000'''
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD
	END
	ELSE IF @CXNTYPE='DR' 
	BEGIN
		SET @CCMD=N'SELECT AC_CODE,AC_NAME FROM LMV01106 WHERE AC_CODE<>''0000000000'''
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD	
	END
	ELSE 
		GOTO ENDPROC
GOTO ENDPROC
	
GETJOURNALAC:
	IF @CXNTYPE='CR'
	BEGIN
		SET @CCMD=N'SELECT AC_CODE,AC_NAME FROM LMV01106 WHERE AC_CODE<>''0000000000'''
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD
	END
	ELSE IF @CXNTYPE='DR' 
	BEGIN
		SET @CCMD=N'SELECT AC_CODE,AC_NAME FROM LMV01106 WHERE AC_CODE<>''0000000000'''
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD	
	END
	ELSE 
		GOTO ENDPROC
GOTO ENDPROC	

GETCONTRAAC:
	IF @CXNTYPE='CR'
	BEGIN
		SET @CCMD=N'SELECT AC_CODE,AC_NAME FROM LMV01106 WHERE AC_CODE<>''0000000000'''
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD
	END
	ELSE IF @CXNTYPE='DR' 
	BEGIN
		SET @CCMD=N'SELECT AC_CODE,AC_NAME FROM LMV01106 WHERE AC_CODE<>''0000000000'''
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD	
	END
	ELSE 
		GOTO ENDPROC
GOTO ENDPROC	

GETDEBITNOTEAC:
	IF @CXNTYPE='DR'
	BEGIN
		SET @CCHILDHEADCODES=(SELECT DBO.FN_ACT_TRAVTREE('0000000014'))
							+','+(SELECT DBO.FN_ACT_TRAVTREE('0000000013'))
		
		SET @CCMD=N'SELECT AC_CODE,AC_NAME FROM LMV01106 WHERE HEAD_CODE NOT IN ('+@CCHILDHEADCODES+') 
					AND AC_CODE<>''0000000000'''
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD
	END
	ELSE IF @CXNTYPE='CR' 
	BEGIN
		SET @CCMD=N'SELECT AC_CODE,AC_NAME FROM LMV01106 WHERE AC_CODE<>''0000000000'''
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD	
	END
	ELSE 
		GOTO ENDPROC
GOTO ENDPROC

GETCREDITNOTEAC:
	IF @CXNTYPE='CR'
	BEGIN
		SET @CCHILDHEADCODES=(SELECT DBO.FN_ACT_TRAVTREE('0000000014'))
							+','+(SELECT DBO.FN_ACT_TRAVTREE('0000000013'))
		
		SET @CCMD=N'SELECT AC_CODE,AC_NAME FROM LMV01106 WHERE HEAD_CODE NOT IN ('+@CCHILDHEADCODES+') 
					AND AC_CODE<>''0000000000'''
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD
	END
	ELSE IF @CXNTYPE='DR' 
	BEGIN
		SET @CCMD=N'SELECT AC_CODE,AC_NAME FROM LMV01106 WHERE AC_CODE<>''0000000000'''
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD	
	END
	ELSE 
		GOTO ENDPROC
GOTO ENDPROC

ENDPROC:
END
--END OF PROCEDURE - SPACT_GETENTRYLEDGERS
