CREATE PROCEDURE SP3S_BYPLAN_LIST
(

	@BUYPLANCODE		VARCHAR(100)= '' ,
	@BUDGETPLANCODE		VARCHAR(100)='',
	@SEASONCODE			VARCHAR(100)= '',
	@CANCELLED			INT=0,
	@APPROVED			INT=0,
	@FM_EXPIRY_DT		DATETIME= '',
	@TO_EXPIRY_DT		DATETIME= '',
	@FM_BYPL_DT			DATETIME= '',
	@TO_BYPL_DT			DATETIME= ''
)
AS
BEGIN
	SELECT  A1.BUDGET_PLAN_MEMO_NO,A1.MEMO_NO,A1.MEMO_DT,A1.CANCELLED,A1.BUY_PLAN_NAME,EXPIRY_DT,H.SEASON_NAME
	FROM BUDGET_PLAN_MST A 
	JOIN BUY_PLAN_MST A1   ON A1.BUDGET_PLAN_MEMO_NO=A.MEMO_NO  
	JOIN SEASON_MST			H	ON H.SEASON_ID=A.SEASON_ID
	WHERE  (@CANCELLED=2 OR A1.CANCELLED=@CANCELLED)
	AND (@BUDGETPLANCODE='' OR A.BUDGET_PLAN_NAME=@BUDGETPLANCODE)
	AND (@BUYPLANCODE='' OR A1.BUY_PLAN_NAME=@BUDGETPLANCODE)
	AND (@SEASONCODE='' OR A.SEASON_ID=@SEASONCODE)
	AND (A.EXPIRY_DT>= @FM_EXPIRY_DT AND A.EXPIRY_DT<=@TO_EXPIRY_DT)
	AND (A1.MEMO_DT>= @FM_BYPL_DT AND A.EXPIRY_DT<=@TO_BYPL_DT)
END
