create VIEW VW_SEARCH_BOM_ISSUE
AS
/*
SELECT A.issue_no AS MEMO_NO
,A.issue_id AS MEMO_ID
,A.issue_dt AS MEMO_DT
,A.CANCELLED
,A.EWAY_BILL_NO
,A.ref_no
,(CASE WHEN A.CANCELLED=1 THEN 'Yes' ELSE 'No' END) AS CANCELLED_STR
,A.issue_type
,(CASE WHEN A.issue_type=1 THEN 'Return' ELSE 'Issue' END) AS issue_type_STR
,A.AGENCY_CODE
,B.agency_name
,A.JOBWORK_ISSUE_ID
,X.issue_no
from BOM_ISSUE_MST A (NOLOCK)
JOIN prd_agency_mst B (NOLOCK) ON B.AGENCY_CODE=A.AGENCY_CODE
LEFT OUTER JOIN jobwork_issue_mst X (NOLOCK) ON X.issue_id=A.JOBWORK_ISSUE_ID
*/
SELECT DISTINCT A.issue_no AS MEMO_NO
,A.issue_id AS MEMO_ID
,A.issue_dt AS MEMO_DT
,A.CANCELLED
,A.EWAY_BILL_NO
,A.ref_no
,(CASE WHEN A.CANCELLED=1 THEN 'Yes' ELSE 'No' END) AS CANCELLED_STR
,A.issue_type
,(CASE WHEN A.issue_type=1 THEN 'Return' ELSE 'Issue' END) AS issue_type_STR
,A.AGENCY_CODE
,B.agency_name
,A.JOBWORK_ISSUE_ID
,X.issue_no
,OPM.MEMO_ID JOBCARD_ID,OPM.MEMO_NO JOBCARD_NO
FROM BOM_ISSUE_MST A (NOLOCK)
LEFT JOIN BOM_ISSUE_REF  AD (NOLOCK) ON A.issue_id=AD.bom_issue_id
LEFT JOIN ORD_PLAN_BOM_DET OPBD (NOLOCK) ON AD.ORD_PLAN_BOM_DET_ROW_ID=OPBD.ROW_ID
LEFT JOIN ORD_PLAN_MST OPM (NOLOCK) ON OPM.MEMO_ID=OPBD.MEMO_ID
JOIN prd_agency_mst B (NOLOCK) ON B.AGENCY_CODE=A.AGENCY_CODE
LEFT OUTER JOIN jobwork_issue_mst X (NOLOCK) ON X.issue_id=A.JOBWORK_ISSUE_ID
