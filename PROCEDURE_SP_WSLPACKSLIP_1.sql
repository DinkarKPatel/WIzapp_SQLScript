CREATE PROCEDURE SP_WSLPACKSLIP_1--(LocId 3 digit change only increased the parameter width by Sanjay:04-11-2024)
 @CMEMOID VARCHAR(40) = '',  
 @CWHERE  VARCHAR(500) = '',
 @NNAVMODE NUMERIC(1,0) = 0,  
 @CFINYEAR VARCHAR(5)='',
 @CLOCID varchar(4)=''
--WITH ENCRYPTION

AS  
BEgIn
	--DECLARE  @CMEMOID VARCHAR(40) = 'WE01124000WE-1476'
	DECLARE @TEMP_WSLPACKSLIP_1 TABLE(PS_ID VARCHAR(50),INV_NO VARCHAR(50))
	INSERT INTO @TEMP_WSLPACKSLIP_1(PS_ID,INV_NO)
	SELECT A.PS_ID,B.INV_NO 
	FROM IND01106 A (NOLOCK)
	JOIN INM01106 B (NOLOCK) ON A.INV_ID = B.INV_ID 
	jOin wps_mst c (NolOCK) oN c.ps_id=a.ps_id ---Join with wps_mst taken which was missing (Sanjay)
	WHERE c.ps_id=@CMEMOID AnD B.CANCELLED=0
	GROUP BY A.PS_ID,B.INV_NO 

	SELECT T1.*,T2.USERNAME,T5.AC_NAME,T4.ADDRESS0,T4.ADDRESS1,T4.ADDRESS2,     
	lm_area.AREA_NAME,lm_city.CITY,lm_state.[STATE],lm_area.PINCODE,ISNULL(T6.DEPT_NAME,'') AS DEPT_NAME ,T6.DEPT_ID   
	,ISNULL(T7.PS_ID,'') AS REF_PS_ID ,ISNULL(T7.INV_NO,'') AS REF_INV_NO,BIN.BIN_NAME,
	 AG.ANGADIA_NAME,AG.INSURANCE_PERCENTAGE ,
    T4.CREDIT_DAYS,T4.DISCOUNT_PERCENTAGE AS LM_DISC_PER,T4.TIN_NO  
    , LMB.AC_NAME AS BROKER_AC_NAME,CAST('' AS VARCHAR(50)) AS SP_ID
	FROM WPS_MST T1 (nOlOck)
	JOIN LM01106 T5 (nOlOck) ON T5.AC_CODE = T1.AC_CODE     
	JOIN USERS T2  (nOlOck)  ON T1.USER_CODE = T2.USER_CODE    
	left JOIN LMP01106 T4 (nOlOck) ON T4.AC_CODE = T5.AC_CODE    
	LEFT OUTER join area lm_area (nolock) on lm_area.area_code=t4.area_code
	LEFT OUTER  join city lm_city (nolock) on lm_city.city_code=lm_area.city_code
	LEFT OUTER  join state lm_sTAte (nolock) on lm_sTAte.StaTE_code=lm_cItY.State_code
	LEFT OUTER JOIN BIN (NOLOCK) ON BIN.BIN_ID=T1.TARGET_BIN_ID      
	LEFT OUTER JOIN LOCATION T6 (NOLOCK) ON T6.DEPT_ID = T1.PARTY_DEPT_ID    
	LEFT OUTER JOIN   @TEMP_WSLPACKSLIP_1 T7 ON T1.PS_ID = T7.PS_ID  
	--LEFT JOIN AREA AR ON T1.SHIPPING_AREA_CODE=AR.AREA_CODE
 --   LEFT JOIN CITY CT ON CT.CITY_CODE=AR.CITY_CODE
 --   LEFT JOIN STATE ST ON CT.STATE_CODE=ST.STATE_CODE
    LEFT JOIN ANGM AG (nolock) ON AG.ANGADIA_CODE=T1.ANGADIA_CODE  
    LEFT OUTER JOIN LM01106 LMB (nolock) ON  T1.BROKER_AC_CODE= LMB.AC_CODE   
	WHERE T1.PS_ID = @CMEMOID   
EnD