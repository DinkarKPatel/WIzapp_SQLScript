IF EXISTS (SELECT TOP 1 'U' FROM LEDGER_TERMS WHERE ISNULL(TERMS_CODE,'')='') 
BEGIN
DECLARE @CHO_DEPT_ID VARCHAR(2),@CCUR_LOCID VARCHAR(2)
SELECT @CHO_DEPT_ID=VALUE  FROM CONFIG WHERE  CONFIG_OPTION ='HO_LOCATION_ID'
SELECT @CCUR_LOCID=VALUE  FROM CONFIG WHERE  CONFIG_OPTION ='LOCATION_ID'
IF @CHO_DEPT_ID=@CCUR_LOCID
BEGIN
UPDATE A SET TERMS_CODE=B.TERMS_CODE
FROM LEDGER_TERMS A
JOIN 
(
 SELECT TERMS, TERMS_CODE= CASE WHEN ROW_NUMBER () OVER (ORDER BY TERMS) <10 THEN  
        @CHO_DEPT_ID+'00'+CAST(ROW_NUMBER () OVER (ORDER BY TERMS) AS VARCHAR(100)) 
        WHEN ROW_NUMBER () OVER (ORDER BY TERMS) <100 THEN  
        @CHO_DEPT_ID+'0'+CAST(ROW_NUMBER () OVER (ORDER BY TERMS) AS VARCHAR(100)) 
        ELSE
        @CHO_DEPT_ID+CAST(ROW_NUMBER () OVER (ORDER BY TERMS) AS VARCHAR(100))
 END 
 FROM  LEDGER_TERMS A WHERE ISNULL(A.TERMS_CODE,'')=''
 ) B ON A.TERMS=B.TERMS
 
 UPDATE A SET TERMS_CODE=B.TERMS_CODE
 FROM LM_TERMS A
 JOIN  LEDGER_TERMS B ON A.TERMS=B.TERMS 
 WHERE ISNULL(A.TERMS_CODE,'')=''
 
 

 
 INSERT KEYS	( COLUMNNAME, PREFIX, FINYEAR, TABLENAME, LASTKEYVAL )  
 SELECT    COLUMNNAME='TERMS_CODE', PREFIX=@CHO_DEPT_ID, FINYEAR='', TABLENAME='LEDGER_TERMS', 
 LASTKEYVAL=CASE WHEN COUNT(*) <10 THEN  
        @CHO_DEPT_ID+'00'+CAST(COUNT(*) AS VARCHAR(100)) ELSE
        @CHO_DEPT_ID+'0'+CAST(COUNT(*) AS VARCHAR(100)) END
 FROM 
 LEDGER_TERMS A


END
END
