CREATE PROCEDURE SP3S_XTREME_REPORTING_EXP_GSTREPS
AS
BEGIN


	truncate table XTREME_REPORTING_EXP_GSTREPS

	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '1' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,
			PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,
			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,
			A.BIN_NAME ,VENDOR_BILL_DATE,
			XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,
         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,
		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
    FROM 
    (
   
    SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,
           D.CUSTOMER_FNAME +'' ''+D.CUSTOMER_LNAME  AS RECEIVER_NAME,
           ISNULL(A.Party_Gst_No,'''') AS RECEIVER_GSTN_ID,
           ISNULL(A.PARTY_STATE_CODE  ,'''') AS RECEIVER_STATE_CODE,
           CAST(''RETAIL SALE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''RETAIL SALE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,
           CAST(A.CM_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.CM_DT AS SENDER_INVOICE_DATE,
           A.OTHER_CHARGES_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE ,0) AS TAXABLE_VALUE,
           ISNULL(A.OTHER_CHARGES_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.CM_ID,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.OTHER_CHARGES_CGST_AMOUNT AS CGST_AMOUNT,
           CAST( A.OTHER_CHARGES_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.OTHER_CHARGES_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)+ ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)+ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST,
           CAST(''OTHER_CHARGES'' AS VARCHAR(100)) AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID, BIN.BIN_NAME,
           CAST(isnull(nullif( replace(Party_Gst_No,Party_Gst_No,''Registered''),''''),''Unregistered'') AS VARCHAR(50)) AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
		   isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(25,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT,
		   B.dept_alias     ,
		   CAST('''' AS VARCHAR(100)) AS Receiver_Alias ,
		   B.DEPT_ALIAS AS SENDER_ALIAS        
    FROM CMM01106 A (NOLOCK)
    JOIN LOCATION B (NOLOCK) ON LEFT(A.CM_ID,2)=B.DEPT_ID 
    JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE     
    JOIN CUSTDYM D (NOLOCK) ON A.CUSTOMER_CODE =D.CUSTOMER_CODE   
	LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
	LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
    WHERE A.CANCELLED =0 AND ATD_CHARGES<>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
    AND ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)<>0 AND A.CM_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR



	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '2' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,
			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,
    A.BIN_NAME ,
    VENDOR_BILL_DATE,
    XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,
         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,
		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
    FROM 
    (
   
    SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,
           D.CUSTOMER_FNAME +'' ''+D.CUSTOMER_LNAME  AS RECEIVER_NAME,
           ISNULL(A.Party_Gst_No,'''') AS RECEIVER_GSTN_ID,
           ISNULL(A.PARTY_STATE_CODE  ,'''') AS RECEIVER_STATE_CODE,
           ''RETAIL SALE'' AS SUB_TRANSACTION_TYPE,
           ''RETAIL SALE'' AS TRANSACTION_TYPE,
           CAST(A.CM_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.CM_DT AS SENDER_INVOICE_DATE,
           CMD.HSN_CODE  AS HSN_CODE ,
           CMD.QUANTITY  AS QUANTITY,
           CMD.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(CMD.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           LEFT(A.CM_ID,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           CMD.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CMD.SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           CMD.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST(REF_SLS_MEMO_NO  AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST(REF_SLS_MEMO_DT AS DATETIME) AS REFERENCE_DATE,
           ISNULL(CMD.XN_VALUE_WITH_GST,0)   AS TRANSACTION_VALUE_INCLUDING_GST,
           '''' AS OH_TYPE,
           CMD.PRODUCT_CODE,
           A.NET_AMOUNT AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           CMD.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           CAST(isnull(nullif( replace(Party_Gst_No,Party_Gst_No,''Registered''),''''),''Unregistered'') AS VARCHAR(50)) AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(CMD.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE ,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
           CAST(ROUND((ISNULL(CMD.CMM_DISCOUNT_AMOUNT,0)+ISNULL(CMD.DISCOUNT_AMOUNT,0))/NULLIF((CMD.MRP*CMD.QUANTITY),0)*100,2)  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(ISNULL(CMD.DISCOUNT_AMOUNT ,0)+ISNULL(CMD.CMM_DISCOUNT_AMOUNT ,0) AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(CMD.XN_VALUE_WITHOUT_GST -(SKU.PURCHASE_PRICE*CMD.QUANTITY) AS NUMERIC(14,2)) AS PROFIT_AMOUNT,
           CMD.CESS_AMOUNT AS CESS_AMOUNT,
		   B.dept_alias,
		   CAST('''' AS VARCHAR(100)) AS Receiver_Alias,
		   B.DEPT_ALIAS AS SENDER_ALIAS 
    FROM CMM01106 A (NOLOCK)
    JOIN CMD01106 CMD (NOLOCK) ON A.CM_ID=CMD.CM_ID 
    JOIN LOCATION B (NOLOCK) ON LEFT(A.CM_ID,2)=B.DEPT_ID 
	LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
    JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE 
    JOIN CUSTDYM D (NOLOCK) ON A.CUSTOMER_CODE =D.CUSTOMER_CODE 
    JOIN SKU (NOLOCK) ON SKU.product_code =CMD.PRODUCT_CODE 
	LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
    WHERE A.CANCELLED =0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
    AND ISNULL(CMD.Quantity,0)>0 AND A.CM_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR


	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '3' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,
			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,
    A.BIN_NAME ,
    VENDOR_BILL_DATE,
    XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,
         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,
		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
    FROM 
    (
   
    SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,
           D.CUSTOMER_FNAME +'' ''+D.CUSTOMER_LNAME  AS RECEIVER_NAME,
           ISNULL(A.Party_Gst_No,'''') AS RECEIVER_GSTN_ID,
           ISNULL(A.PARTY_STATE_CODE  ,'''') AS RECEIVER_STATE_CODE,
           ''RETAIL SALE RETURN'' AS SUB_TRANSACTION_TYPE,
           ''RETAIL SALE'' AS TRANSACTION_TYPE,
           CAST(A.CM_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.CM_DT AS SENDER_INVOICE_DATE,
           CMD.HSN_CODE  AS HSN_CODE ,
           CMD.QUANTITY  AS QUANTITY,
           CMD.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(CMD.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           LEFT(A.CM_ID,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           CMD.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CMD.SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           CMD.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST(REF_SLS_MEMO_NO  AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST(REF_SLS_MEMO_DT AS DATETIME) AS REFERENCE_DATE,
           ISNULL(CMD.XN_VALUE_WITH_GST,0)   AS TRANSACTION_VALUE_INCLUDING_GST,
           '''' AS OH_TYPE,
           CMD.PRODUCT_CODE,
           A.NET_AMOUNT AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           CMD.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           CAST(isnull(nullif( replace(Party_Gst_No,Party_Gst_No,''Registered''),''''),''Unregistered'') AS VARCHAR(50)) AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(CMD.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE ,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
           
           CAST(ROUND((ISNULL(CMD.CMM_DISCOUNT_AMOUNT,0)+ISNULL(CMD.DISCOUNT_AMOUNT,0))/NULLIF((CMD.MRP*CMD.QUANTITY),0)*100,2)  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           
           CAST(ISNULL(CMD.DISCOUNT_AMOUNT ,0)+ISNULL(CMD.CMM_DISCOUNT_AMOUNT ,0) AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           
           CAST(CMD.XN_VALUE_WITHOUT_GST -(SKU.PURCHASE_PRICE*CMD.QUANTITY) AS NUMERIC(14,2)) AS PROFIT_AMOUNT,
           CMD.CESS_AMOUNT AS CESS_AMOUNT,
		   B.dept_alias,
		   CAST('''' AS VARCHAR(100)) AS Receiver_Alias,
		   B.DEPT_ALIAS AS SENDER_ALIAS 
    FROM CMM01106 A (NOLOCK)
    JOIN CMD01106 CMD (NOLOCK) ON A.CM_ID=CMD.CM_ID 
    JOIN LOCATION B (NOLOCK) ON LEFT(A.CM_ID,2)=B.DEPT_ID 
	LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
    JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE 
    JOIN CUSTDYM D (NOLOCK) ON A.CUSTOMER_CODE =D.CUSTOMER_CODE 
    JOIN SKU (NOLOCK) ON SKU.product_code =CMD.PRODUCT_CODE 
	LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
    WHERE A.CANCELLED =0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
    AND ISNULL(CMD.Quantity,0)<0 AND A.CM_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR

    Print 'Wholesale Invoice'

	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '4' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,
			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,
            A.BIN_NAME ,VENDOR_BILL_DATE,
          A.XN_ITEM_TYPE AS XN_ITEM_TYPE,

         DISCOUNT_PERCENTAGE AS DISC_PCT,
         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,
		 Receiver_Alias,
		 SENDER_ALIAS
		 
         
    FROM 
    (
     SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,
           CAST(LM.AC_NAME AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(LMP.AC_GST_NO AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(ISNULL(A.PARTY_STATE_CODE  ,'''')  AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(''PARTY INVOICE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''PARTY INVOICE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,
           CAST(A.INV_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.INV_DT AS SENDER_INVOICE_DATE,
           A.OTHER_CHARGES_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.OTHER_CHARGES_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.INV_ID,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.OTHER_CHARGES_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.OTHER_CHARGES_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.OTHER_CHARGES_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)+ ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)+ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST,
           CAST(''OTHER_CHARGES'' AS VARCHAR(100)) AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,         
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT, 
		   b.dept_alias,
		   LM.ALIAS AS Receiver_Alias,
		   B.DEPT_ALIAS AS SENDER_ALIAS 
      FROM INM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.INV_ID,2)
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(lmp.registered_gst_dealer,0)
      WHERE A.CANCELLED =0 AND A.OTHER_CHARGES>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)>0 and inv_mode=1
     AND A.INV_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR




	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '5' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,
			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,
    A.BIN_NAME ,
    VENDOR_BILL_DATE,
    A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,
         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,
		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
      SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,

           CAST(LM.AC_NAME AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(LMP.AC_GST_NO AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(ISNULL(A.PARTY_STATE_CODE  ,'''')  AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(''PARTY INVOICE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''PARTY INVOICE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,

           CAST(A.INV_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.INV_DT AS SENDER_INVOICE_DATE,
           A.FREIGHT_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0) AS TAXABLE_VALUE,
           ISNULL(A.FREIGHT_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.INV_ID,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.FREIGHT_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.FREIGHT_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.FREIGHT_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)+ ISNULL(FREIGHT_IGST_AMOUNT ,0)+ISNULL(FREIGHT_CGST_AMOUNT,0)+ISNULL(FREIGHT_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           CAST(''FREIGHT'' AS VARCHAR(100)) AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE ,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT, 
		   B.dept_alias,
		   LM.ALIAS AS Receiver_Alias,
		   B.DEPT_ALIAS AS SENDER_ALIAS 
      FROM INM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.INV_ID,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE 
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  LEFT JOIN GST_REGISTERED GR (NOLOCK) ON GR.REGISTERED_GST=ISNULL(LMP.REGISTERED_GST_DEALER,0)
      WHERE A.CANCELLED =0 AND A.FREIGHT>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.FREIGHT_TAXABLE_VALUE,0)>0 and inv_mode=1
     AND A.INV_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR



	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '6' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,
    A.BIN_NAME ,
    VENDOR_BILL_DATE,
    XN_ITEM_TYPE AS XN_ITEM_TYPE,

          DISCOUNT_PERCENTAGE AS DISC_PCT,
         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
         
    FROM 
    (
           SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,

           CAST(LM.AC_NAME AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(LMP.AC_GST_NO AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(ISNULL(A.PARTY_STATE_CODE  ,'''') AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(''PARTY INVOICE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''PARTY INVOICE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,

           CAST(A.INV_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.INV_DT AS SENDER_INVOICE_DATE,
           A.INSURANCE_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.INSURANCE_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.INSURANCE_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.INV_ID,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.INSURANCE_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.INSURANCE_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.INSURANCE_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.INSURANCE_TAXABLE_VALUE,0)+ ISNULL(INSURANCE_IGST_AMOUNT ,0)+ISNULL(INSURANCE_CGST_AMOUNT,0)+ISNULL(INSURANCE_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST ,
           ''INSURANCE'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE ,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME ,
           REGISTERED_GST_NAMES PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE ,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,           
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT, B.dept_alias,
		   LM.ALIAS  AS Receiver_Alias,
		   B.DEPT_ALIAS AS SENDER_ALIAS 
      FROM INM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.INV_ID,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE 
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  LEFT JOIN GST_REGISTERED GR (NOLOCK) ON GR.REGISTERED_GST=ISNULL(LMP.REGISTERED_GST_DEALER,0)
      WHERE A.CANCELLED =0 AND A.INSURANCE>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.INSURANCE_TAXABLE_VALUE,0)>0 and a.inv_mode=1
      AND A.INV_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR



	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '7' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_Name  AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,


    A.BIN_NAME ,
    VENDOR_BILL_DATE,
    A.XN_ITEM_TYPE AS XN_ITEM_TYPE,

         DISCOUNT_PERCENTAGE AS DISC_PCT,
         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
         
    FROM 
    (
          
      SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,

           CAST(LM.AC_NAME AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(LMP.AC_GST_NO AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(ISNULL(A.PARTY_STATE_CODE  ,'''')  AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(''PARTY INVOICE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''PARTY INVOICE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,

           CAST(A.INV_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.INV_DT AS SENDER_INVOICE_DATE,
           A.PACKING_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.PACKING_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.PACKING_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.INV_ID,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.PACKING_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.PACKING_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.PACKING_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.PACKING_TAXABLE_VALUE,0)+ ISNULL(PACKING_IGST_AMOUNT ,0)+ISNULL(PACKING_CGST_AMOUNT,0)+ISNULL(PACKING_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           ''PACKING'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE ,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           REGISTERED_GST_NAMES PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,          
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT,B.dept_alias,
		   LM.ALIAS AS Receiver_Alias,
		   B.DEPT_ALIAS AS SENDER_ALIAS 
      FROM INM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.INV_ID,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  LEFT JOIN GST_REGISTERED GR (NOLOCK) ON GR.REGISTERED_GST=ISNULL(LMP.REGISTERED_GST_DEALER,0)
      WHERE A.CANCELLED =0 AND A.PACKING>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.PACKING_TAXABLE_VALUE,0)>0 and a.inv_mode=1
      AND A.INV_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR


	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '8' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,

    A.BIN_NAME ,
    VENDOR_BILL_DATE,
    XN_ITEM_TYPE AS XN_ITEM_TYPE,

         DISCOUNT_PERCENTAGE AS DISC_PCT,
         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,
		 Receiver_Alias,
		 SENDER_ALIAS
         
    FROM 
    (
       
           SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,

           CAST(LM.AC_NAME AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(LMP.AC_GST_NO AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(ISNULL(A.PARTY_STATE_CODE  ,'''') AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(''PARTY INVOICE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''PARTY INVOICE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,

           CAST(A.INV_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.INV_DT AS SENDER_INVOICE_DATE,
           IND.HSN_CODE  AS HSN_CODE ,
           IND.QUANTITY  AS QUANTITY,
           XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(IND.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           LEFT(A.INV_ID,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           IND.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(IND.SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           IND.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           IND.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
           CAST('''' AS VARCHAR(5)) AS OH_TYPE,
           IND.PRODUCT_CODE    ,
           A.NET_AMOUNT  AS INVOICE_VALUE ,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE     ,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           IND.ORDER_NO,
           IND.ONLINE_BILL_REF_NO,
           IND.BIN_ID AS BIN_ID,BIN.BIN_NAME ,
           REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(IND.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME, 
           CAST( ROUND((ISNULL(ind.INMDISCOUNTAMOUNT,0)+ISNULL(ind.DISCOUNT_AMOUNT,0))/NULLIF((ind.RATE*ind.invoice_quantity),0)*100,2)   AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,    
           CAST(ISNULL(ind.DISCOUNT_AMOUNT ,0)+ISNULL(ind.INMDISCOUNTAMOUNT  ,0) AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,    
           CAST(ind.XN_VALUE_WITHOUT_GST -(SKU.PURCHASE_PRICE*ind.QUANTITY) AS NUMERIC(14,2)) AS PROFIT_AMOUNT,
           IND.CESS_AMOUNT AS CESS_AMOUNT,
		   B.dept_alias ,
		   LM.ALIAS AS Receiver_Alias ,
		   B.DEPT_ALIAS AS SENDER_ALIAS        
      FROM INM01106 A (NOLOCK)
      JOIN IND01106 IND (NOLOCK) ON A.INV_ID =IND.INV_ID 
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.INV_ID,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE 
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE
      JOIN SKU (NOLOCK) ON SKU.product_code =IND.product_code 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  LEFT JOIN GST_REGISTERED GR (NOLOCK) ON GR.REGISTERED_GST=ISNULL(LMP.REGISTERED_GST_DEALER,0)
      WHERE A.CANCELLED =0  AND ISNULL(A.MEMO_TYPE,0) IN(0,1)     
	  and a.inv_mode=1
      AND A.INV_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR
  


  
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '9' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +a.XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,
			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,
            A.BIN_NAME ,VENDOR_BILL_DATE,
          A.XN_ITEM_TYPE AS XN_ITEM_TYPE,

         DISCOUNT_PERCENTAGE AS DISC_PCT,
         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,
		  Receiver_Alias,
		  SENDER_ALIAS
		 
         
    FROM 
    (
     SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,

           CAST(TL.DEPT_NAME AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(TL.LOC_GST_NO AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(TL.GST_STATE_CODE  AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(''GROUP INVOICE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''GROUP INVOICE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,

           CAST(A.INV_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.INV_DT AS SENDER_INVOICE_DATE,
           A.OTHER_CHARGES_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.OTHER_CHARGES_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.INV_ID,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.OTHER_CHARGES_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.OTHER_CHARGES_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.OTHER_CHARGES_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)+ ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)+ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST,
           CAST(''OTHER_CHARGES'' AS VARCHAR(100)) AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,          
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT, 
		   TL.dept_alias,
		   TL.dept_alias AS Receiver_Alias,
		   B.DEPT_ALIAS AS SENDER_ALIAS 
      FROM INM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.INV_ID,2)
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(tl.registered_gst,0)
      WHERE A.CANCELLED =0 AND A.OTHER_CHARGES>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)>0 and inv_mode=2
     AND A.INV_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR




	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '10' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,
			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,
    A.BIN_NAME ,
    VENDOR_BILL_DATE,
    A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,
         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,
		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
      SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,

           CAST(TL.DEPT_NAME AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(TL.LOC_GST_NO AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(TL.GST_STATE_CODE  AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(''GROUP INVOICE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''GROUP INVOICE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,

           CAST(A.INV_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.INV_DT AS SENDER_INVOICE_DATE,
           A.FREIGHT_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0) AS TAXABLE_VALUE,
           ISNULL(A.FREIGHT_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.INV_ID,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.FREIGHT_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.FREIGHT_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.FREIGHT_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)+ ISNULL(FREIGHT_IGST_AMOUNT ,0)+ISNULL(FREIGHT_CGST_AMOUNT,0)+ISNULL(FREIGHT_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           CAST(''FREIGHT'' AS VARCHAR(100)) AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE ,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT, B.dept_alias,
		   TL.dept_alias AS Receiver_Alias,
		   B.DEPT_ALIAS AS SENDER_ALIAS 
      FROM INM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.INV_ID,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  LEFT JOIN GST_REGISTERED GR (NOLOCK) ON GR.REGISTERED_GST=isnull(tl.registered_gst,0)
      WHERE A.CANCELLED =0 AND A.FREIGHT>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.FREIGHT_TAXABLE_VALUE,0)>0 and inv_mode=2
     AND A.INV_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR



	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '11' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,
    A.BIN_NAME ,
    VENDOR_BILL_DATE,
    XN_ITEM_TYPE AS XN_ITEM_TYPE,

          DISCOUNT_PERCENTAGE AS DISC_PCT,
         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
         
    FROM 
    (
           SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,

           CAST(TL.DEPT_NAME AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(TL.LOC_GST_NO  AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(ISNULL(A.PARTY_STATE_CODE  ,'''') AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(''PARTY INVOICE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''PARTY INVOICE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,

           CAST(A.INV_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.INV_DT AS SENDER_INVOICE_DATE,
           A.INSURANCE_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.INSURANCE_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.INSURANCE_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.INV_ID,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.INSURANCE_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.INSURANCE_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.INSURANCE_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.INSURANCE_TAXABLE_VALUE,0)+ ISNULL(INSURANCE_IGST_AMOUNT ,0)+ISNULL(INSURANCE_CGST_AMOUNT,0)+ISNULL(INSURANCE_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST ,
           ''INSURANCE'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE ,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME ,
           REGISTERED_GST_NAMES PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE ,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,         
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT, B.dept_alias,
		   TL.dept_alias AS Receiver_Alias,
		   B.DEPT_ALIAS AS SENDER_ALIAS 
      FROM INM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.INV_ID,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  LEFT JOIN GST_REGISTERED GR (NOLOCK) ON GR.REGISTERED_GST=isnull(tl.registered_gst,0)
      WHERE A.CANCELLED =0 AND A.INSURANCE>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.INSURANCE_TAXABLE_VALUE,0)>0 and a.inv_mode=2
      AND A.INV_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR



	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '12' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_Name  AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,


    A.BIN_NAME ,
    VENDOR_BILL_DATE,
    A.XN_ITEM_TYPE AS XN_ITEM_TYPE,

         DISCOUNT_PERCENTAGE AS DISC_PCT,
         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
         
    FROM 
    (
          
      SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,

           CAST(TL.DEPT_NAME AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(TL.LOC_GST_NO AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(TL.GST_STATE_CODE  AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(''GROUP INVOICE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''GROUP INVOICE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,

           CAST(A.INV_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.INV_DT AS SENDER_INVOICE_DATE,
           A.PACKING_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.PACKING_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.PACKING_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.INV_ID,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.PACKING_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.PACKING_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.PACKING_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.PACKING_TAXABLE_VALUE,0)+ ISNULL(PACKING_IGST_AMOUNT ,0)+ISNULL(PACKING_CGST_AMOUNT,0)+ISNULL(PACKING_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           ''PACKING'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE ,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           REGISTERED_GST_NAMES PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,         
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT,B.dept_alias,
		   TL.dept_alias AS Receiver_Alias,
		   B.DEPT_ALIAS AS SENDER_ALIAS 
      FROM INM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.INV_ID,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  LEFT JOIN GST_REGISTERED GR (NOLOCK) ON GR.REGISTERED_GST=isnull(tl.registered_gst,0)
      WHERE A.CANCELLED =0 AND A.PACKING>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.PACKING_TAXABLE_VALUE,0)>0 and a.inv_mode=2
      AND A.INV_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR


	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '13' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,

			A.BIN_NAME ,
			VENDOR_BILL_DATE,
			XN_ITEM_TYPE AS XN_ITEM_TYPE,

         DISCOUNT_PERCENTAGE AS DISC_PCT,
         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
         
    FROM 
    (
       
           SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,

           CAST(TL.DEPT_NAME AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(TL.LOC_GST_NO AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(TL.GST_STATE_CODE  AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(''GROUP INVOICE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''GROUP INVOICE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,

           CAST(A.INV_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.INV_DT AS SENDER_INVOICE_DATE,
           IND.HSN_CODE  AS HSN_CODE ,
           IND.QUANTITY  AS QUANTITY,
           XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(IND.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           LEFT(A.INV_ID,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           IND.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(IND.SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           IND.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           IND.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
           CAST('''' AS VARCHAR(5)) AS OH_TYPE,
           IND.PRODUCT_CODE    ,
           A.NET_AMOUNT  AS INVOICE_VALUE ,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE     ,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           IND.ORDER_NO,
           IND.ONLINE_BILL_REF_NO,
           IND.BIN_ID AS BIN_ID,BIN.BIN_NAME ,
           REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(IND.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME, 
           CAST( ROUND((ISNULL(ind.INMDISCOUNTAMOUNT,0)+ISNULL(ind.DISCOUNT_AMOUNT,0))/NULLIF((ind.RATE*ind.invoice_quantity),0)*100,2)   AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,    
           CAST(ISNULL(ind.DISCOUNT_AMOUNT ,0)+ISNULL(ind.INMDISCOUNTAMOUNT  ,0) AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,    
           CAST(ind.XN_VALUE_WITHOUT_GST -(SKU.PURCHASE_PRICE*ind.QUANTITY) AS NUMERIC(14,2)) AS PROFIT_AMOUNT,
           IND.CESS_AMOUNT AS CESS_AMOUNT,B.dept_alias ,
		   TL.dept_alias AS Receiver_Alias ,
		   B.DEPT_ALIAS AS SENDER_ALIAS        
      FROM INM01106 A (NOLOCK)
      JOIN IND01106 IND (NOLOCK) ON A.INV_ID =IND.INV_ID 
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.INV_ID,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
      JOIN SKU (NOLOCK) ON SKU.product_code =IND.product_code 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  LEFT JOIN GST_REGISTERED GR (NOLOCK) ON GR.REGISTERED_GST=isnull(tl.registered_gst,0)
      WHERE A.CANCELLED =0  AND ISNULL(A.MEMO_TYPE,0) IN(0,1)     
	  and a.inv_mode=2
      AND A.INV_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR
   
   print 'End of wholesale Invoice'

   Print 'start debit note'


	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '14' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,
		A.BIN_NAME ,
		VENDOR_BILL_DATE,
		XN_ITEM_TYPE AS XN_ITEM_TYPE,

         DISCOUNT_PERCENTAGE AS DISC_PCT,
         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,
		 Receiver_Alias,
		 SENDER_ALIAS
		 
         
    FROM 
    (
            SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,

           CAST(LM.AC_NAME AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(LMP.AC_GST_NO AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(ISNULL(A.PARTY_STATE_CODE  ,'''') AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(''PARTY DEBIT NOTE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''PARTY DEBIT NOTE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,

           CAST(A.RM_NO  AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.RM_DT  AS SENDER_INVOICE_DATE,
           A.OTHER_CHARGES_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.OTHER_CHARGES_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           B.dept_id  AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.OTHER_CHARGES_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.OTHER_CHARGES_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.OTHER_CHARGES_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)+ ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)+ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST,
           ''OTHER_CHARGES'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE ,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,         
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT,
		   b.dept_alias,
		   LM.ALIAS AS Receiver_Alias,
		   B.DEPT_ALIAS AS SENDER_ALIAS 
      FROM RMM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID = isnull(nullif(A.ACCOUNTS_DEPT_ID,'''') , LEFT (A.RM_ID ,2))
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID 
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  LEFT JOIN GST_REGISTERED GR (NOLOCK) ON GR.REGISTERED_GST=isnull(b.registered_gst,0)
      WHERE A.CANCELLED =0 AND A.OTHER_CHARGES>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)>0       
	  and ISNULL(a.bill_challan_mode,0)=0   and a.mode=1    
      AND A.RM_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR



	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '15' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,

			A.BIN_NAME ,
			VENDOR_BILL_DATE,
			A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
           SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,

           CAST(LM.AC_NAME AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(LMP.AC_GST_NO AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(ISNULL(A.PARTY_STATE_CODE  ,'''') AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(''PARTY DEBIT NOTE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''PARTY DEBIT NOTE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,

           CAST(A.RM_NO  AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.RM_DT  AS SENDER_INVOICE_DATE,
           A.FREIGHT_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0) AS TAXABLE_VALUE,
           ISNULL(A.FREIGHT_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           B.DEPT_ID AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.FREIGHT_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.FREIGHT_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.FREIGHT_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)+ ISNULL(FREIGHT_IGST_AMOUNT ,0)+ISNULL(FREIGHT_CGST_AMOUNT,0)+ISNULL(FREIGHT_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           ''FREIGHT'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
            A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE  ,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,          
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT,B.dept_alias,
		   LM.ALIAS AS Receiver_Alias,
		   B.DEPT_ALIAS AS SENDER_ALIAS 
      FROM RMM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =isnull(nullif(A.ACCOUNTS_DEPT_ID,'''') , LEFT (A.RM_ID ,2)) 
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  LEFT JOIN GST_REGISTERED GR (NOLOCK) ON GR.REGISTERED_GST=isnull(b.registered_gst,0)
      WHERE A.CANCELLED =0 AND A.FREIGHT>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.FREIGHT_TAXABLE_VALUE,0)>0  and a.mode=1          
      AND A.RM_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR




	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '16' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,

		 A.BIN_NAME ,
		 VENDOR_BILL_DATE,
         A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,


		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
          
           SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,

            CAST(LM.AC_NAME AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(LMP.AC_GST_NO AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(ISNULL(A.PARTY_STATE_CODE  ,'''') AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(''PARTY DEBIT NOTE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''PARTY DEBIT NOTE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,

           CAST(A.RM_NO  AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.RM_DT  AS SENDER_INVOICE_DATE,
           RMD.HSN_CODE  AS HSN_CODE ,
           RMD.QUANTITY  AS QUANTITY,
           XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(RMD.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           B.DEPT_ID AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           RMD.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(RMD.SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           RMD.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST(RMD.BILL_NO  AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST(RMD.BILL_DT AS DATETIME) AS REFERENCE_DATE,
           RMD.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
           CAST('''' AS VARCHAR(5)) AS OH_TYPE,
           RMD.PRODUCT_CODE   ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE         ,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           RMD.BIN_ID AS BIN_ID,BIN.BIN_NAME ,
           REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(RMD.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
           
           CAST(ROUND((ISNULL(rmd.RMMDISCOUNTAMOUNT,0)+ISNULL(rmd.DISCOUNT_AMOUNT,0))/NULLIF((rmd.RATE*rmd.invoice_quantity),0)*100,2)  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           
           CAST(ISNULL(RMD.DISCOUNT_AMOUNT ,0)+ISNULL(RMD.RMMDISCOUNTAMOUNT ,0) AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           RMD.CESS_AMOUNT  AS CESS_AMOUNT,B.dept_alias,
		   LM.ALIAS AS Receiver_Alias,
		   B.DEPT_ALIAS AS SENDER_ALIAS 
      FROM RMM01106  A (NOLOCK)
      JOIN RMD01106 RMD (NOLOCK) ON A.RM_ID =RMD.RM_ID 
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =isnull(nullif(A.ACCOUNTS_DEPT_ID,'''') , LEFT (A.RM_ID ,2)) 
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  LEFT JOIN GST_REGISTERED GR (NOLOCK) ON GR.REGISTERED_GST=isnull(b.registered_gst,0)
      WHERE A.CANCELLED =0  AND ISNULL(A.MEMO_TYPE,0) IN(0,1)  and a.mode=1      
      AND A.RM_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR

    print 'group debit note'

	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '17' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +a.XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,
		A.BIN_NAME ,
		VENDOR_BILL_DATE,
		XN_ITEM_TYPE AS XN_ITEM_TYPE,

         DISCOUNT_PERCENTAGE AS DISC_PCT,
         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,
		 Receiver_Alias,
		 SENDER_ALIAS
		 
         
    FROM 
    (
           SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,

           CAST(TL.DEPT_NAME AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(TL.LOC_GST_NO AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(TL.GST_STATE_CODE AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(''GROUP DEBIT NOTE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''GROUP DEBIT NOTE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,

           CAST(A.RM_NO  AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.RM_DT  AS SENDER_INVOICE_DATE,
           A.OTHER_CHARGES_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.OTHER_CHARGES_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           B.dept_id  AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.OTHER_CHARGES_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.OTHER_CHARGES_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.OTHER_CHARGES_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)+ ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)+ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST,
           ''OTHER_CHARGES'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE ,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,         
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT,TL.dept_alias,
		   TL.DEPT_ALIAS AS Receiver_Alias,
		   B.DEPT_ALIAS AS SENDER_ALIAS 
      FROM RMM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID = isnull(nullif(A.ACCOUNTS_DEPT_ID,'''') , LEFT (A.RM_ID ,2))
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
	  LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  LEFT JOIN GST_REGISTERED GR (NOLOCK) ON GR.REGISTERED_GST=isnull(tl.registered_gst,0)
      WHERE A.CANCELLED =0 AND A.OTHER_CHARGES>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)>0       
	  and ISNULL(a.bill_challan_mode,0)=0   and a.mode=2    
      AND A.RM_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR



	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '18' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,

			A.BIN_NAME ,
			VENDOR_BILL_DATE,
			A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
           SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,

            CAST(TL.DEPT_NAME AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(TL.LOC_GST_NO AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(TL.GST_STATE_CODE AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(''GROUP DEBIT NOTE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''GROUP DEBIT NOTE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,

           CAST(A.RM_NO  AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.RM_DT  AS SENDER_INVOICE_DATE,
           A.FREIGHT_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0) AS TAXABLE_VALUE,
           ISNULL(A.FREIGHT_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           B.DEPT_ID AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.FREIGHT_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.FREIGHT_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.FREIGHT_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)+ ISNULL(FREIGHT_IGST_AMOUNT ,0)+ISNULL(FREIGHT_CGST_AMOUNT,0)+ISNULL(FREIGHT_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           ''FREIGHT'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
            A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE  ,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,           
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT,B.dept_alias,
		   TL.DEPT_ALIAS AS Receiver_Alias,
		   B.DEPT_ALIAS AS SENDER_ALIAS 
      FROM RMM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =isnull(nullif(A.ACCOUNTS_DEPT_ID,'''') , LEFT (A.RM_ID ,2)) 
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  LEFT JOIN GST_REGISTERED GR (NOLOCK) ON GR.REGISTERED_GST=isnull(tl.registered_gst,0)
      WHERE A.CANCELLED =0 AND A.FREIGHT>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.FREIGHT_TAXABLE_VALUE,0)>0  and a.mode=2          
      AND A.RM_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR




	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '19' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,

		 A.BIN_NAME ,
		 VENDOR_BILL_DATE,
         A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,


		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
          
           SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,

            CAST(TL.DEPT_NAME AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(TL.LOC_GST_NO AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(TL.GST_STATE_CODE AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(''GROUP DEBIT NOTE'' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(''GROUP DEBIT NOTE'' AS VARCHAR(100)) AS TRANSACTION_TYPE,

           CAST(A.RM_NO  AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.RM_DT  AS SENDER_INVOICE_DATE,
           RMD.HSN_CODE  AS HSN_CODE ,
           RMD.QUANTITY  AS QUANTITY,
           XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(RMD.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           B.DEPT_ID AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           RMD.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(RMD.SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           RMD.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST(RMD.BILL_NO  AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST(RMD.BILL_DT AS DATETIME) AS REFERENCE_DATE,
           RMD.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
           CAST('''' AS VARCHAR(5)) AS OH_TYPE,
           RMD.PRODUCT_CODE   ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE         ,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           RMD.BIN_ID AS BIN_ID,BIN.BIN_NAME ,
           REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(RMD.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
           
           CAST(ROUND((ISNULL(rmd.RMMDISCOUNTAMOUNT,0)+ISNULL(rmd.DISCOUNT_AMOUNT,0))/NULLIF((rmd.RATE*rmd.invoice_quantity),0)*100,2)  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           
           CAST(ISNULL(RMD.DISCOUNT_AMOUNT ,0)+ISNULL(RMD.RMMDISCOUNTAMOUNT ,0) AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           RMD.CESS_AMOUNT  AS CESS_AMOUNT,B.dept_alias,
		   TL.DEPT_ALIAS AS Receiver_Alias,
		   B.DEPT_ALIAS AS SENDER_ALIAS 
      FROM RMM01106  A (NOLOCK)
      JOIN RMD01106 RMD (NOLOCK) ON A.RM_ID =RMD.RM_ID 
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =isnull(nullif(A.ACCOUNTS_DEPT_ID,'''') , LEFT (A.RM_ID ,2)) 
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  LEFT JOIN GST_REGISTERED GR (NOLOCK) ON GR.REGISTERED_GST=isnull(tl.registered_gst,0)
      WHERE A.CANCELLED =0  AND ISNULL(A.MEMO_TYPE,0) IN(0,1) 
	  and a.mode=2
      AND A.RM_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR


  print 'end of debit note'

  print' start arc'

	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '20' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			QUANTITY AS QUANTITY_OW,0 AS  QUANTITY_IW,
			TAXABLE_VALUE AS TAXABLE_VALUE_OW,0 AS  TAXABLE_VALUE_IW,
			CGST_AMOUNT AS CGST_AMOUNT_OW,0 AS    CGST_AMOUNT_IW,
			SGST_AMOUNT AS  SGST_AMOUNT_OW,0 AS    SGST_AMOUNT_IW,
			IGST_AMOUNT AS  IGST_AMOUNT_OW,0 AS    IGST_AMOUNT_IW,
			UTGST_AMOUNT AS UTGST_AMOUNT_OW,0 AS   UTGST_AMOUNT_IW,
			TRANSACTION_VALUE_INCLUDING_GST AS TRANSACTION_VALUE_INCLUDING_GST_OW,0 AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			TAX_ROUND_OFF AS TAX_ROUND_OFF_OW,0 AS   TAX_ROUND_OFF_IW,
			VAT_AMOUNT AS VAT_AMOUNT_OW,0 AS  VAT_AMOUNT_IW,

		A.BIN_NAME ,
		VENDOR_BILL_DATE,
		XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         DISCOUNT_AMOUNT AS DISC_AMT_OW,0 AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 PROFIT_AMOUNT AS PROFIT_AMOUNT_OW,0 AS  PROFIT_AMOUNT_IW,
		 CESS_AMOUNT AS CESS_AMOUNT_OW,0 AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
          
          
     
      SELECT CUST.CUSTOMER_FNAME +'' ''+CUSTOMER_LNAME  AS SENDER_NAME,
           CUST.CUS_GST_NO  AS SENDER_GSTN_ID,
           A.PARTY_STATE_CODE  AS SENDER_STATE_CODE,
           PS.GST_STATE_NAME AS SENDER_STATE_NAME, 
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''ADVANCE'' AS SUB_TRANSACTION_TYPE,
           ''ADVANCE'' AS TRANSACTION_TYPE,
           CAST(A.ADV_REC_NO  AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.ADV_REC_DT  AS SENDER_INVOICE_DATE,
           A.HSN_CODE  AS HSN_CODE ,
           0  AS QUANTITY,
           ISNULL(A.TAXABLE_VALUE,0) AS TAXABLE_VALUE,
           ISNULL(A.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           LEFT(A.ADV_REC_ID ,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST(''''  AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           A.NET_AMOUNT   AS TRANSACTION_VALUE_INCLUDING_GST,
           ''ADVANCE'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE   ,
           B.LOC_GST_NO ,
           CAST(''OUTWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
            isnull(nullif( replace(cus_gst_no,cus_gst_no,''Registered''),''''),''Unregistered'') AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
		   1 as XN_ITEM_TYPE,
           ''Inv'' as XN_ITEM_TYPE_NAME,
           CAST(A.DISCOUNT_PERCENTAGE  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(A.discount_amount  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT,B.dept_alias,
		   B.dept_alias AS Receiver_Alias,
		   '''' AS SENDER_ALIAS 
      FROM ARC01106   A (NOLOCK) 
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.ADV_REC_ID ,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE 
      JOIN GST_STATE_MST PS (NOLOCK)  ON A.PARTY_STATE_CODE  =PS.GST_STATE_CODE 
      LEFT OUTER JOIN CUSTDYM CUST (NOLOCK) ON CUST.CUSTOMER_CODE =A.CUSTOMER_CODE 
      WHERE A.CANCELLED =0
      AND ARC_TYPE =1 AND ARCT<>1
      AND A.ADV_REC_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR


	print ' advance adjusted'

	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '21' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,


		A.BIN_NAME ,
		VENDOR_BILL_DATE,
		XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
		 0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
          
            SELECT   CUST.CUSTOMER_FNAME +'' ''+CUSTOMER_LNAME  AS SENDER_NAME,
            CUST.CUS_GST_NO AS SENDER_GSTN_ID,
           A.PARTY_STATE_CODE  AS SENDER_STATE_CODE,
           PS.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''ADVANCE ADJUSTED'' AS SUB_TRANSACTION_TYPE,
           ''ADVANCE ADJUSTED'' AS TRANSACTION_TYPE,
           CAST(A.ADV_REC_NO  AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           CM.CM_DT  AS SENDER_INVOICE_DATE,
           A.HSN_CODE  AS HSN_CODE ,
           0  AS QUANTITY,
           ISNULL(A.TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           LEFT(A.ADV_REC_ID ,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(A.SGST_AMOUNT AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST(''''  AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           A.NET_AMOUNT   AS TRANSACTION_VALUE_INCLUDING_GST,
          ''ADVANCE ADJ'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE   ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           isnull(nullif( replace(cus_gst_no,cus_gst_no,''Registered''),''''),''Unregistered'') AS PARTY_REGISTRATION_STATUS,
           CAST('''' AS VARCHAR(20)) AS MRR_NO,
           CAST('''' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
		    1 AS XN_ITEM_TYPE,
           ''INV'' AS XN_ITEM_TYPE_NAME,
           CAST(A.DISCOUNT_PERCENTAGE  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(A.discount_amount  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT,B.DEPT_ALIAS,
		   B.dept_alias AS Receiver_Alias,
		   '''' AS SENDER_ALIAS 
      FROM ARC01106   A (NOLOCK) 
      JOIN PAYMODE_XN_DET PX (NOLOCK) ON PX.ADJ_MEMO_ID=A.ADV_REC_ID
	  JOIN CMM01106 CM (NOLOCK) ON CM.CM_ID=PX.MEMO_ID
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.ADV_REC_ID ,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE 
      JOIN GST_STATE_MST PS (NOLOCK)  ON A.PARTY_STATE_CODE  =PS.GST_STATE_CODE 
      LEFT OUTER JOIN CUSTDYM CUST (NOLOCK) ON CUST.CUSTOMER_CODE =A.CUSTOMER_CODE 
      WHERE A.CANCELLED =0
      AND ARC_TYPE =1 AND ARCT=2  AND PAYMODE_CODE=''0000002''         
      AND A.ADV_REC_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR


	--end of advance adjusted
	--start PurchSE lIST

	
	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '22' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

			A.BIN_NAME ,
			VENDOR_BILL_DATE,
			A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
         0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,
		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
          
      SELECT LM.AC_NAME AS SENDER_NAME,
           LMP.AC_GST_NO AS SENDER_GSTN_ID,
           A.PARTY_STATE_CODE AS SENDER_STATE_CODE,
           PS.GST_STATE_NAME AS SENDER_STATE_NAME,          
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,   
           ''PARTY PURCHASE'' AS SUB_TRANSACTION_TYPE,      
           ''PARTY PURCHASE'' AS TRANSACTION_TYPE,
           A.BILL_NO AS SENDER_INVOICE_NO,
           A.BILL_DT  AS SENDER_INVOICE_DATE,
           A.OTHER_CHARGES_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.OTHER_CHARGES_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           B.DEPT_ID  AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.OTHER_CHARGES_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.OTHER_CHARGES_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.OTHER_CHARGES_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)+ ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)+ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           ''OTHER_CHARGES'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE   ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME ,
           GR.REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           A.MRR_NO ,
           A.MRR_DT ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           a.inv_dt   AS VENDOR_BILL_DATE,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT,B.dept_alias,
		   B.dept_alias AS Receiver_Alias,
		   LM.ALIAS AS SENDER_ALIAS
      FROM PIM01106  A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =isnull(nullif(A.PUR_FOR_DEPT_ID,'''') , A.DEPT_ID)
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
	  JOIN GST_STATE_MST PS (NOLOCK)  ON A.PARTY_STATE_CODE  =PS.GST_STATE_CODE 
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(lmp.registered_gst_dealer,0)
      WHERE A.CANCELLED =0 AND A.OTHER_CHARGES>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)>0
      AND ISNULL(A.BILL_CHALLAN_MODE,0)=0 AND A.INV_MODE=1  
      AND A.BILL_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR

	
	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '23' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_Name AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

		A.BIN_NAME ,
		VENDOR_BILL_DATE,
		A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
         0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
        SELECT 
		   LM.AC_NAME AS SENDER_NAME,
           LMP.AC_GST_NO AS SENDER_GSTN_ID,
           A.PARTY_STATE_CODE AS SENDER_STATE_CODE,
           PS.GST_STATE_NAME AS SENDER_STATE_NAME,  

           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''PARTY PURCHASE'' AS SUB_TRANSACTION_TYPE,      
           ''PARTY PURCHASE'' AS TRANSACTION_TYPE,
           A.BILL_NO AS SENDER_INVOICE_NO,
           A.BILL_DT  AS SENDER_INVOICE_DATE,
           A.FREIGHT_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.FREIGHT_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           B.DEPT_ID  AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.FREIGHT_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.FREIGHT_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.FREIGHT_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)+ ISNULL(FREIGHT_IGST_AMOUNT ,0)+ISNULL(FREIGHT_CGST_AMOUNT,0)+ISNULL(FREIGHT_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           ''FREIGHT'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE   ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME ,
           GR.REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           A.MRR_NO ,
           A.MRR_DT ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           A.INV_DT   AS VENDOR_BILL_DATE ,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT,B.dept_alias ,
		   B.dept_alias AS Receiver_Alias,
		   LM.ALIAS AS SENDER_ALIAS
      FROM PIM01106  A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =isnull(nullif(A.PUR_FOR_DEPT_ID,'''') , A.DEPT_ID)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID 
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      JOIN GST_STATE_MST PS (NOLOCK)  ON A.PARTY_STATE_CODE  =PS.GST_STATE_CODE 
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(lmp.registered_gst_dealer,0)
      WHERE A.CANCELLED =0 AND A.FREIGHT>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.FREIGHT_TAXABLE_VALUE,0)>0
      AND ISNULL(A.BILL_CHALLAN_MODE,0)=0  and a.inv_mode=1   
      AND A.BILL_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR


	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '24' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

			A.BIN_NAME ,
			VENDOR_BILL_DATE,
			A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
         0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
          SELECT 
		    LM.AC_NAME AS SENDER_NAME,
           LMP.AC_GST_NO AS SENDER_GSTN_ID,
           A.PARTY_STATE_CODE AS SENDER_STATE_CODE,
           PS.GST_STATE_NAME AS SENDER_STATE_NAME, 
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''PARTY PURCHASE'' AS SUB_TRANSACTION_TYPE,      
           ''PARTY PURCHASE'' AS TRANSACTION_TYPE,
           A.BILL_NO AS SENDER_INVOICE_NO,
           A.BILL_DT  AS SENDER_INVOICE_DATE,
           PID.HSN_CODE AS HSN_CODE ,
           PID.QUANTITY  AS QUANTITY,
           PID.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(PID.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           B.DEPT_ID  AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           PID.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(PID.SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           PID.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           PID.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
           CAST('''' AS VARCHAR(10)) AS OH_TYPE,
           PID.PRODUCT_CODE  ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE ,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE          ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME ,
           GR.REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           A.MRR_NO ,
           A.MRR_DT ,
           CAST(PID.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           a.inv_dt  AS VENDOR_BILL_DATE ,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
           
            CAST(ROUND((ISNULL(pid.PIMDiscountAmount,0)+ISNULL(pid.DISCOUNT_AMOUNT,0))/NULLIF((pid.gross_purchase_price*pid.invoice_quantity),0)*100,2)  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(ISNULL(PID.DISCOUNT_AMOUNT,0)+ISNULL(PID.PIMDISCOUNTAMOUNT,0)   AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT ,
           PID.CESS_AMOUNT ,B.dept_alias ,
		   B.dept_alias AS Receiver_Alias,
		   LM.ALIAS AS SENDER_ALIAS
      FROM PIM01106  A (NOLOCK)
      JOIN PID01106 PID (NOLOCK) ON A.MRR_ID =PID.MRR_ID  
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =isnull(nullif(A.PUR_FOR_DEPT_ID,'''') , A.DEPT_ID)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID 
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      JOIN GST_STATE_MST PS (NOLOCK)  ON A.PARTY_STATE_CODE  =PS.GST_STATE_CODE 
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  JOIN (SELECT TOP 1 VALUE FROM CONFIG (NOLOCK) WHERE CONFIG_OPTION=''HO_LOCATION_ID'') CNF1 ON 1=1      
      JOIN (SELECT TOP 1 VALUE FROM CONFIG (NOLOCK) WHERE CONFIG_OPTION=''LOCATION_ID'') CNF2 ON 1=1   
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(lmp.registered_gst_dealer,0)
      WHERE A.CANCELLED =0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.BILL_CHALLAN_MODE,0)=0 and a.inv_mode=1
      AND A.BILL_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR
	   	 
	
	
	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '25' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

			A.BIN_NAME ,
			VENDOR_BILL_DATE,
			A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
         0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,
		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
          
      SELECT SL.DEPT_NAME AS SENDER_NAME,
            SL.LOC_GST_NO AS SENDER_GSTN_ID,
            SL.GST_STATE_CODE AS SENDER_STATE_CODE,
           PSSL.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''GROUP PURCHASE'' AS SUB_TRANSACTION_TYPE,      
           ''GROUP PURCHASE'' AS TRANSACTION_TYPE,
           A.BILL_NO AS SENDER_INVOICE_NO,
           A.BILL_DT  AS SENDER_INVOICE_DATE,
           A.OTHER_CHARGES_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.OTHER_CHARGES_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           B.DEPT_ID  AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.OTHER_CHARGES_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.OTHER_CHARGES_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.OTHER_CHARGES_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)+ ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)+ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           ''OTHER_CHARGES'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE   ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME ,
           GR.REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           A.MRR_NO ,
           A.MRR_DT ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           a.inv_dt   AS VENDOR_BILL_DATE,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT,B.dept_alias,
		   B.dept_alias AS Receiver_Alias,
		   SL.dept_alias AS SENDER_ALIAS
      FROM PIM01106  A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =isnull(nullif(A.PUR_FOR_DEPT_ID,'''') , A.DEPT_ID)
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
	  LEFT JOIN LOCATION SL (NOLOCK) ON SL.DEPT_ID =LEFT (A.INV_ID,2)
      LEFT JOIN GST_STATE_MST PSSL (NOLOCK)  ON SL.GST_STATE_CODE  =PSSL.GST_STATE_CODE 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(b.registered_gst,0)
      WHERE A.CANCELLED =0 AND A.OTHER_CHARGES>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)>0
      AND ISNULL(A.BILL_CHALLAN_MODE,0)=0 AND A.INV_MODE=2  
      AND A.BILL_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR

	
	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '26' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

		A.BIN_NAME ,
		VENDOR_BILL_DATE,
		A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
         0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
        SELECT 
		    SL.DEPT_NAME AS SENDER_NAME,
            SL.LOC_GST_NO AS SENDER_GSTN_ID,
            SL.GST_STATE_CODE AS SENDER_STATE_CODE,
            PSSL.GST_STATE_NAME AS SENDER_STATE_NAME,
            B.DEPT_NAME   AS RECEIVER_NAME,
            B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
            B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''GROUP PURCHASE'' AS SUB_TRANSACTION_TYPE,      
           ''GROUP PURCHASE'' AS TRANSACTION_TYPE,
           A.BILL_NO AS SENDER_INVOICE_NO,
           A.BILL_DT  AS SENDER_INVOICE_DATE,
           A.FREIGHT_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.FREIGHT_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           B.DEPT_ID  AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.FREIGHT_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.FREIGHT_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.FREIGHT_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)+ ISNULL(FREIGHT_IGST_AMOUNT ,0)+ISNULL(FREIGHT_CGST_AMOUNT,0)+ISNULL(FREIGHT_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           ''FREIGHT'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE   ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME ,
           GR.REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           A.MRR_NO ,
           A.MRR_DT ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           A.INV_DT   AS VENDOR_BILL_DATE ,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT,B.dept_alias ,
		   B.dept_alias AS Receiver_Alias,
		   sl.dept_alias AS SENDER_ALIAS
      FROM PIM01106  A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =isnull(nullif(A.PUR_FOR_DEPT_ID,'''') , A.DEPT_ID)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID 
	  LEFT JOIN LOCATION SL (NOLOCK) ON SL.DEPT_ID =LEFT (A.INV_ID,2)
      LEFT JOIN GST_STATE_MST PSSL (NOLOCK)  ON SL.GST_STATE_CODE  =PSSL.GST_STATE_CODE 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(b.registered_gst,0)
      WHERE A.CANCELLED =0 AND A.FREIGHT>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.FREIGHT_TAXABLE_VALUE,0)>0
      AND ISNULL(A.BILL_CHALLAN_MODE,0)=0  and a.inv_mode=2   
      AND A.BILL_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR



	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '27' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

		A.BIN_NAME ,
		VENDOR_BILL_DATE,
		A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
         0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
            SELECT SL.DEPT_NAME AS SENDER_NAME,
            SL.LOC_GST_NO AS SENDER_GSTN_ID,
            SL.GST_STATE_CODE AS SENDER_STATE_CODE,
           PSSL.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''GROUP PURCHASE'' AS SUB_TRANSACTION_TYPE,      
           ''GROUP PURCHASE'' AS TRANSACTION_TYPE,
           A.BILL_NO AS SENDER_INVOICE_NO,
           A.BILL_DT  AS SENDER_INVOICE_DATE,
           PID.HSN_CODE AS HSN_CODE ,
           PID.QUANTITY  AS QUANTITY,
           PID.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(PID.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           B.DEPT_ID  AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           PID.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(PID.SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           PID.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           PID.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
           CAST('''' AS VARCHAR(10)) AS OH_TYPE,
           PID.PRODUCT_CODE  ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE ,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST(''''  AS VARCHAR(100)) AS TRANSACTION_MODE          ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME ,
           REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           A.MRR_NO ,
           A.MRR_DT ,
           CAST(PID.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           a.inv_dt  AS VENDOR_BILL_DATE ,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,        
            CAST(ROUND((ISNULL(pid.INMDISCOUNTAMOUNT,0)+ISNULL(pid.DISCOUNT_AMOUNT,0))/NULLIF((pid.rate*pid.invoice_quantity),0)*100,2)  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(ISNULL(PID.DISCOUNT_AMOUNT,0)+ISNULL(PID.INMDISCOUNTAMOUNT,0)   AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT ,
           PID.CESS_AMOUNT ,B.dept_alias ,
		   B.dept_alias AS Receiver_Alias,
		   SL.dept_alias AS SENDER_ALIAS
      FROM PIM01106  A (NOLOCK)
	  join INM01106 inm (nolock) on A.inv_id =inm.INV_ID 
      JOIN IND01106  pid (NOLOCK) ON inm.inv_id =pid.inv_id  
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =isnull(nullif(A.PUR_FOR_DEPT_ID,'''') , A.DEPT_ID)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION SL (NOLOCK) ON SL.DEPT_ID =LEFT (A.INV_ID,2)
      LEFT JOIN GST_STATE_MST PSSL (NOLOCK)  ON SL.GST_STATE_CODE  =PSSL.GST_STATE_CODE 
      JOIN GST_STATE_MST PS (NOLOCK)  ON A.PARTY_STATE_CODE  =PS.GST_STATE_CODE 
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  JOIN (SELECT TOP 1 VALUE FROM CONFIG (NOLOCK) WHERE CONFIG_OPTION=''HO_LOCATION_ID'') CNF1 ON 1=1      
      JOIN (SELECT TOP 1 VALUE FROM CONFIG (NOLOCK) WHERE CONFIG_OPTION=''LOCATION_ID'') CNF2 ON 1=1 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(b.registered_gst,0)
      WHERE A.CANCELLED =0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.BILL_CHALLAN_MODE,0)=0
	  and (a.INV_MODE =2 and a.receipt_dt <>'''' and   CNF1.VALUE=CNF2.VALUE )   
      AND A.BILL_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR



	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '27' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

		A.BIN_NAME ,
		VENDOR_BILL_DATE,
		A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
         0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(20)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
            SELECT SL.DEPT_NAME AS SENDER_NAME,
            SL.LOC_GST_NO AS SENDER_GSTN_ID,
            SL.GST_STATE_CODE AS SENDER_STATE_CODE,
           PSSL.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''GROUP PURCHASE'' AS SUB_TRANSACTION_TYPE,      
           ''GROUP PURCHASE'' AS TRANSACTION_TYPE,
           A.BILL_NO AS SENDER_INVOICE_NO,
           A.BILL_DT  AS SENDER_INVOICE_DATE,
           PID.HSN_CODE AS HSN_CODE ,
           PID.QUANTITY  AS QUANTITY,
           PID.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(PID.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           B.DEPT_ID  AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           PID.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(PID.SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           PID.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           PID.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
           CAST('''' AS VARCHAR(10)) AS OH_TYPE,
           PID.PRODUCT_CODE  ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE ,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST(''''  AS VARCHAR(100)) AS TRANSACTION_MODE          ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME ,
           REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           A.MRR_NO ,
           A.MRR_DT ,
           CAST(PID.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           A.INV_DT  AS VENDOR_BILL_DATE ,
            ISNULL(A.XN_ITEM_TYPE,1) AS XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME AS XN_ITEM_TYPE_NAME,        
           CAST(ROUND((ISNULL(pid.PIMDiscountAmount,0)+ISNULL(pid.DISCOUNT_AMOUNT,0))/NULLIF((pid.gross_purchase_price*pid.invoice_quantity),0)*100,2)  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(ISNULL(PID.DISCOUNT_AMOUNT,0)+ISNULL(PID.PIMDISCOUNTAMOUNT,0)   AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT ,
           PID.CESS_AMOUNT ,B.DEPT_ALIAS ,
		   B.DEPT_ALIAS AS RECEIVER_ALIAS,
		   SL.DEPT_ALIAS AS SENDER_ALIAS
      FROM PIM01106  A (NOLOCK)
      JOIN PID01106  PID (NOLOCK) ON A.MRR_ID =PID.MRR_ID  
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =ISNULL(NULLIF(A.PUR_FOR_DEPT_ID,'''') , A.DEPT_ID)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID  
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION SL (NOLOCK) ON SL.DEPT_ID =LEFT (A.mrr_id,2)
      LEFT JOIN GST_STATE_MST PSSL (NOLOCK)  ON SL.GST_STATE_CODE  =PSSL.GST_STATE_CODE 
      JOIN GST_STATE_MST PS (NOLOCK)  ON A.PARTY_STATE_CODE  =PS.GST_STATE_CODE 
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  JOIN (SELECT TOP 1 VALUE FROM CONFIG (NOLOCK) WHERE CONFIG_OPTION=''HO_LOCATION_ID'') CNF1 ON 1=1      
      JOIN (SELECT TOP 1 VALUE FROM CONFIG (NOLOCK) WHERE CONFIG_OPTION=''LOCATION_ID'') CNF2 ON 1=1 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.XN_ITEM_TYPE=ISNULL(A.XN_ITEM_TYPE,0)
	  LEFT JOIN GST_REGISTERED GR (NOLOCK) ON GR.REGISTERED_GST=ISNULL(B.REGISTERED_GST,0)
      WHERE A.CANCELLED =0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.BILL_CHALLAN_MODE,0)=0  
	  and (a.INV_MODE =2 and a.receipt_dt <>'''' and   CNF1.VALUE<>CNF2.VALUE )  
      AND A.BILL_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR

	 --END OF PURCHASE



	 PRINT 'START credit  NOTE'

	 
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '28' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,
			A.BIN_NAME ,
			VENDOR_BILL_DATE,
			A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
         0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 RM_NO AS RM_NO,
         RM_DT AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
	
       SELECT 
	       LM.AC_NAME AS SENDER_NAME,
           LMP.AC_GST_NO AS SENDER_GSTN_ID,
           A.PARTY_STATE_CODE AS SENDER_STATE_CODE,
           ST2.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''PARTY CREDIT NOTE'' AS SUB_TRANSACTION_TYPE,
           ''PARTY CREDIT NOTE'' AS TRANSACTION_TYPE,          
		   A.CN_NO AS SENDER_INVOICE_NO,
           A.RECEIPT_DT  AS SENDER_INVOICE_DATE,
           A.OTHER_CHARGES_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.OTHER_CHARGES_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.CN_ID  ,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.OTHER_CHARGES_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.OTHER_CHARGES_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.OTHER_CHARGES_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           '''' AS REFERENCE_NUMBER,
           '''' AS REFERENCE_DATE,
           (ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)+ ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)+ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0)) AS TRANSACTION_VALUE_INCLUDING_GST,
           ''OTHER_CHARGES'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE    ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
		  gr.REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           '''' AS MRR_NO ,
           '''' AS  MRR_DT ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           A.CN_DT AS  VENDOR_BILL_DATE ,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT,b.dept_alias,
		   A.manual_dn_no AS RM_NO,
           A.manual_dn_dt AS RM_DT,
		   B.dept_alias AS Receiver_Alias,
		   LM.ALIAS AS SENDER_ALIAS
      FROM CNM01106   A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.CN_ID   ,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID 
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      LEFT  JOIN GST_STATE_MST ST2 (NOLOCK)  ON ST2.GST_STATE_CODE =A.PARTY_STATE_CODE 
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(lmp.registered_gst_dealer,0)
      LEFT JOIN (SELECT TOP 1 VALUE  FROM CONFIG WHERE CONFIG_OPTION=''GST_REPORT_FROM_RECEIPT_DT'') CNF ON 1=1
      WHERE A.CANCELLED =0 AND A.OTHER_CHARGES>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)>0 and a.mode=1           
      AND A.RECEIPT_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR





	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '29' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			
			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

			A.BIN_NAME ,
			VENDOR_BILL_DATE,
			A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
			 DISCOUNT_PERCENTAGE AS DISC_PCT,

			 0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
			 PROFIT_PERCENTAGE,
			 0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
			 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

			 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
			 RM_NO AS RM_NO,
			 RM_DT AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
	
       
       SELECT 
	       LM.AC_NAME AS SENDER_NAME,
           LMP.AC_GST_NO AS SENDER_GSTN_ID,
           A.PARTY_STATE_CODE AS SENDER_STATE_CODE,
           ST2.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''PARTY CREDIT NOTE'' AS SUB_TRANSACTION_TYPE,
           ''PARTY CREDIT NOTE'' AS TRANSACTION_TYPE, 

		   A.CN_NO AS SENDER_INVOICE_NO,          
           A.RECEIPT_DT  AS SENDER_INVOICE_DATE,
           A.FREIGHT_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.FREIGHT_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.CN_ID  ,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.FREIGHT_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.FREIGHT_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.FREIGHT_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           '''' AS REFERENCE_NUMBER,
           '''' AS REFERENCE_DATE,
           ( ISNULL(A.FREIGHT_TAXABLE_VALUE,0)+ ISNULL(FREIGHT_IGST_AMOUNT ,0)+ISNULL(FREIGHT_CGST_AMOUNT,0)+ISNULL(FREIGHT_SGST_AMOUNT,0)) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           ''FREIGHT'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE     ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           gr.REGISTERED_GST_NAMES  AS PARTY_REGISTRATION_STATUS,
           '''' AS MRR_NO ,
           '''' AS  MRR_DT ,
            CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
            A.CN_DT  AS  VENDOR_BILL_DATE,
             isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
            CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT,B.dept_alias ,
		   A.manual_dn_no AS RM_NO,
           A.manual_dn_dt AS RM_DT,
		   B.dept_alias AS Receiver_Alias,
		   LM.ALIAS AS SENDER_ALIAS
      FROM CNM01106   A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.CN_ID   ,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID 
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      LEFT  JOIN GST_STATE_MST ST2 (NOLOCK)  ON ST2.GST_STATE_CODE =A.PARTY_STATE_CODE
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(lmp.registered_gst_dealer,0)
      LEFT JOIN (SELECT TOP 1 VALUE  FROM CONFIG WHERE CONFIG_OPTION=''GST_REPORT_FROM_RECEIPT_DT'') CNF ON 1=1
      WHERE A.CANCELLED =0 AND A.FREIGHT>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.FREIGHT_TAXABLE_VALUE,0)>0  and a.mode=1       
      AND A.RECEIPT_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR





	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '30' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

		   A.BIN_NAME ,
		   VENDOR_BILL_DATE,
           A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
	     PROFIT_PERCENTAGE,
		 0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 RM_NO AS RM_NO,
         RM_DT AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
	
       
       SELECT 
	       LM.AC_NAME AS SENDER_NAME,
           LMP.AC_GST_NO AS SENDER_GSTN_ID,
           A.PARTY_STATE_CODE AS SENDER_STATE_CODE,
           ST2.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''PARTY CREDIT NOTE'' AS SUB_TRANSACTION_TYPE,
           ''PARTY CREDIT NOTE'' AS TRANSACTION_TYPE, 
		   A.CN_NO AS SENDER_INVOICE_NO,          
           A.RECEIPT_DT  AS SENDER_INVOICE_DATE,
           A.insurance_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.insurance_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.insurance_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.CN_ID  ,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.insurance_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.insurance_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.FREIGHT_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           '''' AS REFERENCE_NUMBER,
           '''' AS REFERENCE_DATE,
           ( ISNULL(A.insurance_TAXABLE_VALUE,0)+ ISNULL(insurance_IGST_AMOUNT ,0)+ISNULL(insurance_CGST_AMOUNT,0)+ISNULL(insurance_SGST_AMOUNT,0)) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           ''insurance'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE     ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           gr.REGISTERED_GST_NAMES AS  PARTY_REGISTRATION_STATUS,
           '''' AS MRR_NO ,
           '''' AS  MRR_DT ,
            CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
            A.CN_DT  AS  VENDOR_BILL_DATE,
             isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
            CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT,B.dept_alias ,
		   A.manual_dn_no AS RM_NO,
           A.manual_dn_dt AS RM_DT,
		    B.dept_alias AS Receiver_Alias,
			LM.ALIAS AS SENDER_ALIAS
      FROM CNM01106   A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.CN_ID   ,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID 
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      LEFT  JOIN GST_STATE_MST ST2 (NOLOCK)  ON ST2.GST_STATE_CODE =A.PARTY_STATE_CODE
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(lmp.registered_gst_dealer,0)
      LEFT JOIN (SELECT TOP 1 VALUE  FROM CONFIG WHERE CONFIG_OPTION=''GST_REPORT_FROM_RECEIPT_DT'') CNF ON 1=1
      WHERE A.CANCELLED =0 AND A.insurance>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.insurance_TAXABLE_VALUE,0)>0  and mode=1       
      AND A.RECEIPT_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR

--new

	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '31' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

			A.BIN_NAME ,
			VENDOR_BILL_DATE,
         A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
	     PROFIT_PERCENTAGE,
		 0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 RM_NO AS RM_NO,
         RM_DT AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
	     
       SELECT 
	       LM.AC_NAME AS SENDER_NAME,
           LMP.AC_GST_NO AS SENDER_GSTN_ID,
           A.PARTY_STATE_CODE AS SENDER_STATE_CODE,
           ST2.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''PARTY CREDIT NOTE'' AS SUB_TRANSACTION_TYPE,
           ''PARTY CREDIT NOTE'' AS TRANSACTION_TYPE, 
		   A.CN_NO AS SENDER_INVOICE_NO,
           A.RECEIPT_DT  AS SENDER_INVOICE_DATE,
           CND.HSN_CODE AS HSN_CODE ,
           CND.QUANTITY  AS QUANTITY,
           CND.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(CND.GST_PERCENTAGE ,0) AS GST_PERCENTAGE,
           LEFT(A.CN_ID  ,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           CND.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CND.SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           CND.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CND.INV_NO AS REFERENCE_NUMBER,
           CND.INV_DT AS REFERENCE_DATE,
           CND.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST,
           CAST('''' AS VARCHAR(10)) AS OH_TYPE,
           CND.PRODUCT_CODE    ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE ,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE           ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CND.ORDER_NO,
           CND.ONLINE_BILL_REF_NO,
           CND.BIN_ID AS BIN_ID,BIN.BIN_NAME ,
           gr.REGISTERED_GST_NAMES  AS PARTY_REGISTRATION_STATUS,
           '''' AS MRR_NO ,
           '''' AS  MRR_DT,
            CAST(CND.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF, 
            A.CN_DT  AS  VENDOR_BILL_DATE,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
            
            CAST(ROUND((ISNULL(cnd.CNMDISCOUNTAMOUNT,0)+ISNULL(cnd.DISCOUNT_AMOUNT,0))/NULLIF((cnd.rate*cnd.invoice_quantity),0)*100,2)  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           
           CAST(ISNULL(cnd.DISCOUNT_AMOUNT ,0)+ISNULL(cnd.cnmDISCOUNTAMOUNT ,0) AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(cnd.XN_VALUE_WITHOUT_GST -(SKU.PURCHASE_PRICE*cnd.QUANTITY) AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CND.CESS_AMOUNT,B.DEPT_ALIAS,
		   A.manual_dn_no AS RM_NO,
           A.manual_dn_dt AS RM_DT,
		   B.dept_alias AS Receiver_Alias,
		  LM.ALIAS AS SENDER_ALIAS
      FROM CNM01106   A (NOLOCK)
      JOIN CND01106 CND (NOLOCK) ON A.CN_ID =CND.CN_ID 
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.CN_ID   ,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      LEFT  JOIN GST_STATE_MST ST2 (NOLOCK)  ON ST2.GST_STATE_CODE =A.PARTY_STATE_CODE
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(lmp.registered_gst_dealer,0)
      LEFT JOIN (SELECT TOP 1 VALUE  FROM CONFIG WHERE CONFIG_OPTION=''GST_REPORT_FROM_RECEIPT_DT'') CNF ON 1=1
      JOIN SKU (NOLOCK) ON SKU.product_code =cnd.product_code
      WHERE A.CANCELLED =0  AND ISNULL(A.MEMO_TYPE,0) IN(0,1) and a.mode=1   
      AND A.RECEIPT_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR



	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '32' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

			A.BIN_NAME ,
			VENDOR_BILL_DATE,
			isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
         0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 RM_NO AS RM_NO,
         RM_DT AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
	
       SELECT 
	       SL.DEPT_NAME AS SENDER_NAME,
           SL.LOC_GST_NO AS SENDER_GSTN_ID,
           SL.GST_STATE_CODE AS SENDER_STATE_CODE,
           ST1.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''GROUP CREDIT NOTE'' AS SUB_TRANSACTION_TYPE,
           ''GROUP CREDIT NOTE'' AS TRANSACTION_TYPE,  
		   
		   A.CN_NO AS SENDER_INVOICE_NO,
           A.RECEIPT_DT  AS SENDER_INVOICE_DATE,
           A.OTHER_CHARGES_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.OTHER_CHARGES_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.CN_ID  ,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.OTHER_CHARGES_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.OTHER_CHARGES_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.OTHER_CHARGES_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           '''' AS REFERENCE_NUMBER,
           '''' AS REFERENCE_DATE,
           (ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)+ ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)+ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0)) AS TRANSACTION_VALUE_INCLUDING_GST,
           ''OTHER_CHARGES'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE    ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           gr.REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           '''' AS MRR_NO ,
           '''' AS  MRR_DT ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           A.CN_DT AS  VENDOR_BILL_DATE ,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT,b.dept_alias,
		   A.manual_dn_no AS RM_NO,
           A.manual_dn_dt AS RM_DT,
		   B.dept_alias AS Receiver_Alias,
		   SL.dept_alias AS SENDER_ALIAS
      FROM CNM01106   A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.CN_ID   ,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID 
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION SL (NOLOCK) ON SL.DEPT_ID =A.PARTY_DEPT_ID 
      LEFT  JOIN GST_STATE_MST ST1 (NOLOCK)  ON SL.GST_STATE_CODE =ST1.GST_STATE_CODE
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(b.registered_gst,0)
      LEFT JOIN (SELECT TOP 1 VALUE  FROM CONFIG WHERE CONFIG_OPTION=''GST_REPORT_FROM_RECEIPT_DT'') CNF ON 1=1
      WHERE A.CANCELLED =0 AND A.OTHER_CHARGES>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)>0   AND A.MODE=2         
      AND A.RECEIPT_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR



	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '33' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

			A.BIN_NAME ,
			VENDOR_BILL_DATE,
			isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
            DISCOUNT_PERCENTAGE AS DISC_PCT,

		    0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
			PROFIT_PERCENTAGE,
			0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
			0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

			A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
			RM_NO AS RM_NO,
			RM_DT AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
	
       
       SELECT 
	       SL.DEPT_NAME AS SENDER_NAME,
           SL.LOC_GST_NO AS SENDER_GSTN_ID,
           SL.GST_STATE_CODE AS SENDER_STATE_CODE,
           ST1.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''GROUP CREDIT NOTE'' AS SUB_TRANSACTION_TYPE,
           ''GROUP CREDIT NOTE'' AS TRANSACTION_TYPE,  
		   A.CN_NO AS SENDER_INVOICE_NO,          
           A.RECEIPT_DT  AS SENDER_INVOICE_DATE,
           A.FREIGHT_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.FREIGHT_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.CN_ID  ,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.FREIGHT_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.FREIGHT_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.FREIGHT_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           '''' AS REFERENCE_NUMBER,
           '''' AS REFERENCE_DATE,
           ( ISNULL(A.FREIGHT_TAXABLE_VALUE,0)+ ISNULL(FREIGHT_IGST_AMOUNT ,0)+ISNULL(FREIGHT_CGST_AMOUNT,0)+ISNULL(FREIGHT_SGST_AMOUNT,0)) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           ''FREIGHT'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE     ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           gr.REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           '''' AS MRR_NO ,
           '''' AS  MRR_DT ,
            CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
            A.CN_DT  AS  VENDOR_BILL_DATE,
             isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
            CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT,B.dept_alias ,
		   A.manual_dn_no AS RM_NO,
           A.manual_dn_dt AS RM_DT,
		   B.dept_alias AS Receiver_Alias,
		   SL.dept_alias AS SENDER_ALIAS
      FROM CNM01106   A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.CN_ID   ,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID 
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION SL (NOLOCK) ON SL.DEPT_ID =A.PARTY_DEPT_ID 
      LEFT  JOIN GST_STATE_MST ST1 (NOLOCK)  ON SL.GST_STATE_CODE =ST1.GST_STATE_CODE
	   LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(b.registered_gst,0)
      LEFT JOIN (SELECT TOP 1 VALUE  FROM CONFIG WHERE CONFIG_OPTION=''GST_REPORT_FROM_RECEIPT_DT'') CNF ON 1=1
      WHERE A.CANCELLED =0 AND A.FREIGHT>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.FREIGHT_TAXABLE_VALUE,0)>0   and a.mode=2      
      AND A.RECEIPT_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR



	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '34' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

		 A.BIN_NAME ,
		 VENDOR_BILL_DATE,
         A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
		 PROFIT_PERCENTAGE,
		 0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 RM_NO AS RM_NO,
         RM_DT AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
	
       
       SELECT 
	       SL.DEPT_NAME AS SENDER_NAME,
           SL.LOC_GST_NO AS SENDER_GSTN_ID,
           SL.GST_STATE_CODE AS SENDER_STATE_CODE,
           ST1.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''GROUP CREDIT NOTE'' AS SUB_TRANSACTION_TYPE,
           ''GROUP CREDIT NOTE'' AS TRANSACTION_TYPE, 
		   A.CN_NO AS SENDER_INVOICE_NO,          
           A.RECEIPT_DT  AS SENDER_INVOICE_DATE,
           A.insurance_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.insurance_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.insurance_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.CN_ID  ,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.insurance_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.insurance_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.FREIGHT_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           '''' AS REFERENCE_NUMBER,
           '''' AS REFERENCE_DATE,
           ( ISNULL(A.insurance_TAXABLE_VALUE,0)+ ISNULL(insurance_IGST_AMOUNT ,0)+ISNULL(insurance_CGST_AMOUNT,0)+ISNULL(insurance_SGST_AMOUNT,0)) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           ''insurance'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE     ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,BIN.BIN_NAME,
           gr.REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           '''' AS MRR_NO ,
           '''' AS  MRR_DT ,
            CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
            A.CN_DT  AS  VENDOR_BILL_DATE,
             isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
            CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT,B.dept_alias ,
		   A.manual_dn_no AS RM_NO,
           A.manual_dn_dt AS RM_DT,
		   B.dept_alias AS Receiver_Alias,
		   SL.dept_alias AS SENDER_ALIAS
      FROM CNM01106   A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.CN_ID   ,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID 
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION SL (NOLOCK) ON SL.DEPT_ID =A.PARTY_DEPT_ID 
      LEFT  JOIN GST_STATE_MST ST1 (NOLOCK)  ON SL.GST_STATE_CODE =ST1.GST_STATE_CODE
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
      left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(b.registered_gst,0)
      LEFT JOIN (SELECT TOP 1 VALUE  FROM CONFIG WHERE CONFIG_OPTION=''GST_REPORT_FROM_RECEIPT_DT'') CNF ON 1=1
      WHERE A.CANCELLED =0 AND A.insurance>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.insurance_TAXABLE_VALUE,0)>0 and mode=2        
      AND A.RECEIPT_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR

--new

	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '35' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

		   A.BIN_NAME ,
		   VENDOR_BILL_DATE,
		   A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
           DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
		 PROFIT_PERCENTAGE,
		 0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 RM_NO AS RM_NO,
         RM_DT AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
	     
       SELECT 
	       SL.DEPT_NAME AS SENDER_NAME,
           SL.LOC_GST_NO AS SENDER_GSTN_ID,
           SL.GST_STATE_CODE AS SENDER_STATE_CODE,
           ST1.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''GROUP CREDIT NOTE'' AS SUB_TRANSACTION_TYPE,
           ''GROUP CREDIT NOTE'' AS TRANSACTION_TYPE, 
		   A.CN_NO AS SENDER_INVOICE_NO,
           A.RECEIPT_DT  AS SENDER_INVOICE_DATE,
           CND.HSN_CODE AS HSN_CODE ,
           CND.QUANTITY  AS QUANTITY,
           CND.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(CND.GST_PERCENTAGE ,0) AS GST_PERCENTAGE,
           LEFT(A.CN_ID  ,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           CND.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CND.SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           CND.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CND.INV_NO AS REFERENCE_NUMBER,
           CND.INV_DT AS REFERENCE_DATE,
           CND.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST,
           CAST('''' AS VARCHAR(10)) AS OH_TYPE,
           CND.PRODUCT_CODE    ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE ,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE           ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CND.ORDER_NO,
           CND.ONLINE_BILL_REF_NO,
           CND.BIN_ID AS BIN_ID,BIN.BIN_NAME ,
           gr.REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
           '''' AS MRR_NO ,
           '''' AS  MRR_DT,
            CAST(CND.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF, 
            A.CN_DT  AS  VENDOR_BILL_DATE,
             isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           IT.XN_ITEM_TYPE_NAME as XN_ITEM_TYPE_NAME,
            
            CAST(ROUND((ISNULL(cnd.CNMDISCOUNTAMOUNT,0)+ISNULL(cnd.DISCOUNT_AMOUNT,0))/NULLIF((cnd.rate*cnd.invoice_quantity),0)*100,2)  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           
           CAST(ISNULL(cnd.DISCOUNT_AMOUNT ,0)+ISNULL(cnd.cnmDISCOUNTAMOUNT ,0) AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(cnd.XN_VALUE_WITHOUT_GST -(SKU.PURCHASE_PRICE*cnd.QUANTITY) AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CND.CESS_AMOUNT,B.DEPT_ALIAS,
		   A.manual_dn_no AS RM_NO,
           A.manual_dn_dt AS RM_DT,
		    B.dept_alias AS Receiver_Alias,
			SL.dept_alias AS SENDER_ALIAS
      FROM CNM01106   A (NOLOCK)
      JOIN CND01106 CND (NOLOCK) ON A.CN_ID =CND.CN_ID 
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.CN_ID   ,2)
	  LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION SL (NOLOCK) ON SL.DEPT_ID =A.PARTY_DEPT_ID 
      LEFT  JOIN GST_STATE_MST ST1 (NOLOCK)  ON SL.GST_STATE_CODE =ST1.GST_STATE_CODE
	  LEFT JOIN GST_XN_ITEM_TYPE IT (NOLOCK) ON IT.xn_item_type=ISNULL(A.XN_ITEM_TYPE,0)
      left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(b.registered_gst,0)
      LEFT JOIN (SELECT TOP 1 VALUE  FROM CONFIG WHERE CONFIG_OPTION=''GST_REPORT_FROM_RECEIPT_DT'') CNF ON 1=1
      JOIN SKU (NOLOCK) ON SKU.product_code =cnd.product_code
      WHERE A.CANCELLED =0  AND ISNULL(A.MEMO_TYPE,0) IN(0,1) and a.mode=2   
          
      AND A.RECEIPT_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR


	 --end of crdit note
	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '36' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,
			A.BIN_NAME ,
			VENDOR_BILL_DATE,
			 isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE ,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

		 0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
         0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		 CAST('''' AS VARCHAR(100)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
          SELECT LM.AC_NAME AS SENDER_NAME,
         LMP.AC_GST_NO  AS SENDER_GSTN_ID,
         A.PARTY_STATE_CODE  AS SENDER_STATE_CODE,
         PS.GST_STATE_NAME AS SENDER_STATE_NAME,
         B.DEPT_NAME   AS RECEIVER_NAME,
         B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
         B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
         ''BOOK INWARD SUPPLIERS''  AS SUB_TRANSACTION_TYPE,      
         ''BOOK INWARD SUPPLIERS'' AS TRANSACTION_TYPE,
         CAST(A.BILL_NO   AS VARCHAR(100)) AS SENDER_INVOICE_NO,
         A.bill_dt     AS SENDER_INVOICE_DATE,
         DET.HSN_CODE AS HSN_CODE ,
         DET.QUANTITY  AS QUANTITY,
         DET.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
         ISNULL(DET.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
         A.DEPT_ID AS LOCATION_ID,
         B.DEPT_NAME AS LOCATION_NAME,
         DET.CGST_AMOUNT AS CGST_AMOUNT,
         CAST(DET.SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
         DET.IGST_AMOUNT AS IGST_AMOUNT,
         CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
         CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
         CAST('''' AS DATETIME) AS REFERENCE_DATE,
         DET.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
         CAST('''' AS VARCHAR(10)) AS OH_TYPE,
         ''NA'' AS PRODUCT_CODE  ,
         A.TOTAL_AMOUNT  AS INVOICE_VALUE ,
         CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
         CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
         CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE          ,
         B.LOC_GST_NO ,
         CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
         CAST('''' AS VARCHAR(100)) AS ORDER_NO,
         CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
         ''000''   AS BIN_ID,''DEFAULT BIN'' AS BIN_NAME,
         REGISTERED_GST_NAMES AS PARTY_REGISTRATION_STATUS,
         '''' AS MRR_NO ,
         '''' AS  MRR_DT ,
          CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF, 
          A.BILL_DT AS  VENDOR_BILL_DATE,
		  1 as XN_ITEM_TYPE,
          ''INVENTORY'' as XN_ITEM_TYPE_Name,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT,B.dept_alias,
		    B.dept_alias AS Receiver_Alias,
			LM.ALIAS AS SENDER_ALIAS 
 FROM SUPPLY_EXPENSE_XN_MST  A (NOLOCK)
 JOIN SUPPLY_EXPENSE_XN_DET DET (NOLOCK) ON A.MEMO_ID  =DET.MEMO_ID  
 JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =A.DEPT_ID 
 JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
 JOIN GST_STATE_MST PS (NOLOCK)  ON PS.GST_STATE_CODE =A.PARTY_STATE_CODE 
 JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
 JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
 left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(lmp.registered_gst_dealer,0)
 WHERE A.CANCELLED =0 
 AND A.BILL_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR



	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '37' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

           A.BIN_NAME ,
           VENDOR_BILL_DATE,
          A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
         0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		  CAST('''' AS VARCHAR(100)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
        
 SELECT LM.AC_NAME AS SENDER_NAME,
         LMP.AC_GST_NO  AS SENDER_GSTN_ID,
         LMP.AC_GST_STATE_CODE AS SENDER_STATE_CODE,
         C.GST_STATE_NAME AS SENDER_STATE_NAME,
         B.DEPT_NAME   AS RECEIVER_NAME,
         B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
         B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,     
         ''REVERSE CHARGES'' AS SUB_TRANSACTION_TYPE,      
         ''REVERSE CHARGES'' AS TRANSACTION_TYPE,
         A.MEMO_NO AS SENDER_INVOICE_NO,
         A.MEMO_DT  AS SENDER_INVOICE_DATE,
         A.OTHER_CHARGES_HSN_CODE AS HSN_CODE ,
         CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
         ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
         ISNULL(A.OTHER_CHARGES_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
         LEFT(A.MEMO_ID   ,2) AS LOCATION_ID,
         B.DEPT_NAME AS LOCATION_NAME,
         A.OTHER_CHARGES_CGST_AMOUNT AS CGST_AMOUNT,
         CAST(A.OTHER_CHARGES_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
         A.OTHER_CHARGES_IGST_AMOUNT AS IGST_AMOUNT,
         CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
         CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
         CAST('''' AS DATETIME) AS REFERENCE_DATE,
         ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)+ ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)+ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
         ''OTHER_CHARGES'' AS OH_TYPE,
         CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
         A.TOTAL_REVERSE_CHARGES  AS INVOICE_VALUE,
         CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
         CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
         CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE   ,
         B.LOC_GST_NO ,
         CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
         CAST('''' AS VARCHAR(100)) AS ORDER_NO,
         CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
         ''000''   AS BIN_ID, ''DEFAULT BIN'' AS BIN_NAME,
         gr.REGISTERED_GST_NAMES PARTY_REGISTRATION_STATUS,
         '''' AS MRR_NO ,
         '''' AS  MRR_DT ,
          CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
          CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE  ,
		   1 as XN_ITEM_TYPE,
          ''INVENTORY'' as XN_ITEM_TYPE_name ,
          CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT,B.DEPT_ALIAS,
		    B.dept_alias AS Receiver_Alias,
			LM.ALIAS AS SENDER_Alias
      FROM RCM01106   A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.MEMO_ID   ,2)
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(lmp.registered_gst_dealer,0)
      WHERE A.CANCELLED =0 AND A.OTHER_CHARGES>0 
      AND ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)>0
     AND A.MEMO_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR


	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '38' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

			A.BIN_NAME ,
			VENDOR_BILL_DATE,
			A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
         0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		  CAST('''' AS VARCHAR(100)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
        
   	   	   	      
      SELECT LM.AC_NAME AS SENDER_NAME,
            LMP.AC_GST_NO AS SENDER_GSTN_ID,
            PS.GST_STATE_CODE  AS SENDER_STATE_CODE,
            PS.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''REVERSE CHARGES'' AS SUB_TRANSACTION_TYPE,      
           ''REVERSE CHARGES'' AS TRANSACTION_TYPE,
           A.MEMO_NO  AS SENDER_INVOICE_NO,
           A.MEMO_DT  AS SENDER_INVOICE_DATE,
           A.FREIGHT_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.FREIGHT_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.MEMO_ID   ,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.FREIGHT_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(A.FREIGHT_SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.FREIGHT_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(A.FREIGHT_SGST_AMOUNT AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)+ ISNULL(FREIGHT_IGST_AMOUNT ,0)+ISNULL(FREIGHT_CGST_AMOUNT,0)+ISNULL(FREIGHT_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           ''FREIGHT'' AS OH_TYPE,
           CAST(''NA'' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.TOTAL_REVERSE_CHARGES  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE   ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           ''000''   AS BIN_ID,''DEFAULT BIN'' AS BIN_NAME,
          gr.REGISTERED_GST_NAMES  PARTY_REGISTRATION_STATUS,
         '''' AS MRR_NO ,
         '''' AS  MRR_DT ,
          CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
          CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE  ,
		  1 as XN_ITEM_TYPE,
          ''INVENTORY'' as XN_ITEM_TYPE_name  ,
          CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
          CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
          CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
          CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
          0 AS CESS_AMOUNT,B.dept_alias,
		  B.dept_alias AS Receiver_Alias,
		  LM.ALIAS AS SENDER_Alias
      FROM RCM01106   A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.MEMO_ID   ,2)
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(lmp.registered_gst_dealer,0)
      LEFT OUTER JOIN
      (
       SELECT DISTINCT RCM_MEMO_ID  ,B.PARTY_STATE_CODE 
       FROM RCM_PUR_EXPENSE A
       JOIN PIM01106 B ON A.MEMO_ID =B.MRR_ID 
       WHERE B.CANCELLED =0 AND A.XN_TYPE =''PUR''
      )P ON P.RCM_MEMO_ID =A.MEMO_ID  
       JOIN GST_STATE_MST PS (NOLOCK)  ON P.PARTY_STATE_CODE =PS.GST_STATE_CODE
      WHERE A.CANCELLED =0  AND A.FREIGHT>0 
      AND ISNULL(A.FREIGHT_TAXABLE_VALUE,0)>0
      AND A.MEMO_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR


	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '39' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

			A.BIN_NAME ,
			VENDOR_BILL_DATE,
			A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
           DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
         0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		  CAST('''' AS VARCHAR(100)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
        
   	   	   	      
      	   SELECT LM.AC_NAME AS SENDER_NAME,
           LMP.AC_GST_NO AS SENDER_GSTN_ID,
           PS.GST_STATE_CODE  AS SENDER_STATE_CODE,
           PS.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''REVERSE CHARGES'' AS SUB_TRANSACTION_TYPE,      
           ''REVERSE CHARGES'' AS TRANSACTION_TYPE,
           A.MEMO_NO  AS SENDER_INVOICE_NO,
           A.MEMO_DT  AS SENDER_INVOICE_DATE,
           RCD.HSN_CODE AS HSN_CODE ,
           RCD.QUANTITY  AS QUANTITY,
           RCD.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(RCD.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           LEFT(A.MEMO_ID   ,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           RCD.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(RCD.SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           RCD.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           RCD.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
           CAST('''' AS VARCHAR(10)) AS OH_TYPE,
           ''NA'' AS PRODUCT_CODE  ,
           A.TOTAL_REVERSE_CHARGES  AS INVOICE_VALUE ,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE          ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           ''000''   AS BIN_ID,''DEFAULT BIN'' AS BIN_NAME,
           gr.REGISTERED_GST_NAMES PARTY_REGISTRATION_STATUS,
          '''' AS MRR_NO ,
          '''' AS  MRR_DT ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
          CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
		  1 as XN_ITEM_TYPE,
          ''INVENTORY'' as XN_ITEM_TYPE_name,
          CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
          CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
          CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
          CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT ,
          0 AS CESS_AMOUNT,B.dept_alias,
		   B.dept_alias AS Receiver_Alias,
		   LM.ALIAS AS SENDER_Alias
      FROM RCM01106  A (NOLOCK)
      JOIN RCD01106 RCD (NOLOCK) ON A.MEMO_ID  =RCD.MEMO_ID  
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.MEMO_ID  ,2)
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(lmp.registered_gst_dealer,0)
      LEFT OUTER JOIN
      (
       SELECT DISTINCT RCM_MEMO_ID  ,B.PARTY_STATE_CODE 
       FROM RCM_PUR_EXPENSE A
       JOIN PIM01106 B ON A.MEMO_ID =B.MRR_ID 
       WHERE B.CANCELLED =0 AND A.XN_TYPE =''PUR''
      )P ON P.RCM_MEMO_ID =A.MEMO_ID  
       JOIN GST_STATE_MST PS (NOLOCK)  ON P.PARTY_STATE_CODE =PS.GST_STATE_CODE
      WHERE A.CANCELLED =0 

      AND A.MEMO_DT BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR


	
	INSERT XTREME_REPORTING_EXP_GSTREPS	(MASTER_COL,BASE_EXPR)  
	SELECT '40' AS MASTER_COL,' 
	SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE +'' '' +A.XN_ITEM_TYPE_NAME AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,A.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,

			0 AS QUANTITY_OW,QUANTITY AS  QUANTITY_IW,
			0 AS TAXABLE_VALUE_OW,TAXABLE_VALUE AS  TAXABLE_VALUE_IW,
			0 AS CGST_AMOUNT_OW,CGST_AMOUNT AS    CGST_AMOUNT_IW,
			0 AS  SGST_AMOUNT_OW,SGST_AMOUNT AS    SGST_AMOUNT_IW,
			0 AS  IGST_AMOUNT_OW,IGST_AMOUNT AS    IGST_AMOUNT_IW,
			0 AS UTGST_AMOUNT_OW,UTGST_AMOUNT AS   UTGST_AMOUNT_IW,
			0 AS TRANSACTION_VALUE_INCLUDING_GST_OW,TRANSACTION_VALUE_INCLUDING_GST AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			0 AS TAX_ROUND_OFF_OW,TAX_ROUND_OFF AS   TAX_ROUND_OFF_IW,
			0 AS VAT_AMOUNT_OW,VAT_AMOUNT AS  VAT_AMOUNT_IW,

           A.BIN_NAME ,
           VENDOR_BILL_DATE,
           A.XN_ITEM_TYPE AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,

         0 AS DISC_AMT_OW,DISCOUNT_AMOUNT AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
         0 AS PROFIT_AMOUNT_OW,PROFIT_AMOUNT AS  PROFIT_AMOUNT_IW,
		 0 AS CESS_AMOUNT_OW,CESS_AMOUNT AS  CESS_AMOUNT_IW,

		 A.dept_alias AS LOCATION_ALIAS ,@@SPID  AS SP_ID,
		  CAST('''' AS VARCHAR(100)) AS RM_NO,
         CAST('''' AS DATETIME) AS RM_DT,Receiver_Alias,SENDER_ALIAS
		 
         
    FROM 
    (
          	   	   	      
               
      SELECT LM.AC_NAME AS SENDER_NAME,
           LMP.AC_GST_NO AS SENDER_GSTN_ID,
           PS.GST_STATE_CODE  AS SENDER_STATE_CODE,
           PS.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           ''JOBWORK RECEIVE'' AS SUB_TRANSACTION_TYPE,      
           ''JOBWORK RECEIVE'' AS TRANSACTION_TYPE,
           A.receipt_no   AS SENDER_INVOICE_NO,
           A.challan_dt    AS SENDER_INVOICE_DATE,
           REC.HSN_CODE AS HSN_CODE ,
           REC.QUANTITY  AS QUANTITY,
           REC.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(REC.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           LEFT(A.RECEIPT_ID   ,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           REC.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(REC.SGST_AMOUNT AS NUMERIC(12,2)) AS SGST_AMOUNT,
           REC.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(0 AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('''' AS DATETIME) AS REFERENCE_DATE,
           REC.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
           CAST('''' AS VARCHAR(10)) AS OH_TYPE,
           REC.PRODUCT_CODE AS PRODUCT_CODE  ,
           A.net_amount  AS INVOICE_VALUE ,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST('''' AS VARCHAR(100)) AS TRANSACTION_MODE          ,
           B.LOC_GST_NO ,
           CAST(''INWARD'' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('''' AS VARCHAR(100)) AS ORDER_NO,
           CAST('''' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           ''000''   AS BIN_ID,''DEFAULT BIN'' AS BIN_NAME,
           gr.REGISTERED_GST_NAMES PARTY_REGISTRATION_STATUS,
          '''' AS MRR_NO ,
          '''' AS  MRR_DT ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
          CAST('''' AS DATETIME) AS  VENDOR_BILL_DATE,
		   1 XN_ITEM_TYPE,
          ''INVENTORY'' as XN_ITEM_TYPE_name ,
          CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
          CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
          CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
          CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT   ,
          REC.CESS_AMOUNT ,B.dept_alias,
		   B.dept_alias AS Receiver_Alias,
		   LM.ALIAS AS SENDER_Alias
     FROM JOBWORK_RECEIPT_MST A (NOLOCK)
     JOIN JOBWORK_RECEIPT_DET REC (NOLOCK) ON A.receipt_id   =REC.receipt_id 
     JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =LEFT (A.receipt_id   ,2)
     JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
     JOIN PRD_AGENCY_MST AM (NOLOCK) ON AM.agency_code =A.agency_code 
     JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =AM.AC_CODE 
     JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
     JOIN GST_STATE_MST PS (NOLOCK)  ON A.PARTY_STATE_CODE =PS.GST_STATE_CODE
	 left join GST_REGISTERED gr (nolock) on gr.REGISTERED_GST=isnull(lmp.registered_gst_dealer,0)
     WHERE A.CANCELLED =0 AND ISNULL(A.BILL_CHALLAN_MODE,0)=0
      AND A.challan_dt BETWEEN [FRMODDT] and [TODT] AND [CWHERE]
	) A' AS BASE_EXPR

END
--new