CREATE PROCEDURE [DBO].[SAVETRAN_PARA3]   
(  
 @PARA3_CODE    VARCHAR(9) = '',  
 @PARA3_NAME    VARCHAR(300)='',  
 @ALIAS       VARCHAR(50) = '',  
 @INACTIVE      BIT = 0,       
 @REMARKS      VARCHAR(500) = '',  
 @ERRMSG_OUT    VARCHAR(MAX) OUT,
 @BDELETE BIT=0
)  
AS  
BEGIN  
 DECLARE @CSTEP INT ,@CERRMSG VARCHAR(1000) 
 DECLARE @TEMP_PARA3_CODE VARCHAR(9) = ''  
   
 BEGIN TRY 
 BEGIN TRANSACTION 
 SET @ERRMSG_OUT = ''  
 SET @CERRMSG=''
 SET @CSTEP=0
 
  
  IF @BDELETE=1
	BEGIN
		 IF @PARA3_CODE='0000000'
	   BEGIN
		   SET @CERRMSG='DEFAULT PARA3 CAN NOT BE DELETED'
		   GOTO END_PROC
	   END
	   DELETE FROM PARA3 WHERE PARA3_CODE =@PARA3_CODE
	   GOTO END_PROC
	END	
	
	  
  IF (RTRIM(LTRIM(@PARA3_CODE)) = '')  
  BEGIN  
   IF EXISTS(SELECT [PARA3_NAME] FROM [PARA3] WHERE [PARA3_NAME] = @PARA3_NAME)  
   BEGIN  
    SET @CSTEP=5  
    SET @ERRMSG_OUT = 'PARA3 NAME: '+@PARA3_NAME + ' ALREADY EXIST.'  
    PRINT @ERRMSG_OUT  
    SET @CERRMSG=@ERRMSG_OUT
   END  
   ELSE  
   BEGIN  
    SET @CSTEP=10  
    EXEC DBO.GETNEXTKEY 'PARA3', 'PARA3_CODE', 7, '00', 1, '', 2, @TEMP_PARA3_CODE OUTPUT   
      
    PRINT 'PARA3 CODE: ' + @TEMP_PARA3_CODE  
      
    SET @CSTEP=15  
    INSERT PARA3 (PARA3_CODE, PARA3_NAME, LAST_UPDATE, ALIAS, INACTIVE, REMARKS, LAST_MODIFIED_ON)  
    VALUES (@TEMP_PARA3_CODE, @PARA3_NAME, GETDATE(), @ALIAS, @INACTIVE, @REMARKS, GETDATE())  
      
    SET @ERRMSG_OUT = 'PARA3: '+ @PARA3_NAME +' CREATED SUCCESSFULLY.'  
    PRINT @ERRMSG_OUT  
   END  
  END  
  ELSE  
  BEGIN  
   SET @TEMP_PARA3_CODE = @PARA3_CODE  
   IF NOT EXISTS(SELECT [PARA3_CODE] FROM [PARA3] WHERE [PARA3_CODE] = @PARA3_CODE)  
   BEGIN  
    IF EXISTS(SELECT [PARA3_NAME] FROM [PARA3] WHERE [PARA3_NAME] = @PARA3_NAME)  
    BEGIN  
     SET @CSTEP=20  
     SET @ERRMSG_OUT = 'PARA3 NAME: '+@PARA3_NAME + ' ALREADY EXIST.'  
     PRINT @ERRMSG_OUT  
     SET @CERRMSG=@ERRMSG_OUT
    END  
    ELSE  
    BEGIN  
     SET @CSTEP=25  
     EXEC DBO.GETNEXTKEY 'PARA3', 'PARA3_CODE', 7, '00', 1, '', 2, @TEMP_PARA3_CODE OUTPUT   
       
     PRINT 'PARA3 CODE: ' + @TEMP_PARA3_CODE  
       
     SET @CSTEP=30  
     INSERT PARA3 (PARA3_CODE, PARA3_NAME, LAST_UPDATE, ALIAS, INACTIVE, REMARKS, LAST_MODIFIED_ON)  
     VALUES (@TEMP_PARA3_CODE, @PARA3_NAME, GETDATE(), @ALIAS, @INACTIVE, @REMARKS, GETDATE())  
       
     SET @ERRMSG_OUT = 'PARA3: '+ @PARA3_NAME +' CREATED SUCCESSFULLY.'  
     PRINT @ERRMSG_OUT  
    END  
   END  
   ELSE  
   BEGIN  
    SET @CSTEP=35  
    PRINT 'PARA3 CODE: ' + @TEMP_PARA3_CODE  
   IF EXISTS(SELECT [PARA3_NAME] FROM [PARA3] WHERE [PARA3_NAME] = @PARA3_NAME AND PARA3_CODE <> @TEMP_PARA3_CODE)
	BEGIN
		SET @CSTEP=20
		SET @ERRMSG_OUT = 'PARA3 NAME: '+@PARA3_NAME + ' ALREADY EXIST.'
		SET @CERRMSG=@ERRMSG_OUT
	END
	ELSE
	BEGIN		  
    UPDATE [PARA3]  
    SET [PARA3_NAME] = @PARA3_NAME,   
      LAST_UPDATE = GETDATE(),   
      ALIAS = @ALIAS,   
      INACTIVE = @INACTIVE,   
      REMARKS = @REMARKS,   
      LAST_MODIFIED_ON = GETDATE()  
     WHERE PARA3_CODE = @TEMP_PARA3_CODE  
      
    SET @ERRMSG_OUT = 'PARA3: '+ @PARA3_NAME +' UPDTED SUCCESSFULLY.'  
    PRINT @ERRMSG_OUT  
   END 
   END 
  END  
END TRY  
BEGIN CATCH  
	SET @ERRMSG_OUT='ERROR: [P]: SAVETRAN_PARA1, [STEP]: '+CAST(@CSTEP AS VARCHAR(5))+', [MESSAGE]: ' + ERROR_MESSAGE()
	PRINT @ERRMSG_OUT
	SET @CERRMSG=@ERRMSG_OUT	
	GOTO END_PROC  
END CATCH   

END_PROC:

	IF @@TRANCOUNT>0
	BEGIN
		IF ISNULL( @CERRMSG,'')='' 
			COMMIT TRANSACTION
		ELSE
			ROLLBACK
	END

	SELECT @CERRMSG AS ERRMSG
   
END
