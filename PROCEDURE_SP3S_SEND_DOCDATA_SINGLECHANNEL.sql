create PROCEDURE SP3S_SEND_DOCDATA_SINGLECHANNEL
@CXNTYPEPARA VARCHAR(20)='',
@CREQXNID VARCHAR(50)='',
@CTARGETLOCID VARCHAR(5)='',
@BACKNOWLEDGE BIT=0,
@nDocAPIMode INT=0,
@CREQCHALLANNO VARCHAR(20)='',
@CREQCHALLANFINYEAR VARCHAR(20)='',
@cLastIRRSynchUpdate VARCHAR(30)='',
@cAcklastUpdate VARCHAR(30)=''
AS
BEGIN	
		DECLARE @TXNSSENDINFO TABLE (ORG_TABLENAME VARCHAR(500),TMP_TABLENAME VARCHAR(500),XN_ID VARCHAR(100),
									 PICK_FROM_CURRENT_DB BIT,SP_ID INT) 
		
		DECLARE @CXNTYPE VARCHAR(50),@CPROC_NAME VARCHAR(200),@cErrormsg VARCHAR(1000),@NSEND_ORD NUMERIC(4)
		   ,@BEXISTS BIT,@DTSQL NVARCHAR(MAX),@CSTEP VARCHAR(5),@NMAX_ORD NUMERIC(4),@CORGXN_TYPE VARCHAR(10)
		   ,@CARCT VARCHAR(10),@CCURLOCID VARCHAR(5),@BSENDCHALLANTHRUMIRROR BIT,@CHOLOCID VARCHAR(5),@BLOOP BIT
		   ,@CAPPLYNEWDOCMETHOD VARCHAR(2),@BSENDOFFLINE BIT,@BTEMPTABLEDB BIT,@dAcklastUpdate DATETIME
	
BEGIN TRY
		SET @cStep=5
		
		SELECT TOP 1 @CCURLOCID = [VALUE] FROM CONFIG (NOLOCK) WHERE CONFIG_OPTION='LOCATION_ID'
		SELECT TOP 1 @CHOLOCID = [VALUE] FROM CONFIG (NOLOCK) WHERE CONFIG_OPTION='HO_LOCATION_ID'
		
		SET @CSTEP = 10
		IF @CCURLOCID<>@CHOLOCID
		BEGIN
			SET @cErrormsg='DOC SENDING VIA MIRRORSERVICE CAN ONLY BE DONE FROM HEAD OFFICE....'
			GOTO EXIT_PROC
		END 

		IF @BACKNOWLEDGE=1
		BEGIN
			SET @CSTEP = 15
			EXEC SP3S_ACKNOWLEDGE_DOC_MERGING 
			@CXNTYPEPARA=@CXNTYPEPARA,
			@CREQXNID=@CREQXNID,
			@cAcklastUpdate=@cAcklastUpdate,
			@cErrormsg=@cErrormsg OUTPUT

			GOTO EXIT_PROC
		END
		ELSE
		IF @CREQCHALLANNO='' AND @CREQXNID=''
		BEGIN
			SET @CSTEP = 20
			EXEC SP3S_DATASENDING_GETDOC_MEMO
			@cTargetLocId=@CTARGETLOCID,
			@cLastIRRSynchUpdate=@cLastIRRSynchUpdate,
			@nDocAPIMode=@nDocAPIMode,
			@cXnType=@cXnType OUTPUT,
			@cReqXnId=@cReqXnId OUTPUT,
			@dAcklastUpdate=@dAcklastUpdate OUTPUT,
			@cErrormsg=@cErrormsg OUTPUT

			IF @cErrormsg='' AND @cREqXnId<>''
				SELECT @cXntype as xn_type,@cReqXnId as memo_id,CONVERT(VARCHAR,@dAcklastUpdate,120) as last_update
		    ELSE
				GOTO EXIT_PROC
		END
		ELSE
		BEGIN
			SET @CXNTYPE=@CXNTYPEPARA
		END
		SELECT @BSENDOFFLINE=0,@BTEMPTABLEDB=0

		SET @CSTEP = 30
		DECLARE @TSENDORDER TABLE (XN_TYPE VARCHAR(20),SEND_ORDER NUMERIC(4))		

		
			
		SET @CSTEP=100
		IF @CXNTYPE='DOCWSL'
			SET @DTSQL='EXEC SP_SEND_MIRROR_DOCWSL_OPT_DATA_NEW '''+@CREQXNID+''','''+@CTARGETLOCID+''','+
			+''''+@CREQCHALLANNO+''','''+@CREQCHALLANFINYEAR+''','+STR(@BACKNOWLEDGE)+',1,@cErrormsg OUTPUT'    
		ELSE			
		IF @CXNTYPE='DOCPRT'
			SET @DTSQL='EXEC SP_SEND_MIRROR_DOCPRT_OPT_DATA_NEW '''+@CREQXNID+''','''+@CTARGETLOCID+''','+''''+@CREQCHALLANNO+''','''+@CREQCHALLANFINYEAR+''','+STR(@BACKNOWLEDGE)+',@cErrormsg OUTPUT'        
		ELSE
		IF @CXNTYPE='DOCGV'	
			SET @DTSQL='EXEC SP_SEND_MIRROR_DOCGV_DATA_OPT  '''+@CREQXNID+''','''+@CTARGETLOCID+''',@cErrormsg OUTPUT'    
		ELSE	
		IF @CXNTYPE='DOCIRT' 
			SET @DTSQL='EXEC SP_SEND_MIRROR_DOCIRT_OPT_DATA_NEW  '''+@CREQXNID+''','''+@CTARGETLOCID+''','+STR(@BACKNOWLEDGE)+',1,@cErrormsg OUTPUT'    
		ELSE			
		IF @CXNTYPE='DOCPCO'	
			SET @DTSQL='EXEC SP_SEND_MIRROR_DOCPCO_DATA_OPT  '''+@CREQXNID+''','''+@CTARGETLOCID+''',@cErrormsg OUTPUT'    
		ELSE	
		IF @CXNTYPE='DOCPO'	
		   SET @DTSQL='EXEC SP_SEND_MIRROR_DOCPO_OPT_DATA_NEW '''+@CREQXNID+''','''+@CTARGETLOCID+''','+''''+@CREQCHALLANNO+''','''+@CREQCHALLANFINYEAR+''','+STR(@BACKNOWLEDGE)+',@cErrormsg OUTPUT'        
		ELSE	
		IF @CXNTYPE='DOCPUR'	
			SET @DTSQL='EXEC SP_SEND_MIRROR_DOCPUR_DATA_OPT  '''+@CREQXNID+''','''+@CTARGETLOCID+''',@cErrormsg OUTPUT'     					
		ELSE	
		IF @CXNTYPE='DOCMRP'	
			SET @DTSQL='EXEC SP_SEND_MIRROR_DOCMRP_DATA_OPT  '''+@CTARGETLOCID+''',@cErrormsg OUTPUT'   
		ELSE	
		IF @CXNTYPE='DOCASN'	
			 SET @DTSQL='EXEC SP_SEND_MIRROR_DOCASN_OPT_DATA_NEW '''+@CREQXNID+''','''+@CTARGETLOCID+''','+''''+@CREQCHALLANNO+''','''+@CREQCHALLANFINYEAR+''','+STR(@BACKNOWLEDGE)+',@cErrormsg OUTPUT'        
		ELSE	
		IF @CXNTYPE='DOCWBO'	
			 SET @DTSQL='EXEC SP_SEND_MIRROR_DOCWBO_OPT_DATA_NEW '''+@CREQXNID+''','''+@CTARGETLOCID+''','+''''+@CREQCHALLANNO+''','''+@CREQCHALLANFINYEAR+''','+STR(@BACKNOWLEDGE)+',@cErrormsg OUTPUT'        
		ELSE	
		IF @CXNTYPE='DOCDNPF'	
			 SET @DTSQL='EXEC SP_SEND_MIRROR_DOCDNPF_DATA  '''+@CREQXNID+''','''+@CTARGETLOCID+''',@cErrormsg OUTPUT'   
		
		
		PRINT 'PROCESS DOC TYPE :'+@CXNTYPE	
		PRINT @DTSQL

		SET @CSTEP=105
		
		EXEC SP_EXECUTESQL @DTSQL,N'@cErrormsg VARCHAR(1000) OUTPUT',@cErrormsg OUTPUT	


END TRY
BEGIN CATCH
	PRINT 'ENTER CATCH BLOCK'
	SET @cErrormsg='P:SP3S_SEND_DOCDATA_SINGLECHANNEL,('+ISNULL(@CXNTYPE,'')+')'+' STEP: '+@CSTEP+',MESSAGE:'+ERROR_MESSAGE()
END CATCH	 

EXIT_PROC:
	PRINT 'UPDATE NULL VALUE OF PICK_FROM_CURRENT_DB'

	SELECT ISNULL(@cErrormsg,'') AS ERRMSG
END
