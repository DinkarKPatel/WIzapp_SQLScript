CREATE PROCEDURE SP3SCHECKSHIFTSTATUS
(
	@CSHIFT_ID VARCHAR(15),
	@CUSER_CODE VARCHAR(10)=''
)
--WITH ENCRYPTION
AS
BEGIN
	DECLARE @CERRMSGOUT VARCHAR(500),@CHKUSERCODE VARCHAR(10),@NVALUE VARCHAR(10)
    
	SELECT @NVALUE=VALUE  FROM USER_ROLE_DET A
	JOIN USERS B ON A.ROLE_ID=B.ROLE_ID
	WHERE A.FORM_OPTION='ALLOW_TO_MODIFY_MEMO_OF_CLOSE_TILLS'
	AND FORM_NAME ='FRMSALE'
	AND B.USER_CODE=@CUSER_CODE 

IF ISNULL(@NVALUE,'')<>'1'
BEGIN
	IF NOT EXISTS(SELECT TOP 1 'U' FROM TILL_SHIFT_MST WHERE SHIFT_ID=@CSHIFT_ID AND ISNULL(CLOSE_DATE,'')='') 
	BEGIN
		SET @CERRMSGOUT='SHIFT IS NOT OPEN FOR THE TILL.TRANSACTION CANCELLED.'
	END
END
	SELECT ISNULL(@CERRMSGOUT,'') AS ERRMSG
END
--END OF PROCEDURE - SP3SCHECKSHIFTSTATUS
