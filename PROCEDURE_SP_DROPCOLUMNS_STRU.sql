CREATE PROCEDURE SP_DROPCOLUMNS_STRU
--WITH ENCRYPTION
AS
BEGIN

						
	DECLARE @TDROPCOLINFO  TABLE (TABLENAME VARCHAR(200),COLNAME VARCHAR(200))

	INSERT @TDROPCOLINFO 
	SELECT 'CNM01106','BILL_LEVEL_TAX'
	UNION
	SELECT 'CNM01106','BILL_LEVEL_TAX_METHOD'
	UNION
	SELECT 'CNM01106','CUSTOM_DUTY_MARK_DOWN_PCT'
	UNION
	SELECT 'CNM01106','DEPT_ID'
	UNION
	SELECT 'CNM01106','DISCOUNT_PER_PCS'
	UNION
	SELECT 'CNM01106','EXCISE_ACCESSIBLE_AMOUNT'
	UNION
	SELECT 'CNM01106','EXCISE_ACCESSIBLE_PERCENTAGE'
	UNION
	SELECT 'CNM01106','EXCISE_DUTY_AMOUNT'
	UNION
	SELECT 'CNM01106','EXCISE_DUTY_PERCENTAGE'
	UNION
	SELECT 'CNM01106','EXCISE_EDU_CESS_AMOUNT'
	UNION
	SELECT 'CNM01106','EXCISE_EDU_CESS_PERCENTAGE'
	UNION
	SELECT 'CNM01106','EXCISE_HEDU_CESS_AMOUNT'
	UNION
	SELECT 'CNM01106','EXCISE_HEDU_CESS_PERCENTAGE'
	UNION
	SELECT 'CNM01106','EXCISE_INVOICE'
	UNION
	SELECT 'CNM01106','FORM_ID'
	UNION
	SELECT 'CNM01106','LOCAL_SALES'
	UNION
	SELECT 'CNM01106','OLD_CN_ID'
	UNION
	SELECT 'CNM01106','RATE_DIFF'
	UNION
	SELECT 'CNM01106','ROUTE_FORM1'
	UNION
	SELECT 'CNM01106','ROUTE_FORM2'
	UNION
	SELECT 'CNM01106','SENT_BY'
	UNION
	SELECT 'CNM01106','TAX_AMOUNT'
	UNION
	SELECT 'CNM01106','TAX_PERCENTAGE'
	UNION
	SELECT 'CNM01106','UPLOADED_TO_ACTIVSTREAM'
	UNION
	SELECT 'CND01106','FIN_YEAR'
	UNION
	SELECT 'CND01106','OH_AMOUNT'
	UNION
	SELECT 'CND01106','OLD_CN_ID'
	UNION
	SELECT 'PIM01106','FORM_ID'

	INSERT STRUCOMP_SQLEXPR (TABLENAME,COLNAME)
	SELECT TABLENAME ,COLNAME FROM @TDROPCOLINFO
	
	DECLARE @CTABLENAME VARCHAR(200),@CCOLNAME VARCHAR(200),@CCMD NVARCHAR(MAX)

	DECLARE TDROPCOLCUR CURSOR FOR SELECT D.TABLENAME,D.COLNAME
	FROM SYSCOLUMNS A (NOLOCK) 
	JOIN SYSOBJECTS B (NOLOCK) ON B.ID=A.ID
	JOIN @TDROPCOLINFO D ON D.TABLENAME=B.NAME AND D.COLNAME=A.NAME

	OPEN TDROPCOLCUR

	FETCH NEXT FROM  TDROPCOLCUR INTO @CTABLENAME,@CCOLNAME
	WHILE @@FETCH_STATUS=0
	BEGIN
		SET @CCMD=N'ALTER TABLE '+@CTABLENAME+' DROP COLUMN '+@CCOLNAME
		PRINT @CCMD
		EXEC SP_EXECUTESQL @CCMD	
		
		FETCH NEXT FROM  TDROPCOLCUR INTO @CTABLENAME,@CCOLNAME
	END

	CLOSE TDROPCOLCUR
	DEALLOCATE TDROPCOLCUR

END
