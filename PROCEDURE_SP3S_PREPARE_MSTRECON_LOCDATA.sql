CREATE PROCEDURE SP3S_PREPARE_MSTRECON_LOCDATA
(
	@DLASTSYNCDATE DATETIME
)
AS
BEGIN
	DECLARE @DTSQL NVARCHAR(MAX), @CSTEP VARCHAR(5), @CERRMSG NVARCHAR(MAX),@NSPID INT
	DECLARE @CTEMPDBNAME1 NVARCHAR(128) = N'', @CTEMPDBNAME NVARCHAR(128) = N''
	DECLARE @CHO_DEPT_ID VARCHAR(5)
	DECLARE @TXNSSENDINFO TABLE (ORG_TABLENAME VARCHAR(50), TMP_TABLENAME VARCHAR(50), ERRMSG VARCHAR(4000))
	DECLARE @TXNSSENDCURSOR CURSOR
	DECLARE @CTABLENAME VARCHAR(50)
	DECLARE @CTEMPTABLE VARCHAR(300), @CTEMPTABLEM VARCHAR(300), @CTEMPTABLED VARCHAR(300),@CTEMPTABLELM VARCHAR(200)
	DECLARE @CFROMDATE VARCHAR(10),@CTEMPARTICLETABLE VARCHAR(300),@CTEMPSUBSECTIONTABLE VARCHAR(300),
	@CTEMPARTATTRTABLE VARCHAR(300),@CTEMPATTRKEYTABLE VARCHAR(300)

	BEGIN TRY

		SET @CSTEP=00
		SET @NSPID=@@SPID

		SET @CFROMDATE = CONVERT(VARCHAR, CONVERT(DATE, DATEADD(DD, -1, @DLASTSYNCDATE)))

		SELECT @CHO_DEPT_ID= VALUE FROM CONFIG WHERE CONFIG_OPTION='LOCATION_ID'

		SET @CSTEP=10
		SET @CTEMPDBNAME1 = DB_NAME() + '_TEMP'

		IF DB_ID(@CTEMPDBNAME1) IS NOT NULL
			SET @CTEMPDBNAME = DB_NAME() + '_TEMP.DBO.'
		ELSE
		BEGIN
			SET @CERRMSG='STEP- ' + LTRIM(STR(@CSTEP)) + ' ERROR TEMP DATABASE NOT EXISTS.'
			GOTO END_PROC
		END

		SET @CSTEP=15

		INSERT @TXNSSENDINFO (ORG_TABLENAME) VALUES ('SKU')
		INSERT @TXNSSENDINFO (ORG_TABLENAME) VALUES ('PARA1')
		INSERT @TXNSSENDINFO (ORG_TABLENAME) VALUES ('PARA2')
		INSERT @TXNSSENDINFO (ORG_TABLENAME) VALUES ('PARA3')
		INSERT @TXNSSENDINFO (ORG_TABLENAME) VALUES ('PARA4')
		INSERT @TXNSSENDINFO (ORG_TABLENAME) VALUES ('PARA5')
		INSERT @TXNSSENDINFO (ORG_TABLENAME) VALUES ('PARA6')
		INSERT @TXNSSENDINFO (ORG_TABLENAME) VALUES ('ARTICLE')
		INSERT @TXNSSENDINFO (ORG_TABLENAME) VALUES ('SECTIONM')
		INSERT @TXNSSENDINFO (ORG_TABLENAME) VALUES ('SECTIOND')
		INSERT @TXNSSENDINFO (ORG_TABLENAME) VALUES ('LM01106')
		INSERT @TXNSSENDINFO (ORG_TABLENAME) VALUES ('HD01106')
		INSERT @TXNSSENDINFO (ORG_TABLENAME) VALUES ('FORM')
		INSERT @TXNSSENDINFO (ORG_TABLENAME) VALUES ('ATTRM')
		INSERT @TXNSSENDINFO (ORG_TABLENAME) VALUES ('ATTR_KEY')
		INSERT @TXNSSENDINFO (ORG_TABLENAME) VALUES ('ART_ATTR')

		-- DROP THE TEMPORARY TABLES ALREADY EXISTING
		SET @CSTEP=30
		SET @TXNSSENDCURSOR = CURSOR FAST_FORWARD FOR SELECT ORG_TABLENAME FROM @TXNSSENDINFO
		OPEN @TXNSSENDCURSOR
		FETCH NEXT FROM @TXNSSENDCURSOR INTO @CTABLENAME

		WHILE @@FETCH_STATUS = 0
		BEGIN
			SET @CSTEP=40
			SET @CTEMPTABLE=@CTEMPDBNAME + '[TMP_MST_COMP_'+@CTABLENAME+'_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
			SET @DTSQL=N'IF OBJECT_ID('''+@CTEMPTABLE+''',''U'') IS NOT NULL
							DROP TABLE '+@CTEMPTABLE+''
			PRINT @DTSQL
			EXEC SP_EXECUTESQL @DTSQL

			FETCH NEXT FROM @TXNSSENDCURSOR INTO @CTABLENAME
		END
		CLOSE @TXNSSENDCURSOR
		DEALLOCATE @TXNSSENDCURSOR
		
		---- SEND THE SKU
		SET @CSTEP=60
		SET @CTEMPTABLEM=@CTEMPDBNAME + '[TMP_MST_COMP_SKU_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
		SET @DTSQL=N'	SELECT	S.FORM_ID,S.PRODUCT_CODE, S.PARA1_CODE,
								S.PARA2_CODE, S.PARA3_CODE, S.PARA4_CODE, S.PARA5_CODE, S.PARA6_CODE,
								S.ARTICLE_CODE, M.SECTION_CODE, D.SUB_SECTION_CODE, S.AC_CODE, S.VENDOR_EAN_NO,
								S.ONLINE_PRODUCT_CODE, S.DT_CREATED INTO '+@CTEMPTABLEM+'
						FROM SKU S (NOLOCK)
						JOIN ARTICLE A (NOLOCK) ON S.ARTICLE_CODE=A.ARTICLE_CODE
						JOIN SECTIOND D (NOLOCK) ON D.SUB_SECTION_CODE=A.SUB_SECTION_CODE
						JOIN SECTIONM M (NOLOCK) ON M.SECTION_CODE=D.SECTION_CODE
						WHERE CONVERT(DATE, S.LAST_MODIFIED_ON) > '''+@CFROMDATE+''' '
		PRINT @DTSQL  
		EXEC SP_EXECUTESQL @DTSQL
		
		
		---- SEND THE ARTICLE
		SET @CSTEP=65
		SET @CTEMPARTICLETABLE=@CTEMPDBNAME + '[TMP_MST_COMP_ARTICLE_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
		SET @DTSQL=N'	SELECT DISTINCT ART.*
						INTO '+@CTEMPARTICLETABLE+'
						FROM ARTICLE ART (NOLOCK)
						JOIN '+@CTEMPTABLEM+' TP (NOLOCK) ON ART.ARTICLE_CODE=TP.ARTICLE_CODE
						UNION
						SELECT ART.*
						FROM ARTICLE ART (NOLOCK)
						WHERE CONVERT(DATE, LAST_MODIFIED_ON) > '''+@CFROMDATE+''' '
		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL

		---- SEND THE PARA1
		SET @CSTEP=70
		SET @CTEMPTABLED=@CTEMPDBNAME + '[TMP_MST_COMP_PARA1_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
		SET @DTSQL=N'	SELECT DISTINCT P1.* INTO '+@CTEMPTABLED+'
						FROM PARA1 P1 (NOLOCK) JOIN '+@CTEMPTABLEM+' TP (NOLOCK)
						ON P1.PARA1_CODE=TP.PARA1_CODE
						UNION
						SELECT DISTINCT P1.* 
						FROM PARA1 P1 (NOLOCK) JOIN '+@CTEMPARTICLETABLE+' TP (NOLOCK)
						ON P1.PARA1_CODE=TP.PARA1_CODE
						UNION
						SELECT P1.* FROM PARA1 P1 (NOLOCK)
						WHERE CONVERT(DATE, LAST_MODIFIED_ON) > '''+@CFROMDATE+''' '
		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL

		---- SEND THE PARA2
		SET @CSTEP=80
		SET @CTEMPTABLED=@CTEMPDBNAME + '[TMP_MST_COMP_PARA2_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
		SET @DTSQL=N'	SELECT DISTINCT P2.* INTO '+@CTEMPTABLED+'
						FROM PARA2 P2 (NOLOCK) JOIN '+@CTEMPTABLEM+' TP (NOLOCK)
						ON P2.PARA2_CODE=TP.PARA2_CODE
						UNION
						SELECT DISTINCT P2.* 
						FROM PARA2 P2 (NOLOCK) JOIN '+@CTEMPARTICLETABLE+' TP (NOLOCK)
						ON P2.PARA2_CODE=TP.PARA2_CODE
						UNION
						SELECT P2.* FROM PARA2 P2 (NOLOCK)
						WHERE CONVERT(DATE, LAST_MODIFIED_ON) > '''+@CFROMDATE+''' '
		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL

		---- SEND THE PARA3
		SET @CSTEP=90
		SET @CTEMPTABLED=@CTEMPDBNAME + '[TMP_MST_COMP_PARA3_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
		SET @DTSQL=N'	SELECT DISTINCT P3.* INTO '+@CTEMPTABLED+'
						FROM PARA3 P3 (NOLOCK) JOIN '+@CTEMPTABLEM+' TP (NOLOCK)
						ON P3.PARA3_CODE=TP.PARA3_CODE
						UNION
						SELECT DISTINCT P3.* 
						FROM PARA3 P3 (NOLOCK) JOIN '+@CTEMPARTICLETABLE+' TP (NOLOCK)
						ON P3.PARA3_CODE=TP.PARA3_CODE
						UNION
						SELECT P3.* FROM PARA3 P3 (NOLOCK)
						WHERE CONVERT(DATE, LAST_MODIFIED_ON) > '''+@CFROMDATE+''' '
		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL

		---- SEND THE PARA4
		SET @CSTEP=100
		SET @CTEMPTABLED=@CTEMPDBNAME + '[TMP_MST_COMP_PARA4_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
		SET @DTSQL=N'	SELECT DISTINCT P4.* INTO '+@CTEMPTABLED+'
						FROM PARA4 P4 (NOLOCK) JOIN '+@CTEMPTABLEM+' TP (NOLOCK)
						ON P4.PARA4_CODE=TP.PARA4_CODE
						UNION
						SELECT DISTINCT P4.* 
						FROM PARA4 P4 (NOLOCK) JOIN '+@CTEMPARTICLETABLE+' TP (NOLOCK)
						ON P4.PARA4_CODE=TP.PARA4_CODE
						UNION
						SELECT P4.* FROM PARA4 P4 (NOLOCK)
						WHERE CONVERT(DATE, LAST_MODIFIED_ON) > '''+@CFROMDATE+''' '
		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL

		---- SEND THE PARA5
		SET @CSTEP=110
		SET @CTEMPTABLED=@CTEMPDBNAME + '[TMP_MST_COMP_PARA5_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
		SET @DTSQL=N'	SELECT DISTINCT P5.* INTO '+@CTEMPTABLED+'
						FROM PARA5 P5 (NOLOCK) JOIN '+@CTEMPTABLEM+' TP (NOLOCK)
						ON P5.PARA5_CODE=TP.PARA5_CODE
						UNION
						SELECT DISTINCT P5.* 
						FROM PARA5 P5 (NOLOCK) JOIN '+@CTEMPARTICLETABLE+' TP (NOLOCK)
						ON P5.PARA5_CODE=TP.PARA5_CODE
						UNION
						SELECT P5.* FROM PARA5 P5 (NOLOCK)
						WHERE CONVERT(DATE, LAST_MODIFIED_ON) > '''+@CFROMDATE+''' '
		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL

		---- SEND THE PARA6
		SET @CSTEP=120
		SET @CTEMPTABLED=@CTEMPDBNAME + '[TMP_MST_COMP_PARA6_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
		SET @DTSQL=N'	SELECT DISTINCT P6.* INTO '+@CTEMPTABLED+'
						FROM PARA6 P6 (NOLOCK) JOIN '+@CTEMPTABLEM+' TP (NOLOCK)
						ON P6.PARA6_CODE=TP.PARA6_CODE
						UNION
						SELECT DISTINCT P6.* 
						FROM PARA6 P6 (NOLOCK) JOIN '+@CTEMPARTICLETABLE+' TP (NOLOCK)
						ON P6.PARA6_CODE=TP.PARA6_CODE
						UNION
						SELECT P6.* FROM PARA6 P6(NOLOCK)
						WHERE CONVERT(DATE, LAST_MODIFIED_ON) > '''+@CFROMDATE+''' '
		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL

		

		

		---- SEND THE SUB_SECTION
		SET @CSTEP=150
		SET @CTEMPSUBSECTIONTABLE=@CTEMPDBNAME + '[TMP_MST_COMP_SECTIOND_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
		SET @DTSQL=N'	SELECT DISTINCT SD.SECTION_CODE, SD.SUB_SECTION_CODE, SD.SUB_SECTION_NAME,SD.ALIAS,SD.INACTIVE,
		                SD.MFG_CATEGORY,SD.REMARKS,SD.HSN_CODE 
		                INTO '+@CTEMPSUBSECTIONTABLE+'
						FROM SECTIOND SD (NOLOCK) JOIN '+@CTEMPTABLEM+' TP (NOLOCK)
						ON TP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE
						UNION
						SELECT DISTINCT SD1.SECTION_CODE, SD1.SUB_SECTION_CODE, SD1.SUB_SECTION_NAME,SD1.ALIAS,SD1.INACTIVE,
		                SD1.MFG_CATEGORY,SD1.REMARKS,SD1.HSN_CODE
						FROM SECTIOND SD1 (NOLOCK) JOIN '+@CTEMPARTICLETABLE+' TP1 (NOLOCK)
						ON TP1.SUB_SECTION_CODE=SD1.SUB_SECTION_CODE 
						UNION
						SELECT DISTINCT SECTION_CODE, SUB_SECTION_CODE, SUB_SECTION_NAME,ALIAS,INACTIVE,
		                MFG_CATEGORY,REMARKS,HSN_CODE FROM SECTIOND (NOLOCK)
						WHERE CONVERT(DATE, LAST_MODIFIED_ON) > '''+@CFROMDATE+''' '
		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL
		
		
		---- SEND THE SECTION
		SET @CSTEP=140
		SET @CTEMPTABLED=@CTEMPDBNAME + '[TMP_MST_COMP_SECTIONM_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
		SET @DTSQL=N'	SELECT DISTINCT SM.SECTION_CODE, SM.SECTION_NAME,SM.ALIAS,SM.INACTIVE,SM.LAST_UPDATE,SM.REMARKS 
		                INTO '+@CTEMPTABLED+'
						FROM SECTIONM SM (NOLOCK)  JOIN '+@CTEMPTABLEM+' TP (NOLOCK)
						ON TP.SECTION_CODE=SM.SECTION_CODE
						UNION
						SELECT DISTINCT SM1.SECTION_CODE, SM1.SECTION_NAME,SM1.ALIAS,SM1.INACTIVE,SM1.LAST_UPDATE,SM1.REMARKS 
						FROM SECTIONM SM1 (NOLOCK)  JOIN '+@CTEMPSUBSECTIONTABLE+' TP1 (NOLOCK)
						ON TP1.SECTION_CODE=SM1.SECTION_CODE
						UNION
						SELECT DISTINCT SECTION_CODE, SECTION_NAME,ALIAS,INACTIVE,LAST_UPDATE,REMARKS 
					    FROM SECTIONM (NOLOCK)
						WHERE CONVERT(DATE, LAST_MODIFIED_ON) > '''+@CFROMDATE+''' '
		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL

		---- SEND THE LM01106
		SET @CSTEP=160
		SET @CTEMPTABLELM=@CTEMPDBNAME + '[TMP_MST_COMP_LM01106_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
		SET @DTSQL=N'	SELECT DISTINCT LM.AC_CODE, AC_NAME, HEAD_CODE INTO '+@CTEMPTABLELM+'
						FROM LM01106 LM (NOLOCK) JOIN '+@CTEMPTABLEM+' TP (NOLOCK)
						ON TP.AC_CODE=LM.AC_CODE
						UNION
						SELECT LM.AC_CODE, AC_NAME, HEAD_CODE FROM LM01106 LM (NOLOCK)
						WHERE CONVERT(DATE, LAST_MODIFIED_ON) > '''+@CFROMDATE+''' '
		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL

		---- SEND THE HD01106
		SET @CSTEP=170
		SET @CTEMPTABLED=@CTEMPDBNAME + '[TMP_MST_COMP_HD01106_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
		SET @DTSQL=N'	SELECT DISTINCT HEAD_NAME, HD.HEAD_CODE, HD.MAJOR_HEAD_CODE INTO '+@CTEMPTABLED+'
						FROM HD01106 HD (NOLOCK) JOIN '+@CTEMPTABLELM+' TP (NOLOCK)
						ON TP.HEAD_CODE=HD.HEAD_CODE
						UNION
						SELECT DISTINCT MHD.HEAD_NAME, MHD.HEAD_CODE, MHD.MAJOR_HEAD_CODE
						FROM HD01106 MHD (NOLOCK)
						JOIN HD01106 HD (NOLOCK) ON HD.MAJOR_HEAD_CODE=MHD.HEAD_CODE
						JOIN  '+@CTEMPTABLELM+' TP (NOLOCK) ON TP.HEAD_CODE=HD.HEAD_CODE
						WHERE MHD.MAJOR_HEAD_CODE=MHD.HEAD_CODE'
		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL

		---- SEND THE FORM
		SET @CSTEP=175
		SET @CTEMPTABLED=@CTEMPDBNAME + '[TMP_MST_COMP_FORM_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
		SET @DTSQL=N'	SELECT DISTINCT FORM_NAME, A.FORM_ID INTO '+@CTEMPTABLED+'
						FROM FORM A (NOLOCK) JOIN '+@CTEMPTABLEM+' TP (NOLOCK)
						ON TP.FORM_ID=A.FORM_ID'
		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL
		
		---- SEND THE ART_ATTR
		SET @CSTEP=180
		SET @CTEMPTABLELM=@CTEMPDBNAME + '[TMP_MST_COMP_ART_ATTR_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
		SET @DTSQL=N'   SELECT DISTINCT AA.ARTICLE_CODE,AA.ATTRIBUTE_CODE,AA.KEY_CODE,AA.OPEN_KEY_NAME  
		                INTO '+@CTEMPTABLELM+'
						FROM ART_ATTR AA (NOLOCK) 
						JOIN '+@CTEMPDBNAME + '[TMP_MST_COMP_ARTICLE_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'+' TP (NOLOCK)
						ON TP.ARTICLE_CODE=AA.ARTICLE_CODE'
						
		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL
		
		---- SEND THE ATTR_KEY
		SET @CSTEP=185
		SET @CTEMPTABLELM=@CTEMPDBNAME + '[TMP_MST_COMP_ATTR_KEY_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
		SET @DTSQL=N'	SELECT DISTINCT AK.ATTRIBUTE_CODE,AK.KEY_CODE,AK.KEY_NAME,AK.INACTIVE,AK.LAST_UPDATE,
		                AK.COMPANY_CODE,AK.KEY_ALIAS INTO '+@CTEMPTABLELM+'
						FROM ATTR_KEY AK (NOLOCK) 
						JOIN '+@CTEMPDBNAME + '[TMP_MST_COMP_ART_ATTR_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'+' TP (NOLOCK)
						ON TP.KEY_CODE=AK.KEY_CODE
						UNION
						SELECT DISTINCT AK.ATTRIBUTE_CODE,AK.KEY_CODE,AK.KEY_NAME,AK.INACTIVE,AK.LAST_UPDATE,
		                AK.COMPANY_CODE,AK.KEY_ALIAS  FROM ATTR_KEY AK (NOLOCK)
						WHERE CONVERT(DATE, LAST_MODIFIED_ON) > '''+@CFROMDATE+''' '
		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL
		
		---- SEND THE ATTRM
		SET @CSTEP=190
		SET @CTEMPTABLELM=@CTEMPDBNAME + '[TMP_MST_COMP_ATTRM_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'
		SET @DTSQL=N'	SELECT DISTINCT RM.ATTRIBUTE_CODE,RM.ATTRIBUTE_NAME,RM.ATTRIBUTE_GROUP ,
		                RM.LAST_UPDATE,RM.COMPANY_CODE,RM.ATTRIBUTE_TYPE,RM.INACTIVE,RM.REMARKS,
		                RM.ATTRIBUTE_ORDER,RM.ATTRIBUTE_MODE,RM.MANDATORY 
		                INTO '+@CTEMPTABLELM+'
						FROM ATTRM RM (NOLOCK) 
						JOIN '+@CTEMPDBNAME + '[TMP_MST_COMP_ATTR_KEY_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID)))+']'+' TP (NOLOCK)
						ON TP.ATTRIBUTE_CODE=RM.ATTRIBUTE_CODE
						UNION
						SELECT DISTINCT RM.ATTRIBUTE_CODE,RM.ATTRIBUTE_NAME,RM.ATTRIBUTE_GROUP ,
		                RM.LAST_UPDATE,RM.COMPANY_CODE,RM.ATTRIBUTE_TYPE,RM.INACTIVE,RM.REMARKS,
		                RM.ATTRIBUTE_ORDER,RM.ATTRIBUTE_MODE,RM.MANDATORY  FROM ATTRM RM (NOLOCK)
						WHERE CONVERT(DATE, LAST_MODIFIED_ON) > '''+@CFROMDATE+''' '
		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL
		

		--UPDATE @TXNSSENDINFO
		SET @CSTEP=195
		UPDATE @TXNSSENDINFO SET TMP_TABLENAME= 'TMP_MST_COMP_'+ORG_TABLENAME+'_UPLOAD_'+LTRIM(RTRIM(STR(@NSPID))),
		ORG_TABLENAME='MST_COMP_'+ORG_TABLENAME+'_UPLOAD'

	END TRY
	BEGIN CATCH
		SET @CERRMSG='P: SP3S_PREPARE_MSTRECON_LOCDATA, STEP:'+@CSTEP+', MESSAGE:'+ERROR_MESSAGE()
		GOTO END_PROC
	END CATCH

END_PROC:
	IF ISNULL(@CERRMSG,'')<>''
		SELECT ISNULL(@CERRMSG,'') AS ERRMSG
	ELSE
		SELECT ORG_TABLENAME, TMP_TABLENAME, ISNULL(ERRMSG,'')AS ERRMSG FROM @TXNSSENDINFO
END

---END OF PROCEDURE - SP3S_PREPARE_MSTRECON_LOCDATA
