-- PROCEDURE TO UPDATE PUR INFO IN SKU AND SKU_OH TABLES
create PROCEDURE SAVETRAN_PUR_UPDSKU_SNC_wip
(
	@CMEMOID VARCHAR(40),
	@NMODE INT=1,
	@BCANCELBILL BIT=0,
	@CERRORMSG VARCHAR(MAX) OUTPUT
)
--WITH ENCRYPTION
AS
BEGIN
    BEGIN TRY

	
    
	DECLARE @CCMD NVARCHAR(MAX),@CDETAILTABLE VARCHAR(100),@CMASTERTABLE VARCHAR(100),@CMEMOIDCOL VARCHAR(100) ,
	@CQTYCOL VARCHAR(100),@NSTEP INT,@nSncmstmode NUMERIC(1,0)
	
	SET @CERRORMSG=''
	
	SET @NSTEP=10
	SELECT @CDETAILTABLE='SNC_DET',@CMASTERTABLE='SNC_MST',@CMEMOIDCOL='MEMO_ID',@CQTYCOL='QUANTITY'	
	
	SELECT TOP 1 @nSncmstmode=snc_mst_mode FROM  snc_mst (NOLOCK) WHERE memo_id=@cMemoId
		
	SET @NSTEP=20	
	PRINT 'UPDSKUOH-1'

	
	SET @NSTEP=30
	-- UPDATING MASTER INFORMATION AND OTHER DETAILS IN SKU TABLE
	UPDATE A SET  	
		ARTICLE_CODE = B.ARTICLE_CODE,  	
		PARA1_CODE = B.PARA1_CODE,  	
		PARA2_CODE = B.PARA2_CODE,  	
		PARA3_CODE = B.PARA3_CODE,  	
		PARA4_CODE = B.PARA4_CODE,  	
		PARA5_CODE = B.PARA5_CODE,  	
		PARA6_CODE = B.PARA6_CODE,  	
		BASE_PRICE = B.PURCHASE_PRICE
	FROM WIP_PMT A
	JOIN SNC_BARCODE_DET B1 ON A.PRODUCT_CODE = B1.PRODUCT_CODE
	JOIN SNC_DET B ON B1.REFROW_ID = B.ROW_ID  
	JOIN SNC_MST C1 ON C1.MEMO_ID = B.MEMO_ID  
	LEFT OUTER JOIN SKU_OH D ON A.PRODUCT_CODE = D.PRODUCT_CODE
	WHERE C1.WIP=1 AND C1.MEMO_ID = @CMEMOID
	
	
	
	
	END TRY
	
	BEGIN CATCH
		SET @CERRORMSG = 'PROCEDURE SAVETRAN_PUR_UPDSKU_SNC_WIP: STEP- ' + LTRIM(STR(@NSTEP)) + ' SQL ERROR: #' + LTRIM(STR(ERROR_NUMBER())) + ' ' + ERROR_MESSAGE()
		-- SET @CRETCMD= N'SELECT '''+@CERRORMSG+''' AS ERRMSG, '''' AS MEMO_ID'
			
		GOTO END_PROC
	END CATCH
	
END_PROC:

END
--************************************************** END OF PROCEDURE SAVETRAN_PUR_UPDSKU
