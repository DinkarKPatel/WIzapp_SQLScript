CREATE PROCEDURE SP_GETBARCODEDETAILS
(      
 @NMODE INT,   --* 1 FOR PO 2. FOR SPLIT COMBINE, 3. PURCHASE, 4. OPS MODULE . 5. BARCODE PRINTING     
 @CROWIDSTR NVARCHAR(MAX)='',
 @CMEMO_ID VARCHAR(50)='',
 @NNOOFCOPIES INT=0
)      
----WITH ENCRYPTION    
AS      
BEGIN      
      
	  
   IF @NMODE=2
   BEGIN

   
	  
					IF OBJECT_ID ('TEMPDB..#TMPPID','U') IS NOT NULL
						DROP TABLE #TMPPID
				    SELECT   A.ROW_ID,A.QUANTITY , ART.DISCON ,
						  CASE WHEN ISNULL(ART.DISCON,0)=1 THEN 1 ELSE A.QUANTITY  END AS PO_QTY,A.SRNO
						  INTO #TMPPID
				   FROM POD01106  A (NOLOCK)
				   JOIN SKU B (NOLOCK) ON A.PRODUCT_CODE =B.PRODUCT_CODE 
				   JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE =B.ARTICLE_CODE 
				   WHERE A.PO_ID=@CMEMO_ID
				
			   IF OBJECT_ID ('TEMPDB..#TEMP_PO_BARCODEPRINT','U') IS NOT NULL
			   BEGIN
					DELETE A
					FROM #TMPPID A (NOLOCK)
					LEFT OUTER JOIN #TEMP_PO_BARCODEPRINT D (NOLOCK) ON D.row_id=A.row_id
					WHERE D.ROW_ID IS NULL
			   END

				--ALTER TABLE #TMPPID ADD PRINT_SRNO NUMERIC(10) IDENTITY

 
			  --IF DISCON 1 AND PO_QTY MORE THEN 1 THEN NORMALIZE QTY

  
				;WITH CTE_DISCON(N,ROW_ID,PO_QTY,QUANTITY,SRNO) 
				AS (
					SELECT 1 , ROW_ID,PO_QTY,QUANTITY,SRNO
					FROM #TMPPID
					WHERE QUANTITY >1 AND DISCON =1
					UNION ALL
					SELECT    
						N + 1, ROW_ID,PO_QTY,QUANTITY,SRNO
					FROM    CTE_DISCON
					WHERE QUANTITY-1 >= N+1
	
				)
				INSERT INTO #TMPPID(ROW_ID,QUANTITY,DISCON,PO_QTY,SRNO)
				SELECT row_id,0 AS QUANTITY,1 AS DISCON, 1 AS PO_QTY ,SRNO
				FROM CTE_DISCON
				ORDER BY row_id ,QUANTITY
				option (maxrecursion 32000);



				IF EXISTS (SELECT TOP 1'U' FROM #TMPPID 
				HAVING  SUM(QUANTITY)<>SUM(PO_QTY)
				)
				BEGIN
				  SELECT '1 .MISMATCH NORMALIZE QTY' ERRMSG
				   RETURN
				END



				IF ISNULL(@NNOOFCOPIES,0)>1
				BEGIN
	
					;WITH CTE_NOOFOFCOPIES(N,ROW_ID,PO_QTY,QUANTITY,SRNO) 
					AS (
						SELECT 1 , ROW_ID,PO_QTY,QUANTITY,SRNO
						FROM #TMPPID
						UNION ALL
						SELECT    
							N + 1, ROW_ID,PO_QTY,QUANTITY,SRNO
						FROM    CTE_NOOFOFCOPIES
						WHERE @NNOOFCOPIES-1 >= N+1
	
					)
					INSERT INTO #TMPPID(ROW_ID,QUANTITY,DISCON,PO_QTY,SRNO)
					SELECT row_id,0 AS QUANTITY,0 AS DISCON, PO_QTY AS PO_QTY ,SRNO
					FROM CTE_NOOFOFCOPIES
					ORDER BY row_id ,QUANTITY
					option (maxrecursion 5);

			   IF EXISTS (SELECT TOP 1'U' FROM #TMPPID 
				HAVING  SUM(QUANTITY*@NNOOFCOPIES)<>SUM(PO_QTY)
				)
				BEGIN
				  SELECT ' 2 .MISMATCH NORMALIZE QTY ' ERRMSG
				   RETURN
				END


			END
			--ALTER TABLE #TMPPID ADD PRINT_SRNO NUMERIC(10) --IDENTITY
			--;WITH ROW_NO
			--AS
			--(
			--SELECT row_id,ROW_NUMBER() OVER (PARTITION BY PRINT_SRNO ORDER BY SRNO)
			--FROM #TMPPID 
			--)
			--UPDATE #TMPPID SET  PRINT_SRNO=ROW_NUMBER() OVER (PARTITION BY PRINT_SRNO ORDER BY SRNO) 
			
END

--SELECT * FROM #TMPPID

  IF EXISTS(SELECT TOP 1 'U' FROM SYS.procedures WHERE name='SP_GETBARCODEDETAILS_CUSTOM')    
  BEGIN    
      IF EXISTS (SELECT TOP 1 'U' FROM sys.parameters   WHERE OBJECT_NAME (OBJECT_ID)= 'SP_GETBARCODEDETAILS_CUSTOM' AND name='@CMEMO_ID') 
	  BEGIN
	        
			 EXEC SP_GETBARCODEDETAILS_CUSTOM  @NMODE,@CROWIDSTR ,@CMEMO_ID,@NNOOFCOPIES 

	  END
	  ELSE 
	  BEGIN

          EXEC SP_GETBARCODEDETAILS_CUSTOM  @NMODE,@CROWIDSTR

	  END
      RETURN    
  END    
      
 DECLARE @CROWFILTER NVARCHAR(MAX), @CCMD NVARCHAR(MAX),@CCMD1 NVARCHAR(MAX),@CLOCID CHAR(10) ,@cCmdIMG Nvarchar(max),
         @bimageprint bit
       
 SELECT @CLOCID = VALUE FROM CONFIG WHERE CONFIG_OPTION = 'HO_LOCATION_ID'     
  
declare @SHOW_PRODUCT_CODE_IN_PRD varchar(10)
select @SHOW_PRODUCT_CODE_IN_PRD=value  from config where config_option='SHOW_PRODUCT_CODE_IN_PRD'
  
  SET @BIMAGEPRINT=0
  IF @CROWIDSTR <> ''      
	BEGIN    
		IF @NMODE=10    
			SET @CROWFILTER = N' det.ROW_ID IN ( ''' + @CROWIDSTR + ''' )'    
		ELSE IF @NMODE=15    
			SET @CROWFILTER = N' M.MEMO_ID =  ''' + @CROWIDSTR + ''''     
		ELSE IF @NMODE=26    
			SET @CROWFILTER = N' CAST(SKU.ARTICLE_CODE +SKU.PARA1_CODE +P2.PARA2_SET AS VARCHAR(100)) IN ( ''' + @CROWIDSTR + ''' )'    
        ELSE IF @NMODE=22  and isnull(@SHOW_PRODUCT_CODE_IN_PRD,'')<>'1'  
			SET @CROWFILTER = N' CAST(''LATER''+SKU.ARTICLE_CODE +SKU.PARA1_CODE +sku.para2_code AS VARCHAR(40)) IN ( ''' + @CROWIDSTR + ''' )'    
		ELSE     
			SET @CROWFILTER = N' B.ROW_ID IN ( ''' + @CROWIDSTR + ''' )'    
	END    

  	DECLARE @IMG_SECTION BIT,@IMG_SUB_SECTION BIT,@IMG_ARTICLE BIT,@IMG_PARA1 BIT,@IMG_PARA2 BIT,@IMG_PARA3 BIT,@IMG_PARA4 BIT,@IMG_PARA5 BIT,@IMG_PARA6 BIT,@IMG_PRODUCT BIT
	SELECT @IMG_SECTION=SECTION,@IMG_SUB_SECTION=SUB_SECTION,@IMG_ARTICLE=ARTICLE ,@IMG_PARA1=PARA1 ,
	       @IMG_PARA2=PARA2, @IMG_PARA3=PARA3,@IMG_PARA4=PARA4,@IMG_PARA5=PARA5 ,@IMG_PARA6=PARA6, @IMG_PRODUCT=PRODUCT        
    FROM DBO.IMAGE_INFO_CONFIG WITH(NOLOCK)  

	      set @cCmdIMG=''
		  IF (@IMG_SECTION=1 or @IMG_SUB_SECTION=1 or @IMG_ARTICLE=1 or @IMG_PARA1=1 or @IMG_PARA2=1 or  @IMG_PARA3=1 or 
		      @IMG_PARA4=1 or @IMG_PARA5=1 or @IMG_PARA6=1 or @IMG_PRODUCT=1)
		  begin
		   SET @cCmdIMG='LEFT OUTER JOIN ' + DB_NAME()+ '_IMAGE..IMAGE_INFO IMG (NOLOCK) ON 1=1 ' +
						(CASE WHEN @IMG_SECTION = 1 THEN ' AND IMG.SECTION_CODE=SM.SECTION_CODE' ELSE ''  END) +
						(CASE WHEN @IMG_SUB_SECTION = 1 THEN ' AND IMG.SUB_SECTION_CODE=SD.SUB_SECTION_CODE' ELSE '' END) +
						(CASE WHEN @IMG_ARTICLE = 1 THEN ' AND IMG.ARTICLE_CODE=c.ARTICLE_CODE' ELSE ' AND IMG.ARTICLE_CODE=''00000000''' END) +
						(CASE WHEN @IMG_PARA1 = 1 THEN ' AND IMG.PARA1_CODE=P1.PARA1_CODE' ELSE ' AND IMG.PARA1_CODE=''0000000''' END) +
						(CASE WHEN @IMG_PARA2 = 1 THEN ' AND IMG.PARA2_CODE=P2.PARA2_CODE' ELSE ' AND IMG.PARA2_CODE=''0000000''' END) +
						(CASE WHEN @IMG_PARA3 = 1 THEN ' AND IMG.PARA3_CODE=P3.PARA3_CODE' ELSE ' AND IMG.PARA3_CODE=''0000000''' END) +
						(CASE WHEN @IMG_PARA4 = 1 THEN  ' AND IMG.PARA4_CODE=P4.PARA4_CODE' ELSE ' AND IMG.PARA4_CODE=''0000000''' END) +
						(CASE WHEN @IMG_PARA5 = 1 THEN  ' AND IMG.PARA5_CODE=P5.PARA5_CODE' ELSE ' AND IMG.PARA5_CODE=''0000000''' END) +
						(CASE WHEN @IMG_PARA6 = 1 THEN  ' AND IMG.PARA6_CODE=P6.PARA6_CODE' ELSE ' AND IMG.PARA6_CODE=''0000000''' END) +
						(CASE WHEN @IMG_PRODUCT = 1 THEN  'AND IMG.PRODUCT_CODE=SKU.PRODUCT_CODE' ELSE '' END)

          
		
			end
			else
			SET @cCmdIMG='LEFT OUTER JOIN ' + DB_NAME()+ '_IMAGE..IMAGE_INFO IMG (NOLOCK) ON 1=2 '


  
 IF @NMODE = 2  -- FROM PURCHASE  ORDER    
 BEGIN      
 
 SET @CCMD = N'SELECT B.PRODUCT_CODE,B.VENDOR_EAN_NO, B.FIX_MRP, CONVERT(NUMERIC(10,0),B.MRP) AS WMRP,B.MRP,B.PURCHASE_PRICE, B.WHOLESALE_PRICE AS WS_PRICE  
    ,C.ARTICLE_NO, C.ARTICLE_NAME, SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME  ,RIGHT(C.ARTICLE_NO,4)ARTICLE_NO_LAST4  
    ,U.uom_type AS DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME  
    ,P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME  ,P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME  
    ,P6.PARA6_CODE, P6.PARA6_NAME,  C.ARTICLE_DESC,LM.AC_NAME, A.PO_NO AS INV_NO  
    ,CONVERT(VARCHAR,A.PO_DT,101) AS INV_DT, A.PO_NO AS CHALLAN_NO, LM.ALIAS, P3.INACTIVE AS PARA3_INACTIVE  
    ,(RTRIM(LTRIM(STR(MONTH(A.PO_DT)))) + ''/'' + RTRIM(LTRIM(LM.ALIAS)) + ''/''+     
    RTRIM(LTRIM(STR(YEAR(A.PO_DT))))+ ''9/'' + RTRIM(LTRIM(A.PO_NO)) + ''/''+    
    RTRIM(LTRIM(STR(DAY(A.PO_DT))))) AS INV_DETAILS  
    ,B.MRP, TMP.PO_QTY AS QTY,'''' AS RECEIPT_DT,'''' AS VANDOR_BILL_DT,U.UOM_NAME,A.AC_CODE ,SKU.PRODUCT_NAME  
    ,DBO.FN_GETENCRYPTVAL(B.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT    
   ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
	AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
	AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
	AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
	AT25.ATTR25_KEY_NAME   
    ,SKU.ER_FLAG,A.PO_DT AS INV_DT1,OEM_ID,OEM_NAME,OEM_ADD1,OEM_ADD2,OEM_ADD3,OEM_PHONE  
    ,OEM_EMAIL,OEM_WEB, '''' AS INV_MMYY  
    ,LMP.ADDRESS0,LMP.ADDRESS1,LMP.ADDRESS2  
    --,ADDRESS0=CASE ISNULL(LMP.ADDRESS0,'''') WHEN '''' THEN ''.'' ELSE LMP.ADDRESS0 END  
    --,ADDRESS1=CASE ISNULL(LMP.ADDRESS1,'''') WHEN '''' THEN ''.'' ELSE LMP.ADDRESS1 END  
    --,ADDRESS2=CASE ISNULL(LMP.ADDRESS2,'''') WHEN '''' THEN ''.'' ELSE LMP.ADDRESS2 END   
    ,P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS     
    ,P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS     
    ,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS    
    ,LMV.AREA_NAME,LMV.CITY,LMV.PINCODE,LMV.STATE ,LEFT(DATENAME(MM,PO_DT),3) + ''-'' + DATENAME(YEAR,PO_DT) AS PUR_MONTH_YEAR
   ,(Left(convert(varchar,datepart(month,A.Packing_Dt)),3) + ''/'' + right(convert(varchar,datepart(year,A.Packing_Dt)),4)) AS Packing_Dt 
   ,IMG.PROD_IMAGE AS PROD_IMAGE,RBM.ORDER_NO,EMP.EMP_NAME Sale_Emp_name,c.ARTICLE_PACK_SIZE,B.LABEL_COPIES
    FROM POM01106 A (NOLOCK)      
    JOIN POD01106 B (NOLOCK) ON A.PO_ID=B.PO_ID    
	JOIN #TMPPID TMP ON TMP.ROW_ID=B.ROW_ID
    JOIN ARTICLE C (NOLOCK) ON B.ARTICLE_CODE=C.ARTICLE_CODE      
   LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
	LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
	LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
	LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
	LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
	LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
	LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
	LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
	LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
	LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
	LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
	LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
	LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
	LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
	LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
	LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
	LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
	LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
	LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
	LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
	LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
	LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
	LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
	LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
	LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
	LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE      
	LEFT JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=B.PRODUCT_CODE    
	LEFT JOIN OEM_MST (NOLOCK) ON A.OEM_CODE=OEM_MST.OEM_CODE    
	JOIN PARA1 P1 (NOLOCK) ON B.PARA1_CODE= P1.PARA1_CODE      
	JOIN PARA2 P2 (NOLOCK) ON B.PARA2_CODE= P2.PARA2_CODE      
	JOIN PARA3 P3 (NOLOCK) ON B.PARA3_CODE= P3.PARA3_CODE      
	JOIN PARA4 P4 (NOLOCK) ON B.PARA4_CODE= P4.PARA4_CODE      
	JOIN PARA5 P5 (NOLOCK) ON B.PARA5_CODE= P5.PARA5_CODE      
	JOIN PARA6 P6 (NOLOCK) ON B.PARA6_CODE= P6.PARA6_CODE      
	JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE      
	JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE      
	JOIN LM01106 LM (NOLOCK) ON A.AC_CODE=LM.AC_CODE    
	JOIN LMP01106 LMP (NOLOCK) ON LM.AC_CODE=LMP.AC_CODE    
	JOIN LMV01106 LMV (NOLOCK) ON LM.AC_CODE=LMV.AC_CODE  
	JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE    
	LEFT OUTER JOIN WSL_ORDER_DET RBD (NOLOCK) ON RBD.ROW_ID=B.WOD_ROW_ID
	LEFT OUTER JOIN WSL_ORDER_MST RBM (NOLOCK) ON RBM.ORDER_ID=RBD.ORDER_ID
	LEFT OUTER JOIN EMPLOYEE EMP (NOLOCK) ON EMP.EMP_CODE =RBD.emp_code
	LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE  '+@cCmdIMG
+ ' ORDER BY B.SRNO ASC'     
 

 END             
        
       
 ELSE    
 IF @NMODE IN ( 3,27)   -- FROM PURCHASE      
 BEGIN    
 ----CONVERT(VARCHAR,A.INV_DT,101) AS INV_DT --- DONE THIS AFTER DISCUSSION WITH TEJENDER ON 14-04-15 (SANJAY)    
 ---- HE IS SAYING THAT THIS FORMAT PREVIOUSLY USED TO COME , CURRENTLY IT'S COMING AS DD-MM-YYYY       


 DECLARE @CCURLOCID VARCHAR(2),@CHODEPT_ID VARCHAR(2)

   SELECT @CCURLOCID=VALUE FROM CONFIG WHERE CONFIG_OPTION ='LOCATION_ID'
   SELECT @CHODEPT_ID=VALUE FROM CONFIG WHERE CONFIG_OPTION ='HO_LOCATION_ID'

   DECLARE @CXN_ID VARCHAR(50)
   SET @CCMD='SELECT TOP 1  @CXN_ID= INV_ID FROM IND01106  B  (NOLOCK) WHERE '+@CROWFILTER  + ' ' 
   PRINT @CCMD
   EXEC SP_EXECUTESQL @CCMD,N'@CXN_ID VARCHAR(50) OUTPUT',@CXN_ID OUTPUT
        
	
  IF @CcurLOCID=@CHODEPT_ID AND isnull(@CXN_ID,'')<>''
  begin

       SET @CCMD = N'SELECT LEFT(b.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX (''@'',b.PRODUCT_CODE)-1,-1),LEN(b.PRODUCT_CODE ))) AS PRODUCT_CODE    
		--,B.FIX_MRP    
		,REPLACE(CONVERT(VARCHAR,CONVERT(NUMERIC(14,2),0)),''.00'','''')FIX_MRP
		,SKU.MRP, ((b.RATE)-CONVERT(NUMERIC(14,2),(b.RATE*b.DISCOUNT_PERCENTAGE/100))) PURCHASE_PRICE, B.NET_RATE AS WS_PRICE
		,((SKU.PURCHASE_PRICE+ ISNULL(SKU_OH.TAX_AMOUNT,0)+ ISNULL(SKU_OH.OTHER_CHARGES,0) 
		  +ISNULL(SKU_OH.ROUND_OFF,0) + ISNULL(SKU_OH.FREIGHT,0))-ISNULL(SKU_OH.DISCOUNT_AMOUNT,0)+ ISNULL(SKU_OH.EXCISE_DUTY_AMOUNT,0)) AS LANDED_COST
		,B.NET_RATE  WHOLESALE_PRICE ,C.ARTICLE_NO ,RIGHT(C.ARTICLE_NO,4)ARTICLE_NO_LAST4 ,C.ARTICLE_NAME    
		,SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME ,U.uom_type AS DISCON,SM.SECTION_NAME,SD.SUB_SECTION_NAME,P1.PARA1_CODE,P1.PARA1_NAME,P2.PARA2_CODE
		,P2.PARA2_NAME,P3.PARA3_CODE ,P3.PARA3_NAME,P4.PARA4_CODE,P4.PARA4_NAME,P4.REMARKS AS PARA4_REMARKS,P5.PARA5_CODE,P5.PARA5_NAME,P6.PARA6_CODE    
		,P6.PARA6_NAME,C.ARTICLE_DESC,LM.AC_NAME,A.BILL_NO AS INV_NO,CONVERT(VARCHAR,A.INV_DT,101) AS INV_DT,A.INV_NO AS CHALLAN_NO ,LM.ALIAS
		,P3.INACTIVE AS PARA3_INACTIVE
		,(RTRIM(LTRIM(STR(MONTH(A.INV_DT)))) + ''/'' + RTRIM(LTRIM(LM.ALIAS)) + ''/''+       
		 RTRIM(LTRIM(STR(YEAR(A.INV_DT))))+ ''9/'' + RTRIM(LTRIM(A.INV_NO)) + ''/''+      
		 RTRIM(LTRIM(STR(DAY(A.INV_DT))))) AS INV_DETAILS    
		,CONVERT(NUMERIC(10,0),SKU.MRP) AS WMRP    
		,SKU.MRP,B.QUANTITY AS QTY,CONVERT(VARCHAR,A.RECEIPT_DT,105) AS RECEIPT_DT,CONVERT(VARCHAR,A.INV_DT,105) AS VANDOR_BILL_DT    
		,U.UOM_NAME,A.AC_CODE,SKU.PRODUCT_NAME,DBO.FN_GETENCRYPTVAL(((b.RATE)-CONVERT(NUMERIC(14,2),(b.RATE*b.DISCOUNT_PERCENTAGE/100)))) AS PUR_PRICE_ENCRYPT
		,DBO.FN_GETENCRYPTVAL(SKU.MRP) AS MRP_ENCRYPT,B.AUTO_SRNO as SRNO ,B.AUTO_SRNO as USER_SRNO
		,DBO.FN_GETENCRYPTVAL((SKU.PURCHASE_PRICE+ ISNULL(SKU_OH.TAX_AMOUNT,0)+ ISNULL(SKU_OH.OTHER_CHARGES,0) +       
		 ISNULL(SKU_OH.ROUND_OFF,0) +  ISNULL(SKU_OH.FREIGHT,0))-  ISNULL(SKU_OH.DISCOUNT_AMOUNT,0)+ ISNULL(SKU_OH.EXCISE_DUTY_AMOUNT,0)) AS LANDED_COST_ENCRYPT
		,CUST.USER_CUSTOMER_CODE, CUST.CUSTOMER_TITLE,CUST.CUSTOMER_FNAME,CUST.CUSTOMER_LNAME,CUST.MOBILE
		,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
		AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
		AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
		AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
		AT25.ATTR25_KEY_NAME 
		,WO.REF_NO AS BUYER_ORDER_REF_NO
	    ,P4.ALIAS AS P4_ALIAS,SKU.ER_FLAG,A.INV_DT AS INV_DT1,A.RECEIPT_DT AS RECEIPT_DT1
	    ,ROUND(B.MRP+(B.MRP*11.2/100),-1) AS SUVIDHAMRP,'''' AS OEM_ID,'''' AS OEM_NAME,'''' AS OEM_ADD1,'''' AS OEM_ADD2,'''' AS OEM_ADD3
	    ,'''' AS OEM_PHONE,'''' AS OEM_EMAIL,'''' AS OEM_WEB, '''' AS INV_MMYY,LMP.ADDRESS0,LMP.ADDRESS1,SKU.VENDOR_EAN_NO,SKU.ONLINE_PRODUCT_CODE
	    ,P1.ALIAS AS PARA1_ALIAS,P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS ,SKU.HSN_CODE,A.MRR_NO
		--22 JUN 18 BY ARUN JI
		--,CASE WHEN PARA3_NAME LIKE ''%-%'' THEN LEFT(PARA3_NAME,LEN(PARA3_NAME)-CHARINDEX(''-'',REVERSE(PARA3_NAME))) ELSE PARA3_NAME END AS PARA3_NAME_NOALIAS    
		,CASE WHEN LEN(LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,''''))))>0 
		           AND RIGHT(LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,''''))),LEN(LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,'''')))))
					   =LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,''''))) 
				   AND LEN(LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,''''))))>LEN(LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,'''')))) 
			  THEN LEFT(LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,''''))),LEN(LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,''''))))-LEN(LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,''''))))-1)    
			  
			  WHEN LEN(LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,''''))))>0 
				   AND RIGHT(LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,'''')))
					        ,LEN(LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,'''')))))
					   =LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,''''))) 
				   AND LEN(LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,''''))))
					  =LEN(LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,'''')))) 
			  THEN LEFT(LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,''''))),LEN(LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,''''))))-LEN(LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,''''))))-0)    
			  
			  ELSE LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,'''')))     
         END AS PARA3_NAME_NOALIAS
        ,SP.SIZEINCHES ,SP.SIZECMS ,SP.REMARKS AS SP_REMARKS ,LMP.ADDRESS0,LMP.ADDRESS1,LMP.ADDRESS2 ,LMV.AREA_NAME,LMV.CITY,LMV.PINCODE,LMV.STATE
        --22 JUN 18 BY ARUN JI
	   ,CAST('''' AS VARCHAR(100)) MERCHANT_NAME ,CAST('''' AS VARCHAR(100)) BUYER_NAME ,CAST('''' AS VARCHAR(100)) JOB_ISSUE_REMARK ,CAST('''' AS VARCHAR(100)) JOBCARD_NO,
	   LM1.AC_NAME,LEFT(DATENAME(MM,MRR_DT),3) + ''-'' + DATENAME(YEAR,MRR_DT) AS PUR_MONTH_YEAR ,
	   DBO.FN_GETENCRYPTVAL(SKU.ws_price) AS WS_PRICE_ENCRYPT,
	   CONVERT(VARCHAR,'''',101) as Packing_Dt,CAST(sku.MRP-(sku.MRP*22/100) AS NUMERIC(14,0)) AS MRP22,
		CAST('''' AS VARCHAR(100)) AS LOCATION_ALIAS,CAST('''' AS VARCHAR(100)) AS HOLD_BACK_MEMO_NO,CONVERT(VARCHAR,'''',105) AS HOLD_BACK_MEMO_DT,
		CAST('''' AS VARCHAR(100)) AS JOB_NAME,CONVERT(VARCHAR,'''',105) AS DELIVERY_DT,
		WO.ORDER_NO,CAST('''' AS VARCHAR(500)) AS Sale_Emp_name,1 as LABEL_COPIES,c.ARTICLE_PACK_SIZE,
		CAST('''' AS VARCHAR(100)) AS Trading_product_code
		FROM PIM01106 A (NOLOCK)        
		JOIN ind01106 B (NOLOCK) ON A.inv_id=B.inv_id    
		JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=B.PRODUCT_CODE 
		JOIN ARTICLE C (NOLOCK) ON sku.ARTICLE_CODE=C.ARTICLE_CODE        
		LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
		LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
		LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
		LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
		LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
		LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
		LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
		LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
		LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
		LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
		LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
		LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
		LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
		LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
		LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
		LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
		LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
		LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
		LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
		LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
		LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
		LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
		LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
		LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
		LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
		LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE           
	    JOIN PARA1 P1 (NOLOCK) ON sku.PARA1_CODE= P1.PARA1_CODE        
		JOIN PARA2 P2 (NOLOCK) ON sku.PARA2_CODE= P2.PARA2_CODE        
		JOIN PARA3 P3 (NOLOCK) ON sku.PARA3_CODE= P3.PARA3_CODE        
		JOIN PARA4 P4 (NOLOCK) ON sku.PARA4_CODE= P4.PARA4_CODE        
		JOIN PARA5 P5 (NOLOCK) ON sku.PARA5_CODE= P5.PARA5_CODE        
		JOIN PARA6 P6 (NOLOCK) ON sku.PARA6_CODE= P6.PARA6_CODE        
		JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
		JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE        
		LEFT OUTER  JOIN LM01106 LM (NOLOCK) ON A.AC_CODE=LM.AC_CODE     
		LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LM.AC_CODE=LMP.AC_CODE   
		JOIN LMV01106 LMV (NOLOCK) ON LM.AC_CODE=LMV.AC_CODE    
		JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE        
		LEFT OUTER JOIN  SKU_BO (NOLOCK) ON B.PRODUCT_CODE= SKU_BO.PRODUCT_CODE      
		LEFT OUTER JOIN WSL_ORDER_MST WO (NOLOCK)  ON SKU_BO.ORDER_ID= WO.ORDER_ID      
		LEFT OUTER JOIN custdym CUST (NOLOCK) ON WO.CUSTOMER_CODE= CUST.CUSTOMER_CODE
		LEFT OUTER JOIN SKU_OH  (NOLOCK) ON SKU_OH.PRODUCT_CODE=SKU.PRODUCT_CODE     
		LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE    
		LEFT JOIN LM01106 LM1(NOLOCK) ON LM1.AC_CODE=SKU.OEM_AC_CODE
		WHERE '+@CROWFILTER  + '  ORDER BY B.AUTO_SRNO ASC'    

  end
  else
  begin

 SET @CCMD = N'SELECT LEFT(b.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX (''@'',b.PRODUCT_CODE)-1,-1),LEN(b.PRODUCT_CODE ))) AS PRODUCT_CODE    
		--,B.FIX_MRP    
		,REPLACE(CONVERT(VARCHAR,CONVERT(NUMERIC(14,2),B.FIX_MRP)),''.00'','''')FIX_MRP
		,SKU.MRP, B.PURCHASE_PRICE, B.WHOLESALE_PRICE AS WS_PRICE
		,((SKU.PURCHASE_PRICE+ ISNULL(SKU_OH.TAX_AMOUNT,0)+ ISNULL(SKU_OH.OTHER_CHARGES,0) 
		  +ISNULL(SKU_OH.ROUND_OFF,0) + ISNULL(SKU_OH.FREIGHT,0))-ISNULL(SKU_OH.DISCOUNT_AMOUNT,0)+ ISNULL(SKU_OH.EXCISE_DUTY_AMOUNT,0)) AS LANDED_COST
		,B.WHOLESALE_PRICE ,C.ARTICLE_NO ,RIGHT(C.ARTICLE_NO,4)ARTICLE_NO_LAST4 ,C.ARTICLE_NAME    
		,SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME ,U.uom_type AS DISCON,SM.SECTION_NAME,SD.SUB_SECTION_NAME,P1.PARA1_CODE,P1.PARA1_NAME,P2.PARA2_CODE
		,P2.PARA2_NAME,P3.PARA3_CODE ,P3.PARA3_NAME,P4.PARA4_CODE,P4.PARA4_NAME,P4.REMARKS AS PARA4_REMARKS,P5.PARA5_CODE,P5.PARA5_NAME,P6.PARA6_CODE    
		,P6.PARA6_NAME,C.ARTICLE_DESC,LM.AC_NAME,A.BILL_NO AS INV_NO,CONVERT(VARCHAR,A.INV_DT,101) AS INV_DT,A.INV_NO AS CHALLAN_NO ,LM.ALIAS
		,P3.INACTIVE AS PARA3_INACTIVE
		,(RTRIM(LTRIM(STR(MONTH(A.INV_DT)))) + ''/'' + RTRIM(LTRIM(LM.ALIAS)) + ''/''+       
		 RTRIM(LTRIM(STR(YEAR(A.INV_DT))))+ ''9/'' + RTRIM(LTRIM(A.INV_NO)) + ''/''+      
		 RTRIM(LTRIM(STR(DAY(A.INV_DT))))) AS INV_DETAILS    
		,CONVERT(NUMERIC(10,0),SKU.MRP) AS WMRP    
		,SKU.MRP,B.QUANTITY AS QTY,CONVERT(VARCHAR,A.RECEIPT_DT,105) AS RECEIPT_DT,CONVERT(VARCHAR,A.INV_DT,105) AS VANDOR_BILL_DT    
		,U.UOM_NAME,A.AC_CODE,SKU.PRODUCT_NAME,DBO.FN_GETENCRYPTVAL(B.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT
		,DBO.FN_GETENCRYPTVAL(SKU.MRP) AS MRP_ENCRYPT,B.SRNO ,B.USER_SRNO
		,DBO.FN_GETENCRYPTVAL((SKU.PURCHASE_PRICE+ ISNULL(SKU_OH.TAX_AMOUNT,0)+ ISNULL(SKU_OH.OTHER_CHARGES,0) +       
		 ISNULL(SKU_OH.ROUND_OFF,0) +  ISNULL(SKU_OH.FREIGHT,0))-  ISNULL(SKU_OH.DISCOUNT_AMOUNT,0)+ ISNULL(SKU_OH.EXCISE_DUTY_AMOUNT,0)) AS LANDED_COST_ENCRYPT
		,CUST.USER_CUSTOMER_CODE, CUST.CUSTOMER_TITLE,CUST.CUSTOMER_FNAME,CUST.CUSTOMER_LNAME,CUST.MOBILE
		,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
		AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
		AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
		AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
		AT25.ATTR25_KEY_NAME 
		,WO.REF_NO AS BUYER_ORDER_REF_NO
	    ,P4.ALIAS AS P4_ALIAS,SKU.ER_FLAG,A.INV_DT AS INV_DT1,A.RECEIPT_DT AS RECEIPT_DT1
	    ,ROUND(B.MRP+(B.MRP*11.2/100),-1) AS SUVIDHAMRP,'''' AS OEM_ID,'''' AS OEM_NAME,'''' AS OEM_ADD1,'''' AS OEM_ADD2,'''' AS OEM_ADD3
	    ,'''' AS OEM_PHONE,'''' AS OEM_EMAIL,'''' AS OEM_WEB, '''' AS INV_MMYY,LMP.ADDRESS0,LMP.ADDRESS1,SKU.VENDOR_EAN_NO,SKU.ONLINE_PRODUCT_CODE
	    ,P1.ALIAS AS PARA1_ALIAS,P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS ,SKU.HSN_CODE,A.MRR_NO
		--22 JUN 18 BY ARUN JI
		--,CASE WHEN PARA3_NAME LIKE ''%-%'' THEN LEFT(PARA3_NAME,LEN(PARA3_NAME)-CHARINDEX(''-'',REVERSE(PARA3_NAME))) ELSE PARA3_NAME END AS PARA3_NAME_NOALIAS    
		,CASE WHEN LEN(LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,''''))))>0 
		           AND RIGHT(LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,''''))),LEN(LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,'''')))))
					   =LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,''''))) 
				   AND LEN(LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,''''))))>LEN(LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,'''')))) 
			  THEN LEFT(LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,''''))),LEN(LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,''''))))-LEN(LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,''''))))-1)    
			  
			  WHEN LEN(LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,''''))))>0 
				   AND RIGHT(LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,'''')))
					        ,LEN(LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,'''')))))
					   =LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,''''))) 
				   AND LEN(LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,''''))))
					  =LEN(LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,'''')))) 
			  THEN LEFT(LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,''''))),LEN(LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,''''))))-LEN(LTRIM(RTRIM(ISNULL(LM.ALIAS_TO_BE_SUFFIXED,''''))))-0)    
			  
			  ELSE LTRIM(RTRIM(ISNULL(P3.PARA3_NAME,'''')))     
         END AS PARA3_NAME_NOALIAS
        ,SP.SIZEINCHES ,SP.SIZECMS ,SP.REMARKS AS SP_REMARKS ,LMP.ADDRESS0,LMP.ADDRESS1,LMP.ADDRESS2 ,LMV.AREA_NAME,LMV.CITY,LMV.PINCODE,LMV.STATE
        --22 JUN 18 BY ARUN JI
   ,CAST('''' AS VARCHAR(100)) MERCHANT_NAME ,CAST('''' AS VARCHAR(100)) BUYER_NAME ,CAST('''' AS VARCHAR(100)) JOB_ISSUE_REMARK ,CAST('''' AS VARCHAR(100)) JOBCARD_NO,
   LM1.AC_NAME,LEFT(DATENAME(MM,MRR_DT),3) + ''-'' + DATENAME(YEAR,MRR_DT) AS PUR_MONTH_YEAR ,
   DBO.FN_GETENCRYPTVAL(SKU.ws_price) AS WS_PRICE_ENCRYPT,
   CONVERT(VARCHAR,'''',101) as Packing_Dt,
   CAST(sku.MRP-(sku.MRP*22/100) AS NUMERIC(14,0)) AS MRP22,
   CAST('''' AS VARCHAR(100)) AS LOCATION_ALIAS,CAST('''' AS VARCHAR(100)) AS HOLD_BACK_MEMO_NO,CONVERT(VARCHAR,'''',105) AS HOLD_BACK_MEMO_DT,
   CAST('''' AS VARCHAR(100)) AS JOB_NAME,CONVERT(VARCHAR,'''',105) AS DELIVERY_DT,
   IMG.PROD_IMAGE AS PROD_IMAGE,WO.ORDER_NO,CAST('''' AS VARCHAR(500)) AS Sale_Emp_name,B.LABEL_COPIES,c.ARTICLE_PACK_SIZE,
   CAST('''' AS VARCHAR(100)) AS Trading_product_code
FROM PIM01106 A (NOLOCK)        
JOIN PID01106 B (NOLOCK) ON A.MRR_ID=B.MRR_ID        
JOIN ARTICLE C (NOLOCK) ON B.ARTICLE_CODE=C.ARTICLE_CODE        
LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE        
		JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=B.PRODUCT_CODE      
	    JOIN PARA1 P1 (NOLOCK) ON B.PARA1_CODE= P1.PARA1_CODE        
		JOIN PARA2 P2 (NOLOCK) ON B.PARA2_CODE= P2.PARA2_CODE        
		JOIN PARA3 P3 (NOLOCK) ON B.PARA3_CODE= P3.PARA3_CODE        
		JOIN PARA4 P4 (NOLOCK) ON B.PARA4_CODE= P4.PARA4_CODE        
		JOIN PARA5 P5 (NOLOCK) ON B.PARA5_CODE= P5.PARA5_CODE        
		JOIN PARA6 P6 (NOLOCK) ON B.PARA6_CODE= P6.PARA6_CODE        
		JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
		JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE        
		LEFT OUTER  JOIN LM01106 LM (NOLOCK) ON A.AC_CODE=LM.AC_CODE     
		LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LM.AC_CODE=LMP.AC_CODE   
		JOIN LMV01106 LMV (NOLOCK) ON LM.AC_CODE=LMV.AC_CODE    
		JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE        
		LEFT OUTER JOIN  SKU_BO (NOLOCK) ON B.PRODUCT_CODE= SKU_BO.PRODUCT_CODE      
		LEFT OUTER JOIN WSL_ORDER_MST WO (NOLOCK)  ON SKU_BO.ORDER_ID= WO.ORDER_ID      
		LEFT OUTER JOIN custdym CUST (NOLOCK) ON WO.CUSTOMER_CODE= CUST.CUSTOMER_CODE      
		LEFT OUTER JOIN SKU_OH  (NOLOCK) ON SKU_OH.PRODUCT_CODE=SKU.PRODUCT_CODE     
		LEFT OUTER JOIN UOM AR_U (NOLOCK) ON AR_U.UOM_CODE=B.AREA_UOM_CODE    
		LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE    
		LEFT JOIN LM01106 LM1(NOLOCK) ON LM1.AC_CODE=SKU.OEM_AC_CODE '+@cCmdIMG+'
		WHERE '+@CROWFILTER  + '   ORDER BY B.SRNO ASC'    
		--B.PRODUCT_CODE,B.SRNO       
	END   
	
	end          
      
 ELSE    
 IF @NMODE = 5   -- FROM ITEM RATE REVISION MODULE --WHEN A.TYPE<>1 THEN B.PRODUCT_CODE  CHANGES BY 13.2.15     
 BEGIN       


 SET @CCMD = N'SELECT (CASE WHEN ISNULL(B.NEW_PRODUCT_CODE,'''')='''' THEN LEFT(b.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX (''@'',b.PRODUCT_CODE)-1,-1),LEN(b.PRODUCT_CODE )))   
         ELSE LEFT(b.NEW_PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX (''@'',b.NEW_PRODUCT_CODE)-1,-1),LEN(b.NEW_PRODUCT_CODE ))) END)  AS PRODUCT_CODE,     
   CONVERT(NUMERIC(10,0),B.NEW_MRP) AS WMRP,B.NEW_MRP AS MRP,S.PURCHASE_PRICE, B.NEW_WSP AS WS_PRICE,     
   C.ARTICLE_NO, C.ARTICLE_NAME, S.BARCODE_CODING_SCHEME AS CODING_SCHEME,    
   U.uom_type AS DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,     
   P2.PARA2_CODE, P2.PARA2_NAME,  P3.PARA3_CODE, P3.PARA3_NAME,    
   P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME,     
   P6.PARA6_CODE, P6.PARA6_NAME,  
   RIGHT(C.ARTICLE_NO,4)ARTICLE_NO_LAST4,      
   C.ARTICLE_DESC, LM.AC_NAME, S.INV_NO,      
   CONVERT(VARCHAR,S.INV_DT,103) AS INV_DT,    
   A.IRM_MEMO_DT AS INV_DT1,    
   S.INV_DT AS BARCODE_INV_DT,    
   S.INV_DT AS BARCODE_INV_DT, S.INV_NO AS CHALLAN_NO, LM.ALIAS,P3.INACTIVE AS PARA3_INACTIVE,      
   SPACE(100) AS INV_DETAILS, (CASE WHEN ISNULL(B.QUANTITY ,0)=0 THEN 1 ELSE B.QUANTITY END ) AS QTY,CONVERT(VARCHAR,A.IRM_MEMO_DT,105) AS RECEIPT_DT,    
   CONVERT(VARCHAR,A.IRM_MEMO_DT,105) AS VANDOR_BILL_DT ,U.UOM_NAME,S.AC_CODE,S.PRODUCT_NAME,    
   DBO.FN_GETENCRYPTVAL(S.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT,A.IRM_MEMO_ID,A.IRM_MEMO_NO,    
   B.OLD_MRP,B.OLD_WSP
   ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
AT25.ATTR25_KEY_NAME  
   ,P4.ALIAS AS P4_ALIAS,S.ER_FLAG,   
   LM.AREA_NAME,LM.CITY,LM.PINCODE,LM.STATE,  
      LMP.ADDRESS0,  
   LMP.ADDRESS1,  
   LMP.ADDRESS2,    
   S.ONLINE_PRODUCT_CODE,S.VENDOR_EAN_NO, P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,     
   P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS ,S.HSN_CODE,    
   P4.REMARKS AS PARA4_REMARKS    
            --,S.FIX_MRP    
            ,REPLACE(CONVERT(VARCHAR,CONVERT(NUMERIC(18,2),S.FIX_MRP)),''.00'','''')  AS FIX_MRP    
   --22 JUN 18 BY ARUN JI    
   ,CASE WHEN RTRIM(LTRIM(PARA3_NAME)) LIKE ''%-%'' THEN LEFT(RTRIM(LTRIM(PARA3_NAME)),LEN(RTRIM(LTRIM(PARA3_NAME)))-CHARINDEX(''-'',REVERSE(RTRIM(LTRIM(PARA3_NAME))))) ELSE RTRIM(LTRIM(PARA3_NAME)) END AS PARA3_NAME_NOALIAS    
   --22 JUN 18 BY ARUN JI     
   ,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS   ,
   LEFT(DATENAME(MM,IRM_MEMO_DT),3) + ''-'' + DATENAME(YEAR,IRM_MEMO_DT) AS PUR_MONTH_YEAR,B.label_copies,c.ARTICLE_PACK_SIZE
  
   FROM IRM01106 A (NOLOCK)      
   JOIN IRD01106 B (NOLOCK) ON A.IRM_MEMO_ID = B.IRM_MEMO_ID     
   JOIN SKU S (NOLOCK) ON S.PRODUCT_CODE=(CASE WHEN ISNULL(B.NEW_PRODUCT_CODE,'''')=''''     
              THEN B.PRODUCT_CODE    
              ELSE B.NEW_PRODUCT_CODE END)    
   JOIN ARTICLE C (NOLOCK) ON B.ARTICLE_CODE=C.ARTICLE_CODE      
   LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE        
   JOIN PARA1 P1 (NOLOCK) ON B.PARA1_CODE= P1.PARA1_CODE      
   JOIN PARA2 P2 (NOLOCK) ON B.PARA2_CODE= P2.PARA2_CODE      
   JOIN PARA3 P3 (NOLOCK) ON B.PARA3_CODE= P3.PARA3_CODE      
   JOIN PARA4 P4 (NOLOCK) ON B.PARA4_CODE= P4.PARA4_CODE      
   JOIN PARA5 P5 (NOLOCK) ON B.PARA5_CODE= P5.PARA5_CODE      
   JOIN PARA6 P6 (NOLOCK) ON B.PARA6_CODE= P6.PARA6_CODE      
   JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE      
   JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE     
   LEFT OUTER JOIN LMV01106 LM (NOLOCK) ON LM.AC_CODE=S.AC_CODE   
   LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LM.AC_CODE=LMP.AC_CODE    
   JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE      
   LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE 
   WHERE '+@CROWFILTER  +'  ORDER BY B.SRNO'    
          
 END      
     
 ELSE    
 IF @NMODE = 6   -- FROM SPLIT COMBINE  (MULTIPLE OUTPUT)    
 BEGIN       
  SET @CCMD = N'SELECT B.PRODUCT_CODE, SKU.MRP, SKU.PURCHASE_PRICE, SKU.WS_PRICE,    
             C.ARTICLE_NO, C.ARTICLE_NAME, SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME,       
                U.uom_type AS DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,    
      P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME,     
     P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME,    
     P6.PARA6_CODE, P6.PARA6_NAME,  C.ARTICLE_DESC,LM.AC_NAME, A.MEMO_NO  AS INV_NO,      
     CONVERT(VARCHAR,A.MEMO_DT,105) AS INV_DT, A.MEMO_NO AS CHALLAN_NO, LM.ALIAS,     
     P3.INACTIVE AS PARA3_INACTIVE, '''' AS INV_DETAILS,          
     CONVERT(NUMERIC(10,0),SKU.MRP) AS WMRP,SKU.MRP,B.QUANTITY AS QTY,''''AS RECEIPT_DT,    
     '''' VANDOR_BILL_DT,U.UOM_NAME,SKU.AC_CODE,SKU.PRODUCT_NAME,    
     DBO.FN_GETENCRYPTVAL(SKU.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT
     ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
AT25.ATTR25_KEY_NAME  
     ,SKU.ER_FLAG    
   , P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,     
             P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS     
             ,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS   LEFT(DATENAME(MM,MEMO_DT),3) + ''-'' + DATENAME(YEAR,MEMO_DT) AS PUR_MONTH_YEAR 
     FROM SCM01106 A (NOLOCK)      
     JOIN SCF01106 B (NOLOCK) ON A.MEMO_ID=B.MEMO_ID      
     JOIN SKU SKU (NOLOCK) ON B.PRODUCT_CODE = SKU.PRODUCT_CODE     
     JOIN ARTICLE C (NOLOCK) ON SKU.ARTICLE_CODE=C.ARTICLE_CODE      
     LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE        
     JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE      
     JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE      
     JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE      
     JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE      
     JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE      
     JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE      
     JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE      
     JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE      
     JOIN LM01106 LM (NOLOCK) ON SKU.AC_CODE=LM.AC_CODE    
     JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE    
     LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE    
     WHERE '+@CROWFILTER      
         
         
 END       
     
     
      
  ELSE      
 IF @NMODE = 7   -- FROM FIX CODE RATE REVISION      
 BEGIN         
  SET @CCMD = N'SELECT DISTINCT B.PRODUCT_CODE, SKU.PURCHASE_PRICE, LD.NEW_WSP AS WS_PRICE,      
    C.ARTICLE_NO, C.ARTICLE_NAME, SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME,    
    C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,      
    P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME,       
    P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME,      
    P6.PARA6_CODE, P6.PARA6_NAME,  C.ARTICLE_DESC,LM.AC_NAME, A.MEMO_NO  AS INV_NO,        
    CONVERT(VARCHAR,A.MEMO_DT,105) AS INV_DT, A.MEMO_NO AS CHALLAN_NO, LM.ALIAS,       
    P3.INACTIVE AS PARA3_INACTIVE, B.VENDER_ID AS INV_DETAILS,            
    CONVERT(NUMERIC(10,0),SKU.MRP) AS WMRP,LD.NEW_MRP AS MRP,B.QUANTITY AS QTY,''AS RECEIPT_DT,      
    '''' VANDOR_BILL_DT,U.UOM_NAME,SKU.AC_CODE,SKU.PRODUCT_NAME,    
    DBO.FN_GETENCRYPTVAL(SKU.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT,LD.NEW_FIX_MRP AS FIX_MRP
    ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
AT25.ATTR25_KEY_NAME      
    ,SKU.ER_FLAG, P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,     
                P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS    
                ,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS     
    FROM FIXITEM_RATE_REVISION_MST A (NOLOCK)     
    JOIN FIXITEM_RATE_REVISION_DET B (NOLOCK) ON A.MEMO_ID=B.MEMO_ID    
    JOIN FIXITEM_RATE_REVISION_LOC_DET LD ON B.ROW_ID= LD.REF_ROW_ID         
    JOIN SKU SKU (NOLOCK) ON B.PRODUCT_CODE = SKU.PRODUCT_CODE       
    JOIN ARTICLE C (NOLOCK) ON SKU.ARTICLE_CODE=C.ARTICLE_CODE        
    LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE          
    JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE        
    JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE       
    JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE        
    JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE        
    JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE        
    JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE        
    JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
    JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE        
    JOIN LM01106 LM (NOLOCK) ON SKU.AC_CODE=LM.AC_CODE      
    JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE     
    LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE         
    WHERE '+@CROWFILTER        
           
           
 END       
     
 ELSE      
 IF @NMODE = 8   -- FROM PRODUCTION BARCODE GENERATION      
 BEGIN         
  SET @CCMD = N'SELECT DISTINCT B.PRODUCT_CODE, SKU.PURCHASE_PRICE, SKU.WS_PRICE,      
    C.ARTICLE_NO, C.ARTICLE_NAME, SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME,    
    C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,      
    P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME,       
    P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME,      
    P6.PARA6_CODE, P6.PARA6_NAME,  C.ARTICLE_DESC,LM.AC_NAME, A.MEMO_NO  AS INV_NO,        
    CONVERT(VARCHAR,A.MEMO_DT,105) AS INV_DT, A.MEMO_NO AS CHALLAN_NO, LM.ALIAS,       
    P3.INACTIVE AS PARA3_INACTIVE, '''' AS INV_DETAILS,            
    CONVERT(NUMERIC(10,0),SKU.MRP) AS WMRP,SKU.MRP,B.QUANTITY AS QTY,''''AS RECEIPT_DT,      
    '''' VANDOR_BILL_DT,U.UOM_NAME,SKU.AC_CODE,SKU.PRODUCT_NAME
    ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
AT25.ATTR25_KEY_NAME    
    ,SKU.ER_FLAG    
    , P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,     
                P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS    
                ,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS     
    FROM PRD_STK_TRANSFER_DTM_MST A (NOLOCK)     
    JOIN PRD_STK_TRANSFER_DTM_DET B (NOLOCK) ON A.MEMO_ID=B.MEMO_ID       
    JOIN SKU SKU (NOLOCK) ON B.PRODUCT_CODE = SKU.PRODUCT_CODE       
    JOIN ARTICLE C (NOLOCK) ON SKU.ARTICLE_CODE=C.ARTICLE_CODE        
    LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE          
    JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE        
    JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE        
    JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE        
    JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE        
    JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE        
    JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE        
    JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
    JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE        
    JOIN LM01106 LM (NOLOCK) ON SKU.AC_CODE=LM.AC_CODE      
    JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE    
    LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE            
    WHERE '+@CROWFILTER  + ' ORDER BY B.PRODUCT_CODE'      
           
           
 END       
     
     
     
 ELSE    
 IF @NMODE = 9   -- FROM PRODUCTION PURCHASE      
 BEGIN       
  SET @CCMD = N' SELECT B.PRODUCT_UID AS PRODUCT_CODE, B.MRP, B.PURCHASE_PRICE, B.WHOLESALE_PRICE AS WS_PRICE,      
     B.WHOLESALE_PRICE, C.ARTICLE_NO, C.ARTICLE_NAME, C.CODING_SCHEME,         
      C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,      
      P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME,       
      P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME,      
      P6.PARA6_CODE, P6.PARA6_NAME,  C.ARTICLE_DESC,LM.AC_NAME, A.BILL_NO AS INV_NO,        
      CONVERT(VARCHAR,A.INV_DT,105) AS INV_DT, A.INV_NO AS CHALLAN_NO, LM.ALIAS, P3.INACTIVE AS PARA3_INACTIVE,         
      (RTRIM(LTRIM(STR(MONTH(A.INV_DT)))) + ''/'' + RTRIM(LTRIM(LM.ALIAS)) + ''/''+       
       RTRIM(LTRIM(STR(YEAR(A.INV_DT))))+ ''9/'' + RTRIM(LTRIM(A.INV_NO)) + ''/''+      
       RTRIM(LTRIM(STR(DAY(A.INV_DT))))) AS INV_DETAILS,            
      CONVERT(NUMERIC(10,0),B.MRP) AS WMRP,B.MRP,B.QUANTITY AS QTY,CONVERT(VARCHAR,A.RECEIPT_DT,105) AS RECEIPT_DT,      
      CONVERT(VARCHAR,A.INV_DT,105) AS VANDOR_BILL_DT,U.UOM_NAME,A.AC_CODE,'''' AS PRODUCT_NAME
      ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
AT25.ATTR25_KEY_NAME       
      ,WO.MEMO_NO AS WORK_ORDER_NO , WO.REF_NO, WOA.ARTICLE_NO AS SET_NO    
       ,EMP.EMP_FNAME + '' '' +  EMP.EMP_LNAME AS PC_NAME,B.PRODUCT_CODE    
      , P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,     
      P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS    
      ,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS     
      FROM PRD_PIM01106 A (NOLOCK)        
      JOIN PRD_PID01106 B (NOLOCK) ON A.MRR_ID=B.MRR_ID        
      JOIN ARTICLE C (NOLOCK) ON B.ARTICLE_CODE=C.ARTICLE_CODE        
     LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE         
      LEFT OUTER JOIN PRD_SKU SKU (NOLOCK) ON SKU.PRODUCT_UID=B.PRODUCT_UID      
      JOIN PARA1 P1 (NOLOCK) ON B.PARA1_CODE= P1.PARA1_CODE        
      JOIN PARA2 P2 (NOLOCK) ON B.PARA2_CODE= P2.PARA2_CODE        
      JOIN PARA3 P3 (NOLOCK) ON B.PARA3_CODE= P3.PARA3_CODE        
      JOIN PARA4 P4 (NOLOCK) ON B.PARA4_CODE= P4.PARA4_CODE        
      JOIN PARA5 P5 (NOLOCK) ON B.PARA5_CODE= P5.PARA5_CODE        
      JOIN PARA6 P6 (NOLOCK) ON B.PARA6_CODE= P6.PARA6_CODE        
      JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
      JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE        
      JOIN LM01106 LM (NOLOCK) ON A.AC_CODE=LM.AC_CODE      
      JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE        
      LEFT OUTER JOIN PRD_WO_MST WO ON WO.MEMO_ID=SKU.WORK_ORDER_ID    
      LEFT OUTER JOIN ARTICLE WOA ON WOA.ARTICLE_CODE=WO.ARTICLE_SET_CODE    
      LEFT OUTER JOIN EMP_MST EMP ON EMP.EMP_ID=WO.EMP_CODE    
      LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE      
      WHERE '+@CROWFILTER  + ' ORDER BY B.PRODUCT_UID,B.SRNO  '      
 END            
                       
IF @NMODE =10   -- FROM SALESETUP       
 BEGIN         

     

	 	
SET @CCMD=N'SELECT SKU.INV_NO, 
     CONVERT(NUMERIC(10,0),BC.DISCOUNT_FIGURE) AS DISCOUNT_FIGURE,
       BC.SCHEME_SETUP_DET_ROW_ID,BC.ROW_ID,
       BC.COMPANY_CODE,BC.LAST_UPDATE,
       CONVERT(NUMERIC(10,0),BC.DISCOUNT_PERCENTAGE) AS DISCOUNT_PERCENTAGE,
       BC.DISCOUNT_AMOUNT,
       CONVERT(NUMERIC(10,0),BC.NET_PRICE) AS NET_PRICE,
       BC.PRODUCT_CODE,
       BC.OLD_MD_PERCENTAGE,BC.NEW_MD_PERCENTAGE,
       BC.DISCOUNT_MODE,BC.PRN,BC.QUANTITY,
       BC.ADDITIONAL_DISCOUNT_PERCENTAGE,
   
   (CASE WHEN BC.DISCOUNT_MODE = 1 THEN ''PCT'' 
	WHEN BC.DISCOUNT_MODE = 2 THEN ''NET'' 
	WHEN BC.DISCOUNT_MODE = 3 THEN ''AMT'' ELSE '''' END ) AS DISC_TYPE,
	BC.DISCOUNT_MODE,ARTICLE_NAME,ARTICLE_NO
	,SKU.MRP,SKU.PURCHASE_PRICE, SECTIOND.SUB_SECTION_NAME, SECTIONM.SECTION_NAME
	,PARA1.PARA1_NAME,PARA1.PARA1_CODE
	,PARA2.PARA2_NAME,PARA2.PARA2_CODE
	,PARA3.PARA3_NAME,PARA3.PARA3_CODE  
	,PARA4.PARA4_NAME,PARA4.PARA4_CODE
	,PARA5.PARA5_NAME,PARA5.PARA5_CODE
	,PARA6.PARA6_NAME,PARA6.PARA6_CODE,DISCON,ISNULL(LM.ALIAS,'''') AS PARTY_ALIAS,
	RTRIM(LTRIM(STR(MONTH(SKU.INV_DT)))) + ''/'' + RTRIM(LTRIM(STR(YEAR(SKU.INV_DT))))  AS INV_MONTH ,
	SKU.INV_NO,LM.ALIAS AS  ALIAS
	,(CASE WHEN ISNULL(IRD.PRODUCT_CODE,'''')='''' THEN BC.PRODUCT_CODE ELSE IRD.PRODUCT_CODE END) AS OLD_PRODUCT_CODE,
	SKU.HSN_CODE,CAST(0 AS NUMERIC(10,2)) AS CALCDISCOUNTPERCENTAGE,
	CAST(0 AS NUMERIC(10,2)) AS CALCDISCOUNTAMOUNT,
	CAST(0 AS NUMERIC(10,2)) AS CALCNETPRICE	
	FROM SCHEME_SETUP_SLSBC BC (NOLOCK) 
	JOIN SCHEME_SETUP_DET DET ON BC.SCHEME_SETUP_DET_ROW_ID = DET.ROW_ID 
	JOIN SCHEME_SETUP_MST MST ON DET.MEMO_NO = MST.MEMO_NO
	JOIN SKU (NOLOCK) ON BC.PRODUCT_CODE = SKU.PRODUCT_CODE
	LEFT OUTER JOIN IRD01106 IRD (NOLOCK) ON IRD.NEW_PRODUCT_CODE = BC.PRODUCT_CODE  
	LEFT JOIN ARTICLE (NOLOCK) ON SKU.ARTICLE_CODE = ARTICLE.ARTICLE_CODE
	LEFT JOIN SECTIOND (NOLOCK) ON ARTICLE.SUB_SECTION_CODE = SECTIOND.SUB_SECTION_CODE
	LEFT JOIN SECTIONM (NOLOCK) ON SECTIOND.SECTION_CODE = SECTIONM.SECTION_CODE 
	LEFT JOIN PARA1 ON PARA1.PARA1_CODE = SKU.PARA1_CODE
	LEFT JOIN PARA2 ON PARA2.PARA2_CODE = SKU.PARA2_CODE
	LEFT JOIN PARA3 ON PARA3.PARA3_CODE = SKU.PARA3_CODE
	LEFT JOIN PARA4 ON PARA4.PARA4_CODE = SKU.PARA4_CODE
	LEFT JOIN PARA5 ON PARA5.PARA5_CODE = SKU.PARA5_CODE
	LEFT JOIN PARA6 ON PARA6.PARA6_CODE = SKU.PARA6_CODE
	JOIN LM01106 LM ON LM.AC_CODE=SKU.AC_CODE
	LEFT OUTER JOIN LMP01106 LMP ON LMP.AC_CODE=LM.AC_CODE
	WHERE  '+@CROWFILTER+' ORDER BY BC.PRODUCT_CODE'
	

 --as per anil sir discarded this query
--  SET @CCMD =  'SELECT A.PRODUCT_CODE, S.MRP, S.PURCHASE_PRICE, S.WS_PRICE,       
--    C.ARTICLE_NO, C.ARTICLE_NAME, S.BARCODE_CODING_SCHEME AS CODING_SCHEME,    
--    C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,      
--P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME,       
--    P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME,      
--    P6.PARA6_CODE, P6.PARA6_NAME,  C.ARTICLE_DESC,LM.AC_NAME, S.INV_NO,        
--    CONVERT(VARCHAR,S.INV_DT,105) AS INV_DT, S.INV_NO AS CHALLAN_NO, LM.ALIAS, P3.INACTIVE AS PARA3_INACTIVE,         
--    (RTRIM(LTRIM(STR(MONTH(S.INV_DT)))) + ''/'' + RTRIM(LTRIM(LM.ALIAS)) + ''/''+       
--    RTRIM(LTRIM(STR(YEAR(S.INV_DT))))+ ''9/'' + RTRIM(LTRIM(S.INV_NO)) + ''/''+      
--    RTRIM(LTRIM(STR(DAY(S.INV_DT))))) AS INV_DETAILS,            
--    ISNULL(PMT.QUANTITY_IN_STOCK,0) AS QTY,U.UOM_NAME ,      
--    RTRIM(LTRIM(STR(MONTH(S.INV_DT)))) + ''/'' + RTRIM(LTRIM(STR(YEAR(S.INV_DT))))  AS INV_MONTH,      
--    RTRIM(LTRIM(STR(MONTH(GETDATE())))) + ''/'' + RTRIM(LTRIM(STR(YEAR(GETDATE()))))  AS SYSTEM_MONTH,      
--    DBO.FN_GETENCRYPTVAL(S.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT,    
--    A.SLS_MEMO_NO,A.DISCOUNT_PERCENTAGE,A.NET_PRICE,A.SLSDET_ROW_ID,A.ROW_ID,A.DISCOUNT_AMOUNT,X.AVGDISCPER,    
--    CONVERT(NUMERIC(14,2),S.MRP-(S.MRP*(X.AVGDISCPER/100))) AS MRP_AFTER_DISCPER,    
--    S.MRP-A.DISCOUNT_AMOUNT AS MRP_AFTER_DISCAMT ,S.ER_FLAG     
--    ,'''' AS USER_SRNO,A.QUANTITY    
--    , P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,     
--                P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS     
--                ,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS    
--    FROM SLSBC A (NOLOCK)        
--    JOIN SLSMST B (NOLOCK) ON A.SLS_MEMO_NO=B.SLS_MEMO_NO    
--    JOIN SKU S (NOLOCK) ON S.PRODUCT_CODE=A.PRODUCT_CODE          
--    JOIN ARTICLE C (NOLOCK) ON S.ARTICLE_CODE=C.ARTICLE_CODE         
--    JOIN PARA1 P1 (NOLOCK) ON S.PARA1_CODE= P1.PARA1_CODE        
--    JOIN PARA2 P2 (NOLOCK) ON S.PARA2_CODE= P2.PARA2_CODE        
--    JOIN PARA3 P3 (NOLOCK) ON S.PARA3_CODE= P3.PARA3_CODE        
--    JOIN PARA4 P4 (NOLOCK) ON S.PARA4_CODE= P4.PARA4_CODE        
--    JOIN PARA5 P5 (NOLOCK) ON S.PARA5_CODE= P5.PARA5_CODE        
--    JOIN PARA6 P6 (NOLOCK) ON S.PARA6_CODE= P6.PARA6_CODE        
--    JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
--    JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE        
--    JOIN LM01106 LM (NOLOCK) ON S.AC_CODE=LM.AC_CODE      
--    JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE    
--    LEFT OUTER JOIN (SELECT PRODUCT_CODE,DEPT_ID,SUM(ISNULL(QUANTITY_IN_STOCK,0)) AS QUANTITY_IN_STOCK FROM PMT01106 (NOLOCK)    
--                     WHERE DEPT_ID = '''+@CLOCID+''' GROUP BY PRODUCT_CODE,DEPT_ID) PMT    
--                     ON PMT.PRODUCT_CODE=S.PRODUCT_CODE    
--    JOIN    
--    (    
--     SELECT ROW_ID,DBO.FN_CALCULATEDISCPER(DISCOUNT_PERCENTAGE,  0,0) AS AVGDISCPER    
--     FROM SLSBC A WHERE '+@CROWFILTER   + '    
--    )X ON X.ROW_ID=A.ROW_ID    
--    LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE    
--    WHERE '+@CROWFILTER+' ORDER BY A.PRODUCT_CODE'       
	


 END      
      
      
 ELSE    
 IF @NMODE = 11   -- FROM WSL      
 BEGIN      
 
  --select @CROWFILTER
  --return


  
  SET @CCMD = N' SELECT B.PRODUCT_CODE
    , SKU.FIX_MRP,SKU.MRP, SKU.PURCHASE_PRICE, B.RATE AS WS_PRICE,    
     C.ARTICLE_NO, C.ARTICLE_NAME, SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME,    
      C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,    
      P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME,     
      P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME,    
      P6.PARA6_CODE, P6.PARA6_NAME,  C.ARTICLE_DESC,LM.AC_NAME, SKU.INV_NO AS INV_NO,      
      CONVERT(VARCHAR,SKU.INV_DT,105) AS INV_DT, SKU.INV_NO AS CHALLAN_NO, LM.ALIAS, P3.INACTIVE AS PARA3_INACTIVE,       
      (RTRIM(LTRIM(STR(MONTH(SKU.INV_DT)))) + ''/'' + RTRIM(LTRIM(LM.ALIAS)) + ''/''+     
       RTRIM(LTRIM(STR(YEAR(SKU.INV_DT))))+ ''9/'' + RTRIM(LTRIM(SKU.INV_NO)) + ''/''+    
       RTRIM(LTRIM(STR(DAY(SKU.INV_DT))))) AS INV_DETAILS,          
      CONVERT(NUMERIC(10,0),B.MRP) AS WMRP,B.MRP,B.QUANTITY AS QTY,CONVERT(VARCHAR,SKU.RECEIPT_DT,105) AS RECEIPT_DT,    
      ''''VANDOR_BILL_DT,U.UOM_NAME,A.AC_CODE,SKU.PRODUCT_NAME,    
      DBO.FN_GETENCRYPTVAL(SKU.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT,B.PARTY_MRP
      ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
AT25.ATTR25_KEY_NAME ,    
      A.INV_TYPE,A.XFER_TYPE,SKU.ER_FLAG,SKU.ONLINE_PRODUCT_CODE    
     , P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,     
      P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS ,    
      PID.INV_DT AS PUR_INV_DT,SKU.HSN_CODE,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS  ,  
	  DBO.FN_GETENCRYPTVAL(SKU.WS_PRICE) AS WS_PRICE_ENCRYPT  
      FROM INM01106 A (NOLOCK)      
    JOIN IND01106 B (NOLOCK) ON A.INV_ID=B.INV_ID      
      JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=B.PRODUCT_CODE    
      JOIN ARTICLE C (NOLOCK) ON SKU.ARTICLE_CODE=C.ARTICLE_CODE      
     LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE          
      JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE      
      JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE      
      JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE      
      JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE      
      JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE     
      JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE      
      JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE      
      JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE      
      JOIN LM01106 LM (NOLOCK) ON A.AC_CODE=LM.AC_CODE    
      JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE      
      LEFT JOIN    
   (     
  SELECT A.PRODUCT_CODE ,     
   MAX(B.INV_DT) AS INV_DT    
     FROM PID01106 A    
  JOIN PIM01106 B ON A.MRR_ID =B.MRR_ID     
  WHERE  INV_MODE =1    
  GROUP BY A.PRODUCT_CODE     
   ) PID ON PID.PRODUCT_CODE =B.PRODUCT_CODE     
   LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE    
      WHERE '+@CROWFILTER  + '  ORDER BY B.AUTO_SRNO,B.TS'    
 END           
     
            
      
ELSE    
 IF @NMODE = 12   -- FROM JWR      
 BEGIN       
  SET @CCMD = N' SELECT B.PRODUCT_CODE, SKU.FIX_MRP,SKU.MRP, SKU.PURCHASE_PRICE, SKU.WS_PRICE ,    
     C.ARTICLE_NO, C.ARTICLE_NAME, SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME,    
      C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,    
      P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME,     
      P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME,    
      P6.PARA6_CODE, P6.PARA6_NAME,  C.ARTICLE_DESC,LM.AC_NAME, SKU.INV_NO AS INV_NO,      
      CONVERT(VARCHAR,SKU.INV_DT,105) AS INV_DT, SKU.INV_NO AS CHALLAN_NO, LM.ALIAS, P3.INACTIVE AS PARA3_INACTIVE,       
      (RTRIM(LTRIM(STR(MONTH(SKU.INV_DT)))) + ''/'' + RTRIM(LTRIM(LM.ALIAS)) + ''/''+     
       RTRIM(LTRIM(STR(YEAR(SKU.INV_DT))))+ ''9/'' + RTRIM(LTRIM(SKU.INV_NO)) + ''/''+    
       RTRIM(LTRIM(STR(DAY(SKU.INV_DT))))) AS INV_DETAILS,          
      CONVERT(NUMERIC(10,0),B.MRP) AS WMRP,B.MRP,B.QUANTITY AS QTY,CONVERT(VARCHAR,SKU.RECEIPT_DT,105) AS RECEIPT_DT,    
      ''''VANDOR_BILL_DT,U.UOM_NAME,SKU.PRODUCT_NAME,    
      DBO.FN_GETENCRYPTVAL(SKU.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT
      ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
AT25.ATTR25_KEY_NAME     
      ,CUST.CUSTOMER_FNAME +''''+ CUST.CUSTOMER_LNAME  AS CUSTOMER_NAME,CUST.MOBILE    
      ,SKU.ER_FLAG, P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,     
       P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS     
       ,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS    
      FROM POST_SALES_JOBWORK_RECEIPT_MST A (NOLOCK)                     
   JOIN POST_SALES_JOBWORK_RECEIPT_DET B (NOLOCK) ON A.RECEIPT_ID = B.RECEIPT_ID        
   JOIN POST_SALES_JOBWORK_ISSUE_DET M (NOLOCK) ON M.ROW_ID = B.REF_ROW_ID     
   JOIN POST_SALES_JOBWORK_ISSUE_MST N (NOLOCK) ON M.ISSUE_ID = N.ISSUE_ID     
   JOIN HOLD_BACK_DELIVER_DET G (NOLOCK) ON M.REF_HBD_ROW_ID = G.ROW_ID    
   JOIN CMD01106 Q (NOLOCK) ON Q.ROW_ID = G.REF_CMD_ROW_ID        
   JOIN CMM01106 P (NOLOCK) ON Q.CM_ID = P.CM_ID    
   JOIN PRD_AGENCY_MST Y (NOLOCK) ON N.AGENCY_CODE = Y.AGENCY_CODE      
      JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=B.PRODUCT_CODE    
      JOIN ARTICLE C (NOLOCK) ON SKU.ARTICLE_CODE=C.ARTICLE_CODE      
      LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE         
      JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE      
      JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE      
      JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE      
      JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE      
      JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE      
      JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE      
      JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE      
      JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE      
      JOIN LM01106 LM (NOLOCK) ON SKU.AC_CODE=LM.AC_CODE    
      JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE      
      LEFT OUTER JOIN CUSTDYM CUST (NOLOCK) ON CUST.CUSTOMER_CODE = P.CUSTOMER_CODE    
      LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE     
      WHERE '+@CROWFILTER  + ' ORDER BY B.PRODUCT_CODE'    
 END           
ELSE    
 IF @NMODE = 15   -- FROM SNC      
 BEGIN       
  SET @CCMD = N' SELECT LEFT(a.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX (''@'',a.PRODUCT_CODE)-1,-1),LEN(a.PRODUCT_CODE ))) as PRODUCT_CODE, SKU.FIX_MRP,SKU.MRP, SKU.PURCHASE_PRICE, SKU.WS_PRICE ,    
     C.ARTICLE_NO, C.ARTICLE_NAME, SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME,    
      C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,    
      P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME,     
      P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME,    
      P6.PARA6_CODE, P6.PARA6_NAME,  C.ARTICLE_DESC,LM.AC_NAME, SKU.INV_NO AS INV_NO,      
      CONVERT(VARCHAR,SKU.INV_DT,105) AS INV_DT, SKU.INV_NO AS CHALLAN_NO, LM.ALIAS, P3.INACTIVE AS PARA3_INACTIVE,       
      (RTRIM(LTRIM(STR(MONTH(SKU.INV_DT)))) + ''/'' + RTRIM(LTRIM(LM.ALIAS)) + ''/''+     
       RTRIM(LTRIM(STR(YEAR(SKU.INV_DT))))+ ''9/'' + RTRIM(LTRIM(SKU.INV_NO)) + ''/''+    
       RTRIM(LTRIM(STR(DAY(SKU.INV_DT))))) AS INV_DETAILS,          
      CONVERT(NUMERIC(10,0),B.MRP) AS WMRP,B.MRP,(CASE WHEN SKU.BARCODE_CODING_SCHEME=3 THEN 1 ELSE B.QUANTITY END) AS QTY,CONVERT(VARCHAR,SKU.RECEIPT_DT,105) AS RECEIPT_DT,   
      ''''VANDOR_BILL_DT,U.UOM_NAME,SKU.PRODUCT_NAME,    
      DBO.FN_GETENCRYPTVAL(SKU.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT
      ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
AT25.ATTR25_KEY_NAME     
      ,''''  AS [CUSTOMER_NAME],'''' AS [MOBILE]    
      ,SKU.ER_FLAG, P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,     
       P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS     
       ,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS    ,ISNULL(B.label_copies,1) AS label_copies
      FROM SNC_BARCODE_DET A (NOLOCK)                     
   JOIN SNC_DET B (NOLOCK) ON A.REFROW_ID = B.ROW_ID        
   JOIN SNC_MST M (NOLOCK) ON M.MEMO_ID = B.MEMO_ID     
      JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=A.PRODUCT_CODE    
      JOIN ARTICLE C (NOLOCK) ON SKU.ARTICLE_CODE=C.ARTICLE_CODE      
      LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE          
      JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE      
      JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE      
      JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE      
      JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE      
      JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE      
      JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE      
      JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE      
      JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE      
      JOIN LM01106 LM (NOLOCK) ON SKU.AC_CODE=LM.AC_CODE    
      JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE    
      LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE      
      WHERE '+@CROWFILTER  +     
      '   ORDER BY A.PRODUCT_CODE'    
 END                 
  ELSE      
 IF @NMODE = 16   -- FROM WSR        
 BEGIN         
  SET @CCMD = N' SELECT B.PRODUCT_CODE, SKU.FIX_MRP,SKU.MRP, SKU.PURCHASE_PRICE, B.RATE AS WS_PRICE,      
     C.ARTICLE_NO, C.ARTICLE_NAME, SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME,      
      C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,      
      P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME,       
      P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME,      
      P6.PARA6_CODE, P6.PARA6_NAME,  C.ARTICLE_DESC,LM.AC_NAME, SKU.INV_NO AS INV_NO,        
      CONVERT(VARCHAR,SKU.INV_DT,105) AS INV_DT, SKU.INV_NO AS CHALLAN_NO, LM.ALIAS, P3.INACTIVE AS PARA3_INACTIVE,         
      (RTRIM(LTRIM(STR(MONTH(SKU.INV_DT)))) + ''/'' + RTRIM(LTRIM(LM.ALIAS)) + ''/''+       
       RTRIM(LTRIM(STR(YEAR(SKU.INV_DT))))+ ''9/'' + RTRIM(LTRIM(SKU.INV_NO)) + ''/''+      
       RTRIM(LTRIM(STR(DAY(SKU.INV_DT))))) AS INV_DETAILS,            
      B.QUANTITY AS QTY,CONVERT(VARCHAR,SKU.RECEIPT_DT,105) AS RECEIPT_DT,      
      ''''VANDOR_BILL_DT,U.UOM_NAME,A.AC_CODE,SKU.PRODUCT_NAME,      
      DBO.FN_GETENCRYPTVAL(SKU.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT
      ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
AT25.ATTR25_KEY_NAME ,     
      SKU.ER_FLAG , P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,     
      P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS,    
      PID.INV_DT AS PUR_INV_DT ,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS            
      FROM CNM01106 A (NOLOCK)        
      JOIN CND01106 B (NOLOCK) ON A.CN_ID=B.CN_ID        
      JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=B.PRODUCT_CODE      
      JOIN ARTICLE C (NOLOCK) ON SKU.ARTICLE_CODE=C.ARTICLE_CODE        
      LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE            
      JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE        
      JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE        
      JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE        
      JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE        
      JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE        
      JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE        
      JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
      JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE        
      JOIN LM01106 LM (NOLOCK) ON A.AC_CODE=LM.AC_CODE      
      JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE    
       LEFT JOIN    
   (     
  SELECT A.PRODUCT_CODE ,     
   MAX(B.INV_DT) AS INV_DT    
     FROM PID01106 A    
  JOIN PIM01106 B ON A.MRR_ID =B.MRR_ID     
  WHERE  INV_MODE =1    
  GROUP BY A.PRODUCT_CODE     
   ) PID ON PID.PRODUCT_CODE =B.PRODUCT_CODE    
   LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE         
      WHERE '+@CROWFILTER  + '  ORDER BY B.PRODUCT_CODE'      
 END      
 ELSE      
 IF @NMODE = 17  -- FROM WSL_ORDER_MST       
 BEGIN         
  SET @CCMD = N'SELECT A.ORDER_NO,    
       ORDER_DT=CASE WHEN ORDER_DT=''1900-01-01'' THEN '''' ELSE CONVERT(VARCHAR,A.ORDER_DT,105) END,    
       DELIVERY_DT=CASE WHEN DELIVERY_DT=''1900-01-01'' THEN '''' ELSE CONVERT(VARCHAR,A.DELIVERY_DT,105) END,    
       A.REF_NO,  B.PRODUCT_CODE, B.WS_PRICE AS WS_PRICE,      
       C.ARTICLE_NO, C.ARTICLE_NAME, C.CODING_SCHEME AS CODING_SCHEME,      
      C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,      
      P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME,       
      P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME,      
      P6.PARA6_CODE, P6.PARA6_NAME,  C.ARTICLE_DESC,LM.AC_NAME,        
      LM.ALIAS, P3.INACTIVE AS PARA3_INACTIVE,         
      B.QUANTITY AS QTY,U.UOM_NAME,A.AC_CODE,    
      A.CUSTOMER_CODE,USER_CUSTOMER_CODE AS CUSTOMER_ID,    
      CUST.MOBILE,    
      CUSTOMER_NAME=ISNULL(CUSTOMER_FNAME,'''')+'' ''+ISNULL(CUSTOMER_LNAME,''''),    
      ISNULL(ADDRESS1,'''')+'' ''+ISNULL(ADDRESS2,'''')+'' ''+ISNULL(ADDRESS0,'''')+ '' ''+ ISNULL(ADDRESS9,'''') +'' ''+ ISNULL(AREA_NAME,'''')+'' ''+ ISNULL(CITY,'''') AS ADDRESS,    
      TRAIL_DT AS TRIAL_DT, P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,     
             P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS ,0 AS PURCHASE_PRICE    
             ,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS ,  emp.emp_name as Sale_emp_name 
      FROM WSL_ORDER_MST A (NOLOCK)        
      JOIN WSL_ORDER_DET B (NOLOCK) ON A.ORDER_ID=B.ORDER_ID          
      JOIN ARTICLE C (NOLOCK) ON B.ARTICLE_CODE=C.ARTICLE_CODE        
      LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON B.ARTICLE_CODE = ATTR.ARTICLE_CODE 
	LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
	LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
	LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
	LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
	LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
	LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
	LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
	LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
	LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
	LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
	LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
	LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
	LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
	LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
	LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
	LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
	LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
	LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
	LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
	LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
	LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
	LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
	LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
	LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
	LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE            
      JOIN PARA1 P1 (NOLOCK) ON B.PARA1_CODE= P1.PARA1_CODE        
      JOIN PARA2 P2 (NOLOCK) ON B.PARA2_CODE= P2.PARA2_CODE        
      JOIN PARA3 P3 (NOLOCK) ON B.PARA3_CODE= P3.PARA3_CODE        
     JOIN PARA4 P4 (NOLOCK) ON B.PARA4_CODE= P4.PARA4_CODE        
      JOIN PARA5 P5 (NOLOCK) ON B.PARA5_CODE= P5.PARA5_CODE        
      JOIN PARA6 P6 (NOLOCK) ON B.PARA6_CODE= P6.PARA6_CODE        
      JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
      JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE        
      JOIN LM01106 LM (NOLOCK) ON A.AC_CODE=LM.AC_CODE      
      JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE          
      JOIN CUSTDYM CUST (NOLOCK) ON CUST.CUSTOMER_CODE=A.CUSTOMER_CODE    
      JOIN AREA (NOLOCK) ON AREA.AREA_CODE=CUST.AREA_CODE    
      JOIN CITY (NOLOCK) ON CITY.CITY_CODE=AREA.CITY_CODE    
      LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE    
      WHERE '+@CROWFILTER  + ' ORDER BY B.PRODUCT_CODE'       
 END      
     
 ELSE    
 IF @NMODE = 18   -- FROM JWR      
 BEGIN       
  SET @CCMD = N' SELECT B.PRODUCT_CODE, 0 AS FIX_MRP,SKU.MRP, SKU.PURCHASE_PRICE, SKU.WS_PRICE ,    
     C.ARTICLE_NO, C.ARTICLE_NAME, 0 AS CODING_SCHEME,    
      C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,P2.PARA2_CODE, P2.PARA2_NAME,    
      P3.PARA3_CODE, P3.PARA3_NAME,P4.PARA4_CODE, P4.PARA4_NAME,P5.PARA5_CODE, P5.PARA5_NAME,P6.PARA6_CODE, P6.PARA6_NAME,      
      C.ARTICLE_DESC,LM.AC_NAME, SKU.INV_NO AS INV_NO,      
      CONVERT(VARCHAR,SKU.INV_DT,105) AS INV_DT, SKU.INV_NO AS CHALLAN_NO, LM.ALIAS,        
      (RTRIM(LTRIM(STR(MONTH(SKU.INV_DT)))) + ''/'' + RTRIM(LTRIM(LM.ALIAS)) + ''/''+     
       RTRIM(LTRIM(STR(YEAR(SKU.INV_DT))))+ ''9/'' + RTRIM(LTRIM(SKU.INV_NO)) + ''/''+    
RTRIM(LTRIM(STR(DAY(SKU.INV_DT))))) AS INV_DETAILS,          
      CONVERT(NUMERIC(10,0),SKU.MRP) AS WMRP,SKU.MRP,B.QUANTITY AS QTY,CONVERT(VARCHAR,SKU.RECEIPT_DT,105) AS RECEIPT_DT,    
      ''''VANDOR_BILL_DT,U.UOM_NAME,'''' AS PRODUCT_NAME,    
      DBO.FN_GETENCRYPTVAL(SKU.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT    
      ,0 AS ER_FLAG, P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,     
             P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS     
             ,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS    
      FROM PRD_JOBWORK_RECEIPT_MST A (NOLOCK)                     
   JOIN PRD_JOBWORK_RECEIPT_DET B (NOLOCK) ON A.RECEIPT_ID = B.RECEIPT_ID        
   JOIN PRD_JOBWORK_ISSUE_DET M (NOLOCK) ON M.ROW_ID = B.REF_ROW_ID     
   JOIN PRD_JOBWORK_ISSUE_MST N (NOLOCK) ON M.ISSUE_ID = N.ISSUE_ID     
   JOIN PRD_AGENCY_MST Y (NOLOCK) ON N.AGENCY_CODE = Y.AGENCY_CODE      
      JOIN PRD_SKU SKU (NOLOCK) ON SKU.PRODUCT_UID=B.PRODUCT_UID    
      JOIN ARTICLE C (NOLOCK) ON SKU.ARTICLE_CODE=C.ARTICLE_CODE      
      JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE      
      JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE    
      JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE      
      JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE    
      JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE      
      JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE    
      JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE      
      JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE      
      JOIN LM01106 LM (NOLOCK) ON SKU.AC_CODE=LM.AC_CODE    
      JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE     
      LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE     
      WHERE '+@CROWFILTER  + ' ORDER BY B.PRODUCT_CODE'    
 END     
     
     
 ELSE    
 IF @NMODE = 19   -- FROM INTER BIN TRANSFER      
 BEGIN       
  SET @CCMD = N' SELECT B.PRODUCT_CODE, SKU.FIX_MRP,SKU.MRP, SKU.PURCHASE_PRICE, SKU.WS_PRICE AS WS_PRICE,    
     C.ARTICLE_NO, C.ARTICLE_NAME, SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME,    
      C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,    
      P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME,     
      P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME,    
      P6.PARA6_CODE, P6.PARA6_NAME,  C.ARTICLE_DESC,LM.AC_NAME, SKU.INV_NO AS INV_NO,      
      CONVERT(VARCHAR,SKU.INV_DT,105) AS INV_DT, SKU.INV_NO AS CHALLAN_NO, LM.ALIAS, P3.INACTIVE AS PARA3_INACTIVE,       
      (RTRIM(LTRIM(STR(MONTH(SKU.INV_DT)))) + ''/'' + RTRIM(LTRIM(LM.ALIAS)) + ''/''+     
       RTRIM(LTRIM(STR(YEAR(SKU.INV_DT))))+ ''9/'' + RTRIM(LTRIM(SKU.INV_NO)) + ''/''+    
       RTRIM(LTRIM(STR(DAY(SKU.INV_DT))))) AS INV_DETAILS,          
      CONVERT(NUMERIC(10,0),SKU.MRP) AS WMRP,SKU.MRP,B.QUANTITY AS QTY,CONVERT(VARCHAR,SKU.RECEIPT_DT,105) AS RECEIPT_DT,    
      '''' AS VANDOR_BILL_DT,U.UOM_NAME,SKU.PRODUCT_NAME,    
      DBO.FN_GETENCRYPTVAL(SKU.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT
      ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
AT25.ATTR25_KEY_NAME ,   
      SKU.ER_FLAG,SKU.ONLINE_PRODUCT_CODE, P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,     
             P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS     
             ,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS    
      FROM FLOOR_ST_MST A (NOLOCK)      
      JOIN FLOOR_ST_DET B (NOLOCK) ON A.MEMO_ID=B.MEMO_ID      
      JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=B.PRODUCT_CODE    
      JOIN ARTICLE C (NOLOCK) ON SKU.ARTICLE_CODE=C.ARTICLE_CODE      
      LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE          
      JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE      
      JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE      
      JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE      
      JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE      
      JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE      
      JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE      
      JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE      
      JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE      
      JOIN LM01106 LM (NOLOCK) ON SKU.AC_CODE=LM.AC_CODE    
      JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE    
      LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE      
      WHERE '+@CROWFILTER  + ' ORDER BY PRODUCT_CODE'    
 END      
     
  IF @NMODE = 20   -- FROM JWR      
 BEGIN       
  SET @CCMD = N' SELECT B.PRODUCT_CODE, 0 AS FIX_MRP,SKU.MRP, SKU.PURCHASE_PRICE, SKU.WS_PRICE,
       C.ARTICLE_NO, C.ARTICLE_NAME, 0 AS CODING_SCHEME,
       C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,P2.PARA2_CODE, P2.PARA2_NAME,    
       P3.PARA3_CODE, P3.PARA3_NAME,P4.PARA4_CODE, P4.PARA4_NAME,P5.PARA5_CODE, P5.PARA5_NAME,P6.PARA6_CODE, P6.PARA6_NAME,      
       C.ARTICLE_DESC,LM.AC_NAME, SKU.INV_NO AS INV_NO,      
       CONVERT(VARCHAR,SKU.INV_DT,105) AS INV_DT, SKU.INV_NO AS CHALLAN_NO, LM.ALIAS,        
       (RTRIM(LTRIM(STR(MONTH(SKU.INV_DT)))) + ''/'' + RTRIM(LTRIM(LM.ALIAS)) + ''/''+     
       RTRIM(LTRIM(STR(YEAR(SKU.INV_DT))))+ ''9/'' + RTRIM(LTRIM(SKU.INV_NO)) + ''/''+    
       RTRIM(LTRIM(STR(DAY(SKU.INV_DT))))) AS INV_DETAILS,          
       CONVERT(NUMERIC(10,0),SKU.MRP) AS WMRP,SKU.MRP,B.QUANTITY AS QTY,CONVERT(VARCHAR,SKU.RECEIPT_DT,105) AS RECEIPT_DT,    
       ''''VANDOR_BILL_DT,U.UOM_NAME,'''' AS PRODUCT_NAME,    
       DBO.FN_GETENCRYPTVAL(SKU.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT    
       ,0 AS ER_FLAG, P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,     
       P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS     
       ,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS    
       
       --19 02 2019
       ,ORD2.MEMO_NO AS JOBCARD_NO
       ,ORD2.MEMO_DT AS JOBCARD_NO
       ,BLM.AC_NAME MERCHANT_NAME
       ,EMP.EMP_NAME BUYER_NAME
     
       FROM JOBWORK_RECEIPT_MST A (NOLOCK)                     
	   JOIN JOBWORK_RECEIPT_DET B (NOLOCK) ON A.RECEIPT_ID = B.RECEIPT_ID        
       JOIN JOBWORK_ISSUE_DET M (NOLOCK) ON M.ROW_ID = B.REF_ROW_ID     
       JOIN JOBWORK_ISSUE_MST N (NOLOCK) ON M.ISSUE_ID = N.ISSUE_ID     
       JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=B.PRODUCT_CODE    
       JOIN ARTICLE C (NOLOCK) ON SKU.ARTICLE_CODE=C.ARTICLE_CODE      
       JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE      
       JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE    
       JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE      
       JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE    
       JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE      
       JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE    
       JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE      
       JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE      
       JOIN LM01106 LM (NOLOCK) ON SKU.AC_CODE=LM.AC_CODE    
       JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE     
       LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE     
       --19 02 2019
       Left outer JOIN JOBWORK_PMT PMT (NOLOCK) ON PMT.PRODUCT_CODE=B.PRODUCT_CODE
       LEFT JOIN EMPLOYEE EMP (NOLOCK) ON EMP.EMP_CODE=ISNULL(PMT.ITEM_MERCHANT_CODE,''0000000'')
       LEFT JOIN BUYER_ORDER_MST ORD1 ON ORD1.ORDER_ID=PMT.ORDER_ID
       LEFT JOIN
       (
         SELECT DISTINCT A.PRODUCT_CODE ,BM.AC_CODE,OM.MEMO_NO,OM.MEMO_DT
         FROM ORD_PLAN_BARCODE_DET A (NOLOCK)
         JOIN ORD_PLAN_DET B (NOLOCK) ON A.REFROW_ID=B.ROW_ID
         JOIN ORD_PLAN_MST OM (NOLOCK) ON OM.MEMO_ID=B.MEMO_ID
         JOIN BUYER_ORDER_DET BD ON BD.ROW_ID=B.WOD_ROW_ID
         JOIN BUYER_ORDER_MST BM (NOLOCK) ON BM.ORDER_ID=BD.ORDER_ID
       )ORD2 ON ORD2.PRODUCT_CODE=B.PRODUCT_CODE  
       LEFT JOIN LM01106 BLM (NOLOCK) ON BLM.AC_CODE =ISNULL(ORD1.AC_CODE,ORD2.AC_CODE)
       --19 02 2019      
       WHERE '+CASE ISNULL(@CROWFILTER,'') WHEN '' THEN '1=1' ELSE @CROWFILTER END+' ORDER BY B.PRODUCT_CODE'    
 END     
     
     
     
IF @NMODE =21   -- JOB CARD PRINT    
 BEGIN     
  SET @CCMD = N'SELECT Z.PRODUCT_CODE, SKU.MRP, SKU.PURCHASE_PRICE, SKU.WS_PRICE,    
     C.ARTICLE_NO, C.ARTICLE_NAME, SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME,       
     C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,    
     P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME,     
     P4.PARA4_CODE, P4.PARA4_NAME, P5.PARA5_CODE, P5.PARA5_NAME,    
     P6.PARA6_CODE, P6.PARA6_NAME, C.ARTICLE_DESC,LM.AC_NAME, A.MEMO_NO AS INV_NO
     ,CONVERT(VARCHAR,A.MEMO_DT,105) AS INV_DT, A.MEMO_NO AS CHALLAN_NO, LM.ALIAS
     ,P3.INACTIVE AS PARA3_INACTIVE, '''' AS INV_DETAILS
     ,CONVERT(NUMERIC(10,0),SKU.MRP) AS WMRP,SKU.MRP,CAST(1 AS NUMERIC(5)) AS QTY,''''AS RECEIPT_DT,    
     '''' VANDOR_BILL_DT,U.UOM_NAME,SKU.AC_CODE,SKU.PRODUCT_NAME,    
     DBO.FN_GETENCRYPTVAL(SKU.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT
     ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
AT25.ATTR25_KEY_NAME  
     ,SKU.ER_FLAG    
     ,P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS
     ,P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS     
     ,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS
     FROM ORD_PLAN_MST A (NOLOCK)      
     JOIN ORD_PLAN_DET B (NOLOCK) ON A.MEMO_ID=B.MEMO_ID      
     JOIN ORD_PLAN_BARCODE_DET Z(NOLOCK) ON Z.REFROW_ID=B.ROW_ID    
     JOIN SKU SKU (NOLOCK) ON Z.PRODUCT_CODE = SKU.PRODUCT_CODE     
     JOIN ARTICLE C (NOLOCK) ON SKU.ARTICLE_CODE=C.ARTICLE_CODE      
     LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE       
     JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE      
     JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE      
     JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE      
     JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE      
     JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE      
     JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE      
     JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE      
     JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE      
     JOIN LM01106 LM (NOLOCK) ON SKU.AC_CODE=LM.AC_CODE    
     JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE    
     LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE    
     WHERE '+@CROWFILTER      
        
 END       
     
     
     
IF @NMODE =22   -- TRANSFER TO TRADING    
 BEGIN     

  
  SET @CCMD = N'SELECT B.PRODUCT_CODE, SKU.MRP, SKU.PURCHASE_PRICE, SKU.WS_PRICE,    
                       C.ARTICLE_NO, C.ARTICLE_NAME, SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME,       
                       C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,    
                       P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME,     
                       P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME,    
                       P6.PARA6_CODE, P6.PARA6_NAME,  C.ARTICLE_DESC,LM.AC_NAME, A.MEMO_NO  AS INV_NO,      
                       CONVERT(VARCHAR,A.MEMO_DT,105) AS INV_DT, A.MEMO_NO AS CHALLAN_NO, LM.ALIAS,     
                       P3.INACTIVE AS PARA3_INACTIVE, '''' AS INV_DETAILS,          
                       CONVERT(NUMERIC(10,0),SKU.MRP) AS WMRP,SKU.MRP,B .QUANTITY AS QTY,''''AS RECEIPT_DT,    
                      '''' VANDOR_BILL_DT,U.UOM_NAME,SKU.AC_CODE,SKU.PRODUCT_NAME,    
                      DBO.FN_GETENCRYPTVAL(SKU.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT,
					  DBO.FN_GETENCRYPTVAL(SKU.ws_price) AS WS_PRICE_ENCRYPT
                      ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
						AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
						AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
						AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
						AT25.ATTR25_KEY_NAME 
                      ,SKU.ER_FLAG    ,SKU.HSN_CODE
                      , P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,     
                      P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS     
                     ,SP.SIZEINCHES,SP.SIZECMS,SP.REMARKS AS SP_REMARKS    
                     
                     --19 02 2019
                     ,ORD2.MEMO_NO AS JOBCARD_NO
                     ,ORD2.MEMO_DT AS JOBCARD_NO
                     ,BLM.AC_NAME BUYER_NAME
                     ,EMP.EMP_NAME MERCHANT_NAME
                     ,pmt.Trading_Product_code
FROM TRANSFER_TO_TRADING_MST A (NOLOCK)      
JOIN TRANSFER_TO_TRADING_DET B  (NOLOCK) ON B.MEMO_ID =A.MEMO_ID    
JOIN SKU SKU (NOLOCK) ON B.PRODUCT_CODE = SKU.PRODUCT_CODE     
JOIN ARTICLE C (NOLOCK) ON SKU.ARTICLE_CODE=C.ARTICLE_CODE      
LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE        
JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE      
JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE      
JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE      
JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE      
JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE      
JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE      
JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE      
JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE      
JOIN LM01106 LM (NOLOCK) ON SKU.AC_CODE=LM.AC_CODE    
JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE    
JOIN JOBWORK_PMT PMT (NOLOCK) ON PMT.PRODUCT_CODE=B.PRODUCT_CODE
LEFT JOIN EMPLOYEE EMP (NOLOCK) ON EMP.EMP_CODE=ISNULL(PMT.ITEM_MERCHANT_CODE,''0000000'')
LEFT JOIN SECTIONDPARA2 SP(NOLOCK) ON SP.SUB_SECTION_CODE=SD.SUB_SECTION_CODE AND SP.PARA2_CODE=P2.PARA2_CODE
LEFT JOIN BUYER_ORDER_MST ORD1 ON ORD1.ORDER_ID=PMT.ORDER_ID
LEFT JOIN
  (
       SELECT DISTINCT A.PRODUCT_CODE ,BM.AC_CODE,OM.MEMO_NO,OM.MEMO_DT
       FROM ORD_PLAN_BARCODE_DET A (NOLOCK)
       JOIN ORD_PLAN_DET B (NOLOCK) ON A.REFROW_ID=B.ROW_ID
       JOIN ORD_PLAN_MST OM (NOLOCK) ON OM.MEMO_ID=B.MEMO_ID
       JOIN BUYER_ORDER_DET BD ON BD.ROW_ID=B.WOD_ROW_ID
       JOIN BUYER_ORDER_MST BM (NOLOCK) ON BM.ORDER_ID=BD.ORDER_ID
 )ORD2 ON ORD2.PRODUCT_CODE=B.PRODUCT_CODE  
LEFT JOIN LM01106 BLM (NOLOCK) ON BLM.AC_CODE =ISNULL(ORD1.AC_CODE,ORD2.AC_CODE)
WHERE '+@CROWFILTER      



     
 END 
 
 IF @NMODE = 23   -- FROM POST SALE      
 BEGIN    
     
 SET @CCMD = N'SELECT B.PRODUCT_CODE   	   
		
		,SKU.MRP,  		
		C.ARTICLE_NO ,C.ARTICLE_NAME    
		,SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME ,SM.SECTION_NAME,SD.SUB_SECTION_NAME,
		P1.PARA1_CODE,P1.PARA1_NAME,P2.PARA2_CODE
		,P2.PARA2_NAME,P3.PARA3_CODE ,P3.PARA3_NAME,P4.PARA4_CODE,P4.PARA4_NAME,
		P4.REMARKS AS PARA4_REMARKS,P5.PARA5_CODE,P5.PARA5_NAME,P6.PARA6_CODE    
		,P6.PARA6_NAME,C.ARTICLE_DESC		   
		,SKU.MRP,B.QUANTITY AS QTY
		,U.UOM_NAME		
	    ,P4.ALIAS AS P4_ALIAS,SKU.ER_FLAG,	    
	    SKU.VENDOR_EAN_NO,SKU.ONLINE_PRODUCT_CODE
	    ,P1.ALIAS AS PARA1_ALIAS,P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,
	    P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS ,SKU.HSN_CODE			     
         ,CAST('''' AS VARCHAR(100)) JOBCARD_NO,c.discon
		FROM POST_SALES_JOBWORK_ISSUE_MST A (NOLOCK)        
		JOIN POST_SALES_JOBWORK_ISSUE_DET B (NOLOCK) ON A.issue_id=B.issue_id  
		JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=B.PRODUCT_CODE          
		JOIN ARTICLE C (NOLOCK) ON sku.ARTICLE_CODE=C.ARTICLE_CODE        
		LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
		LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
		LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
		LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
		LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
		LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
		LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
		LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
		LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
		LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
		LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
		LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
		LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
		LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
		LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
		LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
		LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
		LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
		LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
		LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
		LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
		LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
		LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
		LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
		LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
		LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE   	     
	    JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE        
		JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE        
		JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE        
		JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE        
		JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE        
		JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE        
		JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
		JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE      
		
		JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE 	     
		LEFT OUTER JOIN SKU_OH  (NOLOCK) ON SKU_OH.PRODUCT_CODE=SKU.PRODUCT_CODE 	  
		WHERE '+@CROWFILTER  + ' ORDER BY B.TS,B.PRODUCT_CODE'    
		      
	END       

 IF @NMODE = 24   --box print
 BEGIN    


 SET @CCMD = N'SELECT A.BOX_ID, B.PRODUCT_CODE  ,SKU.MRP AS SKU_MRP,  		
		C.ARTICLE_NO ,C.ARTICLE_NAME,SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME ,
		SM.SECTION_NAME,SD.SUB_SECTION_NAME,
		P1.PARA1_CODE,P1.PARA1_NAME,P2.PARA2_CODE
		,P2.PARA2_NAME,P3.PARA3_CODE ,P3.PARA3_NAME,P4.PARA4_CODE,P4.PARA4_NAME,
		P4.REMARKS AS PARA4_REMARKS,P5.PARA5_CODE,P5.PARA5_NAME,P6.PARA6_CODE    
		,P6.PARA6_NAME,C.ARTICLE_DESC		   
		,X.MRP,X.QUANTITY AS QTY,U.UOM_NAME		
	    ,P4.ALIAS AS P4_ALIAS,SKU.ER_FLAG,	    
	    SKU.VENDOR_EAN_NO,SKU.ONLINE_PRODUCT_CODE
	    ,P1.ALIAS AS PARA1_ALIAS,P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,
	    P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS ,SKU.HSN_CODE,	--,sku.purchase_price,sku.ws_price,
		AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
        AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
        AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
        AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
        AT25.ATTR25_KEY_NAME ,SKU.ER_FLAG    
		FROM BOXM A (NOLOCK)        
		JOIN 
		(
			select top 1 * from BOXd (nolock) where box_id='''+@CMEMO_ID+'''
		)B  ON A.box_id=B.box_id  
		join 
		(
			select box_id,sum(quantity) as quantity ,sum(mrp) as mrp 
			from BOXd bd (nolock) 
			join sku SKU(nolock) on BD.PRODUCT_CODE=SKU.PRODUCT_CODE
			where box_id='''+@CMEMO_ID+'''
			group by box_id
		)x on X.box_id=a.box_id
		JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=B.PRODUCT_CODE     '     
SET @CCMD1 = N'		JOIN ARTICLE C (NOLOCK) ON sku.ARTICLE_CODE=C.ARTICLE_CODE        
		LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
		LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
		LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
		LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
		LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
		LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
		LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
		LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
		LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
		LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
		LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
		LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
		LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
		LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
		LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
		LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
		LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
		LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
		LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
		LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
		LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
		LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
		LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
		LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
		LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
		LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE   	     
	    JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE        
		JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE        
		JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE        
		JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE        
		JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE        
		JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE        
		JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
		JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE      
		JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE 	     
		LEFT OUTER JOIN SKU_OH  (NOLOCK) ON SKU_OH.PRODUCT_CODE=SKU.PRODUCT_CODE 	  
		WHERE a.box_id='''+@CMEMO_ID+''' ORDER BY b.product_code  '    
		      
 PRINT @CCMD      
 PRINT @CCMD1      
   SET @CCMD      =@CCMD      +@CCMD1  
 --EXEC SP_EXECUTESQL @CCMD 

     
		      
END       
	
	
	
			
IF @NMODE = 25   -- FROM RECEIVE FROM CUSTOMER      
 BEGIN    
     
	SET @CCMD = N'SELECT B.PRODUCT_CODE   	   
		,SKU.MRP,  		
		C.ARTICLE_NO ,C.ARTICLE_NAME    
		,SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME ,SM.SECTION_NAME,SD.SUB_SECTION_NAME,
		P1.PARA1_CODE,P1.PARA1_NAME,P2.PARA2_CODE
		,P2.PARA2_NAME,P3.PARA3_CODE ,P3.PARA3_NAME,P4.PARA4_CODE,P4.PARA4_NAME,
		P4.REMARKS AS PARA4_REMARKS,P5.PARA5_CODE,P5.PARA5_NAME,P6.PARA6_CODE    
		,P6.PARA6_NAME,C.ARTICLE_DESC,SKU.MRP,B.QUANTITY AS QTY,U.UOM_NAME		
	    ,P4.ALIAS AS P4_ALIAS,SKU.ER_FLAG,	    
	    SKU.VENDOR_EAN_NO,SKU.ONLINE_PRODUCT_CODE
	    ,P1.ALIAS AS PARA1_ALIAS,P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,
	    P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS ,SKU.HSN_CODE			     
         ,CAST('''' AS VARCHAR(100)) JOBCARD_NO,C.DISCON ,ITEMSTATUS.*,
		 L.dept_alias AS LOCATION_ALIAS,A.memo_no AS HOLD_BACK_MEMO_NO,
		 A.MEMO_DT AS HOLD_BACK_MEMO_DT,CUST.MOBILE,JOBS.JOB_NAME,B.delivery_dt
		FROM hold_back_deliver_MST A (NOLOCK)        
		JOIN hold_back_deliver_det B (NOLOCK) ON A.memo_id=B.memo_id  
		JOIN LOCATION L (NOLOCK) ON L.DEPT_ID=LEFT(A.MEMO_ID,2)
		LEFT JOIN CUSTDYM CUST (NOLOCK) ON CUST.CUSTOMER_CODE=A.CUSTOMER_CODE 
		LEFT OUTER JOIN 
		(
			SELECT CM_NO,HBD_ROW_ID FROM ITEM_STATUS IS1 (NOLOCK) 
			LEFT OUTER JOIN CMM01106 IS2 (NOLOCK) ON IS1.CM_ID=IS2.CM_ID
			WHERE HBD_ROW_ID IN ('''+(CASE WHEN ISNULL(@CROWIDSTR,'')='' THEN '' ELSE ISNULL(@CROWIDSTR,'') END) +''')
		)ITEMSTATUS ON ITEMSTATUS.HBD_ROW_ID=B.ROW_ID
		JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=B.PRODUCT_CODE          
		JOIN ARTICLE C (NOLOCK) ON sku.ARTICLE_CODE=C.ARTICLE_CODE        
		LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
		LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
		LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
		LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
		LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
		LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
		LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
		LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
		LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
		LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
		LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
		LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
		LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
		LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
		LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
		LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
		LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
		LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
		LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
		LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
		LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
		LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
		LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
		LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
		LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
		LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE   	     
	    JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE        
		JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE        
		JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE        
		JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE        
		JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE        
		JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE        
		JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE  
		JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE
		JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE 	     
		LEFT OUTER JOIN SKU_OH  (NOLOCK) ON SKU_OH.PRODUCT_CODE=SKU.PRODUCT_CODE 	
		LEFT JOIN JOBS (NOLOCK) ON JOBS.JOB_CODE=B.JOB_CODE
		WHERE '+ (CASE WHEN ISNULL(@CROWIDSTR,'')='' THEN '1=2' ELSE @CROWFILTER  END) + ' ORDER BY B.TS,B.PRODUCT_CODE '
		
		--		'
		--PRINT @ccmd      
		--SET @ccmd      ='


	--	PRINT @ccmd      
	END
	
	
				
IF @NMODE = 26   -- FROM PPC_FG_BARCODE_NA_MST
 BEGIN    
     
 SET @CCMD = N'SELECT B.PRODUCT_CODE ,SKU.MRP,  a.MEMO_ID ,a.memo_no,a.MEMO_DT,		
		C.ARTICLE_NO ,C.ARTICLE_NAME ,SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME ,SM.SECTION_NAME,SD.SUB_SECTION_NAME,
		P1.PARA1_CODE,P1.PARA1_NAME,P2.PARA2_CODE,P2.PARA2_NAME,P3.PARA3_CODE ,P3.PARA3_NAME,P4.PARA4_CODE,P4.PARA4_NAME,
		P4.REMARKS AS PARA4_REMARKS,P5.PARA5_CODE,P5.PARA5_NAME,P6.PARA6_CODE ,P6.PARA6_NAME,C.ARTICLE_DESC,SKU.MRP,B.QUANTITY AS QTY
		,U.UOM_NAME,P4.ALIAS AS P4_ALIAS,SKU.ER_FLAG,SKU.VENDOR_EAN_NO,SKU.ONLINE_PRODUCT_CODE
	    ,P1.ALIAS AS PARA1_ALIAS,P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,p2.para2_set as SizeGroup,
	    P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS ,SKU.HSN_CODE,CAST('''' AS VARCHAR(100)) JOBCARD_NO,C.DISCON
		FROM PPC_FG_BARCODE_NA_MST A (NOLOCK)        
		JOIN PPC_FG_BARCODE_NA_DET B (NOLOCK) ON A.memo_id=B.memo_id  
		JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=B.PRODUCT_CODE          
		JOIN ARTICLE C (NOLOCK) ON sku.ARTICLE_CODE=C.ARTICLE_CODE        
		LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
		LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
		LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
		LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
		LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
		LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
		LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
		LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
		LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
		LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
		LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
		LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
		LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
		LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
		LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
		LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
		LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
		LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
		LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
		LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
		LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
		LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
		LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
		LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
		LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
		LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE   	     
	    JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE        
		JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE        
		JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE        
		JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE        
		JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE        
		JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE        
		JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
		JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE      
		JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE 	       
		WHERE   A.MEMO_ID='''+@CMEMO_ID+''' AND  '+@CROWFILTER  + ' 
		ORDER BY C.ARTICLE_NO,P1.PARA1_NAME,P2.PARA2_ORDER'    
		      
	END
	
	 
 
 PRINT @CCMD      
   
 EXEC SP_EXECUTESQL @CCMD      
END

