CREATE PROCEDURE SP3S_INSERT_VALUE_IN_TARGET
(
@NSPID INT
)
AS
BEGIN
    
          DECLARE @CTEMPTABLE VARCHAR(MAX),@CCMD NVARCHAR(MAX),@ERRMSG VARCHAR(MAX)
          SET @CTEMPTABLE='TEMP_TARGET_'+LTRIM(RTRIM(STR(@NSPID)))+' '
          
BEGIN TRY
    
          SET @CCMD=N'INSERT TARGET (DEPT_ID,DT,QTY,VALUE) 
          SELECT DEPT_ID,DT,QTY,VALUE FROM '+@CTEMPTABLE+''
          PRINT @CCMD
          EXEC SP_EXECUTESQL @CCMD
END TRY 
BEGIN CATCH

        SET @ERRMSG='ERROR IN SP3S_INSERT_VALUE_IN_TARGET ,SQL ERROR: #' + LTRIM(STR(ERROR_NUMBER())) + ' ' + ERROR_MESSAGE()  
        GOTO END_PROC
     
END CATCH  
END_PROC:

      SELECT ISNULL(@ERRMSG,'') ERRMSG

        
END
