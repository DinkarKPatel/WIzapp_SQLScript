CREATE PROCEDURE SPPPC_FILTER_HD01106
(  
	@NMODE							INT, --  (1) - VIEW FILTER DATA		(2) - VIEW ID WISE
	@HEAD_CODE					VARCHAR(10)='',  
	@HEAD_NAME					VARCHAR(300)='',  
	@MAJOR_HEAD_CODE		VARCHAR(10)='',  
	@PHYSICAL							VARCHAR(5)='',  
	@INACTIVE							VARCHAR(5)='',  
	@ERRMSG_OUT					VARCHAR(MAX) OUT  
)  
AS  
BEGIN  
	DECLARE @CSTEP INT, @CCMD NVARCHAR(MAX)  

	BEGIN TRY  
		SET NOCOUNT ON;
		SET @ERRMSG_OUT = ''  

		--  (1) - VIEW FILTER DATA	
		SET @CSTEP = 10  
		IF (@NMODE=1)  
		BEGIN  
			SET @CCMD=N' SELECT HEAD_CODE, HEAD_NAME, ALIAS, MAJOR_HEAD_CODE, MAJOR_HEAD_NAME, PHYSICAL, INACTIVE FROM (  
											SELECT HD.HEAD_CODE, HD.HEAD_NAME, HD.ALIAS, HD.MAJOR_HEAD_CODE, MHD.HEAD_NAME AS MAJOR_HEAD_NAME,  
														CASE WHEN ISNULL(HD.PHYSICAL, 0) = 0 THEN ''NO'' ELSE ''YES'' END AS PHYSICAL,  
														CASE WHEN ISNULL(HD.INACTIVE, 0) = 0 THEN ''NO'' ELSE ''YES'' END AS INACTIVE   
											FROM HD01106 HD LEFT JOIN (SELECT HEAD_CODE, HEAD_NAME FROM HD01106) MHD  
											ON HD.MAJOR_HEAD_CODE = MHD.HEAD_CODE) AS HD  
										WHERE HEAD_NAME LIKE ''%' + @HEAD_NAME + '%''  
										AND MAJOR_HEAD_CODE LIKE ''%' + @MAJOR_HEAD_CODE + '%''  
										AND PHYSICAL LIKE ''%' + @PHYSICAL + '%''  
										AND INACTIVE LIKE ''%' + @INACTIVE + '%''   
										ORDER BY HEAD_NAME '  
			PRINT @CCMD  
			EXEC SP_EXECUTESQL @CCMD  
		END  

		--  (2) - VIEW ID WISE
		SET @CSTEP = 20  
		IF (@NMODE=2)  
		BEGIN  
			SET @CCMD=N'	SELECT HEAD_CODE, HEAD_NAME, ALIAS, MAJOR_HEAD_CODE, MAJOR_HEAD_NAME, PHYSICAL, INACTIVE FROM (  
											SELECT HD.HEAD_CODE, HD.HEAD_NAME, HD.ALIAS, HD.MAJOR_HEAD_CODE, MHD.HEAD_NAME AS MAJOR_HEAD_NAME,  
														CASE WHEN ISNULL(HD.PHYSICAL, 0) = 0 THEN ''NO'' ELSE ''YES'' END AS PHYSICAL,  
														CASE WHEN ISNULL(HD.INACTIVE, 0) = 0 THEN ''NO'' ELSE ''YES'' END AS INACTIVE   
											FROM HD01106 HD LEFT JOIN (SELECT HEAD_CODE, HEAD_NAME FROM HD01106) MHD  
											ON HD.MAJOR_HEAD_CODE = MHD.HEAD_CODE) AS HD  
										WHERE HEAD_CODE = ''' + @HEAD_CODE + ''' '  

			PRINT @CCMD  
			EXEC SP_EXECUTESQL @CCMD  
		END  
		
		SET NOCOUNT OFF;
		
	END TRY    
	BEGIN CATCH    
		SET @ERRMSG_OUT='ERROR: [P]: SPPPC_FILTER_HD01106, [STEP]: '+CAST(@CSTEP AS VARCHAR(5))+', [MESSAGE]: ' + ERROR_MESSAGE()  
		PRINT @ERRMSG_OUT  

		GOTO END_PROC    
	END CATCH     

END_PROC:    
	IF  ISNULL(@ERRMSG_OUT,'')=''   
		SET @ERRMSG_OUT = ''  
END
