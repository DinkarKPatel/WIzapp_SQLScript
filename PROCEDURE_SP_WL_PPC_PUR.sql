CREATE PROCEDURE SP_WL_PPC_PUR    
(      
 @CQUERYID NUMERIC(2),    
 @CWHERE VARCHAR(100)='',    
 @CFINYEAR VARCHAR(5)='',    
 @CDEPTID VARCHAR(7)='',    
 @NNAVMODE NUMERIC(2)=1 ,  
 @CWHERE1 VARCHAR(100)='',   
 @CAC_CODE VARCHAR(10)='',  
 @CORDER_ID VARCHAR(50)='',  
 @CCHALLAN_NO VARCHAR(50)=''  ,
 @CMRR_ID VARCHAR(100)=''
)  
----WITH ENCRYPTION  
AS    
BEGIN    
  DECLARE @CCMD NVARCHAR(MAX),@cHEAD_CODE VARCHAR(MAX)   
  SET @CCMD=''    
  
  IF @CQUERYID=1    
     GOTO LBLPOLU    
  
  ELSE IF @CQUERYID=2    
          GOTO LBLMST    
  
  ELSE IF @CQUERYID=3    
          GOTO LBLDET    
  
  ELSE IF @CQUERYID=4    
          GOTO LBLPARA1    
  
  ELSE IF @CQUERYID=5    
          GOTO LBLPARA2    
  
  ELSE IF @CQUERYID=6    
          GOTO LBLPARA3    
  
  ELSE IF @CQUERYID=7    
          GOTO LBLPARA4    
  
  ELSE IF @CQUERYID=8    
          GOTO LBLPARA5    
  
  ELSE IF @CQUERYID=9    
          GOTO LBLPARA6    
  
  ELSE IF @CQUERYID=10    
          GOTO LBLSUPPLIERS    
  
  ELSE IF @CQUERYID=11    
          GOTO LBLARTICLELIST    
  
  ELSE IF @CQUERYID=12    
          GOTO LBLARTICLEINFO    
  
  ELSE IF @CQUERYID=13    
          GOTO LBLFORMS    
  
  ELSE IF @CQUERYID=14    
          GOTO LBLARTICLESKUINFO    
  
  ELSE IF @CQUERYID=15    
          GOTO LBLARTPARA2LIST    
  
  ELSE IF @CQUERYID=16    
          GOTO LBLARTPARA1LIST    
  
  ELSE IF @CQUERYID=17    
          GOTO LBLQBF    
  
  ELSE IF @CQUERYID=18    
          GOTO LBLLOCLIST    
  
  ELSE IF @CQUERYID=19      
          GOTO LBLPRDSERIES      
  
  ELSE IF @CQUERYID=20
          GOTO LBLORDERLIST
  
  ELSE IF @CQUERYID=21
          GOTO LBLORDERDET
  
  ELSE IF @CQUERYID=22
          GOTO LBLBARCODELIST
  ELSE     
     GOTO LAST    
     
  /******************************************************************************************************************************************/
      
  LBLPOLU:    
      SELECT A.MRR_ID FROM PPC_PIM01106 A (NOLOCK) WHERE FIN_YEAR = @CFINYEAR ORDER BY A.MRR_ID    
      GOTO LAST    
  
     
  LBLMST:    
     SELECT A.CHALLAN_NO,CONVERT(VARCHAR,A.CHALLAN_DT,105) AS CHALLAN_DT,D.USERNAME AS 'CREATED_USERNAME', E.USERNAME AS 'MODIFIED_USERNAME',       
            C.AC_NAME AS SUPP_NAME
            ,C.ADDRESS0+' '+ C.ADDRESS1 + ' ' + C.ADDRESS2 + ', ' + C.AREA_NAME + ' ' + C.CITY + ' ' + C.STATE AS 'SUPP_ADDRESS'
            ,ISNULL(OH_TAX_METHOD,0) AS OH_TAX_METHOD,
            ISNULL(DO_NOT_CALC_GST_OH,0) AS DO_NOT_CALC_GST_OH
            ,A.*,'' AS WSL_INV_ID  
            ,CONVERT(VARCHAR,A.RECEIPT_DT,105) AS RECEIPT_DT1
            ,CONVERT(VARCHAR,A.BILL_DT,105) AS BILL_DT1
            ,ISNULL(CNT_PO,0) AS CNT_PO ,
            A.PARTY_STATE_CODE ,
            B.GST_AMOUNT
            
     FROM PPC_PIM01106 A (NOLOCK)   
     LEFT JOIN   
     (  
       SELECT MRR_ID, COUNT(PO_ROW_ID) AS CNT_PO, 
              SUM(ISNULL(IGST_AMOUNT,0)+ISNULL(CGST_AMOUNT,0)+ISNULL(SGST_AMOUNT,0)) AS GST_AMOUNT
       FROM PPC_PID01106   
       WHERE ISNULL(PO_ROW_ID,'')<>''  
       GROUP BY MRR_ID  
     )B ON A.MRR_ID=B.MRR_ID  
     JOIN LMV01106 C (NOLOCK) ON A.AC_CODE = C.AC_CODE      
     JOIN USERS D (NOLOCK) ON A.USER_CODE = D.USER_CODE      
     JOIN USERS E (NOLOCK) ON A.EDT_USER_CODE = E.USER_CODE     
     WHERE A.MRR_ID = @CWHERE      
     GOTO LAST    
        
  
  LBLDET:    
     SELECT K.SECTION_NAME, J.SUB_SECTION_NAME, I.*, C.PARA1_NAME ,D.PARA2_NAME, E.PARA3_NAME, B.ARTICLE_CODE
           ,B.ARTICLE_NO ,B.ARTICLE_NAME, B.CODING_SCHEME, 
           ISNULL(A.TOLERANCE_PERCENTAGE,0) AS TOLERANCE_PERCENTAGE,
		   ISNULL(A.TOLERANCE_QUANTITY,0) AS TOLERANCE_QUANTITY,
           A.*,CAST(A.PURCHASE_PRICE * A.QUANTITY AS NUMERIC(10,2)) AS 'AMOUNT'
		   ,ISNULL(B.DT_CREATED,'') AS [ART_DT_CREATED],ISNULL(E.DT_CREATED,'') AS [PARA3_DT_CREATED]
		   --ISNULL(SKU.DT_CREATED,'') AS [SKU_DT_CREATED],      
		   ,'' AS OTHER_XN_PRODUCT_CODE,A.QUANTITY AS [ORG_QUANTITY],CAST(0 AS NUMERIC(10,2)) AS [STK_QUANTITY]
		   ,B.STOCK_NA,B.FIX_MRP    
		   --SKU.PRODUCT_UID AS PRODUCT_NAME,  
		   ,'' AS COMPONENT
		   ,POM.PO_NO, A.PO_ROW_ID AS PO_ID,'' AS IMAGE_1  
		   ,ISNULL(CUR.CURRENCY_CODE,'')AS CURRENCY_CODE--ADDED 29 NOV 2017
		   ,ISNULL(CUR.CURRENCY_NAME,'')AS CURRENCY_NAME--ADDED 29 NOV 2017
		   ,ISNULL(BO.WSL_REMARKS,'') AS WSL_REMARKS,
		   A.XN_VALUE_WITHOUT_GST,A.GST_PERCENTAGE,A.IGST_AMOUNT,A.CGST_AMOUNT,A.SGST_AMOUNT,XN_VALUE_WITH_GST

     FROM PPC_PID01106 A (NOLOCK)       
     LEFT OUTER JOIN PPC_POD01106 PORD ON PORD.ROW_ID=A.PO_ROW_ID     
     LEFT JOIN PPC_POM01106 POM ON POM.PO_ID=PORD.PO_ID   ---REPLACE JOIN TO LEFT JOIN  
     --JOIN PPC_PID01106_BARCODE BR ON BR.PID_ROW_ID=A.ROW_ID   
     JOIN PPC_CURRENCY_MST CUR (NOLOCK) ON CUR.CURRENCY_CODE=A.CURRENCY_CODE--ADDED 29 NOV 2017
     JOIN ARTICLE B (NOLOCK) ON A.ARTICLE_CODE = B.ARTICLE_CODE         
     JOIN PARA1 C (NOLOCK) ON A.PARA1_CODE = C.PARA1_CODE        
     JOIN PARA2 D (NOLOCK) ON A.PARA2_CODE = D.PARA2_CODE        
     JOIN PARA3 E (NOLOCK) ON A.PARA3_CODE = E.PARA3_CODE            
     JOIN UOM I (NOLOCK) ON B.UOM_CODE = I.UOM_CODE        
     JOIN SECTIOND J (NOLOCK) ON B.SUB_SECTION_CODE = J.SUB_SECTION_CODE        
     JOIN SECTIONM K (NOLOCK) ON J.SECTION_CODE = K.SECTION_CODE  
     LEFT JOIN PPC_BO_ART_BOM BOM (NOLOCK) ON BOM.ROW_ID = PORD.BO_BOM_ROW_ID   
     LEFT JOIN
     (  
       SELECT DISTINCT  A.ROW_ID ,B.BILL_NO ,B.ORDER_NO AS MEMO_NO,B.REF_NO,A.ITEM_REMARKS AS WSL_REMARKS  
       FROM PPC_BUYER_ORDER_DET A  
       JOIN PPC_BUYER_ORDER_MST B ON A.ORDER_ID =B.ORDER_ID  
       WHERE B.CANCELLED =0  
     ) BO ON BO.ROW_ID =BOM.REF_ROW_ID      
     --LEFT OUTER JOIN PRD_SKU SKU ON SKU.PRODUCT_UID=BR.PRODUCT_UID      
     WHERE A.MRR_ID = @CWHERE       
     ORDER BY A.SRNO      
     GOTO LAST    
     
        
  LBLPARA1:    
     SELECT A.PARA1_CODE, A.PARA1_NAME 
     FROM PARA1 A (NOLOCK)    
     WHERE PARA1_NAME <> '' AND A.INACTIVE = 0 
     ORDER BY A.PARA1_NAME      
     GOTO LAST    
    
    
  LBLPARA2:    
     SELECT A.PARA2_CODE, A.PARA2_NAME, A.PARA2_ORDER 
     FROM PARA2 A (NOLOCK)    
     WHERE A.PARA2_NAME <> '' AND A.INACTIVE = 0 
     ORDER BY A.PARA2_ORDER    
     GOTO LAST    
    
        
  LBLPARA3:    
     SELECT A.PARA3_CODE, A.PARA3_NAME 
     FROM PARA3 A (NOLOCK)    
     WHERE A.PARA3_NAME <> '' AND A.INACTIVE = 0 
     ORDER BY A.PARA3_NAME    
     GOTO LAST    
    
    
  LBLPARA4:    
     SELECT A.PARA4_CODE, A.PARA4_NAME 
     FROM PARA4 A (NOLOCK)    
     WHERE A.PARA4_NAME <> '' AND A.INACTIVE = 0 
     ORDER BY A.PARA4_NAME    
     GOTO LAST    
    
    
  LBLPARA5:    
     SELECT A.PARA5_CODE, A.PARA5_NAME 
     FROM PARA5 A (NOLOCK)    
     WHERE A.PARA5_NAME <> '' AND A.INACTIVE = 0 
     ORDER BY A.PARA5_NAME    
     GOTO LAST    
    
    
  LBLPARA6:    
     SELECT A.PARA6_CODE, A.PARA6_NAME 
     FROM PARA6 A (NOLOCK)    
     WHERE A.PARA6_NAME <> '' AND A.INACTIVE = 0 
     ORDER BY A.PARA6_NAME    
     GOTO LAST    
    
        
  LBLSUPPLIERS:
     
     SET @cHEAD_CODE = DBO.FN_ACT_TRAVTREE (@CWHERE)  ----ADD VARIABLE BY GAURI ON 17/4/2019
      
     SET @CCMD = N'SELECT A.AC_CODE, A.AC_NAME, ISNULL(A.CREDIT_DAYS, 0) AS CREDIT_DAYS,             
                   ISNULL(A.DISCOUNT_PERCENTAGE, 0) AS DISCOUNT_PERCENTAGE
                   ,A.CITY 
                   ,A.ADDRESS0 + '' '' + A.ADDRESS1 + '' '' + A.ADDRESS2 + '' '' + A.AREA_NAME + '' '' + A.CITY + '' '' + A.STATE AS SUPP_ADDRESS
                   ,AC_NAME AS REPCOLNAME             
                   FROM LMV01106 A (NOLOCK)            
                   WHERE HEAD_CODE IN( '+@cHEAD_CODE+' )		  ----REPLACE VARIABLE FROM FUNCTION BY GAURI ON 17/4/2019              
                   AND INACTIVE = 0 AND A.AC_NAME <> ''''  
                   ORDER BY A.AC_NAME '   
     EXEC SP_EXECUTESQL @CCMD    
     GOTO LAST    
    
        
  LBLARTICLELIST:    
	 SELECT A.ARTICLE_CODE, A.ARTICLE_NAME, A.ARTICLE_NO,B.SUB_SECTION_NAME, C.SECTION_NAME       
     FROM ARTICLE A (NOLOCK)      
     JOIN SECTIOND B (NOLOCK) ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE      
     JOIN SECTIONM C (NOLOCK) ON B.SECTION_CODE = C.SECTION_CODE      
     WHERE A.ARTICLE_NO <> '' AND A.INACTIVE=0      
     GOTO LAST    
    
        
  LBLARTICLEINFO:    
     SELECT A.ARTICLE_CODE, A.ARTICLE_DESC, A.ARTICLE_NAME, A.ARTICLE_NO, A.CODING_SCHEME,    
     A.PURCHASE_PRICE, A.FIX_MRP AS MRP, A.WHOLESALE_PRICE, A.CREATED_ON, A.PARA1_SET, A.PARA2_SET, B.UOM_CODE,     
     B.UOM_NAME, B.UOM_TYPE, A.MP_PERCENTAGE ,A.FIX_MRP, ISNULL(S.PRODUCT_UID, '') AS PRODUCT_CODE,    
     ISNULL(P3.DT_CREATED, '') AS [PARA3_DT_CREATED],    
     ISNULL(S.DT_CREATED,'') AS [SKU_DT_CREATED],    
     A.DT_CREATED AS [ART_DT_CREATED],    
     A.WSP_PERCENTAGE,D.SECTION_NAME,C.SUB_SECTION_NAME,    
     A.PURCHASE_PRICE AS GROSS_PURCHASE_PRICE,CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,    
     CAST(0 AS NUMERIC(10,2)) AS  DISCOUNT_AMOUNT,A.ARTICLE_NAME AS PRODUCT_NAME    
     FROM ARTICLE A (NOLOCK)    
     JOIN UOM B (NOLOCK) ON A.UOM_CODE = B.UOM_CODE     
     JOIN SECTIOND C (NOLOCK) ON A.SUB_SECTION_CODE = C.SUB_SECTION_CODE     
     JOIN SECTIONM D (NOLOCK) ON C.SECTION_CODE = D.SECTION_CODE     
     LEFT OUTER JOIN PRD_SKU S (NOLOCK) ON A.ARTICLE_CODE = A.ARTICLE_CODE AND A.PARA1_CODE = S.PARA1_CODE AND A.PARA2_CODE = S.PARA2_CODE     
     LEFT OUTER JOIN PARA3 P3 (NOLOCK) ON P3.PARA3_CODE = A.PARA3_CODE    
     WHERE A.ARTICLE_CODE=@CWHERE    
     GOTO LAST    
    
    
  LBLFORMS:    
     SELECT FORM_ID, FORM_NAME, TAX_PERCENTAGE 
     FROM FORM (NOLOCK)    
     WHERE FORM_NAME <> '' AND INACTIVE = 0  
     ORDER BY FORM_NAME  
     --SELECT FORM_ID, FORM_NAME, TAX_PERCENTAGE FROM FORM     
     --WHERE FORM_NAME <> '' AND INACTIVE = 0  AND PURCHASE_AC_CODE <> '0000000000'  
     --ORDER BY FORM_NAME   
     GOTO LAST    
    
    
  LBLARTICLESKUINFO:    
     SELECT TOP 1 A.PARA1_CODE, A.PARA2_CODE, A.PARA3_CODE, A.PARA4_CODE, A.PARA5_CODE,     
     A.PARA6_CODE, P1.PARA1_NAME, P2.PARA2_NAME, P3.PARA3_NAME, P4.PARA4_NAME,     
     P5.PARA5_NAME, P6.PARA6_NAME, ART.DT_CREATED AS [ART_DT_CREATED],     
     P3.DT_CREATED AS [PARA3_DT_CREATED],ISNULL(A.DT_CREATED,'') AS [SKU_DT_CREATED],    
     A.MRP AS FIX_MRP    
     FROM PRD_SKU A (NOLOCK)    
     JOIN ARTICLE (NOLOCK) ART ON ART.ARTICLE_CODE= A.ARTICLE_CODE     
     JOIN PARA1 (NOLOCK) P1 ON A.PARA1_CODE = P1.PARA1_CODE     
     JOIN PARA2 (NOLOCK) P2 ON A.PARA2_CODE = P2.PARA2_CODE     
     JOIN PARA3 (NOLOCK) P3 ON A.PARA3_CODE = P3.PARA3_CODE     
     JOIN PARA4 (NOLOCK) P4 ON A.PARA4_CODE = P4.PARA4_CODE     
     JOIN PARA5 (NOLOCK) P5 ON A.PARA5_CODE = P5.PARA5_CODE     
     JOIN PARA6 (NOLOCK) P6 ON A.PARA6_CODE = P6.PARA6_CODE     
     WHERE A.ARTICLE_CODE = @CWHERE    
     GOTO LAST    
    
       
  LBLARTPARA2LIST:    
     SELECT A.ARTICLE_CODE, A.PARA2_CODE, B.PARA2_NAME 
     FROM ART_DET A (NOLOCK)    
     JOIN PARA2 B ON A.PARA2_CODE = B.PARA2_CODE    
     WHERE A.ARTICLE_CODE = @CWHERE    
     ORDER BY B.PARA2_ORDER    
     GOTO LAST    
    
    
  LBLARTPARA1LIST:    
     SELECT A.ARTICLE_CODE, A.PARA1_CODE, B.PARA1_NAME 
     FROM ART_PARA1 A (NOLOCK)    
     JOIN PARA1 B ON A.PARA1_CODE = B.PARA1_CODE    
     WHERE A.ARTICLE_CODE = @CWHERE    
     ORDER BY B.PARA1_NAME    
     GOTO LAST    
    
    
  LBLQBF:    
     SET @CCMD=N'SELECT DISTINCT PO_ID AS XN_ID,MST_PO_NO AS XN_NO ,MST_XN_DT AS XN_DT     
                 FROM VW_PPC_PO_QBF (NOLOCK) '+@CWHERE    
     EXEC SP_EXECUTESQL @CCMD    
     GOTO LAST    
    
    
  LBLLOCLIST:    
     SELECT * 
     FROM LOCATION (NOLOCK)
     WHERE INACTIVE=0 AND LOC_TYPE = 1 AND DEPT_ID<>@CWHERE      
     GOTO LAST       
    
        
  LBLPRDSERIES:       
     SELECT PREFIX 
     FROM PRD_SERIES (NOLOCK) 
     WHERE PUR_LINKED=1    
     GOTO LAST        
    
       
  LBLORDERLIST:       
    
     
     IF OBJECT_ID ('TEMPDB..#TMPPID','U') IS NOT NULL  
        DROP TABLE #TMPPID  
  
     SELECT PO_ROW_ID,SUM(QUANTITY) AS QUANTITY   
     INTO #TMPPID  
     FROM PPC_PID01106 A (NOLOCK)
     JOIN PPC_PIM01106 B (NOLOCK) ON A.MRR_ID=B.MRR_ID    
     WHERE B.AC_CODE=@CWHERE1  AND CANCELLED=0     
     GROUP BY PO_ROW_ID    
     UNION ALL  
     SELECT A.PO_ROW_ID,SUM(A.ADJ_QUANTITY ) AS QUANTITY 
     FROM PPC_PO_ADJ_DET A (NOLOCK) 
     JOIN PPC_PO_ADJ_MST B (NOLOCK) ON A.MEMO_ID=B.MEMO_ID  
     GROUP BY A.PO_ROW_ID  
  
     -- SELECT APPROVED_BY, * FROM PPC_POM01106  
     
     SELECT A.PO_ID,POM.PO_NO,CONVERT(VARCHAR,PO_DT,105) AS PO_DT,  
           ISNULL(BO.MEMO_NO,'') AS BO_NO,ISNULL(BO.REF_NO,'') AS REF_NO ,ISNULL(BO.BILL_NO,'') AS BILL_NO ,  
           ISNULL(ART.ARTICLE_NO,'')   AS SET_NO ,SUM(A.QUANTITY-ISNULL([PI].PUR_QTY,0)) AS PENDING_QTY ,
           CONVERT(VARCHAR, A.DELIVERY_DT,105) AS DELIVERY_DT ,
           POM.AC_CODE,
		   LM.AC_NAME  ,
		  SUM(A.QUANTITY) AS PO_QTY ,
		  SUM(ISNULL([PI].PUR_QTY,0)) AS REC_QTY 
     FROM PPC_POD01106 A (NOLOCK)     
     JOIN PPC_POM01106 POM (NOLOCK) ON A.PO_ID = POM.PO_ID   
     JOIN LM01106 LM ON LM.AC_CODE=POM.AC_CODE      
     LEFT OUTER JOIN     
     (    
       SELECT PO_ROW_ID,SUM(QUANTITY) AS PUR_QTY   
       FROM #TMPPID   
       GROUP BY PO_ROW_ID    
     )[PI] ON A.ROW_ID = [PI].PO_ROW_ID 
     
     LEFT JOIN PPC_BO_ART_BOM BOM (NOLOCK) ON BOM.ROW_ID = A.BO_BOM_ROW_ID   
     LEFT JOIN
     (  
       SELECT A.ROW_ID ,B.BILL_NO ,B.ORDER_NO AS MEMO_NO,B.REF_NO     
       FROM PPC_BUYER_ORDER_DET A  
       JOIN PPC_BUYER_ORDER_MST B ON A.ORDER_ID =B.ORDER_ID  
       WHERE B.CANCELLED =0  
     ) BO ON BO.ROW_ID =BOM.REF_ROW_ID   
     
     LEFT JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE =ISNULL(BOM.BOM_ARTICLE_CODE ,A.ARTICLE_CODE )  
     WHERE --POM.ORDER_TYPE=@CWHERE AND
           POM.CANCELLED=0  
           AND ISNULL(POM.APPROVED_BY,'')<>''
           AND (@CWHERE1='' OR  POM.AC_CODE= @CWHERE1)
           AND A.QUANTITY-ISNULL([PI].PUR_QTY,0)>0
     GROUP BY A.PO_ID,POM.PO_NO,CONVERT(VARCHAR,PO_DT,105), ISNULL(BO.MEMO_NO,'') ,ISNULL(BO.REF_NO,'') 
			 ,ISNULL(BO.BILL_NO,'') ,ISNULL( ART.ARTICLE_NO,'') ,CONVERT(VARCHAR, A.DELIVERY_DT,105),
			 POM.AC_CODE,
		    LM.AC_NAME   
     HAVING SUM(A.QUANTITY-ISNULL([PI].PUR_QTY,0))>0   
     GOTO LAST        
         
  LBLORDERDET:  
     IF OBJECT_ID ('TEMPDB..#TMPPID1','U') IS NOT NULL  
        DROP TABLE #TMPPID1  
        
     SELECT PO_ROW_ID,SUM(QUANTITY) AS QUANTITY   
     INTO #TMPPID1  
     FROM PPC_PID01106 A (NOLOCK) 
     JOIN PPC_PIM01106 B (NOLOCK) ON A.MRR_ID=B.MRR_ID    
     WHERE B.AC_CODE=@CWHERE1  AND CANCELLED=0     
     GROUP BY PO_ROW_ID    
     UNION ALL  
     SELECT A.PO_ROW_ID,SUM(A.ADJ_QUANTITY) AS QUANTITY 
     FROM PPC_PO_ADJ_DET A (NOLOCK) 
     JOIN PPC_PO_ADJ_MST B (NOLOCK) ON A.MEMO_ID=B.MEMO_ID  
     GROUP BY A.PO_ROW_ID  
     
     SELECT K.SECTION_NAME, J.SUB_SECTION_NAME, I.UOM_TYPE, I.INACTIVE, I.UOM_CODE, UOM_NAME, I.BL_UOM_NAME
            ,C.PARA1_NAME, D.PARA2_NAME, E.PARA3_NAME, B.ARTICLE_NO, B.ARTICLE_NAME, B.CODING_SCHEME, B.STOCK_NA
            ,CONVERT(VARCHAR, A.DELIVERY_DT,105) AS DELIVERY_DT 
            ,ISNULL(A.TOLERANCE_PERCENTAGE,0) AS TOLERANCE_PERCENTAGE
			,CAST(A.QUANTITY*ISNULL(A.TOLERANCE_PERCENTAGE,0)/100 AS NUMERIC(10,3))  AS TOLERANCE_QUANTITY  
            ,ISNULL(A.HSN_CODE,'0000000000')HSN_CODE,A.*
            --A.PURCHASE_PRICE * A.QUANTITY AS 'AMOUNT',    
			,ISNULL(B.DT_CREATED,'') AS [ART_DT_CREATED], ISNULL(E.DT_CREATED,'') AS [PARA3_DT_CREATED]
			,CAST( 0 AS BIT) AS CHECKED    
            --(A.INVOICE_QUANTITY-ISNULL(PI.PUR_QTY,0))  AS PO_QTY,    
			,A.QUANTITY AS PO_QTY, (ISNULL([PI].PUR_QTY,0))  AS REC_QTY, 
			(A.QUANTITY-ISNULL([PI].PUR_QTY,0)) AS PENDING_QTY
			,A.WS_PRICE AS [WHOLESALE_PRICE], POM.PO_NO ,
			 CASE WHEN CONVERT(VARCHAR, A.DELIVERY_DT,105)<CONVERT(VARCHAR, GETDATE(),105) THEN 1 ELSE 0 END AS OVERDUE
			 ,ISNULL(BO.WSL_REMARKS,'') AS WSL_REMARKS,
			 POM.AC_CODE,
			 LM.AC_NAME
			 --VISHAL
			 ,CAST(0 AS NUMERIC(18,2))GST_PERCENTAGE
			 ,CAST(0 AS NUMERIC(18,2))IGST_AMOUNT
			 ,CAST(0 AS NUMERIC(18,2))CGST_AMOUNT
			 ,CAST(0 AS NUMERIC(18,2))SGST_AMOUNT
			 ,CAST(0 AS NUMERIC(18,2))XN_VALUE_WITHOUT_GST
			 ,CAST(0 AS NUMERIC(18,2))XN_VALUE_WITH_GST 
			 --VISHAL
     FROM PPC_POD01106 A (NOLOCK)     
     JOIN PPC_POM01106 POM (NOLOCK) ON A.PO_ID = POM.PO_ID     
     JOIN ARTICLE B (NOLOCK) ON A.ARTICLE_CODE = B.ARTICLE_CODE       
     JOIN PARA1 C (NOLOCK) ON A.PARA1_CODE = C.PARA1_CODE      
     JOIN PARA2 D (NOLOCK) ON A.PARA2_CODE = D.PARA2_CODE      
     JOIN PARA3 E (NOLOCK) ON A.PARA3_CODE = E.PARA3_CODE      
     JOIN UOM I (NOLOCK) ON B.UOM_CODE = I.UOM_CODE      
     JOIN SECTIOND J (NOLOCK) ON B.SUB_SECTION_CODE = J.SUB_SECTION_CODE      
     JOIN SECTIONM K (NOLOCK) ON J.SECTION_CODE = K.SECTION_CODE    
     JOIN LM01106 LM ON LM.AC_CODE=POM.AC_CODE  
     LEFT OUTER JOIN     
     (    
       SELECT PO_ROW_ID,SUM(QUANTITY) AS PUR_QTY   
       FROM #TMPPID1  
       GROUP BY PO_ROW_ID    
     ) [PI] ON A.ROW_ID = [PI].PO_ROW_ID   
     LEFT JOIN PPC_BO_ART_BOM BOM (NOLOCK) ON BOM.ROW_ID = A.BO_BOM_ROW_ID   
     LEFT JOIN
     (  
       SELECT DISTINCT  A.ROW_ID ,B.BILL_NO ,B.ORDER_NO AS MEMO_NO,B.REF_NO,A.ITEM_REMARKS AS WSL_REMARKS  
       FROM PPC_BUYER_ORDER_DET A  
       JOIN PPC_BUYER_ORDER_MST B ON A.ORDER_ID =B.ORDER_ID  
       WHERE B.CANCELLED =0  
     ) BO ON BO.ROW_ID =BOM.REF_ROW_ID        
     WHERE (@CWHERE1='' OR POM.AC_CODE= @CWHERE1) 
      AND A.QUANTITY-ISNULL([PI].PUR_QTY,0)>0   
     --AND POM.ORDER_TYPE=@CWHERE
     GOTO LAST    
     
  LBLBARCODELIST:  
     SELECT A.THAN_NO, A.PRODUCT_CODE, A.QUANTITY, A.ROW_ID, A.PRODUCT_UID, A.PID_ROW_ID
     FROM PPC_PID01106_BARCODE A (NOLOCK) 
     JOIN PPC_PID01106 B ON A.PID_ROW_ID =B.ROW_ID 
     WHERE (@CWHERE='' OR A.PID_ROW_ID =@CWHERE)
     AND (@CMRR_ID='' OR B.MRR_ID =@CMRR_ID)
     GOTO LAST   
     
  LAST:    
END
