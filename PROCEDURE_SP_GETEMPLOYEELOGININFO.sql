CREATE PROCEDURE SP_GETEMPLOYEELOGININFO  
@CEMPID CHAR(7),    
@DFRMDT DATETIME,    
@DTODT DATETIME    
AS    
BEGIN    

SELECT B.EMP_FNAME + ' ' + B.EMP_LNAME AS EMP_NAME,CONVERT(VARCHAR(25),A.ATTENDANCE_DT,105) AS ATTENDANCE_DT,    
DATENAME(DW,A.ATTENDANCE_DT) AS DAY_NAME,(CASE WHEN TIME_IN<>'' THEN (LTRIM(RIGHT(CONVERT(CHAR(19),TIME_IN,100),7)))  
ELSE '' END) AS TIME_IN,    
A.REMARKS_IN,(CASE WHEN TIME_OUT<>'' THEN (LTRIM(RIGHT(CONVERT(CHAR(19),TIME_OUT,100),7))) ELSE '' END) AS TIME_OUT,
A.REMARKS_OUT,  
(CASE WHEN (TIME_IN>E.SHIFT_TIME_IN OR TIME_OUT < E.SHIFT_TIME_OUT) AND TIME_IN <> '' AND TIME_OUT <> ''   
THEN 'LATE' WHEN TIME_IN='' AND TIME_OUT = '' THEN ''   
WHEN TIME_IN ='' OR TIME_OUT='' THEN 'INCOMPLETE' ELSE 'IN TIME' END) AS REMARKS , 
E.SHIFT_NAME,DBO.FN_GETEMP_ATDSTATUS(B.EMP_ID,ATTENDANCE_DT,LOG_ABSENT_STATUS,E.SHIFT_TIME_IN,
E.SHIFT_TIME_OUT,A.TIME_IN,A.TIME_OUT,E.EARLY_CUTOFF,E.LATE_CUTOFF,E.HALFDAY_CUTOFF,
 B.WEEKLY_OFF1) AS ATT_STATUS  ,L.DEPT_NAME ,B.REF_ID  
FROM EMP_MST B JOIN EMP_ATTENDANCE A ON A.EMP_ID = B.EMP_ID   
JOIN EMP_SHIFTS E ON  E.SHIFT_ID=A.SHIFT_ID 
JOIN LOCATION L ON B.DEPT_ID= L.DEPT_ID   
WHERE ( B.REF_ID =  @CEMPID  OR B.EMP_ID=@CEMPID) AND A.ATTENDANCE_DT BETWEEN @DFRMDT AND @DTODT    
ORDER BY A.ATTENDANCE_DT ASC     
END
