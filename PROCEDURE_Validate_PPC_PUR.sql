CREATE PROCEDURE VALIDATE_PPC_PUR
 @CXNID VARCHAR(50),	
 @NUPDATEMODE INT,	 
 @CERRORMSG VARCHAR(200) OUTPUT
AS
BEGIN
	

	
		
	IF EXISTS (SELECT MRR_ID FROM PPC_PIM01106 WHERE  FIN_YEAR<>SUBSTRING(MRR_ID,3,5) AND MRR_ID=@CXNID)
	BEGIN
		SET @CERRORMSG='MISMATCH BETWEEN MRR ID & FIN YEAR ..... PLEASE CHECK'
		RETURN
	END 
	
	IF EXISTS (SELECT TOP 1 'U' FROM PPC_PIM01106 A WHERE A.MRR_ID=@CXNID
	GROUP BY BILL_NO HAVING COUNT(*)>1)
	BEGIN
	   SET @CERRORMSG='DUPLICATE BILL NO FOUND ..... PLEASE CHECK'
	   RETURN
	
	END
	
	
END	
--**************************************** END OF PROCEDURE VALIDATEXN_PUR
