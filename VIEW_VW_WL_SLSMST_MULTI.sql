CREATE VIEW VW_WL_SLSMST_MULTI

AS
SELECT  D.USER_CUSTOMER_CODE AS  MST_USER_CUSTOMER_CODE,
		MST.CM_ID AS MST_MEMO_ID,
		MST.CM_NO AS MST_MEMO_NO,
		MST.CM_DT AS MST_XN_DT,
		MST.FIN_YEAR AS MST_FIN_YEAR,
		MST.SUBTOTAL AS CAL_SUBTOTAL,
		MST.DISCOUNT_PERCENTAGE AS CAL_DISCOUNT_PERCENTAGE_BILL_LEVEL,
		MST.DISCOUNT_AMOUNT AS CAL_DISCOUNT_AMOUNT_BILL_LEVEL,
		MST.NET_AMOUNT AS CAL_NET_AMOUNT,
		MST.REMARKS AS MST_REMARKS, 
		E.USERNAME AS MST_USERNAME,
		B.PRODUCT_CODE,
		ARTICLE_NO,
		B.QUANTITY AS CAL_QUANTITY,
		UOM_NAME,
		B.MRP AS CAL_MRP,
		B.DISCOUNT_PERCENTAGE AS CAL_DISCOUNT_PERCENTAGE,
		B.DISCOUNT_AMOUNT AS CAL_DISCOUNT_AMOUNT,
		EMP1.EMP_NAME,
		--EMP2.EMP_NAME AS EMP_NAME2,
		--EMP3.EMP_NAME AS EMP_NAME3,
		'T'+(CASE WHEN B.TAX_PERCENTAGE=0 THEN 'F' WHEN ROUND(B.TAX_PERCENTAGE,0)=B.TAX_PERCENTAGE THEN 
		 LTRIM(RTRIM(STR(B.TAX_PERCENTAGE))) ELSE LTRIM(RTRIM(STR(B.TAX_PERCENTAGE,6,2))) END) AS TAX_STATUS,
		B.TAX_PERCENTAGE AS CAL_TAX_PERCENTAGE,
		B.TAX_AMOUNT AS CAL_TAX_AMOUNT,
		B.NET AS CAL_NET
		
FROM CMM01106 MST
JOIN CMD01106 B ON B.CM_ID=MST.CM_ID
--JOIN PMV01106 C ON C.PRODUCT_CODE=B.PRODUCT_CODE --- OPTIMIZATION AFTER REMOVING VIEWS
JOIN SKU C ON C.PRODUCT_CODE=B.PRODUCT_CODE
JOIN ARTICLE ART ON ART.ARTICLE_CODE=C.ARTICLE_CODE
JOIN UOM ON UOM.UOM_CODE=ART.UOM_CODE
JOIN CUSTDYM D ON D.CUSTOMER_CODE=MST.CUSTOMER_CODE 
JOIN USERS E ON E.USER_CODE = MST.USER_CODE
JOIN EMPLOYEE EMP1 ON EMP1.EMP_CODE= B.EMP_CODE
--JOIN EMPLOYEE EMP2 ON EMP2.EMP_CODE= B.EMP_CODE2
--JOIN EMPLOYEE EMP3 ON EMP3.EMP_CODE= B.EMP_CODE3
