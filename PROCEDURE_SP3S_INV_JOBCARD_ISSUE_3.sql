CREATE PROCEDURE [DBO].[SP3S_INV_JOBCARD_ISSUE_3]          
(          
  @IMODE INT ,          
  @CWHERE VARCHAR(MAX)='',      
  @CAGENCYCODE VARCHAR(20)='',      
  @FINYEAR VARCHAR(10)=''  ,    
  @DEPTID VARCHAR(10)='' ,
  @NRETURNMODE INT=0
          
)      
----WITH ENCRYPTION
AS          
          
BEGIN        
 DECLARE @CCMD NVARCHAR(MAX)            
--LBLDET:    3
      
	SELECT CAST(0 AS BIT) AS CHKBILL, A.ISSUE_NO,A.ISSUE_ID,G.*,      
	ART.ARTICLE_CODE, ART.ARTICLE_NO, ART.ARTICLE_NAME, P1.PARA1_CODE,        
	PARA1_NAME, P2.PARA2_CODE,PARA2_NAME,P3.PARA3_CODE,PARA3_NAME,
	ISNULL(BU.CONVERSION_UOM_NAME,E.UOM_NAME) AS UOM_NAME,           
	CODING_SCHEME,CONVERT(NUMERIC(10,2),0) AS QUANTITY_IN_STOCK,G.PURCHASE_PRICE,      
	SKU.MRP,SKU.WS_PRICE,   SM.SECTION_NAME, SD.SUB_SECTION_NAME,        
	P4.PARA4_CODE,P5.PARA5_CODE,P6.PARA6_CODE,        
	PARA4_NAME,PARA5_NAME,PARA6_NAME,E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],        
	ART.DT_CREATED AS [ART_DT_CREATED],P3.DT_CREATED AS [PARA3_DT_CREATED],SKU.DT_CREATED AS [SKU_DT_CREATED],        
	ART.STOCK_NA,JOBS.JOB_CODE,JOBS.JOB_NAME,(0*G.QUANTITY) AS AMOUNT,ART.ALIAS AS ARTICLE_ALIAS,B.BIN_NAME,
	G.BIN_ID, A.REMARKS AS MST_REMARKS  ,G.HSN_CODE,G.GST_PERCENTAGE,
	G.IGST_AMOUNT,G.SGST_AMOUNT, 	G.CGST_AMOUNT ,
	G.STOCK_QTY,
	E.UOM_NAME AS STOCK_UOM   
	,CAST((G.QUANTITY * UC.Conversion_Value) AS NUMERIC(14,3)) AS CONVERTED_QTY
	,CAST(UC.Conversion_Value AS NUMERIC(14,3)) AS CONVERSION_VALUE
	FROM BOM_ISSUE_MST A (NOLOCK)             
	JOIN BOM_ISSUE_DET G (NOLOCK)  ON A.ISSUE_ID = G.ISSUE_ID                        
	JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=G.PRODUCT_CODE
	--JOIN PID01106 PID ON PID.PRODUCT_CODE=SKU.PRODUCT_CODE      
	JOIN ARTICLE ART (NOLOCK) ON SKU.ARTICLE_CODE = ART.ARTICLE_CODE          
	JOIN SECTIOND SD (NOLOCK) ON ART.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
	JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE = SM.SECTION_CODE        
	JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE = P1.PARA1_CODE          
	JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE = P2.PARA2_CODE          
	JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE = P3.PARA3_CODE          
	JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE = P4.PARA4_CODE          
	JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE = P5.PARA5_CODE          
	JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE = P6.PARA6_CODE          
	JOIN UOM E (NOLOCK) ON ART.UOM_CODE = E.UOM_CODE       
	JOIN JOBS (NOLOCK) ON JOBS.JOB_CODE=G.JOB_CODE   
	JOIN BIN B (NOLOCK) ON B.BIN_ID =G.BIN_ID  
	LEFT OUTER JOIN UOM_CONVERSION UC ON UC.UOM_CODE=e.UOM_CODE
    LEFT OUTER JOIN BOM_UOM BU ON BU.CONVERSION_UOM_CODE=UC.CONVERSION_UOM_CODE 
	--JOIN
	--(
	--	SELECT A.ROW_ID FROM ORD_PLAN_BOM_DET A
	--	JOIN ORD_PLAN_DET B ON B.ROW_ID=A.REF_ROW_ID
		
	--)X ON X.ROW_ID=G.ORD_PLAN_BOM_DET_ROW_ID      
	WHERE A.ISSUE_ID = @CWHERE            
END
