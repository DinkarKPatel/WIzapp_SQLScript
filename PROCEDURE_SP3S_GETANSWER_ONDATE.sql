CREATE PROCEDURE SP3S_GETANSWER_ONDATE 
(
  @BILL_DATE DATE,@LOC_ID VARCHAR(5)='',@CMEMO_ID VARCHAR(100)=''
)
AS
BEGIN
    SET NOCOUNT ON
	SELECT TOP 1 M.QUESTION_TYPE,M.QUESTION_ID,''+M.QUESTION_NAME AS QUESTION_NAME,CAST(1 AS INT)RATING,REPLICATE('0',7)ANSWER_CODE,'' AS MEMO_ID
	FROM QUESTION_WEEK_MST A (NOLOCK)
	JOIN QUESTIONM M (NOLOCK) ON M.QUESTION_ID=A.QUESTION_ID
	WHERE @BILL_DATE BETWEEN A.FROM_DATE AND A.TO_DATE

	SELECT CAST(0 AS BIT)CHK,''MEMO_ID,D.*,CAST(10 AS INT)RATING
	FROM QUESTION_WEEK_MST A (NOLOCK)
	JOIN QUESTIOND D (NOLOCK) ON D.QUESTION_ID=A.QUESTION_ID 
	WHERE (@BILL_DATE BETWEEN A.FROM_DATE AND A.TO_DATE)
	AND ISNULL(D.ANSWER_NAME,'')<>''  
	
    /*
     IF NOT EXISTS(SELECT * FROM QUESTION_MEMO_ANSWER_MST WHERE MEMO_ID=@CMEMO_ID)
        BEGIN
		  SELECT TOP 1 M.QUESTION_TYPE,M.QUESTION_ID,'QUESTION:- '+M.QUESTION_NAME AS QUESTION_NAME,CAST(1 AS INT)RATING,REPLICATE('0',7)ANSWER_CODE,'' AS MEMO_ID
		  FROM ACTIVATE_QUESTION_MST A (NOLOCK)
		  JOIN QUESTIONM M (NOLOCK) ON M.QUESTION_ID=A.QUESTION_ID
		  WHERE @BILL_DATE BETWEEN A.APPLICABLE_FROM_DT AND A.APPLICABLE_TO_DT
  
		SELECT CAST(0 AS BIT)CHK,''MEMO_ID,D.*,CAST(10 AS INT)RATING
		FROM ACTIVATE_QUESTION_MST A (NOLOCK)
		JOIN QUESTION_LOCATION_MST Q (NOLOCK) ON A.MEMO_ID=Q.MEMO_ID 
		JOIN QUESTIOND D (NOLOCK) ON D.QUESTION_ID=A.QUESTION_ID 
		WHERE (Q.DEPT_ID=@LOC_ID) 
		AND (@BILL_DATE BETWEEN A.APPLICABLE_FROM_DT AND A.APPLICABLE_TO_DT)
		AND ISNULL(D.ANSWER_NAME,'')<>''
     END
  ELSE
     BEGIN
		SELECT TOP 1 M.QUESTION_TYPE,M.QUESTION_ID,'QUESTION:- '+M.QUESTION_NAME AS QUESTION_NAME,CAST(1 AS INT)RATING,REPLICATE('0',7)ANSWER_CODE,'' AS MEMO_ID
		FROM ACTIVATE_QUESTION_MST A (NOLOCK)
		JOIN QUESTIONM M (NOLOCK) ON M.QUESTION_ID=A.QUESTION_ID
		WHERE @BILL_DATE BETWEEN A.APPLICABLE_FROM_DT AND A.APPLICABLE_TO_DT
		AND A.MEMO_ID=@CMEMO_ID
		 
		SELECT CAST(0 AS BIT)CHK,''MEMO_ID,D.*,CAST(10 AS INT)RATING
		FROM ACTIVATE_QUESTION_MST A (NOLOCK)
		JOIN QUESTION_LOCATION_MST Q (NOLOCK) ON A.MEMO_ID=Q.MEMO_ID 
		JOIN QUESTIOND D (NOLOCK) ON D.QUESTION_ID=A.QUESTION_ID 
		WHERE (Q.DEPT_ID=@LOC_ID) 
		AND (@BILL_DATE BETWEEN A.APPLICABLE_FROM_DT AND A.APPLICABLE_TO_DT)
		AND ISNULL(D.ANSWER_NAME,'')<>''
		AND A.MEMO_ID=@CMEMO_ID
     END
  */
  SET NOCOUNT OFF
END--SP3S_GETANSWER_ONDATE
