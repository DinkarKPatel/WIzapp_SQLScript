CREATE PROCEDURE SP_PPC_GST_BREAKUP
(
 @CXN_TYPE VARCHAR(10),
 @CMEMO_ID VARCHAR(100)=''
)
AS
BEGIN
  
IF @CXN_TYPE='PPC_PUR'
   GOTO LBLGST_PUR
ELSE IF @CXN_TYPE='PPC_PRT'
   GOTO LBLGST_PRT
ELSE 
GOTO END_PROC

		  LBLGST_PUR:
			      
			SELECT GST_PERCENTAGE ,SUM(XN_VALUE_WITHOUT_GST) AS TAXABLE_VALUE, 
			SUM(IGST_AMOUNT) AS IGST_AMT,SUM(CGST_AMOUNT) AS CGST_AMT, 
			SUM(SGST_AMOUNT) AS SGST_AMT 
			FROM PPC_PID01106 (NOLOCK) 
			WHERE  MRR_ID= @CMEMO_ID
			GROUP BY GST_PERCENTAGE 
			ORDER BY GST_PERCENTAGE


			SELECT 'FREIGHT' AS OH_NAME, FREIGHT_HSN_CODE AS HSN_CODE,
			FREIGHT_GST_PERCENTAGE  AS GST_PERCENTAGE,FREIGHT_IGST_AMOUNT  AS IGST_AMT,FREIGHT_CGST_AMOUNT AS CGST_AMT, 
			FREIGHT_SGST_AMOUNT AS SGST_AMT 
			FROM PPC_PIM01106 WHERE MRR_ID= @CMEMO_ID AND FREIGHT_GST_PERCENTAGE >0 
			UNION ALL
			SELECT 'OTHER CHARGES' AS OH_NAME, OTHER_CHARGES_HSN_CODE AS HSN_CODE,
			OTHER_CHARGES_GST_PERCENTAGE  AS GST_PERCENTAGE,OTHER_CHARGES_IGST_AMOUNT  AS IGST_AMT,OTHER_CHARGES_CGST_AMOUNT AS CGST_AMT,
			OTHER_CHARGES_SGST_AMOUNT AS SGST_AMT
			FROM PIM01106 WHERE MRR_ID= @CMEMO_ID AND OTHER_CHARGES_GST_PERCENTAGE >0
			
		GOTO END_PROC
		      
         
           LBLGST_PRT:
			      
			SELECT GST_PERCENTAGE ,SUM(XN_VALUE_WITHOUT_GST) AS TAXABLE_VALUE, 
			SUM(IGST_AMOUNT) AS IGST_AMT,SUM(CGST_AMOUNT) AS CGST_AMT, 
			SUM(SGST_AMOUNT) AS SGST_AMT 
			FROM PPC_RMD01106 (NOLOCK) 
			WHERE  RM_ID= @CMEMO_ID
			GROUP BY GST_PERCENTAGE 
			ORDER BY GST_PERCENTAGE


			SELECT 'FREIGHT' AS OH_NAME, FREIGHT_HSN_CODE AS HSN_CODE,
			FREIGHT_GST_PERCENTAGE  AS GST_PERCENTAGE,FREIGHT_IGST_AMOUNT  AS IGST_AMT,FREIGHT_CGST_AMOUNT AS CGST_AMT, 
			FREIGHT_SGST_AMOUNT AS SGST_AMT 
			FROM PPC_RMM01106 WHERE RM_ID= @CMEMO_ID AND FREIGHT_GST_PERCENTAGE >0 
			UNION ALL
			SELECT 'OTHER CHARGES' AS OH_NAME, OTHER_CHARGES_HSN_CODE AS HSN_CODE,
			OTHER_CHARGES_GST_PERCENTAGE  AS GST_PERCENTAGE,OTHER_CHARGES_IGST_AMOUNT  AS IGST_AMT,OTHER_CHARGES_CGST_AMOUNT AS CGST_AMT,
			OTHER_CHARGES_SGST_AMOUNT AS SGST_AMT
			FROM PPC_RMM01106 WHERE RM_ID= @CMEMO_ID AND OTHER_CHARGES_GST_PERCENTAGE >0
			
		GOTO END_PROC
		      

END_PROC:
END
