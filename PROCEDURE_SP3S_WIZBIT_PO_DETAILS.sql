CREATE PROCEDURE SP3S_WIZBIT_PO_DETAILS
(
@PO_ID VARCHAR(MAX)=''
)
AS
BEGIN
    
           
            
            -- UPDATE ATTRIBUTE_DETAILS_NEW SET CHK=1
            
            DECLARE @GROUP VARCHAR(MAX) ,@COL VARCHAR(MAX),@CCMD NVARCHAR(MAX),@SHOWCOLUMN  VARCHAR(MAX)
            
            SET @GROUP=''
            SET @COL=''
            
            IF EXISTS( SELECT TABLENAME, COLNAME FROM ATTRIBUTE_DETAILS_NEW WHERE CHK=1 AND TABLENAME LIKE '%SECTIONM%')
            BEGIN
				SET @GROUP=',SECTIONM.SECTION_NAME'
				SET @SHOWCOLUMN=',SECTIONM.SECTION_NAME AS [SECTION NAME]'
            END
               
            IF EXISTS( SELECT TABLENAME, COLNAME FROM ATTRIBUTE_DETAILS_NEW WHERE CHK=1 AND TABLENAME LIKE '%SECTIOND%')
            BEGIN
                SET @GROUP=@GROUP+',SECTIOND.SUB_SECTION_NAME'
                SET @SHOWCOLUMN=@SHOWCOLUMN+',SECTIOND.SUB_SECTION_NAME AS [SUB SECTION NAME]'
            END
        
            IF EXISTS( SELECT TABLENAME, COLNAME FROM ATTRIBUTE_DETAILS_NEW WHERE CHK=1 AND TABLENAME LIKE '%ARTICLE%')
             BEGIN
              SET @GROUP= @GROUP+', ARTICLE.ARTICLE_NO'
              SET @SHOWCOLUMN= @SHOWCOLUMN+', ARTICLE.ARTICLE_NO AS [ARTICLE NO]'
             END
               
            IF EXISTS( SELECT TABLENAME, COLNAME FROM ATTRIBUTE_DETAILS_NEW WHERE CHK=1 AND TABLENAME LIKE '%PARA4%')
            BEGIN
				 SET @GROUP=@GROUP+' , PARA4.PARA4_NAME'
				 SET @SHOWCOLUMN=@SHOWCOLUMN+' , PARA4.PARA4_NAME AS [BRAND]'
            END
               
           
           SET @GROUP=STUFF(@GROUP,1,1,'')
            SET @SHOWCOLUMN=STUFF(@SHOWCOLUMN,1,1,'')
                  
           
           
            SET @CCMD=N'SELECT '+@SHOWCOLUMN+',SUM(QUANTITY) AS [PO QTY],SUM(A.PURCHASE_PRICE) AS RATE,SUM(Amount) AS AMOUNT  FROM POD01106 A
           JOIN SKU ON SKU.PRODUCT_CODE=A.PRODUCT_CODE
           JOIN ARTICLE ON ARTICLE.ARTICLE_CODE=SKU.ARTICLE_CODE
           JOIN SECTIOND ON SECTIOND.SUB_SECTION_CODE=ARTICLE.SUB_SECTION_CODE
           JOIN SECTIONM ON SECTIONM.SECTION_CODE=SECTIOND.SECTION_CODE
           JOIN PARA4 ON PARA4.PARA4_CODE=SKU.PARA4_CODE
           WHERE PO_ID='''+@PO_ID+''' GROUP  BY '+@GROUP+''
           PRINT @CCMD
           EXEC SP_EXECUTESQL @CCMD
           
            
END
