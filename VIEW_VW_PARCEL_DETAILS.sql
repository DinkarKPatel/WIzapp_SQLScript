CREATE VIEW VW_PARCEL_DETAILS
AS
   SELECT A.PARCEL_MEMO_NO,A.PARCEL_MEMO_DT,A.RECEIPT_DT,
          A.CANCELLED,ANG_TYPE,A.TOTAL_AMOUNT,A.DEPT_ID,A.COMPANY_CODE,A.LAST_UPDATE,
          A.PARCEL_MEMO_ID,A.FIN_YEAR,
          A.EDT_USER_CODE,U1.USERNAME AS EDIT_USER_NAME,
          A.USER_CODE,U.USERNAME ,
          A.PAY_TYPE,CASH_RECEIPT_NO,
          A.ANGADIA_CODE,ANGM.Angadia_name ,
          A.BILTY_NO,A.REMARKS AS REMARKS_MST,
          A.XN_TYPE,
          CASE WHEN A.xn_type ='GRN' THEN 
          CASE WHEN ISNULL(REF_GRN_MODE,0)=2 THEN 'PO' ELSE 'ASN' END 
          ELSE A.xn_type END AS REF_XN_TYPE,
          A.MODE,A.HANDLED_BY,A.GATE_ENTRY_NO,A.DRIVER_NAME,
          A.VEHICLE_NO,A.DR_TO_PARTY,A.SHIPPING_CODE,A.PARCEL_TYPE,
          A.TAT_DAYS ,B.QTY,
          B.UOM_CODE,UOM.uom_name ,
          B.GOODS_DESC,B.REMARKS AS REMARKS_DET,
          B.QUANTITY,B.AMOUNT,B.BOX_NO,
          B.PARTY_INV_NO,B.PARTY_INV_AMT,B.PARTY_INV_DT,
          B.REF_GRN_MODE,
          B.REF_MEMO_NO +
          CASE WHEN A.xn_type ='GRN' THEN 
          CASE WHEN ISNULL(REF_GRN_MODE,0)=2 THEN '' ELSE  ' ('+AM.MEMO_NO +') ' END 
          ELSE '' END AS REF_MEMO_NO,
          
          B.REF_MEMO_ID,
          B.AC_CODE,LMV.AC_NAME ,
          B.CLOSED,
          COMPANY_NAME ,
          CMP.ADDRESS1,CMP.ADDRESS2,ADDRESS9,
          COMPANY_IMG_PATH=CMP.LOGO_PATH,  
          CA.AREA_NAME,CC.CITY,CS.STATE ,
          CMP.GST_NO,CMP.GST_DT,CMP.PAN_NO,CMP.EMAIL_ID,
          CMP.TIN_NO
   FROM PARCEL_MST A
   JOIN PARCEL_DET B ON A.PARCEL_MEMO_ID =B.PARCEL_MEMO_ID 
   JOIN LMV01106 LMV (NOLOCK) ON LMV.AC_CODE =B.AC_CODE 
   JOIN COMPANY CMP (NOLOCK) ON CMP.COMPANY_CODE='01'
   LEFT JOIN AREA CA ON CMP.AREA_CODE=CA.AREA_CODE  
   LEFT JOIN CITY CC ON CA.CITY_CODE=CC.CITY_CODE    
   LEFT JOIN STATE CS ON CC.CITY_CODE=CS.STATE_CODE  
   LEFT JOIN USERS U (NOLOCK) ON U.USER_CODE =A.USER_CODE 
   LEFT JOIN USERS U1 (NOLOCK) ON U1.USER_CODE =A.EDT_USER_CODE 
   LEFT JOIN ANGM (NOLOCK) ON A.angadia_code =ANGM.Angadia_code 
   LEFT JOIN uom (NOLOCK) ON UOM.uom_code =B.uom_code 
   LEFT JOIN ASN_MST AM (NOLOCK) ON AM.MEMO_ID =B.REF_MEMO_ID 
   
