CREATE FUNCTION DBO.GET_REPORT_DATE(@DATE DATE,@PERIOD VARCHAR(10))
RETURNS VARCHAR(10)
AS
BEGIN
DECLARE @DATED DATE,@FIN INT=1
IF LEFT(@PERIOD,1)='1'
   SET @DATE=DATEADD(DD,1,@DATE)
IF LEFT(@PERIOD,1)='0'
   SET @DATE=DATEADD(DD,0,@DATE)
IF LEFT(@PERIOD,1)='L'
   SET @DATE=DATEADD(YY,-1,DATEADD(DD,CASE SIGN(DATEPART(DW,@DATE)-DATEPART(DW,DATEADD(YY,-1,@DATE))) WHEN 1 THEN 0 ELSE 7 END+DATEPART(DW,@DATE)-DATEPART(DW,DATEADD(YY,-1,@DATE)),@DATE))
ELSE
   SET @DATE=DATEADD(YY,0,@DATE)
   
IF @PERIOD LIKE '%Y%' 
   IF MONTH(@DATE)<4
      SET @DATE=DATEADD(YY,-1,@DATE)
SET @DATED= CASE WHEN @PERIOD LIKE '%[D,T]' THEN @DATE 
				 WHEN @PERIOD LIKE '%W%'    THEN --DATEADD(DD,1-DATEPART(DW,@DATE),@DATE)--FROM MONDAY
												 --DATEADD(DD,-DATEPART(DW,@DATE)+2,@DATE)
												 DBO.GET_WEEK_START_END(@DATE, 'S')--FROM MONDAY
				 WHEN @PERIOD LIKE '%M%'    THEN DATEADD(DD,-DAY(CONVERT(DATE,@DATE))+1,CONVERT(DATE,@DATE))
				 WHEN @PERIOD LIKE '%Q%'    THEN DATEADD(YY,YEAR(@DATE)-1900,DATEADD(QQ,CEILING(MONTH(@DATE)/3.0)-1,0))
				 WHEN @PERIOD LIKE '%Y%'    THEN DATEADD(QQ,@FIN,DATEADD(DD,-DATEPART(DAYOFYEAR,@DATE)+1,@DATE))
			END
RETURN REPLACE(CONVERT(VARCHAR,@DATED,102),'.','-')
END