
IF NOT EXISTS (SELECT TOP 1 'U' FROM BIN WHERE BIN_ID='777')
BEGIN

    INSERT BIN	( ADDRESS1, ADDRESS2, AREA_CODE, AREA_COVERED, BILL_PREFIX, BIN_ALIAS, BIN_ID, BIN_NAME, INACTIVE, LAST_UPDATE, MAJOR_BIN_ID, MBO_COUNTER, MBO_LEDGER_AC_CODE, ONLINE_COUNTER, PAN_NO, PHONE_NO, TAN_NO, TIN_NO )  
	SELECT 	 '' ADDRESS1,'' ADDRESS2,'' AREA_CODE,0 AREA_COVERED,'' BILL_PREFIX,
	'' BIN_ALIAS,'777' BIN_ID, 
	'Shortage and Excess Bin' BIN_NAME,0 INACTIVE,GETDATE() LAST_UPDATE, 
	'777' MAJOR_BIN_ID,NULL MBO_COUNTER,'0000000000' MBO_LEDGER_AC_CODE, 
	NULL ONLINE_COUNTER,'' PAN_NO,'' PHONE_NO,'' TAN_NO,'' TIN_NO 


END

INSERT BIN_LOC	( BIN_ID, DEPT_ID, LAST_UPDATE )
SELECT b.BIN_ID, A.DEPT_ID,getdate() as  LAST_UPDATE
FROM LOCATION A (NOLOCK)
JOIN BIN B ON B.BIN_ID='777'
left join BIN_LOC c (nolock) on c.DEPT_ID =a.dept_id and c.BIN_ID =b.BIN_ID 
where c.BIN_ID is null

