CREATE PROCEDURE SP3S_VW_SALEANALYSIS
(
	 @CTARGETDBNAME VARCHAR(100)
	,@ERROR VARCHAR(1000) OUTPUT
)
--WITH ENCRYPTION
AS
BEGIN
SET NOCOUNT ON
	DECLARE  @PAYMODE_CODE VARCHAR(10),@PAYMODE_NAME VARCHAR(100),@LOOP BIT
			,@CROSSTABPAYS VARCHAR(MAX),@DSQL NVARCHAR(MAX),@DCOLUMNS_SLS NVARCHAR(MAX)
			,@DTABLES_SLS NVARCHAR(MAX),@DCOLUMNS_APP NVARCHAR(MAX)
			,@DTABLES_APP NVARCHAR(MAX),@DCOLUMNS_APR NVARCHAR(MAX)
			,@DTABLES_APR NVARCHAR(MAX),@STEP VARCHAR(10)

BEGIN TRY
	SET @STEP=10
	IF OBJECT_ID('TEMPDB..#PAYMODE_MST','U') IS NOT NULL
			DROP TABLE #PAYMODE_MST
	SELECT PAYMODE_CODE,PAYMODE_NAME INTO #PAYMODE_MST FROM PAYMODE_MST
	
	SET @STEP=20
	SET @CROSSTABPAYS=''
	IF EXISTS(SELECT TOP 1 * FROM #PAYMODE_MST)
		SET @LOOP=1
	SET @STEP=30	
	WHILE @LOOP=1
	BEGIN
		SELECT TOP 1 @PAYMODE_CODE=PAYMODE_CODE,@PAYMODE_NAME=PAYMODE_NAME FROM #PAYMODE_MST
		SET @CROSSTABPAYS=@CROSSTABPAYS+' ,SUM(CASE WHEN PDET.PAYMODE_CODE='''+@PAYMODE_CODE+''' THEN PDET.AMOUNT ELSE 0 END) AS ['+@PAYMODE_NAME+']'
		DELETE #PAYMODE_MST WHERE PAYMODE_CODE=@PAYMODE_CODE
		
		IF NOT EXISTS(SELECT TOP 1 * FROM #PAYMODE_MST)
			SET @LOOP=0
	END	

	SET @STEP=40
	IF @CROSSTABPAYS<>''
	BEGIN 
	SET @STEP=50
	SET @DCOLUMNS_SLS=N' (CASE WHEN CMD.QUANTITY<0 THEN ''SLR'' ELSE ''SLS'' END) AS XN_TYPE,CMM.CM_NO AS XN_NO,CMM.CM_DT AS XN_DT,CMM.CM_MODE AS XN_MODE,ABS(CMM.SUBTOTAL) AS SUBTOTAL,CMM.DT_CODE,ABS(CMM.DISCOUNT_PERCENTAGE) AS MST_DISCOUNT_PERCENTAGE
						 ,ABS(CMM.DISCOUNT_AMOUNT) AS MST_DISCOUNT_AMOUNT,ABS(CMM.NET_AMOUNT) AS NET_AMOUNT,CMM.CUSTOMER_CODE,CMM.CANCELLED,CMM.USER_CODE,CMM.LAST_UPDATE,CMM.EXEMPTED,'''' AS COMPUTER_NAME
						 ,CMM.SENT_TO_HO,CMM.CM_TIME AS XN_TIME,CMM.CM_ID AS XN_ID,CMM.REF_CM_ID AS REF_XN_ID,CMM.FIN_YEAR,ABS(CMM.ATD_CHARGES) AS ATD_CHARGES,CMM.COPIES_PTD,CMM.ROUND_OFF,CMM.MEMO_TYPE,0 AS PAY_MODE,CMM.SMS_SENT
						,CMM.AUTOENTRY,CMM.CASH_TENDERED,CMM.PAYBACK,CMM.ECOUPON_ID,CMM.CAMPAIGN_GC_OTP,CMM.SALESSETUPINEFFECT
						,CMM.EDT_USER_CODE,CMM.GV_AMOUNT,CMM.REF_NO,CMM.SENT_FOR_GR,CMM.REMARKS AS MST_REMARKS,CMM.SENT_FOR_RECON
						,CMM.PARTY_TYPE,CMM.AC_CODE,CMM.MANUAL_DISCOUNT AS MST_MANUAL_DISCOUNT,CMM.FC_RATE,CMM.MANUAL_ROUNDOFF
						,CMM.POSTEDINAC,CMD.PRODUCT_CODE,CMD.QUANTITY,CMD.MRP,CMD.NET,CMD.DISCOUNT_PERCENTAGE AS DET_DISCOUNT_PERCENTAGE
						,CMD.DISCOUNT_AMOUNT AS DET_DISCOUNT_AMOUNT,CMD.ROW_ID,CMD.TAX_PERCENTAGE,CMD.TAX_AMOUNT,CMD.EMP_CODE,CMD.SLSDET_ROW_ID
						,CMD.DEPT_ID,CMD.OLD_MRP,CMD.REF_SLS_MEMO_ID,CMD.REALIZE_SALE,CMD.RFNET,CMD.TAX_TYPE,CMD.TAX_METHOD
						,CMD.EAN,CMD.EMP_CODE1,CMD.EMP_CODE2,CMD.ITEM_DESC,CMD.WEIGHTED_AVG_DISC_PCT,CMD.WEIGHTED_AVG_DISC_AMT
						,CMD.MANUAL_DISCOUNT AS DET_MANUAL_DISCOUNT,CMD.FIX_MRP,CMD.SR_NO,CMD.HOLD_FOR_ALTER,CMD.PACK_SLIP_ID,CMD.XN_TYPE AS DET_XN_TYPE
						,SKU.PARA2_CODE,SKU.PURCHASE_PRICE,SKU.PARA3_CODE,SKU.INV_DT,SKU.INV_NO,SKU.AC_CODE AS SUPPLIER_CODE,SKU.RECEIPT_DT
						,SKU.PARA4_CODE,SKU.PARA5_CODE,SKU.PARA6_CODE,SKU.FORM_ID,SKU.MRP AS SKU_MRP,SKU.DT_CREATED,SKU.WS_PRICE
						,SKU.IMAGE_NAME,SKU.TAX_AMOUNT AS SKU_TAX_AMOUNT,SKU.CHALLAN_NO,SKU.FIX_MRP AS SKU_FIX_MRP,SKU.PRODUCT_NAME
						,SKU.ARTICLE_CODE,SKU.PARA1_CODE,SKU.ER_FLAG,1 AS BILL_LEVEL_TAX_METHOD,SKU.UPLOADED_TO_ACTIVSTREAM,SKU.BARCODE_CODING_SCHEME
						,SKU.EMP_CODE AS SKU_EMP_CODE,ART.FIX_MRP AS ARTICLE_FIX_MRP,ART.ENABLE_FIXWT_ENTRY
						,ART.FIX_WEIGHT,ART.EXP_AMOUNT,ART.SUPP_SPECIFIC,ART.SUPP_AC_CODE,ART.SUPP_ITEM_CODE
						,ART.REMARKS AS ARTICLE_REMARKS,ART.FIX_PRICE_ARTICLE,ART.GROSS_PURCHASE_PRICE
						,ART.DISCOUNT_PERCENTAGE,ART.DISCOUNT_AMOUNT,ART.GEN_EAN_CODES,ART.CODING_SCHEME
						,ART.LAST_UPDATE AS ARTICLE_LAST_UPDATE,ART.UOM_CODE,ART.ALIAS,ART.MP_PERCENTAGE
						,ART.PURCHASE_PRICE AS ARTICLE_PURCHASE_PRICE,ART.MRP AS ART_MRP,ART.PARA1_SET
						,ART.PARA2_SET,ART.INACTIVE,ART.SKU_CODE,ART.DT_CREATED AS ARTICLE_DT_CREATED
						,ART.USER_CODE AS ARTICLE_USER_CODE,ART.EDT_USER_CODE AS ARTICLE_EDT_USER_CODE
						,ART.ARTICLE_NO,ART.ARTICLE_NAME,ART.ARTICLE_DESC,ART.SUB_SECTION_CODE,ART.DISCON
						,ART.WHOLESALE_PRICE,ART.WSP_PERCENTAGE,ART.MIN_PRICE,ART.STOCK_NA,ART.ARTICLE_TYPE
						,ART.CREATED_ON,ART.ARTICLE_GROUP_CODE,ART.COMPANY_CODE,ART.GENERATE_BARCODES_WITHARTICLE_PREFIX
						,ART.ARTICLE_GEN_MODE,ART.ARTICLE_PRD_MODE,ART.ARTICLE_SET_CODE,ART.OH_PERCENTAGE,ART.OH_AMOUNT
						,ART.SIZE_CENTER_POINT,ART.SIZE_RATE_DIFF,SD.SUB_SECTION_NAME,SD.LAST_UPDATE AS SUB_SECTION_LAST_UPDATE
						,SD.ALIAS AS SUB_SECTION_ALIAS,SD.INACTIVE AS SUB_INACTIVE,SD.MFG_CATEGORY,SD.SECTION_CODE,SD.REMARKS AS SUB_SECTION_REMARKS,SM.LAST_UPDATE AS SECTION_LAST_UPDATE
						,SM.ALIAS AS SECTION_ALIAS,SM.INACTIVE AS SECTION_INACTIVE,SM.REMARKS AS SECTION_REMARKS,UOM.UOM_TYPE 
						,UOM.INACTIVE AS UOM_INACTIVE,UOM.UOM_NAME,UOM.LAST_UPDATE AS UOM_LAST_UPDATE,P1.PARA1_NAME
						,P1.LAST_UPDATE AS PARA1_LAST_UPDATE,P1.ALIAS AS PARA1_ALIAS,P1.INACTIVE AS PARA1_INACTIVE,P1.PARA1_ORDER
						,P1.REMARKS AS PARA1_REMARKS,P2.LAST_UPDATE AS PARA2_LAST_UPDATE,P2.ALIAS AS PARA2_ALIAS,P2.INACTIVE AS PARA2_INACTIVE
						,P2.PARA2_ORDER AS PARA2_PARA2_ORDER,P2.PARA2_NAME,P2.REMARKS AS PARA2_REMARKS,P3.INACTIVE AS PARA3_INACTIVE
						,P3.DT_CREATED AS PARA3_DT_CREATED,P3.REMARKS AS PARA3_REMARKS,P3.PARA3_NAME,P3.LAST_UPDATE AS PARA3_LAST_UPDATE
						,P3.ALIAS AS PARA3_ALIAS,P4.PARA4_NAME,P4.LAST_UPDATE AS PARA4_LAST_UPDATE,P4.ALIAS AS PARA4_ALIAS
						,P4.INACTIVE AS PARA4_INACTIVE,P4.REMARKS AS PARA4_REMARKS,P5.ALIAS AS PARA5_ALIAS,P5.INACTIVE AS PARA5_INACTIVE
						,P5.PARA5_NAME,P5.LAST_UPDATE AS PARA5_LAST_UPDATE,P5.REMARKS AS PARA5_REMARKS,P6.PARA6_NAME
						,P6.LAST_UPDATE AS PARA6_LAST_UPDATE,P6.ALIAS AS PARA6_ALIAS,P6.INACTIVE AS PARA6_INACTIVE,P6.REMARKS AS PARA6_REMARKS,FORM.POST_TAX_SEPARATELY
						,FORM.PUR_RETURN_AC_CODE,FORM.SALE_RETURN_AC_CODE,FORM.PHYSICAL_FORM,FORM.SERIES,FORM.EXCISE_ACCESSIBLE_PERCENTAGE
						,FORM.EXCISE_DUTY_PERCENTAGE,FORM.EXCISE_EDU_CESS_PERCENTAGE,FORM.EXCISE_HEDU_CESS_PERCENTAGE,FORM.EXCISE_EDU_CESS_AC_CODE
						,FORM.EXCISE_HEDU_CESS_AC_CODE,FORM.EXCISE_DUTY_AC_CODE,FORM.INACTIVE AS FORM_INACTIVE,FORM.FORM_NAME,FORM.PURCHASE_AC_CODE
						,FORM.SALE_AC_CODE,FORM.TAX_AC_CODE,FORM.TAX_PERCENTAGE AS FORM_TAX_PERCENTAGE,FORM.LAST_UPDATE AS FORM_LAST_UPDATE,EMP.EMP_HEAD 
						,EMP.LAST_UPDATE AS EMPLOYEE_LAST_UPDATE,EMP.INACTIVE AS EMPLOYEE_INACTIVE,EMP.EMP_NAME,EMP.EMP_ALIAS,EMP.EMP_TYPE,EMP1.EMP_HEAD AS EMPLOYEE1_EMP_HEAD
						,EMP1.LAST_UPDATE AS EMPLOYEE1_LAST_UPDATE,EMP1.INACTIVE AS EMPLOYEE1_INACTIVE,EMP1.EMP_NAME AS EMPLOYEE1_EMP_NAME,EMP1.EMP_ALIAS AS EMPLOYEE1_EMP_ALIAS
						,EMP1.EMP_TYPE AS EMPLOYEE1_EMP_TYPE,EMP2.EMP_HEAD AS EMPLOYEE2_EMP_HEAD,EMP2.LAST_UPDATE AS EMPLOYEE2_LAST_UPDATE
						,EMP2.INACTIVE AS EMPLOYEE2_INACTIVE,EMP2.EMP_NAME AS EMPLOYEE2_EMP_NAME,EMP2.EMP_ALIAS AS EMPLOYEE2_EMP_ALIAS,EMP2.EMP_TYPE AS EMPLOYEE2_EMP_TYPE
						,CM.DT_CREATED AS CUSTOMER_DT_CREATED,CM.PIN AS CUSTOMER_PIN,CM.DT_ANNIVERSARY AS CUSTOMER_DT_ANNIVERSARY,CM.SENT_TO_HO AS CUSTOMER_SENT_TO_HO
						,CM.INACTIVE AS CUSTOMER_INACTIVE,CM.AREA_CODE AS CUSTOMER_AREA_CODE,CM.LOCATION_ID AS CUSTOMER_LOCATION_ID,CM.ADDRESS0 AS CUSTOMER_ADDRESS0
						,CM.WIZCLIP_LAST_UPDATE AS CUSTOMER_WIZCLIP_LAST_UPDATE,CM.MANAGER_CARD AS CUSTOMER_MANAGER_CARD,CM.ADDRESS9 AS CUSTOMER_ADDRESS9,CM.CUSTOMER_CODE AS CUSTOMER_CUSTOMER_CODE
						,CM.USER_CUSTOMER_CODE AS CUSTOMER_USER_CUSTOMER_CODE,CM.CUSTOMER_TITLE AS CUSTOMER_CUSTOMER_TITLE,CM.CUSTOMER_FNAME AS CUSTOMER_FNAME,CM.CUSTOMER_LNAME AS CUSTOMER_LNAME
						,CM.ADDRESS1 AS CUSTOMER_ADDRESS1,CM.ADDRESS2 AS CUSTOMER_ADDRESS2,CM.PHONE1 AS CUSTOMER_PHONE1,CM.PHONE2 AS CUSTOMER_PHONE2
						,CM.MOBILE AS CUSTOMER_MOBILE,CM.EMAIL AS CUSTOMER_EMAIL,CM.OPENING_BALANCE AS CUSTOMER_OPENING_BALANCE,CM.LAST_UPDATE AS CUSTOMER_LAST_UPDATE
						,CM.DT_BIRTH AS CUSTOMER_DT_BIRTH,CM.REF_CUSTOMER_CODE AS CUSTOMER_REF_CUSTOMER_CODE,CM.PREFIX_CODE AS CUSTOMER_PREFIX_CODE,CM.FLAT_DISC_CUSTOMER AS CUSTOMER_FLAT_DISC_CUSTOMER
						,CM.FLAT_DISC_PERCENTAGE AS CUSTOMER_FLAT_DISC_PERCENTAGE,CM.PRIVILEGE_CUSTOMER AS CUSTOMER_PRIVILEGE_CUSTOMER,CM.DT_CARD_ISSUE AS CUSTOMER_DT_CARD_ISSUE
						,CM.DT_CARD_EXPIRY AS CUSTOMER_DT_CARD_EXPIRY,CM.CARD_NO AS CUSTOMER_CARD_NO,CM.CARD_NAME AS CUSTOMER_CARD_NAME,CM.FLAT_DISC_PERCENTAGE_DURING_SALES AS CUSTOMER_FLAT_DISC_PERCENTAGE_DURING_SALES
						,CM.AC_CODE AS CUSTOMER_AC_CODE,CA.AREA_NAME AS CUSTOMER_AREA_NAME
						,CA.PINCODE AS CUSTOMER_PINCODE,CC.CITY AS CUSTOMER_CITY,CC.DISTT_CODE AS CUSTOMER_DISTT_CODE
						,CS.STATE AS CUSTOMER_STATE,CS.OCTROI_PERCENTAGE AS CUSTOMER_OCTROI_PERCENTAGE
						,CR.REGION_NAME AS CUSTOMER_REGION_NAME,LM.UPLOADED_TO_ACTIVSTREAM AS LEDGER_UPLOADED_TO_ACTIVSTREAM
						,LM.USER_CODE AS LEDGER_USER_CODE,LM.EDT_USER_CODE AS LEDGER_EDT_USER_CODE,LM.LAST_UPDATE AS LEDGER_LAST_UPDATE
						,LM.OPENING_BALANCE AS LEDGER_OPENING_BALANCE,LM.OPENING_BALANCE_CR_DR AS LEDGER_OPENING_BALANCE_CR_DR
						,LM.TDS_CODE AS LEDGER_TDS_CODE,LM.INACTIVE AS LEDGER_INACTIVE,LM.AC_NAME AS LEDGER_AC_NAME
						,LM.ALIAS AS LEDGER_ALIAS,LM.HEAD_CODE AS LEDGER_HEAD_CODE,LM.CLOSING_BALANCE AS LEDGER_CLOSING_BALANCE
						,LM.CLOSING_BALANCE_CR_DR AS LEDGER_CLOSING_BALANCE_CR_DR,LM.PRINT_LEDGER AS LEDGER_PRINT_LEDGER,LM.ALIAS_TO_BE_SUFFIXED AS LEDGER_ALIAS_TO_BE_SUFFIXED
						,ISNULL(LMP.MP_PERCENTAGE,0) AS LEDGER_MP_PERCENTAGE,ISNULL(LMP.MRP_CALC_MODE,0) AS LEDGER_MRP_CALC_MODE,ISNULL(LMP.PRINT_NAME,'''') AS LEDGER_PRINT_NAME
						,ISNULL(LMP.ADDRESS0,'''') AS LEDGER_ADDRESS0,ISNULL(LMP.ADDRESS1,'''') AS LEDGER_ADDRESS1,ISNULL(LMP.SALES_AC_CODE,''0000000000'') AS LEDGER_SALES_AC_CODE
						,ISNULL(LMP.DEFAULT_RATE_TYPE,0) AS LEDGER_DEFAULT_RATE_TYPE,ISNULL(LMP.ADDRESS2,'''') AS LEDGER_ADDRESS2,ISNULL(LMP.CST_NO,'''') AS LEDGER_CST_NO
						,ISNULL(LMP.CST_DT,'''') AS LEDGER_CST_DT,ISNULL(LMP.SST_NO,'''') AS LEDGER_SST_NO,ISNULL(LMP.SST_DT,'''') AS LEDGER_SST_DT,ISNULL(LMP.PHONES_R,'''') AS LEDGER_PHONES_R
						,ISNULL(LMP.PHONES_O,'''') AS LEDGER_PHONES_O,ISNULL(LMP.PHONES_FAX,'''') AS LEDGER_PHONES_FAX,ISNULL(LMP.MOBILE,'''') AS LEDGER_MOBILE
						,ISNULL(LMP.E_MAIL,'''') AS LEDGER_E_MAIL,ISNULL(LMP.TAX_CODE,'''') AS LEDGER_TAX_CODE,ISNULL(LMP.CREDIT_DAYS,0) AS LEDGER_CREDIT_DAYS
						,ISNULL(LMP.DISCOUNT_PERCENTAGE,0) AS LEDGER_DISCOUNT_PERCENTAGE,ISNULL(LMP.BILL_BY_BILL,0) AS LEDGER_BILL_BY_BILL,ISNULL(LMP.ON_HOLD,0) AS LEDGER_ON_HOLD
						,ISNULL(LMP.THROUGH_BROKER,0) AS LEDGER_THROUGH_BROKER,ISNULL(LMP.BROKER_AC_CODE,''0000000000'') AS LEDGER_BROKER_AC_CODE
						,ISNULL(LMP.BROKER_COMM_PERCENT,0) AS LEDGER_BROKER_COMM_PERCENT,ISNULL(LMP.CREDIT_LIMIT,0) AS LEDGER_CREDIT_LIMIT,ISNULL(LMP.OUTSTATION_PARTY,0) AS LEDGER_OUTSTATION_PARTY
						,ISNULL(LMP.ALLOW_CREDITOR_DEBTOR,0) AS LEDGER_ALLOW_CREDITOR_DEBTOR,ISNULL(LMP.DPWEF_DT,'''') AS LEDGER_DPWEF_DT
						,ISNULL(LMP.TIN_NO,'''') AS LEDGER_TIN_NO,ISNULL(LMP.TIN_DT,'''') AS LEDGER_TIN_DT,ISNULL(LMP.CST_PERCENTAGE,0) AS LEDGER_CST_PERCENTAGE
						,ISNULL(LMP.PAN_NO,'''') AS LEDGER_PAN_NO,ISNULL(LMP.FORM_ID,''0000000'') AS LEDGER_FORM_ID
						,ISNULL(LMP.INV_RATE_TYPE,0) AS LEDGER_INV_RATE_TYPE,ISNULL(LMP.CUSTOMER_CODE,''000000000000'') AS LEDGER_CUSTOMER_CODE
						,ISNULL(LMP.GLN_NO,'''') AS LEDGER_GLN_NO,ISNULL(LMP.PUR_CAL_METHOD,0) AS LEDGER_PUR_CAL_METHOD
						,ISNULL(LMP.RESTRICT_PUR_ENTRY,0) AS LEDGER_RESTRICT_PUR_ENTRY,LA.AREA_NAME AS LEDGER_AREA_NAME,LA.PINCODE AS LEDGER_PINCODE
						,LC.CITY AS LEDGER_CITY,LC.DISTT_CODE AS LEDGER_DISTT_CODE,LS.STATE AS LEDGER_STATE,LS.OCTROI_PERCENTAGE AS LEDGER_OCTROI_PERCENTAGE,LR.REGION_NAME AS LEDGER_REGION_NAME,PMST.*'
		SET @STEP=60
		SET @DCOLUMNS_APP=N' ''APP'' AS XN_TYPE,CMM.MEMO_NO AS XN_NO,CMM.MEMO_DT AS XN_DT,0 AS XN_MODE
							,ABS(CMM.SUBTOTAL) AS SUBTOTAL,'''' AS DT_CODE,ABS(CMM.DISCOUNT_PERCENTAGE) AS MST_DISCOUNT_PERCENTAGE
							,ABS(CMM.DISCOUNT_AMOUNT) AS MST_DISCOUNT_AMOUNT,ABS(CMM.NET_AMOUNT) AS NET_AMOUNT,CMM.CUSTOMER_CODE,CMM.CANCELLED,CMM.USER_CODE,CMM.LAST_UPDATE,0 AS EXEMPTED,'''' AS COMPUTER_NAME
							,CMM.SENT_TO_HO,'''' AS XN_TIME,CMM.MEMO_ID AS XN_ID,'''' AS REF_XN_ID,CMM.FIN_YEAR,ABS(CMM.ATD_CHARGES) AS ATD_CHARGES,CMM.COPIES_PTD,CMM.ROUND_OFF,CMM.MEMO_TYPE,0 AS PAY_MODE,0 AS SMS_SENT
							,0 AS AUTOENTRY,0 AS CASH_TENDERED,0 AS PAYBACK,'''' AS ECOUPON_ID,'''' AS CAMPAIGN_GC_OTP,0 AS SALESSETUPINEFFECT
							,''0000000'' AS EDT_USER_CODE,0 AS GV_AMOUNT,CMM.REF_NO,0 AS SENT_FOR_GR,CMM.REMARKS AS MST_REMARKS,CMM.SENT_FOR_RECON
							,0 AS PARTY_TYPE,CMM.AC_CODE,CMM.MANUAL_DISCOUNT AS MST_MANUAL_DISCOUNT,0 AS FC_RATE,0 AS MANUAL_ROUNDOFF
							,0 AS POSTEDINAC,CMD.PRODUCT_CODE,CMD.QUANTITY,CMD.MRP,CMD.NET,CMD.DISCOUNT_PERCENTAGE AS DET_DISCOUNT_PERCENTAGE
							,CMD.DISCOUNT_AMOUNT AS DET_DISCOUNT_AMOUNT,CMD.ROW_ID,0 AS TAX_PERCENTAGE,0 AS TAX_AMOUNT,CMD.EMP_CODE,'''' AS SLSDET_ROW_ID
							,CMD.DEPT_ID,0 AS OLD_MRP,'''' AS REF_SLS_MEMO_ID,0 AS REALIZE_SALE,CMD.RFNET,0 AS TAX_TYPE,0 AS TAX_METHOD
							,'''' AS EAN,CMD.EMP_CODE1,CMD.EMP_CODE2,'''' AS ITEM_DESC,0 AS WEIGHTED_AVG_DISC_PCT,0 AS WEIGHTED_AVG_DISC_AMT
							,CMD.MANUAL_DISCOUNT AS DET_MANUAL_DISCOUNT,0 AS FIX_MRP,0 AS SR_NO,0 AS HOLD_FOR_ALTER,'''' AS PACK_SLIP_ID,'''' AS DET_XN_TYPE
							,SKU.PARA2_CODE,SKU.PURCHASE_PRICE,SKU.PARA3_CODE,SKU.INV_DT,SKU.INV_NO,SKU.AC_CODE AS SUPPLIER_CODE,SKU.RECEIPT_DT
							,SKU.PARA4_CODE,SKU.PARA5_CODE,SKU.PARA6_CODE,SKU.FORM_ID,SKU.MRP AS SKU_MRP,SKU.DT_CREATED,SKU.WS_PRICE
							,SKU.IMAGE_NAME,SKU.TAX_AMOUNT AS SKU_TAX_AMOUNT,SKU.CHALLAN_NO,SKU.FIX_MRP AS SKU_FIX_MRP,SKU.PRODUCT_NAME
							,SKU.ARTICLE_CODE,SKU.PARA1_CODE,SKU.ER_FLAG,1 AS BILL_LEVEL_TAX_METHOD,SKU.UPLOADED_TO_ACTIVSTREAM,SKU.BARCODE_CODING_SCHEME
							,SKU.EMP_CODE AS SKU_EMP_CODE,ART.FIX_MRP AS ARTICLE_FIX_MRP,ART.ENABLE_FIXWT_ENTRY
							,ART.FIX_WEIGHT,ART.EXP_AMOUNT,ART.SUPP_SPECIFIC,ART.SUPP_AC_CODE,ART.SUPP_ITEM_CODE
							,ART.REMARKS AS ARTICLE_REMARKS,ART.FIX_PRICE_ARTICLE,ART.GROSS_PURCHASE_PRICE
							,ART.DISCOUNT_PERCENTAGE,ART.DISCOUNT_AMOUNT,ART.GEN_EAN_CODES,ART.CODING_SCHEME
							,ART.LAST_UPDATE AS ARTICLE_LAST_UPDATE,ART.UOM_CODE,ART.ALIAS,ART.MP_PERCENTAGE
							,ART.PURCHASE_PRICE AS ARTICLE_PURCHASE_PRICE,ART.MRP AS ART_MRP,ART.PARA1_SET
							,ART.PARA2_SET,ART.INACTIVE,ART.SKU_CODE,ART.DT_CREATED AS ARTICLE_DT_CREATED
							,ART.USER_CODE AS ARTICLE_USER_CODE,ART.EDT_USER_CODE AS ARTICLE_EDT_USER_CODE
							,ART.ARTICLE_NO,ART.ARTICLE_NAME,ART.ARTICLE_DESC,ART.SUB_SECTION_CODE,ART.DISCON
							,ART.WHOLESALE_PRICE,ART.WSP_PERCENTAGE,ART.MIN_PRICE,ART.STOCK_NA,ART.ARTICLE_TYPE
							,ART.CREATED_ON,ART.ARTICLE_GROUP_CODE,ART.COMPANY_CODE,ART.GENERATE_BARCODES_WITHARTICLE_PREFIX
							,ART.ARTICLE_GEN_MODE,ART.ARTICLE_PRD_MODE,ART.ARTICLE_SET_CODE,ART.OH_PERCENTAGE,ART.OH_AMOUNT
							,ART.SIZE_CENTER_POINT,ART.SIZE_RATE_DIFF,SD.SUB_SECTION_NAME,SD.LAST_UPDATE AS SUB_SECTION_LAST_UPDATE
							,SD.ALIAS AS SUB_SECTION_ALIAS,SD.INACTIVE AS SUB_INACTIVE,SD.MFG_CATEGORY,SD.SECTION_CODE,SD.REMARKS AS SUB_SECTION_REMARKS,SM.LAST_UPDATE AS SECTION_LAST_UPDATE
							,SM.ALIAS AS SECTION_ALIAS,SM.INACTIVE AS SECTION_INACTIVE,SM.REMARKS AS SECTION_REMARKS,UOM.UOM_TYPE 
							,UOM.INACTIVE AS UOM_INACTIVE,UOM.UOM_NAME,UOM.LAST_UPDATE AS UOM_LAST_UPDATE,P1.PARA1_NAME
							,P1.LAST_UPDATE AS PARA1_LAST_UPDATE,P1.ALIAS AS PARA1_ALIAS,P1.INACTIVE AS PARA1_INACTIVE,P1.PARA1_ORDER
							,P1.REMARKS AS PARA1_REMARKS,P2.LAST_UPDATE AS PARA2_LAST_UPDATE,P2.ALIAS AS PARA2_ALIAS,P2.INACTIVE AS PARA2_INACTIVE
							,P2.PARA2_ORDER AS PARA2_PARA2_ORDER,P2.PARA2_NAME,P2.REMARKS AS PARA2_REMARKS,P3.INACTIVE AS PARA3_INACTIVE
							,P3.DT_CREATED AS PARA3_DT_CREATED,P3.REMARKS AS PARA3_REMARKS,P3.PARA3_NAME,P3.LAST_UPDATE AS PARA3_LAST_UPDATE
							,P3.ALIAS AS PARA3_ALIAS,P4.PARA4_NAME,P4.LAST_UPDATE AS PARA4_LAST_UPDATE,P4.ALIAS AS PARA4_ALIAS
							,P4.INACTIVE AS PARA4_INACTIVE,P4.REMARKS AS PARA4_REMARKS,P5.ALIAS AS PARA5_ALIAS,P5.INACTIVE AS PARA5_INACTIVE
							,P5.PARA5_NAME,P5.LAST_UPDATE AS PARA5_LAST_UPDATE,P5.REMARKS AS PARA5_REMARKS,P6.PARA6_NAME
							,P6.LAST_UPDATE AS PARA6_LAST_UPDATE,P6.ALIAS AS PARA6_ALIAS,P6.INACTIVE AS PARA6_INACTIVE,P6.REMARKS AS PARA6_REMARKS,FORM.POST_TAX_SEPARATELY
							,FORM.PUR_RETURN_AC_CODE,FORM.SALE_RETURN_AC_CODE,FORM.PHYSICAL_FORM,FORM.SERIES,FORM.EXCISE_ACCESSIBLE_PERCENTAGE
							,FORM.EXCISE_DUTY_PERCENTAGE,FORM.EXCISE_EDU_CESS_PERCENTAGE,FORM.EXCISE_HEDU_CESS_PERCENTAGE,FORM.EXCISE_EDU_CESS_AC_CODE
							,FORM.EXCISE_HEDU_CESS_AC_CODE,FORM.EXCISE_DUTY_AC_CODE,FORM.INACTIVE AS FORM_INACTIVE,FORM.FORM_NAME,FORM.PURCHASE_AC_CODE
							,FORM.SALE_AC_CODE,FORM.TAX_AC_CODE,FORM.TAX_PERCENTAGE AS FORM_TAX_PERCENTAGE,FORM.LAST_UPDATE AS FORM_LAST_UPDATE,EMP.EMP_HEAD 
							,EMP.LAST_UPDATE AS EMPLOYEE_LAST_UPDATE,EMP.INACTIVE AS EMPLOYEE_INACTIVE,EMP.EMP_NAME,EMP.EMP_ALIAS,EMP.EMP_TYPE,EMP1.EMP_HEAD AS EMPLOYEE1_EMP_HEAD
							,EMP1.LAST_UPDATE AS EMPLOYEE1_LAST_UPDATE,EMP1.INACTIVE AS EMPLOYEE1_INACTIVE,EMP1.EMP_NAME AS EMPLOYEE1_EMP_NAME,EMP1.EMP_ALIAS AS EMPLOYEE1_EMP_ALIAS
							,EMP1.EMP_TYPE AS EMPLOYEE1_EMP_TYPE,EMP2.EMP_HEAD AS EMPLOYEE2_EMP_HEAD,EMP2.LAST_UPDATE AS EMPLOYEE2_LAST_UPDATE
							,EMP2.INACTIVE AS EMPLOYEE2_INACTIVE,EMP2.EMP_NAME AS EMPLOYEE2_EMP_NAME,EMP2.EMP_ALIAS AS EMPLOYEE2_EMP_ALIAS,EMP2.EMP_TYPE AS EMPLOYEE2_EMP_TYPE
							,CM.DT_CREATED AS CUSTOMER_DT_CREATED,CM.PIN AS CUSTOMER_PIN,CM.DT_ANNIVERSARY AS CUSTOMER_DT_ANNIVERSARY,CM.SENT_TO_HO AS CUSTOMER_SENT_TO_HO
							,CM.INACTIVE AS CUSTOMER_INACTIVE,CM.AREA_CODE AS CUSTOMER_AREA_CODE,CM.LOCATION_ID AS CUSTOMER_LOCATION_ID,CM.ADDRESS0 AS CUSTOMER_ADDRESS0
							,CM.WIZCLIP_LAST_UPDATE AS CUSTOMER_WIZCLIP_LAST_UPDATE,CM.MANAGER_CARD AS CUSTOMER_MANAGER_CARD,CM.ADDRESS9 AS CUSTOMER_ADDRESS9,CM.CUSTOMER_CODE AS CUSTOMER_CUSTOMER_CODE
							,CM.USER_CUSTOMER_CODE AS CUSTOMER_USER_CUSTOMER_CODE,CM.CUSTOMER_TITLE AS CUSTOMER_CUSTOMER_TITLE,CM.CUSTOMER_FNAME AS CUSTOMER_FNAME,CM.CUSTOMER_LNAME AS CUSTOMER_LNAME
							,CM.ADDRESS1 AS CUSTOMER_ADDRESS1,CM.ADDRESS2 AS CUSTOMER_ADDRESS2,CM.PHONE1 AS CUSTOMER_PHONE1,CM.PHONE2 AS CUSTOMER_PHONE2
							,CM.MOBILE AS CUSTOMER_MOBILE,CM.EMAIL AS CUSTOMER_EMAIL,CM.OPENING_BALANCE AS CUSTOMER_OPENING_BALANCE,CM.LAST_UPDATE AS CUSTOMER_LAST_UPDATE
							,CM.DT_BIRTH AS CUSTOMER_DT_BIRTH,CM.REF_CUSTOMER_CODE AS CUSTOMER_REF_CUSTOMER_CODE,CM.PREFIX_CODE AS CUSTOMER_PREFIX_CODE,CM.FLAT_DISC_CUSTOMER AS CUSTOMER_FLAT_DISC_CUSTOMER
							,CM.FLAT_DISC_PERCENTAGE AS CUSTOMER_FLAT_DISC_PERCENTAGE,CM.PRIVILEGE_CUSTOMER AS CUSTOMER_PRIVILEGE_CUSTOMER,CM.DT_CARD_ISSUE AS CUSTOMER_DT_CARD_ISSUE
							,CM.DT_CARD_EXPIRY AS CUSTOMER_DT_CARD_EXPIRY,CM.CARD_NO AS CUSTOMER_CARD_NO,CM.CARD_NAME AS CUSTOMER_CARD_NAME,CM.FLAT_DISC_PERCENTAGE_DURING_SALES AS CUSTOMER_FLAT_DISC_PERCENTAGE_DURING_SALES
							,CM.AC_CODE AS CUSTOMER_AC_CODE,CA.AREA_NAME AS CUSTOMER_AREA_NAME
							,CA.PINCODE AS CUSTOMER_PINCODE,CC.CITY AS CUSTOMER_CITY,CC.DISTT_CODE AS CUSTOMER_DISTT_CODE
							,CS.STATE AS CUSTOMER_STATE,CS.OCTROI_PERCENTAGE AS CUSTOMER_OCTROI_PERCENTAGE
							,CR.REGION_NAME AS CUSTOMER_REGION_NAME,LM.UPLOADED_TO_ACTIVSTREAM AS LEDGER_UPLOADED_TO_ACTIVSTREAM
							,LM.USER_CODE AS LEDGER_USER_CODE,LM.EDT_USER_CODE AS LEDGER_EDT_USER_CODE,LM.LAST_UPDATE AS LEDGER_LAST_UPDATE
							,LM.OPENING_BALANCE AS LEDGER_OPENING_BALANCE,LM.OPENING_BALANCE_CR_DR AS LEDGER_OPENING_BALANCE_CR_DR
							,LM.TDS_CODE AS LEDGER_TDS_CODE,LM.INACTIVE AS LEDGER_INACTIVE,LM.AC_NAME AS LEDGER_AC_NAME
							,LM.ALIAS AS LEDGER_ALIAS,LM.HEAD_CODE AS LEDGER_HEAD_CODE,LM.CLOSING_BALANCE AS LEDGER_CLOSING_BALANCE
							,LM.CLOSING_BALANCE_CR_DR AS LEDGER_CLOSING_BALANCE_CR_DR,LM.PRINT_LEDGER AS LEDGER_PRINT_LEDGER,LM.ALIAS_TO_BE_SUFFIXED AS LEDGER_ALIAS_TO_BE_SUFFIXED
							,ISNULL(LMP.MP_PERCENTAGE,0) AS LEDGER_MP_PERCENTAGE,ISNULL(LMP.MRP_CALC_MODE,0) AS LEDGER_MRP_CALC_MODE,ISNULL(LMP.PRINT_NAME,'''') AS LEDGER_PRINT_NAME
							,ISNULL(LMP.ADDRESS0,'''') AS LEDGER_ADDRESS0,ISNULL(LMP.ADDRESS1,'''') AS LEDGER_ADDRESS1,ISNULL(LMP.SALES_AC_CODE,''0000000000'') AS LEDGER_SALES_AC_CODE
							,ISNULL(LMP.DEFAULT_RATE_TYPE,0) AS LEDGER_DEFAULT_RATE_TYPE,ISNULL(LMP.ADDRESS2,'''') AS LEDGER_ADDRESS2,ISNULL(LMP.CST_NO,'''') AS LEDGER_CST_NO
							,ISNULL(LMP.CST_DT,'''') AS LEDGER_CST_DT,ISNULL(LMP.SST_NO,'''') AS LEDGER_SST_NO,ISNULL(LMP.SST_DT,'''') AS LEDGER_SST_DT,ISNULL(LMP.PHONES_R,'''') AS LEDGER_PHONES_R
							,ISNULL(LMP.PHONES_O,'''') AS LEDGER_PHONES_O,ISNULL(LMP.PHONES_FAX,'''') AS LEDGER_PHONES_FAX,ISNULL(LMP.MOBILE,'''') AS LEDGER_MOBILE
							,ISNULL(LMP.E_MAIL,'''') AS LEDGER_E_MAIL,ISNULL(LMP.TAX_CODE,'''') AS LEDGER_TAX_CODE,ISNULL(LMP.CREDIT_DAYS,0) AS LEDGER_CREDIT_DAYS
							,ISNULL(LMP.DISCOUNT_PERCENTAGE,0) AS LEDGER_DISCOUNT_PERCENTAGE,ISNULL(LMP.BILL_BY_BILL,0) AS LEDGER_BILL_BY_BILL,ISNULL(LMP.ON_HOLD,0) AS LEDGER_ON_HOLD
							,ISNULL(LMP.THROUGH_BROKER,0) AS LEDGER_THROUGH_BROKER,ISNULL(LMP.BROKER_AC_CODE,''0000000000'') AS LEDGER_BROKER_AC_CODE
							,ISNULL(LMP.BROKER_COMM_PERCENT,0) AS LEDGER_BROKER_COMM_PERCENT,ISNULL(LMP.CREDIT_LIMIT,0) AS LEDGER_CREDIT_LIMIT,ISNULL(LMP.OUTSTATION_PARTY,0) AS LEDGER_OUTSTATION_PARTY
							,ISNULL(LMP.ALLOW_CREDITOR_DEBTOR,0) AS LEDGER_ALLOW_CREDITOR_DEBTOR,ISNULL(LMP.DPWEF_DT,'''') AS LEDGER_DPWEF_DT
							,ISNULL(LMP.TIN_NO,'''') AS LEDGER_TIN_NO,ISNULL(LMP.TIN_DT,'''') AS LEDGER_TIN_DT,ISNULL(LMP.CST_PERCENTAGE,0) AS LEDGER_CST_PERCENTAGE
							,ISNULL(LMP.PAN_NO,'''') AS LEDGER_PAN_NO,ISNULL(LMP.FORM_ID,''0000000'') AS LEDGER_FORM_ID
							,ISNULL(LMP.INV_RATE_TYPE,0) AS LEDGER_INV_RATE_TYPE,ISNULL(LMP.CUSTOMER_CODE,''000000000000'') AS LEDGER_CUSTOMER_CODE
							,ISNULL(LMP.GLN_NO,'''') AS LEDGER_GLN_NO,ISNULL(LMP.PUR_CAL_METHOD,0) AS LEDGER_PUR_CAL_METHOD
							,ISNULL(LMP.RESTRICT_PUR_ENTRY,0) AS LEDGER_RESTRICT_PUR_ENTRY,LA.AREA_NAME AS LEDGER_AREA_NAME,LA.PINCODE AS LEDGER_PINCODE
							,LC.CITY AS LEDGER_CITY,LC.DISTT_CODE AS LEDGER_DISTT_CODE,LS.STATE AS LEDGER_STATE,LS.OCTROI_PERCENTAGE AS LEDGER_OCTROI_PERCENTAGE,LR.REGION_NAME AS LEDGER_REGION_NAME,PMST.*'
		SET @STEP=70
		SET @DCOLUMNS_APR=N' ''APR'' AS XN_TYPE,CMM.MEMO_NO AS XN_NO,CMM.MEMO_DT AS XN_DT,CMM.MODE AS XN_MODE
							,0 AS SUBTOTAL,'''' AS DT_CODE,0 AS MST_DISCOUNT_PERCENTAGE
							,0 AS MST_DISCOUNT_AMOUNT,0 AS NET_AMOUNT,CMM.CUSTOMER_CODE,CMM.CANCELLED,CMM.USER_CODE,CMM.LAST_UPDATE,0 AS EXEMPTED,'''' AS COMPUTER_NAME
							,0 AS SENT_TO_HO,'''' AS XN_TIME,CMM.MEMO_ID AS XN_ID,'''' AS REF_XN_ID,CMM.FIN_YEAR,0 AS ATD_CHARGES,0 AS COPIES_PTD,0 AS ROUND_OFF,1 AS MEMO_TYPE,0 AS PAY_MODE,0 AS SMS_SENT
							,0 AS AUTOENTRY,0 AS CASH_TENDERED,0 AS PAYBACK,'''' AS ECOUPON_ID,'''' AS CAMPAIGN_GC_OTP,0 AS SALESSETUPINEFFECT
							,''0000000'' AS EDT_USER_CODE,0 AS GV_AMOUNT,'''' AS REF_NO,0 AS SENT_FOR_GR,CMM.REMARKS AS MST_REMARKS,CMM.SENT_FOR_RECON
							,0 AS PARTY_TYPE,CMM.AC_CODE,0 AS MST_MANUAL_DISCOUNT,0 AS FC_RATE,0 AS MANUAL_ROUNDOFF
							,0 AS POSTEDINAC,APD.PRODUCT_CODE,CMD.QUANTITY,APD.MRP,APD.NET,APD.DISCOUNT_PERCENTAGE AS DET_DISCOUNT_PERCENTAGE
							,APD.DISCOUNT_AMOUNT AS DET_DISCOUNT_AMOUNT,CMD.ROW_ID,0 AS TAX_PERCENTAGE,0 AS TAX_AMOUNT,CMD.EMP_CODE,'''' AS SLSDET_ROW_ID
							,CMM.DEPT_ID,0 AS OLD_MRP,'''' AS REF_SLS_MEMO_ID,0 AS REALIZE_SALE,APD.RFNET,0 AS TAX_TYPE,0 AS TAX_METHOD
							,'''' AS EAN,''0000000'' AS EMP_CODE1,''0000000'' AS EMP_CODE2,'''' AS ITEM_DESC,0 AS WEIGHTED_AVG_DISC_PCT,0 AS WEIGHTED_AVG_DISC_AMT
							,0 AS DET_MANUAL_DISCOUNT,0 AS FIX_MRP,0 AS SR_NO,0 AS HOLD_FOR_ALTER,'''' AS PACK_SLIP_ID,'''' AS DET_XN_TYPE
							,SKU.PARA2_CODE,SKU.PURCHASE_PRICE,SKU.PARA3_CODE,SKU.INV_DT,SKU.INV_NO,SKU.AC_CODE AS SUPPLIER_CODE,SKU.RECEIPT_DT
							,SKU.PARA4_CODE,SKU.PARA5_CODE,SKU.PARA6_CODE,SKU.FORM_ID,SKU.MRP AS SKU_MRP,SKU.DT_CREATED,SKU.WS_PRICE
							,SKU.IMAGE_NAME,SKU.TAX_AMOUNT AS SKU_TAX_AMOUNT,SKU.CHALLAN_NO,SKU.FIX_MRP AS SKU_FIX_MRP,SKU.PRODUCT_NAME
							,SKU.ARTICLE_CODE,SKU.PARA1_CODE,SKU.ER_FLAG,1 AS BILL_LEVEL_TAX_METHOD,SKU.UPLOADED_TO_ACTIVSTREAM,SKU.BARCODE_CODING_SCHEME
							,SKU.EMP_CODE AS SKU_EMP_CODE,ART.FIX_MRP AS ARTICLE_FIX_MRP,ART.ENABLE_FIXWT_ENTRY
							,ART.FIX_WEIGHT,ART.EXP_AMOUNT,ART.SUPP_SPECIFIC,ART.SUPP_AC_CODE,ART.SUPP_ITEM_CODE
							,ART.REMARKS AS ARTICLE_REMARKS,ART.FIX_PRICE_ARTICLE,ART.GROSS_PURCHASE_PRICE
							,ART.DISCOUNT_PERCENTAGE,ART.DISCOUNT_AMOUNT,ART.GEN_EAN_CODES,ART.CODING_SCHEME
							,ART.LAST_UPDATE AS ARTICLE_LAST_UPDATE,ART.UOM_CODE,ART.ALIAS,ART.MP_PERCENTAGE
							,ART.PURCHASE_PRICE AS ARTICLE_PURCHASE_PRICE,ART.MRP AS ART_MRP,ART.PARA1_SET
							,ART.PARA2_SET,ART.INACTIVE,ART.SKU_CODE,ART.DT_CREATED AS ARTICLE_DT_CREATED
							,ART.USER_CODE AS ARTICLE_USER_CODE,ART.EDT_USER_CODE AS ARTICLE_EDT_USER_CODE
							,ART.ARTICLE_NO,ART.ARTICLE_NAME,ART.ARTICLE_DESC,ART.SUB_SECTION_CODE,ART.DISCON
							,ART.WHOLESALE_PRICE,ART.WSP_PERCENTAGE,ART.MIN_PRICE,ART.STOCK_NA,ART.ARTICLE_TYPE
							,ART.CREATED_ON,ART.ARTICLE_GROUP_CODE,ART.COMPANY_CODE,ART.GENERATE_BARCODES_WITHARTICLE_PREFIX
							,ART.ARTICLE_GEN_MODE,ART.ARTICLE_PRD_MODE,ART.ARTICLE_SET_CODE,ART.OH_PERCENTAGE,ART.OH_AMOUNT
							,ART.SIZE_CENTER_POINT,ART.SIZE_RATE_DIFF,SD.SUB_SECTION_NAME,SD.LAST_UPDATE AS SUB_SECTION_LAST_UPDATE
							,SD.ALIAS AS SUB_SECTION_ALIAS,SD.INACTIVE AS SUB_INACTIVE,SD.MFG_CATEGORY,SD.SECTION_CODE,SD.REMARKS AS SUB_SECTION_REMARKS,SM.LAST_UPDATE AS SECTION_LAST_UPDATE
							,SM.ALIAS AS SECTION_ALIAS,SM.INACTIVE AS SECTION_INACTIVE,SM.REMARKS AS SECTION_REMARKS,UOM.UOM_TYPE 
							,UOM.INACTIVE AS UOM_INACTIVE,UOM.UOM_NAME,UOM.LAST_UPDATE AS UOM_LAST_UPDATE,P1.PARA1_NAME
							,P1.LAST_UPDATE AS PARA1_LAST_UPDATE,P1.ALIAS AS PARA1_ALIAS,P1.INACTIVE AS PARA1_INACTIVE,P1.PARA1_ORDER
							,P1.REMARKS AS PARA1_REMARKS,P2.LAST_UPDATE AS PARA2_LAST_UPDATE,P2.ALIAS AS PARA2_ALIAS,P2.INACTIVE AS PARA2_INACTIVE
							,P2.PARA2_ORDER AS PARA2_PARA2_ORDER,P2.PARA2_NAME,P2.REMARKS AS PARA2_REMARKS,P3.INACTIVE AS PARA3_INACTIVE
							,P3.DT_CREATED AS PARA3_DT_CREATED,P3.REMARKS AS PARA3_REMARKS,P3.PARA3_NAME,P3.LAST_UPDATE AS PARA3_LAST_UPDATE
							,P3.ALIAS AS PARA3_ALIAS,P4.PARA4_NAME,P4.LAST_UPDATE AS PARA4_LAST_UPDATE,P4.ALIAS AS PARA4_ALIAS
							,P4.INACTIVE AS PARA4_INACTIVE,P4.REMARKS AS PARA4_REMARKS,P5.ALIAS AS PARA5_ALIAS,P5.INACTIVE AS PARA5_INACTIVE
							,P5.PARA5_NAME,P5.LAST_UPDATE AS PARA5_LAST_UPDATE,P5.REMARKS AS PARA5_REMARKS,P6.PARA6_NAME
							,P6.LAST_UPDATE AS PARA6_LAST_UPDATE,P6.ALIAS AS PARA6_ALIAS,P6.INACTIVE AS PARA6_INACTIVE,P6.REMARKS AS PARA6_REMARKS,FORM.POST_TAX_SEPARATELY
							,FORM.PUR_RETURN_AC_CODE,FORM.SALE_RETURN_AC_CODE,FORM.PHYSICAL_FORM,FORM.SERIES,FORM.EXCISE_ACCESSIBLE_PERCENTAGE
							,FORM.EXCISE_DUTY_PERCENTAGE,FORM.EXCISE_EDU_CESS_PERCENTAGE,FORM.EXCISE_HEDU_CESS_PERCENTAGE,FORM.EXCISE_EDU_CESS_AC_CODE
							,FORM.EXCISE_HEDU_CESS_AC_CODE,FORM.EXCISE_DUTY_AC_CODE,FORM.INACTIVE AS FORM_INACTIVE,FORM.FORM_NAME,FORM.PURCHASE_AC_CODE
							,FORM.SALE_AC_CODE,FORM.TAX_AC_CODE,FORM.TAX_PERCENTAGE AS FORM_TAX_PERCENTAGE,FORM.LAST_UPDATE AS FORM_LAST_UPDATE,EMP.EMP_HEAD 
							,EMP.LAST_UPDATE AS EMPLOYEE_LAST_UPDATE,EMP.INACTIVE AS EMPLOYEE_INACTIVE,EMP.EMP_NAME,EMP.EMP_ALIAS,EMP.EMP_TYPE,''0000000'' AS EMPLOYEE1_EMP_HEAD
							,'''' AS EMPLOYEE1_LAST_UPDATE,0 AS EMPLOYEE1_INACTIVE,'''' AS EMPLOYEE1_EMP_NAME,'''' AS EMPLOYEE1_EMP_ALIAS
							,0 AS EMPLOYEE1_EMP_TYPE,''0000000'' AS EMPLOYEE2_EMP_HEAD,'''' AS EMPLOYEE2_LAST_UPDATE
							,0 AS EMPLOYEE2_INACTIVE,'''' AS EMPLOYEE2_EMP_NAME,'''' AS EMPLOYEE2_EMP_ALIAS,0 AS EMPLOYEE2_EMP_TYPE
							,CM.DT_CREATED AS CUSTOMER_DT_CREATED,CM.PIN AS CUSTOMER_PIN,CM.DT_ANNIVERSARY AS CUSTOMER_DT_ANNIVERSARY,CM.SENT_TO_HO AS CUSTOMER_SENT_TO_HO
							,CM.INACTIVE AS CUSTOMER_INACTIVE,CM.AREA_CODE AS CUSTOMER_AREA_CODE,CM.LOCATION_ID AS CUSTOMER_LOCATION_ID,CM.ADDRESS0 AS CUSTOMER_ADDRESS0
							,CM.WIZCLIP_LAST_UPDATE AS CUSTOMER_WIZCLIP_LAST_UPDATE,CM.MANAGER_CARD AS CUSTOMER_MANAGER_CARD,CM.ADDRESS9 AS CUSTOMER_ADDRESS9,CM.CUSTOMER_CODE AS CUSTOMER_CUSTOMER_CODE
							,CM.USER_CUSTOMER_CODE AS CUSTOMER_USER_CUSTOMER_CODE,CM.CUSTOMER_TITLE AS CUSTOMER_CUSTOMER_TITLE,CM.CUSTOMER_FNAME AS CUSTOMER_FNAME,CM.CUSTOMER_LNAME AS CUSTOMER_LNAME
							,CM.ADDRESS1 AS CUSTOMER_ADDRESS1,CM.ADDRESS2 AS CUSTOMER_ADDRESS2,CM.PHONE1 AS CUSTOMER_PHONE1,CM.PHONE2 AS CUSTOMER_PHONE2
							,CM.MOBILE AS CUSTOMER_MOBILE,CM.EMAIL AS CUSTOMER_EMAIL,CM.OPENING_BALANCE AS CUSTOMER_OPENING_BALANCE,CM.LAST_UPDATE AS CUSTOMER_LAST_UPDATE
							,CM.DT_BIRTH AS CUSTOMER_DT_BIRTH,CM.REF_CUSTOMER_CODE AS CUSTOMER_REF_CUSTOMER_CODE,CM.PREFIX_CODE AS CUSTOMER_PREFIX_CODE,CM.FLAT_DISC_CUSTOMER AS CUSTOMER_FLAT_DISC_CUSTOMER
							,CM.FLAT_DISC_PERCENTAGE AS CUSTOMER_FLAT_DISC_PERCENTAGE,CM.PRIVILEGE_CUSTOMER AS CUSTOMER_PRIVILEGE_CUSTOMER,CM.DT_CARD_ISSUE AS CUSTOMER_DT_CARD_ISSUE
							,CM.DT_CARD_EXPIRY AS CUSTOMER_DT_CARD_EXPIRY,CM.CARD_NO AS CUSTOMER_CARD_NO,CM.CARD_NAME AS CUSTOMER_CARD_NAME,CM.FLAT_DISC_PERCENTAGE_DURING_SALES AS CUSTOMER_FLAT_DISC_PERCENTAGE_DURING_SALES
							,CM.AC_CODE AS CUSTOMER_AC_CODE,CA.AREA_NAME AS CUSTOMER_AREA_NAME
							,CA.PINCODE AS CUSTOMER_PINCODE,CC.CITY AS CUSTOMER_CITY,CC.DISTT_CODE AS CUSTOMER_DISTT_CODE
							,CS.STATE AS CUSTOMER_STATE,CS.OCTROI_PERCENTAGE AS CUSTOMER_OCTROI_PERCENTAGE
							,CR.REGION_NAME AS CUSTOMER_REGION_NAME,LM.UPLOADED_TO_ACTIVSTREAM AS LEDGER_UPLOADED_TO_ACTIVSTREAM
							,LM.USER_CODE AS LEDGER_USER_CODE,LM.EDT_USER_CODE AS LEDGER_EDT_USER_CODE,LM.LAST_UPDATE AS LEDGER_LAST_UPDATE
							,LM.OPENING_BALANCE AS LEDGER_OPENING_BALANCE,LM.OPENING_BALANCE_CR_DR AS LEDGER_OPENING_BALANCE_CR_DR
							,LM.TDS_CODE AS LEDGER_TDS_CODE,LM.INACTIVE AS LEDGER_INACTIVE,LM.AC_NAME AS LEDGER_AC_NAME
							,LM.ALIAS AS LEDGER_ALIAS,LM.HEAD_CODE AS LEDGER_HEAD_CODE,LM.CLOSING_BALANCE AS LEDGER_CLOSING_BALANCE
							,LM.CLOSING_BALANCE_CR_DR AS LEDGER_CLOSING_BALANCE_CR_DR,LM.PRINT_LEDGER AS LEDGER_PRINT_LEDGER,LM.ALIAS_TO_BE_SUFFIXED AS LEDGER_ALIAS_TO_BE_SUFFIXED
							,ISNULL(LMP.MP_PERCENTAGE,0) AS LEDGER_MP_PERCENTAGE,ISNULL(LMP.MRP_CALC_MODE,0) AS LEDGER_MRP_CALC_MODE,ISNULL(LMP.PRINT_NAME,'''') AS LEDGER_PRINT_NAME
							,ISNULL(LMP.ADDRESS0,'''') AS LEDGER_ADDRESS0,ISNULL(LMP.ADDRESS1,'''') AS LEDGER_ADDRESS1,ISNULL(LMP.SALES_AC_CODE,''0000000000'') AS LEDGER_SALES_AC_CODE
							,ISNULL(LMP.DEFAULT_RATE_TYPE,0) AS LEDGER_DEFAULT_RATE_TYPE,ISNULL(LMP.ADDRESS2,'''') AS LEDGER_ADDRESS2,ISNULL(LMP.CST_NO,'''') AS LEDGER_CST_NO
							,ISNULL(LMP.CST_DT,'''') AS LEDGER_CST_DT,ISNULL(LMP.SST_NO,'''') AS LEDGER_SST_NO,ISNULL(LMP.SST_DT,'''') AS LEDGER_SST_DT,ISNULL(LMP.PHONES_R,'''') AS LEDGER_PHONES_R
							,ISNULL(LMP.PHONES_O,'''') AS LEDGER_PHONES_O,ISNULL(LMP.PHONES_FAX,'''') AS LEDGER_PHONES_FAX,ISNULL(LMP.MOBILE,'''') AS LEDGER_MOBILE
							,ISNULL(LMP.E_MAIL,'''') AS LEDGER_E_MAIL,ISNULL(LMP.TAX_CODE,'''') AS LEDGER_TAX_CODE,ISNULL(LMP.CREDIT_DAYS,0) AS LEDGER_CREDIT_DAYS
							,ISNULL(LMP.DISCOUNT_PERCENTAGE,0) AS LEDGER_DISCOUNT_PERCENTAGE,ISNULL(LMP.BILL_BY_BILL,0) AS LEDGER_BILL_BY_BILL,ISNULL(LMP.ON_HOLD,0) AS LEDGER_ON_HOLD
							,ISNULL(LMP.THROUGH_BROKER,0) AS LEDGER_THROUGH_BROKER,ISNULL(LMP.BROKER_AC_CODE,''0000000000'') AS LEDGER_BROKER_AC_CODE
							,ISNULL(LMP.BROKER_COMM_PERCENT,0) AS LEDGER_BROKER_COMM_PERCENT,ISNULL(LMP.CREDIT_LIMIT,0) AS LEDGER_CREDIT_LIMIT,ISNULL(LMP.OUTSTATION_PARTY,0) AS LEDGER_OUTSTATION_PARTY
							,ISNULL(LMP.ALLOW_CREDITOR_DEBTOR,0) AS LEDGER_ALLOW_CREDITOR_DEBTOR,ISNULL(LMP.DPWEF_DT,'''') AS LEDGER_DPWEF_DT
							,ISNULL(LMP.TIN_NO,'''') AS LEDGER_TIN_NO,ISNULL(LMP.TIN_DT,'''') AS LEDGER_TIN_DT,ISNULL(LMP.CST_PERCENTAGE,0) AS LEDGER_CST_PERCENTAGE
							,ISNULL(LMP.PAN_NO,'''') AS LEDGER_PAN_NO,ISNULL(LMP.FORM_ID,''0000000'') AS LEDGER_FORM_ID
							,ISNULL(LMP.INV_RATE_TYPE,0) AS LEDGER_INV_RATE_TYPE,ISNULL(LMP.CUSTOMER_CODE,''000000000000'') AS LEDGER_CUSTOMER_CODE
							,ISNULL(LMP.GLN_NO,'''') AS LEDGER_GLN_NO,ISNULL(LMP.PUR_CAL_METHOD,0) AS LEDGER_PUR_CAL_METHOD
							,ISNULL(LMP.RESTRICT_PUR_ENTRY,0) AS LEDGER_RESTRICT_PUR_ENTRY,LA.AREA_NAME AS LEDGER_AREA_NAME,LA.PINCODE AS LEDGER_PINCODE
							,LC.CITY AS LEDGER_CITY,LC.DISTT_CODE AS LEDGER_DISTT_CODE,LS.STATE AS LEDGER_STATE,LS.OCTROI_PERCENTAGE AS LEDGER_OCTROI_PERCENTAGE,LR.REGION_NAME AS LEDGER_REGION_NAME,PMST.*'
		SET @STEP=80
		SET @DTABLES_SLS=' CMM01106 CMM (NOLOCK) JOIN CMD01106 CMD(NOLOCK) ON CMM.CM_ID=CMD.CM_ID
							LEFT JOIN CTEPAYMODES PMST(NOLOCK) ON CMM.CM_ID=PMST.PAY_ID
							JOIN SKU (NOLOCK) ON CMD.PRODUCT_CODE=SKU.PRODUCT_CODE
							JOIN ARTICLE ART (NOLOCK) ON SKU.ARTICLE_CODE=ART.ARTICLE_CODE
							JOIN SECTIOND SD (NOLOCK) ON ART.SUB_SECTION_CODE=SD.SUB_SECTION_CODE
							JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE=SM.SECTION_CODE
							JOIN UOM (NOLOCK) ON ART.UOM_CODE=UOM.UOM_CODE
							JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE=P1.PARA1_CODE
							JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE=P2.PARA2_CODE
							JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE=P3.PARA3_CODE
							JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE=P4.PARA4_CODE
							JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE=P5.PARA5_CODE
							JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE=P6.PARA6_CODE
							JOIN FORM (NOLOCK) ON SKU.FORM_ID=FORM.FORM_ID
							JOIN EMPLOYEE EMP  (NOLOCK) ON EMP.EMP_CODE=CMD.EMP_CODE
							LEFT JOIN EMPLOYEE EMP1 (NOLOCK) ON EMP1.EMP_CODE=CMD.EMP_CODE1
							LEFT JOIN EMPLOYEE EMP2 (NOLOCK) ON EMP2.EMP_CODE=CMD.EMP_CODE2
							JOIN CUSTDYM CM (NOLOCK) ON CMM.CUSTOMER_CODE=CM.CUSTOMER_CODE   
							JOIN AREA CA (NOLOCK) ON CA.AREA_CODE = CM.AREA_CODE   
							JOIN CITY CC (NOLOCK) ON CA.CITY_CODE = CC.CITY_CODE   
							JOIN STATE CS (NOLOCK) ON CS.STATE_CODE = CC.STATE_CODE  
							JOIN REGIONM CR (NOLOCK) ON CR.REGION_CODE = CS.REGION_CODE 
							JOIN LM01106 LM (NOLOCK) ON CMM.AC_CODE=LM.AC_CODE
							LEFT OUTER JOIN LMP01106 LMP ON LM.AC_CODE=LMP.AC_CODE
							JOIN AREA LA ON LMP.AREA_CODE = LA.AREA_CODE   
							JOIN CITY LC ON LC.CITY_CODE = LA.CITY_CODE   
							JOIN STATE LS ON LS.STATE_CODE = LC.STATE_CODE  
							JOIN REGIONM LR ON LR.REGION_CODE = LS.REGION_CODE
							WHERE CMM.CANCELLED=0'
		SET @STEP=90
		SET @DTABLES_APP=' APM01106 CMM (NOLOCK) JOIN APD01106 CMD(NOLOCK) ON CMM.MEMO_ID=CMD.MEMO_ID
							LEFT JOIN 
							(
								SELECT TOP 1 * FROM	CTEPAYMODES PMST(NOLOCK) 
							)PMST ON CMM.MEMO_ID=PMST.PAY_ID
							JOIN SKU (NOLOCK) ON CMD.PRODUCT_CODE=SKU.PRODUCT_CODE
							JOIN ARTICLE ART (NOLOCK) ON SKU.ARTICLE_CODE=ART.ARTICLE_CODE
							JOIN SECTIOND SD (NOLOCK) ON ART.SUB_SECTION_CODE=SD.SUB_SECTION_CODE
							JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE=SM.SECTION_CODE
							JOIN UOM (NOLOCK) ON ART.UOM_CODE=UOM.UOM_CODE
							JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE=P1.PARA1_CODE
							JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE=P2.PARA2_CODE
							JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE=P3.PARA3_CODE
							JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE=P4.PARA4_CODE
							JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE=P5.PARA5_CODE
							JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE=P6.PARA6_CODE
							JOIN FORM (NOLOCK) ON SKU.FORM_ID=FORM.FORM_ID
							JOIN EMPLOYEE EMP  (NOLOCK) ON EMP.EMP_CODE=CMD.EMP_CODE
							LEFT JOIN EMPLOYEE EMP1 (NOLOCK) ON EMP1.EMP_CODE=CMD.EMP_CODE1
							LEFT JOIN EMPLOYEE EMP2 (NOLOCK) ON EMP2.EMP_CODE=CMD.EMP_CODE2
							JOIN CUSTDYM CM (NOLOCK) ON CMM.CUSTOMER_CODE=CM.CUSTOMER_CODE   
							JOIN AREA CA (NOLOCK) ON CA.AREA_CODE = CM.AREA_CODE   
							JOIN CITY CC (NOLOCK) ON CA.CITY_CODE = CC.CITY_CODE   
							JOIN STATE CS (NOLOCK) ON CS.STATE_CODE = CC.STATE_CODE  
							JOIN REGIONM CR (NOLOCK) ON CR.REGION_CODE = CS.REGION_CODE 
							JOIN LM01106 LM (NOLOCK) ON CMM.AC_CODE=LM.AC_CODE
							LEFT OUTER JOIN LMP01106 LMP ON LM.AC_CODE=LMP.AC_CODE
							JOIN AREA LA ON LMP.AREA_CODE = LA.AREA_CODE   
							JOIN CITY LC ON LC.CITY_CODE = LA.CITY_CODE   
							JOIN STATE LS ON LS.STATE_CODE = LC.STATE_CODE  
							JOIN REGIONM LR ON LR.REGION_CODE = LS.REGION_CODE
							WHERE CMM.CANCELLED=0'
		SET @STEP=100
		SET @DTABLES_APR=' APPROVAL_RETURN_MST CMM (NOLOCK) 
							 JOIN APPROVAL_RETURN_DET CMD (NOLOCK) ON CMM.MEMO_ID=CMD.MEMO_ID
							 JOIN APD01106 APD (NOLOCK) ON  CMD.APD_ROW_ID=APD.ROW_ID
							 JOIN APM01106 APM(NOLOCK) ON APD.MEMO_ID=APM.MEMO_ID
							LEFT JOIN 
							(
								SELECT TOP 1 * FROM	CTEPAYMODES PMST(NOLOCK) 
							)PMST ON CMM.MEMO_ID=PMST.PAY_ID
							JOIN SKU (NOLOCK) ON APD.PRODUCT_CODE=SKU.PRODUCT_CODE
							JOIN ARTICLE ART (NOLOCK) ON SKU.ARTICLE_CODE=ART.ARTICLE_CODE
							JOIN SECTIOND SD (NOLOCK) ON ART.SUB_SECTION_CODE=SD.SUB_SECTION_CODE
							JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE=SM.SECTION_CODE
							JOIN UOM (NOLOCK) ON ART.UOM_CODE=UOM.UOM_CODE
							JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE=P1.PARA1_CODE
							JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE=P2.PARA2_CODE
							JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE=P3.PARA3_CODE
							JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE=P4.PARA4_CODE
							JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE=P5.PARA5_CODE
							JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE=P6.PARA6_CODE
							JOIN FORM (NOLOCK) ON SKU.FORM_ID=FORM.FORM_ID
							JOIN EMPLOYEE EMP  (NOLOCK) ON EMP.EMP_CODE=CMD.EMP_CODE
							JOIN CUSTDYM CM (NOLOCK) ON CMM.CUSTOMER_CODE=CM.CUSTOMER_CODE   
							JOIN AREA CA (NOLOCK) ON CA.AREA_CODE = CM.AREA_CODE   
							JOIN CITY CC (NOLOCK) ON CA.CITY_CODE = CC.CITY_CODE   
							JOIN STATE CS (NOLOCK) ON CS.STATE_CODE = CC.STATE_CODE  
							JOIN REGIONM CR (NOLOCK) ON CR.REGION_CODE = CS.REGION_CODE 
							JOIN LM01106 LM (NOLOCK) ON CMM.AC_CODE=LM.AC_CODE
							LEFT OUTER JOIN LMP01106 LMP ON LM.AC_CODE=LMP.AC_CODE
							JOIN AREA LA ON LMP.AREA_CODE = LA.AREA_CODE   
							JOIN CITY LC ON LC.CITY_CODE = LA.CITY_CODE   
							JOIN STATE LS ON LS.STATE_CODE = LC.STATE_CODE  
							JOIN REGIONM LR ON LR.REGION_CODE = LS.REGION_CODE
							WHERE CMM.CANCELLED=0'
		SET @STEP=110
		SET @DSQL=N'IF OBJECT_ID('''+@CTARGETDBNAME+'.DBO.SALEANALYSIS_OPT'',''U'') IS NOT NULL
						DROP TABLE '+@CTARGETDBNAME+'.DBO.SALEANALYSIS_OPT 
					;WITH CTEPAYMODES AS
						(
						SELECT PDET.MEMO_ID AS PAY_ID'+@CROSSTABPAYS+'
						FROM PAYMODE_XN_DET PDET
						JOIN PAYMODE_MST PMST ON PDET.PAYMODE_CODE=PMST.PAYMODE_CODE
						WHERE PDET.XN_TYPE=''SLS''
						GROUP BY PDET.MEMO_ID
						)
						SELECT '+@DCOLUMNS_SLS+'  
						INTO '+@CTARGETDBNAME+'.DBO.SALEANALYSIS_OPT 
						FROM '+@DTABLES_SLS+' 
						UNION ALL
						SELECT '+@DCOLUMNS_APP+' FROM '+@DTABLES_APP+' 
						UNION ALL
						SELECT '+@DCOLUMNS_APR+' FROM '+@DTABLES_APR
		--PRINT @DSQL			
		EXEC SP_EXECUTESQL @DSQL			
		
		SET @STEP=120
		SET @DSQL=N'CREATE INDEX IXSA_XNDET ON '+@CTARGETDBNAME+'.DBO.SALEANALYSIS_OPT (XN_TYPE,XN_NO,XN_DT)'	
		--PRINT @CCMD
		EXEC SP_EXECUTESQL @DSQL
		
		SET @STEP=130
		SET @DSQL=N'CREATE INDEX IXSA_ARTICLE ON '+@CTARGETDBNAME+'.DBO.SALEANALYSIS_OPT (ARTICLE_NO)'	
		--PRINT @CCMD
		EXEC SP_EXECUTESQL @DSQL
		
		SET @STEP=140
		SET @DSQL=N'CREATE INDEX IXSA_SUB_SECTION ON '+@CTARGETDBNAME+'.DBO.SALEANALYSIS_OPT (SUB_SECTION_NAME)'	
		--PRINT @CCMD
		EXEC SP_EXECUTESQL @DSQL
		
		SET @STEP=140
		SET @DSQL=N'CREATE INDEX IXSA_PARA4 ON '+@CTARGETDBNAME+'.DBO.SALEANALYSIS_OPT (PARA4_NAME)'	
		--PRINT @CCMD
		EXEC SP_EXECUTESQL @DSQL
		
		SET @STEP=150
		SET @DSQL=N'CREATE INDEX IXSA_CUSTOMER ON '+@CTARGETDBNAME+'.DBO.SALEANALYSIS_OPT (CUSTOMER_FNAME,CUSTOMER_LNAME)'	
		--PRINT @CCMD
		EXEC SP_EXECUTESQL @DSQL
		
		SET @STEP=160
		SET @DSQL=N'CREATE INDEX IXSA_LEDGER ON '+@CTARGETDBNAME+'.DBO.SALEANALYSIS_OPT (LEDGER_AC_NAME)'	
		--PRINT @CCMD
		EXEC SP_EXECUTESQL @DSQL
			
		END	
END TRY
BEGIN CATCH
	SET @ERROR='PROCEDURE - SP3S_VW_SALEANALYSIS, ERROR AT STEP'+@STEP+' : '+ERROR_MESSAGE()
END CATCH
END
---END OF PROCEDURE - SP3S_VW_SALEANALYSIS
