CREATE PROCEDURE PRGEN_DEFINE_WEEKS(@YEAR INT)
AS
BEGIN
SET NOCOUNT ON
DECLARE @WEEKS INT=2
,@FROM_CY DATE,@TILL_CY DATE
,@FROM_LY DATE,@TILL_LY DATE

IF OBJECT_ID('tempdb..#WEEKS') IS NOT NULL DROP TABLE #WEEKS
CREATE TABLE #WEEKS(FROM_CY DATE,TILL_CY DATE,FROM_LY DATE,TILL_LY DATE,WK INT)
SELECT @FROM_CY=CONVERT(VARCHAR,@YEAR)+'-01-01',@TILL_CY=CONVERT(VARCHAR,@YEAR)+'-01-07'
SELECT @FROM_LY=DATEADD(YY,-1,@FROM_CY),@TILL_LY=DATEADD(YY,-1,@TILL_CY)
--CONSIDER 1-7 AS FIRST WEEK AND SO ON INSTEAD 1 TO FIRST SUN THEN MON TO SUN
--SELECT @TILL_CY=DBO.GET_WEEK_START_END(@TILL_CY,'E'),@TILL_LY=DBO.GET_WEEK_START_END(@TILL_LY,'E')

INSERT #WEEKS(FROM_CY,TILL_CY,FROM_LY,TILL_LY,WK) SELECT @FROM_CY,@TILL_CY,@FROM_LY,@TILL_LY,1
SET @FROM_CY=DATEADD(DD,1,@TILL_CY)
SET @TILL_CY=DATEADD(DD,6,@FROM_CY)
SET @FROM_LY=DATEADD(DD,1,@TILL_LY)
SET @TILL_LY=DATEADD(DD,6,@FROM_LY)
WHILE 1=1
BEGIN
  IF YEAR(@TILL_CY)>@YEAR
     SET @TILL_CY=CONVERT(VARCHAR,@YEAR)+'-12-31'
  IF YEAR(@TILL_LY)>@YEAR-1
     SET @TILL_LY=CONVERT(VARCHAR,@YEAR-1)+'-12-31'
  INSERT #WEEKS(FROM_CY,TILL_CY,FROM_LY,TILL_LY,WK) SELECT @FROM_CY,@TILL_CY,@FROM_LY,@TILL_LY,@WEEKS
  SELECT @WEEKS+=1,@FROM_CY=DATEADD(DD,7,@FROM_CY),@TILL_CY=DATEADD(DD,7,@TILL_CY),@FROM_LY=DATEADD(DD,7,@FROM_LY),@TILL_LY=DATEADD(DD,7,@TILL_LY)
  IF YEAR(@FROM_CY)>@YEAR
     BREAK
END
SELECT * FROM #WEEKS
SET NOCOUNT OFF
END