CREATE PROCEDURE SP_CHECKSTOCK_CONS   
@cUserCode VARCHAR(10)='',
@cLocID		VARCHAR(5)='',
@cBINID		VARCHAR(10)='',
 @CPRODUCTCODE VARCHAR(50)=''

---- WITH ENCRYPTION
AS    
BEGIN           
    SELECT GV.PRODUCT_CODE,GV.ARTICLE_NO,gv.article_name ,ISNULL(PMT.QUANTITY_IN_STOCK,0) as QUANTITY_IN_STOCK  ,ISNULL(gv.boxWeight,0) AS boxWeight
	,gv.stock_na
	FROM  sku_names GV(NOLOCK) 
	LEFT OUTER JOIN PMT01106 PMT (NOLOCK) ON GV.PRODUCT_CODE=PMT.PRODUCT_CODE AND PMT.DEPT_ID=@cLocID
	WHERE gv.sku_item_type=2 AND (ISNULL(PMT.QUANTITY_IN_STOCK,0)>0  OR gv.stock_na=1)
	ORDER BY GV.product_Code
	 
	/*
	AND PMT.BIN_ID=@cBINID

	Rohit 23-01-2024 15:39
	Raised by: Sonu
	Ticket ID: 0124-00085
	Subject: Damilano- Consumable out from any BIN
	Remarks: Consumable ke case me Other Bin se billing agar ho rahi hai then Consumable stock out hona chahiyie as discussed with Sir
	Raised at: 2024-01-23T15:23:34.983000
	*/
	--ORDER BY PMT.product_code


	--;WITH BASE_BARCODE
	--AS
	--(
	--SELECT (CASE WHEN CHARINDEX('@',PMT.PRODUCT_CODE)=0 THEN PMT.PRODUCT_CODE ELSE SUBSTRING (PMT.PRODUCT_CODE,1, CHARINDEX('@',PMT.PRODUCT_CODE)-1) END) AS PRODUCT_CODE,
	--C.ARTICLE_NO,PMT.QUANTITY_IN_STOCK  ,C.article_name 
	--FROM PMT01106 PMT (NOLOCK) 
	--JOIN SKU GV (NOLOCK) ON GV.PRODUCT_CODE=PMT.PRODUCT_CODE
	--JOIN ARTICLE C (NOLOCK) ON C.ARTICLE_CODE=GV.ARTICLE_CODE
	--JOIN SECTIOND D (NOLOCK) ON D.SUB_SECTION_CODE=C.SUB_SECTION_CODE
	--JOIN SECTIONM M (NOLOCK) ON M.SECTION_CODE=D.SECTION_CODE
	--WHERE M.ITEM_TYPE=2 AND PMT.QUANTITY_IN_STOCK>0 --AND  GV.PRODUCT_CODE LIKE @CPRODUCTCODE
	----AND CHARINDEX('@',GV.product_code)=0
	--AND PMT.DEPT_ID=@cLocID AND PMT.BIN_ID=@cBINID
	--)
	--SELECT PRODUCT_CODE,article_no,article_name ,SUM(QUANTITY_IN_STOCK) AS QUANTITY_IN_STOCK
	--FROM BASE_BARCODE
	--GROUP BY PRODUCT_CODE,article_no,article_name
	--HAVING SUM(QUANTITY_IN_STOCK)>0
	--ORDER BY product_code
END
