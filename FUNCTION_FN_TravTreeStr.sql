CREATE FUNCTION FN_TRAVTREESTR ( @CUSERCODE VARCHAR(20) )
RETURNS VARCHAR(2000)
--WITH ENCRYPTION 
AS 
BEGIN
	DECLARE @CRETVAL VARCHAR(2000), 
			@CTEMPUSERCODE VARCHAR(10)
	
	SET @CRETVAL = ''

	DECLARE ABC CURSOR FOR 
	SELECT USER_CODE FROM USERS WHERE MAJOR_USER_CODE = @CUSERCODE AND USER_CODE <> @CUSERCODE

	OPEN ABC
	FETCH NEXT FROM ABC INTO @CTEMPUSERCODE
	WHILE @@FETCH_STATUS = 0
	BEGIN
		SET @CRETVAL = @CRETVAL + ',''' + @CTEMPUSERCODE + ''''
		SET @CRETVAL = @CRETVAL + DBO.FN_TRAVTREESTR( @CTEMPUSERCODE )
	
		FETCH NEXT FROM ABC INTO @CTEMPUSERCODE
	END
	CLOSE ABC
	DEALLOCATE ABC

	RETURN @CRETVAL
END
