CREATE VIEW PMTVIEW_STK
--WITH ENCRYPTION   
AS  
SELECT B.AC_CODE,B.PRODUCT_CODE,      
     ISNULL(A.DEPT_ID,CC.DEPT_ID) AS DEPT_ID,      
     B.ARTICLE_CODE,      
     B.PARA1_CODE,      
     B.PARA2_CODE,      
     B.PARA3_CODE,      
     B.PARA4_CODE,    
     B.PARA5_CODE,    
     B.PARA6_CODE,    
     ISNULL(A.QUANTITY_IN_STOCK,0) AS QUANTITY_IN_STOCK,     
     A.REP_ID
     --,(ISNULL(A.PHYSICAL_QTY,0) + ISNULL(A.EXCESS_QTY,0)) AS SCANNED_QTY,     
     --(CASE WHEN (ISNULL(A.QUANTITY_IN_STOCK,0) - (ISNULL(A.PHYSICAL_QTY,0) + ISNULL(A.EXCESS_QTY,0))) >0     
     --THEN (A.QUANTITY_IN_STOCK - (ISNULL(A.PHYSICAL_QTY,0) + ISNULL(A.EXCESS_QTY,0)))    
     --ELSE 0 END ) AS SHORTAGE_QTY,      
     --ISNULL(A.EXCESS_QTY,0) AS EXCESS_QTY,    
     --(CASE WHEN (ISNULL(A.QUANTITY_IN_STOCK,0) - ISNULL(A.PHYSICAL_QTY,0) ) <0     
     --THEN ABS(ISNULL(A.QUANTITY_IN_STOCK,0) - ISNULL(A.PHYSICAL_QTY,0) )    
     --ELSE 0 END ) AS EXCESS_QTY_REALIZED 
     ,E.UOM_TYPE,    
  C.DT_CREATED AS [ART_DT_CREATED],P3.DT_CREATED AS [PARA3_DT_CREATED],B.DT_CREATED AS [SKU_DT_CREATED],    
  B.MRP, B.PURCHASE_PRICE , B.INV_NO,B.BARCODE_CODING_SCHEME     
FROM SKU B      
LEFT OUTER JOIN PMT01106 A ON A.PRODUCT_CODE = B.PRODUCT_CODE    
JOIN ARTICLE C ON C.ARTICLE_CODE=B.ARTICLE_CODE    
JOIN PARA3 P3 ON P3.PARA3_CODE=B.PARA3_CODE    
JOIN UOM E ON C.UOM_CODE = E.UOM_CODE
LEFT OUTER JOIN 
(SELECT VALUE AS DEPT_ID FROM CONFIG  WHERE CONFIG_OPTION= 'LOCATION_ID') CC ON 1=1
WHERE C.STOCK_NA=0
