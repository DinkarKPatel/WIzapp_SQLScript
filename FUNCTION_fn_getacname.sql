CREATE FUNCTION FN_GETACNAME
(
	@CVMID		VARCHAR(50),
	@CAC_CODE	VARCHAR(50),
	@CXTYPE		VARCHAR(5)
)RETURNS VARCHAR(MAX)
--WITH ENCRYPTION
AS
BEGIN

	DECLARE @CACNAME VARCHAR(MAX),@CACNAME1 VARCHAR(MAX)

	DECLARE @NAMT NUMERIC(14,2)
	SELECT @NAMT=MAX(CASE WHEN @CXTYPE ='CR' THEN DEBIT_AMOUNT ELSE CREDIT_AMOUNT END) FROM VD01106 WHERE VM_ID=@CVMID

	SELECT TOP 1 @CACNAME1 =AC_NAME 
	FROM VD01106 A (NOLOCK)
	--JOIN LM01106 B (NOLOCK) ON B.AC_CODE=A.COST_CENTER_AC_CODE
	JOIN LM01106 B (NOLOCK) ON B.AC_CODE=A.AC_CODE
	WHERE  A.VM_ID= @CVMID AND X_TYPE<> @CXTYPE AND @NAMT=(CASE WHEN @CXTYPE ='CR' THEN DEBIT_AMOUNT ELSE CREDIT_AMOUNT END)


	LAST:
	RETURN ISNULL(@CACNAME1,'')

END
