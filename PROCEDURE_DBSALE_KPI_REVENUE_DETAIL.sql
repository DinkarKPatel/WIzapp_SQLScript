CREATE PROCEDURE DBSALE_KPI_REVENUE_DETAIL(@USER_CODE VARCHAR(7)='0000000',@LOC VARCHAR(MAX)='',@DT VARCHAR(10))
AS    
BEGIN    
  SET NOCOUNT ON
  SELECT SUM(FTD_CY)FTD_CY,SUM(PrevDay)PrevDay,SUM(PrevDay_P)PrevDay_P,SUM(PrevMth)PrevMth,SUM(PrevMth_P)PrevMth_P,SUM(FTD_LY)FTD_LY,SUM(FTD_LY_P)FTD_LY_P
  FROM DBSALE_KPI_DYNAMIC_DATA (NOLOCK) 
  WHERE REP_SCRIPT='DBSALE_KPI_REVENUE_DETAIL'
  AND DT=@DT
  AND (@LOC='' OR DEPT_ID IN (SELECT CODE FROM DBO.FN_SPLIT_VALUE(@LOC)))
  GROUP BY PERIOD,PD_TYPE
  ORDER BY CONVERT(INT,REPLACE(PD_TYPE,'W',''))
  SET NOCOUNT OFF
END---PROCEDURE DBSALE_KPI_REVENUE_DETAIL