CREATE PROCEDURE SP_SEND_MIRROR_DEND_DATA_NEW
(
     @CUPLOADEDXNID VARCHAR(50)
	,@CCURLOCID VARCHAR(5)	
	,@BACKNOWLEDGE BIT=0
	,@CERRMSG VARCHAR(1000) OUTPUT
)
--WITH ENCRYPTION
AS
BEGIN
	DECLARE @DTSQL NVARCHAR(MAX),@NSPID INT,@CTEMPTABLE VARCHAR(500),@CMEMOID VARCHAR(50),
	@CTEMPEMPLOYEETABLE VARCHAR(200),@DMEMOLASTUPDATE DATETIME,@CTABLENAME VARCHAR(100),
	@BRECFOUND BIT,@CSTEP VARCHAR(5),@CFILTERCONDITION VARCHAR(MAX),
	@CTEMPMASTERTABLE VARCHAR(200),@CTEMPDETAILTABLE VARCHAR(200),@CTEMPLMTABLE VARCHAR(200),
	@CTEMPLMPTABLE VARCHAR(200),@CTEMPAREATABLE VARCHAR(200),@CTEMPCITYTABLE VARCHAR(200),
	@CTEMPSKUTABLE VARCHAR(200),@CTEMPARTTABLE VARCHAR(200),@CTEMPSDTABLE VARCHAR(200),
	@CTEMPARTATTRTABLE VARCHAR(200),@DTLOGDATE DATETIME
	DECLARE @TXNSSENDINFO TABLE (ORG_TABLENAME VARCHAR(50),TMP_TABLENAME VARCHAR(50),XN_ID VARCHAR(40)) 
BEGIN TRY
	---- CALL ACKNOWLEDGEMENT OF MEMO SUCCESSFUL MERGING AT MIRRORING SERVER
	
	DECLARE @CTEMPDBNAME VARCHAR(40)
	
	SET @CTEMPDBNAME=''
	SET @CSTEP=10
	   
	SET @CFILTERCONDITION=''
	
	-- CHANGE BY BAIJNATH
	SET @CMEMOID=@CUPLOADEDXNID

	IF ISNULL(@CMEMOID,'')=''
	  GOTO END_PROC
	
	
	
	SET @CSTEP=110

	SELECT  A.*,'DEND_DAYCLOSE_LOG_UPLOAD' AS TARGET_TABLENAME FROM DAYCLOSE_LOG A (NOLOCK) WHERE DEPT_ID=@CCURLOCID AND LOG_DATE=@CMEMOID

	---- SEND THE DAYCLOSE_LOG MEMO MASTER TABLE
	SELECT  A.*,'DEND_CC_BATCH_COLLECTION_UPLOAD' AS TARGET_TABLENAME FROM CC_BATCH_COLLECTION A (NOLOCK) WHERE DEPT_ID=@CCURLOCID AND BATCH_DT=@CMEMOID

	
	SELECT  A.*,'DEND_saleperson_wise_custwalkin_UPLOAD' AS TARGET_TABLENAME FROM saleperson_wise_custwalkin A (NOLOCK) WHERE DEPT_ID=@CCURLOCID AND log_date=@CMEMOID

	
    GOTO END_PROC
    
END TRY
BEGIN CATCH
			SET @CERRMSG='P: SP_SEND_MIRROR_DEND_DATA_NEW, STEP:'+@CSTEP+', MESSAGE:'+ERROR_MESSAGE()
			GOTO END_PROC
END CATCH	
END_PROC:
		
			
END
