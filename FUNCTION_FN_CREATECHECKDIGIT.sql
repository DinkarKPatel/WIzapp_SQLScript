CREATE FUNCTION DBO.FN_CREATECHECKDIGIT (@CINPUTSTR VARCHAR(50))
RETURNS CHAR(1)
--WITH ENCRYPTION
AS
BEGIN
	
	DECLARE @CCHECKDIGIT CHAR(1),@NODDSUM NUMERIC(20,0),@NEVENSUM NUMERIC(20,0),@NTOTAL NUMERIC(20,0),
			@NCHECKDIGIT NUMERIC(1,0),@BLOOP BIT
	
	
	SET @CCHECKDIGIT=''
	
	IF LEN(LTRIM(RTRIM(@CINPUTSTR))) <> 12 -- WRONG CALL
		RETURN @CCHECKDIGIT
	
	SELECT @NODDSUM=0,@NEVENSUM=0,@NTOTAL=0,@NCHECKDIGIT=0

	SET @NEVENSUM =3*(CONVERT(NUMERIC(1,0),SUBSTRING(@CINPUTSTR, 2, 1))+
				CONVERT(NUMERIC(1,0),SUBSTRING(@CINPUTSTR, 4, 1))+
				CONVERT(NUMERIC(1,0),SUBSTRING(@CINPUTSTR, 6, 1))+			
				CONVERT(NUMERIC(1,0),SUBSTRING(@CINPUTSTR, 8, 1))+			
				CONVERT(NUMERIC(1,0),SUBSTRING(@CINPUTSTR, 10, 1)) +
				CONVERT(NUMERIC(1,0),SUBSTRING(@CINPUTSTR, 12, 1)))
				
	SET @NODDSUM = 	CONVERT(NUMERIC(1,0),SUBSTRING(@CINPUTSTR, 1, 1))+
				CONVERT(NUMERIC(1,0),SUBSTRING(@CINPUTSTR, 3, 1))+
				CONVERT(NUMERIC(1,0),SUBSTRING(@CINPUTSTR, 5, 1))+			
				CONVERT(NUMERIC(1,0),SUBSTRING(@CINPUTSTR, 7, 1))+			
				CONVERT(NUMERIC(1,0),SUBSTRING(@CINPUTSTR, 9, 1)) +
				CONVERT(NUMERIC(1,0),SUBSTRING(@CINPUTSTR, 11, 1))

	SET @NTOTAL = @NEVENSUM + @NODDSUM
	
	SET @BLOOP=1
	
	IF @NTOTAL%10 = 0
		RETURN '0'
			
	WHILE @BLOOP=1
	BEGIN
		SET @NTOTAL = @NTOTAL + 1
		SET @NCHECKDIGIT = @NCHECKDIGIT + 1
		IF @NTOTAL%10 = 0
			SET @BLOOP=0
	END
	
	SET @CCHECKDIGIT=LTRIM(RTRIM(STR(@NCHECKDIGIT)))
	RETURN @CCHECKDIGIT

END
