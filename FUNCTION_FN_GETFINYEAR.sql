CREATE FUNCTION FN_GETFINYEAR (@DDATE DATETIME)
RETURNS CHAR(3)
--WITH ENCRYPTION
AS
BEGIN

	DECLARE @CFINYEAR1 CHAR(4),@CFINYEAR2 CHAR(4),@CFINYEAR CHAR(9),@CFINYEARVAL CHAR(1)

	SET @CFINYEAR1 = CONVERT(CHAR,DATEPART(YEAR,@DDATE)+(CASE WHEN UPPER(DATENAME(MONTH,@DDATE)) IN
			   ('JANUARY','FEBRUARY','MARCH') THEN -1 ELSE 0 END))
	SET @CFINYEAR2=CONVERT(CHAR,DATEPART(YEAR,@DDATE)+(CASE WHEN UPPER(DATENAME(MONTH,@DDATE)) IN
			   ('JANUARY','FEBRUARY','MARCH') THEN 0 ELSE 1 END))
	SET @CFINYEAR =RTRIM( @CFINYEAR1+'-'+@CFINYEAR2)

	SET @CFINYEARVAL = CONVERT(CHAR,CONVERT(NUMERIC,SUBSTRING(@CFINYEAR, 1, 2)) - 
					  (CASE WHEN CONVERT(NUMERIC,RIGHT(@CFINYEAR, 2)) < 
					  CONVERT(NUMERIC,SUBSTRING(@CFINYEAR, 3, 2))  THEN 18 ELSE 19 END))
					  + RIGHT(@CFINYEAR, 2)
	
	RETURN @CFINYEARVAL+RIGHT(@CFINYEAR, 2) 
END
