CREATE PROCEDURE SP3SGETPURCHASEDIFF_FDN  
(  
   @DFROMDT DATETIME  
  ,@DTODT DATETIME  
)  
  
AS   
BEGIN  
	
	DECLARE @cFinYear VARCHAR(5)

	SET @cFinYear='01'+dbo.fn_getfinyear(@dToDt)

	SELECT mrr_id INTO #tmpMrr
	FROM PIM01106 PIM(NOLOCK)  
	LEFT OUTER JOIN RMM01106 RMM (NOLOCK) ON RMM.REFMEMOID=PIM.MRR_ID
	WHERE PIM.CANCELLED =0  AND PIM.INV_MODE=1
	AND PIM.MRR_DT <= @DTODT AND pim.fin_year=@cFinYear
	AND RMM.REFMEMOID IS NULL
	AND ISNULL(pim.TERMS,'')<>''
	AND ISNULL(PIM.DO_NOT_CREATE_FDN,0)=0
	
	EXEC SP3S_GET_PURVALUE_AGST_TERMS
	@nMode=3


END--END OF PROCEDURE - SP3SGETPURCHASEDIFF_fdn