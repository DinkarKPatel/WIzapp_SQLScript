CReate PROCEDURE SP3S_EOSSSMRYRPT
(
@cWhere varchar(max)
)
As begin


declare @CCMD	NVARCHAR(4000)


SET @CCMD = N'SELECT  C.DEPT_NAME AS [STORE NAME],MEMO_NO AS [MEMO NUMBER] ,CONVERT(VARCHAR, MEMO_DT,106) AS [MEMO GENERATE DATE] ,
 CONVERT(VARCHAR, PERIOD_FROM,106) + ' + '''-'''+ ' + CONVERT(VARCHAR, PERIOD_TO,106)  AS [MEMO FROM DATE TO  TODATE], 
SUM(B.QUANTITY) AS QTY, SUM(MRP_VALUE) AS MRP, sum(cmd.rfnet) AS [ NET SALE],
SUM(TAXABLE_VALUE) AS [TAXABLE VALUE], 
SUM(OUTPUT_GST) AS [OUTPUT GST],  sum(cmd.rfnet) AS  NRV,GM_PER AS [GM %], 
0 AS [TAXABLE MARGIN %], SUM(CLAIMED_BASE_VALUE) AS [CLAIM BASE], 
SUM(CLAIMED_BASE_GM_VALUE) AS [CLAIM GM],SUM(INPUT_GST) AS [INPUT GST] , 
SUM(OUTPUT_GST- INPUT_GST)  AS [GST DIFF],
SUM(B.NET_PAYABLE) AS [NET PAYABLE] ,
SUM(PURCHASE_PRICE*b.quantity) AS [NET PURCHASE] , 
0 AS [NRV MARGIN %], 
SUM(RATE_DIFF )AS [RATE DIFF]
FROM EOSSSORM A (Nolock)
JOIN EOSSSORD B   (Nolock) ON A.MEMO_ID= B.MEMO_ID
Left outer join  cmd01106  (Nolock)  cmd on  B.cmd_row_id= cmd.row_id
left outer JOIN LOCATION C  (Nolock) ON A.party_dept_id = C.DEPT_ID
Where A.memo_id in (' +@cWhere+ ')
GROUP BY  C.DEPT_NAME,MEMO_NO,MEMO_DT,PERIOD_FROM,PERIOD_TO,GM_PER
ORDER BY  C.DEPT_NAME,MEMO_NO,MEMO_DT,PERIOD_FROM,PERIOD_TO,GM_PER'

Print @CCMD
EXEC SP_EXECUTESQL @CCMD


End





