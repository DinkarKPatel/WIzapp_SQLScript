CREATE VIEW VW_CASHMEMO_PRINT_DET

AS
SELECT * , CONVERT(TIMESTAMP,0) AS [TS]
FROM
(
	SELECT A.CM_ID, A.PRODUCT_CODE,SUM(A.QUANTITY) AS QUANTITY,A.MRP,SUM(A.NET) AS NET ,A.DISCOUNT_PERCENTAGE,
	SUM(A.DISCOUNT_AMOUNT) AS DISCOUNT_AMOUNT ,
	A.TAX_TYPE,'T'+(CASE WHEN A.TAX_PERCENTAGE=0 THEN 'F' WHEN ROUND(A.TAX_PERCENTAGE,0)=A.TAX_PERCENTAGE THEN LTRIM(RTRIM(STR(A.TAX_PERCENTAGE)))
							 ELSE LTRIM(RTRIM(STR(A.TAX_PERCENTAGE,6,2))) END) AS TAX_STATUS,A.TAX_PERCENTAGE,SUM(A.TAX_AMOUNT) AS TAX_AMOUNT,A.EMP_CODE
	,D.ARTICLE_NO,D.ARTICLE_NAME,P1.PARA1_NAME,P2.PARA2_NAME,P3.PARA3_NAME,H.UOM_NAME
	,F.SECTION_NAME,E.SUB_SECTION_NAME,P4.PARA4_NAME,P5.PARA5_NAME,P6.PARA6_NAME,G.EMP_NAME
	, A.SR_NO,C.PRODUCT_NAME, SUM(A.NET+ A.TAX_AMOUNT) AS NET_SALE_RATE,A.HSN_CODE ,
	CAST(A.GST_PERCENTAGE AS NUMERIC(10,0)) AS  GST_PERCENTAGE,
	CAST(A.IGST_AMOUNT AS NUMERIC(10,0)) AS IGST_AMOUNT  ,
	CAST(A.CGST_AMOUNT AS NUMERIC(10,0)) AS CGST_AMOUNT ,
	CAST(A.SGST_AMOUNT AS NUMERIC(10,0)) AS SGST_AMOUNT  
	FROM CMD01106 A (NOLOCK)
	JOIN CMM01106 B (NOLOCK) ON B.CM_ID=A.CM_ID
	JOIN SKU C (NOLOCK) ON A.PRODUCT_CODE= C.PRODUCT_CODE
	JOIN ARTICLE D (NOLOCK) ON C.ARTICLE_CODE= D.ARTICLE_CODE
	JOIN SECTIOND E (NOLOCK) ON D.SUB_SECTION_CODE= E.SUB_SECTION_CODE
	JOIN SECTIONM F (NOLOCK) ON E.SECTION_CODE= F.SECTION_CODE
	JOIN PARA1 P1 (NOLOCK) ON C.PARA1_CODE= P1.PARA1_CODE
	JOIN PARA2 P2 (NOLOCK) ON C.PARA2_CODE= P2.PARA2_CODE
	JOIN PARA3 P3 (NOLOCK) ON C.PARA3_CODE= P3.PARA3_CODE
	JOIN PARA4 P4 (NOLOCK) ON C.PARA4_CODE= P4.PARA4_CODE
	JOIN PARA5 P5 (NOLOCK) ON C.PARA5_CODE= P5.PARA5_CODE
	JOIN PARA6 P6 (NOLOCK) ON C.PARA6_CODE= P6.PARA6_CODE	
	JOIN EMPLOYEE G (NOLOCK) ON G.EMP_CODE=A.EMP_CODE
	JOIN UOM H (NOLOCK) ON D.UOM_CODE=H.UOM_CODE
	
	GROUP BY 
	A.CM_ID, A.PRODUCT_CODE,A.MRP ,A.DISCOUNT_PERCENTAGE,
	A.TAX_TYPE,A.TAX_PERCENTAGE,A.EMP_CODE
	,D.ARTICLE_NO,D.ARTICLE_NAME,P1.PARA1_NAME,P2.PARA2_NAME,P3.PARA3_NAME,H.UOM_NAME
	,F.SECTION_NAME,E.SUB_SECTION_NAME,P4.PARA4_NAME,P5.PARA5_NAME,P6.PARA6_NAME,G.EMP_NAME
	,C.PRODUCT_NAME,A.SR_NO,A.HSN_CODE ,A.GST_PERCENTAGE ,A.IGST_AMOUNT ,A.CGST_AMOUNT ,A.SGST_AMOUNT 
)X
