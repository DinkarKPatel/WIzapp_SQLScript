CREATE PROCEDURE SP_SERIESSETUP     
(        
 @NQUERYID INT      
)         
AS        
BEGIN        
 IF @NQUERYID=1        
    GOTO SERIESSETUP_XNTYPE        
 ELSE IF @NQUERYID=2        
    GOTO XNS_SERIES_MST      
 ELSE IF @NQUERYID=3        
    GOTO XNS_SERIES_MST_GROUP_XFR     
 ELSE IF @NQUERYID=4
    GOTO XNS_SERIES_MANUAL_DET
        
 SERIESSETUP_XNTYPE:        
 SELECT DISTINCT CASE XN_TYPE      
						WHEN 'PRT'		THEN 'DEBIT NOTE'        
						WHEN 'PRT_GRP'	THEN 'GROUP DEBIT NOTE'      
						WHEN 'PUR'		THEN 'PURCHASE INVOICE'      
						WHEN 'WSL'		THEN 'WHOLESALE INVOICE'      
						WHEN 'WSL_GRP'	THEN 'GROUP WHOLESALE INVOICE'      
						--ELSE				 'WHOLE SALE CREDIT NOTE'       
				END AS XN_TYPE_NAME,XN_TYPE 
 FROM XNS_SERIES_MST_COLVAL (NOLOCK)
 ORDER BY XN_TYPE      
 GOTO ENDPROC 
 
  
 XNS_SERIES_MST:      
 SELECT CONVERT(BIT,CASE (SELECT TOP 1 VALUE FROM XNS_SERIES_MST M1 (NOLOCK) WHERE M1.XN_TYPE=A.XN_TYPE AND M1.COLUMNNAME='AUTO_PREFIX_MODE') WHEN A.AUTO_PREFIX_MODE THEN 1 ELSE 0 END)CHK
 ,A.[MODE],A.PREFIXNAME COLUMNNAME,A.XN_TYPE,A.AUTO_PREFIX_MODE,A.ROW_ID,A.COLUMN_DESC
 ,CASE PREFIXNAME WHEN 'NO PREFIX' THEN 'START FROM' ELSE '' END AS 'START_FROM'      
 ,CASE PREFIXNAME WHEN 'NO PREFIX' THEN (SELECT TOP 1 M1.VALUE FROM XNS_SERIES_MST M1 (NOLOCK) WHERE M1.COLUMNNAME='START_FROM' AND M1.XN_TYPE=A.XN_TYPE) ELSE '' END 'VALUE'      
 --,CASE PREFIXNAME WHEN 'NO PREFIX' THEN 1 ELSE A.PREFIX_REQUIRED END AS 'PREFIX_REQUIRED'      
 ,A.PREFIX
 FROM      
 (    
  SELECT DISTINCT 
  (SELECT TOP 1 ISNULL(M1.VALUE,0) FROM XNS_SERIES_MST M1 (NOLOCK) WHERE M1.XN_TYPE=M.XN_TYPE AND M1.COLUMNNAME='MODE')AS [MODE]
  ,M.XN_TYPE AS XN_TYPE
  ,B.VALUE_DESC AS [PREFIXNAME]
  ,B.VALUE AS AUTO_PREFIX_MODE
  ,M.COLUMN_DESC
  ,ROW_NUMBER()OVER (ORDER BY M.XN_TYPE,B.VALUE,B.VALUE_DESC)AS ROW_ID
  --31 JAN 2018
  ,PREFIX_REQUIRED=CASE ISNULL(B.PREFIX_REQUIRED,0) WHEN 1 THEN 1 ELSE 0 END
  --,PREFIX=CASE ISNULL(B.PREFIX_REQUIRED,0) WHEN 1 THEN M.PREFIX ELSE '' END
  ,PREFIX=CASE M.VALUE WHEN B.VALUE THEN M.PREFIX ELSE '' END
  FROM XNS_SERIES_MST M (NOLOCK)     
  JOIN XNS_SERIES_MST_COLVAL B (NOLOCK) ON M.XN_TYPE=B.XN_TYPE AND M.COLUMNNAME=B.COLUMNNAME
  WHERE M.COLUMNNAME IN ('AUTO_PREFIX_MODE') 
 )A       
 ORDER BY A.XN_TYPE,ROW_ID
 GOTO ENDPROC
  
  
  XNS_SERIES_MST_GROUP_XFR:        
  SELECT DISTINCT CASE SOURCE_LOC_TYPE WHEN '1' THEN 'COMPANY OWNED' ELSE 'FRANCHISE' END AS SOURCE_LOC_TYPE_NAME
  ,SOURCE_LOC_TYPE
  ,CASE TARGET_LOC_TYPE WHEN '1' THEN 'COMPANY OWNED' ELSE 'FRANCHISE' END AS TARGET_LOC_TYPE_NAME
  ,TARGET_LOC_TYPE
  ,CASE XFR_MODE WHEN '1' THEN 'LOCAL' ELSE 'INTERSTATE' END AS XFR_MODE_NAME
  ,XN_TYPE
  ,ISNULL(PREFIX,0) AS PREFIX
  ,XFR_MODE 
  FROM XNS_SERIES_GROUP_XFR (NOLOCK)       
  GOTO ENDPROC          
  
  XNS_SERIES_MANUAL_DET:
  SELECT ROWID=ROW_NUMBER() OVER(ORDER BY XN_TYPE,PREFIX),* FROM XNS_SERIES_MANUAL_DET(NOLOCK)
  GOTO ENDPROC          

 ENDPROC:        
END
