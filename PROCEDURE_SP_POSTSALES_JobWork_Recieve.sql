CREATE PROC [DBO].[SP_POSTSALES_JOBWORK_RECIEVE]              
@IMODE INT,              
@CWHERE NVARCHAR(4000)='',
@CWHERE1 NVARCHAR(4000)='',
@CLOCID VARCHAR(4)='' ,
@cUserCode	VARCHAR(MAX)='',
@cBIN_ID	VARCHAR(MAX)=''

----WITH ENCRYPTION              
AS
BEGIN              
IF @IMODE=1              
 GOTO LBLMST  
             
ELSE IF @IMODE=2              
 GOTO LBLDET      
         
ELSE IF @IMODE=3              
 GOTO LBLISSUE    
            
ELSE IF @IMODE=4              
 GOTO LBLDREC    
           
ELSE IF @IMODE=5              
 GOTO LBLALLDATACOL    
                 
ELSE IF @IMODE=6                                                                                                                            
 GOTO LBLLOOKUP   
            
ELSE IF @IMODE=7    
 GOTO LBLCANCELCHECK  
ELSE              
 GOTO LAST        
      DECLARE @CCMD NVARCHAR(MAX) 
          
LBLMST:              
   SELECT A.*,B.AGENCY_NAME,U.USERNAME AS USER_NAME, U1.USERNAME AS EDT_USER_NAME
   FROM POST_SALES_JOBWORK_RECEIPT_MST A (NOLOCK)           
   JOIN PRD_AGENCY_MST B (NOLOCK) ON A.AGENCY_CODE = B.AGENCY_CODE  
   LEFT OUTER JOIN USERS U (NOLOCK) ON U.USER_CODE = A.USER_CODE 
   LEFT OUTER  JOIN USERS U1 (NOLOCK) ON U1.USER_CODE = A.EDT_USER_CODE              
   WHERE A.RECEIPT_ID=@CWHERE                 
   GOTO LAST              
   
LBLDET:              
    
    SELECT (CAST(1 AS BIT)) AS CHKDELIVER ,(CAST(1 AS BIT)) AS PRINT_LABEL, B.*,B.QUANTITY AS TEMP_QUANTITY,
    ART.ARTICLE_CODE, ART.ARTICLE_NO, ART.ARTICLE_NAME, P1.PARA1_CODE,  
	PARA1_NAME, P2.PARA2_CODE,PARA2_NAME,P3.PARA3_CODE,PARA3_NAME,UOM_NAME,     
	CODING_SCHEME,CONVERT(NUMERIC(10,2),0) AS QUANTITY_IN_STOCK,SKU.PURCHASE_PRICE,
	SKU.MRP,SKU.WS_PRICE,   SM.SECTION_NAME, SD.SUB_SECTION_NAME,  
	P4.PARA4_CODE,P5.PARA5_CODE,P6.PARA6_CODE,  
	PARA4_NAME,PARA5_NAME,PARA6_NAME,E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],  
	ART.DT_CREATED AS [ART_DT_CREATED],P3.DT_CREATED AS [PARA3_DT_CREATED],SKU.DT_CREATED AS [SKU_DT_CREATED],  
	ART.STOCK_NA,F.JOB_CODE, F.JOB_NAME, A.RECEIPT_NO,ISNULL(P.CM_NO,'') AS CM_NO
	,O.ISSUE_NO,O.ISSUE_DT,D.AGENCY_NAME 
	,C1.USER_CUSTOMER_CODE +' - '+ C1.CUSTOMER_FNAME +' '+ C1.CUSTOMER_LNAME AS CUST_NAME 
	,C1.MOBILE,ART.ALIAS AS ARTICLE_ALIAS,M.REMARKS AS [ISSUE_REMARKS]      ,O1.memo_no AS HBD_MEMO_NO
	,Q.PRODUCT_CODE as OLD_PRODUCT_CODE
    FROM POST_SALES_JOBWORK_RECEIPT_MST A (NOLOCK)                 
    JOIN POST_SALES_JOBWORK_RECEIPT_DET B (NOLOCK) ON A.RECEIPT_ID = B.RECEIPT_ID               
    JOIN POST_SALES_JOBWORK_ISSUE_DET M (NOLOCK) ON M.ROW_ID = B.REF_ROW_ID
    JOIN POST_SALES_JOBWORK_ISSUE_MST O (NOLOCK) ON O.ISSUE_ID = M.ISSUE_ID  
    JOIN PRD_AGENCY_MST D (NOLOCK) ON O.AGENCY_CODE = D.AGENCY_CODE   
    JOIN HOLD_BACK_DELIVER_DET M1 (NOLOCK) ON M1.ROW_ID = M.REF_HBD_ROW_ID 
    JOIN HOLD_BACK_DELIVER_MST O1 (NOLOCK) ON O1.MEMO_ID = M1.MEMO_ID 
    LEFT JOIN CMD01106 Q (NOLOCK) ON Q.ROW_ID = M1.REF_CMD_ROW_ID     
    LEFT JOIN CMM01106 P (NOLOCK) ON Q.CM_ID = P.CM_ID   
    LEFT OUTER JOIN CUSTDYM C1 (NOLOCK) ON isnull(P.CUSTOMER_CODE,O1.customer_code) = C1.CUSTOMER_CODE 
	JOIN SKU ON SKU.PRODUCT_CODE=M.PRODUCT_CODE
	JOIN ARTICLE ART ON SKU.ARTICLE_CODE = ART.ARTICLE_CODE    
	JOIN SECTIOND SD ON ART.SUB_SECTION_CODE = SD.SUB_SECTION_CODE  
	JOIN SECTIONM SM ON SD.SECTION_CODE = SM.SECTION_CODE  
	JOIN PARA1 P1 ON SKU.PARA1_CODE = P1.PARA1_CODE    
	JOIN PARA2 P2 ON SKU.PARA2_CODE = P2.PARA2_CODE    
	JOIN PARA3 P3 ON SKU.PARA3_CODE = P3.PARA3_CODE    
	JOIN PARA4 P4 ON SKU.PARA4_CODE = P4.PARA4_CODE    
	JOIN PARA5 P5 ON SKU.PARA5_CODE = P5.PARA5_CODE    
	JOIN PARA6 P6 ON SKU.PARA6_CODE = P6.PARA6_CODE    
	JOIN UOM E ON ART.UOM_CODE = E.UOM_CODE 
    JOIN JOBS F (NOLOCK) ON F.JOB_CODE = M.JOB_CODE                
    WHERE A.RECEIPT_ID= @CWHERE-- AND ISNULL(O1.MODE,0)<>2  
     
    
 --   UNION
 --   SELECT (CAST(0 AS BIT)) AS CHKDELIVER ,(CAST(1 AS BIT)) AS PRINT_LABEL, B.*,B.QUANTITY AS TEMP_QUANTITY,
 --   ART.ARTICLE_CODE, ART.ARTICLE_NO, ART.ARTICLE_NAME,'0000000' AS PARA1_CODE,  
	--'' AS PARA1_NAME,'0000000' AS PARA2_CODE,'' AS PARA2_NAME,'0000000' AS PARA3_CODE,'' AS PARA3_NAME,UOM_NAME,     
	--CODING_SCHEME,CONVERT(NUMERIC(10,2),0) AS QUANTITY_IN_STOCK,0 AS PURCHASE_PRICE,
	--0 AS MRP,0 AS WS_PRICE,SM.SECTION_NAME, SD.SUB_SECTION_NAME,'0000000' AS PARA4_CODE,'0000000' AS PARA5_CODE,
	--'0000000' AS PARA6_CODE,'' AS PARA4_NAME,'' AS PARA5_NAME,'' AS PARA6_NAME,E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],  
	--ART.DT_CREATED AS [ART_DT_CREATED],'' AS [PARA3_DT_CREATED],'' AS [SKU_DT_CREATED],  
	--ART.STOCK_NA,F.JOB_CODE, F.JOB_NAME, A.RECEIPT_NO,'' AS CM_NO
	--,O.ISSUE_NO,O.ISSUE_DT,D.AGENCY_NAME 
	--,C1.USER_CUSTOMER_CODE +' - '+ C1.CUSTOMER_FNAME +' '+ C1.CUSTOMER_LNAME AS CUST_NAME 
	--,C1.MOBILE,ART.ALIAS AS ARTICLE_ALIAS,M.REMARKS AS [ISSUE_REMARKS]      ,O1.memo_no AS HBD_MEMO_NO
	--,'' as OLD_PRODUCT_CODE
 --   FROM POST_SALES_JOBWORK_RECEIPT_MST A (NOLOCK)                 
 --   JOIN POST_SALES_JOBWORK_RECEIPT_DET B (NOLOCK) ON A.RECEIPT_ID = B.RECEIPT_ID               
 --   JOIN POST_SALES_JOBWORK_ISSUE_DET M (NOLOCK) ON M.ROW_ID = B.REF_ROW_ID
 --   JOIN POST_SALES_JOBWORK_ISSUE_MST O (NOLOCK) ON O.ISSUE_ID = M.ISSUE_ID  
 --   JOIN PRD_AGENCY_MST D (NOLOCK) ON O.AGENCY_CODE = D.AGENCY_CODE   
 --   JOIN HOLD_BACK_DELIVER_DET M1 (NOLOCK) ON M1.ROW_ID = M.REF_HBD_ROW_ID 
 --   JOIN HOLD_BACK_DELIVER_MST O1 (NOLOCK) ON O1.MEMO_ID = M1.MEMO_ID 
 --   LEFT OUTER JOIN CUSTDYM C1 (NOLOCK) ON O1.CUSTOMER_CODE = C1.CUSTOMER_CODE 
	--JOIN SKU_REPAIR SKU ON SKU.PRODUCT_CODE=M.PRODUCT_CODE
	--JOIN ARTICLE ART ON SKU.ARTICLE_CODE = ART.ARTICLE_CODE    
	--JOIN SECTIOND SD ON ART.SUB_SECTION_CODE = SD.SUB_SECTION_CODE  
	--JOIN SECTIONM SM ON SD.SECTION_CODE = SM.SECTION_CODE  
	--JOIN UOM E ON ART.UOM_CODE = E.UOM_CODE 
 --   JOIN JOBS F (NOLOCK) ON F.JOB_CODE = M.JOB_CODE                
 --   WHERE A.RECEIPT_ID= @CWHERE AND ISNULL(O1.MODE,0)=2              
    ORDER BY TS
    
	GOTO LAST           
	
LBLISSUE:              
 SELECT ISSUE_NO,ISSUE_ID FROM POST_SALES_JOBWORK_ISSUE_MST WHERE CANCELLED = 0               
 GOTO LAST               
              
LBLDREC:              
       EXEC SP_POSTSALES_JOBWORK_RECIEVE_4 
		@CWHERE =@CWHERE,
		@CWHERE1 =@CWHERE1 ,
		@CLOCID =@CLOCID ,
		@cUserCode	=@cUserCode	,
		@cBIN_ID	=@cBIN_ID	
  
 --   IF OBJECT_ID ('TEMPDB..#TMP_ISSUEDETAILS','U') IS NOT NULL
 --     DROP TABLE #TMP_ISSUEDETAILS
   
 --   SELECT (CAST(0 AS BIT)) AS CHKBILL ,
 --          B.*,
	--	   B.REMARKS AS [ISSUE_REMARKS],
	--	   M1.REF_CMD_ROW_ID ,
	--	   A.AGENCY_CODE,
	--	   A.ISSUE_NO,
	--	   A.ISSUE_DT,
	--	   O1.CUSTOMER_CODE 
	--	   ,O1.memo_no AS HBD_MEMO_NO
	--INTO #TMP_ISSUEDETAILS		 
 --   FROM POST_SALES_JOBWORK_ISSUE_MST A (NOLOCK)                     
 --   JOIN POST_SALES_JOBWORK_ISSUE_DET B (NOLOCK) ON A.ISSUE_ID = B.ISSUE_ID  
 --   JOIN HOLD_BACK_DELIVER_DET M1 (NOLOCK) ON M1.ROW_ID = B.REF_HBD_ROW_ID     
 --   JOIN HOLD_BACK_DELIVER_MST O1 (NOLOCK) ON O1.MEMO_ID = M1.MEMO_ID 
 --   JOIN PRD_AGENCY_MST D (NOLOCK) ON A.AGENCY_CODE = D.AGENCY_CODE
 --   WHERE ((B.PRODUCT_CODE  = @CWHERE AND @CWHERE<>'') OR (D.AGENCY_CODE = @CWHERE1 AND @CWHERE1<>'')) 
 --   AND A.CANCELLED = 0 
 --   AND (@CLOCID='' OR LEFT(A.issue_no,2)=@CLOCID)
 --   --AND ISNULL(O1.MODE,0)<>2       
 --  -- AND (B.QUANTITY - ISNULL(REC.QUANTITY,0)) > 0  
   
 --  IF OBJECT_ID ('TEMPDB..#TMP_REC_DETAILS','U') IS NOT NULL
 --     DROP TABLE #TMP_REC_DETAILS
      
 --     SELECT M.REF_ROW_ID,SUM(M.QUANTITY) AS QUANTITY  
 --     INTO #TMP_REC_DETAILS
 --     FROM POST_SALES_JOBWORK_RECEIPT_DET M (NOLOCK)                     
 --     JOIN POST_SALES_JOBWORK_RECEIPT_MST N (NOLOCK) ON M.RECEIPT_ID = N.RECEIPT_ID     
 --     JOIN POST_SALES_JOBWORK_ISSUE_DET O (NOLOCK) ON O.ROW_ID=M.REF_ROW_ID    
 --     WHERE ((O.PRODUCT_CODE  = @CWHERE AND @CWHERE<>'') OR (N.AGENCY_CODE = @CWHERE1 AND @CWHERE1<>''))    
 --     AND N.CANCELLED = 0  GROUP BY M.REF_ROW_ID
      
      
      
 --      SELECT (CAST(0 AS BIT)) AS CHKBILL ,(M1.QUANTITY - ISNULL(REC.QUANTITY,0)) AS  QUANTITY,M1.*,(M1.QUANTITY - ISNULL(REC.QUANTITY,0)) AS TEMP_QUANTITY,     
	--	 ISNULL(P.CM_NO,'') AS CM_NO, F.JOB_NAME, M1.ISSUE_NO ,M1.ISSUE_DT,                  
	--		ART.ARTICLE_CODE, ART.ARTICLE_NO, ART.ARTICLE_NAME, P1.PARA1_CODE,      
	--	 PARA1_NAME, P2.PARA2_CODE,PARA2_NAME,P3.PARA3_CODE,PARA3_NAME,UOM_NAME,         
	--	 CODING_SCHEME,CONVERT(NUMERIC(10,2),0) AS QUANTITY_IN_STOCK,SKU.PURCHASE_PRICE,    
	--	 SKU.MRP,SKU.WS_PRICE,   SM.SECTION_NAME, SD.SUB_SECTION_NAME,      
	--	 P4.PARA4_CODE,P5.PARA5_CODE,P6.PARA6_CODE,      
	--	 PARA4_NAME,PARA5_NAME,PARA6_NAME,E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],      
	--	 ART.DT_CREATED AS [ART_DT_CREATED],P3.DT_CREATED AS [PARA3_DT_CREATED],SKU.DT_CREATED AS [SKU_DT_CREATED],      
	--	 ART.STOCK_NA,D.AGENCY_NAME,D.AGENCY_CODE        
	--	 ,C1.USER_CUSTOMER_CODE +' - '+ C1.CUSTOMER_FNAME +' '+ C1.CUSTOMER_LNAME AS CUST_NAME     
	--	 ,C1.MOBILE,ART.ALIAS AS ARTICLE_ALIAS  ,M1.REMARKS AS [ISSUE_REMARKS],
	--	 ISNULL(SKU.HSN_CODE,ART.HSN_CODE) AS HSN_CODE 
	--	 ,M1.HBD_MEMO_NO
	--	 FROM 
 --      #TMP_ISSUEDETAILS M1 
 --      JOIN CMD01106 Q (NOLOCK) ON Q.ROW_ID = M1.REF_CMD_ROW_ID         
 --      JOIN CMM01106 P (NOLOCK) ON Q.CM_ID = P.CM_ID       
 --      LEFT OUTER JOIN CUSTDYM C1 (NOLOCK) ON P.CUSTOMER_CODE = C1.CUSTOMER_CODE     
	--   JOIN SKU ON SKU.PRODUCT_CODE=M1.PRODUCT_CODE    
	--   JOIN ARTICLE ART (NOLOCK) ON SKU.ARTICLE_CODE = ART.ARTICLE_CODE   
	--   JOIN SECTIOND SD (NOLOCK) ON ART.SUB_SECTION_CODE = SD.SUB_SECTION_CODE      
	--   JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE = SM.SECTION_CODE      
	--   JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE = P1.PARA1_CODE        
	--   JOIN PARA2 P2 (NOLOCK)ON SKU.PARA2_CODE = P2.PARA2_CODE        
	--   JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE = P3.PARA3_CODE        
	--   JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE = P4.PARA4_CODE        
	--   JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE = P5.PARA5_CODE        
 --      JOIN PARA6 P6  (NOLOCK) ON SKU.PARA6_CODE = P6.PARA6_CODE        
 --      JOIN UOM E ON ART.UOM_CODE = E.UOM_CODE     
 --      JOIN JOBS F (NOLOCK) ON F.JOB_CODE = M1.JOB_CODE             
 --      JOIN PRD_AGENCY_MST D (NOLOCK) ON M1.AGENCY_CODE = D.AGENCY_CODE       
 --      LEFT OUTER JOIN 
 --      (SELECT M.REF_ROW_ID,SUM(M.QUANTITY) AS QUANTITY  FROM #TMP_REC_DETAILS M (NOLOCK)                     
 --       GROUP BY M.REF_ROW_ID) REC    
 --      ON REC.REF_ROW_ID =  M1.ROW_ID 
 --      WHERE (M1.QUANTITY - ISNULL(REC.QUANTITY,0)) > 0   
	-- UNION ALL
	--  SELECT (CAST(0 AS BIT)) AS CHKBILL ,(M1.QUANTITY - ISNULL(REC.QUANTITY,0)) AS  QUANTITY,M1.*,(M1.QUANTITY - ISNULL(REC.QUANTITY,0)) AS TEMP_QUANTITY,     
	-- '' AS CM_NO, F.JOB_NAME, M1.ISSUE_NO ,M1.ISSUE_DT,                  
	--	ART.ARTICLE_CODE, ART.ARTICLE_NO, ART.ARTICLE_NAME,'0000000' AS PARA1_CODE,      
	-- '' AS PARA1_NAME,'0000000' AS PARA2_CODE,'' AS PARA2_NAME,'0000000' AS PARA3_CODE,'' AS PARA3_NAME,UOM_NAME,         
	-- CODING_SCHEME,CONVERT(NUMERIC(10,2),0) AS QUANTITY_IN_STOCK,0 AS PURCHASE_PRICE,    
	-- 0 AS MRP,0 AS WS_PRICE,SM.SECTION_NAME, SD.SUB_SECTION_NAME,'0000000' AS PARA4_CODE,'0000000' AS PARA5_CODE,    
	-- '0000000' AS PARA6_CODE,'' AS PARA4_NAME,'' AS PARA5_NAME,'' AS PARA6_NAME,E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],      
	-- ART.DT_CREATED AS [ART_DT_CREATED],'' AS [PARA3_DT_CREATED],'' AS  [SKU_DT_CREATED],      
	-- ART.STOCK_NA,D.AGENCY_NAME,D.AGENCY_CODE        
	-- ,C1.USER_CUSTOMER_CODE +' - '+ C1.CUSTOMER_FNAME +' '+ C1.CUSTOMER_LNAME AS CUST_NAME     
	-- ,C1.MOBILE,ART.ALIAS AS ARTICLE_ALIAS  ,M1.REMARKS AS [ISSUE_REMARKS],
	-- ISNULL(ART.HSN_CODE,'') AS HSN_CODE ,M1.HBD_MEMO_NO                   
	-- FROM #TMP_ISSUEDETAILS  M1       
	-- LEFT OUTER JOIN CUSTDYM C1 (NOLOCK) ON M1.CUSTOMER_CODE = C1.CUSTOMER_CODE     
	-- JOIN SKU_REPAIR SKU ON SKU.PRODUCT_CODE=M1.PRODUCT_CODE    
	-- JOIN ARTICLE ART ON SKU.ARTICLE_CODE = ART.ARTICLE_CODE        
	-- JOIN SECTIOND SD ON ART.SUB_SECTION_CODE = SD.SUB_SECTION_CODE      
	-- JOIN SECTIONM SM ON SD.SECTION_CODE = SM.SECTION_CODE      
	-- JOIN UOM E ON ART.UOM_CODE = E.UOM_CODE     
	-- JOIN JOBS F (NOLOCK) ON F.JOB_CODE = M1.JOB_CODE             
	-- JOIN PRD_AGENCY_MST D (NOLOCK) ON M1.AGENCY_CODE = D.AGENCY_CODE  
	-- LEFT OUTER JOIN     
	-- (SELECT M.REF_ROW_ID,SUM(M.QUANTITY) AS QUANTITY  FROM #TMP_REC_DETAILS M (NOLOCK)                     
	--  GROUP BY M.REF_ROW_ID) REC    
	--  ON REC.REF_ROW_ID =  M1.ROW_ID 
	--  WHERE (M1.QUANTITY - ISNULL(REC.QUANTITY,0)) > 0          
        
    
   GOTO LAST   
              
LBLALLDATACOL:              

    SELECT * FROM POST_SALES_JOBWORK_RECEIPT_MST(NOLOCK) A              
    JOIN POST_SALES_JOBWORK_RECEIPT_DET(NOLOCK) B ON A.RECEIPT_ID=B.RECEIPT_ID              
   	JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=B.PRODUCT_CODE
	JOIN ARTICLE ART (NOLOCK) ON SKU.ARTICLE_CODE = ART.ARTICLE_CODE    
	JOIN SECTIOND SD (NOLOCK) ON ART.SUB_SECTION_CODE = SD.SUB_SECTION_CODE  
	JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE = SM.SECTION_CODE  
	JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE = P1.PARA1_CODE    
	JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE = P2.PARA2_CODE    
	JOIN PARA3 P3 (NOLOCK)ON SKU.PARA3_CODE = P3.PARA3_CODE    
	JOIN PARA4 P4 (NOLOCK)ON SKU.PARA4_CODE = P4.PARA4_CODE    
	JOIN PARA5 P5 (NOLOCK)ON SKU.PARA5_CODE = P5.PARA5_CODE    
    JOIN PARA6 P6 (NOLOCK)ON SKU.PARA6_CODE = P6.PARA6_CODE    
    JOIN UOM E (NOLOCK)ON ART.UOM_CODE = E.UOM_CODE 
    JOIN JOBS (NOLOCK) D ON D.JOB_CODE=A.JOB_CODE              
    WHERE A.RECEIPT_ID=@CWHERE              
    
  GOTO LAST              
LBLLOOKUP:   --slow query so use top 10 if any requirement of all data fetch Please use columnname            
  SET @CCMD=N'SELECT top 10 * FROM POST_SALES_JOBWORK_RECEIPT_MST (NOLOCK) '+ (CASE WHEN @CWHERE = '' THEN 'ORDER BY LAST_UPDATE DESC' ELSE @CWHERE END)       
  PRINT @CCMD
  EXEC SP_EXECUTESQL @CCMD
  
  GOTO LAST              
    

LBLCANCELCHECK:
	
	SELECT Q.ISSUE_ID AS MEMO_ID  
	FROM POST_SALES_JOBWORK_RECEIPT_MST A (NOLOCK)                 
	JOIN POST_SALES_JOBWORK_RECEIPT_DET B (NOLOCK) ON A.RECEIPT_ID = B.RECEIPT_ID    
	JOIN POST_SALES_JOBWORK_ISSUE_DET M (NOLOCK) ON M.ROW_ID = B.REF_ROW_ID 
	JOIN POST_SALES_JOBWORK_ISSUE_MST Q (NOLOCK) ON Q.ISSUE_ID = M.ISSUE_ID 
	JOIN HOLD_BACK_DELIVER_DET O (NOLOCK) ON O.ROW_ID = M.REF_HBD_ROW_ID  
	JOIN HOLD_BACK_DELIVER_MST C (NOLOCK) ON O.MEMO_ID = C.MEMO_ID 
	JOIN SLS_DELIVERY_DET P (NOLOCK) ON P.REF_HBD_ROW_ID = O.ROW_ID  
	WHERE A.RECEIPT_ID = @CWHERE  

	GOTO LAST
LAST:              
END
