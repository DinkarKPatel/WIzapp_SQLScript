

-- PROCEDURE SP_WL_ARTICLE_SUMMARY  
-- THIS PROCEDURE RETURNS RECORDS FROM ARTICLE TABLE BASED ON CERTAIN FILTER CONDITIONS  
-- USED IN ARTICLE SEARCH AND SECOND PAGE OF ARTICLE MASTER  
CREATE PROCEDURE SP_WL_ARTICLE_SUMMARY  
(  
	@NMODE INT = 0,  
	@CSUBSECTIONCODE VARCHAR(20)='',  
	@CARTICLENO VARCHAR(20)='',  
	@CARTICLENAME VARCHAR(10)='',  
	@CARTICLEDESC VARCHAR(10) = '',  
	@CKEYSTR VARCHAR(4000) = ''  
) 
--WITH ENCRYPTION 
AS   
BEGIN  
	DECLARE @CCMD NVARCHAR(MAX)  

	SET @CCMD = N' SELECT B.SUB_SECTION_NAME, A.ARTICLE_NO, A.ARTICLE_CODE,   
						  A.ARTICLE_NAME, A.ARTICLE_DESC, A.MRP
				FROM ARTICLE A   
				JOIN SECTIOND B ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE   
				WHERE A.ARTICLE_NO <> '''''+   
				(CASE WHEN @CSUBSECTIONCODE <>'' THEN  ' AND A.SUB_SECTION_CODE = ''' + @CSUBSECTIONCODE + '''' ELSE '' END ) +   
				(CASE WHEN @CARTICLENO <>'' THEN ' AND A.ARTICLE_NO LIKE ''' + @CARTICLENO + '%''' ELSE '' END ) +  
				(CASE WHEN @CARTICLENAME <>'' THEN ' AND A.ARTICLE_NAME LIKE ''' + @CARTICLENAME + '%''' ELSE '' END ) +  
				(CASE WHEN @CARTICLEDESC <>'' THEN ' AND A.ARTICLE_DESC LIKE ''' + @CARTICLEDESC + '%''' ELSE '' END ) +  
				(CASE WHEN @CKEYSTR <>'' THEN ' AND A.ARTICLE_CODE IN ( SELECT ARTICLE_CODE FROM ATTR_VALUE   
				WHERE ' + @CKEYSTR + ')' ELSE '' END ) +   
				(CASE WHEN @NMODE <> 0 THEN ' AND B.MFG_CATEGORY = ' + CAST(@NMODE AS VARCHAR(2)) ELSE '' END) +  
				N'ORDER BY B.SUB_SECTION_NAME, A.ARTICLE_NO'  

	--PRINT @CCMD  
	EXEC SP_EXECUTESQL @CCMD    
END  
--*************************************** END OF PROCEDURE SP_WL_ARTICLE_SUMMARY  
