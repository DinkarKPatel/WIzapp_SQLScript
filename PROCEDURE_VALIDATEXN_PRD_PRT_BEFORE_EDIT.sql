CREATE PROC VALIDATEXN_PRD_PRT_BEFORE_EDIT 
@CMEMOID VARCHAR(30),
@BCANCELXN BIT,
@CERRORMSG VARCHAR(200) OUTPUT,
@CEXPRERRORMSG VARCHAR(200) OUTPUT
--WITH ENCRYPTION
AS
BEGIN
	
	DECLARE @CTEXT VARCHAR(10),@CPRODUCTCODE VARCHAR(50)
	
	SELECT @CPRODUCTCODE=''
	
	SET @CTEXT=(CASE WHEN @BCANCELXN=1 THEN 'CANCEL' ELSE 'EDIT' END)
	
	IF EXISTS (SELECT TOP 1 RM_ID FROM PRD_RMM01106 A JOIN VM01106 B ON A.RM_ID=B.BILL_ID
			   WHERE A.RM_ID=@CMEMOID AND B.BILL_TYPE='PRT' AND  B.CANCELLED=0)
	BEGIN	
		SET @CERRORMSG='THIS DEBIT NOTE HAS BEEN POSTED INTO ACCOUNTS.........CAN NOT '+@CTEXT
		RETURN
	END
		
END
