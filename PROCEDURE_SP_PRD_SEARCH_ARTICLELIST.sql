CREATE PROCEDURE SP_PRD_SEARCH_ARTICLELIST
(
	@CJOINS	VARCHAR(MAX), 
	@CWHERE VARCHAR(MAX)
)
AS
BEGIN
	DECLARE @CCMD NVARCHAR(MAX),@ART_SEARCH VARCHAR(2)
	
	
	SELECT TOP 1 @ART_SEARCH=VALUE FROM CONFIG WHERE CONFIG_OPTION='SEARCH_MODE'
    IF ISNULL(@ART_SEARCH,'')='1'
    BEGIN
    	
	SET @CCMD=N' SELECT DISTINCT   * FROM 
				 (	
                    SELECT A.ARTICLE_CODE, A.ARTICLE_NAME, A.ALIAS AS [ARTICLE_NO],   
					B.SUB_SECTION_NAME, C.SECTION_NAME,A.PURCHASE_PRICE AS [RATE]   
					FROM ARTICLE A (NOLOCK)  
					JOIN SECTIOND B (NOLOCK) ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE  
					JOIN SECTIONM C (NOLOCK) ON B.SECTION_CODE = C.SECTION_CODE '+
                   @CJOINS +
                   N'WHERE A.ALIAS <> '''' AND A.INACTIVE=0 AND A.ARTICLE_TYPE=2
                    UNION ALL 
                    SELECT A.ARTICLE_CODE, A.ARTICLE_NAME, A.ARTICLE_NO,   
					B.SUB_SECTION_NAME, C.SECTION_NAME ,A.PURCHASE_PRICE AS [RATE]  
					FROM ARTICLE A (NOLOCK)  
					JOIN SECTIOND B (NOLOCK) ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE  
					JOIN SECTIONM C (NOLOCK) ON B.SECTION_CODE = C.SECTION_CODE ' +
                   @CJOINS +
                   N'WHERE A.ARTICLE_NO <> '''' AND A.INACTIVE=0  AND A.ARTICLE_TYPE=2 
                ) A 
                WHERE A.ARTICLE_NO LIKE ''%'+@CWHERE+'%'' 
                UNION 
                SELECT DISTINCT  TOP 50 * FROM 
				 (	
                    SELECT A.ARTICLE_CODE, A.ARTICLE_NAME, A.ALIAS AS [ARTICLE_NO],   
					B.SUB_SECTION_NAME, C.SECTION_NAME,A.PURCHASE_PRICE AS [RATE]   
					FROM ARTICLE A (NOLOCK)  
					JOIN SECTIOND B (NOLOCK) ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE  
					JOIN SECTIONM C (NOLOCK) ON B.SECTION_CODE = C.SECTION_CODE '+
                   @CJOINS +
                   N'WHERE A.ALIAS <> '''' AND A.INACTIVE=0 AND A.ARTICLE_TYPE=2
                    UNION 
                    SELECT A.ARTICLE_CODE, A.ARTICLE_NAME, A.ARTICLE_NO,   
					B.SUB_SECTION_NAME, C.SECTION_NAME ,A.PURCHASE_PRICE AS [RATE]  
					FROM ARTICLE A (NOLOCK)  
					JOIN SECTIOND B (NOLOCK) ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE  
					JOIN SECTIONM C (NOLOCK) ON B.SECTION_CODE = C.SECTION_CODE ' +
                   @CJOINS +
                   N'WHERE A.ARTICLE_NO <> '''' AND A.INACTIVE=0  AND A.ARTICLE_TYPE=2
                ) A 
                WHERE 
                A.ARTICLE_NO LIKE ''%'+@CWHERE+'%'' 
                OR A.SUB_SECTION_NAME LIKE ''%'+@CWHERE+'%'' 
                OR A.SECTION_NAME LIKE ''%'+@CWHERE+'%'''
	PRINT 	@CCMD
	EXEC SP_EXECUTESQL @CCMD	
  END
  ELSE
  BEGIN
  SET @CCMD=N' SELECT DISTINCT   * FROM 
				 (	
                    
                   SELECT A.ARTICLE_CODE, A.ARTICLE_NAME, A.ALIAS AS [ARTICLE_NO],   
					B.SUB_SECTION_NAME, C.SECTION_NAME,A.PURCHASE_PRICE AS [RATE]   
					FROM ARTICLE A (NOLOCK)  
					JOIN SECTIOND B (NOLOCK) ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE  
					JOIN SECTIONM C (NOLOCK) ON B.SECTION_CODE = C.SECTION_CODE '+
                   @CJOINS +
                   N'WHERE A.ALIAS <> '''' AND A.INACTIVE=0 AND A.ARTICLE_TYPE=2
                    UNION ALL 
                    SELECT A.ARTICLE_CODE, A.ARTICLE_NAME, A.ARTICLE_NO,   
					B.SUB_SECTION_NAME, C.SECTION_NAME ,A.PURCHASE_PRICE AS [RATE]  
					FROM ARTICLE A (NOLOCK)  
					JOIN SECTIOND B (NOLOCK) ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE  
					JOIN SECTIONM C (NOLOCK) ON B.SECTION_CODE = C.SECTION_CODE ' +
                   @CJOINS +
                   N'WHERE A.ARTICLE_NO <> '''' AND A.INACTIVE=0  AND A.ARTICLE_TYPE=2  
                ) A 
                WHERE A.ARTICLE_NO LIKE '''+@CWHERE+'%'''
               
	PRINT 	@CCMD
	EXEC SP_EXECUTESQL @CCMD
  
  END

				
END
