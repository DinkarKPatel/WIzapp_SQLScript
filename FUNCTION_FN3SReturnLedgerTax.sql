CREATE FUNCTION FN3SRETURNLEDGERTAX
(
	 @NPURCHASEAMOUNT NUMERIC(18,4)
	,@NTAXPERCENTAGE NUMERIC(7,3)
	,@NMARKDOWNPER NUMERIC(6,2)
	,@NPREVATDISCOUNT NUMERIC(6,2)
	,@NTAX_METHOD INT=2 --1 FOR EXCLUSIVE 2 FOR INCLUSIVE
)
RETURNS NUMERIC(18,4)
AS
BEGIN

	DECLARE @NTAXAMOUNT NUMERIC(18,4),@NTAXABLEAMOUNT NUMERIC(18,4)
	
	SET @NTAXABLEAMOUNT=@NPURCHASEAMOUNT-(@NPURCHASEAMOUNT*@NMARKDOWNPER)/100
	
	SET @NTAXABLEAMOUNT=@NTAXABLEAMOUNT-(@NTAXABLEAMOUNT*@NPREVATDISCOUNT)/100
	
	SET @NTAXAMOUNT=@NTAXABLEAMOUNT*@NTAXPERCENTAGE/CASE WHEN @NTAX_METHOD =2 THEN 100+@NTAXPERCENTAGE ELSE 100 END
	
	SET @NTAXAMOUNT=ISNULL(@NTAXAMOUNT,0)

	RETURN @NTAXAMOUNT

END