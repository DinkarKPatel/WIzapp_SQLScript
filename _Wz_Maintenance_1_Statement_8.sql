

IF NOT EXISTS (SELECT CONFIG_OPTION FROM CONFIG WHERE CONFIG_OPTION='UPDATE_CMD01106_SCHEMENAME' AND VALUE=1)
BEGIN
	PRINT 'UPDATING SCHEME NAME IN CASH MEMO DETAIL TABLE'
	
	UPDATE CMD01106 SET SCHEME_NAME=B.SCHEME_NAME FROM SCHEME_SETUP_DET B 
	WHERE B.ROW_ID=CMD01106.SLSDET_ROW_ID AND ISNULL(CMD01106.SLSDET_ROW_ID,'')<>''
	 
	UPDATE A SET SCHEME_NAME=C.SCHEME_NAME FROM CMD01106 A
	JOIN CMD_SCHEME_DET B ON A.ROW_ID=B.CMD_ROW_ID
	JOIN SCHEME_SETUP_DET C ON C.ROW_ID=B.SLSDET_ROW_ID
	WHERE ISNULL(A.SCHEME_NAME,'')=''

	IF NOT EXISTS (SELECT CONFIG_OPTION FROM CONFIG WHERE CONFIG_OPTION='UPDATE_CMD01106_SCHEMENAME')
		INSERT CONFIG (CONFIG_OPTION,VALUE,ROW_ID,LAST_UPDATE)
			   VALUES ('UPDATE_CMD01106_SCHEMENAME',1,'',GETDATE())	
	ELSE
		UPDATE CONFIG SET VALUE='1' WHERE CONFIG_OPTION='UPDATE_CMD01106_SCHEMENAME'
	
END		
