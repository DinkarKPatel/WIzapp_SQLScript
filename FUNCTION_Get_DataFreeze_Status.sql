CREATE FUNCTION DBO.GET_DATAFREEZE_STATUS(@USER VARCHAR(100),@XN_TYPE VARCHAR(MAX),@CURR_DT DATE,@MEMO_DT DATE)
RETURNS BIT
AS
BEGIN
--DECLARE @USER VARCHAR(100),@XN_TYPE VARCHAR(MAX),@CURR_DT DATE,@MEMO_DT DATE
--SET @USER='0000000'
--SET @XN_TYPE='FRMVCHENTRY_CASH_ON_HAND'
--SET @CURR_DT='2020-02-08'
--SET @MEMO_DT='2020-02-08'
DECLARE @RETURN BIT=0--UN FREEZED

DECLARE @FREEZE_DT DATE='1900-01-01',@ROLE_DT DATE='1900-01-01',@DAYS INT=0,@FREEZE_DT_ALLXNS DATE='1900-01-01'
DECLARE @TODAY DATE=CONVERT(DATE,GETDATE())

SELECT TOP 1 @FREEZE_DT=ISNULL(FIXEDDATE,'1900-01-01') FROM FIXEDFREEZE (NOLOCK) 
WHERE XN_TYPE=@XN_TYPE AND ISENABLED=1

SELECT TOP 1 @FREEZE_DT_ALLXNS=ISNULL(FIXEDDATE,'1900-01-01') FROM FIXEDFREEZE (NOLOCK) 
WHERE XN_TYPE='ALL_XNS'

IF @FREEZE_DT_ALLXNS>@FREEZE_DT
	SET @FREEZE_DT=@FREEZE_DT_ALLXNS

SELECT TOP 1 @ROLE_DT=ISNULL(DATEADD(DD, -1*(ISNULL(D.FREEZEDAYS,0)+1),@TODAY),'1900-01-01'),
@DAYS=ISNULL(D.FREEZEDAYS,0)+1
FROM ROLLINGFREEZE D (NOLOCK) 
JOIN USERS U (NOLOCK) ON U.ROLE_ID=D.ROLE_ID
WHERE USER_CODE=@USER AND D.XN_TYPE=@XN_TYPE AND ISNULL(D.ROLE_ID,'')<>''

IF @ROLE_DT>@FREEZE_DT
   SET @FREEZE_DT=@ROLE_DT


   
IF YEAR(@ROLE_DT)=1900 AND YEAR(@FREEZE_DT)=1900 AND @DAYS=0 
   SET @RETURN=0
ELSE IF @MEMO_DT<=@FREEZE_DT 
   SET @RETURN=1--FREEZED
ELSE IF @MEMO_DT>=@CURR_DT AND @MEMO_DT<@ROLE_DT 
        SET @RETURN=1--FREEZED
--ELSE IF @MEMO_DT>@CURR_DT 
--        SET @RETURN=1--FREEZED

RETURN CAST(CASE @RETURN WHEN 1 THEN 0 ELSE 1 END AS BIT)

END
