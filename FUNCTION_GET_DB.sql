CREATE FUNCTION DBO.GET_DB(@DT VARCHAR(10)='')  
RETURNS VARCHAR(1000)  
AS  
BEGIN
DECLARE @DATABASE VARCHAR(1000)
SET @DATABASE=CASE WHEN '01'+DBO.FN_GETFINYEAR(@DT)<'01'+CAST(DBO.FN_GETFINYEAR(GETDATE())-1 AS VARCHAR) THEN DB_NAME()+'_'+'01'+DBO.FN_GETFINYEAR(@DT) ELSE DB_NAME() END
IF NOT EXISTS(SELECT * FROM SYS.databases WHERE NAME=@DATABASE)
   SELECT @DATABASE=MIN(NAME) FROM SYS.databases WHERE NAME LIKE DB_NAME()+'%' AND NAME<>DB_NAME() AND ISNUMERIC(RIGHT(NAME,5))=1 AND LEFT(NAME,LEN(NAME)-5)=DB_NAME()+'_'
RETURN @DATABASE   
END
