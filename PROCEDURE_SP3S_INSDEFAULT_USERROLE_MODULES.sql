CREATE PROCEDURE SP3S_INSDEFAULT_USERROLE_MODULES
@CROLEIDPARA CHAR(7)=''	---- NEEDED TO ADD THIS PARAMETER BECAUSE APPN. IS CALLING THIS PROCEDURE WITH BLANK PARAMETER
AS
BEGIN
BEGIN TRY
	
	IF NOT EXISTS ( SELECT ROLE_ID FROM USER_ROLE_MST WHERE ROLE_ID = '0000000' )
	BEGIN
		INSERT USER_ROLE_MST ( ROLE_ID,ROLE_NAME )
		VALUES ('0000000', 'ADMIN')
	END


	DECLARE @NSTEP INT,@CERRORMSG VARCHAR(MAX)
	
	SET @NSTEP = 10
	
	BEGIN TRAN
	
	SET @CERRORMSG = ''
	
	SET @NSTEP = 20
	
    INSERT USER_ROLE_DET	( ROLE_ID, FORM_NAME, FORM_OPTION, VALUE, ROW_ID, LAST_UPDATE, GROUP_NAME, S_NO,
    DISPLAY_FORM_NAME, DISPLAY_NAME)  
    SELECT DISTINCT '0000000' AS ROLE_ID, FORM_NAME, FORM_OPTION, VALUE, NEWID() AS ROW_ID,GETDATE() AS LAST_UPDATE,
    GROUP_NAME,0 AS S_NO, DISPLAY_FORM_NAME,DISPLAY_NAME FROM MODULES  
    WHERE USER_CODE='0000000' AND FORM_NAME+FORM_OPTION+GROUP_NAME NOT IN 
    (SELECT FORM_NAME+FORM_OPTION+GROUP_NAME FROM USER_ROLE_DET WHERE ROLE_ID='0000000')
	
	GOTO END_PROC
END TRY
	
BEGIN CATCH
	SET @CERRORMSG = 'STEP- ' + LTRIM(STR(@NSTEP)) + ' SQL ERROR: #' + LTRIM(STR(ERROR_NUMBER())) + ' ' + ERROR_MESSAGE()  
	GOTO END_PROC
END CATCH

END_PROC:
	
	IF @@TRANCOUNT>0
	BEGIN
		IF ISNULL(@CERRORMSG,'')=''
			COMMIT
		ELSE
			ROLLBACK	
	END
	
	SELECT ISNULL(@CERRORMSG,'') AS ERRMSG
END
--END OF PROCEDURE - SP3S_INSDEFAULT_USERROLE_MODULES
