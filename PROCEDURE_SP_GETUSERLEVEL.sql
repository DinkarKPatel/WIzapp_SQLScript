CREATE PROCEDURE SP_GETUSERLEVEL
AS
BEGIN
	
	 SELECT CHK=CAST(CASE WHEN C.LEVEL_NO IS NULL THEN 0 ELSE 1 END AS BIT),   A.USER_CODE,
             A.USERNAME ,B.XN_TYPE,B.LEVEL_DESC,B.LEVEL_CODE,B.LEVEL_NO ,
             (CAST(B.LEVEL_NO  AS VARCHAR(5))+'. '+LEVEL_DESC ) AS LEVEL_NO_DESC
             
	 FROM 
		  ( SELECT 1 AS SR, A.USER_CODE,A.USERNAME  
			FROM USERS A (NOLOCK)) A
	  JOIN
		  (
			SELECT SR=1,A.* FROM 
			XN_APPROVAL_CHECKLIST_LEVELS A
		  ) B ON A.SR=B.SR
	 LEFT JOIN XN_APPROVAL_CHECKLIST_LEVEL_USERS C ON C.USER_CODE =A.USER_CODE AND C.XN_TYPE =B.XN_TYPE AND C.LEVEL_NO=B.LEVEL_NO 
	 ORDER BY A.USER_CODE,B.LEVEL_NO
END
