CREATE PROCEDURE SP_ITEMSEARCH              
@NQUERYID NUMERIC(3,0),                    
@CMEMO VARCHAR(50)='',            
@CFINYEAR VARCHAR(5) ,            
@CWHERE VARCHAR(50)='',            
@NNAVMODE NUMERIC(1,0)            
          
AS                    
BEGIN                    
----- PROCEDURE TO STORE GRID SETTINGS OF EACH LOCATION            
           
DECLARE @CPARA1 VARCHAR(50),@CPARA2 VARCHAR(50),@CPARA3 VARCHAR(50),@CPARA4 VARCHAR(50),            
@CPARA5 VARCHAR(50),@CPARA6 VARCHAR(50)            
                      
 IF @NQUERYID=3                
   GOTO LBLDETAIL           
ELSE               
 GOTO LAST              
                                  
LBLDETAIL:                
           
SELECT @CPARA1= VALUE FROM CONFIG WHERE CONFIG_OPTION= 'PARA1'            
SELECT @CPARA2= VALUE FROM CONFIG WHERE CONFIG_OPTION= 'PARA2'            
SELECT @CPARA3= VALUE FROM CONFIG WHERE CONFIG_OPTION= 'PARA3'            
SELECT @CPARA4= VALUE FROM CONFIG WHERE CONFIG_OPTION= 'PARA4'            
SELECT @CPARA5= VALUE FROM CONFIG WHERE CONFIG_OPTION= 'PARA5'            
SELECT @CPARA6= VALUE FROM CONFIG WHERE CONFIG_OPTION= 'PARA6'            
     
  
  IF OBJECT_ID ('TEMPDB..#TMPMASTER','U') IS NOT NULL    
   DROP TABLE #TMPMASTER    
       
SELECT A.CALL_HEADER,A.CALL_EXP,            
      A.TABLENAME ,SHOW_ORDER    
INTO #TMPMASTER        
FROM             
(            
            
SELECT    'SECTION NAME' AS CALL_HEADER,'SECTION_NAME' AS CALL_EXP, 'SECTIONM' AS TABLENAME ,1 AS SHOW_ORDER                
UNION ALL                
SELECT 'SUB SECTION NAME' AS CALL_HEADER,'SUB_SECTION_NAME' AS CALL_EXP, 'SECTIOND' AS TABLENAME ,2 AS SHOW_ORDER                
UNION ALL                
SELECT 'ARTICLE NO.' AS CALL_HEADER,'ARTICLE_NO' AS CALL_EXP, 'ARTICLE' AS TABLENAME ,3 AS SHOW_ORDER                
UNION ALL                
SELECT 'ITEM CODE' AS CALL_HEADER,'PRODUCT_CODE' AS CALL_EXP, 'SKU' AS TABLENAME ,4 AS SHOW_ORDER                
UNION ALL           
SELECT 'ONLINE ITEM CODE' AS CALL_HEADER,'ONLINE_PRODUCT_CODE' AS CALL_EXP, 'SKU' AS TABLENAME ,5 AS SHOW_ORDER                
UNION ALL               
SELECT 'UOM' AS CALL_HEADER,'UOM_NAME' AS CALL_EXP, 'UOM' AS TABLENAME ,6 AS SHOW_ORDER                
UNION ALL                
SELECT @CPARA1 AS CALL_HEADER,'PARA1_NAME' AS CALL_EXP, 'PARA1' AS TABLENAME ,7 AS SHOW_ORDER                
UNION ALL                 
SELECT @CPARA2 AS CALL_HEADER,'PARA2_NAME' AS CALL_EXP, 'PARA2' AS TABLENAME ,8 AS SHOW_ORDER                
UNION ALL                 
SELECT @CPARA3 AS CALL_HEADER,'PARA3_NAME' AS CALL_EXP, 'PARA3' AS TABLENAME ,9 AS SHOW_ORDER                
UNION ALL                 
SELECT @CPARA4 AS CALL_HEADER,'PARA4_NAME' AS CALL_EXP, 'PARA4' AS TABLENAME ,10 AS SHOW_ORDER                
UNION ALL                 
SELECT  @CPARA5 AS CALL_HEADER,'PARA5_NAME' AS CALL_EXP, 'PARA5' AS TABLENAME ,11 AS SHOW_ORDER                
UNION ALL                 
SELECT @CPARA6 AS CALL_HEADER,'PARA6_NAME' AS CALL_EXP, 'PARA6' AS TABLENAME ,12 AS SHOW_ORDER                
UNION ALL                 
SELECT 'MRP' AS CALL_HEADER,'MRP' AS CALL_EXP, 'SKU' AS TABLENAME ,13 AS SHOW_ORDER                
  
UNION ALL                
SELECT 'INV DT' AS CALL_HEADER,'INV_DT' AS CALL_EXP, 'SKU' AS TABLENAME ,14 AS SHOW_ORDER  
          
) A
          
  SELECT A.*, 
  CASE WHEN @CMEMO=ISNULL(B.ITEMSEARCH_ID,'')  THEN 0 ELSE 1 END AS CHK,           
  ISNULL(B.SHOW_ORDER,A.SHOW_ORDER ) AS SHOW_ORDER ,     
   CASE WHEN @CMEMO=ISNULL(B.ITEMSEARCH_ID,'')  THEN '' ELSE B.ITEMSEARCH_ID END AS ITEMSEARCH_ID,    
   CONVERT(VARCHAR(40),NEWID()) AS ROW_ID,GETDATE() AS LAST_UPDATE     
 FROM #TMPMASTER A    
 LEFT OUTER JOIN ITEMSEARCH_COL_DET B ON A.CALL_EXP = B.CALL_EXP  
      
               
GOTO LAST          
                               
LAST:                      
END
