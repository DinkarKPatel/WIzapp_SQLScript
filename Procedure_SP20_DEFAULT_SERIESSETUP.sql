
CREATE PROCEDURE SP20_DEFAULT_SERIESSETUP
(
 @cdept_id varchar(5)=''
)
AS
BEGIN
      
	 DECLARE @CLOCID VARCHAR(5),@CHODEPT_ID VARCHAR(5)

	 SELECT @CLOCID=VALUE  FROM config WHERE config_option ='LOCATION_ID'
	 SELECT @CHODEPT_ID=VALUE  FROM config WHERE config_option ='LOCATION_ID'

	 IF ISNULL(@CHODEPT_ID,'')<>@CLOCID
	 RETURN

	  IF EXISTS (SELECT TOP 1 'U' FROM SERIES_SETUP_MST WHERE DEPT_ID=@CDEPT_ID)
	  RETURN

	;WITH CTEXNTYPE AS
	(
  
	   	SELECT CAST('PO' AS VARCHAR(50)) AS XN_TYPE,CAST(0 AS INT) AS SINGLEENTRY UNION ALL
		SELECT CAST('PUR' AS VARCHAR(50)) AS XN_TYPE,CAST(0 AS INT) UNION ALL
		SELECT CAST('PUR_GRP' AS VARCHAR(50)) AS XN_TYPE,CAST(0 AS INT) UNION ALL
		SELECT CAST('PUR_GRP_FR' AS VARCHAR(50)) AS XN_TYPE,CAST(0 AS INT) UNION ALL
		SELECT CAST('PRT' AS VARCHAR(50)) AS XN_TYPE,CAST(0 AS INT) UNION ALL
		SELECT CAST('PRT_GRP' AS VARCHAR(50)) AS XN_TYPE,CAST(0 AS INT) UNION ALL
		SELECT CAST('PRT_GRP_FR' AS VARCHAR(50)) AS XN_TYPE,CAST(0 AS INT) UNION ALL
		SELECT CAST('WSL' AS VARCHAR(50)) AS XN_TYPE,CAST(0 AS INT) UNION ALL
		SELECT CAST('WSL_GRP' AS VARCHAR(50)) AS XN_TYPE,CAST(0 AS INT) UNION ALL
		SELECT CAST('WSL_GRP_FR' AS VARCHAR(50)) AS XN_TYPE,CAST(0 AS INT) UNION ALL
		SELECT CAST('WSR' AS VARCHAR(50)) AS XN_TYPE,CAST(0 AS INT) UNION ALL
		SELECT CAST('WSR_GRP' AS VARCHAR(50)) AS XN_TYPE,CAST(0 AS INT) UNION ALL
		SELECT CAST('WSR_GRP_FR' AS VARCHAR(50)) AS XN_TYPE,CAST(0 AS INT) UNION ALL
		SELECT CAST('FDN' AS VARCHAR(50)) AS XN_TYPE,CAST(0 AS INT) UNION ALL

		SELECT CAST('ASN' AS VARCHAR(50)) AS XN_TYPE,CAST(1 AS INT) UNION ALL
		SELECT CAST('JWI' AS VARCHAR(50)) AS XN_TYPE,CAST(1 AS INT) UNION ALL
		SELECT CAST('JWR' AS VARCHAR(50)) AS XN_TYPE,CAST(1 AS INT) UNION ALL
		SELECT CAST('MIS' AS VARCHAR(50)) AS XN_TYPE ,CAST(1 AS INT)
	
	)

, CTEITEMTYPE AS
(
  SELECT CAST(1 AS INT) AS XN_ITEMTYPE UNION ALL
  SELECT CAST(2 AS INT) AS XN_ITEMTYPE UNION ALL
  SELECT CAST(3 AS INT) AS XN_ITEMTYPE UNION ALL
  SELECT CAST(4 AS INT) AS XN_ITEMTYPE 
)
 INSERT series_setup_mst	( cgst_fr_xn_prefix, cgst_xn_prefix, delivery_challan_prefix, DEPT_ID, igst_fr_xn_prefix, igst_xn_prefix, memo_id, Prefix_applicable, Prefix_destination_locid, Prefix_finyear, Prefix_user_alias, SERIES_SETUP_MODE, start_from, XN_ITEM_TYPE, XN_TYPE ) 
	 SELECT 	''  cgst_fr_xn_prefix,'' cgst_xn_prefix,'' delivery_challan_prefix,@cdept_id DEPT_ID,'' igst_fr_xn_prefix,'' igst_xn_prefix,newid() memo_id,0 Prefix_applicable,0 Prefix_destination_locid, 
	 '' Prefix_finyear,'' Prefix_user_alias,2 SERIES_SETUP_MODE,0 start_from,CTEITEMTYPE.XN_ITEMTYPE XN_ITEM_TYPE,CTEXNTYPE.xn_type XN_TYPE 
 
	from CTEXNTYPE,CTEITEMTYPE
	WHERE CTEXNTYPE.SINGLEENTRY=0
	UNION ALL
	SELECT ''  cgst_fr_xn_prefix,'' cgst_xn_prefix,'' delivery_challan_prefix,@cdept_id DEPT_ID,'' igst_fr_xn_prefix,'' igst_xn_prefix,newid() memo_id,0 Prefix_applicable,0 Prefix_destination_locid, 
	 '' Prefix_finyear,'' Prefix_user_alias,2 SERIES_SETUP_MODE,0 start_from,CTEITEMTYPE.XN_ITEMTYPE XN_ITEM_TYPE,CTEXNTYPE.xn_type XN_TYPE 
	from CTEXNTYPE,CTEITEMTYPE
	WHERE CTEXNTYPE.SINGLEENTRY=1
	and CTEITEMTYPE.XN_ITEMTYPE=1



END

