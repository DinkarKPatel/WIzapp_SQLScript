CREATE VIEW VW_SALARY
--WITH ENCRYPTION
AS  
SELECT A.EMP_ID, A.EMP_FNAME + ' ' + A.EMP_LNAME AS EMP_NAME,
	   A.BASIC_SALARY,  B.TOTAL_DEDUCTIONS , B.TOTAL_EARNINGS,
	   ((A.BASIC_SALARY + B.TOTAL_EARNINGS )- B.TOTAL_DEDUCTIONS ) AS NET_SALARY,
	   (A.BASIC_SALARY + B.TOTAL_EARNINGS )AS NET_SALARY_WITHOUT_DEDUCTIONS	   
FROM EMP_MST A
JOIN (
		SELECT A.EMP_ID, 
				SUM(CASE WHEN PAY_TYPE=1 THEN AMOUNT END ) AS TOTAL_DEDUCTIONS,
				SUM(CASE WHEN PAY_TYPE=2 THEN AMOUNT END ) AS TOTAL_EARNINGS
		FROM EMP_SALARY_PROFILE A
		JOIN EMP_PAY B ON A.PAY_ID = B.PAY_ID 
		GROUP BY EMP_ID
	)B ON A.EMP_ID = B.EMP_ID
