create PROCEDURE SP_PO_PRINT
@CMEMO_ID VARCHAR(100),
@CTEMPTABLE VARCHAR(100)=''
AS
BEGIN

--(dinkar) Replace  left(memoid,2) to Location_code 
      IF OBJECT_ID('TEMPBD.#TMPPOPRINT','U') IS NOT NULL
         DROP TABLE  TEMPBD.#TMPPOPRINT
		SELECT               
		A.CHECKED_BY AS MST_CHECKED_BY,      
		A.DELIVERY_DT AS MST_DELIVERY_TO_DT,      
		A.DISCOUNT_AMOUNT AS MST_DISCOUNT_AMOUNT,      
		A.DISCOUNT_PERCENTAGE AS MST_DISCOUNT_PERCENTAGE,      
		A.FREIGHT AS MST_FREIGHT,      
		A.OTHER_CHARGES AS MST_OTHER_CHARGES,      
		A.PO_DT AS MST_XN_DT,      
		A.PO_ID,      
		A.PO_NO AS MST_PO_NO,      
		A.REMARKS AS MST_REMARKS,      
		A.ROUND_OFF AS MST_ROUND_OFF,      
		A.SUBTOTAL AS MST_SUBTOTAL,      
		D.TAX_AMOUNT AS MST_TAX_AMOUNT,      
		D.TAX_PERCENTAGE AS MST_TAX_PERCENTAGE,      
		A.TOTAL_AMOUNT AS MST_TOTAL_AMOUNT,      
		A.FIN_YEAR AS MST_FIN_YEAR,      
		B.PRINT_NAME,  
		B.ADDRESS0,  
		B.ADDRESS1,  
		B.ADDRESS2,  
		B.AREA_NAME,  
		B.PINCODE,  
		B.CITY,  
		B.STATE,  
		B.CST_NO,  
		B.CST_DT,  
		B.SST_NO,  
		B.SST_DT,  
		B.TIN_NO,  
		B.TIN_DT,  
		B.PHONES_R,  
		B.PHONES_O,  
		B.PHONES_FAX,  
		B.MOBILE,  
		B.E_MAIL,  
		B.TAX_CODE,  
		B.CREDIT_LIMIT,  
		B.PAN_NO,  
		B.GLN_NO,  
		C.USERNAME AS MST_CREATED_USERNAME,      
		C.USERNAME AS MST_USERNAME,      
		P1.PARA1_NAME,      
		P2.PARA2_NAME,      
		P3.PARA3_NAME,      
		P4.PARA4_NAME,      
		P5.PARA5_NAME,      
		P6.PARA6_NAME,      
		E.ARTICLE_NO,      
		D.AMOUNT,      
		D.MP_PERCENTAGE,      
		D.MRP,      
		D.PRODUCT_CODE,      
		D.PURCHASE_PRICE,      
		D.QUANTITY,      
		D.WHOLESALE_PRICE,      
		D.WD_PERCENTAGE,   
		U.UOM_NAME     
		,A.PO_NO  
		,A.PO_DT  
		,A.AC_CODE  
		,A.TOTAL_AMOUNT  
		,A.REMARKS  
		,A.LAST_UPDATE  
		,A.TS  
		,A.SUBTOTAL  
		,D.DISCOUNT_PERCENTAGE AS DISCOUNT_PERCENTAGE  
		,D.DISCOUNT_AMOUNT AS DISCOUNT_AMOUNT  
		,A.OTHER_CHARGES  
		,A.CANCELLED  
		,A.REF_NO  
		,A.REF_NO AS MST_REF_NO  
		,A.COMPANY_CODE  
		,A.USER_CODE  
		,A.SENT_TO_HO  
		,A.FIN_YEAR  
		,A.DELIVERY_DT  
		,A.DEPT_ID
		,A.MEMO_PREFIX AS MST_MEMO_PREFIX  
		,A.CHECKED_BY  
		,A.SENT_BY  
		,A.BILL_LEVEL_TAX_METHOD AS MST_BILL_LEVEL_TAX_METHOD
		,A.PUR_CAL_METHOD AS MST_PUR_CAL_METHOD
		,A.SENT  
		,A.TAX_PERCENTAGE  
		,A.FREIGHT  
		,A.ROUND_OFF  
		,A.TAX_AMOUNT  
		,A.EDT_USER_CODE  
		,A.PO_TIME  
		,A.APPROVED  
		,A.CREDIT_DAYS  
		,A.FREIGHT_MODE  
		,A.DELIVERY_MODE  
		,A.FORM_ID 
		,A.MODE  
		,A.MODE  AS MST_MODE
		,A.CREDIT_DAYS AS MST_CREDIT_DAYS
		,A.TAXFORM_STORAGE_MODE AS MST_TAXFORM_STORAGE_MODE
		,A.CANCELLED_ON  
		,A.UPLOADED_TO_ACTIVSTREAM  
		,B.TDS_CODE  
		,B.INACTIVE  
		,B.AC_NAME  
		,B.AC_NAME AS MST_AC_NAME  
		,B.ALIAS  
		,B.HEAD_CODE  
		,B.CLOSING_BALANCE  
		,B.CLOSING_BALANCE_CR_DR  
		,B.PRINT_LEDGER  
		,C.USERNAME  
		,C.MAJOR_USER_CODE  
		,C.USER_ALIAS  
		,C.DISCOUNT_PERCENTAGE_LEVEL  
		,C.VIEW_DATA_AFTER_DFM  
		,D.ARTICLE_CODE AS ARTICLECODE  
		,D.PARA1_CODE  
		,D.PARA2_CODE  
		,D.ROW_ID  
		,D.PARA3_CODE  
		,D.SRNO  
		,D.PRINT_LABEL  
		,D.PARA4_CODE  
		,D.PARA5_CODE  
		,D.PARA6_CODE  
		,D.WSP_PERCENTAGE  
		,D.ADJ_QUANTITY  
		,D.INVOICE_QUANTITY  
		,D.SCHEME_QUANTITY  
		,P1.PARA1_ORDER  
		,P1.PARA1_SET  
		,P2.PARA2_ORDER  
		,P2.PARA2_SET  
		,P3.DT_CREATED  
		,E.CODING_SCHEME  
		,E.UOM_CODE  
		,E.SKU_CODE  
		,E.ARTICLE_NAME  
		,E.ARTICLE_DESC  
		,E.SUB_SECTION_CODE  
		,E.DISCON  
		,SKU.FIX_MRP AS MIN_PRICE  
		,E.STOCK_NA  
		,E.ARTICLE_TYPE  
		,E.CREATED_ON  
		,E.ARTICLE_GROUP_CODE  
		,E.GENERATE_BARCODES_WITHARTICLE_PREFIX  
		,E.ARTICLE_GEN_MODE  
		,E.ARTICLE_PRD_MODE  
		,E.ARTICLE_SET_CODE  
		,E.OH_PERCENTAGE  
		,E.OH_AMOUNT  
		,U.UOM_TYPE  
		,CMP.WORKABLE  
		,CMP.PIN  
		,CMP.LOGO_PATH  
		,CMP.WEB_ADDRESS  
		,CMP.SSPL_FIRST_HDSR  
		,CMP.POLICY_NO  
		,CMP.PAN_NO AS COMPANY_PAN_NO  
		,CMP.EMAIL_ID AS COMPANY_EMAIL_ID  
		,CMP.COUNTRY AS COMPANY_COUNTRY  
		,CMP.MOBILE AS COMPANY_MOBILE  
		,CMP.CONTACT_NAME AS COMPANY_CONTACT_NAME  
		,CMP.TDS_AC_NO AS COMPANY_TDS_AC_NO  
		,CMP.COMPANY_NAME  
		,CMP.ALIAS AS COMPANY_ALIAS  
		,CMP.ADDRESS1 AS COMPANY_ADDRESS1  
		,CMP.ADDRESS2 AS COMPANY_ADDRESS2  
		,CMP.PHONES_FAX AS COMPANY_PHONES_FAX  
		,CMP.CST_NO AS COMPANY_CST_NO  
		,CMP.CST_DT AS COMPANY_CST_DT  
		,CMP.SST_NO AS COMPANY_SST_NO  
		,CMP.SST_DT AS COMPANY_SST_DT  
		,CMP.GRP_CODE AS COMPANY_GRP_CODE  
		,CMP.ADDRESS9 AS COMPANY_ADDRESS9  
		,CA.AREA_NAME AS COMPANY_AREA  
		,CC.CITY AS COMPANY_CITY  
		,CS.STATE AS COMPANY_STATE  
		,CRG.REGION_NAME AS COMPANY_REGION  
		,LCT.DEPT_ID AS LOCATION_DEPT_ID  
		,LCT.DEPT_NAME AS LOCATION_DEPT_NAME  
		,LCT.MAJOR_DEPT_ID AS LOCATION_MAJOR_DEPT_ID  
		,LCT.AREA_CODE AS LOCATION_AREA_CODE  
		,LCT.PRIMARY_EMAIL AS LOCATION_PRIMARY_EMAIL  
		,LCT.PRIMARY_EMAIL_SMTP AS LOCATION_PRIMARY_EMAIL_SMTP  
		,LCT.PRIMARY_EMAIL_PWD AS LOCATION_PRIMARY_EMAIL_PWD  
		,LCT.PRIMARY_EMAIL_SSL AS LOCATION_PRIMARY_EMAIL_SSL  
		,LCT.SSPL_GRP_CODE AS LOCATION_SSPL_GRP_CODE  
		,LCT.PUR_LOC AS LOCATION_PUR_LOC  
		,LCT.ADDRESS1 AS LOCATION_ADDRESS1  
		,LCT.ADDRESS2 AS LOCATION_ADDRESS2  
		,LCT.DEPT_AC_CODE AS LOCATION_DEPT_AC_CODE  
		,LCT.CST_NO AS LOCATION_CST_NO  
		,LCT.CST_DT AS LOCATION_CST_DT  
		,LCT.LST_NO AS LOCATION_LST_NO  
		,LCT.LST_DT AS LOCATION_LST_DT  
		,LCT.DEPT_ALIAS AS LOCATION_DEPT_ALIAS  
		,LCT.PHONE AS LOCATION_PHONE  
		,LCT.DATE_OF_OPENING AS LOCATION_DATE_OF_OPENING  
		,LCT.REPORT_BLOCKED AS LOCATION_REPORT_BLOCKED  
		,LCT.INACTIVE AS LOCATION_INACTIVE  
		,LCT.LOC_TYPE AS LOCATION_LOC_TYPE  
		,LCT.ACCOUNTS_POSTING_DEPT_ID AS LOCATION_ACCOUNTS_POSTING_DEPT_ID  
		,LCT.CONTROL_AC_CODE AS LOCATION_CONTROL_AC_CODE  
		,LCT.UPD_PURINFO AS LOCATION_UPD_PURINFO  
		,LCT.SSPL_REG_KEY AS LOCATION_SSPL_REG_KEY  
		,LCT.WIZCOM_ENABLED AS LOCATION_WIZCOM_ENABLED  
		,LCT.EXCISABLE AS LOCATION_EXCISABLE  
		,LCT.TIN_NO AS LOCATION_TIN_NO  
		,LCT.FR_TYPE AS LOCATION_FR_TYPE  
		,LCT.PRIMARY_EMAIL_PORT AS LOCATION_PRIMARY_EMAIL_PORT  
		,LA.AREA_NAME AS LOCATION_AREA  
		,LC.CITY AS LOCATION_CITY  
		,LS.STATE AS LOCATION_STATE  
		,LRG.REGION_NAME AS LOCATION_REGION  
		,HD.HEAD_NAME  
		,HD.MAJOR_HEAD_CODE  
		,HD.PHYSICAL  
		,HD.PRINT_HEAD  
		,HD.CREDITOR_DEBTOR_CODE  
		,SD.SECTION_CODE  
		,SD.SUB_SECTION_NAME  
		,SD.MFG_CATEGORY  
		,SM.SECTION_NAME,SKU.PRODUCT_NAME,  
		D.GROSS_PURCHASE_PRICE ,   
		ISNULL(D.MD_PERCENTAGE ,0) AS MD_PERCENTAGE,D.FIX_MRP, D.SLS_QTY,  
		D.CBS_QTY  
		,(CASE WHEN ISNULL(D.MBQ_QTY,0) = 0 THEN ISNULL(MBQ.MBQ,0) ELSE ISNULL(D.MBQ_QTY,0) END) AS MBQ_QTY   
		,F.FORM_NAME AS MST_FORM_NAME,
		D.WOD_ROW_ID 
		,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
		AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
		AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
		AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
		AT25.ATTR25_KEY_NAME ,D.article_code ,CAST('' AS VARCHAR(MAX)) AS MEASURMENT_VALUE

		INTO #TMPPOPRINT
		FROM POM01106 A      
		JOIN LMV01106 B (NOLOCK) ON A.AC_CODE = B.AC_CODE      
		JOIN USERS C (NOLOCK) ON A.USER_CODE = C.USER_CODE      
		JOIN POD01106 D (NOLOCK) ON A.PO_ID = D.PO_ID      
		JOIN PARA1 P1 (NOLOCK) ON D.PARA1_CODE = P1.PARA1_CODE      
		JOIN PARA2 P2 (NOLOCK) ON D.PARA2_CODE = P2.PARA2_CODE      
		JOIN PARA3 P3 (NOLOCK) ON D.PARA3_CODE = P3.PARA3_CODE      
		JOIN PARA4 P4 (NOLOCK) ON D.PARA4_CODE = P4.PARA4_CODE      
		JOIN PARA5 P5 (NOLOCK) ON D.PARA5_CODE = P5.PARA5_CODE      
		JOIN PARA6 P6 (NOLOCK) ON D.PARA6_CODE = P6.PARA6_CODE      
		JOIN ARTICLE E (NOLOCK) ON D.ARTICLE_CODE = E.ARTICLE_CODE 
		LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON E.ARTICLE_CODE = ATTR.ARTICLE_CODE 
		LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
		LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
		LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
		LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
		LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
		LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
		LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
		LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
		LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
		LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
		LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
		LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
		LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
		LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
		LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
		LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
		LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
		LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
		LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
		LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
		LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
		LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
		LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
		LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
		LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE
		JOIN UOM U (NOLOCK) ON E.UOM_CODE = U.UOM_CODE    
		LEFT OUTER JOIN SKU (NOLOCK)  ON SKU.PRODUCT_CODE = D.PRODUCT_CODE  
		JOIN COMPANY CMP ON A.COMPANY_CODE=CMP.COMPANY_CODE  
		JOIN AREA CA ON CMP.AREA_CODE=CA.AREA_CODE  
		JOIN CITY CC ON CA.CITY_CODE=CC.CITY_CODE  
		JOIN STATE CS ON CC.CITY_CODE=CS.STATE_CODE  
		JOIN REGIONM CRG ON CS.REGION_CODE=CRG.REGION_CODE  
		JOIN LOCATION LCT ON A.DEPT_ID=LCT.DEPT_ID  
		JOIN AREA LA ON LCT.AREA_CODE=LA.AREA_CODE  
		JOIN CITY LC ON LA.CITY_CODE=LC.CITY_CODE  
		JOIN STATE LS ON LC.STATE_CODE=LS.STATE_CODE  
		JOIN REGIONM LRG ON LS.REGION_CODE=LRG.REGION_CODE  
		JOIN HD01106 HD ON B.HEAD_CODE=HD.HEAD_CODE  
		JOIN SECTIOND SD ON E.SUB_SECTION_CODE=SD.SUB_SECTION_CODE  
		JOIN SECTIONM SM ON SD.SECTION_CODE=SM.SECTION_CODE  
		LEFT OUTER JOIN FORM F (NOLOCK) ON F.FORM_ID = D.FORM_ID   
		LEFT OUTER JOIN MBQ_DET MBQ ON MBQ.PRODUCT_CODE = D.PRODUCT_CODE       
		AND MBQ.MONTH= DATEPART(MONTH ,A.PO_DT) AND MBQ.YEAR= DATEPART(YEAR ,A.PO_DT)  
		--AND MBQ.DEPT_ID = SUBSTRING(A.PO_ID,0,3) 
		WHERE A.PO_ID =@CMEMO_ID



		
		IF OBJECT_ID ('TEMPDB..#TMPMEASUREMENT','U') IS NOT NULL
		   DROP TABLE #TMPMEASUREMENT

		  SELECT A.ROW_ID, D.M_NAME+'-'+B.MEASURMENT AS MEASURMENT_NAME ,B.MEASURMENT ,B.PREV_MEASURE, B.TMD_ROW_ID,D.M_CODE AS ATTRIBUTE_CODE  
		  INTO #TMPMEASUREMENT
		   FROM WSL_ORDER_DET (NOLOCK) A  
		   join #TMPPOPRINT tmp on A.row_id =tmp.wod_row_id 
		   JOIN TDD01106 (NOLOCK) B ON B.TMD_ROW_ID = A.ROW_ID
		   JOIN MEASUREMENT_MST (NOLOCK) D ON B.ATTRIBUTE_CODE=D.M_CODE
		   WHERE D.INACTIVE = 0  

		  update t3 set MEASURMENT_VALUE =mv.MEASURMENT_VALUE from  #TMPPOPRINT T3
		  LEFT OUTER JOIN 
		  (
  
			SELECT 	A.ROW_ID ,
			 MEASURMENT_VALUE=(SELECT STUFF((SELECT CASE WHEN ISNULL(MEASURMENT_NAME,'') <> '' THEN ' , ' ELSE '' END +MEASURMENT_NAME FROM #TMPMEASUREMENT  B  WHERE A.ROW_ID  =B.ROW_ID 
			 GROUP BY MEASURMENT_NAME  FOR XML PATH('')),1,2,''))  					 
			FROM #TMPMEASUREMENT A
			GROUP BY A.ROW_ID


		  ) MV ON MV.ROW_ID =T3.wod_row_id 
		

        
         IF CURSOR_STATUS('GLOBAL','CUR_MEASUREMENT') IN (0,1)  
		    BEGIN  
			CLOSE CUR_MEASUREMENT  
		    DEALLOCATE CUR_MEASUREMENT  
		    END
        
		DECLARE @ARTICLE_CODE VARCHAR(100)
		DECLARE @COLUMN_NAME VARCHAR(100),@COLUMN_ALIAS VARCHAR(100)
		DECLARE @CCMD NVARCHAR(MAX)


			 DECLARE CUR_MEASUREMENT CURSOR FOR 
			  SELECT MM.M_NAME,MM.M_ALIAS
					FROM MEASUREMENT_MST (NOLOCK) MM 
			  GROUP BY MM.M_NAME,MM.M_ALIAS
			OPEN CUR_MEASUREMENT

			FETCH NEXT FROM CUR_MEASUREMENT INTO  @COLUMN_NAME,@COLUMN_ALIAS
			WHILE @@FETCH_STATUS =0
			BEGIN
		    
		   SET @CCMD=N'ALTER TABLE #TMPPOPRINT ADD ['+@COLUMN_NAME+'] VARCHAR(100)'
		   PRINT @CCMD
		   EXEC SP_EXECUTESQL @CCMD
		   
		   
		   IF @COLUMN_NAME=@COLUMN_ALIAS
		   SET @COLUMN_ALIAS=@COLUMN_ALIAS+'_1'
		   
		  IF  ISNULL(@COLUMN_ALIAS,'')<>''
		   BEGIN
		     SET @CCMD=N'ALTER TABLE #TMPPOPRINT ADD ['+@COLUMN_ALIAS+'] VARCHAR(100)'
		     PRINT @CCMD
		     EXEC SP_EXECUTESQL @CCMD
		   END
		   
		       SET @CCMD=N'UPDATE #TMPPOPRINT SET ['+@COLUMN_NAME+']=TDD.MEASURMENT   
				FROM #TMPPOPRINT T
				LEFT JOIN 
				(SELECT TMD_ROW_ID,MEASURMENT,ATTRIBUTE_CODE FROM TDD01106 ) TDD ON TDD.TMD_ROW_ID =T.WOD_ROW_ID 
				JOIN ARTICLE_MEASUREMENTS AM (NOLOCK) ON AM.ARTICLE_CODE =T.ARTICLE_CODE AND AM.M_CODE=TDD.ATTRIBUTE_CODE 
				JOIN MEASUREMENT_MST (NOLOCK) MM ON MM.M_CODE =AM.M_CODE  WHERE
				 M_NAME='''+@COLUMN_NAME+''''
		    
			PRINT @CCMD
		    EXEC SP_EXECUTESQL @CCMD
		    
		     IF  ISNULL(@COLUMN_ALIAS,'')<>''
		     BEGIN
			     SET @CCMD=N'UPDATE #TMPPOPRINT SET ['+@COLUMN_ALIAS+']=TDD.MEASURMENT   
				FROM #TMPPOPRINT T
				LEFT JOIN 
				(SELECT TMD_ROW_ID,MEASURMENT,ATTRIBUTE_CODE FROM TDD01106 ) TDD ON TDD.TMD_ROW_ID =T.ROW_ID 
				JOIN ARTICLE_MEASUREMENTS AM (NOLOCK) ON AM.ARTICLE_CODE =T.ARTICLE_CODE AND AM.M_CODE=TDD.ATTRIBUTE_CODE 
				JOIN MEASUREMENT_MST (NOLOCK) MM ON MM.M_CODE =AM.M_CODE  WHERE  M_ALIAS='''+@COLUMN_ALIAS+''''
				PRINT @CCMD
		        EXEC SP_EXECUTESQL @CCMD
		     END 
				
			FETCH NEXT FROM CUR_MEASUREMENT INTO  @COLUMN_NAME,@COLUMN_ALIAS
			END
			CLOSE CUR_MEASUREMENT
			DEALLOCATE CUR_MEASUREMENT
			
			IF ISNULL(@CTEMPTABLE,'')=''
			SELECT * FROM #TMPPOPRINT
			ELSE
			SET @CCMD=N'IF OBJECT_ID('''+@CTEMPTABLE+''',''U'') IS NOT NULL  
						DROP TABLE '+@CTEMPTABLE+'
						SELECT * INTO '+@CTEMPTABLE+' FROM  #TMPPOPRINT'
				PRINT @CCMD
				EXEC SP_EXECUTESQL @CCMD		
	
		
END
