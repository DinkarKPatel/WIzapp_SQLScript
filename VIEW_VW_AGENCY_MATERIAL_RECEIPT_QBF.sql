CREATE VIEW VW_AGENCY_MATERIAL_RECEIPT_QBF    
AS           
SELECT D2.ARTICLE_NO AS ARTICLE_SET, T5.MEMO_NO AS ISSUE_NO,T5.MEMO_DT AS ISSUE_DT, T4.REF_COMPONENT_ARTICLE_CODE AS [COMPONENT CODE],D.ARTICLE_NAME AS [COMPONENT NAME],D.ARTICLE_NO AS [COMPONENT NO],D.ARTICLE_DESC AS [COMPONENT DESC],       
T4.ARTICLE_CODE ,D1.ARTICLE_NAME ,D1.ARTICLE_NO,SKU.PRODUCT_CODE ,D1.ARTICLE_DESC,PARA1.PARA1_NAME AS COLOR, PARA2.PARA2_NAME AS SIZE
,PARA3.PARA3_NAME,PARA4.PARA4_NAME,PARA5.PARA5_NAME,PARA6.PARA6_NAME   
,JOBS.JOB_NAME ,WO.REF_NO, WO.MEMO_NO AS [WORK_ORDER_NO],UOM.UOM_NAME  
,E.SUB_SECTION_NAME,E.SUB_SECTION_CODE,F.SECTION_NAME,F.SECTION_CODE      
,T1.MEMO_NO ,CONVERT(CHAR(10),T1.MEMO_DT,105) AS MEMO_DATE , K.AGENCY_NAME ,T1.AGENCY_CHALLAN_NO,T1.AGENCY_CHALLAN_DT,      
T1.AGENCY_BILL_NO,T1.AGENCY_BILL_DT,T1.RECEIVEDBY          
,LM.ADDRESS0+' '+LM.ADDRESS1+' '+LM.ADDRESS2+' '+LM.AREA_NAME+' '+LM.CITY +' '+ LM.STATE +' '+ LM.PINCODE AS [ADDRESS]  
,ISNULL(T1.SUBTOTAL,0) AS SUBTOTAL,  ISNULL(T1.DISCOUNT_AMOUNT,0) AS DISCOUNT_AMOUNT,ISNULL(T1.TDS,0) AS TDS,ISNULL(T1.OTHERCHARGES,0) AS OTHERCHARGES        
,ISNULL(T1.FREIGHT,0) AS FREIGHT,T1.NET_AMOUNT  ,T1.REMARKS AS MST_REMARKS             
,CASE WHEN T1.CANCELLED =0 THEN '' ELSE 'CANCELLED' END AS CANCELLED ,T2.USERNAME AS USER_NAME     ,T1.MEMO_ID            
,T3.[QUANTITY] AS ITEM_QUANTITY ,T3.ROW_ID ,T3.[RATE] AS ITEM_RATE      ,T3.[AMOUNT]           
,T3.[DISCOUNT_PER] AS ITEM_LEVEL_DISC_PER      ,T3.[DISCOUNT_AMOUNT] AS ITEM_LEVEL_DISC_AMT      
,T3.[NET_AMOUNT] AS ITEM_LEVEL_AMT_AFTER_DISC,COM.COMPANY_CODE    
,EMP.EMP_FNAME+' '+EMP.EMP_LNAME AS PC_NAME
,COM.COMPANY_NAME,COM.ADDRESS9 ,T6.REC_QTY AS ORD_QUANTITY             
FROM PRD_AGENCY_MATERIAL_RECEIPT_MST T1        
JOIN USERS T2 ON T1.USER_CODE = T2.USER_CODE            
JOIN PRD_AGENCY_MATERIAL_RECEIPT_DET T3 ON T1.MEMO_ID=T3.MEMO_ID      
JOIN PRD_AGENCY_MST  K ON T1.AGENCY_CODE = K.AGENCY_CODE          
JOIN PRD_AGENCY_ISSUE_MATERIAL_DET T4 ON T3.REF_ROW_ID=T4.ROW_ID    
JOIN PRD_SKU SKU ON T4.PRODUCT_UID=SKU.PRODUCT_UID  
JOIN PARA1 ON SKU.PARA1_CODE=PARA1.PARA1_CODE  
JOIN PARA2 ON SKU.PARA2_CODE=PARA2.PARA2_CODE   
JOIN PARA3 ON SKU.PARA3_CODE=PARA3.PARA3_CODE   
JOIN PARA4 ON SKU.PARA4_CODE=PARA4.PARA4_CODE   
JOIN PARA5 ON SKU.PARA5_CODE=PARA5.PARA5_CODE   
JOIN PARA6 ON SKU.PARA6_CODE=PARA6.PARA6_CODE  
JOIN PRD_AGENCY_ISSUE_MATERIAL_MST T5 ON T5.MEMO_ID=T4.MEMO_ID 
JOIN JOBS ON T4.JOB_CODE=JOBS.JOB_CODE  
JOIN PRD_WO_MST WO ON T4.REF_PRD_WORKORDER_MEMOID=WO.MEMO_ID  
JOIN ARTICLE (NOLOCK) D ON T4.REF_COMPONENT_ARTICLE_CODE= D.ARTICLE_CODE      
JOIN ARTICLE (NOLOCK) D1 ON T4.ARTICLE_CODE= D1.ARTICLE_CODE 
JOIN ARTICLE (NOLOCK) D2 ON WO.ARTICLE_SET_CODE= D2.ARTICLE_CODE                
JOIN UOM ON D1.UOM_CODE=UOM.UOM_CODE          
JOIN SECTIOND (NOLOCK) E ON D.SUB_SECTION_CODE = E.SUB_SECTION_CODE             
JOIN SECTIONM (NOLOCK) F ON E.SECTION_CODE = F.SECTION_CODE    
JOIN LMV01106 LM ON LM.AC_CODE=K.AC_CODE   
JOIN COMPANY COM ON 1=1 AND COM.COMPANY_CODE='01'     
LEFT OUTER JOIN EMP_MST EMP ON EMP.EMP_ID=WO.EMP_CODE 
----
LEFT JOIN PARA1 P1 ON SKU.COM_PARA1_CODE=P1.PARA1_CODE    
LEFT JOIN PARA2 P2 ON SKU.COM_PARA2_CODE=P2.PARA2_CODE 
JOIN PRD_AGENCY_ROW_MATERIAL_RECEIPT_DET  T6 ON T6.MEMO_ID=T3.MEMO_ID AND T6.ROW_ID=T3.REF_MATERIAL_ROW_ID 
--WHERE T1.MEMO_NO='0000000107' AND T1.MEMO_DT='2017-04-21'

UNION ALL
SELECT D2.ARTICLE_NO AS ARTICLE_SET, T5.MEMO_NO AS ISSUE_NO,T5.MEMO_DT AS ISSUE_DT, T4.REF_COMPONENT_ARTICLE_CODE AS [COMPONENT CODE],D.ARTICLE_NAME AS [COMPONENT NAME],D.ARTICLE_NO AS [COMPONENT NO],D.ARTICLE_DESC AS [COMPONENT DESC],       
T4.ARTICLE_CODE ,D1.ARTICLE_NAME ,D1.ARTICLE_NO,SKU.PRODUCT_CODE ,D1.ARTICLE_DESC,PARA1.PARA1_NAME AS COLOR, PARA2.PARA2_NAME AS SIZE
,PARA3.PARA3_NAME,PARA4.PARA4_NAME,PARA5.PARA5_NAME,PARA6.PARA6_NAME   
,JOBS.JOB_NAME ,WO.REF_NO, WO.MEMO_NO AS [WORK_ORDER_NO],UOM.UOM_NAME  
,E.SUB_SECTION_NAME,E.SUB_SECTION_CODE,F.SECTION_NAME,F.SECTION_CODE      
,T1.MEMO_NO ,CONVERT(CHAR(10),T1.MEMO_DT,105) AS MEMO_DATE , K.AGENCY_NAME ,T1.AGENCY_CHALLAN_NO,T1.AGENCY_CHALLAN_DT,      
T1.AGENCY_BILL_NO,T1.AGENCY_BILL_DT,T1.RECEIVEDBY          
,LM.ADDRESS0+' '+LM.ADDRESS1+' '+LM.ADDRESS2+' '+LM.AREA_NAME+' '+LM.CITY +' '+ LM.STATE +' '+ LM.PINCODE AS [ADDRESS]  
,ISNULL(T1.SUBTOTAL,0) AS SUBTOTAL,  ISNULL(T1.DISCOUNT_AMOUNT,0) AS DISCOUNT_AMOUNT,ISNULL(T1.TDS,0) AS TDS,ISNULL(T1.OTHERCHARGES,0) AS OTHERCHARGES        
,ISNULL(T1.FREIGHT,0) AS FREIGHT,T1.NET_AMOUNT  ,T1.REMARKS AS MST_REMARKS             
,CASE WHEN T1.CANCELLED =0 THEN '' ELSE 'CANCELLED' END AS CANCELLED ,T2.USERNAME AS USER_NAME     ,T1.MEMO_ID            
,T3.[QUANTITY] AS ITEM_QUANTITY ,T3.ROW_ID ,T3.[RATE] AS ITEM_RATE      ,T3.[AMOUNT]           
,T3.[DISCOUNT_PER] AS ITEM_LEVEL_DISC_PER      ,T3.[DISCOUNT_AMOUNT] AS ITEM_LEVEL_DISC_AMT      
,T3.[NET_AMOUNT] AS ITEM_LEVEL_AMT_AFTER_DISC,COM.COMPANY_CODE    
,EMP.EMP_FNAME+' '+EMP.EMP_LNAME AS PC_NAME
,COM.COMPANY_NAME,COM.ADDRESS9, T7.REC_QTY AS ORD_QUANTITY          
FROM PRD_AGENCY_MATERIAL_RECEIPT_MST T1        
JOIN USERS T2 ON T1.USER_CODE = T2.USER_CODE            
JOIN PRD_AGENCY_MATERIAL_RECEIPT_DET T3 ON T1.MEMO_ID=T3.MEMO_ID      
JOIN PRD_AGENCY_MST  K ON T1.AGENCY_CODE = K.AGENCY_CODE          
JOIN PRD_AGENCY_ISSUE_MATERIAL_DET_PENDING T4 ON T3.REF_ROW_ID=T4.ROW_ID    
JOIN PRD_SKU SKU ON T4.PRODUCT_UID=SKU.PRODUCT_UID  
JOIN PARA1 ON SKU.PARA1_CODE=PARA1.PARA1_CODE  
JOIN PARA2 ON SKU.PARA2_CODE=PARA2.PARA2_CODE   
JOIN PARA3 ON SKU.PARA3_CODE=PARA3.PARA3_CODE   
JOIN PARA4 ON SKU.PARA4_CODE=PARA4.PARA4_CODE   
JOIN PARA5 ON SKU.PARA5_CODE=PARA5.PARA5_CODE   
JOIN PARA6 ON SKU.PARA6_CODE=PARA6.PARA6_CODE  
JOIN PRD_AGENCY_ISSUE_MATERIAL_MST_PENDING  T5 ON T5.MEMO_ID=T4.MEMO_ID 
JOIN JOBS ON T4.JOB_CODE=JOBS.JOB_CODE  
JOIN PRD_WO_MST WO ON T4.REF_PRD_WORKORDER_MEMOID=WO.MEMO_ID  
JOIN ARTICLE (NOLOCK) D ON T4.REF_COMPONENT_ARTICLE_CODE= D.ARTICLE_CODE      
JOIN ARTICLE (NOLOCK) D1 ON T4.ARTICLE_CODE= D1.ARTICLE_CODE 
JOIN ARTICLE (NOLOCK) D2 ON WO.ARTICLE_SET_CODE= D2.ARTICLE_CODE    
JOIN UOM ON D1.UOM_CODE=UOM.UOM_CODE          
JOIN SECTIOND (NOLOCK) E ON D.SUB_SECTION_CODE = E.SUB_SECTION_CODE             
JOIN SECTIONM (NOLOCK) F ON E.SECTION_CODE = F.SECTION_CODE    
JOIN LMV01106 LM ON LM.AC_CODE=K.AC_CODE   
JOIN COMPANY COM ON 1=1 AND COM.COMPANY_CODE='01'     
LEFT OUTER JOIN EMP_MST EMP ON EMP.EMP_ID=WO.EMP_CODE 
LEFT JOIN PARA1 P1 ON SKU.COM_PARA1_CODE=P1.PARA1_CODE    
LEFT JOIN PARA2 P2 ON SKU.COM_PARA2_CODE=P2.PARA2_CODE 
JOIN PRD_AGENCY_ROW_MATERIAL_RECEIPT_DET  T7 ON T7.MEMO_ID=T3.MEMO_ID AND T7.ROW_ID=T3.REF_MATERIAL_ROW_ID
