CREATE PROCEDURE SP_GETBINLOC
--WITH ENCRYPTION
AS
BEGIN
	SELECT A.BIN_ID,A.BIN_ID+'-'+A.BIN_NAME AS [BIN_NAME],A.BIN_ALIAS,A.DEPT_ID,A.DEPT_ID+'-'+A.DEPT_NAME as [DEPT_NAME],
	ISNULL(B.CHK,A.CHK) AS CHK ,GETDATE() AS [LAST_UPDATE] 
	FROM
	(
		SELECT A.BIN_ID,A.BIN_NAME,A.BIN_ALIAS,B.DEPT_ID,B.DEPT_NAME,CONVERT(BIT,1) AS [CHK]
		FROM BIN A,LOCATION B
		WHERE A.BIN_ID='000' AND B.INACTIVE=0 AND A.INACTIVE=0 AND B.MAJOR_DEPT_ID=B.DEPT_ID
		AND A.BIN_ID = A.major_bin_id  AND isnull(A.rack_bin,0) =0
		UNION ALL
		SELECT A.BIN_ID,A.BIN_NAME,A.BIN_ALIAS,B.DEPT_ID,B.DEPT_NAME,CONVERT(BIT,0) AS [CHK]
		FROM BIN A,LOCATION B
		WHERE A.BIN_ID<>'000'  AND B.INACTIVE=0 AND A.INACTIVE=0 AND B.MAJOR_DEPT_ID=B.DEPT_ID
		/*AND B.ENABLE_BIN=1 Rohit 03-10-2024 Meeting with sir , vivek and KV : There is no need of this*/
		AND A.BIN_ID = A.major_bin_id  AND isnull(A.rack_bin,0) =0
	)A
	LEFT OUTER JOIN 
	(
		SELECT A.BIN_ID,C.BIN_NAME,C.BIN_ALIAS,A.DEPT_ID,B.DEPT_NAME,CONVERT(BIT,1) AS [CHK]
		FROM BIN_LOC A
		JOIN LOCATION B ON B.DEPT_ID=A.DEPT_ID
		JOIN BIN C ON C.BIN_ID=A.BIN_ID
		WHERE B.INACTIVE=0 AND C.INACTIVE=0 AND B.DEPT_ID=B.MAJOR_DEPT_ID
		AND C.BIN_ID = C.major_bin_id  AND isnull(c.rack_bin,0) =0
	)B ON A.BIN_ID=B.BIN_ID AND A.DEPT_ID=B.DEPT_ID
	ORDER BY bin_name,A.DEPT_NAME
END
