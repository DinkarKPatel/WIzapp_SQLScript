CREATE VIEW SPPPC_VW_RM_UOM_PRINT
AS
  SELECT   A.MEMO_ID  AS FG_ISSUE_ID,
         SUM(A.QUANTITY ) AS QUANTITY,
		 REQ_QTY=CAST(SUM(CASE WHEN UC.CONVERSION_VALUE =0 THEN (A.QUANTITY)*CONSUME_QTY 
		 ELSE (A.QUANTITY)*CONSUME_QTY /UC.CONVERSION_VALUE END) AS NUMERIC(10,3)) ,
         UOM.UOM_NAME 

FROM PPC_AGENCY_ISSUE_FG_FIRST_DET A
JOIN PPC_AGENCY_ISSUE_FG_FIRST_MST B ON A.MEMO_ID =B.MEMO_ID
JOIN PPC_FG_SKU SKU ON SKU.PRODUCT_CODE =A.PRODUCT_CODE 
JOIN PPC_FGBCG_DET DET ON DET. ROW_ID=SKU.PPC_FGBCG_DET_ROW_ID
JOIN PPC_BO_ART_JOBS_CONSUME CN ON CN.REF_ROW_ID=DET.BO_DET_ROW_ID AND CN.JOB_CODE=B.JOB_CODE AND CN.CONSUME_QTY >0
JOIN ARTICLE ART ON ART.ARTICLE_CODE =CN.BOM_ARTICLE_CODE 
JOIN UOM ON UOM.UOM_CODE =ART.UOM_CODE 
LEFT OUTER JOIN PPC_UOM_CONVERSION UC ON UC.UOM_CODE=UOM.UOM_CODE
LEFT OUTER JOIN PPC_BOM_UOM BU ON BU.CONVERSION_UOM_CODE=UC.CONVERSION_UOM_CODE
WHERE B.CANCELLED =0
GROUP BY A.MEMO_ID ,UOM.UOM_NAME--,UC.CONVERSION_VALUE,CONSUME_QTY
