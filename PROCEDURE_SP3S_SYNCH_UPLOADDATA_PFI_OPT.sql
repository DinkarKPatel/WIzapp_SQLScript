CREATE PROCEDURE SP3S_SYNCH_UPLOADDATA_PFI_OPT
(
    @CSPID VARCHAR(50)
   ,@CERRMSG VARCHAR(1000) OUTPUT
)
--WITH ENCRYPTION
AS
SET NOCOUNT ON
BEGIN


DECLARE @CSTEP VARCHAR(100),@DTSQL NVARCHAR(MAX),@NMERGE_ORDER NUMERIC(5)
	   ,@CTABLENAME VARCHAR(200),@CTABLE_SUFFIX VARCHAR(50),@CKEYFIELD VARCHAR(200),@CDEL_ID VARCHAR(50),@CTMP_TABLENAME VARCHAR(200),@LINSERTONLY VARCHAR(1)
	   ,@CFILTERCONDITION VARCHAR(200),@CFILTERCONDITION2 VARCHAR(500),@LUPDATEONLY VARCHAR(1),@BALWAYSUPDATE VARCHAR(1),@FDEL CHAR(1)
	   ,@CERRMSGOUT VARCHAR(1000),@CTABLESSTR VARCHAR(MAX),@CMIRRORINGENABLED VARCHAR(5)
	   ,@CCURDEPTID VARCHAR(5),@CTEMPMASTERTABLE VARCHAR(200),@CTEMPDETAILTABLE1 VARCHAR(200),@CTEMPDETAILTABLE2 VARCHAR(200)
	   ,@CTEMPPAYMODETABLE VARCHAR(200),@CTEMPTABLE VARCHAR(100),@CDONOTRESETPOSTEDINAC VARCHAR(1)
	   ,@BADDMODE BIT,@CCUTOFFDATE VARCHAR(20),@CWHERECLAUSE VARCHAR(2000),@CMEMONOLEN VARCHAR(5),@NMEMONOLEN INT
	   ,@DMINMEMODT DATETIME,@DMAXMEMODT DATETIME,@CFINYEAR VARCHAR(5),@CMEMOPREFIX VARCHAR(10)
	   ,@CMINMEMONO VARCHAR(20),@CMAXMEMONO VARCHAR(20),@CSOURCEDB VARCHAR(200),@CMERGEDB VARCHAR(200)
	   ,@BMSTINSERTONLY BIT,@BSERIESMISMATCHFOUND BIT,@CMEMOID VARCHAR(40),@CPREVMEMONO VARCHAR(20)
	   ,@NPREVMEMONO NUMERIC(5,0),@NLENVALUE INT,@CPREVMEMONOSEARCH VARCHAR(20),@CMEMOIDSEARCH VARCHAR(40)
	   ,@CRETPRODUCTCODE VARCHAR(50),@NVERSIONNO INT,@CJOINSTR VARCHAR(MAX),@CTEMPSKUTABLE VARCHAR(500)
	   ,@CPARTYDEPTID VARCHAR(5),@NINVMODE INT,@CTEMPIMPTABLE VARCHAR(200),@CFILTERCONDITION3 VARCHAR(500),
	   @CCMD NVARCHAR(MAX),@CTEMPDETAILTABLE3 VARCHAR(200),@CFILTERCONDITION1 VARCHAR(MAX)
	

BEGIN TRY
	
	
	SET @CSTEP=10

	SELECT @CSOURCEDB='',@CMERGEDB='',@BMSTINSERTONLY=1,@BSERIESMISMATCHFOUND=0
	
	SET @CSTEP=15
    	
    SELECT TOP 1 @CCURDEPTID=VALUE FROM CONFIG WHERE CONFIG_OPTION='LOCATION_ID'

	SELECT @CTEMPMASTERTABLE=@CSOURCEDB+'PFI_ORD_PLAN_MST_UPLOAD',
		   @CTEMPDETAILTABLE1=@CSOURCEDB+'PFI_ORD_PLAN_DET_UPLOAD' ,
		   @CTEMPDETAILTABLE2=@CSOURCEDB+'PFI_ORD_PLAN_BOM_DET_UPLOAD' ,
		   @CTEMPDETAILTABLE3=@CSOURCEDB+'PFI_ORD_PLAN_BARCODE_DET_UPLOAD' 
		   
	
LBLSTART:
    
    BEGIN TRANSACTION
    
    SELECT @CMEMOID='',@NVERSIONNO=0
		
		

    SELECT TOP 1 @CMEMOID = B.MEMO_ID 
    FROM PFI_ORD_PLAN_MST_UPLOAD B (NOLOCK)
    WHERE SP_ID=@CSPID 
    

    
    IF ISNULL(@CMEMOID,'')=''
		GOTO EXIT_PROC
		
    SET @CFILTERCONDITION = 'B.MEMO_ID='''+@CMEMOID+''' AND B.SP_ID='+LTRIM(RTRIM((@CSPID)))
   

	SET @CSTEP=20
	SET @CMEMOIDSEARCH=''
	SELECT TOP 1 @CMEMOIDSEARCH=A.MEMO_ID FROM ORD_PLAN_MST A (NOLOCK) WHERE A.MEMO_ID=@CMEMOID
	
	IF ISNULL(@CMEMOIDSEARCH,'')<>''
		SET @BADDMODE=0
	ELSE
		SET @BADDMODE=1


	IF @BADDMODE=0
	BEGIN	
		SET @CSTEP=25
		SET @DTSQL=N'DELETE A FROM ORD_PLAN_DET A JOIN '+@CTEMPMASTERTABLE+' B (NOLOCK) ON A.MEMO_ID=B.MEMO_ID
					 LEFT OUTER JOIN 
					 (SELECT ROW_ID FROM '+@CTEMPDETAILTABLE1+' B WHERE '+@CFILTERCONDITION+') C 
					 ON A.ROW_ID = C.ROW_ID 
					 WHERE C.ROW_ID IS NULL AND '+@CFILTERCONDITION

		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL
		
		SET @CSTEP=26
		
		SET @DTSQL=N'DELETE A FROM ORD_PLAN_BOM_DET A JOIN '+@CTEMPMASTERTABLE+' B (NOLOCK) ON A.MEMO_ID=B.MEMO_ID
					 LEFT OUTER JOIN 
					 (SELECT ROW_ID FROM '+@CTEMPDETAILTABLE2+' B WHERE '+@CFILTERCONDITION+') C 
					 ON A.ROW_ID = C.ROW_ID 
					 WHERE C.ROW_ID IS NULL AND '+@CFILTERCONDITION

		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL
		
		
		
		SET @CSTEP=27
		
		SET @DTSQL=N'DELETE A FROM ORD_PLAN_BARCODE_DET A JOIN ORD_PLAN_DET D ON A.REFROW_ID=D.ROW_ID
		           JOIN '+@CTEMPMASTERTABLE+' B (NOLOCK) ON B.MEMO_ID=D.MEMO_ID
					 LEFT OUTER JOIN 
					 (
					 SELECT REFROW_ID FROM '+@CTEMPDETAILTABLE3+' B WHERE '+@CFILTERCONDITION1+'
					 ) C 
					 ON A.REFROW_ID = C.REFROW_ID 
					 WHERE C.REFROW_ID IS NULL AND '+@CFILTERCONDITION

		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL
		
		

	END
	
LBLMERGE:
     SET @CFILTERCONDITION1 = ' B.SP_ID='+LTRIM(RTRIM(STR(@CSPID)))
	
    
    SET @CTABLENAME='SECTIONM'
	SET @CTMP_TABLENAME='PFI_SECTIONM_UPLOAD'
	SET @CKEYFIELD='SECTION_CODE'

	
	SET @CSTEP=60
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION1,@LUPDATEONLY=@LUPDATEONLY
							  ,@BALWAYSUPDATE=1 

	SET @CTABLENAME='SECTIOND'
	SET @CTMP_TABLENAME='PFI_SECTIOND_UPLOAD'
	SET @CKEYFIELD='SUB_SECTION_CODE'

	
	SET @CSTEP=70
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION1,@LUPDATEONLY=@LUPDATEONLY
							  ,@BALWAYSUPDATE=1 
							  
    SET @CSTEP=330
	SET @CTABLENAME='SD_ATTR_AVATAR'
	SET @CTMP_TABLENAME='PFI_'+@CTABLENAME+'_UPLOAD'
	SET @CKEYFIELD='SUB_SECTION_CODE'
	SET @CSTEP=340



	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB        
         ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''        
         ,@LINSERTONLY=1,@CJOINSTR='',@LUPDATEONLY=0        
         ,@BALWAYSUPDATE=1,@CFILTERCONDITION=@CFILTERCONDITION1 
	
	
								  


	SET @CTABLENAME='ARTICLE'
	SET @CTMP_TABLENAME='PFI_ARTICLE_UPLOAD'
	SET @CKEYFIELD='ARTICLE_CODE'

	
	SET @CSTEP=80
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION1,@LUPDATEONLY=@LUPDATEONLY
							  ,@BALWAYSUPDATE=1 
							  
							  
 DECLARE @NCOUNT INT,@BLOOP INT,@CCMD1 NVARCHAR(MAX)
	SET @NCOUNT=25
	SET @BLOOP=1
	WHILE (@BLOOP <=@NCOUNT )
	BEGIN
	      
	    
		  
			SET @CTABLENAME='ATTR'+RTRIM(LTRIM(STR(@BLOOP)))+'_MST'
			SET @CTMP_TABLENAME='PFI_ATTR'+RTRIM(LTRIM(STR(@BLOOP)))+'_MST_UPLOAD'
			SET @CKEYFIELD='ATTR'+RTRIM(LTRIM(STR(@BLOOP)))+'_KEY_CODE'
			EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB        
			 ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''        
			 ,@LINSERTONLY=@BMSTINSERTONLY,@CJOINSTR='',@LUPDATEONLY=0        
			 ,@BALWAYSUPDATE=1
			 ,@CFILTERCONDITION=@CFILTERCONDITION1 
			
	       
		   SET @BLOOP=@BLOOP +1  			
	END
   
    SET @CSTEP=580
	SET @CTABLENAME='ARTICLE_FIX_ATTR'
	SET @CTMP_TABLENAME='PFI_'+@CTABLENAME+'_UPLOAD'
	SET @CKEYFIELD='ARTICLE_CODE'
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB        
         ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='ARTICLE_CODE',@CKEYFIELD3=''        
         ,@LINSERTONLY=1,@CJOINSTR='',@LUPDATEONLY=0        
         ,@BALWAYSUPDATE=1,@CFILTERCONDITION=@CFILTERCONDITION1        
                							  



    SET @CTABLENAME='PARA1'
	SET @CTMP_TABLENAME='PFI_PARA1_UPLOAD'
	SET @CKEYFIELD='PARA1_CODE'

	
	SET @CSTEP=90
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION1,@LUPDATEONLY=@LUPDATEONLY
							  ,@BALWAYSUPDATE=1 

	SET @CTABLENAME='PARA2'
	SET @CTMP_TABLENAME='PFI_PARA2_UPLOAD'
	SET @CKEYFIELD='PARA2_CODE'

	
	SET @CSTEP=100
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION1,@LUPDATEONLY=@LUPDATEONLY
							  ,@BALWAYSUPDATE=1 

	SET @CTABLENAME='PARA3'
	SET @CTMP_TABLENAME='PFI_PARA3_UPLOAD'
	SET @CKEYFIELD='PARA3_CODE'

	
	SET @CSTEP=110
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION1,@LUPDATEONLY=@LUPDATEONLY
							  ,@BALWAYSUPDATE=1 

	SET @CTABLENAME='PARA4'
	SET @CTMP_TABLENAME='PFI_PARA4_UPLOAD'
	SET @CKEYFIELD='PARA4_CODE'

	
	SET @CSTEP=120
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION1,@LUPDATEONLY=@LUPDATEONLY
							  ,@BALWAYSUPDATE=1 


	SET @CTABLENAME='PARA5'
	SET @CTMP_TABLENAME='PFI_PARA5_UPLOAD'
	SET @CKEYFIELD='PARA5_CODE'

	
	SET @CSTEP=130
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION1,@LUPDATEONLY=@LUPDATEONLY
							  ,@BALWAYSUPDATE=1 

	SET @CTABLENAME='PARA6'
	SET @CTMP_TABLENAME='PFI_PARA6_UPLOAD'
	SET @CKEYFIELD='PARA6_CODE'

	
	SET @CSTEP=140
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION1,@LUPDATEONLY=@LUPDATEONLY
							  ,@BALWAYSUPDATE=1 
							  
   SET @CTABLENAME='SKU'
	SET @CTMP_TABLENAME='PFI_SKU_UPLOAD'
	SET @CKEYFIELD='PRODUCT_CODE'

	
	SET @CSTEP=150
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION1,@LUPDATEONLY=@LUPDATEONLY
							  ,@BALWAYSUPDATE=1 


	SET @CTABLENAME='SKU_OH'
	SET @CTMP_TABLENAME='PFI_SKU_OH_UPLOAD'
	SET @CKEYFIELD='PRODUCT_CODE'

	
	SET @CSTEP=160
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION1,@LUPDATEONLY=@LUPDATEONLY
							  ,@BALWAYSUPDATE=1 							  

	

	SET @CTABLENAME='ORD_PLAN_MST'
	SET @CTMP_TABLENAME='PFI_ORD_PLAN_MST_UPLOAD'
	SET @CKEYFIELD='MEMO_ID'

	
	
	SET @CSTEP=210	 
	SET @CFILTERCONDITION = 'B.MEMO_ID='''+@CMEMOID+''' AND B.SP_ID='+LTRIM(RTRIM((@CSPID)))
	
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=@BADDMODE,@CFILTERCONDITION=@CFILTERCONDITION,@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1,@BUPDATEXNS=1 

	SET @CTABLENAME='ORD_PLAN_DET'
	SET @CTMP_TABLENAME='PFI_ORD_PLAN_DET_UPLOAD'
	SET @CKEYFIELD='ROW_ID'
	

	SET @CSTEP=220
	
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=@BADDMODE,@CFILTERCONDITION=@CFILTERCONDITION,@LUPDATEONLY=0
							  ,@BALWAYSUPDATE=1,@BUPDATEXNS=1 
							  
							  
    SET @CFILTERCONDITION = ' B.SP_ID='+LTRIM(RTRIM((@CSPID)))
						  							  
	SET @CTABLENAME='ORD_PLAN_BARCODE_DET'
	SET @CTMP_TABLENAME='PFI_ORD_PLAN_BARCODE_DET_UPLOAD'
	SET @CKEYFIELD='REFROW_ID'

	
	SET @CSTEP=60
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION,@LUPDATEONLY=@LUPDATEONLY
							  ,@BALWAYSUPDATE=1 


    SET @CFILTERCONDITION = 'B.MEMO_ID='''+@CMEMOID+''' AND B.SP_ID='+LTRIM(RTRIM((@CSPID)))
	SET @CTABLENAME='ORD_PLAN_BOM_DET'
	SET @CTMP_TABLENAME='PFI_ORD_PLAN_BOM_DET_UPLOAD'
	SET @CKEYFIELD='MEMO_ID'

	
	SET @CSTEP=70
	EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
							  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='',@CKEYFIELD3=''
							  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION,@LUPDATEONLY=@LUPDATEONLY
							  ,@BALWAYSUPDATE=1 
							  

	SET @CSTEP=230    		
	DELETE A FROM PFI_ORD_PLAN_MST_UPLOAD A WHERE A.SP_ID=@CSPID
	DELETE A FROM PFI_ORD_PLAN_DET_UPLOAD A WHERE A.SP_ID=@CSPID
	DELETE A FROM PFI_ORD_PLAN_BOM_DET_UPLOAD A WHERE A.SP_ID=@CSPID
	DELETE A FROM PFI_ORD_PLAN_BARCODE_DET_UPLOAD A WHERE A.SP_ID=@CSPID
	DELETE A FROM PFI_PARA1_UPLOAD A WHERE A.SP_ID=@CSPID
	DELETE A FROM PFI_PARA2_UPLOAD A WHERE A.SP_ID=@CSPID
	DELETE A FROM PFI_PARA3_UPLOAD A WHERE A.SP_ID=@CSPID
	DELETE A FROM PFI_PARA4_UPLOAD A WHERE A.SP_ID=@CSPID
	DELETE A FROM PFI_PARA5_UPLOAD A WHERE A.SP_ID=@CSPID
	DELETE A FROM PFI_PARA6_UPLOAD A WHERE A.SP_ID=@CSPID
    DELETE A FROM PFI_ATTR1_MST_UPLOAD A WHERE A.SP_ID=@CSPID
    DELETE A FROM PFI_ATTR10_MST_UPLOAD A WHERE A.SP_ID=@CSPID 

  DELETE A FROM PFI_ATTR11_MST_UPLOAD A WHERE A.SP_ID=@CSPID 
  DELETE A FROM PFI_ATTR12_MST_UPLOAD A WHERE A.SP_ID=@CSPID 
  DELETE A FROM PFI_ATTR13_MST_UPLOAD A WHERE A.SP_ID=@CSPID  
  DELETE A FROM PFI_ATTR14_MST_UPLOAD A WHERE A.SP_ID=@CSPID 
  DELETE A FROM PFI_ATTR15_MST_UPLOAD A WHERE A.SP_ID=@CSPID  
  DELETE A FROM PFI_ATTR16_MST_UPLOAD A WHERE A.SP_ID=@CSPID 
  DELETE A FROM PFI_ATTR17_MST_UPLOAD A WHERE A.SP_ID=@CSPID  
  DELETE A FROM PFI_ATTR18_MST_UPLOAD A WHERE A.SP_ID=@CSPID   
  DELETE A FROM PFI_ATTR19_MST_UPLOAD A WHERE A.SP_ID=@CSPID  
  DELETE A FROM PFI_ATTR2_MST_UPLOAD A WHERE A.SP_ID=@CSPID 
  DELETE A FROM PFI_ATTR20_MST_UPLOAD A WHERE A.SP_ID=@CSPID   
  DELETE A FROM PFI_ATTR21_MST_UPLOAD A WHERE A.SP_ID=@CSPID 

  DELETE A FROM PFI_ATTR22_MST_UPLOAD A WHERE A.SP_ID=@CSPID 
  DELETE A FROM PFI_ATTR23_MST_UPLOAD A WHERE A.SP_ID=@CSPID 
  DELETE A FROM PFI_ATTR24_MST_UPLOAD A WHERE A.SP_ID=@CSPID 
  DELETE A FROM PFI_ATTR25_MST_UPLOAD A WHERE A.SP_ID=@CSPID   
  DELETE A FROM PFI_ATTR3_MST_UPLOAD A WHERE A.SP_ID=@CSPID 
  DELETE A FROM PFI_ATTR4_MST_UPLOAD A WHERE A.SP_ID=@CSPID 
  DELETE A FROM PFI_ATTR5_MST_UPLOAD A WHERE A.SP_ID=@CSPID 
  DELETE A FROM PFI_ATTR6_MST_UPLOAD A WHERE A.SP_ID=@CSPID   
  DELETE A FROM PFI_ATTR7_MST_UPLOAD A WHERE A.SP_ID=@CSPID  
  DELETE A FROM PFI_ATTR8_MST_UPLOAD A WHERE A.SP_ID=@CSPID 
  DELETE A FROM PFI_ATTR9_MST_UPLOAD A WHERE A.SP_ID=@CSPID   
  DELETE A FROM PFI_ARTICLE_FIX_ATTR_UPLOAD A WHERE A.SP_ID=@CSPID 
  DELETE A FROM PFI_SKU_UPLOAD A WHERE A.SP_ID=@CSPID
  DELETE A FROM PFI_SKU_OH_UPLOAD A WHERE A.SP_ID=@CSPID



END TRY
BEGIN CATCH
	SET @CERRMSG='P:SP3S_SYNCH_UPLOADDATA_PFI_OPT, MEMO ID :'+@CMEMOID+' STEP:'+@CSTEP+', MESSAGE:'+ERROR_MESSAGE()
	GOTO EXIT_PROC
END CATCH

EXIT_PROC:

	
	IF @@TRANCOUNT>0
	BEGIN
		IF ISNULL(@CERRMSG,'')='' AND @BSERIESMISMATCHFOUND<>1
			COMMIT
		ELSE
			ROLLBACK
    END
	
END	
---END OF PROCEDURE - SP_SYNCH_MIRRORDATA_PFI_SINGLE
