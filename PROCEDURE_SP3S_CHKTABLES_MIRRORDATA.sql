CREATE PROCEDURE SP3S_CHKTABLES_MIRRORDATA
@CXNTYPE VARCHAR(10),
@CMEMOID VARCHAR(40),
@CLOCID VARCHAR(5),
@CSOURCEDB VARCHAR(200),
@CERRORMSG VARCHAR(MAX) OUTPUT
--WITH ENCRYPTION
AS
BEGIN
	BEGIN TRY
		DECLARE @NSTEP INT,@CCMD NVARCHAR(MAX),@CMASTERTABLENAME VARCHAR(200),
				@CSOURCETABLE VARCHAR(300),@CTABLESUFFIX VARCHAR(100)
		SET @NSTEP=10
		
		SET @CERRORMSG=''

		IF @CXNTYPE='OPS'
			SET @CMASTERTABLENAME='OPS01106'
		ELSE
		IF @CXNTYPE='PO'
			SET @CMASTERTABLENAME='POM01106'
		ELSE
		IF @CXNTYPE='PUR'
			SET @CMASTERTABLENAME='PIM01106'
		ELSE
		IF @CXNTYPE='DNPS'
			SET @CMASTERTABLENAME='DNPS_MST'
		ELSE
		IF @CXNTYPE IN ('PRT','DOCPRT')
			SET @CMASTERTABLENAME='RMM01106'
		ELSE
		IF @CXNTYPE IN ('DOCGV')
			SET @CMASTERTABLENAME='GV_STKXFER_MST'
		ELSE		
		IF @CXNTYPE='WPS'
			SET @CMASTERTABLENAME='WPS_MST'
		ELSE
		IF @CXNTYPE IN ('WSL','DOCWSL')
			SET @CMASTERTABLENAME='INM01106'
		ELSE
		IF @CXNTYPE='WSR'
			SET @CMASTERTABLENAME='CNM01106'
		ELSE
		IF @CXNTYPE='SLS'
			SET @CMASTERTABLENAME='CMM01106'
		ELSE
		IF @CXNTYPE='APP'
			SET @CMASTERTABLENAME='APM01106'
		ELSE
		IF @CXNTYPE='APR'
			SET @CMASTERTABLENAME='APPROVAL_RETURN_MST'
		ELSE
		IF @CXNTYPE='IRR'
			SET @CMASTERTABLENAME='IRM01106'
		ELSE
		IF @CXNTYPE='CNC'
			SET @CMASTERTABLENAME='ICM01106'
		ELSE
		IF @CXNTYPE='BCO'
			SET @CMASTERTABLENAME='FLOOR_ST_MST'
		ELSE
		IF @CXNTYPE='RPS'
			SET @CMASTERTABLENAME='RPS_MST'
		ELSE
		IF @CXNTYPE IN ('ADV','ARC')
			SET @CMASTERTABLENAME='ARC01106'
		ELSE
		IF @CXNTYPE='WSLORD'
			SET @CMASTERTABLENAME='WSL_ORDER_MST'
		ELSE
		IF @CXNTYPE='ATD'
			SET @CMASTERTABLENAME='EMP_WPAYATT'
		ELSE
		IF @CXNTYPE='ACT'
			SET @CMASTERTABLENAME='VM01106'
		ELSE
		IF @CXNTYPE='SCF'
			SET @CMASTERTABLENAME='SCM01106'
		ELSE
		IF @CXNTYPE='PTC'
			SET @CMASTERTABLENAME='PEM01106'
		ELSE
		IF @CXNTYPE='SCH'
			SET @CMASTERTABLENAME='SLSMST'
		ELSE
		IF @CXNTYPE='SCHNEW'
			SET @CMASTERTABLENAME='SCHEME_SETUP_MST'			
		ELSE
		IF @CXNTYPE='DEND'
			SET @CMASTERTABLENAME='DAYCLOSE_LOG'	
		ELSE
		IF @CXNTYPE='DOCPOADJ'
			SET @CMASTERTABLENAME='PO_ADJ_MST'	
		ELSE
		IF @CXNTYPE='SNC'
			SET @CMASTERTABLENAME='SNC_MST'	
		ELSE
		IF @CXNTYPE='CUS__'
			SET @CMASTERTABLENAME='CUSTDYM'
		ELSE
		IF @CXNTYPE='STREC'
			SET @CMASTERTABLENAME='STK_RECON_HIST_MST'
		ELSE
		IF @CXNTYPE='PSHBD'
			SET @CMASTERTABLENAME='HOLD_BACK_DELIVER_MST'
		ELSE
		IF @CXNTYPE='PSJWI'
			SET @CMASTERTABLENAME='POST_SALES_JOBWORK_ISSUE_MST'
		ELSE
		IF @CXNTYPE='PSJWR'
			SET @CMASTERTABLENAME='POST_SALES_JOBWORK_RECEIPT_MST'
		ELSE
		IF @CXNTYPE='PSDLV'
			SET @CMASTERTABLENAME='SLS_DELIVERY_MST'	
		ELSE
		IF @CXNTYPE='PCI'
			SET @CMASTERTABLENAME='PCI_MST'
		ELSE
		IF @CXNTYPE='PCO'
			SET @CMASTERTABLENAME='PCO_MST'
		ELSE
		IF @CXNTYPE='SCH'
			SET @CMASTERTABLENAME='SLSMT'															
		ELSE
		IF @CXNTYPE='DSM'
			SET @CMASTERTABLENAME='DSM01106'									
		ELSE
		IF @CXNTYPE IN ('DOCMBAPP')
			SET @CMASTERTABLENAME='CMD_MANUALBILL_ERRORS'
		ELSE
		IF @CXNTYPE IN ('PRCL')
			SET @CMASTERTABLENAME='PARCEL_MST'
		ELSE
		IF @CXNTYPE IN ('DOCIRT')
			SET @CMASTERTABLENAME='IRM01106'
		ELSE
		IF @CXNTYPE IN ('MSTUSR')
			SET @CMASTERTABLENAME='USERS'
		ELSE
		IF @CXNTYPE IN ('MSTLOC')
			SET @CMASTERTABLENAME='LOCATION'
		ELSE
		IF @CXNTYPE IN ('MSTSCH')
			SET @CMASTERTABLENAME='SLSMST'
		ELSE
		IF @CXNTYPE IN ('PBG')
			SET @CMASTERTABLENAME='PBM01106'
		ELSE 
		IF @CXNTYPE IN ('WPL')
			SET @CMASTERTABLENAME='WSL_PICKLIST_MST'	
		ELSE 
		IF @CXNTYPE IN ('WBO')
			SET @CMASTERTABLENAME='BUYER_ORDER_MST'	
	    IF @CXNTYPE IN ('DOCPCO')
			SET @CMASTERTABLENAME='PCI_MST'	
		ELSE
		IF @CXNTYPE IN ('DOCPRCL')
			SET @CMASTERTABLENAME='PARCEL_MST'
		ELSE
		IF @CXNTYPE IN ('XNSLM')
			SET @CMASTERTABLENAME='LM01106'
		ELSE
		IF @CXNTYPE IN ('XNSEMP')
			SET @CMASTERTABLENAME='EMPLOYEE'
		ELSE
		IF @CXNTYPE IN ('XNSDTM')
			SET @CMASTERTABLENAME='DTM'	
		ELSE 
		IF @CXNTYPE IN ('TLF')
			SET @CMASTERTABLENAME='TILL_LIFTS'	
		ELSE 	
		IF @CXNTYPE IN ('SHF')
			SET @CMASTERTABLENAME='TILL_SHIFT_MST'
		ELSE 	
		IF @CXNTYPE IN ('BKT')
			SET @CMASTERTABLENAME='TILL_BANK_TRANSFER'
		ELSE 	
		IF @CXNTYPE IN ('TEX')
			SET @CMASTERTABLENAME='TILL_EXPENSE_MST'
		ELSE 	
		IF @CXNTYPE IN ('PTCAPP')
			SET @CMASTERTABLENAME='PED_XN_APPROVAL'
		--ELSE 	
		--IF @CXNTYPE IN ('DOCPO')
		--	SET @CMASTERTABLENAME='POM01106'																																																
		
		IF @CXNTYPE  IN ('DOCWSL','DOCPRT','DOCPO','DOCIRT','CUS','DOCGV','DOCASN','DOCWBO','DOCPCO')
			GOTO END_PROC
			
		SET @NSTEP=20
		
		SELECT @CTABLESUFFIX=REPLACE(@CMEMOID,'-','_')+(CASE WHEN @CXNTYPE='DOCIRT' THEN '_'+@CLOCID ELSE '' END)
		SET @CSOURCETABLE=@CSOURCEDB+'[TMP_'+@CXNTYPE+'_'+@CMASTERTABLENAME+(CASE WHEN LEFT(@CXNTYPE,3)='MST' THEN '' ELSE '_'+@CTABLESUFFIX END)+']'
		
		IF OBJECT_ID(@CSOURCETABLE,'U') IS  NULL
			SET @CERRORMSG='MASTER TABLE :'+@CMASTERTABLENAME+' NOT FOUND FOR XN TYPE :'+@CXNTYPE+'....PLEASE CHECK'	
		
		GOTO END_PROC	
	END TRY
	
	BEGIN CATCH
		SELECT @CERRORMSG='PROCEDURE SP3S_CHKTABLES_MIRRORDATA : '+ISNULL(ERROR_PROCEDURE(),'NULL P')+'STEP :'+STR(ISNULL(@NSTEP,0))+ ' LINE NO. :'+
		ISNULL(LTRIM(RTRIM(STR(ERROR_LINE()))),'NULL LINE')+'MSG :'+ISNULL(ERROR_MESSAGE(),'NULL MSG')
		
		GOTO END_PROC
	END CATCH

END_PROC:
	
END
