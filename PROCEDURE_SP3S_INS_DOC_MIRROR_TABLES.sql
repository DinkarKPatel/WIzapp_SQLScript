CREATE PROCEDURE SP3S_INS_DOC_MIRROR_TABLES
(
@NMODE INT,    -- 1 FOR DOCWSL   2 FOR DOCPRT
@ID VARCHAR(40)
)
AS
BEGIN

 
    
       DECLARE @CSTEP VARCHAR(100),@DTSQL NVARCHAR(MAX),@NMERGE_ORDER NUMERIC(5)
	   ,@CTABLENAME VARCHAR(200),@CTABLE_SUFFIX VARCHAR(50),@CKEYFIELD VARCHAR(200),@CDEL_ID VARCHAR(50),@CTMP_TABLENAME VARCHAR(200),@LINSERTONLY VARCHAR(1)
	   ,@CFILTERCONDITION VARCHAR(200),@CFILTERCONDITION2 VARCHAR(500),@LUPDATEONLY VARCHAR(1),@BALWAYSUPDATE VARCHAR(1),@FDEL CHAR(1)
	   ,@CERRMSGOUT VARCHAR(1000),@CTABLESSTR VARCHAR(MAX),@CMIRRORINGENABLED VARCHAR(5)
	   ,@CCURDEPTID VARCHAR(5),@CTEMPMASTERTABLE VARCHAR(200),@CTEMPDETAILTABLE1 VARCHAR(200),@CTEMPDETAILTABLE2 VARCHAR(200)
	   ,@CTEMPPAYMODETABLE VARCHAR(200),@CTEMPTABLE VARCHAR(100),@CDONOTRESETPOSTEDINAC VARCHAR(1)
	   ,@BADDMODE BIT,@CCUTOFFDATE VARCHAR(20),@CWHERECLAUSE VARCHAR(2000),@CMEMONOLEN VARCHAR(5),@NMEMONOLEN INT
	   ,@DMINMEMODT DATETIME,@DMAXMEMODT DATETIME,@CFINYEAR VARCHAR(5),@CMEMOPREFIX VARCHAR(10)
	   ,@CMINMEMONO VARCHAR(20),@CMAXMEMONO VARCHAR(20),@CSOURCEDB VARCHAR(200),@CMERGEDB VARCHAR(200)
	   ,@BMSTINSERTONLY BIT,@BSERIESMISMATCHFOUND BIT,@CMEMOID VARCHAR(40),@CPREVMEMONO VARCHAR(20)
	   ,@NPREVMEMONO NUMERIC(5,0),@NLENVALUE INT,@CPREVMEMONOSEARCH VARCHAR(20),@CMEMOIDSEARCH VARCHAR(40)
	   ,@CRETPRODUCTCODE VARCHAR(50),@NVERSIONNO INT,@CJOINSTR VARCHAR(MAX),@CTEMPSKUTABLE VARCHAR(500)
	   ,@CPARTYDEPTID VARCHAR(5),@NINVMODE INT,@CMRRID VARCHAR(40),@CDONOTSENDCHALLANWODISPATCHDETAILS VARCHAR(2)
	   ,@ERP_CONFIG VARCHAR(10),@BDONOTSENDCHALLANWITHOUTDISPATCH BIT,@CFILTERCONDITION1 VARCHAR(200)
	   
SELECT @CSOURCEDB='',@CMERGEDB='',@BMSTINSERTONLY=1,@BSERIESMISMATCHFOUND=0

 IF @NMODE=1 
 BEGIN      
		DELETE FROM DOCWSL_IND01106_MIRROR	WHERE INV_ID = @ID 
		DELETE FROM DOCWSL_INM01106_MIRROR	WHERE INV_ID = @ID 
		
		SET @CFILTERCONDITION=''
		SET @CFILTERCONDITION='INV_ID='''+@ID+''''
		
		
		SET @CTABLENAME='DOCWSL_INM01106_MIRROR'
		SET @CTMP_TABLENAME='INM01106'
		SET @CKEYFIELD='INV_ID'
		

		SET @CSTEP=100
		EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
								  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='VERSION_NO',@CKEYFIELD3=''
								  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION,@LUPDATEONLY=0
								  ,@BALWAYSUPDATE=1,@BUPDATEXNS=1,@CSEARCHTABLE='INM01106',@BINSVERSIONNO=0
 


		SET @CTABLENAME='DOCWSL_IND01106_MIRROR'
		SET @CTMP_TABLENAME='IND01106'
		SET @CKEYFIELD='ROW_ID'
		 
		SET @CSTEP=110
		
		EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
								  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='VERSION_NO',@CKEYFIELD3=''
								  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION,@LUPDATEONLY=0
								  ,@BALWAYSUPDATE=1,@BUPDATEXNS=1,@CSEARCHTABLE='IND01106',@BINSVERSIONNO=0 
		
		
		
		
		
 END
 
	 IF @NMODE=2  -- FOR DOCPRT
	 BEGIN
           
			DELETE FROM DOCPRT_rmd01106_MIRROR WHERE RM_ID =@ID
			DELETE FROM DOCPRT_rmm01106_MIRROR WHERE RM_ID =@ID
			
			
			SET @CFILTERCONDITION=''
		SET @CFILTERCONDITION='RM_ID='''+@ID+''''
		
		
		
		SET @CTABLENAME='DOCPRT_RMM01106_MIRROR'
		SET @CTMP_TABLENAME='RMM01106'
		SET @CKEYFIELD='RM_ID'

		
		SET @CSTEP=100
		EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
								  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='VERSION_NO',@CKEYFIELD3=''
								  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION,@LUPDATEONLY=0
								  ,@BALWAYSUPDATE=1,@BUPDATEXNS=1,@CSEARCHTABLE='RMM01106',@BINSVERSIONNO=0
 


		SET @CTABLENAME='DOCPRT_RMD01106_MIRROR'
		SET @CTMP_TABLENAME='RMD01106'
		SET @CKEYFIELD='RM_ID'
		 
		SET @CSTEP=110
		
		EXEC UPDATEMASTERXN_MIRROR @CSOURCEDB=@CSOURCEDB,@CSOURCETABLE=@CTMP_TABLENAME,@CDESTDB=@CMERGEDB
								  ,@CDESTTABLE=@CTABLENAME,@CKEYFIELD1=@CKEYFIELD,@CKEYFIELD2='VERSION_NO',@CKEYFIELD3=''
								  ,@LINSERTONLY=1,@CFILTERCONDITION=@CFILTERCONDITION,@LUPDATEONLY=0
								  ,@BALWAYSUPDATE=1,@BUPDATEXNS=1,@CSEARCHTABLE='RMD01106',@BINSVERSIONNO=0 


 END

END
