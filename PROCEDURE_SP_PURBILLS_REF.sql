CREATE PROC SP_PURBILLS_REF    
(      
 @NQUERYID  NUMERIC(3,0),            
 @CWHERE VARCHAR(200)=''           
)
--WITH ENCRYPTION      
AS            
BEGIN
           
 IF @NQUERYID=1            
  GOTO LBLMRRLIST          
  
LBLMRRLIST:       
			SELECT ROW_NUMBER() OVER (ORDER BY A.MRR_ID) AS XN_ID,'' AS BILL_NO,
			A.MRR_ID,A.MRR_NO ,B.MRR_ID AS PUR_MRR_ID
			,ACC.AC_NAME ,ACC.ADDRESS0 + ' ' + ACC.ADDRESS1 + ' ' + ACC.ADDRESS2 + ', ' + ACC.AREA_NAME + ' ' + ACC.CITY + ' ' +   
			ACC.STATE AS SUPP_ADDRESS
			,A.TOTAL_AMOUNT ,A.INV_NO,A.RECEIPT_DT,A.INV_DT AS VANDOR_BILL_DT 
			FROM PIM01106 (NOLOCK) A 
			JOIN LMV01106 (NOLOCK) ACC ON A.AC_CODE = ACC.AC_CODE 
			LEFT OUTER JOIN PURBILLS_REF (NOLOCK)  B ON A.MRR_ID = B.MRR_ID
			WHERE A.CANCELLED = 0 AND B.MRR_ID IS NULL
 GOTO LAST             
   
 LAST:              
END
