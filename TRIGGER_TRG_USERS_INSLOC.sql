create TRIGGER TRG_USERS_INSLOC
ON USERS
--WITH ENCRYPTION
FOR INSERT, UPDATE 
AS
BEGIN
	DECLARE @CCURLOCID VARCHAR(5)/*Rohit 01-11-2024*/
	
	SELECT TOP 1 @CCURLOCID=VALUE FROM CONFIG WHERE CONFIG_OPTION='LOCATION_ID'
	
	
	IF NOT EXISTS ( SELECT A.USER_CODE FROM INSERTED A JOIN LOCUSERS B ON A.USER_CODE=B.USER_CODE )
		INSERT LOCUSERS	( DEPT_ID, USER_CODE, LAST_UPDATE )  
		SELECT @CCURLOCID AS DEPT_ID,USER_CODE,GETDATE() AS LAST_UPDATE FROM INSERTED
		where ISNULL(viewLoginLocationMode,0)=1 
END
