CREATE PROCEDURE SP_DEBTOR_REMINDER 

	@NQUERYID	NUMERIC (3,0) ,
	@CMEMOID	VARCHAR(40) = '',
	@CWHERE	VARCHAR(500) = ''
	
AS
BEGIN

IF @NQUERYID = 1
GOTO LBLGETMASTER

ELSE IF @NQUERYID = 2
GOTO LBLDETAILS

ELSE IF @NQUERYID =3
GOTO LBLSUBDETAILS

ELSE IF @NQUERYID =4
GOTO LBLLEDGER
ELSE
  GOTO LAST
  
LBLGETMASTER:

	SELECT A.*,CT.CITY,ST.STATE,HD.HEAD_NAME,LM.AC_NAME,U.USERNAME 
	FROM DEBTOR_REMINDER_MST A(NOLOCK)
	JOIN USERS (NOLOCK) U ON U.USER_CODE=A.USER_CODE
	LEFT OUTER JOIN STATE (NOLOCK) ST ON ST.STATE_CODE=A.FILTER_STATE_CODE
	LEFT OUTER JOIN CITY (NOLOCK) CT ON CT.CITY_CODE=A.FILTER_CITY_CODE
	LEFT OUTER JOIN LMV01106 (NOLOCK) LM ON LM.AC_CODE=A.FILTER_AC_CODE
	LEFT OUTER JOIN HD01106 (NOLOCK) HD ON HD.HEAD_CODE=A.FILTER_HEAD_CODE
	WHERE A.MEMO_ID=@CMEMOID


GOTO LAST

LBLDETAILS:

	SELECT  A.*,LM.AC_NAME,LM.ALIAS,LM.ADDRESS0,LM.ADDRESS1,LM.ADDRESS2,LM.AREA_NAME,
	LM.PINCODE,LM.CITY,LM.STATE,LM.CST_NO,LM.CST_DT,MST.MEMO_NO,
	LM.SST_NO,LM.SST_DT,LM.TIN_NO,LM.TIN_DT,LM.PHONES_R,LM.PHONES_O,LM.PHONES_FAX
	FROM DEBTOR_REMINDER_DET A (NOLOCK)
	JOIN DEBTOR_REMINDER_MST (NOLOCK) MST ON MST.MEMO_ID=A.MEMO_ID
	JOIN LMV01106 (NOLOCK) LM ON LM.AC_CODE=A.AC_CODE
	WHERE A.MEMO_ID=@CMEMOID
	
GOTO LAST


LBLSUBDETAILS:

	SELECT  A.*,CONVERT(BIT,0) AS CHK
	FROM DEBTOR_REMINDER_BILL_DET A (NOLOCK)
	JOIN DEBTOR_REMINDER_DET (NOLOCK) B ON B.AC_CODE=A.AC_CODE AND B.MEMO_ID=A.MEMO_ID
	JOIN DEBTOR_REMINDER_MST (NOLOCK) C ON C.MEMO_ID=A.MEMO_ID
	WHERE A.MEMO_ID=@CMEMOID
	
GOTO LAST


LBLLEDGER:

DECLARE @CHEADCODESTR VARCHAR(1000)
	SELECT @CHEADCODESTR = DBO.FN_ACT_TRAVTREE('0000000018')
	SELECT AC_CODE, AC_NAME, ADDRESS0,ADDRESS1,ADDRESS2 AREA_NAME , CITY, [STATE],PINCODE ,
	ISNULL(DISCOUNT_PERCENTAGE,0) AS DISCOUNT_PERCENTAGE,INV_RATE_TYPE,FORM_ID, 
	ISNULL(DEFAULT_RATE_TYPE,1) AS DEFAULT_RATE_TYPE,BROKER_AC_CODE,RESTRICT_PUR_ENTRY,
	ISNULL(WSL_RATE_CALC_METHOD,1)AS WSL_RATE_CALC_METHOD   
	FROM LMV01106   (NOLOCK)
	WHERE (CHARINDEX(HEAD_CODE,@CHEADCODESTR)>0
	OR ALLOW_CREDITOR_DEBTOR=1) AND AC_CODE <>'0000000000'
	AND INACTIVE=0
	ORDER BY AC_NAME 
GOTO LAST

LAST:
END
