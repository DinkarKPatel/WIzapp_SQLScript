CREATE PROCEDURE SP_RETAILSALE_30--(LocId 3 digit change only increased the parameter width by Sanjay:01-11-2024)
(  
	 @CQUERYID			NUMERIC(2),  
	 @CWHERE			VARCHAR(MAX)='',  
	 @CFINYEAR			VARCHAR(5)='',  
	 @CDEPTID			VARCHAR(4)='',  
	 @NNAVMODE			NUMERIC(2)=1,  
	 @CWIZAPPUSERCODE	VARCHAR(10)='',  
	 @CREFMEMOID		VARCHAR(40)='',  
	 @CREFMEMODT		DATETIME='',  
	 @BINCLUDEESTIMATE	BIT=1,  
	 @CFROMDT			DATETIME='',  
	 @CTODT				VARCHAR(50)='',
	 @bCardDiscount		BIT=0,
	 @cCustCode			VARCHAR(15)=''
) 
AS  
BEGIN  
    SELECT TOP 1 A.CM_ID ,A.EMP_CODE,A.EMP_CODE1,A.EMP_CODE2,ISNULL(EMP1.EMP_NAME,'') AS EMP_NAME,
    ISNULL(EMP2.EMP_NAME,'') AS EMP_NAME1 ,ISNULL(EMP3.EMP_NAME,'') AS EMP_NAME2
	FROM CMD01106 A (NOLOCK)
	JOIN CMM01106 B (NOLOCK) ON A.CM_ID= B.CM_ID 
	LEFT OUTER JOIN EMPLOYEE EMP1 ON EMP1.EMP_CODE=A.EMP_CODE
	LEFT OUTER JOIN EMPLOYEE EMP2 ON EMP2.EMP_CODE=A.EMP_CODE1
	LEFT OUTER JOIN EMPLOYEE EMP3 ON EMP3.EMP_CODE=A.EMP_CODE2
	WHERE B.cancelled=0 AND a.quantity>0 AND A.PRODUCT_CODE = @CWHERE
	ORDER BY b.cm_dt desc

end
