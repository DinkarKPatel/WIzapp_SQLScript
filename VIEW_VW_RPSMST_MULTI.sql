CREATE VIEW [DBO].[VW_RPSMST_MULTI]  

AS  
SELECT    
  MST.CM_ID AS MST_MEMO_ID,  
  MST.CM_NO AS MST_MEMO_NO,  
  MST.CM_DT AS MST_XN_DT,  
  MST.FIN_YEAR AS MST_FIN_YEAR,  
  MST.SUBTOTAL AS CAL_SUBTOTAL, 
  MST.NET_AMOUNT AS CAL_NET_AMOUNT,  
  MST.REMARKS AS MST_REMARKS,   
  E.USERNAME AS MST_USERNAME,  
  B.PRODUCT_CODE,  
  ARTICLE_NO,  
  B.QUANTITY AS CAL_QUANTITY,  
  UOM_NAME,  
  B.MRP AS CAL_MRP,  
  B.DISCOUNT_PERCENTAGE AS CAL_DISCOUNT_PERCENTAGE,  
  B.DISCOUNT_AMOUNT AS CAL_DISCOUNT_AMOUNT,  
  EMP1.EMP_NAME AS EMP_NAME, 
  EMP2.EMP_NAME AS EMP_NAME1, 
  EMP3.EMP_NAME AS EMP_NAME2, 
  'T'+(CASE WHEN B.TAX_PERCENTAGE=0 THEN 'F' WHEN ROUND(B.TAX_PERCENTAGE,0)=B.TAX_PERCENTAGE THEN LTRIM(RTRIM(STR(B.TAX_PERCENTAGE)))
							 ELSE LTRIM(RTRIM(STR(B.TAX_PERCENTAGE,6,2))) END) AS TAX_STATUS,  
  B.TAX_PERCENTAGE AS CAL_TAX_PERCENTAGE,  
  B.TAX_AMOUNT AS CAL_TAX_AMOUNT,  
  B.NET AS CAL_NET ,
  (CASE WHEN MST.REF_CM_ID ='' THEN 'PENDING' ELSE 'BILLED' END) AS MST_STATUS,
  RIGHT(MST.REF_CM_ID,10) AS MST_REF_MEMO_NO,
  (CASE WHEN MST.CANCELLED = 1 THEN 'CANCELLED' ELSE '' END) AS CANCELLED   
   ,MST.FIN_YEAR 
    ,MST.location_Code
FROM RPS_MST MST  
JOIN RPS_DET B ON B.CM_ID=MST.CM_ID  
--JOIN PMV01106 C ON C.PRODUCT_CODE=B.PRODUCT_CODE   --- OPTIMIZATION AFTER REMOVING VIEWS
JOIN SKU S ON S.PRODUCT_CODE=B.PRODUCT_CODE
JOIN ARTICLE ART ON ART.ARTICLE_CODE=S.ARTICLE_CODE
JOIN UOM ON UOM.UOM_CODE=ART.UOM_CODE
JOIN USERS E ON E.USER_CODE = MST.USER_CODE  
JOIN EMPLOYEE EMP1 ON EMP1.EMP_CODE= B.EMP_CODE  
JOIN EMPLOYEE EMP2 ON EMP2.EMP_CODE= B.EMP_CODE1
JOIN EMPLOYEE EMP3 ON EMP3.EMP_CODE= B.EMP_CODE2
