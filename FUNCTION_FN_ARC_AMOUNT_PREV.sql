CREATE FUNCTION FN_ARC_AMOUNT_PREV ( @CADJBILLID VARCHAR(40),@DRECEIPTDT DATETIME )
RETURNS NUMERIC(10,2)
--WITH ENCRYPTION
AS
BEGIN
	DECLARE @NARCAMOUNT NUMERIC(10,2)
	
	SELECT @NARCAMOUNT = SUM(RECEIPT_AMOUNT) FROM CMM_CREDIT_RECEIPT A
	JOIN ARC01106 B ON A.ADV_REC_ID=B.ADV_REC_ID
	WHERE A.CM_ID = @CADJBILLID AND B.CANCELLED = 0 AND B.ADV_REC_DT<=@DRECEIPTDT

	IF @NARCAMOUNT IS NULL
		SET @NARCAMOUNT = 0

	RETURN @NARCAMOUNT
END
