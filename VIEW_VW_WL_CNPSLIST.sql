CREATE VIEW VW_WL_CNPSLIST      
  
AS       
SELECT  T3.AC_NAME AS SUPPLIER_NAME,    
CASE WHEN T1.PS_MODE=1  THEN 'PARTY CREDIT NOTE' WHEN T1.PS_MODE=2 THEN 'GROUP CREDIT NOTE' ELSE '' END AS MEMO_MODE,     
T1.PS_DT AS MEMO_DT, T1.PS_NO AS MEMO_NO,              
T1.REMARKS ,       
(CASE WHEN T1.CANCELLED = 1 THEN 0 ELSE ISNULL(T2.TOTAL_QUANTITY,0) END) AS TOTAL_QUANTITY, 
(CASE WHEN T1.CANCELLED = 1 THEN 0 ELSE ISNULL(T1.TOTAL_QUANTITY_STR,0) END) AS TOTAL_QUANTITY_STR,         
        
T1.PS_ID AS MEMO_ID,    
(CASE WHEN T1.CANCELLED = 1 THEN 'CANCELLED' ELSE '' END) AS CANCELLED  ,    
T1.FIN_YEAR  ,COM.COMPANY_CODE,  
L.DEPT_ID  AS LOC_ID,L.DEPT_NAME AS LOC_NAME ,T1.location_Code    
FROM CNPS_MST T1      
JOIN LMV01106 T3 ON T3.AC_CODE = T1.AC_CODE        
LEFT OUTER JOIN       
(SELECT PS_ID,SUM(QUANTITY) AS TOTAL_QUANTITY   
 FROM CNPS_DET GROUP BY PS_ID)     
 T2 ON T2.PS_ID=T1.PS_ID     
 LEFT OUTER JOIN COMPANY COM ON 1=1 AND COM.COMPANY_CODE='01'    
 LEFT OUTER JOIN LOCATION  L (NOLOCK) ON T1.location_code/*LEFT(T1.PS_ID,2)*//*Rohit 05-11-2024*/ = L.DEPT_ID
