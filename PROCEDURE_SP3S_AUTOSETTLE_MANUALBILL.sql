CREATE PROCEDURE SP3S_AUTOSETTLE_MANUALBILL 
AS
BEGIN
	DECLARE @CCMID VARCHAR(40),@CERRMSG VARCHAR(MAX)
	
	SET @CERRMSG = ''
	RETURN
	--*/CHANGES ON 12.08.15  PROBLEM IN SUVIDHA BY DISCUSS SANJEEV SIR
	IF CURSOR_STATUS('GLOBAL','MANUALBILLCUR') IN (0,1)	
	BEGIN
		CLOSE MANUALBILLCUR
		DEALLOCATE MANUALBILLCUR
	END
		
	DECLARE MANUALBILLCUR CURSOR FOR SELECT DISTINCT B.CM_ID FROM CMD_MANUALBILL_ERRORS A (NOLOCK)	
	JOIN CMD01106 B ON A.CMD_ROW_ID=B.ROW_ID
	JOIN CMM01106 C ON B.CM_ID=C.CM_ID
	WHERE  C.MANUAL_BILL=1 AND C.CANCELLED=0
	
	OPEN MANUALBILLCUR
	FETCH NEXT FROM MANUALBILLCUR INTO @CCMID
	WHILE @@FETCH_STATUS=0
	BEGIN
		SET @CERRMSG = ''
		
		EXEC SP3S_VALIDATE_MANUALBILL 
		@NMODE=2,
		@CCMID=@CCMID,
		@CERRMSG=@CERRMSG OUTPUT
		
		IF ISNULL(@CERRMSG,'')<>''
			BREAK	
			
		FETCH NEXT FROM MANUALBILLCUR INTO @CCMID
	END
	
		
	CLOSE MANUALBILLCUR
	DEALLOCATE MANUALBILLCUR

	SELECT ISNULL(@CERRMSG,'') AS ERRMSG	
END
---- END OF PROCEDURE SP3S_AUTOSETTLE_MANUALBILL
