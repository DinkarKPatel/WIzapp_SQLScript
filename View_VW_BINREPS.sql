CREATE VIEW VW_BINREPS    
AS    
 SELECT  A.DEPT_ID,    
   'OPS' AS XN_TYPE,   
   CAST('IN'   AS VARCHAR(10)) AS XNGROUP,
   XN_DT,     
   A.PRODUCT_CODE AS PRODUCT_CODE,       
   A.QUANTITY_OB AS XN_QTY,       
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME AS SOURCE,
   B1.BIN_NAME AS TARGET,
   'Opening Stock' AS TRANSACTION_NAME
 FROM OPS01106 A WITH (NOLOCK)
 JOIN sku b (NOLOCK) ON a.product_code=b.product_code
 JOIN article c (NOLOCK) ON c.article_code=b.article_code
 JOIN sectionD d (NOLOCK) ON d.sub_section_code=c.sub_section_code
 JOIN sectionm e (NOLOCK) ON e.section_code=d.section_code
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =ISNULL(A.BIN_ID,'000')
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID 
 WHERE ISNULL(e.ITEM_TYPE,0) in (0,1)   
 -- DCO    
 UNION ALL    
   
 SELECT C.MAJOR_DEPT_ID AS DEPT_ID,    
   'DCO' AS XN_TYPE,    
   'OUT' AS XNGROUP, 
   B.MEMO_DT   AS XN_DT,       
   A.PRODUCT_CODE AS PRODUCT_CODE,       
   (-1)*A.QUANTITY AS XN_QTY,         
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME  AS SOURCE,
   B3.BIN_NAME AS TARGET,
   'Bin Issue' AS TRANSACTION_NAME
 FROM FLOOR_ST_DET A WITH (NOLOCK)
 JOIN FLOOR_ST_MST B WITH (NOLOCK) ON A.MEMO_ID  = B.MEMO_ID      
 JOIN LOCATION C WITH (NOLOCK) ON C.DEPT_ID=B.location_Code  /*LEFT(A.MEMO_ID,2) *//*Rohit 04-11-2024*/
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =A.SOURCE_BIN_ID
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID 
 JOIN BIN B3 (NOLOCK) ON B3.BIN_ID =A.ITEM_TARGET_BIN_ID
 WHERE  B.CANCELLED = 0    
     
 -- DCI    
 UNION ALL    
 SELECT C.MAJOR_DEPT_ID AS DEPT_ID,    
   'DCI' AS XN_TYPE,  
   'IN' AS XNGROUP,    
   B.MEMO_DT   AS XN_DT,     
   A.PRODUCT_CODE AS PRODUCT_CODE,        
   A.QUANTITY AS XN_QTY,         
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   B3.BIN_NAME  AS SOURCE,
   B1.BIN_NAME AS TARGET ,  
   'Bin Recieve' AS TRANSACTION_NAME  
 FROM FLOOR_ST_DET A (NOLOCK)    
 JOIN FLOOR_ST_MST B (NOLOCK) ON A.MEMO_ID  = B.MEMO_ID      
 JOIN LOCATION C (NOLOCK) ON C.DEPT_ID= B.location_Code  /*LEFT(A.MEMO_ID,2) *//*Rohit 04-11-2024*/
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =A.ITEM_TARGET_BIN_ID
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID 
 JOIN BIN B3 (NOLOCK) ON B3.BIN_ID =A.SOURCE_BIN_ID
 WHERE  B.CANCELLED = 0 AND ISNULL(B.RECEIPT_DT,'')<>''     
         
 -- PURCHASE INVOICE    
 UNION ALL    
 
 --CREATE NONCLUSTERED INDEX IX_PCODE_PID01106_INCL ON [dbo].[pid01106] ([product_code]) INCLUDE ([quantity],[mrr_id],[TAX_AMOUNT])
 SELECT B.DEPT_ID,    
 (CASE WHEN  (B.INV_MODE IN (0,1)) THEN 'PUR' ELSE 'CHI' END) AS XN_TYPE,  
  'IN' AS XNGROUP,      
  B.RECEIPT_DT AS XN_DT,       
  A.PRODUCT_CODE AS PRODUCT_CODE,     
  A.QUANTITY AS XN_QTY,    
  B1.BIN_NAME AS XN_BIN,
  B2.BIN_NAME AS XN_ZONE ,
  (CASE WHEN  (B.INV_MODE IN (0,1)) THEN LM.AC_NAME  ELSE L.DEPT_NAME END)  AS SOURCE,
  B1.BIN_NAME AS TARGET ,
  (CASE WHEN  (B.INV_MODE IN (0,1)) THEN 'Party Purchase' ELSE 'Challan In' END) AS TRANSACTION_NAME
 FROM PID01106 A WITH(NOLOCK)    
 JOIN PIM01106 B WITH(NOLOCK) ON A.MRR_ID = B.MRR_ID
 LEFT OUTER JOIN pim01106 c (NOLOCK) ON c.ref_converted_mrntobill_mrrid=b.mrr_id
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =B.BIN_ID
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID 
 LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =B.ac_code 
 LEFT JOIN location L (NOLOCK) ON L.dept_id =B.location_Code  /*LEFT(B.inv_id,2)*//*Rohit 04-11-2024*/
 WHERE B.CANCELLED = 0 AND c.mrr_id IS NULL
 AND A.PRODUCT_CODE<>'' AND B.RECEIPT_DT<>''
 AND ISNULL(B.xn_item_type,0) in (0,1) 
 
 UNION ALL
 SELECT B.location_Code  /*LEFT(B.MEMO_ID,2) *//*Rohit 04-11-2024*/ AS DEPT_ID ,    
 'GRNPSIN' AS XN_TYPE,  
  'IN' AS XNGROUP,     
 B.MEMO_DT AS XN_DT,     
 A.PRODUCT_CODE AS PRODUCT_CODE,     
 A.QUANTITY AS XN_QTY,    
 B1.BIN_NAME AS XN_BIN,
 B2.BIN_NAME AS XN_ZONE ,
 LM.AC_NAME   AS SOURCE,
 B1.BIN_NAME AS TARGET ,
 'Goods Receipt Note in' AS TRANSACTION_NAME 
 FROM GRN_PS_DET  A WITH(NOLOCK)    
 JOIN GRN_PS_MST B WITH(NOLOCK) ON A.MEMO_ID  = B.MEMO_ID
 JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =B.ac_code 
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =B.BIN_ID
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID 
 WHERE B.CANCELLED = 0 
 
 UNION ALL
 SELECT B.DEPT_ID,    
 'GRNPSOUT' AS XN_TYPE,  
 'OUT' AS XNGROUP,    
 B.RECEIPT_DT AS XN_DT,     
 A.PRODUCT_CODE AS PRODUCT_CODE,     
  (-1)*A.QUANTITY AS XN_QTY,    
 B1.BIN_NAME AS XN_BIN,
 B2.BIN_NAME AS XN_ZONE ,
 LM.AC_NAME  AS SOURCE,
 B1.BIN_NAME AS TARGET ,
 'Goods Receipt Note out' AS TRANSACTION_NAME   
 FROM PID01106 A WITH(NOLOCK)    
 JOIN PIM01106 B WITH(NOLOCK) ON A.MRR_ID = B.MRR_ID
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =B.BIN_ID
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID 
 JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =B.ac_code 
 WHERE B.CANCELLED = 0 
 AND A.PRODUCT_CODE<>'' AND B.RECEIPT_DT<>''
 AND ISNULL(B.PIM_MODE,0)=6
 AND ISNULL(B.xn_item_type,0) in (0,1) 
 
 -- PURCHASE RETURN    
 UNION ALL    
 SELECT C.MAJOR_DEPT_ID AS DEPT_ID,    
   (CASE WHEN MODE=2 THEN 'CHO'  
    ELSE 'PRT' END) AS XN_TYPE,
   'OUT' AS XNGROUP,      
   B.RM_DT AS XN_DT,     
   A.PRODUCT_CODE AS PRODUCT_CODE,     
   (-1)*A.QUANTITY AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME  AS SOURCE,
   CASE WHEN B.MODE =1 THEN LM.AC_NAME ELSE TL.DEPT_NAME END AS TARGET   ,
   (CASE WHEN MODE=2 THEN 'Challan Out'  
    ELSE 'Purchase Return' END) AS TRANSACTION_NAME
 FROM RMD01106 A WITH(NOLOCK)
 JOIN RMM01106 B WITH(NOLOCK) ON A.RM_ID = B.RM_ID    
 JOIN LOCATION C WITH(NOLOCK) ON C.DEPT_ID=  B.location_Code  /*LEFT(A.RM_ID,2) *//*Rohit 04-11-2024*/
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =A.BIN_ID
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID 
 JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =B.ac_code 
 LEFT JOIN LOCATION TL WITH(NOLOCK) ON TL.DEPT_ID=B.PARTY_DEPT_ID 
 WHERE B.CANCELLED = 0 AND B.DN_TYPE IN (0,1) AND ISNULL(C.SIS_LOC,0)<>1 
 AND ISNULL(B.xn_item_type,0) in (0,1)  
 
   
 ---RETAIL SALE     
 UNION ALL    
 --CREATE NONCLUSTERED INDEX IX_CAN_CMM_INCL ON [dbo].[cmm01106] ([CANCELLED]) INCLUDE ([CM_NO],[CM_DT],[DISCOUNT_PERCENTAGE],[CUSTOMER_CODE],[cm_id])
 SELECT C.MAJOR_DEPT_ID AS DEPT_ID,    
   ( CASE WHEN A.QUANTITY > 0 THEN 'SLS' ELSE 'SLR' END) AS XN_TYPE, 
   ( CASE WHEN A.QUANTITY > 0 THEN 'OUT' ELSE 'IN' END) AS XNGROUP,     
   B.CM_DT AS XN_DT,    
   A.PRODUCT_CODE AS PRODUCT_CODE,         
  ( CASE WHEN A.QUANTITY > 0 THEN -1 ELSE 1 END)* abs(A.QUANTITY) AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME   AS SOURCE,
   ISNULL(CM.CUSTOMER_FNAME,'') +ISNULL(CM.CUSTOMER_LNAME,'')   AS TARGET ,
   ( CASE WHEN A.QUANTITY > 0 THEN 'Sale' ELSE 'Sale Return' END) AS TRANSACTION_NAME
 FROM CMD01106 A WITH(NOLOCK)    
 JOIN CMM01106 B WITH(NOLOCK) ON A.CM_ID = B.CM_ID    
 JOIN LOCATION C WITH(NOLOCK) ON C.DEPT_ID=B.location_Code  /*LEFT(A.CM_ID,2) *//*Rohit 04-11-2024*/
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =A.BIN_ID
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID 
 JOIN CUSTDYM CM (NOLOCK) ON CM.CUSTOMER_CODE =B.CUSTOMER_CODE 
 WHERE B.CANCELLED = 0  
 AND ISNULL(B.xn_item_type,0) in (0,1)    
   
 ------ RETAIL SALE -PACKING SLIP    
 ----UNION ALL    
 ----SELECT LEFT(B.CM_ID,2) AS DEPT_ID,    
 ----  ( CASE WHEN A.QUANTITY > 0 THEN 'SLS' ELSE 'SLR' END) AS XN_TYPE,     
 ----  B.CM_DT AS XN_DT,    
 ----  B.CM_NO AS XN_NO,    
 ----  B.CM_ID AS XN_ID,  
 ----  A.PRODUCT_CODE,    
 ----  '' AS XN_PARTY_CODE,     
 ----  ABS(A.QUANTITY) AS XN_QTY,    
 ----  ABS(A.RFNET) AS XN_NET,    
 ----  ((A.QUANTITY*A.MRP)-(A.NET - (A.NET * B.DISCOUNT_PERCENTAGE/100)))*    
 ----  (CASE WHEN A.QUANTITY>0 THEN 1 ELSE -1 END) AS XN_DA,A.TAX_AMOUNT    
 ----  ,A.BIN_ID  AS [BIN_ID]   
 ----FROM RPS_DET A (NOLOCK)    
 ----JOIN RPS_MST B (NOLOCK) ON A.CM_ID = B.CM_ID  
 ----LEFT OUTER JOIN PACK_SLIP_RF C (NOLOCK) ON C.PACK_SLIP_ID=A.CM_ID  
 ----WHERE B.CANCELLED = 0  AND C.CM_ID IS NULL  
   
 -- APPROVAL ISSUE    
 UNION ALL    
 SELECT B.location_Code  /*LEFT(B.MEMO_ID,2) *//*Rohit 04-11-2024*/ AS DEPT_ID,    
   'APP' AS XN_TYPE,    
   'OUT' AS XNGROUP, 
   B.MEMO_DT AS XN_DT,    
   A.PRODUCT_CODE AS PRODUCT_CODE,    
  -- (CASE WHEN B.MEMO_TYPE=1 THEN 'CUS'+B.CUSTOMER_CODE ELSE 'LM'+B.AC_CODE END) AS XN_PARTY_CODE,     
   (-1)*ABS(A.QUANTITY) AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME   AS SOURCE,
   (CASE WHEN B.MEMO_TYPE=1 THEN isnull(CM.CUSTOMER_FNAME,'') +isnull(cm.customer_lname,'') ELSE LM.AC_NAME  END)   AS TARGET ,
   'Approval Issue' AS TRANSACTION_NAME
 FROM APD01106 A WITH(NOLOCK)    
 JOIN APM01106 B WITH(NOLOCK) ON A.MEMO_ID = B.MEMO_ID   
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =A.BIN_ID
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID  
 LEFT JOIN CUSTDYM CM (NOLOCK) ON CM.CUSTOMER_CODE =B.CUSTOMER_CODE 
 LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =B.AC_CODE 
 WHERE B.CANCELLED = 0    
   
 -- APPROVAL RETURN    
 UNION ALL    
 SELECT C.location_Code  /*LEFT(C.MEMO_ID,2) *//*Rohit 04-11-2024*/AS DEPT_ID,    
   'APR' AS XN_TYPE,    
   'IN' AS XNGROUP,
   C.MEMO_DT AS XN_DT,     
   B.PRODUCT_CODE AS PRODUCT_CODE,    
   ABS(A.QUANTITY) AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   (CASE WHEN C.MODE=1 THEN isnull(CM.CUSTOMER_FNAME,'') +isnull(cm.customer_lname,'') ELSE LM.AC_NAME END) AS SOURCE,
   B1.BIN_NAME   AS TARGET, 
   'Approval Return' AS TRANSACTION_NAME
 FROM APPROVAL_RETURN_DET A WITH(NOLOCK)    
 JOIN APD01106 B WITH(NOLOCK) ON A.APD_ROW_ID = B.ROW_ID    
 JOIN APPROVAL_RETURN_MST C WITH(NOLOCK) ON C.MEMO_ID = A.MEMO_ID  
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =A.BIN_ID
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID  
 LEFT JOIN CUSTDYM CM (NOLOCK) ON CM.CUSTOMER_CODE =C.CUSTOMER_CODE 
 LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =C.AC_CODE  
 WHERE  C.CANCELLED = 0    
     
 -- CANCELLATION AND STOCK ADJUSTMENT    
 UNION ALL    
 SELECT C.MAJOR_DEPT_ID AS DEPT_ID,    
 (CASE WHEN B.STOCK_ADJ_NOTE=1 THEN 
	(CASE WHEN ISNULL(b.stock_adj_type,0) IN (0,1) THEN 
		   (CASE WHEN B.CNC_TYPE=1 THEN 'SAC' ELSE 'SAU' END)  
	 ELSE
		   (CASE WHEN B.CNC_TYPE=1 THEN 'SACM' ELSE 'SAUM' END)  
	 END)
 ELSE
 (CASE WHEN B.CNC_TYPE=1 THEN 'CNC' ELSE 'UNC' END) 	   	
  END) AS XN_TYPE,
   CASE WHEN B.CNC_TYPE=1 THEN 'OUT' ELSE 'IN' END AS XNGROUP,
   B.CNC_MEMO_DT AS XN_DT,    
   A.PRODUCT_CODE AS PRODUCT_CODE,    
   (CASE WHEN B.CNC_TYPE=1 THEN -1 ELSE 1 END)*A.QUANTITY AS XN_QTY ,   
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME AS SOURCE,
   B1.BIN_NAME   AS TARGET,
   CASE WHEN B.CNC_TYPE=1 THEN 'Cancel' ELSE 'UN Cancel' END AS TRANSACTION_NAME
 FROM ICD01106 A WITH(NOLOCK)    
 JOIN ICM01106 B WITH(NOLOCK) ON A.CNC_MEMO_ID = B.CNC_MEMO_ID    
 JOIN SKU WITH(NOLOCK) ON SKU.PRODUCT_CODE=A.PRODUCT_CODE  
 JOIN ARTICLE D WITH(NOLOCK) ON D.ARTICLE_CODE=SKU.ARTICLE_CODE  
 JOIN LOCATION C WITH(NOLOCK) ON C.DEPT_ID= B.location_Code  /*LEFT(A.CNC_MEMO_ID,2)*//*Rohit 04-11-2024*/ 
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =A.BIN_ID
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID 
 WHERE B.CANCELLED = 0 AND   ISNULL(B.xn_item_type,0) in (0,1)   
     
 --WHOLESALE INVOICE    
 UNION ALL    
 SELECT B.DEPT_ID AS DEPT_ID,    
   (CASE WHEN B.INV_MODE=2 THEN 'CHO' ELSE (CASE WHEN B.BIN_TRANSFER=1 THEN 'APO' ELSE 'WSL' END) END)  AS XN_TYPE,
   'OUT' AS XNGROUP,
   B.INV_DT AS XN_DT,     
   A.PRODUCT_CODE AS PRODUCT_CODE,         
   (-1)*ABS(A.QUANTITY) AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME  AS SOURCE,
   (CASE WHEN B.INV_MODE=2 THEN TL.DEPT_NAME  ELSE LM.AC_NAME  END)    AS TARGET,
   (CASE WHEN B.INV_MODE=2 THEN 'Challan Out' ELSE 'Wholesale Invoice' END) AS TRANSACTION_NAME
 FROM IND01106 A WITH(NOLOCK)    
 JOIN INM01106 B WITH(NOLOCK) ON A.INV_ID = B.INV_ID    
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =A.BIN_ID
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID 
 LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =B.ac_code 
 LEFT JOIN location tl (NOLOCK) ON tl.dept_id =b.party_dept_id 
 WHERE B.CANCELLED = 0 
 AND ISNULL(B.xn_item_type,0) in (0,1) --AND B.ENTRY_MODE<>2  
 
  --ADD NEW FOR PACKSLIP RETURN
  UNION ALL
  
 SELECT B.DEPT_ID AS DEPT_ID,    
   'WPR'  AS XN_TYPE,  
   'IN' AS XNGROUP,  
   B.INV_DT AS XN_DT,    
   A.PRODUCT_CODE AS PRODUCT_CODE,    
   --'LM'+B.AC_CODE AS XN_PARTY_CODE,     
   A.QUANTITY AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   LM.AC_NAME   AS SOURCE,
   B1.BIN_NAME    AS TARGET,
   'Wholesale Pack Slip Return' AS TRANSACTION_NAME  
 FROM IND01106 A WITH(NOLOCK)   
 JOIN INM01106 B WITH(NOLOCK) ON A.INV_ID = B.INV_ID 
 JOIN 
 (SELECT DET.PS_ID, DET.BIN_ID,C.PS_NO,DET.PRODUCT_CODE 
  FROM WPS_DET DET WITH(NOLOCK)
  JOIN WPS_MST C WITH(NOLOCK) ON DET.PS_ID =C.PS_ID    
  WHERE C.CANCELLED = 0 AND ISNULL(DET.PS_ID,'')<>'' 
  GROUP BY DET.PS_ID, DET.BIN_ID,C.PS_NO,DET.PRODUCT_CODE
 ) DET ON A.PRODUCT_CODE=DET.PRODUCT_CODE AND A.PS_ID=DET.PS_ID AND a.BIN_ID=det.BIN_ID
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =DET.BIN_ID
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID 
 JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =B.ac_code 
 WHERE B.CANCELLED = 0  AND ISNULL(B.xn_item_type,0) in (0,1)  
     
 
 --PURCHASE FOR TARGET BIN THRU WHOLESALE INVOICE MARKED AS BIN TRANSFER  
 UNION ALL    
 SELECT C.MAJOR_DEPT_ID AS DEPT_ID,    
   'API' AS XN_TYPE,  
   'OUT' AS XNGROUP,   
   B.INV_DT AS XN_DT,    
   A.PRODUCT_CODE AS PRODUCT_CODE,    
   --'LM'+B.AC_CODE AS XN_PARTY_CODE,     
  (-1)* A.QUANTITY AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   B3.BIN_NAME    AS SOURCE,
   B2.BIN_NAME    AS TARGET,
   'Bin Issue' AS TRANSACTION_NAME  
 FROM IND01106 A WITH(NOLOCK)    
 JOIN INM01106 B WITH(NOLOCK) ON A.INV_ID = B.INV_ID    
 JOIN LOCATION C WITH(NOLOCK) ON C.DEPT_ID=B.location_Code  /*LEFT(A.INV_ID,2) *//*Rohit 04-11-2024*/
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =B.TARGET_BIN_ID
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID 
 JOIN BIN B3 (NOLOCK) ON B3.BIN_ID  =A.BIN_ID   
 WHERE B.CANCELLED = 0 AND B.BIN_TRANSFER=1  
 AND B.ENTRY_MODE<>2   AND ISNULL(B.xn_item_type,0) in (0,1) 
    
 ----WHOLESALE PACKSLIP    
 UNION ALL    
 SELECT C.MAJOR_DEPT_ID AS DEPT_ID,    
   'WPI'  AS XN_TYPE, 
   'IN' AS XNGROUP,    
   B.PS_DT AS XN_DT,    
   A.PRODUCT_CODE AS PRODUCT_CODE,       
   A.QUANTITY AS XN_QTY, 
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   LM.AC_NAME    AS SOURCE,
   B1.BIN_NAME    AS TARGET,
   'Whosale Pack Slip Issue' AS TRANSACTION_NAME       
 FROM WPS_DET A WITH(NOLOCK)    
 JOIN WPS_MST B WITH(NOLOCK) ON A.PS_ID = B.PS_ID    
 JOIN LOCATION C WITH(NOLOCK) ON C.DEPT_ID=B.location_Code  /*LEFT(A.PS_ID,2) *//*Rohit 04-11-2024*/
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =A.BIN_ID
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID  
 JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =B.ac_code 
 WHERE B.CANCELLED = 0    
     
 ----WHOLESALE CREDIT NOTE    
 UNION ALL    
 --CREATE NONCLUSTERED INDEX IX_CAN_CNM01106_INCL ON [dbo].[cnm01106] ([cancelled],[CN_TYPE]) INCLUDE ([cn_id],[billed_from_dept_id],[mode],[receipt_dt],[BIN_TRANSFER],[cn_no],[cn_dt],[ac_code])
 SELECT LOC.MAJOR_DEPT_ID AS DEPT_ID,    
   (CASE WHEN MODE=2 THEN 'CHI'   
    ELSE   
    (CASE WHEN (B.BIN_TRANSFER=1 OR B.MODE=3) THEN 'API' ELSE 'WSR' END)  
    END) AS XN_TYPE,    
    'OUT' AS XNGROUP,    
   (CASE WHEN MODE=2 THEN B.RECEIPT_DT ELSE CN_DT END) AS XN_DT,     
   A.PRODUCT_CODE AS PRODUCT_CODE,     
   (-1)*A.QUANTITY AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   (CASE WHEN MODE=2 THEN sl.dept_name   ELSE   LM.AC_NAME  END) AS SOURCE,
   B1.BIN_NAME    AS TARGET,
   (CASE WHEN MODE=2 THEN 'Challan In'   
    ELSE   
    (CASE WHEN (B.BIN_TRANSFER=1 OR B.MODE=3) THEN 'Approval Issue' ELSE 'Whosale Return' END)  
    END) AS TRANSACTION_NAME
 FROM CND01106 A (NOLOCK)    
 JOIN CNM01106 B (NOLOCK) ON A.CN_ID = B.CN_ID    
 JOIN LOCATION LOC (NOLOCK) ON LOC.DEPT_ID=B.BILLED_FROM_DEPT_ID  
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =A.BIN_ID 
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID  
 JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =B.ac_code 
 LEFT JOIN location SL (NOLOCK) ON SL.dept_id =B.location_Code  /*LEFT(B.rm_id ,2)*//*Rohit 04-11-2024*/
 WHERE B.CANCELLED = 0 AND B.CN_TYPE<>2 AND (MODE<>2 OR B.RECEIPT_DT<>'')  
 AND ISNULL(B.xn_item_type,0) in (0,1)    
  
 ----PURCHASE RETURN FOR MBO LOCATION FROM WHOLESALE CREDIT NOTE MODULE  
 UNION ALL    
 SELECT (CASE WHEN B.BIN_TRANSFER=1 THEN B.location_Code  /*LEFT(B.CN_ID,2)*//*Rohit 04-11-2024*/ ELSE B.PARTY_DEPT_ID END) AS DEPT_ID,    
   (CASE WHEN B.BIN_TRANSFER=1 THEN 'APO' ELSE 'CHO' END) AS XN_TYPE, 
   'OUT' AS XNGROUP,    
   CN_DT AS XN_DT,     
   A.PRODUCT_CODE AS PRODUCT_CODE,    
   (-1)*A.QUANTITY AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME    AS SOURCE,
   LM.AC_NAME     AS TARGET,
  (CASE WHEN B.BIN_TRANSFER=1 THEN 'APO' ELSE 'Challan Out' END) AS TRANSACTION_NAME 
 FROM CND01106 A (NOLOCK)    
 JOIN CNM01106 B (NOLOCK) ON A.CN_ID = B.CN_ID    
 LEFT OUTER JOIN LOCATION C ON C.DEPT_ID=B.PARTY_DEPT_ID  
 JOIN (SELECT TOP 1 * FROM  config WHERE CONFIG_OPTION='LOCATION_ID') CL ON 1=1
 JOIN (SELECT TOP 1 * FROM  config WHERE CONFIG_OPTION='HO_LOCATION_ID') HL ON 1=1
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =B.SOURCE_BIN_ID 
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID  
 JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =B.ac_code 
 WHERE B.CANCELLED = 0 AND (B.BIN_TRANSFER=1 OR ISNULL(C.SIS_LOC,0)=1) 
 AND ISNULL(B.xn_item_type,0) in (0,1)  
  and (CL.value =HL.value or CL.value = (CASE WHEN B.BIN_TRANSFER=1 THEN B.location_Code  /*LEFT(B.CN_ID,2)*//*Rohit 04-11-2024*/ ELSE B.PARTY_DEPT_ID END))
    
 ---- GENERATION OF NEW BAR CODES IN RATE REVISION    
 UNION ALL     
 SELECT C.MAJOR_DEPT_ID AS DEPT_ID,    
   'PFI' AS XN_TYPE,    
   'IN' AS XNGROUP,
   B.IRM_MEMO_DT AS XN_DT,    
   A.NEW_PRODUCT_CODE AS PRODUCT_CODE,    
   ABS(A.QUANTITY) AS XN_QTY,     
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME    AS SOURCE,
   B1.BIN_NAME     AS TARGET,
   'Production of Finish Goods' AS TRANSACTION_NAME 
 FROM IRD01106 A (NOLOCK)    
 JOIN IRM01106 B (NOLOCK) ON A.IRM_MEMO_ID = B.IRM_MEMO_ID    
 JOIN LOCATION C (NOLOCK) ON C.DEPT_ID= B.location_Code  /*LEFT(A.IRM_MEMO_ID,2) *//*Rohit 04-11-2024*/
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =B.BIN_ID 
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID  
 WHERE A.NEW_PRODUCT_CODE<>''    
    
 ---- GENERATION OF NEW BAR CODES IN RATE REVISION    
 UNION ALL     
 SELECT C.MAJOR_DEPT_ID AS DEPT_ID,    
   'PFI' AS XN_TYPE,    
    'IN' AS XNGROUP,
   B.MEMO_DT AS XN_DT,       
   A.PRODUCT_CODE AS PRODUCT_CODE,    
   ABS(A.QUANTITY) AS XN_QTY,     
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME    AS SOURCE,
   B1.BIN_NAME     AS TARGET,
   'Production of Finish Goods' AS TRANSACTION_NAME 
 FROM SCF01106 A (NOLOCK)    
 JOIN SCM01106 B (NOLOCK) ON A.MEMO_ID = B.MEMO_ID    
 JOIN LOCATION C (NOLOCK) ON C.DEPT_ID= B.location_Code  /*LEFT(A.MEMO_ID,2) *//*Rohit 04-11-2024*/
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID ='000' 
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID  
 WHERE B.CANCELLED=0 AND A.PRODUCT_CODE<>''    
    
 ---- CONSUMPTION OF OLD BARCODES IN RATE REVISION    
 UNION ALL     
 SELECT C.MAJOR_DEPT_ID AS DEPT_ID,    
   'CIP' AS XN_TYPE,    
   'OUT' AS XNGROUP,
   B.IRM_MEMO_DT AS XN_DT,     
    A.PRODUCT_CODE AS PRODUCT_CODE,    
   (-1)*ABS(A.QUANTITY) AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME    AS SOURCE,
   B1.BIN_NAME     AS TARGET ,
   'Consume In Production' AS TRANSACTION_NAME      
 FROM IRD01106 A (NOLOCK)    
 JOIN IRM01106 B (NOLOCK) ON A.IRM_MEMO_ID = B.IRM_MEMO_ID    
 JOIN LOCATION C (NOLOCK) ON C.DEPT_ID=B.location_Code  /*LEFT(A.IRM_MEMO_ID,2)*//*Rohit 04-11-2024*/
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =A.BIN_ID  
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID    
 WHERE  A.NEW_PRODUCT_CODE<>''    
    
 ---- CONSUMPTION OF BARCODES IN SPLIT/COMBINE    
 UNION ALL     
 SELECT C.MAJOR_DEPT_ID AS DEPT_ID,    
   'CIP' AS XN_TYPE, 
   'OUT' AS XNGROUP,    
   B.MEMO_DT AS XN_DT,    
   A.PRODUCT_CODE AS PRODUCT_CODE,     
   (-1)*ABS(A.QUANTITY+ADJ_QUANTITY) AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME    AS SOURCE,
   B1.BIN_NAME     AS TARGET ,
   'Consume In Production' AS TRANSACTION_NAME      
 FROM SCC01106 A (NOLOCK)    
 JOIN SCM01106 B (NOLOCK) ON A.MEMO_ID = B.MEMO_ID    
 JOIN LOCATION C (NOLOCK) ON C.DEPT_ID= B.location_Code  /*LEFT(A.MEMO_ID,2) *//*Rohit 04-11-2024*/
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID ='000' 
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID    
 WHERE B.CANCELLED=0 AND A.PRODUCT_CODE<>''     
      
 ---- JOB WORK ISSUE    
  UNION ALL     
 SELECT LOC.MAJOR_DEPT_ID AS DEPT_ID,    
   'JWI' AS XN_TYPE, 
   'OUT' AS XNGROUP,   
   B.ISSUE_DT AS XN_DT,     
   A.PRODUCT_CODE AS PRODUCT_CODE,        
   (-1)*ABS(A.QUANTITY) AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME    AS SOURCE,
   LM.AC_NAME      AS TARGET,
   'Job Work Issue' AS TRANSACTION_NAME          
 FROM JOBWORK_ISSUE_DET A (NOLOCK)    
 JOIN JOBWORK_ISSUE_MST B (NOLOCK) ON A.ISSUE_ID = B.ISSUE_ID    
 JOIN PRD_AGENCY_MST D (NOLOCK) ON D.AGENCY_CODE=B.AGENCY_CODE    
 JOIN SKU C (NOLOCK) ON C.PRODUCT_CODE=A.PRODUCT_CODE    
 JOIN LOCATION LOC (NOLOCK) ON LOC.DEPT_ID=  B.location_Code  /*LEFT(A.ISSUE_ID,2)*//*Rohit 04-11-2024*/
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =A.BIN_ID  
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID   
 JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =D.ac_code 
 WHERE  B.CANCELLED=0 AND B.ISSUE_TYPE=1  AND ISNULL(B.WIP,0)=0 
 AND ISNULL(B.ISSUE_MODE,0)<>1  
     
 ---- JOB WORK RECEIPT    
 UNION ALL     
 SELECT LOC.MAJOR_DEPT_ID AS DEPT_ID,    
   'JWR' AS XN_TYPE, 
   'IN' AS XNGROUP,      
   B.RECEIPT_DT AS XN_DT,    
   A.PRODUCT_CODE AS PRODUCT_CODE,      
   ABS(A.QUANTITY) AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   B2.BIN_NAME AS XN_ZONE ,
   LM.AC_NAME    AS SOURCE,
   B1.BIN_NAME   AS TARGET,
   'Job Work Receive' AS TRANSACTION_NAME 
 FROM JOBWORK_RECEIPT_DET A (NOLOCK)    
 JOIN JOBWORK_RECEIPT_MST B (NOLOCK) ON A.RECEIPT_ID = B.RECEIPT_ID    
 JOIN SKU C (NOLOCK) ON C.PRODUCT_CODE=A.PRODUCT_CODE    
 JOIN JOBWORK_ISSUE_DET D (NOLOCK) ON D.ROW_ID=A.REF_ROW_ID    
 JOIN JOBWORK_ISSUE_MST E (NOLOCK) ON E.ISSUE_ID = D.ISSUE_ID    
 JOIN LOCATION LOC (NOLOCK) ON LOC.DEPT_ID= B.location_Code  /*LEFT(A.RECEIPT_ID,2) *//*Rohit 04-11-2024*/
 JOIN PRD_AGENCY_MST PAM(NOLOCK) ON PAM.AGENCY_CODE=B.AGENCY_CODE  
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =A.BIN_ID  
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID   
 JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =PAM.ac_code 
 WHERE  B.CANCELLED=0 AND E.ISSUE_TYPE=1  AND ISNULL(B.WIP,0)=0  AND ISNULL(B.RECEIVE_MODE,0)<>1 
 UNION ALL    
 --CREATE NONCLUSTERED INDEX IX_WODRID_POD_INCL ON [dbo].[pod01106] ([wod_row_id]) INCLUDE ([quantity],[po_id])    
 SELECT  D.location_Code  /*LEFT(D.ORDER_ID,2)*//*Rohit 04-11-2024*/ AS DEPT_ID,          
 'BOC' AS XN_TYPE,  
  'OUT' AS XNGROUP,    
  D.ORDER_DT AS XN_DT,      
  E.PRODUCT_CODE AS PRODUCT_CODE,       
 (-1)*(E.CONS_QTY_PER_PICE*P.QUANTITY) AS XN_QTY,       
  B1.BIN_NAME AS XN_BIN,
  B2.BIN_NAME AS XN_ZONE ,
  B1.BIN_NAME     AS SOURCE,
  ISNULL(CM.CUSTOMER_FNAME,'')+ISNULL(CM.CUSTOMER_LNAME ,'')    AS TARGET,
  'Bill Of Material' AS TRANSACTION_NAME  
 FROM WSL_ORDER_BOM E(NOLOCK)     
 LEFT OUTER JOIN WSL_ORDER_DET C (NOLOCK) ON E.REF_ROW_ID=C.ROW_ID    
 LEFT OUTER JOIN WSL_ORDER_MST D (NOLOCK) ON C.ORDER_ID=D.ORDER_ID    
 JOIN POD01106 P ON C.ROW_ID = P.WOD_ROW_ID     
 JOIN POM01106 PM ON P.PO_ID = PM.PO_ID      
 LEFT OUTER JOIN SKU ON E.PRODUCT_CODE=SKU.PRODUCT_CODE   
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID ='000'  
 JOIN BIN B2 (NOLOCK) ON B1.major_bin_id =B2.BIN_ID   
 JOIN custdym  CM (NOLOCK) ON CM.customer_code  =D.CUSTOMER_CODE
 WHERE  PM.CANCELLED = 0    
    
 UNION ALL   
 -- FINISHED BARCODES IN SPLIT/COMBINE NEW(SCF : SPLIT COMBILE FINISHED)  
 SELECT B.location_Code  /*LEFT(A.MEMO_ID,2) *//*Rohit 04-11-2024*/ AS [DEPT_ID],    
   'SCF' AS XN_TYPE, 
   'IN' AS XNGROUP,   
   B.RECEIPT_DT AS XN_DT,    
   B2.PRODUCT_CODE AS PRODUCT_CODE,    
   (CASE WHEN S1.BARCODE_CODING_SCHEME=3 THEN B2.TOTAL_QTY ELSE A.QUANTITY END) AS XN_QTY,    
    B1.BIN_NAME AS XN_BIN,
    BI2.BIN_NAME AS XN_ZONE ,
    B1.BIN_NAME     AS SOURCE,
    B1.BIN_NAME    AS TARGET,
    'Split and Combined' AS TRANSACTION_NAME  
 FROM SNC_DET A (NOLOCK)    
 JOIN SNC_MST B (NOLOCK) ON A.MEMO_ID = B.MEMO_ID    
 JOIN  
 (  
 SELECT REFROW_ID AS [ROW_ID],PRODUCT_CODE,COUNT(*) AS [TOTAL_QTY]  
 FROM SNC_BARCODE_DET (NOLOCK)  
 GROUP BY REFROW_ID,PRODUCT_CODE  
 )B2 ON A.ROW_ID = B2.ROW_ID  
 JOIN ARTICLE A1 WITH(NOLOCK) ON A1.ARTICLE_CODE=A.ARTICLE_CODE 
 JOIN SKU S1(NOLOCK) ON S1.product_code=B2.PRODUCT_CODE 
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =A.BIN_ID  
 JOIN BIN BI2 (NOLOCK) ON B1.major_bin_id =BI2.BIN_ID 
 WHERE  B.WIP=0 AND B.CANCELLED=0 AND B2.PRODUCT_CODE<>''    
  
 UNION ALL     
 -- CONSUMPTION OF BARCODES IN SPLIT/COMBINE NEW(SCC : SPLIT COMBILE CONSUMPTION)    
 SELECT B.location_Code  /*LEFT(A.MEMO_ID,2) *//*Rohit 04-11-2024*/ AS [DEPT_ID],   
   'SCC' AS XN_TYPE,    
   'OUT' AS XNGROUP,   
   B.RECEIPT_DT AS XN_DT,    
   A.PRODUCT_CODE AS PRODUCT_CODE,       
   (-1)*ABS(A.QUANTITY) AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   BI2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME     AS SOURCE,
   B1.BIN_NAME    AS TARGET,
   'SPlit Combined Consumption' AS TRANSACTION_NAME       
 FROM SNC_CONSUMABLE_DET A (NOLOCK)    
 JOIN SNC_MST B (NOLOCK) ON A.MEMO_ID = B.MEMO_ID    
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =ISNULL(A.BIN_ID,'000')
 JOIN BIN BI2 (NOLOCK) ON B1.major_bin_id =BI2.BIN_ID 
 WHERE A.WIP=0 AND B.CANCELLED=0 AND A.PRODUCT_CODE<>''   
  
  UNION ALL  
  SELECT B.location_Code  /*LEFT(A.MEMO_ID,2) *//*Rohit 04-11-2024*/ AS [DEPT_ID],   
   'TTM' AS XN_TYPE,  
  'OUT' AS XNGROUP,  
  B.MEMO_DT AS XN_DT, 
   A.PRODUCT_CODE AS PRODUCT_CODE,       
   (-1)*ABS(A.QUANTITY) AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   BI2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME     AS SOURCE,
   B1.BIN_NAME    AS TARGET,
   'Transfer To Trading' AS TRANSACTION_NAME          
 FROM TRANSFER_TO_TRADING_DET A (NOLOCK)    
 JOIN TRANSFER_TO_TRADING_MST B (NOLOCK) ON A.MEMO_ID = B.MEMO_ID    
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =ISNULL(A.BIN_ID,'000')
 JOIN BIN BI2 (NOLOCK) ON B1.major_bin_id =BI2.BIN_ID 
 WHERE B.CANCELLED=0 AND A.PRODUCT_CODE<>''            

 ----DEBITNOTE PACKSLIP    
 UNION ALL    
 SELECT C.MAJOR_DEPT_ID AS DEPT_ID,    
   'DNPI'  AS XN_TYPE,  
    'OUT' AS XNGROUP,     
   B.PS_DT AS XN_DT,     
   A.PRODUCT_CODE AS PRODUCT_CODE,    
   (-1)*A.QUANTITY AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   BI2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME     AS SOURCE,
   LM.AC_NAME AS TARGET,
   'Debit note Packslip Issue' AS TRANSACTION_NAME             
 FROM DNPS_DET A (NOLOCK)    
 JOIN DNPS_MST B (NOLOCK) ON A.PS_ID = B.PS_ID    
 JOIN LOCATION C (NOLOCK) ON C.DEPT_ID=B.location_Code  /*LEFT(A.PS_ID,2)*//*Rohit 04-11-2024*/
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =A.BIN_ID
 JOIN BIN BI2 (NOLOCK) ON B1.major_bin_id =BI2.BIN_ID 
 join LM01106 lm (nolock) on lm.AC_CODE =b.ac_code 
 WHERE B.CANCELLED = 0    

 ---- --ADD NEW FOR PACKSLIP RETURN
  UNION ALL
  --CREATE NONCLUSTERED INDEX IX_PSID_RMD_INCL ON [dbo].[rmd01106] ([PS_ID]) INCLUDE ([product_code],[quantity],[rm_id],[RFNET],[item_tax_amount],[BIN_ID])
  SELECT B.location_Code  /*LEFT(B.RM_ID,2)*//*Rohit 04-11-2024*/ AS DEPT_ID,    
   'DNPR'  AS XN_TYPE,  
    'IN' AS XNGROUP,   
   B.RM_DT AS XN_DT,     
   A.PRODUCT_CODE AS PRODUCT_CODE,    
   A.QUANTITY AS XN_QTY,    
   B1.BIN_NAME AS XN_BIN,
   BI2.BIN_NAME AS XN_ZONE ,
   B1.BIN_NAME     AS SOURCE,
   lm.AC_NAME    AS TARGET ,
   'Debit note Packslip Return' AS TRANSACTION_NAME    
 FROM RMD01106 A (NOLOCK)    
 JOIN RMM01106 B (NOLOCK) ON A.RM_ID = B.RM_ID 
 JOIN dnps_mst C ON A.ps_id =C.ps_id   
 JOIN BIN B1 (NOLOCK) ON B1.BIN_ID =A.BIN_ID
 JOIN BIN BI2 (NOLOCK) ON B1.major_bin_id =BI2.BIN_ID  
 join LM01106 lm (nolock) on lm.AC_CODE =b.ac_code 
 WHERE B.CANCELLED = 0 AND ISNULL(A.PS_ID,'')<>''
 AND ISNULL(B.xn_item_type,0) in (0,1)    
    
--***************** END OF CREATING VIEW VW_XNSREPS 
