CREATE FUNCTION FN3SREADLEDGERTERMS
(
	@CTERMS VARCHAR(200)
   ,@NMODE NUMERIC(2)	
   /*
		@NMODE : 
			1 - RETURNS GROSSMARGIN
			2 - RETURNS CD
			3 - RETURNS IF  	
   */
)
RETURNS NUMERIC(18,4)
AS
BEGIN
	DECLARE @NRETURNVALUE NUMERIC(18,4),@NSTARTPOSITION INT
		   ,@CTERMID VARCHAR(200),@NLOOPER NUMERIC(3)
	
	IF ISNULL(@CTERMS,'')=''
	GOTO LAST
	--REMOVING THE FIRST 6 CHARACTERS WHICH IS NOT REQUIRED FOR VALUE EXTRACTION
	SET @CTERMID=SUBSTRING(@CTERMS,6,LEN(@CTERMS))
	
	--LOOP EXECUTION COUNT
	SET @NLOOPER=@NMODE-1
		
	--REMOVE THE UNWANTED VALUES FROM THE START OF TERMS
	WHILE @NLOOPER>0
	BEGIN
		SELECT @NSTARTPOSITION=CHARINDEX('-',@CTERMID)
		SET @CTERMID=SUBSTRING(@CTERMID,@NSTARTPOSITION+1,LEN(@CTERMID))
		SET @NLOOPER=@NLOOPER-1
	END
	
	--GET THE FIRST OCCURANCE OF '-'
	SELECT @NSTARTPOSITION=CHARINDEX('-',@CTERMID)
	IF @NSTARTPOSITION=0
		SET @NSTARTPOSITION=2
	
	--FOR @NMODE<5, THE VALUE WOULD BE NUMERIC AND FOR @NMODE>=5, THE VALUE WOULD BE EITHER 'N' OR 'Y'
	IF @NMODE<5
		SELECT @NRETURNVALUE=SUBSTRING(@CTERMID,1,@NSTARTPOSITION-1)	
	ELSE 
		SELECT @NRETURNVALUE=(CASE WHEN SUBSTRING(@CTERMID,1,@NSTARTPOSITION-1)='N' THEN 0 ELSE 1 END)		
LAST:		
RETURN 	@NRETURNVALUE
END
--END OF FUNCTION - FN3SREADLEDGERTERMS
