

IF NOT EXISTS (SELECT CONFIG_OPTION FROM CONFIG WHERE CONFIG_OPTION='SYNCH_MIRRORLOG_XNS' AND VALUE=1)
BEGIN
	PRINT 'SYNCH MIRRORLOG WITH TRANSACTIONS FOR AVOIDING SENDING OF OLDER DATA'
	
	DECLARE @CCURLOCID VARCHAR(5),@CHOLOCID VARCHAR(5),@DDATE DATETIME
	
	SELECT TOP 1 @CCURLOCID=VALUE FROM CONFIG WHERE CONFIG_OPTION='LOCATION_ID'
	SELECT TOP 1 @CHOLOCID=VALUE FROM CONFIG WHERE CONFIG_OPTION='HO_LOCATION_ID'
		
	IF @CCURLOCID<>@CHOLOCID
	BEGIN
		SELECT @DDATE=CONVERT(DATE,GETDATE())
		
		EXEC SP_INSERT_MIRRORLOG @DDATE
	END
	
	IF NOT EXISTS (SELECT CONFIG_OPTION FROM CONFIG WHERE CONFIG_OPTION='SYNCH_MIRRORLOG_XNS')
		INSERT CONFIG (CONFIG_OPTION,VALUE,ROW_ID,LAST_UPDATE)
			   VALUES ('SYNCH_MIRRORLOG_XNS',1,'',GETDATE())	
	ELSE
		UPDATE CONFIG SET VALUE='1' WHERE CONFIG_OPTION='SYNCH_MIRRORLOG_XNS'
	
END		
