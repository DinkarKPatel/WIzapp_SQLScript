CREATE PROCEDURE SP3S_FEEDBACK_DETAILS
(
 @NMODE INT,
 @CMEMO_ID VARCHAR(100)='',
 @CWHERE VARCHAR(100)=''
)
AS
BEGIN
  
  IF @NMODE=1
     GOTO LBLMST
  ELSE IF @NMODE=2
     GOTO LBLDET
  ELSE IF @NMODE=3
     GOTO TREE_VIEW
  ELSE IF @NMODE=4
     GOTO ANS_DET
  ELSE IF @NMODE=5
     GOTO QUES_VALIDATE
  ELSE IF @NMODE=6
     GOTO LBL_RATING
  ELSE IF @NMODE=7
     GOTO QUE_TYPE
  ELSE IF @NMODE=8
     GOTO RET_MODE
  ELSE GOTO END_PROC
  
  
  LBLMST:
     
     SELECT A.* FROM QUESTIONM A
     WHERE A.QUESTION_ID=@CMEMO_ID
  
  GOTO END_PROC
  LBLDET:
  
      SELECT A.* FROM QUESTIOND  A
      WHERE A.QUESTION_ID=@CMEMO_ID
  
  GOTO END_PROC
  
  TREE_VIEW:
  
    SELECT A.QUESTION_NAME ,
	       A.QUESTION_ID,A.QUESTION_ID AS ROW_ID,'' AS ANSWER_NAME, 
	       (CASE WHEN A.QUESTION_TYPE = 1 THEN 'SINGLE CHOICE' ELSE 'RATING' END ) AS QUESTION_TYPE ,
	       A.QUESTION_TYPE AS  QUESTION_MODE
	       ,A.QUESTION_ID + CAST(A.QUESTION_TYPE AS VARCHAR(1)) AS TEMP_ID 
           --,TEMP_ID=CASE WHEN A.QUESTION_TYPE = 1 THEN '1' ELSE '2' END  
		   --,MEMO_NO=CASE WHEN A.QUESTION_TYPE = 1 THEN '1' ELSE '2' END  
	FROM QUESTIONM A
	
  
 --   SELECT A.QUESTION_NAME,RTRIM(LTRIM(STR(QUESTION_TYPE))) + '. ' +B.ANSWER_NAME AS QUESTION_NAME ,
 --        A.QUESTION_ID,B.ANSWER_CODE AS ROW_ID,B.ANSWER_NAME,
	--(CASE WHEN A.QUESTION_TYPE = 1 THEN 'SINGLE CHOICE' ELSE 'RATING' END ) AS QUESTION_TYPE ,
	--A.QUESTION_TYPE AS  QUESTION_MODE,
	--A.QUESTION_ID + CAST(A.QUESTION_TYPE AS VARCHAR(1)) AS TEMP_ID 
	--FROM QUESTIONM A
	--JOIN QUESTIOND  B ON A.QUESTION_ID  = B.QUESTION_ID 
	--ORDER BY QUESTION_ID
	
   GOTO END_PROC
	
	ANS_DET:
	
	SELECT *
	FROM QUESTIOND A (NOLOCK) 
	JOIN QUESTIONM B (NOLOCK)ON A.QUESTION_ID  = B.QUESTION_ID 
	WHERE A.QUESTION_ID = @CWHERE	
	
	GOTO END_PROC
	
	QUES_VALIDATE:
		
	SELECT * FROM QUESTIONM WHERE QUESTION_NAME  = @CWHERE
	
	
	GOTO END_PROC
	
	LBL_RATING:
     
     SELECT A.* FROM QUESTIONR A(NOLOCK)
     WHERE A.QUESTION_ID=@CMEMO_ID
  
	GOTO END_PROC
	
	QUE_TYPE:
	
	SELECT A.QUESTION_TYPE
	FROM QUESTIONM A(NOLOCK)
	WHERE A.QUESTION_ID=@CMEMO_ID
    
	GOTO END_PROC
	
	
	RET_MODE:
	
	SELECT A.QUESTION_NAME,QUESTION_TYPE
	,R.RATING
	FROM QUESTIONM A(NOLOCK)
	JOIN QUESTIONR R(NOLOCK) ON A.QUESTION_ID=R.QUESTION_ID
    WHERE A.QUESTION_ID=@CMEMO_ID
    
	GOTO END_PROC
END_PROC:
END--SP3S_FEEDBACK_DETAILS
