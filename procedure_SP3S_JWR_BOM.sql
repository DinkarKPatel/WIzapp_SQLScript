CREATE PROCEDURE SP3S_JWR_BOM
(
 
 @CARTICLE_CODE  VARCHAR(500) = ''  ,
 @CMEMOID VARCHAR(25),
 @NMODE INT =1
)
AS
BEGIN
    
	IF @NMODE=1
	  GOTO LBLGETMIS
	ELSE if @NMODE=2
	   GOTO LBLBOM_SUMMARY
    else
	  GOTO END_PROC

	  LBLGETMIS:
	 
	SELECT  CAST(1 AS BIT) AS CHK, K.SECTION_NAME, J.SUB_SECTION_NAME,  I.UOM_TYPE,I.UOM_CODE,I.UOM_NAME,
			P1.PARA1_NAME,P2.PARA2_NAME,FGART.ARTICLE_NO,FGART.ARTICLE_NAME, FGART.CODING_SCHEME, ART.ARTICLE_CODE,
			T.ARTICLE_CODE AS BOM_ARTICLE_CODE,T.AVG_QUANTITY AS AVG_QTY,
			B.PURCHASE_PRICE AS RATE,
			T.PARA1_CODE AS BOM_PARA1_CODE,T.PARA2_CODE AS BOM_PARA2_CODE,T.ADD_AVG_QUANTITY AS ADD_AVG_QTY,
			ISNULL(FGART.DT_CREATED,'') AS [ART_DT_CREATED],  
			'' AS [PARA3_DT_CREATED], '' AS [SKU_DT_CREATED],  
			FGART.GEN_EAN_CODES,  '' AS OTHER_XN_PRODUCT_CODE,P2.PARA2_ORDER, FGART.SIZE_RATE_DIFF ,FGART.SIZE_CENTER_POINT,     
			CAST(0 AS NUMERIC(10,2)) AS [STK_QUANTITY],FGART.STOCK_NA,    
			FGART.FIX_MRP,  '' AS PRODUCT_NAME,FGART.FIX_PRICE_ARTICLE,CONVERT(NUMERIC(2),0) AS  MODE,    
			FGART.ALIAS AS ARTICLE_ALIAS,
			T.JOB_CODE ,JOBS.JOB_NAME ,
			ISNULL(T.TOL_PER,0) AS TOL_PER,
			T.ROW_ID  
	FROM BOM_ISSUE_MST A
	JOIN BOM_ISSUE_DET B ON A.ISSUE_ID=B.ISSUE_ID 
	JOIN ORD_PLAN_BOM_DET T ON T.ROW_ID =B.ORD_PLAN_BOM_DET_ROW_ID  
	JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE = T.ARTICLE_CODE         
	JOIN PARA1 P1 (NOLOCK) ON P1.PARA1_CODE = T.PARA1_CODE        
	JOIN PARA2 P2 (NOLOCK) ON P2.PARA2_CODE = T.PARA2_CODE  
	LEFT JOIN JOBS (NOLOCK) ON JOBS.JOB_CODE =T.JOB_CODE          
	JOIN UOM I (NOLOCK) ON ART.UOM_CODE = I.UOM_CODE        
	JOIN SECTIOND J (NOLOCK) ON ART.SUB_SECTION_CODE = J.SUB_SECTION_CODE        
	JOIN SECTIONM K (NOLOCK) ON J.SECTION_CODE = K.SECTION_CODE
	JOIN ARTICLE FGART (NOLOCK) ON FGART .ARTICLE_CODE=@CARTICLE_CODE
	WHERE JOBWORK_ISSUE_ID =@CMEMOID
	AND A.CANCELLED=0
	group by  K.SECTION_NAME, J.SUB_SECTION_NAME,  I.UOM_TYPE,I.UOM_CODE,I.UOM_NAME,
			P1.PARA1_NAME,P2.PARA2_NAME,FGART.ARTICLE_NO,FGART.ARTICLE_NAME, FGART.CODING_SCHEME, ART.ARTICLE_CODE,
			T.ARTICLE_CODE ,T.AVG_QUANTITY ,
			T.PARA1_CODE ,T.PARA2_CODE,T.ADD_AVG_QUANTITY,ISNULL(FGART.DT_CREATED,'') ,  
			FGART.GEN_EAN_CODES, P2.PARA2_ORDER, FGART.SIZE_RATE_DIFF ,FGART.SIZE_CENTER_POINT,        
			FGART.STOCK_NA,FGART.FIX_MRP,FGART.FIX_PRICE_ARTICLE, FGART.ALIAS ,
			T.JOB_CODE ,JOBS.JOB_NAME ,
			ISNULL(T.TOL_PER,0) ,T.ROW_ID ,B.PURCHASE_PRICE
--	SELECT * FROM BOM_ISSUE_det  where issue_id='JM01120JMWS00000000026'
   GOTO END_PROC



   LBLBOM_SUMMARY:

            

			SELECT ART.ARTICLE_NO,P1.PARA1_NAME ,P2.PARA2_NAME ,A.PURCHASE_PRICE,
				  AVG_QUANTITY ,ADD_AVG_QUANTITY,QUANTITY
			FROM JOBWORK_RECEIVE_BOM_DET  A 
			JOIN ARTICLE ART (NOLOCK) ON A.ARTICLE_CODE =ART.ARTICLE_CODE 
			JOIN PARA1 P1 (NOLOCK) ON P1.PARA1_CODE =A.PARA1_CODE 
			JOIN PARA2 P2 (NOLOCK) ON P2.PARA2_CODE =A.PARA2_CODE 
			WHERE A.RECEIPT_ID=@CMEMOID



   GOTO END_PROC


END_PROC:
END