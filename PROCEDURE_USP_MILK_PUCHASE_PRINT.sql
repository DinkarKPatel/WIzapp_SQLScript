

/*
CREATED BY: JAI RAM KUMAR
CREATED DATE: 13-JAN-2017 

EXEC USP_MILK_PUCHASE_PRINT 'P00111700000P000000225'
*/
CREATE PROCEDURE DBO.USP_MILK_PUCHASE_PRINT
( 
 @MEMO_ID VARCHAR(100)=''
)
----WITH ENCRYPTION
AS
 BEGIN
   --DECLARE LOCAL VARIABLE
   DECLARE @ERROR_MSG VARCHAR(MAX)
   SET @ERROR_MSG=''
   
   --IF ISNULL(@FROM_DATE,'')=''
   --    BEGIN
   --     SET @ERROR_MSG='ERROR || PLEASE ENTER FROM DATE'
   --     GOTO PROC_END;
   --    END
   --IF ISNULL(@TO_DATE,'')=''
   --    BEGIN
   --     SET @ERROR_MSG='ERROR || PLEASE ENTER TO DATE'
   --     GOTO PROC_END;
   --    END
       
   SELECT M.MEMO_ID,M.MEMO_NO,M.MEMO_DT,M.BILL_NO,M.BILL_DT,LV.AC_NAME AS [SUPPLIER_NAME]    
         ,ISNULL(ADDRESS0,'')+' '+ ISNULL(ADDRESS1,'')+' '+ ISNULL(ADDRESS2,'') AS [ADDRESS]    
         ,D.MILK_QTY,D.FSN_QTY,D.FSN_PERCENTAGE,D.FSN_RATE    
         ,D.FSN_AMOUNT,D.FAT_QTY,D.FAT_PERCENTAGE,D.FAT_RATE,D.FAT_AMOUNT   
         ,M.FIN_YEAR    
         ,(CASE M.CANCELED WHEN 1 THEN 'CANCELED' WHEN 0 THEN 'UNCANCELED' END) AS [CANCELED]
         ,M.TOTAL_AMOUNT,M.LAST_UPDATE   
         FROM DBO. MILK_PURCHASE_MST M
  JOIN DBO.MILK_PURCHASE_DET D ON M.MEMO_ID=D.MEMO_ID
  JOIN DBO.LMV01106 LV WITH(NOLOCK) ON M.AC_CODE=LV.AC_CODE
  WHERE (@MEMO_ID IS NULL OR @MEMO_ID = '' OR M.MEMO_ID=@MEMO_ID)
   
   PROC_END:
    IF ISNULL(@ERROR_MSG,'') <> ''
      BEGIN
       SELECT @ERROR_MSG AS [ERROR_MSG]
       SET @ERROR_MSG=''
      END
 END
