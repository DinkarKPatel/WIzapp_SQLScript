CREATE PROCEDURE SP_BOOK_INWARD_SUPPLY_FILTER
(
 
	@FRMDT DATETIME--MEMO_DT
	,@TODT DATETIME--MEMO_DT
	,@AC_CODE VARCHAR(10)=''--IF BLANK THEN ALL ELSE APPLY FILTER
	,@DEPT_ID VARCHAR(4)=''--IF BLANK THEN ALL ELSE APPLY FILTER
	,@CANCEL NUMERIC(1)=2--2 THEN ALL ELSE APPLY FILTER. 


)
AS
BEGIN
       SELECT A.AC_CODE,AC_NAME,BILL_NO,BILL_DT,A.MEMO_ID,MEMO_NO,MEMO_DT,A.DEPT_ID,  
        (CASE WHEN A.CANCELLED = 1 THEN 'CANCELLED' ELSE '' END) AS CANCELLED  ,
        (CASE WHEN A.CANCELLED = 1 THEN 0 ELSE TOTAL_AMOUNT END) AS TOTAL_AMOUNT
        ,A.USER_CODE,U.USERNAME ,A.FIN_YEAR,PARTY_STATE_CODE,GST_STATE_NAME AS PARTY_STATE_NAME,DEPT_NAME



              
               FROM SUPPLY_EXPENSE_XN_MST  A 
              JOIN LOCATION B ON A.DEPT_ID=B.DEPT_ID
            
              JOIN LMV01106 C ON C.AC_CODE=A.AC_CODE
              JOIN USERS U ON U.USER_CODE=A.USER_CODE
              JOIN GST_STATE_MST G ON G.GST_STATE_CODE=A.PARTY_STATE_CODE
          
       WHERE MEMO_DT BETWEEN @FRMDT AND @TODT
       AND ( ISNULL(@AC_CODE,'')='' OR A.AC_CODE=@AC_CODE)
       AND ( ISNULL(@CANCEL,0)=2 OR A.CANCELLED=@CANCEL)
        AND ( ISNULL(@DEPT_ID,'')='' OR A.DEPT_ID=@DEPT_ID)
END
