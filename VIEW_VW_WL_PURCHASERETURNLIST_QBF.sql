CREATE VIEW VW_WL_PURCHASERETURNLIST_QBF 

AS     
SELECT 
A.RM_ID, 
A.RM_DT AS 'MST_XN_DT', 
A.RM_NO AS 'MST_RM_NO', 
U.USERNAME AS 'MST_USERNAME',
B.AC_NAME AS 'MST_SUPP_NAME',  
B.ADDRESS0 AS 'MST_ADDRESS0',
B.ADDRESS1 AS 'MST_ADDRESS1',
B.ADDRESS2 AS 'MST_ADDRESS2',
B.AREA_NAME AS 'MST_AREA_NAME',
B.CITY AS 'MST_CITY',
B.PINCODE AS 'MST_PINCODE',
B.STATE AS 'MST_STATE', 
B.TIN_NO,
B.PAN_NO,  
A.SUBTOTAL AS 'MST_SUBTOTAL',
A.DISCOUNT_AMOUNT AS 'MST_DISCOUNT_AMOUNT',
A.DISCOUNT_PERCENTAGE AS 'MST_DISCOUNT_PERCENTAGE',
A.FREIGHT AS 'MST_FREIGHT',
A.OTHER_CHARGES AS 'MST_OTHER_CHARGES',
A.ROUND_OFF AS 'MST_ROUND_OFF',
A.TOTAL_AMOUNT AS 'MST_TOTAL_AMOUNT',
A.REMARKS AS 'MST_REMARKS',
A.FIN_YEAR AS 'MST_FIN_YEAR',
A.MEMO_TYPE AS 'MST_MEMO_TYPE',

C.PRODUCT_CODE AS 'PRODUCT_CODE',
D.ARTICLE_NO AS 'ARTICLE_NO', 
D.ARTICLE_NAME AS 'ARTICLE_NAME',
D.ARTICLE_DESC AS 'ARTICLE_DESC',
P1.PARA1_NAME AS 'PARA1_NAME', 
P2.PARA2_NAME AS 'PARA2_NAME', 
P3.PARA3_NAME AS 'PARA3_NAME',
C.TS AS 'TS',
C.QUANTITY AS 'QUANTITY',
E.SUB_SECTION_NAME AS 'SUB_SECTION_NAME',   
F.SECTION_NAME AS 'SECTION_NAME',
H.UOM_NAME AS 'UOM_NAME',
SKU.INV_NO AS 'INV_NO',
SKU.INV_DT AS 'INV_DT',
C.PURCHASE_PRICE AS 'PURCHASE_PRICE',
C.PURCHASE_PRICE  AS 'RATE',
(C.QUANTITY*C.PURCHASE_PRICE)-C.DISCOUNT_AMOUNT  AS 'AMOUNT',
COM.COMPANY_CODE,I1.FORM_NAME,C.ITEM_TAX_AMOUNT,C.ITEM_TAX_PERCENTAGE,
A.MEMO_PREFIX AS 'MST_MEMO_PREFIX',
 A.EXCISE_DUTY_AMOUNT AS MST_EXCISE_DUTY_AMOUNT,
ISNULL(T61.DEPT_NAME,'') AS MST_DEPT_NAME
,ISNULL(ANGM.ANGADIA_NAME,'') AS ANGADIA_NAME
,ISNULL(ANGM.ANGADIA_ALIAS,'') AS ANGADIA_ALIAS
,ISNULL(ANGM.ANGADIA_ADD1,'') AS ANGADIA_ADD1
,ISNULL(ANGM.ANGADIA_ADD2,'') AS ANGADIA_ADD2
,ISNULL(ANGM.ANGADIA_PHONE,'') AS ANGADIA_PHONE
,ISNULL(PMST.PARCEL_MEMO_NO,'') AS PARCEL_MEMO_NO
,ISNULL(PMST.PARCEL_MEMO_DT,'') AS PARCEL_MEMO_DT
,ISNULL(PMST.TOTAL_AMOUNT,0) AS PARCEL_TOTAL_AMOUNT
,ISNULL(PMST.DEPT_ID,'') AS PARCEL_DEPT_ID
,ISNULL(PMST.PARCEL_MEMO_ID,'') AS PARCEL_MEMO_ID
,ISNULL(PMST.PAY_TYPE,0) AS PAY_TYPE
,ISNULL(PMST.CASH_RECEIPT_NO,'') AS CASH_RECEIPT_NO
,ISNULL(PMST.BILTY_NO,'') AS BILTY_NO
FROM RMM01106 (NOLOCK) A    
LEFT OUTER JOIN parcel_det   PB (NOLOCK) ON PB.REF_MEMO_ID=A.RM_ID 
LEFT OUTER JOIN PARCEL_MST PMST (NOLOCK) ON PMST.PARCEL_MEMO_ID=PB.PARCEL_MEMO_ID AND PMST.XN_TYPE='PRT'
LEFT JOIN ANGM (NOLOCK) ON PMST.ANGADIA_CODE=ANGM.ANGADIA_CODE
JOIN LMV01106 (NOLOCK) B ON A.AC_CODE = B.AC_CODE      
JOIN RMD01106 (NOLOCK) C ON A.RM_ID = C.RM_ID      
JOIN SKU (NOLOCK) ON C.PRODUCT_CODE = SKU.PRODUCT_CODE  
JOIN ARTICLE (NOLOCK) D ON SKU.ARTICLE_CODE = D.ARTICLE_CODE      
JOIN SECTIOND (NOLOCK) E ON D.SUB_SECTION_CODE = E.SUB_SECTION_CODE       
JOIN SECTIONM (NOLOCK) F ON E.SECTION_CODE = F.SECTION_CODE       
JOIN PARA1 (NOLOCK) P1 ON SKU.PARA1_CODE = P1.PARA1_CODE      
JOIN PARA2 (NOLOCK) P2 ON SKU.PARA2_CODE = P2.PARA2_CODE      
JOIN PARA3 (NOLOCK) P3 ON SKU.PARA3_CODE = P3.PARA3_CODE  
JOIN USERS (NOLOCK) U ON A.USER_CODE = U.USER_CODE
JOIN UOM (NOLOCK) H ON D.UOM_CODE = H.UOM_CODE
JOIN FORM (NOLOCK) I1 ON C.ITEM_FORM_ID = I1.FORM_ID
LEFT OUTER JOIN COMPANY COM ON 1=1 AND COM.COMPANY_CODE='01'
LEFT OUTER JOIN LOCATION T61 ON T61.DEPT_ID=A.PARTY_DEPT_ID
--WHERE A.CANCELLED = 0
