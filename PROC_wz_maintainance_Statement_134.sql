
 
/*
LOGIC: DICUSSED WITH AVDASH SIR ON 8-JULY-2017
IF CONFIG OPTION 
         1 :- ARTICEL WISE
         2 :- STYPE (PARA3) WISE
         OTHER THEN 1 AND 2 THEN PRODUCT CODE WISE
*/
IF NOT EXISTS(SELECT CONFIG_OPTION FROM CONFIG WHERE CONFIG_OPTION='UPDATE_IMAGE_FROM_OLD_TO_NEW' AND VALUE=1)
BEGIN 
--DECLARE LOCAL VARIABLE FOR CONFIG OPTION
  DECLARE @IMAGE_CONFIG INT
  SELECT @IMAGE_CONFIG= VALUE FROM DBO.CONFIG WITH(NOLOCK) WHERE CONFIG_OPTION ='PICT_SOURCE'
  IF ISNULL(@IMAGE_CONFIG,0) = 1
  BEGIN
    INSERT INTO DBO.IMAGE_INFO(
    SECTION_CODE,SUB_SECTION_CODE,ARTICLE_CODE,PARA1_CODE,PARA2_CODE,PARA3_CODE
    ,PARA4_CODE,PARA5_CODE,PARA6_CODE,IMAGE_NAME,PRODUCT_CODE,IMAGE_SUBFOLDER)
    SELECT
    '0000000' AS SECTION_CODE,'0000000' AS SUB_SECTION_CODE, ARTICLE_CODE,'0000000' AS PARA1_CODE
    ,'0000000' AS PARA2_CODE,'0000000' AS PARA3_CODE,'0000000' AS PARA4_CODE,'0000000' AS PARA5_CODE
    ,'0000000' AS PARA6_CODE,ISNULL(ARTICLE_NO,'NA')+'.JPG' AS IMAGE_NAME, '0000000' AS PRODUCT_CODE,DT_CREATED AS IMAGE_SUBFOLDER
    FROM DBO.ARTICLE WITH(NOLOCK)
    WHERE ISNULL(DT_CREATED,'') <> ''
  END
  ELSE IF ISNULL(@IMAGE_CONFIG,0) = 2
  BEGIN
    INSERT INTO DBO.IMAGE_INFO(
    SECTION_CODE,SUB_SECTION_CODE,ARTICLE_CODE,PARA1_CODE,PARA2_CODE,PARA3_CODE
    ,PARA4_CODE,PARA5_CODE,PARA6_CODE,IMAGE_NAME,PRODUCT_CODE,IMAGE_SUBFOLDER)
    SELECT
    '0000000' AS SECTION_CODE,'0000000' AS SUB_SECTION_CODE,'00000000' AS ARTICLE_CODE,'0000000' AS PARA1_CODE
    ,'0000000' AS PARA2_CODE, PARA3_CODE,'0000000' AS PARA4_CODE,'0000000' AS PARA5_CODE
    ,'0000000' AS PARA6_CODE, ISNULL(PARA3_NAME,'NA')+'.JPG' AS IMAGE_NAME, '0000000' AS PRODUCT_CODE,DT_CREATED AS IMAGE_SUBFOLDER
    FROM DBO.PARA3 WITH(NOLOCK)
    WHERE ISNULL(DT_CREATED,'') <> ''
  END 
  ELSE
  BEGIN
    INSERT INTO DBO.IMAGE_INFO(
    SECTION_CODE,SUB_SECTION_CODE,ARTICLE_CODE,PARA1_CODE,PARA2_CODE,PARA3_CODE
    ,PARA4_CODE,PARA5_CODE,PARA6_CODE,IMAGE_NAME,PRODUCT_CODE,IMAGE_SUBFOLDER)
    SELECT
    '0000000' AS SECTION_CODE,'0000000' AS SUB_SECTION_CODE,'00000000' AS ARTICLE_CODE,'0000000' AS PARA1_CODE
    ,'0000000' AS PARA2_CODE,'0000000' AS PARA3_CODE,'0000000' AS PARA4_CODE,'0000000' AS PARA5_CODE
    ,'0000000' AS PARA6_CODE,ISNULL(PRODUCT_CODE,'NA')+'.JPG' AS IMAGE_NAME, PRODUCT_CODE,DT_CREATED AS IMAGE_SUBFOLDER
    FROM DBO.SKU WITH(NOLOCK)
    WHERE ISNULL(DT_CREATED,'') <> ''
  END
  
  INSERT INTO DBO.CONFIG(CONFIG_OPTION,VALUE,ROW_ID,LAST_UPDATE)
  VALUES('UPDATE_IMAGE_FROM_OLD_TO_NEW',1,NEWID(),GETDATE())

END

