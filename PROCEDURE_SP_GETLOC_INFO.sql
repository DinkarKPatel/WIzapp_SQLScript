create PROCEDURE SP_GETLOC_INFO
--(dinkar) Replace  left(memoid,2) to Location_code 
--WITH ENCRYPTION
AS
BEGIN
     
     DECLARE @HEAD_CODE VARCHAR(MAX),@CCMD NVARCHAR(MAX)
     SET @HEAD_CODE=(SELECT DBO.FN_ACT_TRAVTREE('0000000018'))
     SET @HEAD_CODE=ISNULL(@HEAD_CODE,'')+ ','+(SELECT DBO.FN_ACT_TRAVTREE('0000000021'))
     
     SELECT cmm.location_Code  AS LOC_ID,L.DEPT_NAME AS LOC_NAME,CITY.CITY,STATE,MIN(CM_DT) AS MIN_CM_DT,MAX(CM_DT) AS MAX_CM_DT 
     FROM CMM01106 CMM (NOLOCK)
     JOIN LMP01106 LMP (NOLOCK) ON CMM.AC_CODE=LMP.AC_CODE
     JOIN CITY (NOLOCK) ON CITY.CITY_CODE=LMP.CITY_CODE
     JOIN STATE (NOLOCK) ON STATE.STATE_CODE=CITY.STATE_CODE
     JOIN LOCATION L (NOLOCK) ON L.DEPT_ID=cmm.location_Code 
     GROUP BY cmm.location_Code ,CITY,STATE,L.DEPT_NAME
     
     
     SET @CCMD=N' SELECT LM.AC_NAME,LMP.ADDRESS1 ,LMP.ADDRESS2,CITY ,STATE  FROM LM01106 LM (NOLOCK)
     JOIN LMP01106 LMP (NOLOCK) ON LM.AC_CODE =LMP.AC_CODE 
     JOIN CITY (NOLOCK) ON CITY.CITY_CODE =LMP.CITY_CODE 
     JOIN STATE (NOLOCK) ON STATE.STATE_CODE =CITY.STATE_CODE
     WHERE LM.HEAD_CODE IN('+@HEAD_CODE+')'
     
     PRINT @CCMD
     EXEC SP_EXECUTESQL @CCMD
END
