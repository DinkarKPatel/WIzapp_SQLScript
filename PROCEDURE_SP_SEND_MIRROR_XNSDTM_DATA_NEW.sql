CREATE PROCEDURE SP_SEND_MIRROR_XNSDTM_DATA_NEW--(LocId 3 digit change only increased the parameter width by Sanjay:01-11-2024)
(
	 @CREQXNID VARCHAR(50)
	,@CCURLOCID VARCHAR(4)	 
	,@BACKNOWLEDGE BIT =0
	,@CERRMSG VARCHAR(1000) OUTPUT

)
AS
BEGIN
		DECLARE @CCMD NVARCHAR(MAX),@CSTEP VARCHAR(100),@CFILTERCONDITION VARCHAR(200),
				@CMEMOID VARCHAR(100),@CTEMPTABLE VARCHAR(100),@CTABLENAME VARCHAR(100),@CTEMPMASTERTABLE VARCHAR(100),
				@BRECFOUND BIT,@CCUST_CODE_STRING VARCHAR(MAX),@DMEMOLASTUPDATE DATETIME
			
		
BEGIN TRY

	SET @CSTEP=00
	DECLARE @CTEMPDBNAME VARCHAR(40)
	SET @CTEMPDBNAME=''
	SET @CFILTERCONDITION = ' LEFT(DT_CODE,2) = ''WC'' AND DT_CODE<>''0000000'' AND '
	
	
	SET @CMEMOID=@CREQXNID						
	SET @CSTEP=40	
	---- IF NO MEMO FOUND , JUST END THE PROCESS
	IF ISNULL(@CMEMOID,'')=''
		GOTO END_PROC	

		
	SET @CSTEP=110
	---- SEND THE LEDGER MASTER TABLE
	SELECT DISTINCT  DTM.*,'XNSDTM_DTM_UPLOAD' AS TARGET_TABLENAME FROM DTM WHERE DT_CODE=@CMEMOID
	
	
	
    GOTO END_PROC
		
END TRY

BEGIN CATCH
	SET @CERRMSG='P: SP_SEND_MIRROR_XNSDTM_DATA_NEW, STEP:'+@CSTEP+', MESSAGE:'+ERROR_MESSAGE()
	GOTO END_PROC
END CATCH

END_PROC:
	
END
--END OF THE PROCEDURE SP_SEND_MIRROR_XNSDTM_DATA_NEW
