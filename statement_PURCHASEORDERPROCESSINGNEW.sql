
IF NOT EXISTS (SELECT TOP 1 'U' FROM PURCHASEORDERPROCESSINGNEW (NOLOCK))
BEGIN

      insert into PURCHASEORDERPROCESSINGNEW(XnType,RowId,RefRowId,Qty)
	  SELECT 'PURCHASEORDER' AS XNTYPE, B.ROW_ID ROWID,B.ROW_ID REFROWID,
	          b.quantity +
			 CEILING((ISNULL(b.INVOICE_QUANTITY,0) * ISNULL(b.tolerance_percentage,0))/100)
	  FROM POM01106 A (NOLOCK)
	  JOIN POD01106 B (NOLOCK) ON A.PO_ID =B.PO_ID 
	  WHERE A.CANCELLED =0 
	  UNION ALL
	  SELECT 'PURCHASEINVOICE' AS XNTYPE,A.ROW_ID ,A.PO_ROW_ID AS REFROWID,A.QUANTITY 
	  FROM PID01106 A (NOLOCK)
	  JOIN PIM01106 B (NOLOCK) ON A.MRR_ID =B.MRR_ID 
	  WHERE B.CANCELLED =0 AND A.PO_ROW_ID <>'' 
	  union all
	  SELECT 'POADJUSTMENT' AS XNTYPE, a.ROW_ID ROWID,a.PO_ROW_ID  REFROWID,a.ADJ_QUANTITY 
	  FROM PO_ADJ_DET A (NOLOCK)
			
			
			
			

END


