CREATE PROCEDURE SPPPC_REC_MATERIAL
(
 @NQUERYID INT=0,
 @CAC_CODE  VARCHAR(100)='',
 @CBILL_NO VARCHAR(50)='',
 @CARTICLE_CODE VARCHAR(100)='',
 @CMEMO_ID VARCHAR(100)=''

)
AS
BEGIN
 
 IF @NQUERYID=1
    GOTO LBLAGENCY    
 ELSE IF @NQUERYID=2   
     GOTO LBLORDERNO 
 ELSE IF @NQUERYID=3 
     GOTO LBLJOBS
 ELSE IF @NQUERYID=4 
     GOTO LBLMST
 ELSE IF @NQUERYID=5 
     GOTO LBLBARCODEDET
 ELSE 
    GOTO END_PROC
    
    LBLAGENCY:
       
       SELECT A.AGENCY_CODE ,B.AC_NAME AS AGENCY_NAME  FROM PPC_AGENCY_ISSUE_MATERIAL_MST A
       JOIN LM01106  B ON A.AGENCY_CODE =B.AC_CODE  
       GROUP BY A.AGENCY_CODE ,B.AC_NAME
      
    GOTO END_PROC
    
    LBLORDERNO:
       
       SELECT BILL_NO  
       FROM PPC_FG_BARCODE_PRINT_MST
       WHERE CANCELLED=0 AND AC_CODE =@CAC_CODE 
    
    GOTO END_PROC 
    
    LBLJOBS:
      
      SELECT A.JOB_CODE,C.JOB_NAME  FROM PPC_AGENCY_ISSUE_MATERIAL_DET A
      JOIN PPC_AGENCY_ISSUE_MATERIAL_MST B ON A.MEMO_ID =B.MEMO_ID 
      JOIN JOBS C ON A.JOB_CODE =C.JOB_CODE 
      WHERE B.CANCELLED =0
      AND B.AGENCY_CODE =@CAC_CODE 
      AND B.BILL_NO =@CBILL_NO 
      GROUP BY A.JOB_CODE,C.JOB_NAME
    
    GOTO END_PROC   
       
    LBLMST:
    
      SELECT A.MEMO_ID,A.MEMO_NO,A.MEMO_DT,A.LAST_UPDATE,
             A.AC_CODE,LM.AC_NAME ,
             A.BILL_NO,A.FIN_YEAR,
             A.ARTICLE_CODE,ART.ARTICLE_NO,ART.ARTICLE_NAME,
             CANCELLED 
      FROM PPC_AGENCY_REC_MATERIAL_MST A
      JOIN LM01106 LM ON LM.AC_CODE =A.AC_CODE
      JOIN ARTICLE ART ON ART.ARTICLE_CODE =A.ARTICLE_CODE
      WHERE A.MEMO_ID=@CMEMO_ID 
       
    GOTO END_PROC 
    
    LBLBARCODEDET:
    
        SELECT CAST('LATER' AS VARCHAR(50)) AS MEMO_ID,ROW_ID=CAST('LATER' AS VARCHAR(40))+CAST(NEWID() AS VARCHAR(100)),
              B.AC_CODE ,LM.AC_NAME ,
              A.SIZEGROUP_CODE,SG.SIZEGROUP_NAME ,
              A.PARA1_CODE,P1.PARA1_NAME ,
              A.PARA2_CODE,P2.PARA2_NAME ,
              A.PARA3_CODE,P3.PARA3_NAME ,
              C.PRODUCT_CODE,
              C.QUANTITY 
       FROM PPC_FG_BARCODE_PRINT_DET A
       JOIN PPC_FG_BARCODE_PRINT_MST B ON A.MEMO_ID =B.MEMO_ID 
       JOIN PPC_FG_BARCODE_PRINT_SUB_DET C ON A.ROW_ID=C.REF_ROW_ID
       JOIN ARTICLE ART ON ART.ARTICLE_CODE =B.ARTICLE_CODE 
	   JOIN PARA1 P1 ON P1.PARA1_CODE =A.PARA1_CODE 
	   JOIN PARA2 P2 ON P2.PARA2_CODE =A.PARA2_CODE 
	   JOIN PARA3 P3 ON P3.PARA3_CODE =A.PARA3_CODE 
       JOIN PPC_SIZEGROUP SG ON SG.SIZEGROUP_CODE =A.SIZEGROUP_CODE 
       JOIN LM01106 LM ON LM.AC_CODE =B.AC_CODE 
       WHERE B.CANCELLED =0
       AND B.AC_CODE =@CAC_CODE 
       AND B.BILL_NO = @CBILL_NO
       AND B.ARTICLE_CODE =@CARTICLE_CODE
    
    
    GOTO END_PROC 
    
         
    
    END_PROC:

END
