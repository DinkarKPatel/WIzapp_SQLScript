
IF NOT EXISTS (SELECT TOP 1 'U'  FROM INFORMATION_SCHEMA .COLUMNS 
WHERE TABLE_NAME ='BOM_ISSUE_MST' AND COLUMN_NAME ='issue_no' AND DATA_TYPE ='char' AND CHARACTER_MAXIMUM_LENGTH =25)
BEGIN
   
   
   DECLARE @CCMD1 NVARCHAR(MAX)
   
   
   IF OBJECT_ID ('TEMPDB..#TMPCONS','U') IS NOT NULL
      DROP TABLE #TMPCONS
   
 
   SELECT  TABLE_NAME ,CONSTRAINT_NAME into #TMPCONS FROM INFORMATION_SCHEMA .CONSTRAINT_COLUMN_USAGE
   WHERE TABLE_NAME ='BOM_ISSUE_MST'
   AND COLUMN_NAME IN('issue_no')
   
   
   DECLARE @CTABLE_NAME VARCHAR(100),@CCONSNAME VARCHAR(1000)
   
   WHILE EXISTS (SELECT TOP 1 'U' FROM #TMPCONS)
   BEGIN
       
       
       SELECT TOP 1 @CTABLE_NAME=TABLE_NAME ,@CCONSNAME=CONSTRAINT_NAME FROM #TMPCONS
      
       
       SET @CCMD1=N' ALTER TABLE '+@CTABLE_NAME+' DROP CONSTRAINT ' +@CCONSNAME
       EXEC SP_EXECUTESQL @CCMD1
       
       DELETE FROM #TMPCONS WHERE TABLE_NAME=@CTABLE_NAME AND CONSTRAINT_NAME=@CCONSNAME
       
   
   END
   

   ALTER TABLE BOM_ISSUE_MST ALTER COLUMN ISSUE_NO CHAR(25) NOT NULL
    
   ALTER TABLE BOM_ISSUE_MST ADD CONSTRAINT UNQ_bom_issue_mst_issue_no UNIQUE (fin_year, issue_no)
   
END

