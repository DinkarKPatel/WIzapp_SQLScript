
IF NOT EXISTS (SELECT TOP 1 'U'  FROM INFORMATION_SCHEMA .COLUMNS 
WHERE TABLE_NAME ='JOBWORK_RECEIPT_MST' AND COLUMN_NAME ='receipt_no' AND DATA_TYPE ='varchar' AND CHARACTER_MAXIMUM_LENGTH =25)
BEGIN
   
   
   DECLARE @CCMD1 NVARCHAR(MAX)
   
   
   IF OBJECT_ID ('TEMPDB..#TMPCONS_REC','U') IS NOT NULL
      DROP TABLE #TMPCONS_REC
   
   SELECT SR=1 ,TABLE_NAME ,CONSTRAINT_NAME  INTO #TMPCONS_REC FROM INFORMATION_SCHEMA .CONSTRAINT_COLUMN_USAGE
   WHERE TABLE_NAME ='JOBWORK_RECEIPT_DET'
   AND COLUMN_NAME IN('RECEIPT_ID')
   UNION ALL
   SELECT SR=2, TABLE_NAME ,CONSTRAINT_NAME  FROM INFORMATION_SCHEMA .CONSTRAINT_COLUMN_USAGE
   WHERE TABLE_NAME ='JOBWORK_RECEIPT_MST'
   AND COLUMN_NAME IN('RECEIPT_NO','RECEIPT_ID')
   
   
   DECLARE @CTABLE_NAME VARCHAR(100),@CCONSNAME VARCHAR(1000)
   
   WHILE EXISTS (SELECT TOP 1 'U' FROM #TMPCONS_REC)
   BEGIN
       
       
       SELECT TOP 1 @CTABLE_NAME=TABLE_NAME ,@CCONSNAME=CONSTRAINT_NAME FROM #TMPCONS_REC
       ORDER BY SR
       
       SET @CCMD1=N' ALTER TABLE '+@CTABLE_NAME+' DROP CONSTRAINT ' +@CCONSNAME
       EXEC SP_EXECUTESQL @CCMD1
       
       DELETE FROM #TMPCONS_REC WHERE TABLE_NAME=@CTABLE_NAME AND CONSTRAINT_NAME=@CCONSNAME
       
   
   END
   
   --PK_jobwork_issue_mst_issue_id
   ALTER TABLE JOBWORK_RECEIPT_MST ALTER COLUMN receipt_no VARCHAR(10) NOT NULL --DUE TO AUTO ALLOCATE SPACE
   ALTER TABLE JOBWORK_RECEIPT_MST ALTER COLUMN receipt_no VARCHAR(25) NOT NULL
   ALTER TABLE JOBWORK_RECEIPT_MST ALTER COLUMN receipt_id VARCHAR(50) NOT NULL   
   ALTER TABLE JOBWORK_RECEIPT_DET ALTER COLUMN receipt_id VARCHAR(50) NOT NULL
   
   
   ALTER TABLE JOBWORK_RECEIPT_MST ADD CONSTRAINT PK_jobwork_receipt_receipt_id PRIMARY KEY (receipt_id )
   
   ALTER TABLE JOBWORK_RECEIPT_DET ADD CONSTRAINT FK_jobwork_receipt_det_jobwork_receipt_mst FOREIGN KEY (receipt_id)
   REFERENCES JOBWORK_RECEIPT_MST (receipt_id)
    
   ALTER TABLE JOBWORK_RECEIPT_MST ADD CONSTRAINT UNQ_jobwork_receipt_receipt_no UNIQUE (fin_year, receipt_no)
   
END


