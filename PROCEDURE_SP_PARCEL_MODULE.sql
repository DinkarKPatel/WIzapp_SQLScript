  
create PROCEDURE SP_PARCEL_MODULE  
  
(  
  
 ----LIST OF INPUT PARAMETERS WITH DESCRIPTION  
 @CMEMO_ID VARCHAR(100)  
)  
  
--WITH ENCRYPTION  
  
AS  
  
BEGIN  
  --(dinkar) Replace  left(memoid,2) to Location_code 
---DECLARE PROC VARIABLES  
  
DECLARE @CERRMSG VARCHAR(500),@CSTEP VARCHAR(5)  
  
BEGIN TRY  
 SELECT PM.PARCEL_MEMO_NO,PM.PARCEL_MEMO_ID AS MEMO_ID,CONVERT(VARCHAR,PM.PARCEL_MEMO_DT,105) AS PARCEL_MEMO_DT,  
        CONVERT(VARCHAR,PM.RECEIPT_DT,105) AS RECEIPT_DT,LM.AC_NAME,  
		LM.ADDRESS0 AS AC_ADDRESS0,  LM.ADDRESS1 AS AC_ADDRESS1,  
	    LM.ADDRESS2 AS AC_ADDRESS2 ,  LM.AREA_CODE AS AC_AREA_CODE,  LM.AREA_NAME AS AC_AREA_NAME,  
		LM.PINCODE AS AC_PINCODE, LM.CITY AS AC_CITY,  
		LM.STATE AS AC_STATE,  LM.Ac_gst_no AS Ac_gst_no,  
		LM.PHONES_R AS AC_PHONES_R, LM.PHONES_O AS AC_PHONES_O,  
		LM.PHONES_FAX AS AC_PHONES_FAX,  LM.MOBILE AS AC_MOBILE,  LM.E_MAIL AS AC_E_MAIL,  
        CANCELLED=CASE WHEN PM.CANCELLED <>0 THEN 'CANCELLED' ELSE '' END,  PM.ANG_TYPE,  
		 PM.TOTAL_AMOUNT,PM.DEPT_ID,PM.COMPANY_CODE,US.USERNAME,EU.USERNAME AS EDIT_USERNAME  
		,PM.PAY_TYPE,PM.CASH_RECEIPT_NO,PD.REF_MEMO_ID,PM.BILTY_NO,PM.REMARKS AS MST_REMARKS  
		,PM.XN_TYPE,(CASE WHEN PM.MODE=1 THEN 'OUTWARD' ELSE 'INWARD' END) AS MODE,'' AS REF_MEMO_NO   
		,AM.ANGADIA_NAME AS TRANSPORTER,PD.QTY AS QUANTITY,PD.PARTY_INV_NO AS BILL_CHALLAN_NO,UOM.UOM_NAME  
		,PD.GOODS_DESC,PD.REMARKS AS DET_REMARKS,AM.ANGADIA_ADD1,AM.ANGADIA_ADD2,AM.ANGADIA_PHONE,pd.REF_GRN_MODE as Against_ref,  
		AV.AREA_NAME,AV.CITY,AV.STATE,AV.PINCODE,AV.REGION_NAME,  
		PM.TOT_QTY AS TOTAL_WEIGHT ,PM.TOT_BOXES AS TOTAL_BOXES,PD.quantity as QUANTITY2,BOX_NO   
  
	   ,V.DEPT_ID LOC_DEPT_ID,V.ADDRESS1 LOC_ADDRESS1,V.ADDRESS2 LOC_ADDRESS2,  
	   V.TAN_NO LOC_TAN_NO,V.PAN_NO LOC_PAN_NO,V.TIN_NO LOC_TIN_NO,  
	   V.CITY LOC_CITY,V.PINCODE LOC_PINCODE,  
	   V.STATE LOC_STATE,V.PHONE LOC_PHONE,V.dept_name LOC_DEPT_NAME,  
	   PM.HANDLED_BY,PM.DRIVER_NAME,PM.VEHICLE_NO,inm.INV_DT  
  
 FROM PARCEL_MST PM (NOLOCK)  
 JOIN PARCEL_DET PD (NOLOCK) ON PM.PARCEL_MEMO_ID=PD.PARCEL_MEMO_ID  
 JOIN LMV01106 LM (NOLOCK) ON PD.AC_CODE=LM.AC_CODE  
 JOIN ANGM AM (NOLOCK) ON PM.ANGADIA_CODE=AM.ANGADIA_CODE  
 JOIN LOCATION LN (NOLOCK) ON LN.DEPT_ID=PM.DEPT_ID  
 JOIN USERS US (NOLOCK) ON PM.USER_CODE=US.USER_CODE  
 JOIN USERS EU (NOLOCK) ON PM.EDT_USER_CODE=EU.USER_CODE  
 JOIN UOM (NOLOCK) ON PD.UOM_CODE=UOM.UOM_CODE  
 LEFT JOIN AREA_VIEW AV(NOLOCK) ON AV.AREA_CODE=AM.area_code  
 LEFT JOIN   
  
    (                  
     SELECT L.DEPT_ID,ADDRESS1,ADDRESS2,TAN_NO,PAN_NO,TIN_NO,C.CITY,A.PINCODE,S.STATE,L.PHONE,l.dept_name                    
     FROM LOCATION L                    
     LEFT JOIN AREA A ON A.AREA_CODE=L.AREA_CODE                    
     LEFT JOIN CITY C ON A.CITY_CODE=C.CITY_CODE                    
     LEFT JOIN STATE S ON S.STATE_CODE=C.STATE_CODE                    
  
    )V ON V.dept_id=pm.location_code 
 LEFT JOIN INM01106 INM (NOLOCK) ON INM.INV_ID =PD.REF_MEMO_ID AND PM.XN_TYPE ='WSL' and inm.CANCELLED =0  
 WHERE PM.PARCEL_MEMO_ID=@CMEMO_ID  
  
  
END TRY  
  
BEGIN CATCH  
  
 SET @CERRMSG='PROCEDURE - SP3S_PARCEL_DETAILS, STEP - '+@CSTEP+', MESSAGE - '+ERROR_MESSAGE()  
  
END CATCH  
 IF ISNULL(@CERRMSG,'')<>''  
  SELECT @CERRMSG AS ERRORMESSAGE   
  
END  
  
  
  
--END OF PROCEDURE - SP3S_PARCEL_MODULE  
  