CREATE PROCEDURE SPCM_SHOWADJUSTMENTS
@CMEMOTYPE	VARCHAR(10),
@CMEMOID VARCHAR(50)
--WITH ENCRYPTION

AS
BEGIN
	IF @CMEMOTYPE='SLS'
	BEGIN
		SELECT A.CM_ID,LTRIM(RTRIM(A.CM_NO)) AS [CM_NO],A.CM_DT,A.SUBTOTAL,SUM(B.QUANTITY) AS [QTY] 
		FROM RPS_MST A (NOLOCK) 
		JOIN RPS_DET B ON B.CM_ID=A.CM_ID
		WHERE A.REF_CM_ID=@CMEMOID
		GROUP BY A.CM_ID,A.CM_NO,A.CM_DT,A.SUBTOTAL
	END
	ELSE IF @CMEMOTYPE='RPS'
	BEGIN
		SELECT A.CM_ID,LTRIM(RTRIM(A.CM_NO)) AS [CM_NO],A.CM_DT,A.NET_AMOUNT AS [SUBTOTAL],SUM(B.QUANTITY) AS [QTY] 
		FROM CMM01106 A (NOLOCK) 
		JOIN CMD01106 B ON B.CM_ID=A.CM_ID
		JOIN RPS_MST C ON A.CM_ID=C.REF_CM_ID
		WHERE C.CM_ID=@CMEMOID
		GROUP BY A.CM_ID,A.CM_NO,A.CM_DT,A.NET_AMOUNT
	END
	ELSE
	BEGIN
		SELECT A.CM_ID,LTRIM(RTRIM(A.CM_NO)) AS [CM_NO],A.CM_DT,A.NET_AMOUNT AS [SUBTOTAL],0 AS [QTY] 
		FROM CMM01106 A (NOLOCK) 
		JOIN CMD01106 B ON B.CM_ID=A.CM_ID
		JOIN RPS_MST C ON A.CM_ID=C.REF_CM_ID
		WHERE 1=2

	END
END
