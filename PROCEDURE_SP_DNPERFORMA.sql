CREATE PROCEDURE SP_DNPERFORMA    

@NQUERYID NUMERIC(2,0),    
@CFROMDATE NVARCHAR(50),    
@CTODATE NVARCHAR(50),    
@CWHERE  NVARCHAR(MAX),    
@CWHERE1 VARCHAR(100)=''    
--WITH ENCRYPTION

AS    
BEGIN    

DECLARE @CCMD NVARCHAR(MAX)    

IF @NQUERYID = 1    
GOTO LBLLOC    

ELSE IF @NQUERYID = 2    
GOTO LBLGETMST    

ELSE IF @NQUERYID = 3    
GOTO LBLGETDETAILS       

ELSE IF @NQUERYID = 4 
GOTO LBLPRODUCTDETAIL  

ELSE IF @NQUERYID = 5
GOTO LBLPPRINT  

ELSE IF @NQUERYID = 6
GOTO LBLPASTE  



ELSE    
GOTO LAST   
  

LBLLOC:

 Select  dept_id, dept_name,dept_alias, area_name ,city ,state,address1,address2,phone,PINCODE 
 from loc_view   where inactive=0 order by dept_id, dept_name

LBLGETMST:   


SELECT MST.* ,SL.DEPT_NAME AS Source_Dept_name,TL.DEPT_NAME as Target_Dept_name,
CAST('' AS VARCHAR(50)) AS SP_ID  
FROM DebitNote_Proforma_MST MST (NOLOCK)     
LEFT OUTER JOIN LOCATION  SL (NOLOCK)  ON MST.Source_DeptId = SL.DEPT_ID  
LEFT OUTER JOIN LOCATION  TL(NOLOCK)  ON MST.Target_DeptId = TL.DEPT_ID     
WHERE MST.memo_id =@CWHERE    

GOTO LAST    

LBLGETDETAILS:    

SELECT  A.*,
 B.UOM_CODE,       
 B.DISCON,E.UOM_TYPE,  B.ARTICLE_CODE,       
B.ARTICLE_NO, B.ARTICLE_NAME, B.ARTICLE_DESC, C.PARA1_CODE,       
C.PARA1_NAME, D.PARA2_CODE, D.PARA2_ORDER, D.PARA2_NAME, E.UOM_NAME,      
 E.UOM_TYPE,  
G.SUB_SECTION_NAME, H.PARA3_CODE,S.PURCHASE_PRICE,     
H.PARA3_NAME,  J.SECTION_NAME, S.MRP,S.WS_PRICE AS WSP, B.CODING_SCHEME, '' AS BRAND_NAME,     
X.PARA4_NAME, X.PARA4_CODE, Y.PARA5_NAME, Y.PARA5_CODE,     
Z.PARA6_NAME, Z.PARA6_CODE, A.QUANTITY ,
S.ER_FLAG,S.MRP,S.WS_PRICE,B.STOCK_NA,B.ALIAS AS ARTICLE_ALIAS,
CAST('' AS Varchar(50)) AS SP_ID,
A.PRODUCT_CODE AS ORG_PRODUCT_CODE,CAST(0 AS NUMERIC(14,3)) AS QUANTITY_IN_STOCK
FROM DebitNote_Proforma_det A (NOLOCK)        
JOIN DebitNote_Proforma_MST det (NOLOCK) ON A.memo_id = det.memo_id        
JOIN SKU S (NOLOCK)  ON A.PRODUCT_CODE = S.PRODUCT_CODE      
LEFT OUTER JOIN SKU_OH F ON S.PRODUCT_CODE = F.PRODUCT_CODE      
JOIN ARTICLE B (NOLOCK)  ON S.ARTICLE_CODE = B.ARTICLE_CODE        
JOIN PARA1 C (NOLOCK) ON S.PARA1_CODE = C.PARA1_CODE        
JOIN PARA2 D (NOLOCK)  ON S.PARA2_CODE = D.PARA2_CODE       
JOIN PARA3 H (NOLOCK)  ON S.PARA3_CODE = H.PARA3_CODE        
JOIN PARA4 X (NOLOCK)  ON S.PARA4_CODE = X.PARA4_CODE        
JOIN PARA5 Y (NOLOCK)  ON S.PARA5_CODE = Y.PARA5_CODE        
JOIN PARA6 Z (NOLOCK)  ON S.PARA6_CODE = Z.PARA6_CODE       
JOIN UOM E  (NOLOCK)  ON B.UOM_CODE = E.UOM_CODE       
JOIN SECTIOND G (NOLOCK)  ON B.SUB_SECTION_CODE = G.SUB_SECTION_CODE       
 JOIN SECTIONM J (NOLOCK) ON G.SECTION_CODE = J.SECTION_CODE            
WHERE A.memo_id =@CWHERE         

GOTO LAST    


LBLPRODUCTDETAIL:



SELECT  S.PRODUCT_CODE,
 B.UOM_CODE,       
 B.DISCON,E.UOM_TYPE,  B.ARTICLE_CODE,       
B.ARTICLE_NO, B.ARTICLE_NAME, B.ARTICLE_DESC, C.PARA1_CODE,       
C.PARA1_NAME, D.PARA2_CODE, D.PARA2_ORDER, D.PARA2_NAME, E.UOM_NAME,      
 E.UOM_TYPE,  
G.SUB_SECTION_NAME, H.PARA3_CODE,S.PURCHASE_PRICE,     
H.PARA3_NAME,  J.SECTION_NAME, S.MRP,S.WS_PRICE AS WSP, B.CODING_SCHEME, 
X.PARA4_NAME, X.PARA4_CODE, Y.PARA5_NAME, Y.PARA5_CODE,     
Z.PARA6_NAME, Z.PARA6_CODE,
S.ER_FLAG,S.MRP,S.WS_PRICE,B.STOCK_NA,B.ALIAS AS ARTICLE_ALIAS,
CAST(0 AS NUMERIC(14,3)) AS QUANTITY_IN_STOCK    
From SKU S (NOLOCK)        
JOIN ARTICLE B (NOLOCK)  ON S.ARTICLE_CODE = B.ARTICLE_CODE        
JOIN PARA1 C (NOLOCK) ON S.PARA1_CODE = C.PARA1_CODE        
JOIN PARA2 D (NOLOCK)  ON S.PARA2_CODE = D.PARA2_CODE       
JOIN PARA3 H (NOLOCK)  ON S.PARA3_CODE = H.PARA3_CODE        
JOIN PARA4 X (NOLOCK)  ON S.PARA4_CODE = X.PARA4_CODE        
JOIN PARA5 Y (NOLOCK)  ON S.PARA5_CODE = Y.PARA5_CODE        
JOIN PARA6 Z (NOLOCK)  ON S.PARA6_CODE = Z.PARA6_CODE       
JOIN UOM E  (NOLOCK)  ON B.UOM_CODE = E.UOM_CODE       
JOIN SECTIOND G (NOLOCK)  ON B.SUB_SECTION_CODE = G.SUB_SECTION_CODE       
 JOIN SECTIONM J (NOLOCK) ON G.SECTION_CODE = J.SECTION_CODE            
WHERE     S.PRODUCT_CODE = @CWHERE



GOTO LAST   


LBLPPRINT:


SELECT  A.*,det.*,
 B.UOM_CODE,       
 B.DISCON,E.UOM_TYPE,  B.ARTICLE_CODE,       
B.ARTICLE_NO, B.ARTICLE_NAME, B.ARTICLE_DESC, C.PARA1_CODE,       
C.PARA1_NAME, D.PARA2_CODE, D.PARA2_ORDER, D.PARA2_NAME, E.UOM_NAME,      
 E.UOM_TYPE,  
G.SUB_SECTION_NAME, H.PARA3_CODE,S.PURCHASE_PRICE,     
H.PARA3_NAME,  J.SECTION_NAME, S.MRP,S.WS_PRICE AS WSP, B.CODING_SCHEME, '' AS BRAND_NAME,     
X.PARA4_NAME, X.PARA4_CODE, Y.PARA5_NAME, Y.PARA5_CODE,     
Z.PARA6_NAME, Z.PARA6_CODE, A.QUANTITY ,
S.ER_FLAG,S.MRP,S.WS_PRICE,B.STOCK_NA,B.ALIAS AS ARTICLE_ALIAS,
CAST('' AS Varchar(50)) AS SP_ID,
A.PRODUCT_CODE AS ORG_PRODUCT_CODE,CAST(0 AS NUMERIC(14,3)) AS QUANTITY_IN_STOCK
FROM DebitNote_Proforma_det A (NOLOCK)        
JOIN DebitNote_Proforma_MST det (NOLOCK) ON A.memo_id = det.memo_id        
JOIN SKU S (NOLOCK)  ON A.PRODUCT_CODE = S.PRODUCT_CODE      
LEFT OUTER JOIN SKU_OH F ON S.PRODUCT_CODE = F.PRODUCT_CODE      
JOIN ARTICLE B (NOLOCK)  ON S.ARTICLE_CODE = B.ARTICLE_CODE        
JOIN PARA1 C (NOLOCK) ON S.PARA1_CODE = C.PARA1_CODE        
JOIN PARA2 D (NOLOCK)  ON S.PARA2_CODE = D.PARA2_CODE       
JOIN PARA3 H (NOLOCK)  ON S.PARA3_CODE = H.PARA3_CODE        
JOIN PARA4 X (NOLOCK)  ON S.PARA4_CODE = X.PARA4_CODE        
JOIN PARA5 Y (NOLOCK)  ON S.PARA5_CODE = Y.PARA5_CODE        
JOIN PARA6 Z (NOLOCK)  ON S.PARA6_CODE = Z.PARA6_CODE       
JOIN UOM E  (NOLOCK)  ON B.UOM_CODE = E.UOM_CODE       
JOIN SECTIOND G (NOLOCK)  ON B.SUB_SECTION_CODE = G.SUB_SECTION_CODE       
 JOIN SECTIONM J (NOLOCK) ON G.SECTION_CODE = J.SECTION_CODE            
WHERE A.memo_id =@CWHERE         

GOTO LAST   



LBLPASTE:



SELECT  S.PRODUCT_CODE,
 B.UOM_CODE,       
 B.DISCON,E.UOM_TYPE,  B.ARTICLE_CODE,       
B.ARTICLE_NO, B.ARTICLE_NAME, B.ARTICLE_DESC, C.PARA1_CODE,       
C.PARA1_NAME, D.PARA2_CODE, D.PARA2_ORDER, D.PARA2_NAME, E.UOM_NAME,      
 E.UOM_TYPE,  
G.SUB_SECTION_NAME, H.PARA3_CODE,S.PURCHASE_PRICE,     
H.PARA3_NAME,  J.SECTION_NAME, S.MRP,S.WS_PRICE AS WSP, B.CODING_SCHEME, 
X.PARA4_NAME, X.PARA4_CODE, Y.PARA5_NAME, Y.PARA5_CODE,     
Z.PARA6_NAME, Z.PARA6_CODE,
S.ER_FLAG,S.MRP,S.WS_PRICE,B.STOCK_NA,B.ALIAS AS ARTICLE_ALIAS,
 PRT.QUANTITY ,'' as errmsg
From SKU S (NOLOCK)        
JOIN PRT_ITEM_DETAILS PRT ON S.PRODUCT_CODE= PRT.PRODUCT_CODE
JOIN ARTICLE B (NOLOCK)  ON S.ARTICLE_CODE = B.ARTICLE_CODE        
JOIN PARA1 C (NOLOCK) ON S.PARA1_CODE = C.PARA1_CODE        
JOIN PARA2 D (NOLOCK)  ON S.PARA2_CODE = D.PARA2_CODE       
JOIN PARA3 H (NOLOCK)  ON S.PARA3_CODE = H.PARA3_CODE        
JOIN PARA4 X (NOLOCK)  ON S.PARA4_CODE = X.PARA4_CODE        
JOIN PARA5 Y (NOLOCK)  ON S.PARA5_CODE = Y.PARA5_CODE        
JOIN PARA6 Z (NOLOCK)  ON S.PARA6_CODE = Z.PARA6_CODE       
JOIN UOM E  (NOLOCK)  ON B.UOM_CODE = E.UOM_CODE       
JOIN SECTIOND G (NOLOCK)  ON B.SUB_SECTION_CODE = G.SUB_SECTION_CODE       
 JOIN SECTIONM J (NOLOCK) ON G.SECTION_CODE = J.SECTION_CODE            
WHERE     PRT.SP_ID = @CWHERE



GOTO LAST   


LAST:    
END
