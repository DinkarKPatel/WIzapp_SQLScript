CREATE PROCEDURE SP3S_PENDING_RETAIL_ORDERS_DETAILS
(
 @NORDERPERIOD NUMERIC(1)=1
	 /*
		@NORDERPERIOD : 
		IF VALUE IS 1 - ORDERS WILL BE FILTERED BASED ON ONLY @DTO_DT
		IF VALUE IS 2 - ORDERS WILL BE FILTERED BASED ON @DFROM_DT AND @DTO_DT
	 */
	,@DFROM_DT DATETIME=''
	,@DTO_DT DATETIME=''
	,@CCUSTOMER_CODE VARCHAR(12)=''
	,@CDEPT_ID VARCHAR(5)=''
	,@DFILTER_CMDT DATETIME='' /*CASHMEMO CONSIDERATION DATE*/
	,@NMODE NUMERIC(1)=1 -- 1 FOR ALL 2 FOR PENGING 3 FOR DELIVER
	)

AS
BEGIN
    
       
	    DECLARE  @SUMTABLE TABLE(LOC_ID VARCHAR(5),LOC_NAME VARCHAR(500),LOC_ALIAS VARCHAR(20),ORDER_DT DATETIME,
	                             ORDER_NO CHAR(10),CUSTOMER_ID VARCHAR(50),CUSTOMER_NAME VARCHAR(300),SALE_PERSON VARCHAR(50),
							     ORDER_QTY NUMERIC(10,2),ORDER_AMT NUMERIC(10,2),DELIVERY_DT	 DATETIME,
							     DUE_DAYS INT,	DELIVER_QTY	NUMERIC(10,2),DELIVER_AMOUNT NUMERIC(10,2),	
							     PENDING_QTY NUMERIC(10,2),PENDING_AMT NUMERIC(10,2))

								
			INSERT INTO @SUMTABLE  EXEC SP3S_PENDING_RETAIL_ORDERS_SUMMARY @NORDERPERIOD,@DFROM_DT,@DTO_DT,
											@CCUSTOMER_CODE,@CDEPT_ID,@DFILTER_CMDT,@NMODE					
		   
		   
		   SELECT  C.*,B.ORDER_NO,A.PRODUCT_CODE,A.QUANTITY AS ORDER_QTY,
				  A.GROSS_WSP AS RATE,ART.ARTICLE_NO AS ARTICLE_NO
		   FROM WSL_ORDER_DET A (NOLOCK)
		   JOIN WSL_ORDER_MST B(NOLOCK) ON A.ORDER_ID=B.ORDER_ID
		   JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE=A.ARTICLE_CODE
		   JOIN @SUMTABLE C  ON   C.ORDER_NO=B.ORDER_NO

END
--END OF PROCEDURE - SP3S_PENDING_RETAIL_ORDERS_DETAILS
