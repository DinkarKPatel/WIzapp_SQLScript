CREATE PROC VALIDATEXN_VCH_BEFORE_EDIT 
@CMEMOID VARCHAR(30),
@BCANCELXN BIT,
@CERRORMSG VARCHAR(200) OUTPUT,
@CEXPRERRORMSG VARCHAR(200) OUTPUT
--WITH ENCRYPTION
AS
BEGIN
	
	   
 DECLARE @CTEXT VARCHAR(10),@CVOUCHERNO VARCHAR(20),@DVOUCHERDT DATETIME,@CVOUCHERCODE CHAR(10)  
   
 SET @CTEXT=(CASE WHEN @BCANCELXN=1 THEN 'CANCEL' ELSE 'EDIT' END)  
 
 SELECT @CVOUCHERCODE=VOUCHER_CODE FROM VM01106 WHERE VM_ID=@CMEMOID
 
 SELECT TOP 1 @CVOUCHERNO=C.VOUCHER_NO,@DVOUCHERDT=C.VOUCHER_DT
 FROM VM01106 A JOIN ACC_MEMO_REVERSAL B ON A.VM_ID=B.MEMO_VM_ID  
 JOIN VM01106 C ON C.VM_ID=B.REVERSAL_VM_ID
 WHERE A.VM_ID=@CMEMOID
		     
 IF ISNULL(@CVOUCHERNO,'')<>''
 BEGIN  
	  SET @CERRORMSG='MEMO REVERSAL ENTRY HAS BEEN DONE FOR THIS VOUCHER AGAINST VOUCHER#'+@CVOUCHERNO+' DATED:'+CONVERT(VARCHAR,@DVOUCHERDT,105)+'.........CAN NOT '+@CTEXT  
	  RETURN  
 END  
 
 IF @CVOUCHERCODE='MEMO000002' AND @BCANCELXN=0
 BEGIN  
	SET @CERRORMSG='MEMO REVERSAL VOUCHERS CANNOT BE MODIFIED' 
	RETURN  
 END 
 			
END
