CREATE  VIEW VW_AGENCY_ISSUE_MATERIAL_REPORT       
AS           
  
SELECT D2.ARTICLE_NO AS ARTICLE_SET,T3.ITEM_REMARKS AS ITEM_REMARKS,P1.PARA1_NAME COM_COLOR,P2.PARA2_NAME AS COM_SIZE, WO.MEMO_NO AS [WORK_ORDER_NO],WO.REF_NO ,D.ARTICLE_NAME AS [COMPONENT NAME] ,D.ARTICLE_DESC AS [COMPONENT DESC] ,D.ARTICLE_NO AS [COMPONENT NO],       
D1.ARTICLE_NO ,SKU.PRODUCT_CODE,  D1.ARTICLE_NAME ,D1.ARTICLE_DESC,PARA1.PARA1_NAME AS COLOR,PARA3.PARA3_NAME AS DESIGN_NO,PARA4.PARA4_NAME AS FAB_DESIGN_NO ,UOM.UOM_NAME ,J.JOB_NAME    
,E.SUB_SECTION_NAME,E.SUB_SECTION_CODE,F.SECTION_NAME,F.SECTION_CODE      
,CONVERT(VARCHAR,T1.DELIVERY_DT,105) AS [DELIVERY DATE]       
,T1.MEMO_NO ,CONVERT(CHAR(10),T1.MEMO_DT,105) AS MEMO_DATE , K.AGENCY_NAME      
,LM.ADDRESS0+' '+LM.ADDRESS1+' '+LM.ADDRESS2+' '+LM.AREA_NAME+' '+LM.CITY +' '+ LM.STATE +' '+ LM.PINCODE AS [ADDRESS]    
,ISNULL(T1.SUBTOTAL,0) AS SUBTOTAL,  ISNULL(T1.DISCOUNT_AMT,0) AS DISCOUNT_AMOUNT,ISNULL(T1.OTHER_CHARGES,0) AS OTHERCHARGES          
,ISNULL(T1.FREIGHT,0) AS FREIGHT,T1.NET_AMOUNT  ,T1.REMARKS AS MST_REMARKS               
,CASE WHEN T1.CANCELLED =0 THEN '' ELSE 'CANCELLED' END AS CANCELLED ,T2.USERNAME AS USER_NAME     ,T1.MEMO_ID              
,T3.[QUANTITY] AS ITEM_QUANTITY      ,T3.[RATE] AS ITEM_RATE      ,T3.[AMOUNT]             
  ,T3.[DISCOUNT_PERCENTAGE] AS ITEM_LEVEL_DISC_PER      ,T3.[DISCOUNT_AMOUNT] AS ITEM_LEVEL_DISC_AMT        
      ,T3.[NET_AMOUNT] AS ITEM_LEVEL_AMT_AFTER_DISC,COM.COMPANY_CODE     
      ,EMP.EMP_FNAME+' '+EMP.EMP_LNAME AS PC_NAME,T4.ISSUE_QTY AS ORD_QUANTITY   
FROM PRD_AGENCY_ISSUE_MATERIAL_MST T1       
JOIN USERS T2 ON T1.USER_CODE = T2.USER_CODE              
JOIN PRD_AGENCY_ISSUE_MATERIAL_DET T3 ON T1.MEMO_ID=T3.MEMO_ID       
JOIN PRD_WO_MST WO ON    T3.REF_PRD_WORKORDER_MEMOID=WO.MEMO_ID    
JOIN PRD_SKU SKU ON SKU.PRODUCT_UID=T3.PRODUCT_UID      
JOIN PARA1 ON SKU.PARA1_CODE=PARA1.PARA1_CODE    
JOIN PARA3 ON SKU.PARA3_CODE=PARA3.PARA3_CODE    
JOIN PARA4 ON SKU.PARA4_CODE=PARA4.PARA4_CODE    
JOIN PRD_AGENCY_MST  K ON T1.REF_AGENCY_CODE = K.AGENCY_CODE            
JOIN ARTICLE (NOLOCK) D ON T3.REF_COMPONENT_ARTICLE_CODE= D.ARTICLE_CODE         
JOIN ARTICLE (NOLOCK) D1 ON T3.ARTICLE_CODE= D1.ARTICLE_CODE  
JOIN ARTICLE (NOLOCK) D2 ON WO.ARTICLE_SET_CODE= D2.ARTICLE_CODE                
JOIN UOM ON UOM.UOM_CODE=D1.UOM_CODE      
JOIN LMV01106 LM ON LM.AC_CODE=K.AC_CODE           
JOIN JOBS J ON J.JOB_CODE=T3.JOB_CODE    
JOIN SECTIOND (NOLOCK) E ON D.SUB_SECTION_CODE = E.SUB_SECTION_CODE               
JOIN SECTIONM (NOLOCK) F ON E.SECTION_CODE = F.SECTION_CODE      
JOIN COMPANY COM ON 1=1 AND COM.COMPANY_CODE='01'    
LEFT OUTER JOIN EMP_MST EMP ON EMP.EMP_ID=WO.EMP_CODE      
LEFT JOIN PARA1 P1 ON SKU.COM_PARA1_CODE=P1.PARA1_CODE    
LEFT JOIN PARA2 P2 ON SKU.COM_PARA2_CODE=P2.PARA2_CODE 
JOIN PRD_AGENCY_ISSUE_ROW_MATERIAL_DET  T4 ON T4.MEMO_ID=T3.MEMO_ID AND T4.ROW_ID=T3.REF_MATERIAL_ROW_ID
