CREATE PROCEDURE SP_GETREPORTFORMAT  
(  
 @CXNTYPE VARCHAR(10),  
 @NQUERYID NUMERIC(5),  
 @CMEMOID VARCHAR(50)='',  
 @BEXEC  BIT=0,  
 @CTABLENAME VARCHAR(100)='' OUTPUT  
)
--WITH ENCRYPTION 
AS 
BEGIN  
 DECLARE @CTEMPTABLENAME NVARCHAR(100),@CCMD NVARCHAR(MAX)  
   
  
 IF @CXNTYPE='SLS'  
 BEGIN  
  
  IF @NQUERYID=1  
  BEGIN  
   IF @BEXEC=0  
   BEGIN  
          
    SELECT TOP 1 A.*  
    FROM VW_CASHMEMO_PRINT_MST  A  
    WHERE A.CM_ID=@CMEMOID  
   END  
     
   ELSE  
   BEGIN  
    SET @CTEMPTABLENAME=N'TEMP_SLS_CUSTOMFORMAT_'+LTRIM(RTRIM(STR(@NQUERYID)))+'_'+LTRIM(RTRIM(STR(@@SPID)))  
      
    IF OBJECT_ID(@CTEMPTABLENAME,N'U') IS NOT NULL  
     EXECUTE(N'DROP TABLE  '+ @CTEMPTABLENAME)  
       
    SET @CCMD=N'SELECT * INTO '+@CTEMPTABLENAME+' FROM VW_CASHMEMO_PRINT_MST  A WHERE 1=2'  
    EXEC SP_EXECUTESQL @CCMD  
      
    SET @CTABLENAME=@CTEMPTABLENAME  
   END  
  END  
    
  ELSE  
    
  IF @NQUERYID=2  
  BEGIN  
   IF @BEXEC=0  
    SELECT A.*,ROW_NUMBER() OVER (PARTITION BY A.CM_ID ORDER BY A.TS)  AS SR_NO_NEW
    FROM VW_CASHMEMO_PRINT_DET A  WHERE CM_ID=@CMEMOID  ORDER BY SR_NO 
   ELSE  
   BEGIN  
    SET @CTEMPTABLENAME=N'TEMP_SLS_CUSTOMFORMAT_'+LTRIM(RTRIM(STR(@NQUERYID)))+'_'+LTRIM(RTRIM(STR(@@SPID)))  
      
    IF OBJECT_ID(@CTEMPTABLENAME,N'U') IS NOT NULL  
     EXECUTE(N'DROP TABLE  '+ @CTEMPTABLENAME)  
       
    SET @CCMD=N'SELECT *,0 AS SR_NO_NEW INTO '+@CTEMPTABLENAME+' FROM VW_CASHMEMO_PRINT_DET  WHERE 1=2'  
    EXEC SP_EXECUTESQL @CCMD  
      
    SET @CTABLENAME=@CTEMPTABLENAME  
   END   
  END  
 END  

    
 ELSE  
 IF @CXNTYPE='PKS'  
 BEGIN  
  
	  IF @NQUERYID=1  
	  BEGIN  
	   IF @BEXEC=0  
	   BEGIN  
	          
		SELECT TOP 1 A.*  
		FROM VW_RETAILPS_PRINT_MST  A  
		WHERE A.CM_ID=@CMEMOID  
	   END  
	     
	   ELSE  
	   BEGIN  
		SET @CTEMPTABLENAME=N'TEMP_RPS_CUSTOMFORMAT_'+LTRIM(RTRIM(STR(@NQUERYID)))+'_'+LTRIM(RTRIM(STR(@@SPID)))  
	      
		IF OBJECT_ID(@CTEMPTABLENAME,N'U') IS NOT NULL  
		 EXECUTE(N'DROP TABLE  '+ @CTEMPTABLENAME)  
	       
		SET @CCMD=N'SELECT * INTO '+@CTEMPTABLENAME+' FROM VW_RETAILPS_PRINT_MST  A WHERE 1=2'  
		EXEC SP_EXECUTESQL @CCMD  
	      
		SET @CTABLENAME=@CTEMPTABLENAME  
	   END  
	  END  
	  ELSE  
	    
	  IF @NQUERYID=2  
	  BEGIN  
	   IF @BEXEC=0  
		SELECT A.*,ROW_NUMBER() OVER (PARTITION BY A.CM_ID ORDER BY A.TS)  AS SR_NO_NEW
		FROM VW_RETAILPS_PRINT_DET A WHERE CM_ID=@CMEMOID  
	   ELSE  
	   BEGIN  
		SET @CTEMPTABLENAME=N'TEMP_RPS_CUSTOMFORMAT_'+LTRIM(RTRIM(STR(@NQUERYID)))+'_'+LTRIM(RTRIM(STR(@@SPID)))  
	      
		IF OBJECT_ID(@CTEMPTABLENAME,N'U') IS NOT NULL  
		 EXECUTE(N'DROP TABLE  '+ @CTEMPTABLENAME)  
	       
		SET @CCMD=N'SELECT *,0 AS SR_NO_NEW INTO '+@CTEMPTABLENAME+' FROM VW_RETAILPS_PRINT_DET  WHERE 1=2'  
		EXEC SP_EXECUTESQL @CCMD  
	      
		SET @CTABLENAME=@CTEMPTABLENAME  
	   END   
	  END  
 END  
 
 ELSE IF @CXNTYPE='PRT'  
 BEGIN  
  
  IF @NQUERYID=1  
  BEGIN  
   IF @BEXEC=0  
   BEGIN  
          
    SELECT TOP 1 A.*  
    FROM VW_PRT_PRINT_MST  A  
    WHERE A.RM_ID=@CMEMOID  
   END  
     
   ELSE  
   BEGIN  
    SET @CTEMPTABLENAME=N'TEMP_PRT_CUSTOMFORMAT_'+LTRIM(RTRIM(STR(@NQUERYID)))+'_'+LTRIM(RTRIM(STR(@@SPID)))  
      
    IF OBJECT_ID(@CTEMPTABLENAME,N'U') IS NOT NULL  
     EXECUTE(N'DROP TABLE  '+ @CTEMPTABLENAME)  
       
    SET @CCMD=N'SELECT * INTO '+@CTEMPTABLENAME+' FROM VW_PRT_PRINT_MST  A WHERE 1=2'  
    EXEC SP_EXECUTESQL @CCMD  
      
    SET @CTABLENAME=@CTEMPTABLENAME  
   END  
  END  
    
  ELSE  
  IF @NQUERYID=2  
  BEGIN  
   IF @BEXEC=0  
    SELECT * FROM VW_PRT_PRINT_DET  WHERE RM_ID=@CMEMOID  
   ELSE  
   BEGIN  
    SET @CTEMPTABLENAME=N'TEMP_PRT_CUSTOMFORMAT_'+LTRIM(RTRIM(STR(@NQUERYID)))+'_'+LTRIM(RTRIM(STR(@@SPID)))  
      
    IF OBJECT_ID(@CTEMPTABLENAME,N'U') IS NOT NULL  
     EXECUTE(N'DROP TABLE  '+ @CTEMPTABLENAME)  
       
    SET @CCMD=N'SELECT * INTO '+@CTEMPTABLENAME+' FROM VW_PRT_PRINT_DET  WHERE 1=2'  
    EXEC SP_EXECUTESQL @CCMD  
      
    SET @CTABLENAME=@CTEMPTABLENAME  
   END   
  END  
 END 
 
 ELSE
 IF @CXNTYPE='WSL'  
 BEGIN  
  
  IF @NQUERYID=1  
  BEGIN  
   IF @BEXEC=0  
   BEGIN  
          
    SELECT TOP 1 A.*  
    FROM VW_WSL_PRINT_MST  A  
    WHERE A.INV_ID=@CMEMOID  
   END  
     
   ELSE  
   BEGIN  
    SET @CTEMPTABLENAME=N'TEMP_WSL_CUSTOMFORMAT_'+LTRIM(RTRIM(STR(@NQUERYID)))+'_'+LTRIM(RTRIM(STR(@@SPID)))  
      
    IF OBJECT_ID(@CTEMPTABLENAME,N'U') IS NOT NULL  
     EXECUTE(N'DROP TABLE  '+ @CTEMPTABLENAME)  
       
    SET @CCMD=N'SELECT * INTO '+@CTEMPTABLENAME+' FROM VW_WSL_PRINT_MST  A WHERE 1=2'  
    EXEC SP_EXECUTESQL @CCMD  
      
    SET @CTABLENAME=@CTEMPTABLENAME  
   END  
  END  
    
  ELSE  
  IF @NQUERYID=2  
  BEGIN  
   IF @BEXEC=0  
    SELECT * FROM VW_WL_WSLINV  WHERE INV_ID=@CMEMOID  
   ELSE  
   BEGIN  
    SET @CTEMPTABLENAME=N'TEMP_WSL_CUSTOMFORMAT_'+LTRIM(RTRIM(STR(@NQUERYID)))+'_'+LTRIM(RTRIM(STR(@@SPID)))  
      
    IF OBJECT_ID(@CTEMPTABLENAME,N'U') IS NOT NULL  
     EXECUTE(N'DROP TABLE  '+ @CTEMPTABLENAME)  
       
    SET @CCMD=N'SELECT * INTO '+@CTEMPTABLENAME+' FROM VW_WL_WSLINV  WHERE 1=2'  
    EXEC SP_EXECUTESQL @CCMD  
      
    SET @CTABLENAME=@CTEMPTABLENAME  
   END   
  END  
 END 
 
 ELSE
 IF @CXNTYPE='WSR'  
 BEGIN  
  
  IF @NQUERYID=1  
  BEGIN  
   IF @BEXEC=0  
   BEGIN  
          
    SELECT TOP 1 A.*  
    FROM VW_WSR_PRINT_MST  A  
    WHERE A.CN_ID=@CMEMOID  
   END  
     
   ELSE  
   BEGIN  
    SET @CTEMPTABLENAME=N'TEMP_WSR_CUSTOMFORMAT_'+LTRIM(RTRIM(STR(@NQUERYID)))+'_'+LTRIM(RTRIM(STR(@@SPID)))  
      
    IF OBJECT_ID(@CTEMPTABLENAME,N'U') IS NOT NULL  
     EXECUTE(N'DROP TABLE  '+ @CTEMPTABLENAME)  
       
    SET @CCMD=N'SELECT * INTO '+@CTEMPTABLENAME+' FROM VW_WSR_PRINT_MST  A WHERE 1=2'  
    EXEC SP_EXECUTESQL @CCMD  
      
    SET @CTABLENAME=@CTEMPTABLENAME  
   END  
  END  
    
  ELSE  
  IF @NQUERYID=2  
  BEGIN  
   IF @BEXEC=0  
    SELECT * FROM VW_WSR_PRINT_DET  WHERE CN_ID=@CMEMOID  
   ELSE  
   BEGIN  
    SET @CTEMPTABLENAME=N'TEMP_WSR_CUSTOMFORMAT_'+LTRIM(RTRIM(STR(@NQUERYID)))+'_'+LTRIM(RTRIM(STR(@@SPID)))  
      
    IF OBJECT_ID(@CTEMPTABLENAME,N'U') IS NOT NULL  
     EXECUTE(N'DROP TABLE  '+ @CTEMPTABLENAME)  
       
    SET @CCMD=N'SELECT * INTO '+@CTEMPTABLENAME+' FROM VW_WSR_PRINT_DET  WHERE 1=2'  
    EXEC SP_EXECUTESQL @CCMD  
      
    SET @CTABLENAME=@CTEMPTABLENAME  
   END   
  END  
 END 
 
 ELSE
 IF @CXNTYPE='ADVREC'
 BEGIN
	 IF @NQUERYID=1
	 BEGIN
		IF @BEXEC=0  
			SELECT * FROM VW_WL_ARC_MULTI WHERE ADV_REC_ID=@CMEMOID
		ELSE
			BEGIN
				SET @CTEMPTABLENAME=N'TEMP_ADVREC_CUSTOMFORMAT_'+LTRIM(RTRIM(STR(@NQUERYID)))+'_'+LTRIM(RTRIM(STR(@@SPID)))    
	        
				IF OBJECT_ID(@CTEMPTABLENAME,N'U') IS NOT NULL    
				EXECUTE(N'DROP TABLE  '+ @CTEMPTABLENAME)    
	         
				SET @CCMD=N'SELECT * INTO '+@CTEMPTABLENAME+' FROM VW_WL_ARC_MULTI WHERE 1=2'    
				EXEC SP_EXECUTESQL @CCMD    
	        
				SET @CTABLENAME=@CTEMPTABLENAME 
			END
	 END
 END
 
 ELSE
 IF @CXNTYPE='WPS'    
 BEGIN    
    
	 IF @NQUERYID=1    
	  BEGIN    
	   IF @BEXEC=0    
	   BEGIN    
	           
		SELECT TOP 1 A.*    
		FROM VW_WPS_MST  A  
		WHERE A.PS_ID=@CMEMOID    
	   END    
	       
	   ELSE    
	   BEGIN    
		SET @CTEMPTABLENAME=N'TEMP_WPS_CUSTOMFORMAT_'+LTRIM(RTRIM(STR(@NQUERYID)))+'_'+LTRIM(RTRIM(STR(@@SPID)))    
	        
		IF OBJECT_ID(@CTEMPTABLENAME,N'U') IS NOT NULL    
		 EXECUTE(N'DROP TABLE  '+ @CTEMPTABLENAME)    
	         
		SET @CCMD=N'SELECT * INTO '+@CTEMPTABLENAME+' FROM VW_WPS_MST  A WHERE 1=2'    
		EXEC SP_EXECUTESQL @CCMD    
	        
		SET @CTABLENAME=@CTEMPTABLENAME    
	   END    
	  END    
	      
	  ELSE    
	      
	  IF @NQUERYID=2    
	  BEGIN    
		   IF @BEXEC=0    
			SELECT A.*,ROW_NUMBER() OVER (PARTITION BY A.PS_ID ORDER BY A.TS)  AS SR_NO_NEW  
			FROM VW_WPS_DET A  WHERE PS_ID=@CMEMOID    
		   ELSE    
		   BEGIN    
			SET @CTEMPTABLENAME=N'TEMP_WPS_CUSTOMFORMAT_'+LTRIM(RTRIM(STR(@NQUERYID)))+'_'+LTRIM(RTRIM(STR(@@SPID)))    
		        
			IF OBJECT_ID(@CTEMPTABLENAME,N'U') IS NOT NULL    
			 EXECUTE(N'DROP TABLE  '+ @CTEMPTABLENAME)    
		         
			SET @CCMD=N'SELECT *,0 AS SR_NO_NEW INTO '+@CTEMPTABLENAME+' FROM VW_WPS_DET  WHERE 1=2'    
			EXEC SP_EXECUTESQL @CCMD    
		        
			SET @CTABLENAME=@CTEMPTABLENAME    
		   END     
	   END    
 END    
 
  
 
END
