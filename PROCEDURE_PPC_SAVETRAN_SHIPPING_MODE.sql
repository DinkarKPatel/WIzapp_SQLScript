CREATE PROCEDURE PPC_SAVETRAN_SHIPPING_MODE
(
    @NUPDATEMODE		NUMERIC(1,0), --1: FOR ADD, 2 FOR EDIT/UPDATE, 0 FOR DELETE
	@NSPID				INT,
    @CSHIPPING_MODE INT=0
)
AS
BEGIN
   
     DECLARE @CTEMPDBNAME VARCHAR(100),
			@CMASTERTABLENAME	VARCHAR(100),
			@CTEMPMASTERTABLENAME	VARCHAR(100),
			@CERRORMSG VARCHAR(1000),
			@NSTEP VARCHAR(10)
     DECLARE @OUTPUT TABLE (ERRMSG VARCHAR(2000), MEMO_ID VARCHAR(100))
     
    BEGIN TRANSACTION
    BEGIN TRY
		IF @NUPDATEMODE=1 OR @NUPDATEMODE=2
		 BEGIN
			SET @CMASTERTABLENAME	= 'PPC_SHIPPING_DETAILS'
			SET @CTEMPMASTERTABLENAME	= 'PPC_PPC_SHIPPING_DETAILS_UPLOAD'
		
		  DECLARE @FILTER VARCHAR(MAX)
		  SET @FILTER=' B.SP_ID='''+LTRIM(RTRIM(STR(@NSPID)))+''''
		
			SET @NSTEP=10
			EXEC UPDATEMASTERXN 
				  @CSOURCEDB	= ''
				, @CSOURCETABLE = @CTEMPMASTERTABLENAME
				, @CDESTDB		= ''
				, @CDESTTABLE	= @CMASTERTABLENAME
				, @CKEYFIELD1	= 'SHIPPING_MODE'
				, @BALWAYSUPDATE = 1
				,@CFILTERCONDITION=@FILTER
				
		END
	   ELSE IF @NUPDATEMODE=0
		BEGIN
			
			SET @NSTEP='116'
			DELETE FROM PPC_SHIPPING_DETAILS WHERE SHIPPING_MODE= @CSHIPPING_MODE
			GOTO END_PROC
		END
	END TRY
	BEGIN CATCH
		SET @CERRORMSG = 'STEP- ' + LTRIM(STR(@NSTEP)) + ' SQL ERROR: #' + LTRIM(STR(ERROR_NUMBER())) + ' ' + ERROR_MESSAGE()
		GOTO END_PROC
	END CATCH

	
END_PROC:
	IF @@TRANCOUNT>0
	BEGIN
		IF ISNULL(@CERRORMSG,'')='' 
			COMMIT TRANSACTION
		ELSE
			ROLLBACK
	END
	INSERT @OUTPUT ( ERRMSG, MEMO_ID)
		VALUES ( ISNULL(@CERRORMSG,''), '' )
	SELECT * FROM @OUTPUT	
END
