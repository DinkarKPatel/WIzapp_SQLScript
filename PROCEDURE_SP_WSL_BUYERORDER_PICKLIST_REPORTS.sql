CREATE PROCEDURE SP_WSL_BUYERORDER_PICKLIST_REPORTS
(
     @DFROMDATE DATETIME	  /*PICKLIST,BUYERORDER CONSIDERATION FROM DATE */
	,@DTODATE DATETIME		  /*PICKLIST,BUYERORDER TO BE CONSIDERED TILL DATE*/
	,@PARTY_NO VARCHAR(10)='' /*GET DETAILS FOR A SINGLE PARTY OR ALL PARTY*/
	,@CARTICLE_NO VARCHAR(10)='' /*GET DETAILS FOR AN ARTICLE OR ALL ARTICLES*/
	,@BBUYERORDER_PICKLIST BIT=0		  /*GET 0 -FOR BUYER ORDER 1 FOR - PICKLIST*/
)
--WITH ENCRYPTION
AS
BEGIN
   IF @BBUYERORDER_PICKLIST=0
   BEGIN
		SELECT BOM.ORDER_NO  AS ORDER_NO,LM.AC_NAME AS PARTY_NAME,
		       CONVERT(VARCHAR,BOM.ORDER_DT,105) AS ORDER_DT,
		       ART.ARTICLE_NO,COLOR=P1.PARA1_NAME ,SIZE=P2.PARA2_NAME 
			  ,CAST(BOD.QUANTITY AS NUMERIC(18,2)) AS ORDER_QTY
			  ,CONVERT(VARCHAR,BOM.DELIVERY_DT ,105) AS DELIVERY_DT
		FROM BUYER_ORDER_MST BOM(NOLOCK)
		JOIN BUYER_ORDER_DET BOD(NOLOCK) ON BOM.ORDER_ID=BOD.ORDER_ID
		JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =BOM.AC_CODE 
		JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE =BOD.ARTICLE_CODE 
		JOIN PARA1 P1 (NOLOCK) ON P1.PARA1_CODE=BOD.PARA1_CODE
		JOIN PARA2 P2 (NOLOCK) ON P2.PARA2_CODE=BOD.PARA2_CODE
		WHERE BOM.CANCELLED =0 AND 
		BOM.ORDER_DT BETWEEN @DFROMDATE AND @DTODATE
		AND (@PARTY_NO='' OR BOM.AC_CODE =@PARTY_NO)
		AND (@CARTICLE_NO='' OR ART.ARTICLE_CODE=@CARTICLE_NO)
		ORDER BY ORDER_NO
		
		 SELECT B.PICK_LIST_NO  AS PARTY_NO,LM.AC_NAME AS PARTY_NAME,
             CONVERT(VARCHAR,B.PICK_LIST_DT ,150) AS PICK_LIST_DT,
             ART.ARTICLE_NO,COLOR=P1.PARA1_NAME ,SIZE=P2.PARA2_NAME ,
             CAST(A.PICK_LIST_QTY AS NUMERIC(18,2)) AS PICK_LIST_QTY
             ,CAST((ISNULL(A.ADD_QTY,0)) AS NUMERIC(18,2)) AS PICK_LIST_ADD_QTY
             ,CAST(ISNULL(A.PICK_LIST_QTY,0)+ISNULL(A.ADD_QTY,0) AS NUMERIC(18,2)) AS PICK_LIST_TOTAL_QTY
			 ,CONVERT(VARCHAR,DELIVERY_DT ,105) AS DELIVERY_DT 
		FROM WSL_PICKLIST_DET A (NOLOCK)
		JOIN WSL_PICKLIST_MST B (NOLOCK) ON A.PICK_LIST_ID = B.PICK_LIST_ID
		LEFT JOIN
		(
		   SELECT AC_CODE,ARTICLE_CODE,PARA1_CODE,PARA2_CODE,BOM.ORDER_ID,DELIVERY_DT 
		   FROM BUYER_ORDER_MST BOM(NOLOCK)
		   JOIN BUYER_ORDER_DET BOD(NOLOCK) ON BOM.ORDER_ID=BOD.ORDER_ID
		)BOM ON B.AC_CODE=BOM.AC_CODE AND A.ARTICLE_CODE = BOM.ARTICLE_CODE AND A.PARA1_CODE = BOM.PARA1_CODE 
			AND A.PARA2_CODE = BOM.PARA2_CODE AND A.ORDER_ID   = BOM.ORDER_ID
		JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =B.AC_CODE 
		JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE =A.ARTICLE_CODE 
		JOIN PARA1 P1 (NOLOCK) ON P1.PARA1_CODE=A.PARA1_CODE
		JOIN PARA2 P2 (NOLOCK) ON P2.PARA2_CODE=A.PARA2_CODE
		WHERE 1>2
	END
	
  IF @BBUYERORDER_PICKLIST=1
   BEGIN
      
		SELECT BOM.ORDER_NO  AS ORDER_NO,LM.AC_NAME AS PARTY_NAME,
		      CONVERT(VARCHAR,BOM.ORDER_DT,105) AS ORDER_DT,
		       ART.ARTICLE_NO,COLOR=P1.PARA1_NAME ,SIZE=P2.PARA2_NAME 
			  ,CAST(BOD.QUANTITY AS NUMERIC(18,2)) AS ORDER_QTY
			  ,CONVERT(VARCHAR,BOM.DELIVERY_DT ,105) AS DELIVERY_DT
		FROM BUYER_ORDER_MST BOM(NOLOCK)
		JOIN BUYER_ORDER_DET BOD(NOLOCK) ON BOM.ORDER_ID=BOD.ORDER_ID
		JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =BOM.AC_CODE 
		JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE =BOD.ARTICLE_CODE 
		JOIN PARA1 P1 (NOLOCK) ON P1.PARA1_CODE=BOD.PARA1_CODE
		JOIN PARA2 P2 (NOLOCK) ON P2.PARA2_CODE=BOD.PARA2_CODE
		WHERE 1>2
		
		SELECT B.PICK_LIST_NO  AS PICK_LIST_NO,LM.AC_NAME  AS PARTY_NAME,
             CONVERT(VARCHAR,B.PICK_LIST_DT ,105) AS PICK_LIST_DT,
             ART.ARTICLE_NO,COLOR=P1.PARA1_NAME ,SIZE=P2.PARA2_NAME ,
             CAST(A.PICK_LIST_QTY AS NUMERIC(18,2)) AS PICK_LIST_QTY
             ,CAST((ISNULL(A.ADD_QTY,0)) AS NUMERIC(18,2)) AS PICK_LIST_ADD_QTY
             ,CAST(ISNULL(A.PICK_LIST_QTY,0)+ISNULL(A.ADD_QTY,0) AS NUMERIC(18,2)) AS PICK_LIST_TOTAL_QTY
			 ,CONVERT(VARCHAR,DELIVERY_DT ,105) AS DELIVERY_DT
		FROM WSL_PICKLIST_DET A (NOLOCK)
		JOIN WSL_PICKLIST_MST B (NOLOCK) ON A.PICK_LIST_ID = B.PICK_LIST_ID
		LEFT JOIN
		(
		   SELECT AC_CODE,ARTICLE_CODE,PARA1_CODE,PARA2_CODE,BOM.ORDER_ID,DELIVERY_DT 
		   FROM BUYER_ORDER_MST BOM(NOLOCK)
		  JOIN BUYER_ORDER_DET BOD(NOLOCK) ON BOM.ORDER_ID=BOD.ORDER_ID
		)BOM ON B.AC_CODE=BOM.AC_CODE AND A.ARTICLE_CODE = BOM.ARTICLE_CODE AND A.PARA1_CODE = BOM.PARA1_CODE 
			AND A.PARA2_CODE = BOM.PARA2_CODE AND A.ORDER_ID   = BOM.ORDER_ID
		JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =B.AC_CODE 
		JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE =A.ARTICLE_CODE 
		JOIN PARA1 P1 (NOLOCK) ON P1.PARA1_CODE=A.PARA1_CODE
		JOIN PARA2 P2 (NOLOCK) ON P2.PARA2_CODE=A.PARA2_CODE
		WHERE B.CANCELLED=0 AND 
		B.PICK_LIST_DT BETWEEN @DFROMDATE AND @DTODATE
		AND (@PARTY_NO='' OR B.AC_CODE =@PARTY_NO)
		AND (@CARTICLE_NO='' OR ART.ARTICLE_CODE=@CARTICLE_NO)
		ORDER BY PICK_LIST_NO
   END
END
--END OF PROCEDURE - SP_WSL_BUYERORDER_PICKLIST_REPORTS
