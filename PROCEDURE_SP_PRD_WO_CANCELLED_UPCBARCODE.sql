CREATE PROCEDURE SP_PRD_WO_CANCELLED_UPCBARCODE
(
 @NQUERYID INT,
 @CWO_ID VARCHAR(50)='',
 @CPARA1_CODE VARCHAR(10)='',
 @CPARE2_CODE VARCHAR(10)='',
 @CMEMO_ID VARCHAR(50)=''
)
AS
BEGIN

IF @NQUERYID=1
GOTO LBL_UPCBARCODE

LBL_UPCBARCODE:
   
   
    SELECT CAST(0 AS BIT) AS CHK,
           CAST('LATER'  AS VARCHAR(22)) AS MEMO_ID,
           CAST('LATER'  AS VARCHAR(40)) AS REF_ROW_ID,
           A.PRODUCT_CODE ,GETDATE () AS LAST_UPDATE,
           A.QUANTITY_IN_STOCK AS QUANTITY ,
           CAST('LATER'+ CAST(NEWID() AS VARCHAR(40))  AS VARCHAR(40)) AS ROW_ID,
           WO.MEMO_NO AS WO_NO,WO.MEMO_DT AS WO_DT,
           P1.PARA1_NAME ,P2.PARA2_NAME ,
           WO.MEMO_ID  AS WO_ID
    FROM PRD_UPCPMT A
    JOIN PRD_WO_MST WO ON A.WO_ID =WO.MEMO_ID 
    JOIN ARTICLE ART ON ART.ARTICLE_CODE =WO.ARTICLE_SET_CODE 
    JOIN PARA1 P1 ON P1.PARA1_CODE =A.PARA1_CODE 
    JOIN PARA2 P2 ON P2.PARA2_CODE =A.PARA2_CODE 
    LEFT JOIN
    (
     SELECT A.PRODUCT_CODE  FROM PRD_AGENCY_ISSUE_MATERIAL_UPC A
     JOIN PRD_AGENCY_ISSUE_MATERIAL_MST B ON A.MEMO_ID =B.MEMO_ID 
     WHERE B.CANCELLED =0
    ) B ON A.PRODUCT_CODE =B.PRODUCT_CODE
    WHERE QUANTITY_IN_STOCK >0 AND B.PRODUCT_CODE IS NULL
    AND ISNULL(JOB_CODE ,'')=''
    AND A.WO_ID =@CWO_ID
    AND A.PARA1_CODE=@CPARA1_CODE 
    AND A.PARA2_CODE =@CPARE2_CODE 

GOTO END_PROC

END_PROC:
END
