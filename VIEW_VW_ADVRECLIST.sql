CREATE VIEW VW_ADVRECLIST

AS
SELECT (CASE WHEN A.ARC_TYPE=1 THEN 'RECEIPT' ELSE 'PAYMENT' END) AS [MEMO_TYPE],
(CASE WHEN A.ARCT=1 THEN 'OUTSTANDING' 
	  WHEN A.ARCT=2 THEN 'ADVANCE VOUCHERS'
	  ELSE 'OTHER CHARGES' END) AS [MODE],A.ADV_REC_NO AS MEMO_NO,A.ADV_REC_DT AS MEMO_DT,
CUST.USER_CUSTOMER_CODE AS CUSTOMER_ID,CUST.CUSTOMER_FNAME+' '+ CUSTOMER_LNAME AS CUSTOMER_NAME,
LM.AC_NAME AS AC_NAME,A.REF_NO,
LM.ADDRESS0 + ' ' + LM.ADDRESS1 + ' ' + LM.ADDRESS2 + ' ' + LM.AREA_NAME + ' ' + LM.CITY + ' ' +  
LM.STATE + ' ' + LM.MOBILE + ' ' AS AC_ADDRESS
,CASE WHEN A.PARTY_TYPE = 1 THEN 'CUSTOMER' ELSE 'LEDGER' END AS PARTY_TYPE,
A.REMARKS AS MST_REMARKS,A.AMOUNT AS GROSS_AMOUNT,A.DISCOUNT_AMOUNT AS DISCOUNT_AMOUNT,A.DISCOUNT_PERCENTAGE AS DISCOUNT_PERCENTAGE,A.NET_AMOUNT AS NET_AMOUNT,
C.USERNAME,(CASE WHEN  A.CANCELLED = 1 THEN 'CANCELLED' ELSE '' END) AS CANCELLED,A.FIN_YEAR,RIGHT(ISNULL(CMR.CM_ID,''),12) AS [AGAINST_BILL_NO],A.location_Code,
PAYDET.* 
FROM ARC01106 A
JOIN USERS C ON C.USER_CODE=A.USER_CODE
JOIN CUSTDYM CUST ON CUST.CUSTOMER_CODE=A.CUSTOMER_CODE
LEFT OUTER JOIN CMM_CREDIT_RECEIPT CMR ON CMR.ADV_REC_ID=A.ADV_REC_ID
LEFT OUTER JOIN LMV01106 LM ON LM.AC_CODE = A.AC_CODE
LEFT OUTER JOIN VW_PAYMODEXNDET PAYDET ON PAYDET.MEMO_ID=A.ADV_REC_ID AND PAYDET.XN_TYPE='ARC'
