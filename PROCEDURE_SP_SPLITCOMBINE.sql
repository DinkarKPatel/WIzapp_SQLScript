CREATE PROCEDURE SP_SPLITCOMBINE      
@NQUERYID NUMERIC(3,0),          
@CMEMO VARCHAR(50)='',  
@CFINYEAR VARCHAR(5) ,  
@CWHERE VARCHAR(5000)='',  
@NNAVMODE NUMERIC(1,0),
@CMODE VARCHAR(10)      
--WITH ENCRYPTION 
AS         
BEGIN          
    
IF @NQUERYID=1       
   GOTO LBLNAVIGATE     
ELSE IF @NQUERYID=2      
   GOTO LBLMASTER             
ELSE IF @NQUERYID=3      
   GOTO LBLSCCDETAIL  
ELSE IF @NQUERYID=4      
   GOTO LBLSCFDETAIL    
ELSE IF @NQUERYID=5      
  GOTO LBLPARA  
ELSE IF @NQUERYID=6      
  GOTO LBLARTICLELIST          
ELSE     
 GOTO LAST    
               
LBLNAVIGATE:  -- CREATING LOOK UP TABLE   

	DECLARE @CCMD NVARCHAR(MAX)
	SET @CCMD = ''
	PRINT @CWHERE
	PRINT CONVERT(VARCHAR,@CWHERE)
	SET @CCMD =N'EXEC SP_NAVIGATE ''SCM01106'','+
			CONVERT(VARCHAR,@NNAVMODE)+', '''+
			CONVERT(VARCHAR,@CMEMO)+''','''+
			CONVERT(VARCHAR,@CFINYEAR)+''',''MEMO_NO'',''MEMO_DT'',''MEMO_ID'','''+
			@CWHERE+'''' 
	PRINT @CCMD
	EXECUTE SP_EXECUTESQL @CCMD
	GOTO LAST                          
	                             
             
LBLMASTER:    

	SELECT A.*,B.USERNAME FROM SCM01106 A (NOLOCK)     
	JOIN USERS B (NOLOCK) ON A.USER_CODE= B.USER_CODE    
	WHERE A.MEMO_ID= @CMEMO AND A.MODE=@CMODE   
	    
	GOTO LAST  
                
LBLSCCDETAIL:      
            
	SELECT A.*,ARTICLE.ARTICLE_NO ,ARTICLE.ARTICLE_NAME,PARA1.PARA1_NAME,PARA2.PARA2_NAME,  
          PARA3.PARA3_NAME,PARA4.PARA4_NAME,PARA5.PARA5_NAME,PARA6.PARA6_NAME,UOM.UOM_NAME,   
          SECTIOND.SUB_SECTION_NAME ,SECTIONM.SECTION_NAME,  
          SECTIOND.SUB_SECTION_CODE ,SECTIONM.SECTION_CODE,SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME,
          CASE WHEN SKU.PURCHASE_PRICE<=0 THEN  ARTICLE.PURCHASE_PRICE ELSE SKU.PURCHASE_PRICE END AS PURCHASE_PRICE,
          CASE WHEN SKU.MRP<=0 THEN  ARTICLE.MRP ELSE SKU.MRP END AS MRP,
          SKU.WS_PRICE ,SKU.PRODUCT_CODE ,(A.AVG_QUANTITY*A.ADJ_QUANTITY) AS TOTALQTY,
          ISNULL(ARTICLE.DT_CREATED,'') AS [ART_DT_CREATED],ISNULL(PARA3.DT_CREATED,'') AS [PARA3_DT_CREATED],      
          ISNULL(SKU.DT_CREATED,'') AS [SKU_DT_CREATED],ARTICLE.ALIAS AS ARTICLE_ALIAS 
                       
	FROM SCC01106 A (NOLOCK)      
	JOIN SCM01106 B ON B.MEMO_ID= A.MEMO_ID   
	JOIN SKU ON A.PRODUCT_CODE = SKU.PRODUCT_CODE   
	JOIN ARTICLE  (NOLOCK) ON SKU.ARTICLE_CODE= ARTICLE.ARTICLE_CODE  
	JOIN SECTIOND  (NOLOCK) ON ARTICLE.SUB_SECTION_CODE= SECTIOND.SUB_SECTION_CODE     
	JOIN SECTIONM  (NOLOCK) ON SECTIOND.SECTION_CODE= SECTIONM.SECTION_CODE     
	JOIN PARA1  (NOLOCK) ON SKU.PARA1_CODE= PARA1.PARA1_CODE     
	JOIN PARA2  (NOLOCK) ON SKU.PARA2_CODE= PARA2.PARA2_CODE   
	JOIN PARA3  (NOLOCK) ON SKU.PARA3_CODE= PARA3.PARA3_CODE     
	JOIN PARA4  (NOLOCK) ON SKU.PARA4_CODE= PARA4.PARA4_CODE   
	JOIN PARA5  (NOLOCK) ON SKU.PARA5_CODE= PARA5.PARA5_CODE     
	JOIN PARA6  (NOLOCK) ON SKU.PARA6_CODE= PARA6.PARA6_CODE   
	JOIN UOM  (NOLOCK) ON ARTICLE.UOM_CODE= UOM.UOM_CODE                              
	WHERE A.MEMO_ID= @CMEMO  AND B.MODE=@CMODE   
	ORDER BY A.SRNO          
	GOTO LAST     
            
LBLSCFDETAIL:            
        
   SELECT A.*,ARTICLE.ARTICLE_NO ,ARTICLE.ARTICLE_NAME,PARA1.PARA1_NAME,PARA2.PARA2_NAME,  
          PARA3.PARA3_NAME,PARA4.PARA4_NAME,PARA5.PARA5_NAME,PARA6.PARA6_NAME,UOM.UOM_NAME,   
          SECTIOND.SUB_SECTION_NAME ,SECTIONM.SECTION_NAME,  
          SECTIOND.SUB_SECTION_CODE ,SECTIONM.SECTION_CODE,SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME,
          ARTICLE.PURCHASE_PRICE, ARTICLE.MRP, SKU.WS_PRICE ,SKU.PRODUCT_CODE,
          (A.QUANTITY*A.AVG_QUANTITY) AS CONSQTY ,
          ISNULL(ARTICLE.DT_CREATED,'') AS [ART_DT_CREATED],ISNULL(PARA3.DT_CREATED,'') AS [PARA3_DT_CREATED],      
          ISNULL(SKU.DT_CREATED,'') AS [SKU_DT_CREATED],ARTICLE.ALIAS AS ARTICLE_ALIAS 
                 
   FROM SCF01106 A (NOLOCK)     
   JOIN SCC01106 B ON A.MEMO_ID= B.MEMO_ID   
   JOIN SCM01106 C ON C.MEMO_ID= B.MEMO_ID   
   JOIN SKU ON A.PRODUCT_CODE = SKU.PRODUCT_CODE   
   JOIN ARTICLE  (NOLOCK) ON SKU.ARTICLE_CODE= ARTICLE.ARTICLE_CODE  
   JOIN SECTIOND  (NOLOCK) ON ARTICLE.SUB_SECTION_CODE= SECTIOND.SUB_SECTION_CODE     
   JOIN SECTIONM  (NOLOCK) ON SECTIOND.SECTION_CODE= SECTIONM.SECTION_CODE     
   JOIN PARA1  (NOLOCK) ON A.PARA1_CODE= PARA1.PARA1_CODE     
   JOIN PARA2  (NOLOCK) ON A.PARA2_CODE= PARA2.PARA2_CODE   
   JOIN PARA3  (NOLOCK) ON A.PARA3_CODE= PARA3.PARA3_CODE     
   JOIN PARA4  (NOLOCK) ON A.PARA4_CODE= PARA4.PARA4_CODE   
   JOIN PARA5  (NOLOCK) ON A.PARA5_CODE= PARA5.PARA5_CODE     
   JOIN PARA6  (NOLOCK) ON A.PARA6_CODE= PARA6.PARA6_CODE   
   JOIN UOM  (NOLOCK) ON ARTICLE.UOM_CODE= UOM.UOM_CODE                              
   WHERE A.MEMO_ID= @CMEMO AND C.MODE=@CMODE 
   ORDER BY A.SRNO
          
 GOTO LAST 
    
 LBLPARA:  
      
    SELECT PARA1_CODE, PARA1_NAME FROM PARA1 (NOLOCK) WHERE PARA1_NAME <> ''      
    SELECT PARA2_CODE, PARA2_NAME FROM PARA2 (NOLOCK) WHERE PARA2_NAME <> ''     
    SELECT PARA3_CODE, PARA3_NAME FROM PARA3 (NOLOCK) WHERE PARA3_NAME <> ''     
    SELECT PARA4_CODE, PARA4_NAME FROM PARA4 (NOLOCK) WHERE PARA4_NAME <> ''  
    SELECT PARA5_CODE, PARA5_NAME FROM PARA5 (NOLOCK) WHERE PARA5_NAME <> ''  
    SELECT PARA6_CODE, PARA6_NAME FROM PARA6 (NOLOCK) WHERE PARA6_NAME <> ''    
    
  GOTO LAST  
  
        
LBLARTICLELIST:  

   SELECT A.ARTICLE_CODE, A.ARTICLE_NAME, A.ARTICLE_NO,     
	B.SUB_SECTION_NAME, C.SECTION_NAME,'' AS PRODUCT_CODE,
	PARA1.PARA1_NAME,PARA2.PARA2_NAME,  
	PARA3.PARA3_NAME,PARA4.PARA4_NAME,PARA5.PARA5_NAME,PARA6.PARA6_NAME,
	PARA1.PARA1_CODE,PARA2.PARA2_CODE,  
	PARA3.PARA3_CODE,PARA4.PARA4_CODE,PARA5.PARA5_CODE,PARA6.PARA6_CODE,
	A.PURCHASE_PRICE,A.MRP,A.WHOLESALE_PRICE AS WS_PRICE,UOM.UOM_NAME,A.CODING_SCHEME,
	ISNULL(A.DT_CREATED,'') AS [ART_DT_CREATED],ISNULL(PARA3.DT_CREATED,'') AS [PARA3_DT_CREATED],      
    '' AS [SKU_DT_CREATED],A.ALIAS AS ARTICLE_ALIAS       
	FROM ARTICLE A     
	JOIN SECTIOND B ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE    
	JOIN SECTIONM C ON B.SECTION_CODE = C.SECTION_CODE
	JOIN PARA1  (NOLOCK) ON A.PARA1_CODE= PARA1.PARA1_CODE     
	JOIN PARA2  (NOLOCK) ON A.PARA2_CODE= PARA2.PARA2_CODE   
	JOIN PARA3  (NOLOCK) ON A.PARA3_CODE= PARA3.PARA3_CODE     
	JOIN PARA4  (NOLOCK) ON A.PARA4_CODE= PARA4.PARA4_CODE   
	JOIN PARA5  (NOLOCK) ON A.PARA5_CODE= PARA5.PARA5_CODE     
	JOIN PARA6  (NOLOCK) ON A.PARA6_CODE= PARA6.PARA6_CODE 
	JOIN UOM  (NOLOCK) ON A.UOM_CODE= UOM.UOM_CODE       
	WHERE A.ARTICLE_NO <> '' AND A.INACTIVE=0 AND A.CODING_SCHEME <> 1    

	UNION ALL  
	SELECT A.ARTICLE_CODE, A.ARTICLE_NAME, A1.PRODUCT_CODE AS [ARTICLE_NO],     
	B.SUB_SECTION_NAME, C.SECTION_NAME ,A1.PRODUCT_CODE ,
	PARA1.PARA1_NAME,PARA2.PARA2_NAME,  
	PARA3.PARA3_NAME,PARA4.PARA4_NAME,PARA5.PARA5_NAME,PARA6.PARA6_NAME,
	PARA1.PARA1_CODE,PARA2.PARA2_CODE,  
	PARA3.PARA3_CODE,PARA4.PARA4_CODE,PARA5.PARA5_CODE,PARA6.PARA6_CODE,
	A.PURCHASE_PRICE,A.MRP,A.WHOLESALE_PRICE AS WS_PRICE,UOM.UOM_NAME,A1.BARCODE_CODING_SCHEME AS CODING_SCHEME,
	ISNULL(A.DT_CREATED,'') AS [ART_DT_CREATED],ISNULL(PARA3.DT_CREATED,'') AS [PARA3_DT_CREATED],      
    ISNULL(A1.DT_CREATED,'') AS [SKU_DT_CREATED],A.ALIAS AS ARTICLE_ALIAS      
	FROM SKU A1     
	JOIN ARTICLE A   ON A.ARTICLE_CODE=A1.ARTICLE_CODE  
	JOIN SECTIOND B ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE    
	JOIN SECTIONM C ON B.SECTION_CODE = C.SECTION_CODE 
	JOIN PARA1  (NOLOCK) ON A1.PARA1_CODE= PARA1.PARA1_CODE     
	JOIN PARA2  (NOLOCK) ON A1.PARA2_CODE= PARA2.PARA2_CODE   
	JOIN PARA3  (NOLOCK) ON A1.PARA3_CODE= PARA3.PARA3_CODE     
	JOIN PARA4  (NOLOCK) ON A1.PARA4_CODE= PARA4.PARA4_CODE   
	JOIN PARA5  (NOLOCK) ON A1.PARA5_CODE= PARA5.PARA5_CODE     
	JOIN PARA6  (NOLOCK) ON A1.PARA6_CODE= PARA6.PARA6_CODE 
	JOIN UOM  (NOLOCK) ON A.UOM_CODE= UOM.UOM_CODE      
    LEFT OUTER JOIN EAN_SYNC EAN ON EAN.PRODUCT_CODE=A1.PRODUCT_CODE
    WHERE A.ARTICLE_NO <> '' AND A.INACTIVE=0 AND A1.BARCODE_CODING_SCHEME = 1    
	AND EAN.PRODUCT_CODE IS NULL

UNION ALL  
	
	SELECT A.ARTICLE_CODE, A.ARTICLE_NAME, A1.PRODUCT_CODE AS [ARTICLE_NO],     
	B.SUB_SECTION_NAME, C.SECTION_NAME ,A1.PRODUCT_CODE ,
	PARA1.PARA1_NAME,PARA2.PARA2_NAME,  
	PARA3.PARA3_NAME,PARA4.PARA4_NAME,PARA5.PARA5_NAME,PARA6.PARA6_NAME,
	PARA1.PARA1_CODE,PARA2.PARA2_CODE,  
	PARA3.PARA3_CODE,PARA4.PARA4_CODE,PARA5.PARA5_CODE,PARA6.PARA6_CODE,
	A.PURCHASE_PRICE,A.MRP,A.WHOLESALE_PRICE AS WS_PRICE,UOM.UOM_NAME,A1.BARCODE_CODING_SCHEME AS CODING_SCHEME,
	ISNULL(A.DT_CREATED,'') AS [ART_DT_CREATED],ISNULL(PARA3.DT_CREATED,'') AS [PARA3_DT_CREATED],      
    ISNULL(A1.DT_CREATED,'') AS [SKU_DT_CREATED],A.ALIAS AS ARTICLE_ALIAS     
	FROM SKU A1     
	JOIN ARTICLE A   ON A.ARTICLE_CODE=A1.ARTICLE_CODE  
	JOIN SECTIOND B ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE    
	JOIN SECTIONM C ON B.SECTION_CODE = C.SECTION_CODE 
	JOIN PARA1  (NOLOCK) ON A1.PARA1_CODE= PARA1.PARA1_CODE     
	JOIN PARA2  (NOLOCK) ON A1.PARA2_CODE= PARA2.PARA2_CODE   
	JOIN PARA3  (NOLOCK) ON A1.PARA3_CODE= PARA3.PARA3_CODE     
	JOIN PARA4  (NOLOCK) ON A1.PARA4_CODE= PARA4.PARA4_CODE   
	JOIN PARA5  (NOLOCK) ON A1.PARA5_CODE= PARA5.PARA5_CODE     
	JOIN PARA6  (NOLOCK) ON A1.PARA6_CODE= PARA6.PARA6_CODE 
	JOIN UOM  (NOLOCK) ON A.UOM_CODE= UOM.UOM_CODE      
    LEFT OUTER JOIN EAN_SYNC EAN ON EAN.PRODUCT_CODE=A1.PRODUCT_CODE
    WHERE A.ARTICLE_NO <> '' AND A.INACTIVE=0 AND A1.BARCODE_CODING_SCHEME <> 1    
	AND EAN.PRODUCT_CODE IS NULL

   GOTO LAST
    
     
LAST:
            
END
