CREATE PROCEDURE SP3S_DISAPPROVED_LEVEL  --(LocId 3 digit change only increased the parameter width by Sanjay:05-11-2024)
(  
  @CXNTYPE VARCHAR(10),  
  @CUSER_CODE CHAR(7)=''  ,
  @CDEPT_ID VARCHAR(4) 
)  
AS  
BEGIN  
    
    
  DECLARE @CLEVEL_NO INT 
  if @CDEPT_ID=''
  SELECT TOP 1 @CDEPT_ID=DEPT_ID FROM NEW_APP_LOGIN_INFO (nolock) WHERE SPID=@@SPID 

  SELECT TOP 1 @CLEVEL_NO=LEVEL_NO FROM XN_APPROVAL_CHECKLIST_LEVEL_USERS WHERE XN_TYPE =@CXNTYPE AND USER_CODE =@CUSER_CODE AND  DEPT_ID=@CDEPT_ID
   
  SELECT DISTINCT   B.LEVEL_DESC,B.LEVEL_NO FROM XN_APPROVAL_CHECKLIST_LEVEL_USERS A           
  JOIN XN_APPROVAL_CHECKLIST_LEVELS B ON  B.LEVEL_NO=A.LEVEL_NO AND B.XN_TYPE=A.XN_TYPE          
  WHERE  A.XN_TYPE=@CXNTYPE  AND B.LEVEL_NO< @CLEVEL_NO AND A.DEPT_ID=@CDEPT_ID  AND INACTIVE=0
   
   
END
