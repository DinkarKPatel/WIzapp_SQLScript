

DELETE FROM DYNAMIC_PRINT_COLS WHERE XN_TYPE='APR'

DECLARE  @dtLocal TABLE(XN_TYPE	varchar(10),COLUMN_NAME	nvarchar(MAX),DISPLAY_COLUMN_NAME	nvarchar(200),SELECTED	bit	,MODULE_NAME	varchar(100),GROUP_NAME VARCHAR(50))

INSERT INTO @DTLOCAL VALUES('APR','LEFT(SKU_NAMES.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX (''@'',SKU_NAMES.PRODUCT_CODE)-1,-1),LEN(SKU_NAMES.PRODUCT_CODE )))','PRODUCT_CODE',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ARTICLE_NAME','ARTICLE_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.UOM','UOM_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SUB_SECTION_NAME','SUB_SECTION_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SECTION_NAME','SECTION_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','APPROVAL_RETURN.QUANTITY*APPROVAL_RETURN.MRP','AMOUNT',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','APPROVAL_RETURN.MRP','RATE',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','APPROVAL_RETURN.MRP','MRP',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR1_KEY_NAME','ATTRIBUTE1_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR2_KEY_NAME','ATTRIBUTE2_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR3_KEY_NAME','ATTRIBUTE3_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR4_KEY_NAME','ATTRIBUTE4_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR5_KEY_NAME','ATTRIBUTE5_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR6_KEY_NAME','ATTRIBUTE6_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR7_KEY_NAME','ATTRIBUTE7_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR8_KEY_NAME','ATTRIBUTE8_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR9_KEY_NAME','ATTRIBUTE9_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR10_KEY_NAME','ATTRIBUTE10_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR11_KEY_NAME','ATTRIBUTE11_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR12_KEY_NAME','ATTRIBUTE12_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR13_KEY_NAME','ATTRIBUTE13_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR14_KEY_NAME','ATTRIBUTE14_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR15_KEY_NAME','ATTRIBUTE15_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR16_KEY_NAME','ATTRIBUTE16_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR17_KEY_NAME','ATTRIBUTE17_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR18_KEY_NAME','ATTRIBUTE18_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR19_KEY_NAME','ATTRIBUTE19_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR20_KEY_NAME','ATTRIBUTE20_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR21_KEY_NAME','ATTRIBUTE21_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR22_KEY_NAME','ATTRIBUTE22_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR23_KEY_NAME','ATTRIBUTE23_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR24_KEY_NAME','ATTRIBUTE24_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ATTR25_KEY_NAME','ATTRIBUTE25_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','APPROVAL_RETURN.QUANTITY','QUANTITY',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','APPROVAL_RETURN.DISCOUNT_PERCENTAGE','ITEM_DISCOUNT_PERCENTAGE',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','APPROVAL_RETURN.DISCOUNT_AMOUNT','ITEM_DISCOUNT_AMOUNT',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.PARA2_ORDER','PARA2_ORDER',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.PARA1_NAME','PARA1_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.PARA2_NAME','PARA2_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.PARA3_NAME','PARA3_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.PARA4_NAME','PARA4_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.PARA5_NAME','PARA5_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.PARA6_NAME','PARA6_NAME',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','SKU_NAMES.ARTICLE_NO','ARTICLE_NO',0,'APPROVAL_RETURN','APR_DETAILS')

INSERT INTO @DTLOCAL VALUES('APR','EMPLOYEE.EMP_NAME','SALEPERSON',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','EMPLOYEE.EMP_ALIAS','SALEPERSON_ALIAS',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','BIN.BIN_NAME','BIN_NAME',0,'APPROVAL_RETURN','APR_DETAILS')

INSERT INTO @DTLOCAL VALUES('APR','APR.CANCELLED','CANCELLED',0,'APPROVAL_RETURN','APR_MST')

INSERT INTO @dtLocal VALUES('APR','APR.memo_time','memo_time',0,'APPROVAL_RETURN','APR')
INSERT INTO @dtLocal VALUES('APR','APR.MEMO_DT','MEMO_DT',0,'APPROVAL_RETURN','APR')
INSERT INTO @dtLocal VALUES('APR','APR.MEMO_NO','MEMO_NO',0,'APPROVAL_RETURN','APR')

INSERT INTO @DTLOCAL VALUES('APR','USERS.USERNAME','USERNAME',0,'APPROVAL_RETURN','APR_MST')
INSERT INTO @DTLOCAL VALUES('APR','APR.REMARKS','BILL_LEVEL_REMARKS',0,'APPROVAL_RETURN','APR_MST')


INSERT INTO @DTLOCAL VALUES('APR','SL.DEPT_ID','SOURCE_LOCATION__ID',0,'APPROVAL_RETURN','SOURCE_LOCATION')
INSERT INTO @DTLOCAL VALUES('APR','SL.DEPT_NAME','SOURCE_LOCATION_NAME',0,'APPROVAL_RETURN','SOURCE_LOCATION')
INSERT INTO @DTLOCAL VALUES('APR','SL.ADDRESS1','SOURCE_LOCATION_ADDRESS1',0,'APPROVAL_RETURN','SOURCE_LOCATION')
INSERT INTO @DTLOCAL VALUES('APR','SL.ADDRESS2','SOURCE_LOCATION_ADDRESS2',0,'APPROVAL_RETURN','SOURCE_LOCATION')
INSERT INTO @DTLOCAL VALUES('APR','SL.REGISTERED_ADD','SOURCE_LOCATION_REGISTERED_ADDRESS',0,'APPROVAL_RETURN','SOURCE_LOCATION')
INSERT INTO @DTLOCAL VALUES('APR','SL.TIN_NO','SOURCE_LOCATION_TIN',0,'APPROVAL_RETURN','SOURCE_LOCATION')
INSERT INTO @DTLOCAL VALUES('APR','SL.LOC_GST_NO','SOURCE_LOCATION_GST_NO',0,'APPROVAL_RETURN','SOURCE_LOCATION')
INSERT INTO @DTLOCAL VALUES('APR','ISNULL(LEFT(SL.LOC_GST_NO,2),'''')','SOURCE_LOCATION_STATE_CODE',0,'APPROVAL_RETURN','SOURCE_LOCATION')
INSERT INTO @DTLOCAL VALUES('APR','SLA.AREA_NAME','SOURCE_LOCATION_AREA',0,'APPROVAL_RETURN','SOURCE_LOCATION')
INSERT INTO @DTLOCAL VALUES('APR','SLA.PINCODE','SOURCE_LOCATION_PIN',0,'APPROVAL_RETURN','SOURCE_LOCATION')
INSERT INTO @DTLOCAL VALUES('APR','SLC.CITY','SOURCE_LOCATION_CITY',0,'APPROVAL_RETURN','SOURCE_LOCATION')
INSERT INTO @DTLOCAL VALUES('APR','APRST.GST_STATE_NAME','SOURCE_LOCATION_STATE_NAME',0,'APPROVAL_RETURN','SOURCE_LOCATION')
INSERT INTO @DTLOCAL VALUES('APR','SLR.REGION_NAME','SOURCE_LOCATION_COUNTRY_NAME',0,'APPROVAL_RETURN','SOURCE_LOCATION')
INSERT INTO @DTLOCAL VALUES('APR','SL.PHONE','SOURCE_LOCATION_PHONE',0,'APPROVAL_RETURN','SOURCE_LOCATION')
INSERT INTO @DTLOCAL VALUES('APR','SL.CONTACT_NO','SOURCE_LOCATION_CONTACT_NO',0,'APPROVAL_RETURN','SOURCE_LOCATION')

INSERT INTO @DTLOCAL VALUES('APR','CMP.COMPANY_NAME','COMPANY_NAME',0,'APPROVAL_RETURN','COMPANY')
INSERT INTO @DTLOCAL VALUES('APR','CMP.ADDRESS1','COMPANY_ADDRESS1',0,'APPROVAL_RETURN','COMPANY')
INSERT INTO @DTLOCAL VALUES('APR','CMP.ADDRESS2','COMPANY_ADDRESS2',0,'APPROVAL_RETURN','COMPANY')
INSERT INTO @DTLOCAL VALUES('APR','CMP.CITY','COMPANY_CITY',0,'APPROVAL_RETURN','COMPANY')
INSERT INTO @DTLOCAL VALUES('APR','CMP.[STATE]','COMPANY_STATE',0,'APPROVAL_RETURN','COMPANY')
INSERT INTO @DTLOCAL VALUES('APR','CMP.COUNTRY','COMPANY_COUNTRY',0,'APPROVAL_RETURN','COMPANY')
INSERT INTO @DTLOCAL VALUES('APR','CMP.GST_NO','COMPANY_GST_NO',0,'APPROVAL_RETURN','COMPANY')
INSERT INTO @DTLOCAL VALUES('APR','CMP.CIN','COMPANY_CIN',0,'APPROVAL_RETURN','COMPANY')
INSERT INTO @DTLOCAL VALUES('APR','CMP.PAN_NO','COMPANY_PAN_NO',0,'APPROVAL_RETURN','COMPANY')
INSERT INTO @DTLOCAL VALUES('APR','CMP.PIN','COMPANY_PIN',0,'APPROVAL_RETURN','COMPANY')
INSERT INTO @DTLOCAL VALUES('APR','CMP.EMAIL_ID','COMPANY_EMAIL_ID',0,'APPROVAL_RETURN','COMPANY')
INSERT INTO @DTLOCAL VALUES('APR','CMP.WEB_ADDRESS','COMPANY_WEBSITE',0,'APPROVAL_RETURN','COMPANY')
INSERT INTO @DTLOCAL VALUES('APR','IMG.PROD_IMAGE','PROD_IMAGE',0,'APPROVAL_RETURN','APR_DETAILS')


--FOR TAX INVOICE BEFORE GST
INSERT INTO @DTLOCAL VALUES('APR','APPROVAL_RETURN.remarks','ITEM_REMARKS',0,'APPROVAL_RETURN','APR_DETAILS')
INSERT INTO @DTLOCAL VALUES('APR','APPROVAL_RETURN.rfnet','rfnet',0,'APPROVAL_RETURN','APR_DETAILS')


INSERT INTO @DTLOCAL VALUES('APR','CUST.cus_gst_state_code','PARTY_STATE_CODE',0,'APPROVAL_RETURN','CUSTOMER')
INSERT INTO @DTLOCAL VALUES('APR','CUSTST.GST_STATE_NAME','PARTY_STATE_NAME',0,'APPROVAL_RETURN','CUSTOMER')
INSERT INTO @DTLOCAL VALUES('APR','CUST.CUSTOMER_TITLE','PARTY_TITLE',0,'APPROVAL_RETURN','CUSTOMER')
INSERT INTO @DTLOCAL VALUES('APR','CUST.CUSTOMER_FNAME','PARTY_FNAME',0,'APPROVAL_RETURN','CUSTOMER')
INSERT INTO @DTLOCAL VALUES('APR','CUST.CUSTOMER_LNAME','PARTY_LNAME',0,'APPROVAL_RETURN','CUSTOMER')
INSERT INTO @DTLOCAL VALUES('APR','CUST.ADDRESS0','PARTY_ADDRESS',0,'APPROVAL_RETURN','CUSTOMER')
INSERT INTO @DTLOCAL VALUES('APR','CUST.ADDRESS1','PARTY_ADDRESS1',0,'APPROVAL_RETURN','CUSTOMER')
INSERT INTO @DTLOCAL VALUES('APR','CUST.ADDRESS2','PARTY_ADDRESS2',0,'APPROVAL_RETURN','CUSTOMER')
INSERT INTO @DTLOCAL VALUES('APR','CUST.ADDRESS9','PARTY_ADDRESS9',0,'APPROVAL_RETURN','CUSTOMER')
INSERT INTO @DTLOCAL VALUES('APR','CUST.CUS_GST_NO','PARTY_GST_NO',0,'APPROVAL_RETURN','CUSTOMER')
INSERT INTO @DTLOCAL VALUES('APR','CUST.MOBILE','MOBILE',0,'APPROVAL_RETURN','CUSTOMER')
INSERT INTO @DTLOCAL VALUES('APR','CUST.EMAIL','PARTY_EMAIL',0,'APPROVAL_RETURN','CUSTOMER')
INSERT INTO @DTLOCAL VALUES('APR','CUSTCT.CITY','PARTY_CITY',0,'APPROVAL_RETURN','CUSTOMER')
INSERT INTO @DTLOCAL VALUES('APR','SL.DEPT_PRINT_NAME','LOCATION_PRINT_NAME',0,'APPROVAL_RETURN','SOURCE_LOCATION')



UPDATE B SET SELECTED=A.SELECTED FROM   DYNAMIC_PRINT_COLS A
JOIN @DTLOCAL B ON A.DISPLAY_COLUMN_NAME=B.DISPLAY_COLUMN_NAME and a.MODULE_NAME =b.MODULE_NAME 
WHERE  A.SELECTED<>B.SELECTED
AND A.SELECTED=1


DELETE a
FROM DYNAMIC_PRINT_COLS a
LEFT OUTER JOIN @dtLocal b ON b.COLUMN_NAME=a.COLUMN_NAME 
WHERE b.COLUMN_NAME IS NULL AND a.MODULE_NAME= 'APPROVAL_RETURN'

INSERT INTO DYNAMIC_PRINT_COLS(XN_TYPE,COLUMN_NAME,DISPLAY_COLUMN_NAME,SELECTED,MODULE_NAME,GROUP_NAME)
SELECT a.XN_TYPE,a.COLUMN_NAME,a.DISPLAY_COLUMN_NAME,a.SELECTED,a.MODULE_NAME,A.GROUP_NAME 
FROM @dtLocal a
LEFT OUTER JOIN DYNAMIC_PRINT_COLS b (NOLOCK) ON b.COLUMN_NAME=a.COLUMN_NAME AND b.XN_TYPE ='APR'
WHERE b.COLUMN_NAME IS NULL  

--REMOVE DUPLICATE RECORDS
;WITH CTE AS
(
SELECT * ,SR=ROW_NUMBER () OVER (PARTITION BY XN_TYPE,COLUMN_NAME ,DISPLAY_COLUMN_NAME
ORDER BY  XN_TYPE,COLUMN_NAME ,DISPLAY_COLUMN_NAME,SELECTED)
FROM  DYNAMIC_PRINT_COLS	
 WHERE LTRIM(RTRIM(XN_TYPE))='APR'
)

DELETE  FROM CTE WHERE SR>1
