CREATE VIEW VW_SALSHEET 
--WITH ENCRYPTION
AS 
SELECT 
PSM.PAYSLIP_ID,
PSM.EMP_ID,
PSM.PAYSLIP_MONTH,
PSM.PAYSLIP_YEAR,
PSM.BASIC_SALARY,
PSM.EARNINGS,
PSM.DEDUCTIONS,
PSM.LOAN_ADJ,
PSM.ARREAR_AMT,
EM.REF_ID,
EM.EMP_FNAME + ' ' + EM.EMP_LNAME AS EMPNAME, 
PSD.PAY_ID, 
EPAY.PAY_NAME,
ROUND(PSD.AMOUNT,0) AS AMOUNT,
PSD.PAY_TYPE,
CASE WHEN PSD.PAY_TYPE = 2 THEN 'ADDITION' ELSE 'DEDUCTION' END AS PTNAME,
DEPT.DEPARTMENT_ID,
DEPT.DEPARTMENT_NAME,
LOC.DEPT_ID,
LOC.DEPT_NAME,
LOC.DEPT_ALIAS,
EPAY.PAY_ORDER,
PSM.SALARY_DAYS AS WORK_DAYS,
EM.MODE_OF_PAYMENT, 
EM.EMP_STATUS, 
EM.CO_ALIAS,
EM.BANK_ACC_NO,
EPAY.DONOT_DEDUCT_IN_GROSS_SALARY
FROM EMP_PAYSLIP_MST PSM                    
INNER JOIN EMP_PAYSLIP_DET PSD ON PSM.PAYSLIP_ID=PSD.PAYSLIP_ID                    
LEFT OUTER JOIN EMP_PAY EPAY ON EPAY.PAY_ID=PSD.PAY_ID            
INNER JOIN EMP_MST EM ON EM.EMP_ID=PSM.EMP_ID                       
INNER JOIN EMP_DEPARTMENT DEPT ON EM.DEPARTMENT_ID=DEPT.DEPARTMENT_ID        
INNER JOIN LOCATION LOC ON EM.DEPT_ID=LOC.DEPT_ID        
WHERE EPAY.PAY_ID<>'0000000'          
AND PSM.CANCELLED<>1  

UNION ALL
SELECT 
'' AS PAYSLIP_ID,
A.EMP_ID,
PSM.PAYSLIP_MONTH,
PSM.PAYSLIP_YEAR,
EM.BASIC_SALARY,
PSM.EARNINGS,
PSM.DEDUCTIONS,
PSM.LOAN_ADJ,
PSM.ARREAR_AMT,
EM.REF_ID,
EM.EMP_FNAME + ' ' + EM.EMP_LNAME AS EMPNAME, 
EPAY.PAY_ID, 
EPAY.PAY_NAME,
A .AMOUNT,
EPAY.PAY_TYPE,
CASE WHEN EPAY.PAY_TYPE = 2 THEN 'ADDITION' ELSE 'DEDUCTION' END AS PTNAME,
DEPT.DEPARTMENT_ID,
DEPT.DEPARTMENT_NAME,
LOC.DEPT_ID,
LOC.DEPT_NAME,
LOC.DEPT_ALIAS,
EPAY.PAY_ORDER,
0 AS WORK_DAYS,
EM.MODE_OF_PAYMENT, 
EM.EMP_STATUS, 
EM.CO_ALIAS,
EM.BANK_ACC_NO,
EPAY.DONOT_DEDUCT_IN_GROSS_SALARY
FROM EMP_SALARY_PROFILE A  
JOIN EMP_PAY EPAY ON A.PAY_ID = EPAY.PAY_ID         
INNER JOIN EMP_MST EM ON EM.EMP_ID=A.EMP_ID                       
INNER JOIN EMP_DEPARTMENT DEPT ON EM.DEPARTMENT_ID=DEPT.DEPARTMENT_ID        
INNER JOIN LOCATION LOC ON EM.DEPT_ID=LOC.DEPT_ID   
JOIN  EMP_PAYSLIP_MST PSM  ON A.EMP_ID = PSM.EMP_ID      
WHERE EPAY.PAY_ID<>'0000000'          
AND PSM.CANCELLED<>1
