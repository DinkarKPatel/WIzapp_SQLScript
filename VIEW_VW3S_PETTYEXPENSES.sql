CREATE VIEW VW3S_PETTYEXPENSES
AS
(
	SELECT PEM.location_code/*LEFT(PEM.PEM_MEMO_ID,2)*//*Rohit 05-11-2024*/ AS DEPT_ID,LM.AC_NAME,PEM.PEM_MEMO_DT AS MEMO_DT
		  ,DATENAME(MONTH,PEM.PEM_MEMO_DT) AS MEMO_MONTH
		  ,SUM(CASE WHEN PED.XN_TYPE='DR' THEN XN_AMOUNT ELSE 0 END) AS DR_AMOUNT
		  ,SUM(CASE WHEN PED.XN_TYPE='CR' THEN XN_AMOUNT ELSE 0 END) AS CR_AMOUNT
		  ,SUM(CASE WHEN PED.XN_TYPE='DR' THEN XN_AMOUNT ELSE -XN_AMOUNT END) AS EXPENSE
	FROM PEM01106 PEM(NOLOCK)
	JOIN PED01106 PED(NOLOCK) ON PEM.PEM_MEMO_ID=PED.PEM_MEMO_ID
	JOIN LM01106 LM(NOLOCK) ON PED.AC_CODE=LM.AC_CODE
	WHERE PEM.CANCELLED=0
	GROUP BY PEM.location_code/*LEFT(PEM.PEM_MEMO_ID,2)*//*Rohit 05-11-2024*/,LM.AC_NAME,PEM.PEM_MEMO_DT
)
--END OF VIEW - VW3S_PETTYEXPENSES
