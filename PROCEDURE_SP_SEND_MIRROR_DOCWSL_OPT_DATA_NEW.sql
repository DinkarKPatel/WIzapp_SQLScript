create PROCEDURE SP_SEND_MIRROR_DOCWSL_OPT_DATA_NEW  --(LocId 3 digit change by Sanjay:06-11-2024)
  @CREQXNID VARCHAR(50)  
 ,@CTARGETLOCID VARCHAR(5)  
 ,@CREQCHALLANNO VARCHAR(35)=''  
 ,@CREQCHALLANFINYEAR VARCHAR(20)=''  
 ,@BACKNOWLEDGE BIT=0  
 ,@BSENDNEWATTRIBUTE BIT=0  
 ,@CERRMSG VARCHAR(1000) OUTPUT  
AS  
/*  
  
 SP_SEND_MIRROR_DOCWSL_DATA : THIS PROCEDURE USE TO SEND DOCWSL DATA  
*/  
BEGIN  
 DECLARE @DTSQL NVARCHAR(MAX),@CTEMPTABLE VARCHAR(500),@CMEMOID VARCHAR(50),@bCancelledChallan BIT,  
 @CTEMPEMPLOYEETABLE VARCHAR(200),@DMEMOLASTUPDATE DATETIME,@CTABLENAME VARCHAR(100),  
 @BRECFOUND BIT,@CSTEP VARCHAR(5),@CFILTERCONDITION VARCHAR(MAX),@CCUTOFFDATE VARCHAR(20),  
 @CTEMPMASTERTABLE VARCHAR(200),@CTEMPDETAILTABLE VARCHAR(200),@CTEMPLMTABLE VARCHAR(200),  
 @CTEMPLMPTABLE VARCHAR(200),@CTEMPAREATABLE VARCHAR(200),@CTEMPCITYTABLE VARCHAR(200),  
 @CTEMPPMODEXNTABLE VARCHAR(200),@CTEMPPMODETABLE VARCHAR(200),@CSTNAPPROVAL BIT,  
 @CCLOCID VARCHAR(10),@BSENDPURINFOLOC BIT, 
 @CTEMPSKUTABLE VARCHAR(500),@CTEMPSKUOHTABLE VARCHAR(500),  
 @NTARGETLOCTYPE INT,@BTARGETPURLOC BIT,@CTEMPSLSBCTABLE VARCHAR(500),@CTEMPSLSDETTABLE VARCHAR(500),   
 @CTEMPTABLEDB VARCHAR(100),@BGETCHALLANTHRUMIRROR BIT,@CPARTYDEPTID VARCHAR(5),@NMODE INT,  
 @BEXPORTED BIT,@CDISPATCHDETAILS VARCHAR(500),@CDONOTSENDCHALLANWODISPATCHDETAILS VARCHAR(2),  
 @CJOINSTR VARCHAR(1000),@BTEMPDATADELETED BIT,@NSPID INT,@BDONOTSENDCHALLANWITHOUTDISPATCH BIT  
   
 SET @NSPID = @@SPID  
  
   
  
   
LBLSTART:  
   
 PRINT 'ENTER SP_SEND_MIRROR_DOCWSL_OPT_DATA_NEW'  
     
 DECLARE @TXNSSENDINFO TABLE (ORG_TABLENAME VARCHAR(500),TMP_TABLENAME VARCHAR(500),XN_ID VARCHAR(40))    
  
 SET @CTEMPTABLEDB =''  
  
BEGIN TRY    
     
 SET @CSTEP=10   
 SET @CFILTERCONDITION=''  
   
   
 IF @BACKNOWLEDGE=1  
  GOTO LBLTABLEINFO  
   
 SET @CSTEP=20  
   
 SELECT TOP 1 @BSENDPURINFOLOC=UPD_PURINFO,@NTARGETLOCTYPE=LOC_TYPE,@BTARGETPURLOC=PUR_LOC  
 FROM LOCATION (NOLOCK) WHERE DEPT_ID=@CTARGETLOCID  
    
 IF @BTARGETPURLOC=1 AND @NTARGETLOCTYPE=1  
  SET @BSENDPURINFOLOC=1  
   
 IF  @NTARGETLOCTYPE=2  
  SET @BSENDPURINFOLOC=0  
   
 SET @CSTEP=25  
     
 SET @CFILTERCONDITION=' PARTY_DEPT_ID = '''+@CTARGETLOCID+''' AND INV_MODE = 2 '  
   
   
 IF @CREQCHALLANNO=''  
 BEGIN  
  SELECT @CREQCHALLANNO=INV_NO,@CREQCHALLANFINYEAR=FIN_YEAR,@bCancelledChallan=cancelled FROM INM01106 WHERE INV_ID=@CREQXNID  
  IF ISNULL(@CREQCHALLANNO,'')=''  
  BEGIN  
   SET @CERRMSG = 'CHALLAN ID:'+@CREQXNID+' NOT FOUND AT HEAD OFFICE '  
   GOTO END_PROC  
  END   
 END   
   
 IF @CREQCHALLANNO<>''  
 BEGIN  
  SET @DTSQL=N'SELECT TOP 1 @CMEMOID=A.INV_ID,@DMEMOLASTUPDATE=A.LAST_UPDATE  
      FROM INM01106 A (NOLOCK)   
      WHERE A.INV_NO='''+@CREQCHALLANNO+''' AND A.FIN_YEAR='''+@CREQCHALLANFINYEAR+''''  
  PRINT @DTSQL  
  EXEC SP_EXECUTESQL @DTSQL,N'@CMEMOID VARCHAR(50) OUTPUT,@DMEMOLASTUPDATE DATETIME OUTPUT',  
  @CMEMOID OUTPUT,@DMEMOLASTUPDATE OUTPUT  
  
    
  IF ISNULL(@CMEMOID,'')=''  
  BEGIN  
   SET @CERRMSG = 'CHALLAN NO. :'+@CREQCHALLANNO+' NOT FOUND AT HEAD OFFICE FOR FINANCIAL YEAR :'+@CREQCHALLANFINYEAR  
   GOTO END_PROC  
  END  
    
  SELECT @CPARTYDEPTID=PARTY_DEPT_ID,@NMODE=INV_MODE,@BEXPORTED=EXPORTED,  
      @CDISPATCHDETAILS=THROUGH  
  FROM INM01106 (NOLOCK) WHERE INV_ID=@CMEMOID  
    
  IF @NMODE<>2  
  BEGIN  
   SET @CERRMSG = 'MEMO NO. :'+@CREQCHALLANNO+' IS NOT A GROUP TRANSFER CHALLAN'  
   GOTO END_PROC  
  END  
    
  IF @CPARTYDEPTID<>@CTARGETLOCID  
  BEGIN  
   SET @CERRMSG = 'CHALLAN NO. :'+@CREQCHALLANNO+' IS NOT CREATED FOR TARGET LOCATION :'+@CTARGETLOCID  
   GOTO END_PROC  
  END  
    
        
  SELECT @BDONOTSENDCHALLANWITHOUTDISPATCH=ISNULL(DONOTSENDCHALLANWITHOUTDISPATCH,0) FROM LOCATION WHERE DEPT_ID=@CTARGETLOCID   
  
     
     SET @CREQXNID=@CMEMOID  
  IF NOT EXISTS (SELECT TOP 1 * FROM PARCEL_DET WHERE REF_MEMO_ID=@CREQXNID) AND @BDONOTSENDCHALLANWITHOUTDISPATCH=1  
  AND ISNULL(@bCancelledChallan,0)=0  
  BEGIN  
    SET @CERRMSG = 'CHALLAN NO. :'+@CREQCHALLANNO+' IS NOT HAVING ANY DISPATCH DETAILS'  
    GOTO END_PROC  
  END  
  
    
           
   
       
 END   
  
 SET @CSTEP=40  
 ---- IF NO MEMO FOUND , JUST END THE PROCESS  
  
LBLTABLEINFO:  
   
 SET @CMEMOID = @CREQXNID  
  
  
 IF @BACKNOWLEDGE=1  
  GOTO END_PROC  
    
 SET @CSTEP=50  
 ---- POPULATE LIST OF TABLES   
    
 PRINT 'SEND CHALLAN DIRECTLY OPT-2'  
   
 SET @CFILTERCONDITION=' B.INV_ID='''+@CMEMOID+''''  
   
 ---- SEND THE WHOLESALE MEMO MASTER TABLE  
   
 SELECT  @CMEMOID AS XN_ID,'DOCWSL_INM01106_MIRROR' AS TARGET_TABLENAME,* FROM INM01106 (NOLOCK) WHERE INV_ID=@CMEMOID  
   
 SELECT  'DOCWSL_IND01106_MIRROR' AS TARGET_TABLENAME,* FROM IND01106 (NOLOCK) WHERE INV_ID=@CMEMOID    
  
 SELECT B.BOX_ID,a.inv_id    
 INTO #TMPBOXID  
 FROM IND01106 A (NOLOCK)   
 JOIN BOXD B (NOLOCK) ON LEFT(A.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',A.PRODUCT_CODE)-1,-1),LEN(A.PRODUCT_CODE )))=B.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID and isnull(A.box_id,'') =''   
 GROUP BY B.BOX_ID,a.inv_id   
    
   
 --20 JAN 2018 BOXM  
 SELECT DISTINCT 'DOCWSL_BOXM_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.*    
 FROM BOXM A (NOLOCK)  
 JOIN   
 ( SELECT BOX_ID,INV_ID FROM IND01106 (NOLOCK)  
   WHERE INV_ID=@CMEMOID   
   GROUP BY BOX_ID,INV_ID  
   UNION ALL   
   SELECT box_id,inv_id from #TMPBOXID  
 ) B ON A.BOX_ID =B.BOX_ID   
 WHERE B.INV_ID =@CMEMOID  
   
  
   
 --20 JAN 2018 BOXD  
 SELECT DISTINCT 'DOCWSL_BOXD_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.*   
 FROM BOXD A (NOLOCK)  
 JOIN   
 ( SELECT BOX_ID,INV_ID  FROM IND01106 (NOLOCK)  
   WHERE INV_ID=@CMEMOID   
   GROUP BY BOX_ID,INV_ID  
   UNION ALL   
   SELECT box_id,inv_id from #TMPBOXID  
 ) B ON A.BOX_ID =B.BOX_ID   
 WHERE B.INV_ID =@CMEMOID  
   
   
 declare @nbatchcode int  
 set @nbatchcode=0  
 IF EXISTS (SELECT TOP 1 PRODUCT_CODE FROM IND01106 (NOLOCK) WHERE INV_ID=@CMEMOID AND PRODUCT_CODE LIKE '%@%')  
 begin   
  SELECT   'DOCWSL_SKU_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM SKU A (NOLOCK)  
  JOIN IND01106 B (NOLOCK) ON A.PRODUCT_CODE=B.PRODUCT_CODE WHERE INV_ID=@CMEMOID       
  UNION  
  SELECT   'DOCWSL_SKU_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM SKU A (NOLOCK)  
  JOIN IND01106 B (NOLOCK) ON   
  A.PRODUCT_CODE=LEFT(B.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',B.PRODUCT_CODE)-1,-1),LEN(B.PRODUCT_CODE )))  
  --SUBSTRING(B.PRODUCT_CODE,1,CHARINDEX('@',B.PRODUCT_CODE)-1)  
  WHERE INV_ID=@CMEMOID and b.PRODUCT_CODE LIKE '%@%'  
  set @nbatchcode=1  
 end      
 ELSE  
  SELECT  DISTINCT 'DOCWSL_SKU_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM SKU A (NOLOCK)  
  JOIN IND01106 B (NOLOCK) ON A.PRODUCT_CODE=B.PRODUCT_CODE WHERE INV_ID=@CMEMOID       
       
       
   
  
  
 SELECT   'DOCWSL_HSN_MST_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM HSN_MST A(NOLOCK)  
 JOIN SKU B (NOLOCK) ON A.HSN_CODE=B.HSN_CODE  
 JOIN IND01106 C (NOLOCK) ON C.PRODUCT_CODE=B.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID       
 UNION  
 SELECT   'DOCWSL_HSN_MST_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM HSN_MST A(NOLOCK)  
 JOIN IND01106 B (NOLOCK) ON A.HSN_CODE=B.HSN_CODE  
 WHERE INV_ID=@CMEMOID  
 UNION  
 SELECT   'DOCWSL_HSN_MST_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM HSN_MST A (NOLOCK)  
 JOIN ARTICLE C (NOLOCK) ON C.HSN_CODE=A.HSN_CODE  
 JOIN SECTIOND B (NOLOCK) ON B.SUB_SECTION_CODE=C.SUB_SECTION_CODE  
 JOIN SKU D (NOLOCK) ON D.ARTICLE_CODE=C.ARTICLE_CODE  
 JOIN IND01106 E (NOLOCK) ON E.PRODUCT_CODE=D.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  
 --changes  
 union  
        
 SELECT   'DOCWSL_HSN_MST_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM HSN_MST A(NOLOCK)  
 JOIN SKU B (NOLOCK) ON A.HSN_CODE=B.HSN_CODE  
 JOIN IND01106 C (NOLOCK) ON LEFT(c.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',c.PRODUCT_CODE)-1,-1),LEN(c.PRODUCT_CODE )))=B.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID  AND @nbatchcode=1  and  C.PRODUCT_CODE LIKE '%@%'      
   
 UNION  
 SELECT   'DOCWSL_HSN_MST_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM HSN_MST A (NOLOCK)  
 JOIN ARTICLE C (NOLOCK) ON C.HSN_CODE=A.HSN_CODE  
 --JOIN SECTIOND B (NOLOCK) ON B.SUB_SECTION_CODE=C.SUB_SECTION_CODE  
 JOIN SKU D (NOLOCK) ON D.ARTICLE_CODE=C.ARTICLE_CODE  
 JOIN IND01106 E (NOLOCK) ON LEFT(e.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',e.PRODUCT_CODE)-1,-1),LEN(e.PRODUCT_CODE )))=D.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  AND @nbatchcode=1 and  E.PRODUCT_CODE LIKE '%@%'   
   
 --end  
   
 SELECT   'DOCWSL_HSN_DET_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.*   
 FROM HSN_DET A(NOLOCK)  
 JOIN SKU B (NOLOCK) ON A.HSN_CODE=B.HSN_CODE  
 JOIN IND01106 C (NOLOCK) ON C.PRODUCT_CODE=B.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID       
 UNION  
 SELECT   'DOCWSL_HSN_DET_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM HSN_DET A(NOLOCK)  
 JOIN IND01106 B (NOLOCK) ON A.HSN_CODE=B.HSN_CODE  
 WHERE INV_ID=@CMEMOID  
 UNION  
 SELECT   'DOCWSL_HSN_DET_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM HSN_DET A (NOLOCK)  
 JOIN ARTICLE C (NOLOCK) ON C.HSN_CODE=A.HSN_CODE  
 JOIN SECTIOND B (NOLOCK) ON B.SUB_SECTION_CODE=C.SUB_SECTION_CODE  
 JOIN SKU D (NOLOCK) ON D.ARTICLE_CODE=C.ARTICLE_CODE  
 JOIN IND01106 E (NOLOCK) ON E.PRODUCT_CODE=D.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  
   
 UNION  
 --CHANGES  
 SELECT   'DOCWSL_HSN_DET_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.*   
 FROM HSN_DET A(NOLOCK)  
 JOIN SKU B (NOLOCK) ON A.HSN_CODE=B.HSN_CODE  
 JOIN IND01106 C (NOLOCK) ON LEFT(c.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',c.PRODUCT_CODE)-1,-1),LEN(c.PRODUCT_CODE )))=B.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID AND @nbatchcode=1  and C.PRODUCT_CODE LIKE '%@%'   
 UNION  
 SELECT   'DOCWSL_HSN_DET_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM HSN_DET A (NOLOCK)  
 JOIN ARTICLE C (NOLOCK) ON C.HSN_CODE=A.HSN_CODE  
 JOIN SECTIOND B (NOLOCK) ON B.SUB_SECTION_CODE=C.SUB_SECTION_CODE  
 JOIN SKU D (NOLOCK) ON D.ARTICLE_CODE=C.ARTICLE_CODE  
 JOIN IND01106 E (NOLOCK) ON LEFT(e.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',e.PRODUCT_CODE)-1,-1),LEN(e.PRODUCT_CODE )))=D.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  AND @nbatchcode=1 and  E.PRODUCT_CODE LIKE '%@%'  
 --END  
     
 SELECT   'DOCWSL_LM01106_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM LM01106 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON A.AC_CODE=B.AC_CODE  
 JOIN IND01106 C (NOLOCK) ON C.PRODUCT_CODE=B.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID   
 UNION   
 SELECT   'DOCWSL_LM01106_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM LM01106 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON A.AC_CODE=B.AC_CODE  
 JOIN IND01106 C (NOLOCK) ON LEFT(c.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',c.PRODUCT_CODE)-1,-1),LEN(c.PRODUCT_CODE )))=B.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID  AND @nbatchcode=1 and C.PRODUCT_CODE LIKE '%@%'      
  
 SELECT   'DOCWSL_LMP01106_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM LMP01106 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON A.AC_CODE=B.AC_CODE  
 JOIN IND01106 C (NOLOCK) ON C.PRODUCT_CODE=B.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  
 UNION   
 SELECT   'DOCWSL_LMP01106_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM LMP01106 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON A.AC_CODE=B.AC_CODE  
 JOIN IND01106 C (NOLOCK) ON LEFT(c.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',c.PRODUCT_CODE)-1,-1),LEN(c.PRODUCT_CODE )))=B.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID AND @nbatchcode=1 and C.PRODUCT_CODE LIKE '%@%'     
   
 SELECT  DISTINCT 'DOCWSL_HD01106_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM HD01106 A (NOLOCK)  
 JOIN LM01106 B (NOLOCK) ON A.HEAD_CODE=B.HEAD_CODE  
 JOIN SKU C (NOLOCK) ON C.AC_CODE=B.AC_CODE  
 JOIN IND01106 D (NOLOCK) ON D.PRODUCT_CODE=C.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID       
   
 SELECT   'DOCWSL_AREA_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM AREA A (NOLOCK)  
 JOIN LMP01106 B (NOLOCK) ON B.AREA_CODE=A.AREA_CODE  
 JOIN SKU C (NOLOCK) ON C.AC_CODE=B.AC_CODE  
 JOIN IND01106 D (NOLOCK) ON D.PRODUCT_CODE=C.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID      
 UNION  
 SELECT   'DOCWSL_AREA_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM AREA A (NOLOCK)  
 JOIN LMP01106 B (NOLOCK) ON B.AREA_CODE=A.AREA_CODE  
 JOIN SKU C (NOLOCK) ON C.AC_CODE=B.AC_CODE  
 JOIN IND01106 d (NOLOCK) ON LEFT(d.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',d.PRODUCT_CODE)-1,-1),LEN(d.PRODUCT_CODE )))=c.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID AND @nbatchcode=1 and D.PRODUCT_CODE LIKE '%@%'     
   
  
 SELECT   'DOCWSL_CITY_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM CITY A (NOLOCK)  
 JOIN AREA B (NOLOCK) ON A.CITY_CODE=B.CITY_CODE  
 JOIN LMP01106 C (NOLOCK) ON C.AREA_CODE=B.AREA_CODE  
 JOIN SKU D (NOLOCK) ON D.AC_CODE=C.AC_CODE  
 JOIN IND01106 E (NOLOCK) ON E.PRODUCT_CODE=D.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID       
 UNION  
 SELECT   'DOCWSL_CITY_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM city A (NOLOCK)  
 JOIN AREA B (NOLOCK) ON A.CITY_CODE=B.CITY_CODE  
 JOIN LMP01106 C (NOLOCK) ON C.AREA_CODE=B.AREA_CODE  
 JOIN SKU  (NOLOCK) ON sku.AC_CODE=C.AC_CODE  
 JOIN IND01106 d (NOLOCK) ON LEFT(d.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',d.PRODUCT_CODE)-1,-1),LEN(d.PRODUCT_CODE )))=sku.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID AND @nbatchcode=1 and D.PRODUCT_CODE LIKE '%@%'     
  
 SELECT   'DOCWSL_STATE_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM STATE A (NOLOCK)  
 JOIN CITY B (NOLOCK) ON A.STATE_CODE=B.STATE_CODE  
 JOIN AREA C (NOLOCK) ON C.CITY_CODE=B.CITY_CODE  
 JOIN LMP01106 D (NOLOCK) ON D.AREA_CODE=C.AREA_CODE  
 JOIN SKU E (NOLOCK) ON E.AC_CODE=D.AC_CODE  
 JOIN IND01106 F (NOLOCK) ON F.PRODUCT_CODE=E.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID   
 UNION  
 SELECT   'DOCWSL_STATE_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM state A (NOLOCK)  
 JOIN CITY B (NOLOCK) ON A.STATE_CODE=B.STATE_CODE  
 JOIN AREA C (NOLOCK) ON C.CITY_CODE=B.CITY_CODE  
 JOIN LMP01106 L (NOLOCK) ON L.AREA_CODE=C.AREA_CODE  
 JOIN SKU  (NOLOCK) ON SKU.AC_CODE=L.AC_CODE  
 JOIN IND01106 d (NOLOCK) ON LEFT(d.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',d.PRODUCT_CODE)-1,-1),LEN(d.PRODUCT_CODE )))=SKu.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID AND @nbatchcode=1 and D.PRODUCT_CODE LIKE '%@%'     
     
 SELECT  DISTINCT 'DOCWSL_REGIONM_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM REGIONM A (NOLOCK)  
 JOIN STATE B (NOLOCK) ON A.REGION_CODE=B.REGION_CODE  
 JOIN CITY G (NOLOCK) ON G.STATE_CODE=B.STATE_CODE  
 JOIN AREA C (NOLOCK) ON C.CITY_CODE=G.CITY_CODE  
 JOIN LMP01106 D (NOLOCK) ON D.AREA_CODE=C.AREA_CODE  
 JOIN SKU E (NOLOCK) ON E.AC_CODE=D.AC_CODE  
 JOIN IND01106 F (NOLOCK) ON F.PRODUCT_CODE=E.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID      
   
 PRINT 'Sending Form agst Challan'  
 SELECT   'DOCWSL_FORM_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM FORM A (NOLOCK)  
 JOIN IND01106 B (NOLOCK) ON A.FORM_ID=B.ITEM_FORM_ID  
 WHERE INV_ID=@CMEMOID AND B.ITEM_FORM_ID<>'0000000'   
 UNION  
 SELECT   'DOCWSL_FORM_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM FORM A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON A.FORM_ID=B.FORM_ID  
 JOIN IND01106 C (NOLOCK) ON C.PRODUCT_CODE=B.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  
    
 IF(@BSENDPURINFOLOC=1)  
 BEGIN  
  PRINT 'Sending Sku_oh agst Challan'  
  SELECT  DISTINCT 'DOCWSL_SKU_OH_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM SKU_OH A (NOLOCK)  
  JOIN SKU B (NOLOCK) ON A.PRODUCT_CODE=B.PRODUCT_CODE  
  JOIN IND01106 C (NOLOCK) ON C.PRODUCT_CODE=B.PRODUCT_CODE  
  WHERE INV_ID=@CMEMOID  
 END  
   
 PRINT 'Sending article agst Challan'  
 SELECT   'DOCWSL_ARTICLE_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM ARTICLE A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON A.ARTICLE_CODE=B.ARTICLE_CODE  
 JOIN IND01106 C (NOLOCK) ON C.PRODUCT_CODE=B.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  
 UNION   
 SELECT   'DOCWSL_ARTICLE_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM ARTICLE A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON A.ARTICLE_CODE=B.ARTICLE_CODE  
 JOIN IND01106 C (NOLOCK) ON LEFT(c.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',c.PRODUCT_CODE)-1,-1),LEN(c.PRODUCT_CODE )))=B.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID AND @nbatchcode=1 and C.PRODUCT_CODE LIKE '%@%'  
  
 PRINT 'Sending subsection agst Challan id:'+@CMEMOID  
 SELECT   'DOCWSL_SECTIOND_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM SECTIOND A (NOLOCK)  
 JOIN ARTICLE B (NOLOCK) ON B.SUB_SECTION_CODE=A.SUB_SECTION_CODE  
 JOIN SKU C (NOLOCK) ON C.ARTICLE_CODE=B.ARTICLE_CODE  
 JOIN IND01106 D (NOLOCK) ON D.PRODUCT_CODE=C.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  
 UNION   
 SELECT   'DOCWSL_SECTIOND_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM SECTIOND A (NOLOCK)  
 JOIN ARTICLE B (NOLOCK) ON B.SUB_SECTION_CODE=A.SUB_SECTION_CODE  
 JOIN SKU C (NOLOCK) ON C.ARTICLE_CODE=B.ARTICLE_CODE  
 JOIN IND01106 D (NOLOCK) ON LEFT(D.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',D.PRODUCT_CODE)-1,-1),LEN(D.PRODUCT_CODE )))=C.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  and D.PRODUCT_CODE LIKE '%@%'  
   
 PRINT 'Sending uom agst Challan'  
 SELECT   'DOCWSL_UOM_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM UOM A (NOLOCK)  
 JOIN ARTICLE B (NOLOCK) ON B.UOM_CODE=A.UOM_CODE  
 JOIN SKU C (NOLOCK) ON C.ARTICLE_CODE=B.ARTICLE_CODE  
 JOIN IND01106 D (NOLOCK) ON D.PRODUCT_CODE=C.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  
 UNION  
 SELECT   'DOCWSL_UOM_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM UOM A (NOLOCK)  
 JOIN ARTICLE B (NOLOCK) ON B.UOM_CODE=A.UOM_CODE  
 JOIN SKU C (NOLOCK) ON C.ARTICLE_CODE=B.ARTICLE_CODE  
 JOIN IND01106 D (NOLOCK) ON LEFT(D.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',D.PRODUCT_CODE)-1,-1),LEN(D.PRODUCT_CODE )))=C.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID AND  @nbatchcode=1 and D.PRODUCT_CODE LIKE '%@%'  
   
 PRINT 'Sending section agst Challan'  
 SELECT   'DOCWSL_SECTIONM_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM SECTIONM A (NOLOCK)  
 JOIN SECTIOND B (NOLOCK) ON B.SECTION_CODE=A.SECTION_CODE  
 JOIN ARTICLE C (NOLOCK) ON C.SUB_SECTION_CODE=B.SUB_SECTION_CODE  
 JOIN SKU D (NOLOCK) ON D.ARTICLE_CODE=C.ARTICLE_CODE  
 JOIN IND01106 E (NOLOCK) ON E.PRODUCT_CODE=D.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  
 UNION  
 SELECT   'DOCWSL_SECTIONM_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM SECTIONM A (NOLOCK)  
 JOIN SECTIOND B (NOLOCK) ON B.SECTION_CODE=A.SECTION_CODE  
 JOIN ARTICLE C (NOLOCK) ON C.SUB_SECTION_CODE=B.SUB_SECTION_CODE  
 JOIN SKU D (NOLOCK) ON D.ARTICLE_CODE=C.ARTICLE_CODE  
 JOIN IND01106 E (NOLOCK)  ON LEFT(E.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',E.PRODUCT_CODE)-1,-1),LEN(E.PRODUCT_CODE )))=D.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID AND  @nbatchcode=1 and E.PRODUCT_CODE LIKE '%@%'  
  
 PRINT 'SENDING ART PARA1 AGST CHALLAN'--CHNAGE AS PER REQ OCTAVE ON 14082023  
 SELECT  DISTINCT 'DOCWSL_ART_PARA1_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,Ap.*   
 FROM IND01106 A (nolock)  
 join sku b (nolock) on A.product_code =b.product_code   
 join art_para1 AP (nolock) on b.article_code =Ap.article_code   
 where a.INV_ID =@CMEMOID  
  
   
 PRINT 'SENDING ART PARA2 AGST CHALLAN'--CHNAGE AS PER REQ OCTAVE ON 14082023  
 SELECT  DISTINCT 'DOCWSL_ART_DET_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,Ad.*   
 FROM IND01106 A (nolock)  
 join sku b (nolock) on A.product_code =b.product_code   
 join art_det AD (nolock) on b.article_code =Ad.article_code   
 where a.INV_ID =@CMEMOID  
  
  
   
 PRINT 'Sending para1 agst Challan'  
 SELECT   'DOCWSL_PARA1_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM PARA1 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON B.PARA1_CODE=A.PARA1_CODE  
 JOIN IND01106 C (NOLOCK) ON C.PRODUCT_CODE=B.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID   UNION  
 SELECT   'DOCWSL_PARA1_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM PARA1 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON B.PARA1_CODE=A.PARA1_CODE  
 JOIN IND01106 C (NOLOCK) ON LEFT(c.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',c.PRODUCT_CODE)-1,-1),LEN(c.PRODUCT_CODE )))=B.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID AND  @nbatchcode=1 and C.PRODUCT_CODE LIKE '%@%'  
 union   
 SELECT   'DOCWSL_PARA1_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,p1.*   
 FROM IND01106 A (nolock)  
 join sku b (nolock) on A.product_code =b.product_code   
 join art_para1 AP (nolock) on b.article_code =Ap.article_code   
 join para1 p1 (nolock) on p1.para1_code =ap.para1_code  
 where a.INV_ID =@CMEMOID  
  
  
 PRINT 'Sending para2 agst Challan'  
 SELECT   'DOCWSL_PARA2_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM PARA2 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON B.PARA2_CODE=A.PARA2_CODE  
 JOIN IND01106 C (NOLOCK) ON C.PRODUCT_CODE=B.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  
 UNION  
 SELECT   'DOCWSL_PARA2_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM PARA2 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON B.PARA2_CODE=A.PARA2_CODE  
 JOIN IND01106 C (NOLOCK) ON LEFT(c.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',c.PRODUCT_CODE)-1,-1),LEN(c.PRODUCT_CODE )))=B.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID AND  @nbatchcode=1 and C.PRODUCT_CODE LIKE '%@%'  
 union   
 SELECT   'DOCWSL_PARA2_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,p2.*   
 FROM IND01106 A (nolock)  
 join sku b (nolock) on A.product_code =b.product_code   
 join art_det AD (nolock) on b.article_code =Ad.article_code   
 join para2 p2 (nolock) on p2.para2_code=ad.para2_code   
 where a.INV_ID =@CMEMOID  
  
  
 PRINT 'Sending para3 agst Challan'  
 SELECT   'DOCWSL_PARA3_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM PARA3 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON B.PARA3_CODE=A.PARA3_CODE  
 JOIN IND01106 C (NOLOCK) ON C.PRODUCT_CODE=B.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  
 UNION  
 SELECT   'DOCWSL_PARA3_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM PARA3 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON B.PARA3_CODE=A.PARA3_CODE  
 JOIN IND01106 C (NOLOCK) ON LEFT(c.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',c.PRODUCT_CODE)-1,-1),LEN(c.PRODUCT_CODE )))=B.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID AND  @nbatchcode=1 and C.PRODUCT_CODE LIKE '%@%'   
  
 PRINT 'Sending para4 agst Challan'  
 SELECT   'DOCWSL_PARA4_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM PARA4 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON B.PARA4_CODE=A.PARA4_CODE  
 JOIN IND01106 C (NOLOCK) ON C.PRODUCT_CODE=B.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID   
 UNION  
 SELECT   'DOCWSL_PARA4_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM PARA4 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON B.PARA4_CODE=A.PARA4_CODE  
 JOIN IND01106 C (NOLOCK) ON LEFT(c.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',c.PRODUCT_CODE)-1,-1),LEN(c.PRODUCT_CODE )))=B.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID AND  @nbatchcode=1 and C.PRODUCT_CODE LIKE '%@%'  
  
 PRINT 'Sending para5 agst Challan'  
 SELECT   'DOCWSL_PARA5_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM PARA5 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON B.PARA5_CODE=A.PARA5_CODE  
 JOIN IND01106 C (NOLOCK) ON C.PRODUCT_CODE=B.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  
 UNION  
 SELECT   'DOCWSL_PARA5_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM PARA5 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON B.PARA5_CODE=A.PARA5_CODE  
 JOIN IND01106 C (NOLOCK) ON LEFT(c.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',c.PRODUCT_CODE)-1,-1),LEN(c.PRODUCT_CODE )))=B.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID AND  @nbatchcode=1 and C.PRODUCT_CODE LIKE '%@%'  
  
 PRINT 'Sending para6 agst Challan'  
 SELECT   'DOCWSL_PARA6_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM PARA6 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON B.PARA6_CODE=A.PARA6_CODE  
 JOIN IND01106 C (NOLOCK) ON C.PRODUCT_CODE=B.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  
 UNION  
 SELECT   'DOCWSL_PARA6_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM PARA6 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON B.PARA6_CODE=A.PARA6_CODE  
 JOIN IND01106 C (NOLOCK) ON LEFT(c.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',c.PRODUCT_CODE)-1,-1),LEN(c.PRODUCT_CODE )))=B.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID AND  @nbatchcode=1 and C.PRODUCT_CODE LIKE '%@%'  
  
 PRINT 'Sending para7 agst Challan'  
 SELECT   'DOCWSL_PARA7_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM PARA7 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON B.PARA7_CODE=A.PARA7_CODE  
 JOIN IND01106 C (NOLOCK) ON C.PRODUCT_CODE=B.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  
 UNION  
 SELECT   'DOCWSL_PARA7_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM PARA7 A (NOLOCK)  
 JOIN SKU B (NOLOCK) ON B.PARA7_CODE=A.PARA7_CODE  
 JOIN IND01106 C (NOLOCK) ON LEFT(c.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',c.PRODUCT_CODE)-1,-1),LEN(c.PRODUCT_CODE )))=B.PRODUCT_CODE   
 WHERE INV_ID=@CMEMOID AND  @nbatchcode=1 and C.PRODUCT_CODE LIKE '%@%'  
  
  
IF @BSENDNEWATTRIBUTE=1  
BEGIN  
 PRINT 'Sending article fix attributes agst Challan'  
 SELECT   'DOCWSL_ARTICLE_FIX_ATTR_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM ARTICLE_FIX_ATTR A (NOLOCK)  
 JOIN ARTICLE B (NOLOCK) ON A.ARTICLE_CODE=B.ARTICLE_CODE  
 JOIN SKU C (NOLOCK) ON C.ARTICLE_CODE=B.ARTICLE_CODE  
 JOIN IND01106 D (NOLOCK) ON D.PRODUCT_CODE=C.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  
 UNION  
 SELECT   'DOCWSL_ARTICLE_FIX_ATTR_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM ARTICLE_FIX_ATTR A (NOLOCK)  
 JOIN ARTICLE B (NOLOCK) ON A.ARTICLE_CODE=B.ARTICLE_CODE  
 JOIN SKU C (NOLOCK) ON C.ARTICLE_CODE=B.ARTICLE_CODE  
 JOIN IND01106 D (NOLOCK) ON LEFT(D.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',D.PRODUCT_CODE)-1,-1),LEN(D.PRODUCT_CODE )))=C.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID AND  @nbatchcode=1 and D.PRODUCT_CODE LIKE '%@%'  
   
   
 PRINT 'Sending sd_attr agst Challan'  
 SELECT   'DOCWSL_SD_ATTR_AVATAR_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM SD_ATTR_AVATAR A (NOLOCK)  
    JOIN SECTIOND SD(NOLOCK) ON SD.SUB_SECTION_CODE=A.SUB_SECTION_CODE  
 JOIN ARTICLE B (NOLOCK) ON SD.SUB_SECTION_CODE=B.SUB_SECTION_CODE  
 JOIN SKU C (NOLOCK) ON C.ARTICLE_CODE=B.ARTICLE_CODE  
 JOIN IND01106 D (NOLOCK) ON D.PRODUCT_CODE=C.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID  
 UNION  
    SELECT   'DOCWSL_SD_ATTR_AVATAR_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM SD_ATTR_AVATAR A (NOLOCK)  
    JOIN SECTIOND SD(NOLOCK) ON SD.SUB_SECTION_CODE=A.SUB_SECTION_CODE  
 JOIN ARTICLE B (NOLOCK) ON SD.SUB_SECTION_CODE=B.SUB_SECTION_CODE  
 JOIN SKU C (NOLOCK) ON C.ARTICLE_CODE=B.ARTICLE_CODE  
 JOIN IND01106 D (NOLOCK) ON LEFT(D.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',D.PRODUCT_CODE)-1,-1),LEN(D.PRODUCT_CODE )))=C.PRODUCT_CODE  
 WHERE INV_ID=@CMEMOID AND  @nbatchcode=1 and D.PRODUCT_CODE LIKE '%@%'  
   
   
    
   
   
  
    DECLARE @NCOUNT INT,@BLOOP INT,@CCMD NVARCHAR(MAX)  
 SET @NCOUNT=25  
 SET @BLOOP=1  
 WHILE (@BLOOP <=@NCOUNT )  
 BEGIN  
     PRINT 'Sending article attribute#'+str(@bLoop)+' agst Challan'              
     SET @CCMD=N'   
    SELECT   ''DOCWSL_ATTR'+RTRIM(LTRIM(RTRIM(LTRIM(STR(@BLOOP)))))+'_MST_MIRROR'' AS TARGET_TABLENAME,'''+@CMEMOID+''' AS DOCWSL_MEMO_ID,ATTR'+RTRIM(LTRIM(STR(@BLOOP)))+'_MST.*   
    FROM ATTR'+RTRIM(LTRIM(STR(@BLOOP)))+'_MST(NOLOCK)  
    JOIN ARTICLE_FIX_ATTR A (NOLOCK) ON ATTR'+RTRIM(LTRIM(STR(@BLOOP)))+'_MST.attr'+RTRIM(LTRIM(STR(@BLOOP)))+'_key_code=A.attr'+RTRIM(LTRIM(STR(@BLOOP)))+'_key_code  
    JOIN ARTICLE B (NOLOCK) ON A.ARTICLE_CODE=B.ARTICLE_CODE  
    JOIN SKU C (NOLOCK) ON C.ARTICLE_CODE=B.ARTICLE_CODE  
    JOIN IND01106 D (NOLOCK) ON D.PRODUCT_CODE=C.PRODUCT_CODE  
    WHERE INV_ID='''+@CMEMOID+'''  
    and  ATTR'+RTRIM(LTRIM(STR(@BLOOP)))+'_MST.attr'+RTRIM(LTRIM(RTRIM(LTRIM(STR(@BLOOP)))))+'_key_code <> ''0000000''  
    union  
    SELECT   ''DOCWSL_ATTR'+RTRIM(LTRIM(RTRIM(LTRIM(STR(@BLOOP)))))+'_MST_MIRROR'' AS TARGET_TABLENAME,'''+@CMEMOID+''' AS DOCWSL_MEMO_ID,ATTR'+RTRIM(LTRIM(STR(@BLOOP)))+'_MST.*   
    FROM ATTR'+RTRIM(LTRIM(STR(@BLOOP)))+'_MST(NOLOCK)  
    JOIN ARTICLE_FIX_ATTR A (NOLOCK) ON ATTR'+RTRIM(LTRIM(STR(@BLOOP)))+'_MST.attr'+RTRIM(LTRIM(STR(@BLOOP)))+'_key_code=A.attr'+RTRIM(LTRIM(STR(@BLOOP)))+'_key_code  
    JOIN ARTICLE B (NOLOCK) ON A.ARTICLE_CODE=B.ARTICLE_CODE  
    JOIN SKU C (NOLOCK) ON C.ARTICLE_CODE=B.ARTICLE_CODE  
    JOIN IND01106 D (NOLOCK) ON LEFT(D.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX (''@'',D.PRODUCT_CODE)-1,-1),LEN(D.PRODUCT_CODE )))=C.PRODUCT_CODE  
    WHERE INV_ID='''+@CMEMOID+''' and d.PRODUCT_CODE LIKE ''%@%''  
    and  ATTR'+RTRIM(LTRIM(STR(@BLOOP)))+'_MST.attr'+RTRIM(LTRIM(RTRIM(LTRIM(STR(@BLOOP)))))+'_key_code <> ''0000000'' '  
          
     PRINT  @CCMD  
     EXEC SP_EXECUTESQL @CCMD  
          
     SET @BLOOP=@BLOOP +1  
 END  
END   
   
  
 ----SELECT  DISTINCT 'DOCWSL_ATTR_KEY_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM ATTR_KEY A (NOLOCK)  
 ----JOIN ART_ATTR B (NOLOCK) ON B.KEY_CODE=A.KEY_CODE  
 ----JOIN ARTICLE C (NOLOCK) ON C.ARTICLE_CODE=B.ARTICLE_CODE  
 ----JOIN SKU D (NOLOCK) ON D.ARTICLE_CODE=C.ARTICLE_CODE  
 ----JOIN IND01106 E (NOLOCK) ON E.PRODUCT_CODE=D.PRODUCT_CODE  
 ----WHERE INV_ID=@CMEMOID   
  
 ----SELECT  DISTINCT 'DOCWSL_ATTRM_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM ATTRM A (NOLOCK)  
 ----JOIN ATTR_KEY B (NOLOCK) ON B.ATTRIBUTE_CODE=A.ATTRIBUTE_CODE  
 ----JOIN ART_ATTR C (NOLOCK) ON C.KEY_CODE=B.KEY_CODE  
 ----JOIN ARTICLE D (NOLOCK) ON D.ARTICLE_CODE=C.ARTICLE_CODE  
 ----JOIN SKU E (NOLOCK) ON E.ARTICLE_CODE=D.ARTICLE_CODE  
 ----JOIN IND01106 F (NOLOCK) ON F.PRODUCT_CODE=E.PRODUCT_CODE  
 ----WHERE INV_ID=@CMEMOID   
 ----UNION  
 ----SELECT  DISTINCT 'DOCWSL_ATTRM_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM ATTRM A (NOLOCK)  
 ----JOIN ART_ATTR C (NOLOCK) ON C.ATTRIBUTE_CODE=A.ATTRIBUTE_CODE  
 ----JOIN ARTICLE D (NOLOCK) ON D.ARTICLE_CODE=C.ARTICLE_CODE  
 ----JOIN SKU E (NOLOCK) ON E.ARTICLE_CODE=D.ARTICLE_CODE  
 ----JOIN IND01106 F (NOLOCK) ON F.PRODUCT_CODE=E.PRODUCT_CODE  
 ----WHERE INV_ID=@CMEMOID  
   

 PRINT 'Sending parcel_det Challan'  
 SELECT  DISTINCT 'DOCWSL_PARCEL_DET_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM PARCEL_DET A (NOLOCK)  
 JOIN PARCEL_MST C (NOLOCK) ON C.PARCEL_MEMO_ID=A.PARCEL_MEMO_ID  
 WHERE a.REF_MEMO_ID=@CMEMOID AND C.XN_TYPE='WSL'  
   
 PRINT 'Sending parcel_mst Challan'  
 SELECT  DISTINCT 'DOCWSL_PARCEL_MST_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,'0000000000' as ac_code,---(send this column to handlke old locations having ac_code column Done on 27-02-2019)  
 A.* FROM PARCEL_MST A (NOLOCK)  
 JOIN PARCEL_DET B (NOLOCK) ON B.PARCEL_MEMO_ID=A.PARCEL_MEMO_ID  
 WHERE B.REF_MEMO_ID=@CMEMOID AND A.XN_TYPE='WSL'  
     
 PRINT 'Sending angm Challan'  
 SELECT  DISTINCT 'DOCWSL_ANGM_MIRROR' AS TARGET_TABLENAME,@CMEMOID AS DOCWSL_MEMO_ID,A.* FROM ANGM A (NOLOCK)  
 JOIN PARCEL_MST B (NOLOCK) ON B.ANGADIA_CODE=A.ANGADIA_CODE  
 JOIN PARCEL_DET C (NOLOCK) ON C.PARCEL_MEMO_ID=B.PARCEL_MEMO_ID  
 WHERE C.REF_MEMO_ID=@CMEMOID AND B.XN_TYPE='WSL'  
  
   
   
 GOTO END_PROC  
   
END TRY  
BEGIN CATCH  
 SET @CERRMSG='P: SP_SEND_MIRROR_DOCWSL_OPT_DATA_NEW, STEP:'+@CSTEP+', MESSAGE:'+ERROR_MESSAGE()  
 GOTO END_PROC  
END CATCH     
  
END_PROC:  
    
END  
---END OF PROCEDURE - SP_SEND_MIRROR_DOCWSL_OPT_DATA  