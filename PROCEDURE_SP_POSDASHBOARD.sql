create PROCEDURE SP_POSDASHBOARD   
(  
 @NQUERY NUMERIC(1,0),	
 @DCURDATE DATETIME,
 @CLOCIDPARA CHAR(5)=''  
)  
--WITH ENCRYPTION
AS  
--(dinkar) Replace  left(memoid,2) to Location_code 
BEGIN  
DECLARE  @CPROCESSEDDT DATETIME
		,@CLOCATION_ID CHAR(4)

IF @NQUERY=1
GOTO POSDASHBOARD

ELSE IF @NQUERY=2
GOTO POSREMINDER

ELSE IF @NQUERY=3
GOTO POSMISINFO

ELSE
GOTO LAST

POSDASHBOARD: 
	 DECLARE @NCURMONTH NUMERIC(2),@CCURFINYEAR VARCHAR(10),@CDIVFACTOR NUMERIC(10)
			,@NPREMONTH NUMERIC(2),@CPREFINYEAR VARCHAR(10)  
			,@NCURYEAR NUMERIC(4),@NPREYEAR NUMERIC(4)
	 
	 SET @CCURFINYEAR='01'+DBO.FN_GETFINYEAR(@DCURDATE)  
	 SET @NCURMONTH=DATEPART(MM,@DCURDATE)  
	 SET @NCURYEAR=DATEPART(YY,@DCURDATE)   
	 SET @NPREYEAR=@NCURYEAR-1
	   
	 SET @CPREFINYEAR=@CCURFINYEAR-1  
	 SET @CPREFINYEAR='0'+@CPREFINYEAR  
	 SET @NPREMONTH=(CASE WHEN @NCURMONTH=1 THEN 12 ELSE @NCURMONTH-1 END)  
	 
	 IF @CLOCIDPARA=''
		SELECT @CLOCATION_ID=VALUE FROM CONFIG WHERE CONFIG_OPTION='LOCATION_ID' 
	 ELSE
		SET @CLOCATION_ID=@CLOCIDPARA
	   
	
	 SELECT TOP 1 @CDIVFACTOR=CONVERT(NUMERIC(10),ISNULL(VALUE,1)) FROM CONFIG 
	 WHERE CONFIG_OPTION='POS_DIV_FACTOR'  		  
	   
	 IF @CDIVFACTOR=1
		SET @CDIVFACTOR=1
	 IF @CDIVFACTOR=2
		SET @CDIVFACTOR=100
	 IF @CDIVFACTOR=3
		SET @CDIVFACTOR=1000
	 IF @CDIVFACTOR=4
		SET @CDIVFACTOR=100000			  
	   
	 SELECT @CDIVFACTOR=ISNULL(@CDIVFACTOR,1)  
	   
	 --SELECT DATEPART(MM,CM_DT) AS MONTH,DATEPART(YY,CM_DT) AS YEAR FROM CMM01106  
	 --SELECT DISTINCT DATEPART(YY,CM_DT) AS YEAR FROM CMM01106  
	 IF OBJECT_ID('TEMPDB..#POSDASHBOARD','U') IS NOT NULL  
		DROP TABLE #POSDASHBOARD  
	 CREATE TABLE #POSDASHBOARD(MONTH NUMERIC(2) NOT NULL,YEAR NUMERIC(4) NOT NULL
				,FIN_YEAR VARCHAR(10) NOT NULL  
				,TARGETSALE NUMERIC(18,2) NOT NULL DEFAULT(0),ACTUALSALE NUMERIC(18,2) NOT NULL DEFAULT(0))   
	   
	 ---CURRENT MONTH AND CURRENT FINYEAR ACTUAL SALE  
	 INSERT #POSDASHBOARD(MONTH,YEAR,FIN_YEAR,ACTUALSALE)  
	 SELECT DATEPART(MM,CM_DT) AS MONTH,DATEPART(YY,CM_DT) AS YEAR,FIN_YEAR,ROUND((SUM(NET_AMOUNT-ATD_CHARGES)/@CDIVFACTOR),2) AS ACTUALSALE  
	 FROM CMM01106 (NOLOCK)  
	 WHERE location_Code =@CLOCATION_ID AND DATEPART(MM,CM_DT)=@NCURMONTH 
	 AND CM_DT<=@DCURDATE AND FIN_YEAR=@CCURFINYEAR AND CANCELLED=0 AND CM_MODE=1  
	 GROUP BY DATEPART(MM,CM_DT),DATEPART(YY,CM_DT),FIN_YEAR  
	   
	 ---CURRENT MONTH AND CURRENT FINYEAR TARGET SALE  
	 INSERT #POSDASHBOARD(MONTH,YEAR,FIN_YEAR,TARGETSALE)  
	 SELECT TARGET_MONTH AS MONTH,TARGET_YEAR AS YEAR,FIN_YEAR,ROUND((SUM(TARGET_AMOUNT)/@CDIVFACTOR),2) AS TARGETSALE  
	 FROM LOC_SALE_TARGET  (NOLOCK)
	 WHERE DEPT_ID=@CLOCATION_ID AND TARGET_MONTH=@NCURMONTH AND FIN_YEAR=@CCURFINYEAR  
	 GROUP BY TARGET_MONTH,TARGET_YEAR,FIN_YEAR  
	   
	 ----CURRENT MONTH AND CURRENT YEAR ACHIEVED PERCENTAGE  
	 IF OBJECT_ID('TEMPDB..#POSDASHBOARD_CMCY','U') IS NOT NULL  
	  DROP TABLE #POSDASHBOARD_CMCY  
	   
	 SELECT MONTH,YEAR,FIN_YEAR,SUM(ACTUALSALE) AS ACTUALSALE,SUM(TARGETSALE) AS TARGETSALE  
	 ,CONVERT(VARCHAR(20),0) AS ACHIEVED_PER  
	 INTO #POSDASHBOARD_CMCY  
	 FROM #POSDASHBOARD  
	 GROUP BY MONTH,YEAR,FIN_YEAR  
	   
	 ---CALCULATING ACHIEVED PERCENTAGE  
	 UPDATE #POSDASHBOARD_CMCY   
	 SET ACHIEVED_PER=(CASE WHEN TARGETSALE=0 THEN 0 ELSE CONVERT(NUMERIC(10,0),ROUND((ACTUALSALE/TARGETSALE)*100,0)) END)  
	   
	 TRUNCATE TABLE #POSDASHBOARD  
	   
	 --PREVIOUS MONTH AND CURRENT FINYEAR ACTUAL SALE  
	 INSERT #POSDASHBOARD(MONTH,YEAR,FIN_YEAR,ACTUALSALE)  
	 SELECT DATEPART(MM,CM_DT) AS MONTH,DATEPART(YY,CM_DT) AS YEAR,FIN_YEAR  
		,ROUND((SUM(NET_AMOUNT-ATD_CHARGES)/@CDIVFACTOR),2) AS ACTUALSALE  
	 FROM CMM01106   (NOLOCK)
	 WHERE location_Code =@CLOCATION_ID AND DATEPART(MM,CM_DT)=@NPREMONTH AND CM_MODE=1 
	 AND CANCELLED=0 
	 AND FIN_YEAR=(CASE WHEN @NPREMONTH=3 THEN @CPREFINYEAR ELSE @CCURFINYEAR END)  
	 GROUP BY DATEPART(MM,CM_DT),DATEPART(YY,CM_DT),FIN_YEAR  
	   
	 --PREVIOUS MONTH AND CURRENT FINYEAR TARGET SALE  
	 INSERT #POSDASHBOARD(MONTH,YEAR,FIN_YEAR,TARGETSALE)  
	 SELECT TARGET_MONTH AS MONTH,TARGET_YEAR AS YEAR,FIN_YEAR,ROUND((SUM(TARGET_AMOUNT)/@CDIVFACTOR),2) AS TARGETSALE  
	 FROM LOC_SALE_TARGET  (NOLOCK)
	 WHERE DEPT_ID=@CLOCATION_ID AND TARGET_MONTH=@NPREMONTH 
	 AND FIN_YEAR=(CASE WHEN @NPREMONTH=3 THEN @CPREFINYEAR ELSE @CCURFINYEAR END)  
	 GROUP BY TARGET_MONTH,TARGET_YEAR,FIN_YEAR  
	  
	 ----PREVIOUS MONTH AND CURRENT YEAR ACHIEVED PERCENTAGE  
	 IF OBJECT_ID('TEMPDB..#POSDASHBOARD_PMCY','U') IS NOT NULL  
	  DROP TABLE #POSDASHBOARD_PMCY  
	   
	 SELECT MONTH,YEAR,FIN_YEAR,SUM(ACTUALSALE) AS ACTUALSALE,SUM(TARGETSALE) AS TARGETSALE  
	 ,CONVERT(VARCHAR(20),0) AS ACHIEVED_PER  
	 INTO #POSDASHBOARD_PMCY  
	 FROM #POSDASHBOARD  
	 GROUP BY MONTH,YEAR,FIN_YEAR  
	   
	 ---CALCULATING ACHIEVED PERCENTAGE  
	 UPDATE #POSDASHBOARD_PMCY   
	 SET ACHIEVED_PER=(CASE WHEN TARGETSALE=0 THEN 0 ELSE CONVERT(NUMERIC(10),ROUND((ACTUALSALE/TARGETSALE)*100,0)) END)  
	  
	 TRUNCATE TABLE #POSDASHBOARD  
	    
	 --CURRENT MONTH AND PREVIOUS YEAR ACTUAL SALE  
	 INSERT #POSDASHBOARD(MONTH,YEAR,FIN_YEAR,ACTUALSALE)  
	 SELECT DATEPART(MM,CM_DT) AS MONTH,DATEPART(YY,CM_DT) AS YEAR,FIN_YEAR,
	 ROUND((SUM(NET_AMOUNT-ATD_CHARGES)/@CDIVFACTOR),2) AS ACTUALSALE  
	 FROM CMM01106 (NOLOCK)  
	 WHERE location_Code  =@CLOCATION_ID AND DATEPART(MM,CM_DT)=@NCURMONTH 
	 AND FIN_YEAR=@CPREFINYEAR AND CANCELLED=0 AND CM_MODE=1  
	 GROUP BY DATEPART(MM,CM_DT),DATEPART(YY,CM_DT),FIN_YEAR  
	   
	 --CURRENT MONTH AND PREVIOUS YEAR TARGET SALE  
	 INSERT #POSDASHBOARD(MONTH,YEAR,FIN_YEAR,TARGETSALE)  
	 SELECT TARGET_MONTH AS MONTH,TARGET_YEAR AS YEAR,FIN_YEAR,ROUND((SUM(TARGET_AMOUNT)/@CDIVFACTOR),2) AS TARGETSALE  
	 FROM LOC_SALE_TARGET (NOLOCK) 
	 WHERE DEPT_ID=@CLOCATION_ID AND TARGET_MONTH=@NCURMONTH AND FIN_YEAR=@CPREFINYEAR  
	 GROUP BY TARGET_MONTH,TARGET_YEAR,FIN_YEAR  
	   
	 ----CURRENT MONTH AND PREVIOUS YEAR ACHIEVED PERCENTAGE  
	 IF OBJECT_ID('TEMPDB..#POSDASHBOARD_CMPY','U') IS NOT NULL  
	  DROP TABLE #POSDASHBOARD_CMPY  
	   
	 SELECT MONTH,YEAR,FIN_YEAR,SUM(ACTUALSALE) AS ACTUALSALE,SUM(TARGETSALE) AS TARGETSALE  
	 ,CONVERT(VARCHAR(20),0) AS ACHIEVED_PER  
	 INTO #POSDASHBOARD_CMPY  
	 FROM #POSDASHBOARD  
	 GROUP BY MONTH,YEAR,FIN_YEAR  
	   
	 ---CALCULATING ACHIEVED PERCENTAGE  
	 UPDATE #POSDASHBOARD_CMPY   
	 SET ACHIEVED_PER=(CASE WHEN TARGETSALE=0 THEN 0 ELSE CONVERT(NUMERIC(10),ROUND((ACTUALSALE/TARGETSALE)*100,0)) END)  
	  
	 TRUNCATE TABLE #POSDASHBOARD  
	  
	 -----CALCULATION OF CUMULATIVE SALE  
	 IF OBJECT_ID('TMPDB..#POSDASHBOARD_C','U') IS NOT NULL  
	  DROP TABLE #POSDASHBOARD_C  
	 CREATE TABLE #POSDASHBOARD_C(FIN_YEAR VARCHAR(10)  
			,CUM_ACTUALSALE NUMERIC(18,2) NOT NULL DEFAULT(0)  
			,CUM_TARGETSALE NUMERIC(18,2) NOT NULL DEFAULT(0)  
			,CUM_ACHIEVED_PER NUMERIC(10) NOT NULL DEFAULT(0))  
	 
	 ---CURRENT YEAR CUMULATIVE           
	 IF @NCURMONTH>3  
	 BEGIN  
	  INSERT #POSDASHBOARD_C(FIN_YEAR,CUM_ACTUALSALE)  
	  SELECT FIN_YEAR,ROUND((SUM(NET_AMOUNT-ATD_CHARGES)/@CDIVFACTOR),2) AS ACTUALSALE  
	  FROM CMM01106  (NOLOCK) 
	  WHERE location_Code =@CLOCATION_ID AND CM_DT<=@DCURDATE AND FIN_YEAR=@CCURFINYEAR 
	  AND CANCELLED=0 AND CM_MODE=1  
	  GROUP BY FIN_YEAR  
	    
	  INSERT #POSDASHBOARD_C(FIN_YEAR,CUM_TARGETSALE)  
	  SELECT FIN_YEAR,ROUND((SUM(TARGET_AMOUNT)/@CDIVFACTOR),2) AS TARGETSALE  
	  FROM LOC_SALE_TARGET  (NOLOCK) 
	  WHERE DEPT_ID=@CLOCATION_ID AND TARGET_MONTH<=@NCURMONTH AND FIN_YEAR=@CCURFINYEAR 
	  AND TARGET_YEAR=@NCURYEAR
	  GROUP BY FIN_YEAR  
	 END  
	 ELSE  
	 BEGIN  
	  INSERT #POSDASHBOARD_C(FIN_YEAR,CUM_ACTUALSALE)  
	  SELECT FIN_YEAR,ROUND((SUM(NET_AMOUNT-ATD_CHARGES)/@CDIVFACTOR),2) AS ACTUALSALE  
	  FROM CMM01106 (NOLOCK)  
	  WHERE location_Code =@CLOCATION_ID AND CM_DT<=@DCURDATE AND FIN_YEAR=@CCURFINYEAR 
	  AND CANCELLED=0 AND CM_MODE=1  
	  GROUP BY FIN_YEAR  
	     
	  INSERT #POSDASHBOARD_C(FIN_YEAR,CUM_TARGETSALE)  
	  SELECT FIN_YEAR,ROUND((SUM(TARGET_AMOUNT)/@CDIVFACTOR),2) AS TARGETSALE  
	  FROM LOC_SALE_TARGET (NOLOCK)  
	  WHERE DEPT_ID=@CLOCATION_ID AND TARGET_MONTH<=@NCURMONTH AND FIN_YEAR=@CCURFINYEAR
	  AND TARGET_YEAR=@NCURYEAR  
	  GROUP BY FIN_YEAR  
	  UNION ALL  
	  SELECT FIN_YEAR,ROUND((SUM(TARGET_AMOUNT)/@CDIVFACTOR),2) AS TARGETSALE  
	  FROM LOC_SALE_TARGET (NOLOCK)  
	  WHERE DEPT_ID=@CLOCATION_ID AND TARGET_MONTH>=4 AND FIN_YEAR=@CCURFINYEAR
	  AND TARGET_YEAR=@NPREYEAR  
	  GROUP BY FIN_YEAR  
	 END  
	    
	 ---CALCULATION OF CURRENT YEAR CUMULATIVE ACHIEVED PERCENTAGE  
	 IF OBJECT_ID('TMPDB..#POSDASHBOARD_CCY','U') IS NOT NULL  
	  DROP TABLE #POSDASHBOARD_CCY  
	   
	 SELECT FIN_YEAR,SUM(CUM_ACTUALSALE) AS CUM_ACTUALSALE,SUM(CUM_TARGETSALE) AS CUM_TARGETSALE  
	 ,CONVERT(VARCHAR(20),0) AS ACHIEVED_PER  
	 INTO #POSDASHBOARD_CCY  
	 FROM #POSDASHBOARD_C  
	 GROUP BY FIN_YEAR  
	   
	 ---CALCULATING ACHIEVED PERCENTAGE  
	 UPDATE #POSDASHBOARD_CCY   
	 SET ACHIEVED_PER=(CASE WHEN CUM_TARGETSALE=0 THEN 0 ELSE CONVERT(NUMERIC(10),ROUND((CUM_ACTUALSALE/CUM_TARGETSALE)*100,0)) END)  
	   
	 TRUNCATE TABLE #POSDASHBOARD_C  
	   
	 ---LAST YEAR CUMULATIVE   
	 IF @NCURMONTH>3  
	 BEGIN  
	  INSERT #POSDASHBOARD_C(FIN_YEAR,CUM_ACTUALSALE)  
	  SELECT FIN_YEAR,ROUND((SUM(NET_AMOUNT-ATD_CHARGES)/@CDIVFACTOR),2) AS ACTUALSALE  
	  FROM CMM01106 (NOLOCK)  
	  WHERE location_Code =@CLOCATION_ID AND CM_DT<=DATEADD(YY,-1,@DCURDATE) AND FIN_YEAR=@CPREFINYEAR AND CANCELLED=0 AND CM_MODE=1  
	  GROUP BY FIN_YEAR  
	    
	  INSERT #POSDASHBOARD_C(FIN_YEAR,CUM_TARGETSALE)  
	  SELECT FIN_YEAR,ROUND((SUM(TARGET_AMOUNT)/@CDIVFACTOR),2) AS TARGETSALE  
	  FROM LOC_SALE_TARGET  (NOLOCK) 
	  WHERE DEPT_ID=@CLOCATION_ID AND TARGET_MONTH<=@NCURMONTH AND FIN_YEAR=@CPREFINYEAR  
	  AND TARGET_YEAR=@NPREYEAR
	  GROUP BY FIN_YEAR  
	 END  
	 ELSE  
	 BEGIN  
	  INSERT #POSDASHBOARD_C(FIN_YEAR,CUM_ACTUALSALE)  
	  SELECT FIN_YEAR,ROUND((SUM(NET_AMOUNT-ATD_CHARGES)/@CDIVFACTOR),2) AS ACTUALSALE  
	  FROM CMM01106  (NOLOCK) 
	  WHERE location_Code =@CLOCATION_ID AND CM_DT<=DATEADD(YY,-1,@DCURDATE) AND FIN_YEAR=@CPREFINYEAR AND CANCELLED=0 AND CM_MODE=1  
	  GROUP BY FIN_YEAR  
	     
	  INSERT #POSDASHBOARD_C(FIN_YEAR,CUM_TARGETSALE)  
	  SELECT FIN_YEAR,ROUND((SUM(TARGET_AMOUNT)/@CDIVFACTOR),2) AS TARGETSALE  
	  FROM LOC_SALE_TARGET  (NOLOCK) 
	  WHERE DEPT_ID=@CLOCATION_ID AND TARGET_MONTH<=@NCURMONTH AND FIN_YEAR=@CPREFINYEAR  
	  AND TARGET_YEAR=@NPREYEAR
	  GROUP BY FIN_YEAR  
	  UNION ALL  
	  SELECT FIN_YEAR,ROUND((SUM(TARGET_AMOUNT)/@CDIVFACTOR),2) AS TARGETSALE  
	  FROM LOC_SALE_TARGET  (NOLOCK) 
	  WHERE DEPT_ID=@CLOCATION_ID AND TARGET_MONTH>=4 AND FIN_YEAR=@CPREFINYEAR  
	  AND TARGET_YEAR=(@NPREYEAR-1)
	  GROUP BY FIN_YEAR  
	 END  
	 
	 ---CALCULATION OF PREVIOUS YEAR CUMULATIVE ACHIEVED PERCENTAGE  
	 IF OBJECT_ID('TMPDB..#POSDASHBOARD_CPY','U') IS NOT NULL  
	  DROP TABLE #POSDASHBOARD_CPY  
	   
	 SELECT FIN_YEAR,SUM(CUM_ACTUALSALE) AS CUM_ACTUALSALE,SUM(CUM_TARGETSALE) AS CUM_TARGETSALE  
	 ,CONVERT(VARCHAR(20),0) AS ACHIEVED_PER  
	 INTO #POSDASHBOARD_CPY  
	 FROM #POSDASHBOARD_C  
	 GROUP BY FIN_YEAR  
	   
	 ---CALCULATING ACHIEVED PERCENTAGE  
	 UPDATE #POSDASHBOARD_CPY   
	 SET ACHIEVED_PER=(CASE WHEN CUM_TARGETSALE=0 THEN 0 ELSE CONVERT(NUMERIC(10),ROUND((CUM_ACTUALSALE/CUM_TARGETSALE)*100,0)) END)  
	   
	 TRUNCATE TABLE #POSDASHBOARD_C  
	 DECLARE @NCYSALE NUMERIC(18,2)
			,@NPYSALE NUMERIC(18,2)
			,@NCYCSALE NUMERIC(18,2)
			,@NPYCSALE NUMERIC(18,2)
	 
	 SELECT @NCYSALE=ACTUALSALE FROM #POSDASHBOARD_CMCY
	 SELECT @NPYSALE=ACTUALSALE FROM #POSDASHBOARD_CMPY
	 SELECT @NCYCSALE=CUM_ACTUALSALE FROM #POSDASHBOARD_CCY
	 SELECT @NPYCSALE=CUM_ACTUALSALE FROM #POSDASHBOARD_CPY
	 
	 ---CURRENT MONTH AND CURRENT YEAR   
	 SELECT MONTH,YEAR,FIN_YEAR,ACTUALSALE,TARGETSALE
	 ,(CASE WHEN TARGETSALE=0 THEN 'NA' ELSE ACHIEVED_PER END) AS ACHIEVED_PER 
	 ,(CASE WHEN @NPYSALE=0 THEN 'NA' ELSE CONVERT(NUMERIC(18),((@NCYSALE-@NPYSALE)/@NPYSALE)*100) END) AS MOM_VALUE
	 FROM #POSDASHBOARD_CMCY   
	 
	 --PREVIOUS MONTH AND CURRENT YEAR
	 SELECT MONTH,YEAR,FIN_YEAR,ACTUALSALE,TARGETSALE
	 ,(CASE WHEN TARGETSALE=0 THEN 'NA' ELSE ACHIEVED_PER END) AS ACHIEVED_PER 
	 FROM #POSDASHBOARD_PMCY   
	 
	 --CURRENT MONTH AND PREVIOUS YEAR
	 SELECT MONTH,YEAR,FIN_YEAR,ACTUALSALE,TARGETSALE
	 ,(CASE WHEN TARGETSALE=0 THEN 'NA' ELSE ACHIEVED_PER END) AS ACHIEVED_PER 
	 FROM #POSDASHBOARD_CMPY   
	 
	 ---CURRENT YEAR CUMULATIVE
	 SELECT FIN_YEAR,CUM_ACTUALSALE,CUM_TARGETSALE
	 ,(CASE WHEN CUM_TARGETSALE=0 THEN 'NA' ELSE ACHIEVED_PER END) AS ACHIEVED_PER 
	 ,(CASE WHEN @NPYCSALE=0 THEN 'NA' ELSE CONVERT(NUMERIC(18),(((@NCYCSALE-@NPYCSALE)/@NPYCSALE)*100)) END) AS YOY_VALUE
	 FROM #POSDASHBOARD_CCY  
	 
	 ---PREVIOUS YEAR CUMULATIVE
	 SELECT FIN_YEAR,CUM_ACTUALSALE,CUM_TARGETSALE
	 ,(CASE WHEN CUM_TARGETSALE=0 THEN 'NA' ELSE ACHIEVED_PER END) AS ACHIEVED_PER 
	 FROM #POSDASHBOARD_CPY  
	   
	GOTO LAST

POSREMINDER:
	DECLARE @CSHOWCOMPREMINDER BIT
	SELECT @CSHOWCOMPREMINDER=CONVERT(NUMERIC(10),VALUE) FROM CONFIG WHERE CONFIG_OPTION='DONOT_SHOW_COMPLETE_REMINDER'  	
		SELECT ROW_NUMBER() OVER (ORDER BY RMD_DT DESC) AS SNO,
		CASE WHEN ISNULL([STATUS],0)=0 THEN 'PENDING' ELSE 'COMPLETED' END _STATUS 
		,CASE WHEN  DATEDIFF(DAY,RMD_DT,@DCURDATE)<=0 THEN '' ELSE DATEDIFF(DAY,RMD_DT,@DCURDATE)  END   AS [DELAY] 
		,RMD_ID,CONTENT ,[STATUS], RMD_DT,CONVERT(VARCHAR, RMD_DT,105) AS REMINDER_DT
		 FROM REMINDERS
		 WHERE RMD_DT<=@DCURDATE

	GOTO LAST

POSMISINFO:
		
	IF @CLOCIDPARA=''
		SELECT @CLOCATION_ID=VALUE FROM CONFIG WHERE CONFIG_OPTION='LOCATION_ID' 
	 ELSE
		SET @CLOCATION_ID=@CLOCIDPARA
		
	--SET @CPROCESSEDDT=DATEADD(DD,-1,DATEADD(DD,0,DATEDIFF(DD,0,@DCURDATE)))
	
	--SELECT @CPROCESSEDDT=MAX(PROCESSEDDT) FROM LOC_MIS_INFO (NOLOCK) 
	--WHERE PROCESSEDDT<=@CPROCESSEDDT 
	
	--GMROI
	SELECT 'CUR' AS TITLE,CONVERT(NUMERIC(18),CURRENT_GMROI) AS GMROI
	FROM LOC_MIS_INFO (NOLOCK) WHERE PROCESSEDDT=@DCURDATE AND DEPT_ID=@CLOCATION_ID
	UNION ALL
	SELECT 'MAX' AS TITLE,CONVERT(NUMERIC(18),MAX(CURRENT_GMROI)) AS GMROI 
	FROM LOC_MIS_INFO (NOLOCK) WHERE PROCESSEDDT=@DCURDATE
	UNION ALL
	SELECT 'AVG' AS TITLE,CONVERT(NUMERIC(18),AVG(CURRENT_GMROI)) AS GMROI
	FROM LOC_MIS_INFO (NOLOCK) WHERE PROCESSEDDT=@DCURDATE
	UNION ALL
	SELECT 'PRE' AS TITLE,CONVERT(NUMERIC(18),PREVIOUS_GMROI) AS GMROI
	FROM LOC_MIS_INFO (NOLOCK) WHERE PROCESSEDDT=@DCURDATE AND DEPT_ID=@CLOCATION_ID

	--PSPD
	SELECT 'CUR' AS TITLE, CONVERT(NUMERIC(18),CURRENT_PSPD) AS PSPD FROM LOC_MIS_INFO (NOLOCK)
	WHERE PROCESSEDDT=@DCURDATE AND DEPT_ID=@CLOCATION_ID
	UNION ALL
	SELECT 'MAX' AS TITLE, CONVERT(NUMERIC(18),MAX(CURRENT_PSPD)) AS PSPD
	FROM LOC_MIS_INFO (NOLOCK) WHERE PROCESSEDDT=@DCURDATE
	UNION ALL
	SELECT 'AVG' AS TITLE,CONVERT(NUMERIC(18),AVG(CURRENT_PSPD)) AS PSPD
	FROM LOC_MIS_INFO (NOLOCK) WHERE PROCESSEDDT=@DCURDATE
	UNION ALL
	SELECT 'PRE' AS TITLE,CONVERT(NUMERIC(18),PREVIOUS_PSPD) AS PSPD
	FROM LOC_MIS_INFO (NOLOCK) WHERE PROCESSEDDT=@DCURDATE AND DEPT_ID=@CLOCATION_ID
	
	--TPY
	SELECT 'CUR' AS TITLE,CONVERT(NUMERIC(18),CURRENT_TPY) AS TPY
	FROM LOC_MIS_INFO (NOLOCK) WHERE PROCESSEDDT=@DCURDATE AND DEPT_ID=@CLOCATION_ID
	UNION ALL
	SELECT 'MAX' AS TITLE,CONVERT(NUMERIC(18),MAX(CURRENT_TPY)) AS TPY
	FROM LOC_MIS_INFO (NOLOCK) WHERE PROCESSEDDT=@DCURDATE
	UNION ALL
	SELECT 'AVG' AS TITLE,CONVERT(NUMERIC(18),AVG(CURRENT_TPY)) AS TPY
	FROM LOC_MIS_INFO (NOLOCK) WHERE PROCESSEDDT=@DCURDATE
	UNION ALL
	SELECT 'PRE' AS TITLE,CONVERT(NUMERIC(18),PREVIOUS_TPY) AS TPY
	FROM LOC_MIS_INFO (NOLOCK) WHERE PROCESSEDDT=@DCURDATE AND DEPT_ID=@CLOCATION_ID
		
	GOTO LAST
   
LAST:  
END  
--END OF PROCEDURE - SP_POSDASHBOARD
