CREATE PROCEDURE SP_POSTSALES_JOB_WORK_ISSUE       
(        
  @IMODE INT ,        
  @CWHERE VARCHAR(4000)='',    
  @CAGENCYCODE CHAR(7)='',    
  @BMODE BIT = 0 ,  
  @FINYEAR VARCHAR(10)=''  ,  
  @DEPTID VARCHAR(10)=''       
)    
----WITH ENCRYPTION        
      
AS        
BEGIN        
	IF @IMODE =1        
		EXEC SP_POSTSALES_JOB_WORK_ISSUE_1 @IMODE=@IMODE,@CWHERE=@CWHERE,@CAGENCYCODE=@CAGENCYCODE,@BMODE=@BMODE,@FINYEAR=@FINYEAR,@DEPTID=@DEPTID
	ELSE IF @IMODE =2        
		EXEC SP_POSTSALES_JOB_WORK_ISSUE_2 @IMODE=@IMODE,@CWHERE=@CWHERE,@CAGENCYCODE=@CAGENCYCODE,@BMODE=@BMODE,@FINYEAR=@FINYEAR,@DEPTID=@DEPTID
	ELSE IF @IMODE =3        
		EXEC SP_POSTSALES_JOB_WORK_ISSUE_3 @IMODE=@IMODE,@CWHERE=@CWHERE,@CAGENCYCODE=@CAGENCYCODE,@BMODE=@BMODE,@FINYEAR=@FINYEAR,@DEPTID=@DEPTID
	ELSE IF @IMODE =4        
		EXEC SP_POSTSALES_JOB_WORK_ISSUE_4 @IMODE=@IMODE,@CWHERE=@CWHERE,@CAGENCYCODE=@CAGENCYCODE,@BMODE=@BMODE,@FINYEAR=@FINYEAR,@DEPTID=@DEPTID
	ELSE IF @IMODE =5        
		EXEC SP_POSTSALES_JOB_WORK_ISSUE_5 @IMODE=@IMODE,@CWHERE=@CWHERE,@CAGENCYCODE=@CAGENCYCODE,@BMODE=@BMODE,@FINYEAR=@FINYEAR,@DEPTID=@DEPTID
	ELSE IF @IMODE =6        
		EXEC SP_POSTSALES_JOB_WORK_ISSUE_6 @IMODE=@IMODE,@CWHERE=@CWHERE,@CAGENCYCODE=@CAGENCYCODE,@BMODE=@BMODE,@FINYEAR=@FINYEAR,@DEPTID=@DEPTID
	ELSE IF @IMODE=7     
		EXEC SP_POSTSALES_JOB_WORK_ISSUE_7 @IMODE=@IMODE,@CWHERE=@CWHERE,@CAGENCYCODE=@CAGENCYCODE,@BMODE=@BMODE,@FINYEAR=@FINYEAR,@DEPTID=@DEPTID
	ELSE IF @IMODE=8        
		EXEC SP_POSTSALES_JOB_WORK_ISSUE_8 @IMODE=@IMODE,@CWHERE=@CWHERE,@CAGENCYCODE=@CAGENCYCODE,@BMODE=@BMODE,@FINYEAR=@FINYEAR,@DEPTID=@DEPTID
 END
 /*
CREATE PROCEDURE SP_POSTSALES_JOB_WORK_ISSUE       
(        
  @IMODE INT ,        
  @CWHERE VARCHAR(4000)='',    
  @CAGENCYCODE CHAR(7)='',    
  @BMODE BIT = 0 ,  
  @FINYEAR VARCHAR(10)=''  ,  
  @DEPTID VARCHAR(10)=''       
)    
----WITH ENCRYPTION        
      
AS        
BEGIN        
        
 IF @IMODE =1        
 GOTO LBLLOOKUP        
         
 ELSE IF @IMODE =2        
 GOTO LBLMST        
         
 ELSE IF @IMODE =3        
 GOTO LBLDET        
         
 ELSE IF @IMODE =4        
 GOTO LBLHBDDET        
         
 ELSE IF @IMODE =5        
 GOTO LBLAGENCY        
         
 ELSE IF @IMODE =6        
 GOTO LBLAGJOBS        
     
 ELSE IF @IMODE=7     
  GOTO LBLGRID      
    
 ELSE IF @IMODE=8        
 GOTO LBLCANCELCHECK      
    
 ELSE        
 GOTO LAST      
     
 DECLARE @CCMD NVARCHAR(MAX)       
         
LBLLOOKUP:      
  
  SELECT ISSUE_ID,ISSUE_NO FROM POST_SALES_JOBWORK_ISSUE_MST (NOLOCK)  
  WHERE FIN_YEAR=@FINYEAR  ORDER BY LAST_UPDATE DESC  
 GOTO LAST         
        
LBLMST:      
    
    SELECT A.*,B.AGENCY_NAME,C.JOB_NAME, U.USERNAME ,ISNULL(U1.USERNAME,'') AS  EDIT_USER_NAME,    
    '' AS ADDRESS_F       
 FROM POST_SALES_JOBWORK_ISSUE_MST A (NOLOCK)           
 JOIN PRD_AGENCY_MST B (NOLOCK) ON A.AGENCY_CODE = B.AGENCY_CODE           
 JOIN JOBS C (NOLOCK) ON A.COMPANY_CODE = C.COMPANY_CODE       
 JOIN USERS U (NOLOCK) ON U.USER_CODE=A.USER_CODE     
 LEFT OUTER JOIN USERS U1 (NOLOCK) ON U1.USER_CODE=A.EDT_USER_CODE    
 WHERE A.ISSUE_ID = @CWHERE           
     
 GOTO LAST         
         
LBLDET:     ---- CHANGE DONE BY SANJAY ON 22-06-15  
  
 SELECT CAST(0 AS BIT) AS CHKBILL, A.ISSUE_NO,A.ISSUE_ID,M.CM_NO ,G.*,      
 ART.ARTICLE_CODE, ART.ARTICLE_NO, ART.ARTICLE_NAME, P1.PARA1_CODE,        
 PARA1_NAME, P2.PARA2_CODE,PARA2_NAME,P3.PARA3_CODE,PARA3_NAME,UOM_NAME,           
 CODING_SCHEME,CONVERT(NUMERIC(10,2),0) AS QUANTITY_IN_STOCK,SKU.PURCHASE_PRICE,      
 SKU.MRP,SKU.WS_PRICE,   SM.SECTION_NAME, SD.SUB_SECTION_NAME,        
 P4.PARA4_CODE,P5.PARA5_CODE,P6.PARA6_CODE,        
 PARA4_NAME,PARA5_NAME,PARA6_NAME,E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],        
 ART.DT_CREATED AS [ART_DT_CREATED],P3.DT_CREATED AS [PARA3_DT_CREATED],SKU.DT_CREATED AS [SKU_DT_CREATED],        
 ART.STOCK_NA,JOBS.JOB_CODE,JOBS.JOB_NAME,(G.QUANTITY*G.JOB_RATE) AS AMOUNT,  
 EMP.EMP_CODE,EMP.EMP_NAME ,    
 B.DELIVERY_DT ,(CUST.CUSTOMER_FNAME +' '+ CUST.CUSTOMER_LNAME) AS CUST_NAME,CUST.MOBILE ,  
 ART.ALIAS AS ARTICLE_ALIAS ,M.CM_ID      
 FROM POST_SALES_JOBWORK_ISSUE_MST A (NOLOCK)             
 JOIN POST_SALES_JOBWORK_ISSUE_DET  G (NOLOCK)  ON A.ISSUE_ID = G.ISSUE_ID        
 JOIN HOLD_BACK_DELIVER_DET B (NOLOCK) ON G.REF_HBD_ROW_ID = B.ROW_ID             
 JOIN HOLD_BACK_DELIVER_MST HBM (NOLOCK) ON HBM.MEMO_ID=B.MEMO_ID  
 JOIN CMD01106 C (NOLOCK) ON C.ROW_ID = B.REF_CMD_ROW_ID          
 JOIN CMM01106 M (NOLOCK) ON C.CM_ID = M.CM_ID          
 JOIN SKU ON SKU.PRODUCT_CODE=C.PRODUCT_CODE      
 JOIN ARTICLE ART ON SKU.ARTICLE_CODE = ART.ARTICLE_CODE          
 JOIN SECTIOND SD ON ART.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
 JOIN SECTIONM SM ON SD.SECTION_CODE = SM.SECTION_CODE        
 JOIN PARA1 P1 ON SKU.PARA1_CODE = P1.PARA1_CODE          
 JOIN PARA2 P2 ON SKU.PARA2_CODE = P2.PARA2_CODE          
 JOIN PARA3 P3 ON SKU.PARA3_CODE = P3.PARA3_CODE          
 JOIN PARA4 P4 ON SKU.PARA4_CODE = P4.PARA4_CODE          
 JOIN PARA5 P5 ON SKU.PARA5_CODE = P5.PARA5_CODE          
 JOIN PARA6 P6 ON SKU.PARA6_CODE = P6.PARA6_CODE          
 JOIN UOM E ON ART.UOM_CODE = E.UOM_CODE       
 LEFT OUTER JOIN JOBS (NOLOCK) ON JOBS.JOB_CODE=G.JOB_CODE          
 LEFT OUTER JOIN EMPLOYEE EMP ON EMP.EMP_CODE=C.EMP_CODE  
 LEFT OUTER JOIN CUSTDYM CUST ON (CUST.CUSTOMER_CODE = M.CUSTOMER_CODE AND M.CUSTOMER_CODE <>'000000000000')  
 OR (CUST.CUSTOMER_CODE = HBM.CUSTOMER_CODE AND ISNULL(HBM.Entry_mode ,0)<>2 )  
 WHERE A.ISSUE_ID = @CWHERE AND ISNULL(HBM.MODE,0)<>2  
   
 UNION  
 SELECT CAST(0 AS BIT) AS CHKBILL, A.ISSUE_NO,A.ISSUE_ID,'' AS CM_NO ,G.*,      
 ART.ARTICLE_CODE, ART.ARTICLE_NO, ART.ARTICLE_NAME,'0000000' AS PARA1_CODE,        
 '' AS PARA1_NAME,'0000000' AS  PARA2_CODE,'' AS PARA2_NAME,'0000000' AS  PARA3_CODE,'' AS PARA3_NAME,  
 UOM_NAME,CODING_SCHEME,CONVERT(NUMERIC(10,2),0) AS QUANTITY_IN_STOCK,0 AS PURCHASE_PRICE,      
 0 AS  MRP,0 AS WS_PRICE,SM.SECTION_NAME, SD.SUB_SECTION_NAME,'0000000' AS PARA4_CODE,'0000000' AS  PARA5_CODE,  
 '0000000' AS PARA6_CODE,'' AS PARA4_NAME,'' AS PARA5_NAME,'' AS PARA6_NAME,E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],        
 ART.DT_CREATED AS [ART_DT_CREATED],'' AS  [PARA3_DT_CREATED],'' AS  [SKU_DT_CREATED],        
 ART.STOCK_NA,JOBS.JOB_CODE,JOBS.JOB_NAME,(G.QUANTITY*G.JOB_RATE) AS AMOUNT,'' AS EMP_CODE,'' AS EMP_NAME ,    
 B.DELIVERY_DT ,(CUST.CUSTOMER_FNAME +' '+ CUST.CUSTOMER_LNAME) AS CUST_NAME,CUST.MOBILE ,  
 ART.ALIAS AS ARTICLE_ALIAS ,'' AS CM_ID      
 FROM POST_SALES_JOBWORK_ISSUE_MST A (NOLOCK)             
 JOIN POST_SALES_JOBWORK_ISSUE_DET  G (NOLOCK)  ON A.ISSUE_ID = G.ISSUE_ID        
 JOIN HOLD_BACK_DELIVER_DET B (NOLOCK) ON G.REF_HBD_ROW_ID = B.ROW_ID  
 JOIN HOLD_BACK_DELIVER_MST HBM (NOLOCK) ON HBM.MEMO_ID=B.MEMO_ID  
 JOIN SKU_REPAIR SKU  ON SKU.PRODUCT_CODE=G.PRODUCT_CODE      
 JOIN ARTICLE ART ON SKU.ARTICLE_CODE = ART.ARTICLE_CODE          
 JOIN SECTIOND SD ON ART.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
 JOIN SECTIONM SM ON SD.SECTION_CODE = SM.SECTION_CODE        
 JOIN UOM E ON ART.UOM_CODE = E.UOM_CODE       
 LEFT OUTER JOIN JOBS (NOLOCK) ON JOBS.JOB_CODE=G.JOB_CODE          
 LEFT OUTER JOIN CUSTDYM CUST ON CUST.CUSTOMER_CODE = HBM.CUSTOMER_CODE  
 WHERE A.ISSUE_ID = @CWHERE  AND HBM.MODE=2         
  
 GOTO LAST         
    
LBLHBDDET:        
	
 SELECT CAST(0 AS BIT) AS CHKBILL,C.CM_ID,M.CM_NO,B.*,C.PRODUCT_CODE,    
  CAST('1.00' AS NUMERIC(10,2)) AS QUANTITY,C.MRP,          
  ART.ARTICLE_CODE, ART.ARTICLE_NO, ART.ARTICLE_NAME, P1.PARA1_CODE,        
  PARA1_NAME, P2.PARA2_CODE,PARA2_NAME,P3.PARA3_CODE,PARA3_NAME,UOM_NAME,           
  CODING_SCHEME,CONVERT(NUMERIC(10,2),0) AS QUANTITY_IN_STOCK,SKU.PURCHASE_PRICE,      
  SKU.MRP,SKU.WS_PRICE,   SM.SECTION_NAME, SD.SUB_SECTION_NAME,        
  P4.PARA4_CODE,P5.PARA5_CODE,P6.PARA6_CODE,        
  PARA4_NAME,PARA5_NAME,PARA6_NAME,E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],        
  ART.DT_CREATED AS [ART_DT_CREATED],P3.DT_CREATED AS [PARA3_DT_CREATED],SKU.DT_CREATED AS [SKU_DT_CREATED],        
  ART.STOCK_NA,EMP.EMP_NAME ,L.JOB_NAME ,0 AS JOB_RATE,  
  M.FIN_YEAR ,(CUST.CUSTOMER_FNAME +' '+ CUST.CUSTOMER_LNAME) AS CUST_NAME,CUST.MOBILE,  
  ART.ALIAS AS ARTICLE_ALIAS        
  FROM HOLD_BACK_DELIVER_MST A (NOLOCK)             
  JOIN HOLD_BACK_DELIVER_DET B (NOLOCK) ON A.MEMO_ID = B.MEMO_ID             
  JOIN CMD01106 C (NOLOCK) ON C.ROW_ID = B.REF_CMD_ROW_ID          
  JOIN CMM01106 M (NOLOCK) ON C.CM_ID = M.CM_ID          
  JOIN SKU ON SKU.PRODUCT_CODE=C.PRODUCT_CODE      
  JOIN ARTICLE ART ON SKU.ARTICLE_CODE = ART.ARTICLE_CODE          
  JOIN SECTIOND SD ON ART.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
  JOIN SECTIONM SM ON SD.SECTION_CODE = SM.SECTION_CODE        
  JOIN PARA1 P1 ON SKU.PARA1_CODE = P1.PARA1_CODE          
  JOIN PARA2 P2 ON SKU.PARA2_CODE = P2.PARA2_CODE          
  JOIN PARA3 P3 ON SKU.PARA3_CODE = P3.PARA3_CODE          
  JOIN PARA4 P4 ON SKU.PARA4_CODE = P4.PARA4_CODE          
  JOIN PARA5 P5 ON SKU.PARA5_CODE = P5.PARA5_CODE          
  JOIN PARA6 P6 ON SKU.PARA6_CODE = P6.PARA6_CODE          
  JOIN UOM E ON ART.UOM_CODE = E.UOM_CODE       
  JOIN JOBS L ON B.JOB_CODE=L.JOB_CODE        
  LEFT OUTER JOIN EMPLOYEE EMP ON EMP.EMP_CODE=C.EMP_CODE       
  LEFT OUTER JOIN CUSTDYM CUST ON (CUST.CUSTOMER_CODE = M.CUSTOMER_CODE AND M.CUSTOMER_CODE <>'000000000000')  
       OR (CUST.CUSTOMER_CODE = A.CUSTOMER_CODE AND ISNULL(A.Entry_mode,0) <>2 )  
  --CHANGE 04-10-12  
  LEFT OUTER JOIN   
  (SELECT REF_HBD_ROW_ID FROM  POST_SALES_JOBWORK_ISSUE_DET A  
   JOIN POST_SALES_JOBWORK_ISSUE_MST B ON A.ISSUE_ID = B.ISSUE_ID  
   WHERE A.PRODUCT_CODE=@CWHERE AND B.CANCELLED=0       
  ) ISU ON B.ROW_ID  = ISU.REF_HBD_ROW_ID  
  
  LEFT OUTER JOIN   
  (SELECT A.REF_HBD_ROW_ID FROM SLS_DELIVERY_DET A (NOLOCK)  
   JOIN SLS_DELIVERY_MST B (NOLOCK) ON B.MEMO_ID = A.MEMO_ID   
   JOIN HOLD_BACK_DELIVER_DET C (NOLOCK) ON C.ROW_ID=A.REF_HBD_ROW_ID  
   WHERE C.PRODUCT_CODE=@CWHERE AND B.CANCELLED=0       
  ) DLV  ON DLV.REF_HBD_ROW_ID=B.ROW_ID  
      
  WHERE  C.PRODUCT_CODE=@CWHERE   
  AND (ISU.REF_HBD_ROW_ID IS NULL OR DLV.REF_HBD_ROW_ID IS NULL)  
  AND  A.CANCELLED = 0 AND B.DELIVERED=0  AND ISNULL(A.MODE,0)<>2  
      
    UNION  
  
 SELECT CAST(0 AS BIT) AS CHKBILL,'' AS CM_ID,'' AS CM_NO,B.*,C.PRODUCT_CODE,    
  CAST('1.00' AS NUMERIC(10,2)) AS QUANTITY,0 AS MRP,          
  ART.ARTICLE_CODE, ART.ARTICLE_NO, ART.ARTICLE_NAME,'0000000' AS PARA1_CODE,        
  '' AS PARA1_NAME,'0000000' AS PARA2_CODE,'' AS PARA2_NAME,'0000000' AS PARA3_CODE,'' AS PARA3_NAME,  
  UOM_NAME,CODING_SCHEME,CONVERT(NUMERIC(10,2),0) AS QUANTITY_IN_STOCK,0 AS PURCHASE_PRICE,      
  0 AS MRP,0 AS WS_PRICE,SM.SECTION_NAME, SD.SUB_SECTION_NAME,'0000000' AS PARA4_CODE,'0000000' AS PARA5_CODE,  
  '0000000'  AS PARA6_CODE,'' AS PARA4_NAME,'' AS PARA5_NAME,'' AS PARA6_NAME,E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],        
  ART.DT_CREATED AS [ART_DT_CREATED],'' AS [PARA3_DT_CREATED],'' AS [SKU_DT_CREATED],        
  ART.STOCK_NA,'' AS EMP_NAME ,L.JOB_NAME ,0 AS JOB_RATE,  
  A.FIN_YEAR ,(CUST.CUSTOMER_FNAME +' '+ CUST.CUSTOMER_LNAME) AS CUST_NAME,CUST.MOBILE,  
  ART.ALIAS AS ARTICLE_ALIAS        
  FROM HOLD_BACK_DELIVER_MST A (NOLOCK)             
  JOIN HOLD_BACK_DELIVER_DET B (NOLOCK) ON A.MEMO_ID = B.MEMO_ID             
  JOIN SKU_REPAIR C ON C.PRODUCT_CODE=B.PRODUCT_CODE      
  JOIN ARTICLE ART ON C.ARTICLE_CODE = ART.ARTICLE_CODE          
  JOIN SECTIOND SD ON ART.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
  JOIN SECTIONM SM ON SD.SECTION_CODE = SM.SECTION_CODE        
  JOIN UOM E ON ART.UOM_CODE = E.UOM_CODE       
  JOIN JOBS L ON B.JOB_CODE=L.JOB_CODE        
  LEFT OUTER JOIN CUSTDYM CUST ON CUST.CUSTOMER_CODE = A.CUSTOMER_CODE  
  LEFT OUTER JOIN (SELECT REF_HBD_ROW_ID   
       FROM POST_SALES_JOBWORK_ISSUE_DET A  
         JOIN POST_SALES_JOBWORK_ISSUE_MST B ON A.ISSUE_ID = B.ISSUE_ID  
       WHERE A.PRODUCT_CODE=@CWHERE AND B.CANCELLED=0       
      ) ISU ON B.ROW_ID  = ISU.REF_HBD_ROW_ID  
  LEFT OUTER JOIN   
  (SELECT A.REF_HBD_ROW_ID FROM SLS_DELIVERY_DET A (NOLOCK)  
   JOIN SLS_DELIVERY_MST B (NOLOCK) ON B.MEMO_ID = A.MEMO_ID   
   JOIN HOLD_BACK_DELIVER_DET C (NOLOCK) ON C.ROW_ID=A.REF_HBD_ROW_ID  
   WHERE C.PRODUCT_CODE=@CWHERE AND B.CANCELLED=0       
  ) DLV  ON DLV.REF_HBD_ROW_ID=B.ROW_ID  
      
  WHERE  C.PRODUCT_CODE=@CWHERE AND (ISU.REF_HBD_ROW_ID IS NULL OR DLV.REF_HBD_ROW_ID IS NULL)  
  AND  A.CANCELLED = 0 AND B.DELIVERED=0 AND ISNULL(A.MODE,0)=2  
        
 -- --------  
    
    
 GOTO LAST         
        
LBLAGENCY:        
    
    SELECT * FROM PRD_AGENCY_MST (NOLOCK) WHERE  INACTIVE = 0 AND AGENCY_NAME <> ''       
 GOTO LAST         
        
LBLAGJOBS:        
 SELECT A.*,B.JOB_RATE ,B.AGENCY_CODE,'' AS ADDRESS_F FROM JOBS (NOLOCK) A JOIN AGENCY_JOBS B (NOLOCK)         
 ON A.JOB_CODE = B.JOB_CODE         
 JOIN PRD_AGENCY_MST C (NOLOCK) ON B.AGENCY_CODE = C.AGENCY_CODE    
 WHERE  B.AGENCY_CODE = @CWHERE         
 GOTO LAST         
        
LBLGRID:        
  SELECT A.ISSUE_NO,G.QUANTITY,G.JOB_RATE,G.ROW_ID,G.REF_HBD_ROW_ID,      
    ART.ARTICLE_CODE, ART.ARTICLE_NO, ART.ARTICLE_NAME, P1.PARA1_CODE,        
 PARA1_NAME, P2.PARA2_CODE,PARA2_NAME,P3.PARA3_CODE,PARA3_NAME,UOM_NAME,           
 CODING_SCHEME,CONVERT(NUMERIC(10,2),0) AS QUANTITY_IN_STOCK,SKU.PURCHASE_PRICE,      
 SKU.MRP,SKU.WS_PRICE,   SM.SECTION_NAME, SD.SUB_SECTION_NAME,        
 P4.PARA4_CODE,P5.PARA5_CODE,P6.PARA6_CODE,        
 PARA4_NAME,PARA5_NAME,PARA6_NAME,E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],        
 ART.DT_CREATED AS [ART_DT_CREATED],P3.DT_CREATED AS [PARA3_DT_CREATED],SKU.DT_CREATED AS [SKU_DT_CREATED],        
 ART.STOCK_NA ,JOBS.JOB_CODE,JOBS.JOB_NAME,ART.ALIAS AS ARTICLE_ALIAS               
    FROM POST_SALES_JOBWORK_ISSUE_MST A (NOLOCK)           
    JOIN POST_SALES_JOBWORK_ISSUE_DET  G (NOLOCK)  ON A.ISSUE_ID = G.ISSUE_ID           
    JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=G.PRODUCT_CODE      
 JOIN ARTICLE ART (NOLOCK) ON SKU.ARTICLE_CODE = ART.ARTICLE_CODE          
 JOIN SECTIOND SD (NOLOCK) ON ART.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
 JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE = SM.SECTION_CODE        
 JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE = P1.PARA1_CODE          
 JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE = P2.PARA2_CODE          
 JOIN PARA3 P3 (NOLOCK)ON SKU.PARA3_CODE = P3.PARA3_CODE          
 JOIN PARA4 P4 (NOLOCK)ON SKU.PARA4_CODE = P4.PARA4_CODE          
 JOIN PARA5 P5 (NOLOCK)ON SKU.PARA5_CODE = P5.PARA5_CODE          
    JOIN PARA6 P6 (NOLOCK)ON SKU.PARA6_CODE = P6.PARA6_CODE          
    JOIN UOM E (NOLOCK)ON ART.UOM_CODE = E.UOM_CODE       
      
  JOIN JOBS  (NOLOCK) ON G.JOB_CODE=JOBS.JOB_CODE          
  WHERE A.ISSUE_ID =@CWHERE              
          
  GOTO LAST        
      
      
LBLCANCELCHECK:    
     
 SELECT Q.ISSUE_ID      
 FROM POST_SALES_JOBWORK_RECEIPT_MST A (NOLOCK)                     
 JOIN POST_SALES_JOBWORK_RECEIPT_DET B (NOLOCK) ON A.RECEIPT_ID = B.RECEIPT_ID        
 JOIN POST_SALES_JOBWORK_ISSUE_DET M (NOLOCK) ON M.ROW_ID = B.REF_ROW_ID     
 JOIN POST_SALES_JOBWORK_ISSUE_MST Q (NOLOCK) ON Q.ISSUE_ID = M.ISSUE_ID     
 WHERE Q.ISSUE_ID = @CWHERE   AND A.CANCELLED = 0     
    
 GOTO LAST    
        
LAST:        
            
END  
*/