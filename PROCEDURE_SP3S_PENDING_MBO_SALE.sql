CREATE PROCEDURE SP3S_PENDING_MBO_SALE
(
	@CBIN_ID  VARCHAR(10)
   ,@DTO_DATE DATETIME	
)
--WITH ENCRYPTION
AS
BEGIN
	SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
	/*
		CREDIT NOTES GENERATED USING THIS DATA CANNOT BE CANCELLED, SO NO NEED TO CONSIDER THE CANCELLED CASE OF 
		CREDIT NOTE.
	*/
	SELECT CONVERT(BIT,1) AS CHK,CMM.CM_ID,CMM.CM_DT,CMM.CM_NO,CMD.PRODUCT_CODE,CMD.QUANTITY
		 ,CMD.MRP AS NET_RATE
		 ,(CMD.QUANTITY*CMD.MRP) AS NET_AMOUNT
	FROM CMM01106 CMM
	JOIN CMD01106 CMD ON CMM.CM_ID=CMD.CM_ID
	JOIN BIN ON CMM.BIN_ID=BIN.BIN_ID
	LEFT JOIN SLS_WSR_LINK SWL ON CMD.CM_ID=SWL.CM_ID
	WHERE CMM.CANCELLED=0 AND SWL.CM_ID IS NULL
	AND BIN.MBO_COUNTER=1 AND CMM.BIN_ID=@CBIN_ID
	AND CMM.CM_DT<=@DTO_DATE
END
--END OF PROCEDURE - SP3S_PENDING_MBO_SALE
