CREATE PROCEDURE SP_GETPRODUCTCODE_WSL
@CUSERCODE	VARCHAR(100),
@NQTY		NUMERIC(10,2),
@CPRODUCTCODE	VARCHAR(MAX),
@cLocID			VARCHAR(5)='',
@nXN_ITEM_TYPE	INT=0
--WITH ENCRYPTION
AS
BEGIN

   SELECT DISTINCT TOP 50 SKU.PRODUCT_CODE,SKU.ARTICLE_CODE,ART.ARTICLE_NO,ART.ARTICLE_NAME,
   P.QUANTITY_IN_STOCK AS [QUANTITY],P.BIN_ID ,SKU.PURCHASE_PRICE AS RATE,SKU.challan_no 
   FROM SKU  (NOLOCK)      
   JOIN PMT01106 P (NOLOCK) ON P.PRODUCT_CODE=SKU.PRODUCT_CODE    
   JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE=SKU.ARTICLE_CODE
   JOIN sectionD SD (NOLOCK) ON SD.sub_section_code=ART.sub_section_code
   JOIN sectionM SM (NOLOCK) ON SD.section_code=Sm.section_code
   LEFT OUTER JOIN BINUSERS LOC (NOLOCK) ON LOC.BIN_ID=P.BIN_ID AND LOC.USER_CODE=@CUSERCODE  
   WHERE  SKU.PRODUCT_CODE<>'' 
   AND (ISNULL(@cLocID,'')='' OR P.DEPT_ID=@cLocID)
   AND (@nXN_ITEM_TYPE=0 OR SM.ITEM_TYPE=@nXN_ITEM_TYPE)
   AND (ART.STOCK_NA=1 OR 
		P.QUANTITY_IN_STOCK>0)  
   AND @CUSERCODE=(CASE WHEN @CUSERCODE='0000000' THEN @CUSERCODE ELSE LOC.USER_CODE END)  
   AND SKU.PRODUCT_CODE LIKE @CPRODUCTCODE  
   --AND ISNULL(ART.INACTIVE,0)= 0
   ORDER BY SKU.PRODUCT_CODE
END
