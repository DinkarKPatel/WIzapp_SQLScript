CREATE PROC VALIDATEXN_PUR_BEFORE_EDIT_PRD 
@CMEMOID VARCHAR(30),
@BCANCELXN BIT,
@CERRORMSG VARCHAR(200) OUTPUT,
@CEXPRERRORMSG VARCHAR(200) OUTPUT
--WITH ENCRYPTION
AS
BEGIN
	
	RETURN
	DECLARE @CTEXT VARCHAR(10),@CPRODUCTCODE VARCHAR(50)
	
	SELECT @CPRODUCTCODE=''
	
	SET @CTEXT=(CASE WHEN @BCANCELXN=1 THEN 'CANCEL' ELSE 'EDIT' END)
	
	IF EXISTS (SELECT TOP 1 MRR_ID FROM PRD_PIM01106 A JOIN VM01106 B ON A.BILL_NO=B.BILL_ID AND A.INV_DT=B.BILL_DT
			   AND A.AC_CODE=B.BILL_AC_CODE WHERE A.MRR_ID=@CMEMOID AND B.BILL_TYPE='PUR' AND  B.CANCELLED=0)
	BEGIN	
		SET @CERRORMSG='THIS BILL HAS BEEN POSTED INTO ACCOUNTS.........CAN NOT '+@CTEXT
		RETURN
	END
		
END
