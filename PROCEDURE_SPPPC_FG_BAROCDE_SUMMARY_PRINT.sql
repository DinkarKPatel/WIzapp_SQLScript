CREATE PROCEDURE SPPPC_FG_BAROCDE_SUMMARY_PRINT
(
 @NQUERYID INT=0,
 @CMEMO_ID VARCHAR(50)='',
 @CROW_ID VARCHAR(100)=''
)
AS
BEGIN
 
 IF @NQUERYID=1
    GOTO LBLBARCODEPRINT
 ELSE 
    GOTO END_PROC
    

    LBLBARCODEPRINT:
    
       IF OBJECT_ID('TEMPDB..#TMPPRODUCT','U') IS NOT NULL
				DROP TABLE #TMPPRODUCT
				      
			SELECT A.MEMO_ID,A.MEMO_NO,A.MEMO_DT,DET.BILL_NO,
			    B.ROW_ID,A.AC_CODE,LM.AC_NAME,
				B.ARTICLE_CODE,ART.ARTICLE_NO ,ART.ARTICLE_NAME ,
				SKU.SIZEGROUP_CODE,SG.SIZEGROUP_NAME ,
				SKU.PARA1_CODE,P1.PARA1_NAME,
				SKU.PARA2_CODE,P2.PARA2_NAME,
				SKU.PARA3_CODE,P3.PARA3_NAME ,
				SKU.PRODUCT_CODE,
				CAST(1  AS INT) AS QUANTITY_IN_STOCK
		    INTO #TMPPRODUCT
			FROM PPC_FGBCG_MST A
			JOIN PPC_FGBCG_DET B ON A.MEMO_ID =B.MEMO_ID 
			JOIN PPC_FG_SKU SKU ON SKU.PPC_FGBCG_DET_ROW_ID=B.ROW_ID 
			JOIN PPC_FG_PMT PMT ON PMT.PRODUCT_CODE =SKU.PRODUCT_CODE 
			JOIN
			(
			  SELECT  B.AC_CODE,A.ARTICLE_CODE ,
				ROW_ID,B.BILL_NO FROM PPC_BUYER_ORDER_DET A
				JOIN PPC_BUYER_ORDER_MST B ON A.ORDER_ID=B.ORDER_ID
				WHERE B.CANCELLED=0
			  GROUP BY B.AC_CODE,A.ARTICLE_CODE ,ROW_ID,B.BILL_NO
			) DET ON DET.ROW_ID=B.BO_DET_ROW_ID 
			JOIN ARTICLE ART ON ART.ARTICLE_CODE =SKU.ARTICLE_CODE 
			JOIN PARA1 P1 ON P1.PARA1_CODE =SKU.PARA1_CODE 
			JOIN PARA2 P2 ON P2.PARA2_CODE =SKU.PARA2_CODE 
			JOIN PARA3 P3 ON P3.PARA3_CODE =SKU.PARA3_CODE 
			JOIN PPC_SIZEGROUP SG ON SG.SIZEGROUP_CODE =SKU.SIZEGROUP_CODE 
			JOIN LM01106 LM ON LM.AC_CODE =A.AC_CODE 
			WHERE A.MEMO_ID=@CMEMO_ID
			AND B.ROW_ID =@CROW_ID
			
			

			SELECT A.BILL_NO ,A.AC_CODE,
				A.AC_NAME,
				A.ARTICLE_CODE,
				A.ARTICLE_NO,
				A.PARA1_CODE,
				A.PARA1_NAME,
				A.SIZEGROUP_CODE,
				A.SIZEGROUP_NAME,
				A.PARA3_CODE,
				A.PARA3_NAME,
				CAST(SUM(QUANTITY_IN_STOCK) AS NUMERIC(10,0)) AS QUANTITY
				FROM #TMPPRODUCT A 
				GROUP BY A.BILL_NO ,A.AC_CODE,
				A.AC_NAME,
				A.ARTICLE_CODE,
				A.ARTICLE_NO,
				A.PARA1_CODE,
				A.PARA1_NAME,
				A.SIZEGROUP_CODE,
				A.SIZEGROUP_NAME,
				A.PARA3_CODE,
				A.PARA3_NAME
				
				
		SELECT A.BILL_NO , A.MEMO_ID,
        ROW_ID=CAST('LATER' AS VARCHAR(40))+CAST(NEWID() AS VARCHAR(100)),
        A.AC_CODE,A.AC_NAME,A.ARTICLE_CODE,
		A.ARTICLE_NO,A.PARA1_CODE,
		A.PARA1_NAME,A.SIZEGROUP_CODE,
		A.SIZEGROUP_NAME,A.PARA3_CODE,A.PARA3_NAME,
        PARA2_CODE,PARA2_NAME,
        CAST(SUM(QUANTITY_IN_STOCK) AS NUMERIC(10,0)) AS QUANTITY
        FROM #TMPPRODUCT A
        GROUP BY A.BILL_NO ,A.MEMO_ID,A.AC_CODE,A.AC_NAME,A.ARTICLE_CODE,
		A.ARTICLE_NO,A.PARA1_CODE,
		A.PARA1_NAME,A.SIZEGROUP_CODE,
		A.SIZEGROUP_NAME,A.PARA3_CODE,A.PARA3_NAME,
        PARA2_CODE,PARA2_NAME
		
      
      
      GOTO END_PROC


	END_PROC:
END
