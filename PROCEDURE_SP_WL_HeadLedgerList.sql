

-- GET ALL SUB SECTIONS  
CREATE PROCEDURE SP_WL_HEADLEDGERLIST  
(  
	@CMAJORHEADCODE VARCHAR(15),
    @CMAJORHEADCODE2 VARCHAR(15) =''
) 
--WITH ENCRYPTION 
AS  
BEGIN  
DECLARE @CHEADCODE VARCHAR(MAX)
SET @CHEADCODE=DBO.FN_ACT_TRAVTREE(@CMAJORHEADCODE)+ DBO.FN_ACT_TRAVTREE(@CMAJORHEADCODE2)
SELECT  LM.ALIAS,LM.AC_CODE, LM.AC_NAME, ISNULL(LMP.CREDIT_DAYS, 0) AS CREDIT_DAYS,   
ISNULL(LMP.DISCOUNT_PERCENTAGE, 0) AS DISCOUNT_PERCENTAGE,  
ISNULL(LMP.ADDRESS0,'') + ' ' + ISNULL(LMP.ADDRESS1,'') + ' ' + ISNULL(LMP.ADDRESS2,'') + ', ' + ISNULL(AREA.AREA_NAME,'') + ' ' + ISNULL(CITY.CITY,'') + ' ' +   
ISNULL(STATE.STATE,'') AS 'SUPP_ADDRESS', AC_NAME AS REPCOLNAME ,LMP.FORM_ID ,ISNULL(F.FORM_NAME,'') AS [FORM_NAME] , LMP.MP_PERCENTAGE, 
LMP.ADDRESS0 , LMP.ADDRESS1 , LMP.ADDRESS2, AREA.AREA_NAME , CITY.CITY ,STATE.STATE ,AREA.PINCODE , LM.ALIAS_TO_BE_SUFFIXED 
,ISNULL(LMP.PUR_CAL_METHOD,1) AS PUR_CAL_METHOD 
FROM LM01106 LM   
LEFT OUTER JOIN LMP01106 LMP   ON LMP.AC_CODE=LM.AC_CODE
LEFT OUTER JOIN FORM F ON F.FORM_ID=LMP.FORM_ID
LEFT OUTER JOIN AREA ON ( LMP.AREA_CODE = AREA.AREA_CODE )  
LEFT OUTER JOIN CITY ON ( AREA.CITY_CODE = CITY.CITY_CODE )  
LEFT OUTER JOIN STATE ON ( CITY.STATE_CODE = STATE.STATE_CODE )  
LEFT OUTER JOIN REGIONM  ON STATE.REGION_CODE = REGIONM.REGION_CODE    
WHERE ( CHARINDEX ( HEAD_CODE, @CHEADCODE ) > 0  OR ALLOW_CREDITOR_DEBTOR = 1 )   
    AND LM.INACTIVE = 0 AND LM.AC_NAME <> '' --AND A.HEAD_CODE = @CMAJORHEADCODE  
ORDER BY LM.AC_NAME  
  --SELECT  A.ALIAS,A.AC_CODE, A.AC_NAME, ISNULL(A.CREDIT_DAYS, 0) AS CREDIT_DAYS,   
  --ISNULL(A.DISCOUNT_PERCENTAGE, 0) AS DISCOUNT_PERCENTAGE,  
  --A.ADDRESS0 + ' ' + A.ADDRESS1 + ' ' + A.ADDRESS2 + ', ' + A.AREA_NAME + ' ' + A.CITY + ' ' +   
  --      A.STATE AS 'SUPP_ADDRESS', AC_NAME AS REPCOLNAME ,A.FORM_ID ,F.FORM_NAME , A.MP_PERCENTAGE, 
  --      A.ADDRESS0 , A.ADDRESS1 , A.ADDRESS2, A.AREA_NAME , A.CITY ,A.STATE ,A.PINCODE , A.ALIAS_TO_BE_SUFFIXED 
  --      FROM LMV01106 A   
  --      JOIN FORM F ON F.FORM_ID=A.FORM_ID
  --      WHERE ( CHARINDEX ( HEAD_CODE, @CHEADCODE ) > 0  OR ALLOW_CREDITOR_DEBTOR = 1 )   
  --              AND A.INACTIVE = 0 AND A.AC_NAME <> '' --AND A.HEAD_CODE = @CMAJORHEADCODE  
  --      ORDER BY A.AC_NAME  
END   
--******************************** END OF PROCEDURE SP_WL_HEADLEDGERLIST

