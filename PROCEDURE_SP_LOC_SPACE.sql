CREATE PROCEDURE SP_LOC_SPACE    
@NQUERYID NUMERIC(2,0),    
@CMEMOID VARCHAR(MAX),    
@CWHERE VARCHAR(MAX),    
@CFINYEAR VARCHAR(5),    
@NNAVMODE NUMERIC(2,0),    
@CDEPTCODE VARCHAR(10)=''    
-- WITH ENCRYPTION
   
AS    
BEGIN      
      
DECLARE @CCMD NVARCHAR(4000)      
DECLARE @CRETCOLSTR NVARCHAR(4000)      
DECLARE  @INT INT          
        
IF @NQUERYID = 1      
GOTO LBLNAVIGATE      
      
ELSE      
IF @NQUERYID = 2      
GOTO LBLGETMASTERS      
      
ELSE      
IF @NQUERYID = 3      
GOTO LBLGETDETAILS      
       
        
ELSE      
GOTO LAST      
      
LBLNAVIGATE:      
      
 EXECUTE SP_NAVIGATE_LOCSPACE 'LOC_SPACE_MST',@NNAVMODE,@CMEMOID,@CFINYEAR,'MEMO_NO','MEMO_DT','MEMO_ID',@CWHERE      
      
GOTO LAST      
      
LBLGETMASTERS:      
      
 SELECT T1.*, T2.USERNAME     
 FROM LOC_SPACE_MST T1      
 JOIN USERS T2 ON T1.USER_CODE = T2.USER_CODE      
 WHERE T1.MEMO_ID = @CMEMOID      
      
GOTO LAST      
      
LBLGETDETAILS:      
  
 SELECT L.DEPT_NAME , CAST(1 AS BIT) AS CHK, A.*         
 FROM LOC_SPACE_DET A  
 JOIN LOCATION L ON L.DEPT_ID=A.DEPT_ID     
 WHERE A.MEMO_ID = @CMEMOID      
          
 GOTO LAST      
      
      
      

LAST:      
END
