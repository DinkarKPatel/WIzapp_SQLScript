CREATE FUNCTION FN_ACT_MONTHLIST   
(   
	@DFROMDT DATETIME,   
	@DTODT DATETIME  
)  
RETURNS @RETMONTH TABLE ( MONTH_NAME VARCHAR(20), YEAR_NO BIGINT, MONTH_NO INT, FIN_YEAR VARCHAR(5), FROM_DT DATETIME, TO_DT DATETIME )  
--WITH ENCRYPTION
AS  
BEGIN  
	-- GETTING NAMES OF ALL MONTHS IN A FIN-YEAR  
	DECLARE @MONTHC TABLE ( MONTH_NAME VARCHAR(20), YEAR_NO BIGINT, MONTH_NO INT, FIN_YEAR VARCHAR(5), FROM_DT DATETIME, TO_DT DATETIME )  
	DECLARE @DTEMPDATE DATETIME  
  
	SET @DTEMPDATE = @DFROMDT  
  
	WHILE @DTEMPDATE <= @DTODT  
	BEGIN  
		INSERT @MONTHC   
		SELECT DATENAME(MM, @DTEMPDATE ) AS MONTH_NAME,   
		DATEPART(YYYY, @DTEMPDATE) AS YEAR_NO,   
		DATEPART(MM, @DTEMPDATE) AS MONTH_NO,  
		--'011'+ CASE WHEN   DATEPART(MM, @DTEMPDATE)<=3 THEN   RIGHT(YEAR(@DTEMPDATE),2)
		--ELSE  RIGHT(YEAR(@DTEMPDATE)+ 1,2)   END  AS FIN_YEAR,
		'01'+DBO.FN_GETFINYEAR(@DTEMPDATE) AS FIN_YEAR,
		@DTEMPDATE AS FROM_DT,  
		DATEADD( DD, -1, DATEADD( MM, 1, @DTEMPDATE)) AS TO_DT  
  
		SET @DTEMPDATE = DATEADD( MM, 1, @DTEMPDATE)   
	END  
 
	INSERT @RETMONTH 
	SELECT * FROM @MONTHC  

	RETURN
END
