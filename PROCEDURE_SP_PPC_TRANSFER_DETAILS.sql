CREATE PROCEDURE SP_PPC_TRANSFER_DETAILS  
(  
 @MEMO_ID VARCHAR(22)  
)  
AS  
BEGIN  
 SELECT   DISTINCT IM.MEMO_NO ,  
               CONVERT (VARCHAR,IM.MEMO_DT ,105) AS MEMO_DT,  
               BM.BILL_NO,  
      BM.REF_NO,  
      LM1.AC_NAME AS BUYER_NAME,   
      LMP.ADDRESS0 +' '+LMP.ADDRESS1 AS BUYER_ADDRESS0,  
      LA.AREA_NAME AS BUYER_AREA_NAME,  
      LC.CITY AS BUYER_CITY,  
      LS.STATE AS BUYER_STATE,  
      '' AS PIN_CODE  
      ,CMP.COMPANY_NAME  
      ,CMP.PIN  
      ,CMP.LOGO_PATH  
      ,CMP.ADDRESS1+ ' '+CMP.ADDRESS2+ ' '+CMP.ADDRESS9 AS COMPANY_ADDRESS  
      ,CA.AREA_NAME AS COMPANY_AREA  
      ,CC.CITY AS COMPANY_CITY  
      ,CS.STATE AS COMPANY_STATE 
      ,LM1.AC_CODE 
    FROM PPC_TRANSFER_TO_TRADING_MST  IM  
    JOIN PPC_TRANSFER_TO_TRADING_DET  ID ON IM.MEMO_ID =ID.MEMO_ID  
    JOIN PPC_FG_SKU SKU ON SKU.PRODUCT_CODE=ID.PRODUCT_CODE  
    JOIN PPC_FGBCG_DET FG1 ON FG1.ROW_ID=SKU.PPC_FGBCG_DET_ROW_ID  
    JOIN PPC_FGBCG_MST FGM ON FGM.MEMO_ID=FG1.MEMO_ID  
    JOIN PPC_BUYER_ORDER_DET BD ON BD.ROW_ID=FG1.BO_DET_ROW_ID  
    JOIN PPC_BUYER_ORDER_MST BM ON BM.ORDER_ID=BD.ORDER_ID  
    JOIN LM01106 LM1 ON LM1.AC_CODE=BM.AC_CODE  
    JOIN LMP01106 LMP ON LMP.AC_CODE =LM1.AC_CODE   
    JOIN AREA LA ON LMP.AREA_CODE = LA.AREA_CODE     
    JOIN CITY LC ON LC.CITY_CODE = LA.CITY_CODE     
    JOIN STATE LS ON LS.STATE_CODE = LC.STATE_CODE  
    LEFT JOIN COMPANY CMP ON CMP.COMPANY_CODE='01'  
          LEFT JOIN AREA CA ON CMP.AREA_CODE=CA.AREA_CODE  
          LEFT JOIN CITY CC ON CA.CITY_CODE=CC.CITY_CODE    
          LEFT JOIN STATE CS ON CC.CITY_CODE=CS.STATE_CODE  
    WHERE IM.MEMO_ID=@MEMO_ID AND IM.CANCELLED=0  
END
