CREATE VIEW VW_COST_SHEET

AS


SELECT B.MEMO_DT,B.MEMO_NO,B.MEMO_ID,B.REF_NO,C.ARTICLE_CODE,C.ARTICLE_NO,
       C.MP_PERCENTAGE ,C.WSP_PERCENTAGE ,C.PURCHASE_PRICE,C.MRP ,C.WHOLESALE_PRICE, 
       (X.BOM_RATE) AS ART_BOM_RATE,(Y.JOB_RATE) AS ART_JOBRATE,
       (JX.BOM_RATE) AS WO_BOM_RATE,(JY.JOB_RATE) AS WO_JOBRATE
FROM PRD_WO_DET A (NOLOCK)
JOIN PRD_WO_MST B (NOLOCK) ON A.MEMO_ID = B.MEMO_ID
JOIN ARTICLE C (NOLOCK) ON A.ARTICLE_CODE = C.ARTICLE_CODE 
 JOIN 
(
	 SELECT ARTICLE_CODE,SUM(AVG_QTY*RATE) AS BOM_RATE
	 FROM ART_BOM (NOLOCK)
	 GROUP BY ARTICLE_CODE
 ) X ON A.ARTICLE_CODE= X.ARTICLE_CODE
 JOIN 
(
	 SELECT ARTICLE_CODE,SUM(JOB_RATE) AS JOB_RATE
	 FROM ART_JOBS (NOLOCK)
	 GROUP BY ARTICLE_CODE
 ) Y ON A.ARTICLE_CODE= Y.ARTICLE_CODE
 
 JOIN 
(
	 SELECT B.ARTICLE_CODE,SUM(AVG_QTY*RATE) AS BOM_RATE
	 FROM PRD_WO_ART_BOM A (NOLOCK)
	 JOIN PRD_WO_DET B (NOLOCK) ON A.REF_ROW_ID = B.ROW_ID 	 
	 GROUP BY ARTICLE_CODE
 ) JX ON A.ARTICLE_CODE= JX.ARTICLE_CODE
 
 JOIN 
(
	 SELECT B.ARTICLE_CODE,SUM(JOB_RATE) AS JOB_RATE
	 FROM PRD_WO_ART_JOBS A (NOLOCK)
	 JOIN PRD_WO_DET B (NOLOCK) ON A.REF_ROW_ID = B.ROW_ID 	 
	 GROUP BY ARTICLE_CODE
 ) JY ON A.ARTICLE_CODE= JY.ARTICLE_CODE
