CREATE PROCEDURE SP3S_INACTIVE_MASTERS
(
	@CTEMPTABLE		VARCHAR(MAX),
	@CTABLENAME		VARCHAR(MAX),
	@CCOLNAME		VARCHAR(MAX),
	@CCOLKEYNAME	VARCHAR(MAX),
	@CWHERE         VARCHAR(100)=''
)
AS
BEGIN
	DECLARE @DTSQL NVARCHAR(MAX)
	SET @DTSQL =N'UPDATE A SET INACTIVE=1
				FROM '+@CTEMPTABLE+' A
				JOIN '+@CTABLENAME+' B ON B.'+@CCOLNAME+'=A.'+@CCOLNAME+
				' WHERE a.INACTIVE=0 and  B.'+@CCOLKEYNAME+'<>A.'+@CCOLKEYNAME +@CWHERE
	PRINT @DTSQL
    EXEC SP_EXECUTESQL @DTSQL
END