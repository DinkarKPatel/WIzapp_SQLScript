CREATE PROCEDURE SP_RESENDXNSDATA  
(  
 @DTFROM VARCHAR(50),  
 @DTTO VARCHAR(50)
)  
--WITH ENCRYPTION
AS  
BEGIN  
   
 DECLARE @CTABLENAME VARCHAR(100),@CMEMODTCOLNAME VARCHAR(50),@CCMD NVARCHAR(MAX)  
   
   
 IF CURSOR_STATUS('GLOBAL','ABC') IN (0,1)  
 BEGIN  
  CLOSE ABC  
  DEALLOCATE ABC  
 END  
    
 DECLARE ABC CURSOR  
 FOR   
 SELECT TABLENAME , MEMODTCOL FROM XNSINFO (NOLOCK)   
 WHERE ISNULL(MEMODTCOL,'')<>''
 ORDER BY XNS_SENDING_ORDER  
   
 OPEN ABC  
   
 FETCH NEXT FROM ABC INTO @CTABLENAME,@CMEMODTCOLNAME  
 WHILE @@FETCH_STATUS=0  
 BEGIN  
   
 SET @CCMD=N'IF EXISTS(SELECT NAME FROM SYSCOLUMNS WHERE NAME='''+@CMEMODTCOLNAME+''' AND ID=OBJECT_ID('''+@CTABLENAME+''')) 
			 BEGIN
				IF EXISTS(SELECT NAME FROM SYSCOLUMNS WHERE NAME=''LAST_UPDATE'' AND ID=OBJECT_ID('''+@CTABLENAME+''')) 
				BEGIN
					UPDATE '+@CTABLENAME+' SET LAST_UPDATE=GETDATE() WHERE '+@CMEMODTCOLNAME +' BETWEEN '''+@DTFROM +''' AND '''+ @DTTO+'''
				END
			 END'  
 PRINT @CCMD  
 EXECUTE SP_EXECUTESQL @CCMD  
   
 FETCH NEXT FROM ABC INTO @CTABLENAME,@CMEMODTCOLNAME  
 END  
 CLOSE ABC  
 DEALLOCATE ABC  
END  
--********************************************** END OF PROCEDURE SP_RESENDXNSDATA
