CREATE PROCEDURE SP3S_INV_ORD_PLAN_EXPORT
(
	@CMEMOID VARCHAR(50)=''
)
AS
BEGIN
	--DECLARE @CMEMOID VARCHAR(50)
	--SET @CMEMOID='H1011230000H1HI-000001'
	;with MST
	AS
	(
		SELECT D.USERNAME AS 'CREATED_USERNAME', E.USERNAME AS 'MODIFIED_USERNAME',       
		  C.AC_NAME AS SUPP_NAME,C.ADDRESS0+' '+ C.ADDRESS1 + ' ' + C.ADDRESS2 + ', ' + C.AREA_NAME +       
		  ' ' + C.CITY + ' ' + C.STATE AS 'SUPP_ADDRESS',  A.* ,C.MRP_CALC_MODE , C.ALIAS AS SUP_ALIAS,    
			 BIN.BIN_NAME,C.MP_PERCENTAGE AS SUP_MP_PERCENTAGE ,
			 '' AS TERMS  
		 FROM ORD_PLAN_MST A  (NOLOCK)    
		 JOIN LMV01106 C (NOLOCK) ON A.AC_CODE = C.AC_CODE      
		 JOIN USERS D (NOLOCK) ON A.USER_CODE = D.USER_CODE      
		 JOIN USERS E (NOLOCK) ON A.EDT_USER_CODE = E.USER_CODE     
		 JOIN BIN (NOLOCK) ON BIN.BIN_ID = A.BIN_ID             
		 WHERE A.MEMO_ID = @CMEMOID  
	)
	,DET
	AS
	(
		SELECT K.SECTION_NAME, J.SUB_SECTION_NAME, I.uom_type,I.uom_code,I.uom_name, C.PARA1_NAME,PC.PRODUCT_CODE AS UPC, A.TRADING_PRODUCT_CODE AS PRODUCT_CODE,         
		 D.PARA2_NAME,E.PARA3_NAME,F.PARA4_NAME,G.PARA5_NAME,H.PARA6_NAME,B.ARTICLE_NO,         
		 B.ARTICLE_NAME, B.CODING_SCHEME, A.*,A.PURCHASE_PRICE * A.QUANTITY AS 'AMOUNT'  ,      
		 B.GEN_EAN_CODES,D.PARA2_ORDER, B.SIZE_RATE_DIFF ,B.SIZE_CENTER_POINT,     
		 A.QUANTITY AS [ORG_QUANTITY],B.STOCK_NA,B.FIX_PRICE_ARTICLE, B.ALIAS AS ARTICLE_ALIAS  ,
		 A.PURCHASE_PRICE AS GROSS_PURCHASE_PRICE,B.DISCOUNT_PERCENTAGE ,B.DISCOUNT_AMOUNT ,0 AS BOX_NO,
		 AT1.attr1_key_name,AT2.attr2_key_name,AT3.attr3_key_name,AT4.attr4_key_name,AT5.attr5_key_name,AT6.attr6_key_name,
	     AT7.attr7_key_name,AT8.attr8_key_name,AT9.attr9_key_name,AT10.attr10_key_name,AT11.attr11_key_name,AT12.attr12_key_name,
	     AT13.attr13_key_name,AT14.attr14_key_name,AT15.attr15_key_name,AT16.attr16_key_name,AT17.attr17_key_name,AT18.attr18_key_name,
	     AT19.attr19_key_name,AT20.attr20_key_name,AT21.attr21_key_name,AT22.attr22_key_name,AT23.attr23_key_name,AT24.attr24_key_name,
		 AT25.attr25_key_name ,SP2.SizeInches,SP2.SizeCms
		 FROM ORD_PLAN_DET A (NOLOCK)   
		 LEFT OUTER JOIN ORD_PLAN_BARCODE_DET PC (NOLOCK) ON PC.REFROW_ID=A.ROW_ID
		 JOIN ARTICLE B (NOLOCK) ON A.ARTICLE_CODE = B.ARTICLE_CODE         
		 JOIN PARA1 C (NOLOCK) ON A.PARA1_CODE = C.PARA1_CODE        
		 JOIN PARA2 D (NOLOCK) ON A.PARA2_CODE = D.PARA2_CODE        
		 JOIN PARA3 E (NOLOCK) ON A.PARA3_CODE = E.PARA3_CODE        
		 JOIN PARA4 F (NOLOCK) ON A.PARA4_CODE = F.PARA4_CODE        
		 JOIN PARA5 G (NOLOCK) ON A.PARA5_CODE = G.PARA5_CODE        
		 JOIN PARA6 H (NOLOCK) ON A.PARA6_CODE = H.PARA6_CODE        
		 JOIN UOM I (NOLOCK) ON B.UOM_CODE = I.UOM_CODE        
		 JOIN SECTIOND J (NOLOCK) ON B.SUB_SECTION_CODE = J.SUB_SECTION_CODE        
		 JOIN SECTIONM K (NOLOCK) ON J.SECTION_CODE = K.SECTION_CODE 
		 LEFT OUTER JOIN SECTIONDPARA2 SP2(NOLOCK) ON SP2.SUB_SECTION_CODE=j.SUB_SECTION_CODE AND d.PARA2_CODE=SP2.PARA2_CODE
		 LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON b.ARTICLE_CODE = ATTR.ARTICLE_CODE 
		LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
		LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
		LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
		LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
		LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
		LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
		LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
		LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
		LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
		LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
		LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
		LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
		LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
		LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
		LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
		LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
		LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
		LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
		LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
		LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
		LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
		LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
		LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
		LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
		LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE   
		 WHERE A.MEMO_ID = @CMEMOID  
	)
	SELECT 
	A.CREATED_USERNAME AS [CREATED_BY],A.MODIFIED_USERNAME AS [MODFIED_BY],A.SUPP_NAME AS [SUPPLIER_NAME],A.SUPP_ADDRESS AS [SUPPLIER_ADDRESS]
	,A.REMARKS,A.MEMO_NO,A.MEMO_DT,A.TOTAL_AMOUNT,A.SUBTOTAL,A.CANCELLED,A.TOTAL_QUANTITY_STR,A.TOTAL_QUANTITY,A.JOB_START_DT,A.SUP_ALIAS,A.SUP_MP_PERCENTAGE,
	A.TERMS,
	B.section_name,B.sub_section_name,B.uom_name,B.para1_name,B.PRODUCT_CODE,B.para2_name,B.para3_name,B.para4_name,B.para5_name,B.para6_name,
	B.article_no,B.article_name,B.ARTICLE_ALIAS,B.ORG_QUANTITY AS QUANTITY,CAST(1 AS NUMERIC(5,2)) AS BARCODE_QUANTITY,B.PURCHASE_PRICE,B.GROSS_PURCHASE_PRICE,B.MRP,B.MP_PERCENTAGE,B.WHOLESALE_PRICE,
	B.WSP_PERCENTAGE,B.HSN_CODE,B.AMOUNT,B.discount_amount,B.discount_percentage,
	B.attr1_key_name,B.attr2_key_name,B.attr3_key_name,B.attr4_key_name,B.attr5_key_name,B.attr6_key_name,
	B.attr7_key_name,B.attr8_key_name,B.attr9_key_name,B.attr10_key_name,B.attr11_key_name,b.attr12_key_name,
	B.attr13_key_name,B.attr14_key_name,B.attr15_key_name,B.attr16_key_name,B.attr17_key_name,b.attr18_key_name,
	B.attr19_key_name,B.attr20_key_name,B.attr21_key_name,B.attr22_key_name,B.attr23_key_name,b.attr24_key_name,
    B.attr25_key_name ,SizeInches,SizeCms
	FROM MST A
	JOIN DET B ON B.MEMO_ID=A.MEMO_ID
END