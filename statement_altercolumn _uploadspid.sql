
DECLARE @CCMD NVARCHAR(MAX),@CTABLENAME VARCHAR(100),
@CCONSTRAINTNAME VARCHAR(200),@CCOLUMNNAME VARCHAR(100)

IF OBJECT_ID ('TEMPDB..#TMPTABLE','U') IS NOT NULL
   DROP TABLE #TMPTABLE

SELECT TABLE_NAME ,COLUMN_NAME  ,IS_NULLABLE 
INTO #TMPTABLE
FROM INFORMATION_SCHEMA.COLUMNS WHERE COLUMN_NAME='SP_ID'
AND DATA_TYPE<>'VARCHAR' 
AND ( LEFT(TABLE_NAME ,5) IN('PSJWI','PSJWR','PSDLV')
OR LEFT(TABLE_NAME ,6) IN('WSLORD')
OR LEFT(TABLE_NAME ,3) IN('DSM','JWI','JWR','CNC','PTC','PCI','PCO','BCO')
)
AND TABLE_NAME NOT LIKE 'WSLORD_PPC%'
AND RIGHT(TABLE_NAME,6)='UPLOAD'

IF OBJECT_ID ('TEMPDB..#TMPONSTRAINT','U') IS NOT NULL
   DROP TABLE #TMPONSTRAINT

SELECT OBJ_TABLE.NAME      AS  TABLE_NAME, 
        COLUMNS.NAME        AS COLUMN_NAME,
        OBJ_CONSTRAINT.NAME AS CONSTRAINT_NAME,
        OBJ_CONSTRAINT.TYPE AS 'TYPE'
 INTO #TMPONSTRAINT
 FROM   SYS.OBJECTS OBJ_TABLE 
 JOIN SYS.OBJECTS OBJ_CONSTRAINT 
       ON OBJ_TABLE.OBJECT_ID = OBJ_CONSTRAINT.PARENT_OBJECT_ID 
 JOIN SYS.SYSCONSTRAINTS CONSTRAINTS 
       ON CONSTRAINTS.CONSTID = OBJ_CONSTRAINT.OBJECT_ID 
 JOIN SYS.COLUMNS COLUMNS 
        ON COLUMNS.OBJECT_ID = OBJ_TABLE.OBJECT_ID 
 AND COLUMNS.COLUMN_ID = CONSTRAINTS.COLID 
 JOIN #TMPTABLE TMP ON TMP.TABLE_NAME =OBJ_TABLE.NAME  AND TMP.COLUMN_NAME =COLUMNS.NAME
 WHERE OBJ_CONSTRAINT.TYPE='D'

 WHILE EXISTS (SELECT TOP 1  'U' FROM #TMPONSTRAINT)
 BEGIN
     SELECT TOP 1  @CTABLENAME=TABLE_NAME ,@CCONSTRAINTNAME=CONSTRAINT_NAME  FROM #TMPONSTRAINT 

     SET @CCMD='ALTER TABLE '+@CTABLENAME +' DROP CONSTRAINT '+@CCONSTRAINTNAME
	 PRINT @CCMD
	 EXEC SP_EXECUTESQL @CCMD

	 DELETE FROM #TMPONSTRAINT WHERE TABLE_NAME=@CTABLENAME AND CONSTRAINT_NAME=@CCONSTRAINTNAME

 END

 SET @CTABLENAME=''

 WHILE EXISTS (SELECT TOP 1 'U' FROM #TMPTABLE)
 BEGIN
       SELECT TOP 1  @CTABLENAME=TABLE_NAME ,@CCOLUMNNAME=COLUMN_NAME  FROM #TMPTABLE 

     SET @CCMD='ALTER TABLE '+@CTABLENAME +' ALTER COLUMN '+@CCOLUMNNAME +' VARCHAR(50)'
	 PRINT @CCMD
	 EXEC SP_EXECUTESQL @CCMD

	 DELETE FROM #TMPTABLE WHERE TABLE_NAME=@CTABLENAME AND COLUMN_NAME=@CCOLUMNNAME


 END
 