
CREATE PROCEDURE SP_PRODUCTION_STATUS_REPORT_WO_UPC    
(    
 @DASON AS DATETIME='2020-01-14',    
 @CARTICLE_CODE VARCHAR(MAX)='',    
 @CAC_CODE VARCHAR(MAX)='',    
 @MERCHANT_CODE VARCHAR(MAX)='',    
 @CAC_CODE_NOTIN VARCHAR(10)='',    
 @NSUMMARY INT=0 ,
 @NPENDING_WO INT=0  ,
 @CARTICLE_NO_CONTAINING VARCHAR(MAX)='' 
)    
AS    
BEGIN    
    
DECLARE @DTSQL NVARCHAR(MAX),@CART_STATUS VARCHAR(MAX),@AAC_STATUS VARCHAR(MAX),    
        @CMERCHANTSTATUS VARCHAR(MAX)
    

    
IF @CARTICLE_CODE=''    
BEGIN    
   SET @CART_STATUS=''    
   SET @CARTICLE_CODE='IN('''')'    
END    
ELSE     
BEGIN    
   SET @CART_STATUS='LATER'    
END    
    
IF @CAC_CODE=''    
BEGIN    
   SET @AAC_STATUS=''    
   SET @CAC_CODE='IN('''')'    
END    
ELSE     
BEGIN    
   SET @AAC_STATUS='LATER'    
END    
    
    
IF @MERCHANT_CODE=''    
BEGIN    
   SET @CMERCHANTSTATUS=''    
   SET @MERCHANT_CODE='IN('''')'    
END    
ELSE     
BEGIN    
   SET @CMERCHANTSTATUS='LATER'    
END    
    
    
----BUYER ORDER AGEAINST WORK ORDER    
--IF @CARTICLE_NO_CONTAINING<>''
--SET @CARTICLE_NO_CONTAINING=' AND '+ @CARTICLE_NO_CONTAINING  
      
	IF OBJECT_ID ('TEMPDB..#TMPDETAILS','U') IS NOT NULL  
		DROP TABLE #TMPDETAILS  
	        
      
     SELECT ISNULL(BD.ITEM_EMP_CODE,'') AS MERCHANT_CODE ,
	          ISNULL(EMP.EMP_NAME,'') AS MERCHANT,
	          ART.ARTICLE_CODE ,ART.ARTICLE_NO,
	          P1.PARA1_CODE ,P1.PARA1_NAME ,
	          P2.PARA2_CODE ,P2.PARA2_NAME,
	          LM.AC_CODE,LM.AC_NAME ,
	          ISNULL(BM.ORDER_ID ,'') AS ORDER_ID,
	          ISNULL(BM.ORDER_NO ,'') AS ORDER_NO,
	          ISNULL(BM.ORDER_DT ,'') AS ORDER_DT,
	          ISNULL(BM.DELIVERY_DT ,'') AS DELIVERY_DT,
	          DATEDIFF(DAY,BM.DELIVERY_DT,GETDATE()) AS DTD ,
	          BD.ITEM_EMP_CODE AS SALE_EMP_CODE,  
              ISNULL(EMP.EMP_NAME,'')  AS EMP_NAME ,
              CAST(ISNULL(BD.QUANTITY,0) AS NUMERIC(10,0)) AS  QTY,
              CAST(ISNULL(PMT1.QUANTITY_IN_STOCK,0) AS NUMERIC(10,0)) AS QUANTITY_IN_STOCK,
              CAST(0 AS NUMERIC(10,0)) AS WPS_QTY,
              CAST(0 AS NUMERIC(10,0)) AS DLVRD,
              CAST(0 AS NUMERIC(10,0)) AS PENDING_WSL,
              0 AS TYPE,
              OM.MEMO_ID AS MEMO_ID,
              CAST(OD.QUANTITY AS NUMERIC(10,0)) AS WO,
              CAST(0 AS NUMERIC(10,0)) AS WIP_STOCK,
              ISNULL(PMT.QUANTITY_IN_STOCK,0) AS JWPMT_STOCK,
              OM.MEMO_NO AS WO_NO,
              OM.MEMO_DT AS WO_DT,
              CAST(0 AS NUMERIC(10,0)) AS PENDING,
              PMT.JOB_CODE,
              CAST('' AS VARCHAR(100)) AS JOB_NAME,
              OBD.PRODUCT_CODE,
              CAST(0 AS NUMERIC(10,0)) AS TTM_QTY,
              CAST(0 AS NUMERIC(10,0)) AS XN_QTY,
              CAST(0 AS NUMERIC(10,0)) AS ISSUE_QTY,
              CAST(0 AS NUMERIC(10,0)) AS CANCELLED
        INTO #TMPDETAILS
	   FROM ORD_PLAN_MST OM (NOLOCK)
	   JOIN ORD_PLAN_DET OD (NOLOCK) ON OM.MEMO_ID =OD.MEMO_ID 
	   JOIN ORD_PLAN_BARCODE_DET OBD (NOLOCK) ON OBD.REFROW_ID =OD.ROW_ID 
	   LEFT JOIN JOBWORK_PMT PMT (NOLOCK) ON OBD.PRODUCT_CODE =PMT.PRODUCT_CODE AND OM.DEPT_ID =PMT.DEPT_ID 
	   LEFT JOIN BUYER_ORDER_DET BD (NOLOCK) ON BD.ROW_ID =OD.WOD_ROW_ID  
	   LEFT JOIN BUYER_ORDER_MST BM (NOLOCK ) ON BM.ORDER_ID=ISNULL(PMT.ORDER_ID , BD.ORDER_ID   )
	   LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =ISNULL(BM.AC_CODE ,OM.AC_CODE ) 
	   JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE =OBD.PRODUCT_CODE   
	   JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE =SKU.ARTICLE_CODE   
	   JOIN PARA1 P1 (NOLOCK) ON P1.PARA1_CODE =SKU.PARA1_CODE   
	   JOIN PARA2 P2 (NOLOCK) ON P2.PARA2_CODE=SKU.PARA2_CODE 
	   LEFT JOIN EMPLOYEE EMP (NOLOCK) ON EMP.EMP_CODE =BD.ITEM_MERCHANT_CODE  
	   LEFT JOIN EMPLOYEE EMP1 (NOLOCK) ON EMP1.EMP_CODE =BD.ITEM_EMP_CODE
	   LEFT JOIN PMT01106 PMT1 (NOLOCK) ON PMT1.PRODUCT_CODE=OBD.PRODUCT_CODE AND OM.DEPT_ID=PMT1.DEPT_ID  
	   WHERE ISNULL(BM.CANCELLED,0)=0  AND ISNULL(OM.CANCELLED,0)=0 
	   and 1=2
  
     
	SET @DTSQL=N'   SELECT ISNULL(EMP.EMP_CODE,'''') AS MERCHANT_CODE ,
	          ISNULL(EMP.EMP_NAME,'''') AS MERCHANT,
	          OD.ARTICLE_CODE ,SKU.ARTICLE_NO,
	          OD.PARA1_CODE ,SKU.PARA1_NAME ,
	          OD.PARA2_CODE ,SKU.PARA2_NAME,
	          LM.AC_CODE,LM.AC_NAME ,
	          ISNULL(BM.ORDER_ID ,'''') AS ORDER_ID,
	          ISNULL(BM.ORDER_NO ,'''') AS ORDER_NO,
	          ISNULL(BM.ORDER_DT ,'''') AS ORDER_DT,
	          ISNULL(BM.DELIVERY_DT ,'''') AS DELIVERY_DT,
	          DATEDIFF(DAY,BM.DELIVERY_DT,GETDATE()) AS DTD ,
	          BD.ITEM_EMP_CODE AS SALE_EMP_CODE,  
              ISNULL(EMP.EMP_NAME,'''')  AS EMP_NAME ,
              ISNULL(BD.QUANTITY,0) AS  QTY,
              ISNULL(PMT1.QUANTITY_IN_STOCK,0) AS QUANTITY_IN_STOCK,
              CAST(0 AS NUMERIC(10,0)) AS WPS_QTY,
              CAST(0 AS NUMERIC(10,0)) AS DLVRD,
              CAST(0 AS NUMERIC(10,0)) AS PENDING_WSL,
              0 AS TYPE,
              OM.MEMO_ID AS MEMO_ID,
              CAST(0 AS NUMERIC(10,0)) AS WO,
              CAST(0 AS NUMERIC(10,0)) AS WIP_STOCK,
              ISNULL(PMT.QUANTITY_IN_STOCK,0) AS JWPMT_STOCK,
              OM.MEMO_NO AS WO_NO,
              OM.MEMO_DT AS WO_DT,
              CAST(0 AS NUMERIC(10,0)) AS PENDING,
              CAST('''' AS VARCHAR(100)) AS JOB_CODE,
              CAST('''' AS VARCHAR(100)) AS JOB_NAME,
              OBD.PRODUCT_CODE,
              CAST(0 AS NUMERIC(10,0)) AS TTM_QTY,
              CAST(1 AS NUMERIC(10,0)) AS XN_QTY,
              CAST(0 AS NUMERIC(10,0)) AS ISSUE_QTY,
              CAST(0 AS NUMERIC(10,0)) AS CANCELLED
	   FROM 
	   ORD_PLAN_MST OM (NOLOCK)
	   JOIN ORD_PLAN_DET OD (NOLOCK) ON OM.MEMO_ID =OD.MEMO_ID 
	   JOIN ORD_PLAN_BARCODE_DET OBD (NOLOCK) ON OBD.REFROW_ID =OD.ROW_ID 
	   JOIN JOBWORK_PMT PMT (NOLOCK) ON OBD.PRODUCT_CODE =PMT.PRODUCT_CODE AND OM.DEPT_ID =PMT.DEPT_ID 
	   JOIN SKU_NAMES SKU (NOLOCK) ON SKU.PRODUCT_CODE =PMT.PRODUCT_CODE 
	    JOIN BUYER_ORDER_DET BD (NOLOCK) ON BD.ROW_ID =OD.WOD_ROW_ID  
	    JOIN BUYER_ORDER_MST BM (NOLOCK ) ON BM.ORDER_ID=ISNULL(PMT.ORDER_ID , BD.ORDER_ID   )
	   JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =ISNULL(BM.AC_CODE ,OM.AC_CODE ) 
	   LEFT JOIN EMPLOYEE EMP (NOLOCK) ON EMP.EMP_CODE =ISNULL(PMT.ITEM_MERCHANT_CODE,BD.ITEM_MERCHANT_CODE  )
	   LEFT JOIN EMPLOYEE EMP1 (NOLOCK) ON EMP1.EMP_CODE = BD.ITEM_EMP_CODE
	   LEFT JOIN PMT01106 PMT1 (NOLOCK) ON PMT1.PRODUCT_CODE=OBD.PRODUCT_CODE AND OM.DEPT_ID=PMT1.DEPT_ID  
	   WHERE ISNULL(BM.CANCELLED,0)=0  AND ISNULL(OM.CANCELLED,0)=0 
	   and isnull(bm.Short_close,0)=0
	  -- and bm.order_id=''0101120000000101000280''
	   AND isnull(BM.ORDER_DT,om.memo_dt)<='''+CONVERT(VARCHAR(11),@DASON,120)+''' 
	   AND ('''+RTRIM(LTRIM(@CART_STATUS))+'''='''' OR OD.ARTICLE_CODE '+@CARTICLE_CODE+')      
       AND ('''+RTRIM(LTRIM(@AAC_STATUS))+'''='''' OR LM.AC_CODE '+@CAC_CODE+')       
       AND ('''+RTRIM(LTRIM(@CAC_CODE_NOTIN))+'''='''' OR LM.AC_CODE<>'''+@CAC_CODE_NOTIN+''')
       '+@CARTICLE_NO_CONTAINING+ ' '
	    PRINT @DTSQL
	   INSERT INTO #TMPDETAILS
	   EXEC SP_EXECUTESQL @DTSQL
	   
	   -- JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE =OBD.PRODUCT_CODE   
	   --JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE =SKU.ARTICLE_CODE   
	   --JOIN PARA1 P1 (NOLOCK) ON P1.PARA1_CODE =SKU.PARA1_CODE   
	   --JOIN PARA2 P2 (NOLOCK) ON P2.PARA2_CODE=SKU.PARA2_CODE  

	  
	 --sos8037
	   
	   UPDATE A SET WPS_QTY =ISNULL(B.QUANTITY,0),
	         DLVRD =ISNULL(C.QUANTITY,0)
	   FROM #TMPDETAILS A
	   LEFT JOIN
	   (
	    SELECT A.PRODUCT_CODE ,A.QUANTITY  
	    FROM WPS_DET A (NOLOCK)
	    JOIN WPS_MST B (NOLOCK)  ON A.PS_ID=B.PS_ID 
	    WHERE B.CANCELLED =0
	    AND ISNULL(B.WSL_INV_ID,'')<>''
	   ) B ON A.PRODUCT_CODE=B.PRODUCT_CODE 
	   LEFT JOIN
	   (
	    SELECT  A.PRODUCT_CODE ,A.QUANTITY  
	    FROM IND01106  A (NOLOCK)
	    JOIN INM01106  B (NOLOCK)  ON A.INV_ID=B.INV_ID 
	    WHERE B.CANCELLED =0
	    
	   ) C ON A.PRODUCT_CODE =C.PRODUCT_CODE  
	   
	   
	   UPDATE A SET TTM_QTY=B.QUANTITY
	   FROM #TMPDETAILS A
	   JOIN
	   (
	    SELECT A.DEPT_ID , B.PRODUCT_CODE ,B.QUANTITY  
	    FROM TRANSFER_TO_TRADING_MST   A (NOLOCK)
	    JOIN TRANSFER_TO_TRADING_DET   B (NOLOCK)  ON A.MEMO_ID =B.MEMO_ID 
	    WHERE A.CANCELLED =0
	   ) B ON A.PRODUCT_CODE=B.PRODUCT_CODE 
	  
	  
	    UPDATE #TMPDETAILS SET PENDING_WSL =XN_QTY -DLVRD 
	    
        DELETE FROM #TMPDETAILS WHERE PENDING_WSL=0
         
    
	    --UPDATE A SET WO =A.JWPMT_STOCK  
	    --FROM #TMPDETAILS A
	    --LEFT JOIN JOBWORK_ISSUE_DET B ON A.PRODUCT_CODE =B.PRODUCT_CODE 
	    --LEFT  JOIN JOBWORK_ISSUE_MST C ON B.ISSUE_ID =C.ISSUE_ID 
	    --WHERE ISNULL(C.CANCELLED ,0)=0 AND C.ISSUE_ID IS NULL
	    
	    UPDATE A SET WO =A.JWPMT_STOCK  
	    FROM #TMPDETAILS A
	    LEFT JOIN 
	    (
	    select product_code from JOBWORK_ISSUE_DET B
	    JOIN JOBWORK_ISSUE_MST C ON B.ISSUE_ID =C.ISSUE_ID 
	     where c.cancelled =0 
	    ) b on a.PRODUCT_CODE =b.product_code 
	    WHERE  b.product_code IS NULL
	    
	    UPDATE A SET WIP_STOCK =A.JWPMT_STOCK  
	    FROM #TMPDETAILS A
	    JOIN JOBWORK_ISSUE_DET B ON A.PRODUCT_CODE =B.PRODUCT_CODE 
	    JOIN JOBWORK_ISSUE_MST C ON B.ISSUE_ID =C.ISSUE_ID 
	    WHERE ISNULL(C.CANCELLED ,0)=0 
	    
	    
	    update a set cancelled =b.quantity  from #TMPDETAILS a
	    join icd01106 b on a.PRODUCT_CODE =b.product_code 
	    join icm01106 icm on icm.cnc_memo_id =b.cnc_memo_id 
	    where icm.cancelled =0 and cnc_type =1
	  
	  
	    
	     IF OBJECT_ID ('TEMPDB..#TMPORDER_WO','U') IS NOT NULL  
		   DROP TABLE #TMPORDER_WO  
	    
	    SELECT A.MERCHANT_CODE ,A.MERCHANT,A.ARTICLE_CODE ,ARTICLE_NO ,A.PARA1_CODE,A.PARA1_NAME ,
	           A.PARA2_CODE,A.PARA2_NAME,A.AC_CODE ,A.AC_NAME ,A.ORDER_ID ,A.ORDER_NO ,A.ORDER_DT ,A.DELIVERY_DT ,
	           A.DTD ,A.SALE_EMP_CODE ,A.EMP_NAME ,
	           sum(A.xn_QTY) as QTY,
	           SUM(QUANTITY_IN_STOCK) AS QUANTITY_IN_STOCK,
	           SUM(WPS_QTY) AS  WPS_QTY,
	           SUM(DLVRD) AS  DLVRD,
	           SUM(PENDING_WSL ) AS  PENDING_WSL,
	           A.TYPE,A.MEMO_ID ,
	           SUM(A.WO) AS  WO,
	           SUM(A.WIP_STOCK) AS WIP_STOCK,
	           A.WO_NO ,A.WO_DT,
	           SUM(cancelled) as cancelled
	    into #TMPORDER_WO 
	    FROM #TMPDETAILS A
	    GROUP BY A.MERCHANT_CODE ,A.MERCHANT,A.ARTICLE_CODE ,ARTICLE_NO ,A.PARA1_CODE,A.PARA1_NAME ,
	    A.PARA2_CODE,A.PARA2_NAME,A.AC_CODE ,A.AC_NAME ,A.ORDER_ID ,A.ORDER_NO ,A.ORDER_DT ,A.DELIVERY_DT ,
	    A.DTD ,A.SALE_EMP_CODE ,A.EMP_NAME , A.TYPE,A.MEMO_ID ,A.WO_NO ,A.WO_DT
	
	
	    
	   ;with CTE as
	   (
	    SELECT A.ORDER_ID,A.MEMO_ID ,A.ARTICLE_CODE,A.PARA1_CODE,A.PARA2_CODE , B.ISSUE_ID , A.PRODUCT_CODE ,B.JOB_CODE,B.QUANTITY AS ISSUE_QTY,
	    SR=ROW_NUMBER() OVER ( PARTITION BY  A.PRODUCT_CODE ORDER BY ISSUE_DT desc,ISSUE_TIME DESC ,c.ISSUE_ID DESC)
	    FROM #TMPDETAILS A
	    JOIN JOBWORK_ISSUE_DET B ON A.PRODUCT_CODE =B.PRODUCT_CODE 
	    JOIN JOBWORK_ISSUE_MST C ON B.ISSUE_ID =C.ISSUE_ID 
	    WHERE C.CANCELLED =0  AND ISNULL(WIP_STOCK,0)=0  AND ISNULL(TTM_QTY,0)=0
	    )

	   
	    UPDATE B SET JOB_CODE =JOBS.JOB_CODE ,
	    JOB_NAME =JOBS.JOB_NAME ,
	    ISSUE_QTY =a.ISSUE_QTY 
	    FROM CTE A
	    JOIN #TMPDETAILS B ON A.PRODUCT_CODE =B.PRODUCT_CODE 
	    JOIN JOBS (NOLOCK) ON JOBS.JOB_CODE =A.JOB_CODE 
	    WHERE SR=1
	    
	    
	
	    
	  
    
	 
	  DECLARE @CCOLNAME VARCHAR(MAX),@CDISPCOLNAME VARCHAR(MAX),@CJOB_QTY VARCHAR(MAX) ,@CFILTERCOLNAME VARCHAR(MAX),  
			   @CFILTER VARCHAR(MAX)   
	  SET @CCOLNAME=''    
	  SET @CDISPCOLNAME=''   
	  SET @CJOB_QTY=''   
	    
	  SET @CFILTERCOLNAME=''  
	  SET @CFILTER=''  
	      
	  IF OBJECT_ID('TEMPDB..#TMPJOBMST','U') IS NOT NULL    
	  DROP TABLE #TMPJOBMST    
	  
	  SELECT DISTINCT JOB_NAME,JOB_CODE INTO #TMPJOBMST 
	  FROM #TMPDETAILS  where isnull(ISSUE_QTY    ,0)<>0
	      
	  SELECT   @CCOLNAME=ISNULL(@CCOLNAME+',','')+'SUM(CASE WHEN JOB_NAME= '''+(JOB_NAME) + ''' THEN ISSUE_QTY ELSE 0 END) AS '+QUOTENAME(JOB_NAME)    
	  FROM #TMPJOBMST    
	  WHERE JOB_NAME<>''   
	    
		 --  
		 SELECT   @CFILTER=ISNULL(@CFILTER+',','')+'(SELECT TOP 1 JOB_CODE FROM JOBS WHERE JOB_NAME='''+(JOB_NAME) + ''') AS '+QUOTENAME(JOB_NAME+'_1')    
	  FROM #TMPJOBMST    
	  WHERE JOB_NAME<>''   
	      
		 ----  
	      
	  SELECT   @CDISPCOLNAME=ISNULL(@CDISPCOLNAME+',','') + 'ISNULL('+QUOTENAME(JOB_NAME)+',0) AS '+QUOTENAME(JOB_NAME)    
	  FROM #TMPJOBMST    
	  WHERE JOB_NAME<>''    
	  IF @CCOLNAME IS NULL  
	  SET @CCOLNAME=''  
	      
	  SELECT   @CJOB_QTY=ISNULL(@CJOB_QTY+'','') + '+ISNULL('+QUOTENAME(JOB_NAME)+',0)  '  
	  FROM #TMPJOBMST    
	  WHERE JOB_NAME<>''  
	    
	   
	  IF @CCOLNAME IS NULL  
	 SET @CCOLNAME=''  
	  --  
	  IF @CCOLNAME<>''    
	  SET @CCOLNAME=' '+@CCOLNAME    
	      
	  IF @CDISPCOLNAME<>''    
	  SET @CDISPCOLNAME=' '+@CDISPCOLNAME  
	    
	  IF @CJOB_QTY<>''  
	  BEGIN  
	  SET @CJOB_QTY=' '+@CJOB_QTY    
	  END  
	  ELSE  
	  BEGIN  
		  SET @CJOB_QTY='0'  
	  END  
	  SET @CFILTER=SUBSTRING(@CFILTER,2,LEN(@CFILTER))  
	    
	  IF ISNULL(@CFILTER,'')<>''  
	  SET @CFILTER=','+@CFILTER  
	
	    
      SET @DTSQL=N'SELECT CASE WHEN MERCHANT='''' THEN U.USERNAME ELSE MERCHANT END  AS MERCHANT ,
	  A.*,  
	 --PENDING=CASE WHEN ISNULL(MST.ORDER_STATUS,0)<>1  THEN QTY-ISNULL(DLVRD,0) ELSE 0 END,  
	 PENDING=QTY-ISNULL(DLVRD,0), 
	 CASE WHEN DTD>0 THEN 1 ELSE 0 END AS TYPE    
	 '+@CDISPCOLNAME+'    
	 '+@CFILTER+'  
	 FROM #TMPORDER_WO A    
	 LEFT JOIN BUYER_ORDER_MST MST ON MST.ORDER_ID=A.ORDER_ID 
	 left JOIN USERS U ON U.USER_CODE=MST.USER_CODE 
	 LEFT OUTER JOIN     
	 (    
	  SELECT A.ORDER_ID,A.MEMO_ID ,A.ARTICLE_CODE,A.PARA1_CODE,A.PARA2_CODE ,a.merchant_code    
	  '+@CCOLNAME+'    
	  FROM #TMPDETAILS A    
	  GROUP BY A.ORDER_ID,A.MEMO_ID ,A.ARTICLE_CODE,A.PARA1_CODE,A.PARA2_CODE ,a.merchant_code    
	     
	 ) B ON A.ORDER_ID=B.ORDER_ID    
	 AND A.ARTICLE_CODE=B.ARTICLE_CODE    
	 AND A.PARA1_CODE=B.PARA1_CODE    
	 AND A.PARA2_CODE=B.PARA2_CODE 
	 AND A.MEMO_ID=B.MEMO_ID 
	 and a.merchant_code=b.merchant_code    
	 WHERE ('''+RTRIM(LTRIM(@CMERCHANTSTATUS))+'''='''' OR CASE WHEN A.MERCHANT_CODE='''' THEN U.USER_CODE ELSE A.MERCHANT_CODE END '+@MERCHANT_CODE+')  
	 AND  ('''+RTRIM(LTRIM(STR(@NPENDING_WO)))+'''=''0'' OR A.WO >0)  
	 and a.pending_wsl<>a.cancelled
     --and a.order_no=''0101000269''
	 ORDER BY A.ARTICLE_NO, ORDER_DT,ORDER_NO,A.WO_DT,A.WO_NO
	 '    
	 --ORDER_DT,ORDER_NO, MST1.MEMO_DT,MST1.MEMO_NO
	     
	 PRINT @DTSQL    
	 EXEC SP_EXECUTESQL @DTSQL  
	   
	

 
 END_PROC:
  
END