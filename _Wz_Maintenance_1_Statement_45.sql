

IF NOT EXISTS (SELECT CONFIG_OPTION FROM CONFIG WHERE  CONFIG_OPTION='UPDATE_TOTAL_QUANTITY_PO_WPS' AND VALUE=1)
BEGIN
	PRINT 'UPDATE TOTAL QUANTITY COL IN POM,WPS'
	
  -- UPDATING TOTALS IN POM TABLE  
  UPDATE A SET TOTAL_QUANTITY=B.INVOICE_QUANTITY  
  FROM POM01106 A 
  JOIN  
  (    
	   SELECT PO_ID, SUM(QUANTITY) AS INVOICE_QUANTITY
	   FROM POD01106   
	   GROUP BY PO_ID    
  ) B ON  A.PO_ID = B.PO_ID    
  WHERE ISNULL(A.TOTAL_QUANTITY,0)<> ISNULL(B.INVOICE_QUANTITY,0)
  
  
  ---UPDATING TOTALS IN WPS TABLE  
  UPDATE A SET TOTAL_QUANTITY=B.INVOICE_QUANTITY  
  FROM WPS_MST A 
  JOIN  
  (    
	   SELECT PS_ID, SUM(QUANTITY) AS INVOICE_QUANTITY
	   FROM WPS_DET   
	   GROUP BY PS_ID    
  ) B ON  A.PS_ID = B.PS_ID    
  WHERE ISNULL(A.TOTAL_QUANTITY,0)<> ISNULL(B.INVOICE_QUANTITY,0)
  
  

	IF NOT EXISTS (SELECT CONFIG_OPTION FROM CONFIG WHERE  CONFIG_OPTION='UPDATE_TOTAL_QUANTITY_PO_WPS')
		INSERT CONFIG (CONFIG_OPTION,VALUE,ROW_ID,LAST_UPDATE)
			   VALUES ('UPDATE_TOTAL_QUANTITY_PO_WPS',1,'',GETDATE())	
	ELSE
		UPDATE CONFIG SET VALUE='1' WHERE CONFIG_OPTION='UPDATE_TOTAL_QUANTITY_PO_WPS'
	
END		
