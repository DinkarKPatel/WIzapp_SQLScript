create PROC VALIDATEXN_SNC_BEFORE_EDIT 
@CMEMOID VARCHAR(30),
@BCANCELXN BIT,
@CERRORMSG VARCHAR(200) OUTPUT,
@CEXPRERRORMSG VARCHAR(200) OUTPUT
--WITH ENCRYPTION
AS
BEGIN
	
	DECLARE @CTEXT VARCHAR(10),@CPRODUCTCODE VARCHAR(50)
	
	SELECT @CPRODUCTCODE=''
	
	SET @CTEXT=(CASE WHEN @BCANCELXN=1 THEN 'CANCEL' ELSE 'EDIT' END)
	
	IF EXISTS (SELECT TOP 1 A.MEMO_ID 
			   FROM SNC_MST A 
			   JOIN SNC_DET B ON A.MEMO_ID=B.MEMO_ID 
			   JOIN WIP_PMT C ON C.XN_ROW_ID=B.ROW_ID
			   JOIN JOBWORK_ISSUE_DET D ON C.WIP_UID=D.WIP_UID
			   JOIN JOBWORK_ISSUE_MST E ON E.ISSUE_ID=D.ISSUE_ID
			   WHERE A.MEMO_ID=@CMEMOID AND A.CANCELLED=0 AND E.CANCELLED=0 AND C.JOB_CODE='0000000' )
	BEGIN	
		SET @CERRORMSG='ONE OR MORE REFERENCES OF THIS MEMO IS FOUND INTO JOB WORK ISSUE.........CAN NOT '+@CTEXT
		RETURN
	END

	IF EXISTS (SELECT TOP 1 A.MEMO_ID FROM SNC_MST A WHERE A.MEMO_ID=@CMEMOID and TTM_MEMO_ID<>'' )
	BEGIN	
		SET @CERRORMSG='The reference is Transfer to Trading. You have to cancel the Transfer to Trading memo'
		RETURN
	END


		
END
