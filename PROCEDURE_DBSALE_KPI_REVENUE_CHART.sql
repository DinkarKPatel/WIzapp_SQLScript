CREATE PROCEDURE DBSALE_KPI_REVENUE_CHART(@USER_CODE VARCHAR(7)='',@LOC VARCHAR(MAX)='',@DT VARCHAR(10))
AS
BEGIN    
   SET NOCOUNT ON
   SELECT PERIOD[WeekDtl],PD_TYPE [Week],SUM(CONVERT(FLOAT,REVENUE))REVENUE
   FROM DBSALE_KPI_DYNAMIC_DATA (NOLOCK) 
   WHERE REP_SCRIPT='DBSALE_KPI_REVENUE_CHART' 
   AND DT=@DT
   AND (@LOC='' OR DEPT_ID IN (SELECT CODE FROM DBO.FN_SPLIT_VALUE(@LOC)))
   GROUP BY PERIOD,PD_TYPE
   ORDER BY 1,CONVERT(INT,REPLACE(PD_TYPE,'W',''))
   SET NOCOUNT OFF
END--PROCEDURE DBSALE_KPI_REVENUE_CHART