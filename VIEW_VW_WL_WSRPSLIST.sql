CREATE VIEW VW_WL_WSRPSLIST      
  
AS       
SELECT t1.location_Code,  T3.AC_NAME AS SUPPLIER_NAME,    
CASE WHEN T1.PS_MODE=1  THEN 'PARTY DEBIT NOTE' WHEN T1.PS_MODE=2 THEN 'GROUP DEBIT NOTE' ELSE '' END AS MEMO_MODE,     
T1.PS_DT AS MEMO_DT, T1.PS_NO AS MEMO_NO,              
T1.REMARKS ,       
(CASE WHEN T1.CANCELLED = 1 THEN 0 ELSE ISNULL(T2.TOTAL_QUANTITY,0) END) AS TOTAL_QUANTITY,         
T1.PS_ID AS MEMO_ID,    
(CASE WHEN T1.CANCELLED = 1 THEN 'CANCELLED' ELSE '' END) AS CANCELLED  ,    
T1.FIN_YEAR  ,COM.COMPANY_CODE,  
L.DEPT_ID  AS LOC_ID,L.DEPT_NAME AS LOC_NAME,
u.username as USERNAME,
u1.username as EDT_USERNAME
FROM CNPS_MST T1      
JOIN LMV01106 T3 ON T3.AC_CODE = T1.AC_CODE 
JOIN USERS U (NOLOCK) ON T1.user_code=U.user_code       
LEFT OUTER JOIN       
(SELECT PS_ID,SUM(QUANTITY) AS TOTAL_QUANTITY   
 FROM CNPS_DET GROUP BY PS_ID)     
 T2 ON T2.PS_ID=T1.PS_ID     
 LEFT OUTER JOIN COMPANY COM ON 1=1 AND COM.COMPANY_CODE='01'    
 LEFT OUTER JOIN LOCATION  L (NOLOCK) ON T1.location_code/*LEFT(T1.PS_ID,2)*//*Rohit 05-11-2024*/ = L.DEPT_ID 
 LEFT OUTER JOIN users u1 ON T1.EDT_USER_CODE=U1.user_code    