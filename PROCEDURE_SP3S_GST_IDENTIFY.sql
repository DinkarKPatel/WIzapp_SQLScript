create PROCEDURE SP3S_GST_IDENTIFY
(
  @CXN_TYPE VARCHAR(100)='',
  @CPARTY_STATE_CODE VARCHAR(2)='',
  @CPARTY_GST_NO VARCHAR(100)='',
  @CSOURCE_DEPT_ID VARCHAR(5)='',
  @NPARTY_REGISTERED INT=0
)
AS
BEGIN
--1 L0CAL 2 INTERSATE 3 DELIVERY CHALLAN

--SELECT @CXN_TYPE AS X,
--  @CPARTY_STATE_CODE PS,
--  @CPARTY_GST_NO PG,
--  @CSOURCE_DEPT_ID SD,
--  @NPARTY_REGISTERED AS PR
--  INTO TMPS
  
  
    
    DECLARE @CLOCREGISTERD INT,@CLOCGSTNNO VARCHAR(100),@CCURSTAECODE VARCHAR(2)
    SELECT @CLOCGSTNNO=LOC_GST_NO,@CLOCREGISTERD =REGISTERED_GST,@CCURSTAECODE=GST_STATE_CODE   FROM LOCATION WHERE DEPT_ID=@CSOURCE_DEPT_ID
    
    IF @CXN_TYPE='WSL'
    BEGIN
      
		   IF ISNULL(@CLOCREGISTERD,0) IN(0,2)
		   BEGIN
			   SELECT 3 AS GST_TYPE
			   GOTO END_PROC
		   END
		   ELSE IF ISNULL(@CLOCREGISTERD,0) IN(1)
		   BEGIN
	          
			  IF ISNULL(@CCURSTAECODE,'')<>ISNULL(@CPARTY_STATE_CODE,'')
			  BEGIN
				   SELECT 2 AS GST_TYPE
				   GOTO END_PROC
			  END
			  ELSE IF ISNULL(@CCURSTAECODE,'')=ISNULL(@CPARTY_STATE_CODE,'') AND ISNULL(@CLOCGSTNNO,'')=ISNULL(@CPARTY_GST_NO,'')
			  BEGIN
				  SELECT 3 AS GST_TYPE
				  GOTO END_PROC
	          
			  END
			  ELSE
			  BEGIN
				  SELECT 1 AS GST_TYPE
				  GOTO END_PROC
	          
			  END
	       
		   END
 
    END
    ELSE IF @CXN_TYPE IN('PUR','PRT','WSR','FCN')
    BEGIN
    
  
		      IF ISNULL(@NPARTY_REGISTERED,0) IN(0,2)
			   BEGIN
				   SELECT 3 AS GST_TYPE
				   GOTO END_PROC
			   END
			   ELSE IF ISNULL(@NPARTY_REGISTERED,0) IN(1)
			   BEGIN
		   
				  IF ISNULL(@CCURSTAECODE,'')<>ISNULL(@CPARTY_STATE_CODE,'')
				  BEGIN
					   SELECT 2 AS GST_TYPE
					   GOTO END_PROC
				  END
				  ELSE IF ISNULL(@CCURSTAECODE,'')=ISNULL(@CPARTY_STATE_CODE,'') AND ISNULL(@CLOCGSTNNO,'')=ISNULL(@CPARTY_GST_NO,'')
				  BEGIN
					  SELECT 3 AS GST_TYPE
					  GOTO END_PROC
		          
				  END
				  ELSE
				  BEGIN
					  SELECT 1 AS GST_TYPE
					  GOTO END_PROC
		          
				  END
		       
			   END
    
    
    END
    

END_PROC:

END
