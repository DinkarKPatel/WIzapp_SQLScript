CREATE PROCEDURE SP3S_DR_REMINDER (@ACCODE VARCHAR(100),@MONTH INT)
AS
BEGIN
SET NOCOUNT ON
DECLARE @FROM_DT DATE,@TILL_DT DATE
SET @FROM_DT=CAST(YEAR(GETDATE()) AS VARCHAR)+'-'+RIGHT('00'+CAST(@MONTH AS VARCHAR),2)+'-01'
SET @TILL_DT=DATEADD(MM,1,@FROM_DT)
SET @TILL_DT=DATEADD(DD,-1*DAY(@TILL_DT),@TILL_DT)
IF OBJECT_ID('TEMPDB..#DAYS','U') IS NULL
   CREATE TABLE #DAYS(DT DATETIME)
DELETE #DAYS  
WHILE @FROM_DT<=@TILL_DT
 BEGIN
    INSERT #DAYS SELECT @FROM_DT
    SET @FROM_DT=DATEADD(DD,1,@FROM_DT)
 END
SELECT T2.DISABLE_AUTO_REMINDER,T1.DT AR_DT,T1.MOBILE,T1.E_MAIL,T2.T_NAME,T2.SEND_MAIL,T2.T_ID,T2.STMT_CUT_OFF_DT,T2.SEND_LEDGER_AS_ATTACHMENT,T2.SEND_SMS,@ACCODE AC_CODE,T2.PROCESSED,T2.ERR_MSG,T2.LAST_UPDATE,CAST(NEWID()AS VARCHAR(MAX))ROW_ID
FROM
(
SELECT #DAYS.DT,A.* 
FROM #DAYS 
,(SELECT LMV.AC_CODE,LMV.MOBILE,LMV.E_MAIL FROM LMV01106 LMV (NOLOCK) WHERE LMV.AC_CODE=@ACCODE)A
)T1
LEFT JOIN (SELECT R.*,S.T_NAME FROM DR_AUTO_REMINDER R (NOLOCK) JOIN SMS_TEMPLATES S (NOLOCK) ON R.T_ID=S.T_ID
)T2 ON T1.DT=T2.AR_DT AND T1.AC_CODE=T2.AC_CODE
SET NOCOUNT OFF
END
