CREATE PROCEDURE SP_GETCITYDETAILS_FROM_WIZCLIP
@CCITYCODE CHAR(12),
@CERRMSG VARCHAR(1000) OUTPUT
--WITH ENCRYPTION
AS
BEGIN
		
	BEGIN TRY
		
		DECLARE @BCITYVALID BIT,@DSTARTTIME DATETIME,@DLASTCHECKTIME DATETIME,@CFILTERCONDITION VARCHAR(200),
		@CAREATABLENAME VARCHAR(50),@CCMD NVARCHAR(MAX),@NSTEP INT,@CLOCATIONID CHAR(2),@CAREACODE CHAR(7)
		,@CNEXTAREACODE CHAR(7),@CTEMPTABLE VARCHAR(100),@CERRORPROCNAME VARCHAR(100),@CLINENO VARCHAR(5),@CERRTEXT VARCHAR(MAX)
		
		
		SELECT @CERRMSG=''
		
		SET @NSTEP=10
			
		SET @CTEMPTABLE='TMP_CAMPAIGN_CITY_'+LTRIM(RTRIM(STR(@@SPID)))
								
		SET @CCMD=N'IF OBJECT_ID('''+@CTEMPTABLE+''',''U'') IS NOT NULL
						DROP TABLE '+@CTEMPTABLE+'
						
						SELECT * INTO '+@CTEMPTABLE+' FROM CAMPAIGN_CITY WHERE CITY_CODE='''+@CCITYCODE+''''
		EXEC SP_EXECUTESQL @CCMD				
		
		SET @NSTEP=90
		
		SET @CCMD=N'UPDATE '+@CTEMPTABLE+' SET AREA_CODE=CITY_CODE, AREA_NAME=CITY,INACTIVE=1'			
		EXEC SP_EXECUTESQL @CCMD
		
		SET @NSTEP=115
				 
		EXEC UPDATECAMPAIGNCITY @CERRMSG OUTPUT			
		
		SET @NSTEP=120			
		
		IF ISNULL(@CERRMSG,'')=''
			DELETE FROM CAMPAIGN_CITY WHERE CITY_CODE=@CCITYCODE
		
		SET @NSTEP=130
		
	END TRY
	
	BEGIN CATCH
					
		SELECT @CERRORPROCNAME=ISNULL(ERROR_PROCEDURE(),'NULL P'),@CLINENO=ISNULL(LTRIM(RTRIM(STR(ERROR_LINE()))),'NULL LINE'),
		@CERRTEXT=ISNULL(ERROR_MESSAGE(),'NULL MSG')
		

		SELECT @CERRMSG='STEP :'+ISNULL(LTRIM(RTRIM(STR(@NSTEP))),0)+' LINE NO. :'+@CLINENO+' MSG :'+@CERRTEXT
		
				
	END CATCH
		
END
------ 'END OF CREATING PROCEDURE SP_GETCITYDETAILS_FROM_WIZCLIP'
