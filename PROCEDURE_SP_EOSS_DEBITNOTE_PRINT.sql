CREATE PROCEDURE SP_EOSS_DEBITNOTE_PRINT
(
   @CMEMO_ID VARCHAR(50)='',
   @CTABLENAME VARCHAR(100)=''
)
AS
BEGIN
    
   DECLARE  @DTSQL NVARCHAR(MAX)
    IF ISNULL(@CTABLENAME,'')=''
    BEGIN
     SELECT A.MEMO_NO ,CONVERT(VARCHAR,A.MEMO_DT,105) AS MEMO_DT,A.MEMO_ID ,A.FILTER,A.AC_CODE,D.AC_NAME AS SUPPLIER,
            CASE WHEN A.MEMO_TYPE =1 THEN 'AGAINST EOSS OPENING STOCK'  ELSE 'AGAINST EOSS DISCOUNTS' END AS EOSS_TYPE,
            CONVERT(VARCHAR,A.PERIOD_FROM ,105) AS PERIOD_FROM,CONVERT(VARCHAR,A.PERIOD_TO,105) AS PERIOD_TO,
            B.PRODUCT_CODE ,B.CM_NO,B.CM_DT ,B.QUANTITY,E.UOM_NAME ,B.MRP,B.VALUE_AT_MRP,0 as DISCOUNT_PERCENTAGE ,
            B.DISCOUNT_AMOUNT,VAT_PERC='',VAT=0,NET=CONVERT(NUMERIC(18,2),(QUANTITY *B.MRP)),
            ART.ARTICLE_NO,SD.SUB_SECTION_NAME,SM.SECTION_NAME,
            P1.PARA1_NAME ,P2.PARA2_NAME ,P3.PARA3_NAME ,P4.PARA4_NAME ,P5.PARA5_NAME ,P6.PARA6_NAME,
            ART.ALIAS AS ARTICLE_ALIASA,A.MEMO_TYPE,
            A.CANCELLED,CONVERT(NUMERIC(10,2),A.VENDOR_PER) AS VENDOR_PER,A.VENDOR_AMOUNT      
     FROM EOSSDNM A (NOLOCK)
     JOIN EOSSDND B (NOLOCK) ON A.MEMO_ID =B.MEMO_ID 
     JOIN LM01106 D (NOLOCK) ON A.AC_CODE =D.AC_CODE 
     JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE =B.PRODUCT_CODE 
     JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE =SKU.ARTICLE_CODE 
     JOIN SECTIOND SD ON ART.SUB_SECTION_CODE =SD.SUB_SECTION_CODE
     JOIN SECTIONM SM ON SD.SECTION_CODE =SM.SECTION_CODE 
     JOIN PARA1 P1 (NOLOCK) ON P1.PARA1_CODE =SKU.PARA1_CODE 
     JOIN PARA2 P2 (NOLOCK) ON P2.PARA2_CODE =SKU.PARA2_CODE 
     JOIN PARA3 P3 (NOLOCK) ON P3.PARA3_CODE =SKU.PARA3_CODE 
     JOIN PARA4 P4 (NOLOCK) ON P4.PARA4_CODE =SKU.PARA4_CODE 
     JOIN PARA5 P5 (NOLOCK) ON P5.PARA5_CODE =SKU.PARA5_CODE 
     JOIN PARA6 P6 (NOLOCK) ON P6.PARA6_CODE =SKU.PARA6_CODE 
     JOIN UOM E  (NOLOCK) ON ART.UOM_CODE = E.UOM_CODE 
     WHERE A.MEMO_ID=@CMEMO_ID
     END
     ELSE
     BEGIN
     SET @DTSQL=N'IF OBJECT_ID('''+@CTABLENAME+''',''U'') IS NOT NULL
                      DROP TABLE '+@CTABLENAME+''
          PRINT @DTSQL
		  EXEC SP_EXECUTESQL @DTSQL     
     
     SET @DTSQL=N'SELECT A.MEMO_NO ,CONVERT(VARCHAR,A.MEMO_DT,105) AS MEMO_DT,A.MEMO_ID ,A.FILTER,A.AC_CODE,D.AC_NAME AS SUPPLIER,
						  CASE WHEN A.MEMO_TYPE =1 THEN ''AGAINST EOSS DOCUMENTS''  ELSE ''AGAINST EOSS OPENING STOCK'' END AS EOSS_TYPE,
						  CONVERT(VARCHAR,A.PERIOD_FROM ,105) AS PERIOD_FROM,CONVERT(VARCHAR,A.PERIOD_TO,105) AS PERIOD_TO,
						  B.PRODUCT_CODE ,B.CM_NO,B.CM_DT ,B.QUANTITY,E.UOM_NAME ,B.MRP,B.VALUE_AT_MRP,0 as DISCOUNT_PERCENTAGE ,
						  B.DISCOUNT_AMOUNT,VAT_PERC='''',VAT=0,NET=CONVERT(NUMERIC(18,2),(QUANTITY *B.MRP)),
						  ART.ARTICLE_NO,SD.SUB_SECTION_NAME,SM.SECTION_NAME,
						  P1.PARA1_NAME ,P2.PARA2_NAME ,P3.PARA3_NAME ,P4.PARA4_NAME ,P5.PARA5_NAME ,P6.PARA6_NAME,
						  ART.ALIAS AS ARTICLE_ALIAS,A.MEMO_TYPE ,A.CANCELLED,CONVERT(NUMERIC(10,2),A.VENDOR_PER) AS VENDOR_PER,A.VENDOR_AMOUNT     
						  INTO '+@CTABLENAME+'    
					 FROM EOSSDNM A (NOLOCK)
					 JOIN EOSSDND B (NOLOCK) ON A.MEMO_ID =B.MEMO_ID 
					 JOIN LM01106 D (NOLOCK) ON A.AC_CODE =D.AC_CODE 
					 JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE =B.PRODUCT_CODE 
					 JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE =SKU.ARTICLE_CODE 
					 JOIN SECTIOND SD ON ART.SUB_SECTION_CODE =SD.SUB_SECTION_CODE
					 JOIN SECTIONM SM ON SD.SECTION_CODE =SM.SECTION_CODE 
					 JOIN PARA1 P1 (NOLOCK) ON P1.PARA1_CODE =SKU.PARA1_CODE 
					 JOIN PARA2 P2 (NOLOCK) ON P2.PARA2_CODE =SKU.PARA2_CODE 
					 JOIN PARA3 P3 (NOLOCK) ON P3.PARA3_CODE =SKU.PARA3_CODE 
					 JOIN PARA4 P4 (NOLOCK) ON P4.PARA4_CODE =SKU.PARA4_CODE 
					 JOIN PARA5 P5 (NOLOCK) ON P5.PARA5_CODE =SKU.PARA5_CODE 
					 JOIN PARA6 P6 (NOLOCK) ON P6.PARA6_CODE =SKU.PARA6_CODE 
					 JOIN UOM E  (NOLOCK) ON ART.UOM_CODE = E.UOM_CODE 
					 WHERE A.MEMO_ID='''+@CMEMO_ID+''''
		PRINT @DTSQL
		EXEC SP_EXECUTESQL @DTSQL
     
     
     END

END
