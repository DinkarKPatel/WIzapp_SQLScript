CREATE PROCEDURE SP_GETPRODUCTCODE_JOBWORK_PMT
@NARTICLE_PRD_MODE INT=1,--1 FOR INDIVISUAL 2 FOR (SET & COMPONENT)
@CUSERCODE	VARCHAR(100),
@NQTY		NUMERIC(10,2),
@CPRODUCTCODE	VARCHAR(MAX)
----WITH ENCRYPTION
AS
BEGIN
   
   
   SELECT DISTINCT TOP 50 SKU.PRODUCT_CODE,SKU.ARTICLE_CODE,P.QUANTITY_IN_STOCK AS [QUANTITY],P.BIN_ID  
   FROM SKU  (NOLOCK)      
   JOIN JOBWORK_PMT P (NOLOCK) ON P.PRODUCT_CODE=SKU.PRODUCT_CODE    
   JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE=SKU.ARTICLE_CODE
   LEFT OUTER JOIN BINUSERS LOC (NOLOCK) ON LOC.BIN_ID=P.BIN_ID AND LOC.USER_CODE=@CUSERCODE  
   WHERE  SKU.PRODUCT_CODE<>''   
   AND (ART.STOCK_NA=1 OR 
		P.QUANTITY_IN_STOCK>0)  
   --AND @CUSERCODE=(CASE WHEN @CUSERCODE='0000000' THEN @CUSERCODE ELSE LOC.USER_CODE END)  
   AND SKU.PRODUCT_CODE LIKE @CPRODUCTCODE  
   AND ISNULL(ART.INACTIVE,0)= 0
   AND ((@NARTICLE_PRD_MODE=1 AND ART.ARTICLE_PRD_MODE=1) OR (@NARTICLE_PRD_MODE=2 AND ART.ARTICLE_PRD_MODE IN(2,3) ) ) 
   ORDER BY SKU.PRODUCT_CODE
END
