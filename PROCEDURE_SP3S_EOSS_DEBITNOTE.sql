CREATE PROCEDURE SP3S_EOSS_DEBITNOTE
	@NQUERYID		NUMERIC(5),
	@CWHERE		VARCHAR(MAX),
	@CFINYEAR			VARCHAR(5)='',  
	@NNAVMODE			NUMERIC(2)=1,  
	@CWIZAPPUSERCODE	VARCHAR(10)='',
	@CREFMEMONO			VARCHAR(20)=''
AS
BEGIN

IF @NQUERYID=1 
GOTO NAV
ELSE IF @NQUERYID=2 
GOTO MST
ELSE IF @NQUERYID=3 
GOTO DET

NAV:
	EXECUTE SP_NAVIGATE 'EOSSDNM',@NNAVMODE,@CREFMEMONO,@CFINYEAR,'MEMO_NO','MEMO_DT','MEMO_ID',@CWHERE,0  
	GOTO SSPL
MST:
	SELECT A.*,B.AC_NAME,C.USERNAME,X.DISCOUNT_AMOUNT,X.QUANTITY,X.VALUE_AT_MRP,
	ISNULL(PURCHASE_AGAINST_TERMS,0) AS PURCHASE_AGAINST_TERMS,
	B1.ADDRESS1 ,B1.ADDRESS2 ,B1.ADDRESS0 AS [ADDRESS9] ,'' AS [ADDRESS],a.ref_fdn_memoid REFMEMOID,
	RMM.RM_ID,RMM.RM_NO,TE.NAME,TE.D_FILTER,LM.AC_NAME AS T_AC_NAME
	FROM EOSSDNM A
	JOIN 
	(
		SELECT MEMO_ID,SUM(QUANTITY) AS QUANTITY , SUM(MRP * QUANTITY) AS [VALUE_AT_MRP],
		SUM(DISCOUNT_AMOUNT) AS [DISCOUNT_AMOUNT]
		FROM EOSSDND WHERE MEMO_ID=@CWHERE GROUP BY MEMO_ID
	)X ON X.MEMO_ID=A.MEMO_ID
	JOIN LM01106 B ON B.AC_CODE=A.AC_CODE
	JOIN LMP01106 B1 ON B.AC_CODE=B1.AC_CODE
	JOIN USERS C ON C.USER_CODE=B.USER_CODE
	LEFT OUTER JOIN RMM01106 RMM ON 'FDN'+RMM.rm_id=a.ref_fdn_memoid AND rmm.CANCELLED=0
	LEFT OUTER JOIN TBL_EOSS_DISC_SHARE_MST TE ON TE.ID=A.ID
	LEFT OUTER JOIN LM01106 LM ON TE.AC_CODE=LM.AC_CODE
	WHERE A.MEMO_ID=@CWHERE
	GOTO SSPL	
DET:
	SELECT DET.* , 0 as srno,ARTICLE_NO,article_no as ARTICLE_NAME,
    PARA1_NAME, PARA2_NAME, PARA3_NAME, '' as UOM_NAME,       
    1 as  CODING_SCHEME, 0 as INACTIVE,  
    pp as PURCHASE_PRICE,  SKU.MRP AS SKU_MRP,SKU.WS_PRICE, SECTION_NAME, SUB_SECTION_NAME,    
    PARA4_NAME,PARA5_NAME,PARA6_NAME,
    '' as HSN_CODE,'' as GST_PERCENTAGE,0 as IGST_AMOUNT,0 as CGST_AMOUNT,
    0 as SGST_AMOUNT,0 as XN_VALUE_WITHOUT_GST,0 as XN_VALUE_WITH_GST,0 as tax_percentage,0 as tax_amount,nrv as net,
    det.discount_amount as sale_discount_amount,'' as article_alias,dt_name as disc_type
	FROM EOSSDND DET
	JOIN EOSSDNM MST ON MST.MEMO_ID=DET.MEMO_ID
	JOIN SKU_names sku  (NOLOCK) ON SKU.PRODUCT_CODE=DET.PRODUCT_CODE  
	WHERE DET.MEMO_ID=@CWHERE
	GOTO SSPL	
SSPL:	

END