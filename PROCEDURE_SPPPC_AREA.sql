CREATE PROCEDURE SPPPC_AREA 
(  
 @NQUERYID   NUMERIC(2,0),    
 @VPARAMETER  VARCHAR(500)  
)  
AS      
BEGIN   
  
 DECLARE @CSTEP INT, @CCMD NVARCHAR(MAX), @ERRMSG_OUT VARCHAR(MAX)  
 BEGIN TRY  
  SET NOCOUNT ON;  
    
  SET @ERRMSG_OUT = ''  
    
  IF @NQUERYID = 1  
   -- GET AREA LIST  
   GOTO LBLGETAREALIST  
  IF @NQUERYID = 2      
   -- GET AREA USING LIKE  
   GOTO LBLGETAREALIKE  
  IF @NQUERYID = 3  
   -- GET AREA INFO  
   GOTO LBLGETAREAINFO   
  ELSE  
   GOTO LAST  
      
LBLGETAREALIST:  
  SET @CSTEP = 101  
    
  SELECT A.AREA_CODE, DBO.UDF_PROPERCASE(A.AREA_NAME) AS AREA_NAME  
  FROM AREA A (NOLOCK)   
  WHERE A.INACTIVE = 0 AND A.AREA_CODE <> '0000000' AND ISNULL(A.AREA_NAME,'')<>''  
  ORDER BY A.AREA_NAME  
    
  GOTO LAST  
    
LBLGETAREALIKE:  
  SET @CSTEP = 102  
    SELECT  TOP 10 A.AREA_CODE, DBO.UDF_PROPERCASE(A.AREA_NAME) AS AREA_NAME  
  FROM AREA A (NOLOCK)   
  WHERE A.INACTIVE = 0 AND A.AREA_CODE <> '0000000' AND ISNULL(A.AREA_NAME,'')<>''  
  AND A.AREA_NAME LIKE '%'+ @VPARAMETER +'%'  
  ORDER BY A.AREA_NAME  
    
  GOTO LAST  
    
LBLGETAREAINFO:  
  SET @CSTEP = 103  
    
  SELECT AREA_CODE, AREA_NAME, PINCODE, CITY_CODE, CITY, STATE_CODE, [STATE] FROM (    
   SELECT A.AREA_CODE, DBO.UDF_PROPERCASE(A.AREA_NAME) AS AREA_NAME, A.PINCODE,  
      B.CITY_CODE, DBO.UDF_PROPERCASE(B.CITY) AS [CITY],   
      C.STATE_CODE, DBO.UDF_PROPERCASE(C.STATE) AS [STATE]  
   FROM AREA A (NOLOCK)   
   JOIN CITY B (NOLOCK) ON B.CITY_CODE=A.CITY_CODE   
   JOIN [STATE] C (NOLOCK) ON C.STATE_CODE=B.STATE_CODE  
   WHERE A.INACTIVE = 0 AND A.AREA_CODE <> '0000000' AND ISNULL(A.AREA_NAME,'')<>''  
  ) AS VAREA  
  WHERE AREA_NAME = @VPARAMETER  
    
  GOTO LAST  
  
LAST:     
 GOTO END_PROC  
  
  SET NOCOUNT OFF;  
 END TRY    
 BEGIN CATCH    
  SET @ERRMSG_OUT='ERROR: [P]: SPPPC_AREA, [STEP]: '+CAST(@CSTEP AS VARCHAR(5))+', [MESSAGE]: ' + ERROR_MESSAGE()  
  GOTO END_PROC    
 END CATCH     
  
END_PROC:    
 IF  ISNULL(@ERRMSG_OUT,'')<>''   
  SELECT @ERRMSG_OUT AS ERRORMSG  
END
