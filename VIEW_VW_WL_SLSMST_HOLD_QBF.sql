CREATE VIEW VW_WL_SLSMST_HOLD_QBF  

AS  
SELECT  D.USER_CUSTOMER_CODE AS  MST_USER_CUSTOMER_CODE,  
  MST.HOLD_ID AS CM_ID,  
  MST.CM_NO AS MST_CM_NO, 
  MST.SESSION_ID AS SESSION_NO, 
  MST.CANCELLED AS MST_CANCELLED, 
  MST.CM_DT AS MST_CM_DT,  
  '' AS MST_FIN_YEAR,  
  --MST.ATD_CHARGES AS MST_ATD_CHARGES,
  0 AS MST_ROUND_OFF,
  MST.SUBTOTAL AS MST_SUBTOTAL,  
  MST.DISCOUNT_PERCENTAGE AS MST_DISCOUNT_PERCENTAGE,   
  MST.DISCOUNT_AMOUNT AS MST_DISCOUNT_AMOUNT ,  
  MST.NET_AMOUNT AS MST_NET_AMOUNT ,  
  MST.REMARKS AS MST_REMARKS, 
  0 AS MST_MEMO_TYPE,  
  E.USERNAME AS MST_USERNAME,
  C.*,  
  B.QUANTITY AS QUANTITY,  
  B.DISCOUNT_PERCENTAGE ,  
  B.DISCOUNT_AMOUNT ,  
  EMP1.EMP_NAME,
  EMP1.EMP_ALIAS,  
  '' AS TAX_STATUS,  
  0 AS TAX_PERCENTAGE ,  
  0 AS TAX_AMOUNT ,  
  B.NET,
  B.MRP ,
 D.CUSTOMER_TITLE+' '+D.CUSTOMER_FNAME +' '+ D.CUSTOMER_LNAME AS MST_CUST_NAME,
   D.ADDRESS1 +' '+ADDRESS2   AS MST_ADDRESS0,
   X.ADDRESS  AS MST_ADDRESS1,
   1 AS PAY_MODE ,0 AS WEIGHTED_AVG_DISC_PCT,0 AS WEIGHTED_AVG_DISC_AMT,
   CONVERT(NUMERIC(10,2),((B.MRP*B.QUANTITY))) AS WEIGHTED_AVG_NET,
   CONVERT(INT,1) AS PRINT_COPY_NO,P.MEMO_ID,P.CASH_AMOUNT,P.CC_AMOUNT,P.CN_AMOUNT,P.ADVANCE_AMOUNT_ADJUSTED,
P.OTHER_DOC_AMOUNT,P.CREDIT_AMOUNT,P.BANK_CHARGES,P.MISC_AMOUNT   
FROM CMM_HOLD MST  
JOIN CMD_HOLD B ON B.HOLD_ID=MST.HOLD_ID  
JOIN 
(
	SELECT  A.PRODUCT_CODE, A.ARTICLE_CODE, B.ARTICLE_NO, B.ARTICLE_NAME, A.PARA1_CODE,  
	C.PARA1_NAME, A.PARA2_CODE, D.PARA2_NAME, A.PARA3_CODE, F.PARA3_NAME, E.UOM_NAME,     
	B.CODING_SCHEME,  B.INACTIVE, A.PURCHASE_PRICE,  A.WS_PRICE,SM.SECTION_NAME, SD.SUB_SECTION_NAME,  
	A.PARA4_CODE,A.PARA5_CODE,A.PARA6_CODE,  
	PARA4_NAME,PARA5_NAME,PARA6_NAME,E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],  
	B.DT_CREATED AS [ART_DT_CREATED],F.DT_CREATED AS [PARA3_DT_CREATED],A.DT_CREATED AS [SKU_DT_CREATED],  
	B.STOCK_NA  
	FROM SKU A ---PMTVIEW A --- OPTIMIZATION AFTER REMOVING VIEWS
	JOIN ARTICLE B ON A.ARTICLE_CODE = B.ARTICLE_CODE    
	JOIN SECTIOND SD ON B.SUB_SECTION_CODE = SD.SUB_SECTION_CODE  
	JOIN SECTIONM SM ON SD.SECTION_CODE = SM.SECTION_CODE  
	JOIN PARA1 C ON A.PARA1_CODE = C.PARA1_CODE    
	JOIN PARA2 D ON A.PARA2_CODE = D.PARA2_CODE    
	JOIN PARA3 F ON A.PARA3_CODE = F.PARA3_CODE    
	JOIN PARA4 G ON A.PARA4_CODE = G.PARA4_CODE    
	JOIN PARA5 H ON A.PARA5_CODE = H.PARA5_CODE    
	JOIN PARA6 I ON A.PARA6_CODE = I.PARA6_CODE    
	JOIN UOM E ON B.UOM_CODE = E.UOM_CODE
)C ON C.PRODUCT_CODE=B.PRODUCT_CODE   
LEFT OUTER JOIN CUSTDYM D ON D.CUSTOMER_CODE=MST.CUSTOMER_CODE   
LEFT OUTER JOIN USERS E ON E.USER_CODE = MST.USER_CODE  
LEFT OUTER JOIN EMPLOYEE EMP1 ON EMP1.EMP_CODE= B.EMP_CODE  
LEFT OUTER JOIN VW_BILL_PAYMODE P ON P.MEMO_ID=MST.HOLD_ID AND P.XN_TYPE='SLS'
LEFT OUTER JOIN 
(
	SELECT AREA_CODE ,AD1 .AREA_NAME +' '+AD2 .CITY +CHAR(10)+AD3 .STATE+'' +AD1 .PINCODE AS ADDRESS  FROM AREA AD1 
	LEFT OUTER JOIN CITY AD2 ON AD2.CITY_CODE=AD1.CITY_CODE
	LEFT OUTER JOIN STATE AD3 ON AD3.STATE_CODE	=AD2.STATE_CODE
	LEFT OUTER JOIN REGIONM AD4 ON AD4.REGION_CODE=AD3.REGION_CODE
)X ON X.AREA_CODE=D.AREA_CODE

