CREATE PROCEDURE SP_VALIDATEXN_BEFORESAVE
(
	@CXNTYPE		VARCHAR(50),
	@NSPID			VARCHAR(40),
	@CUSERCODE		NVARCHAR(10),
	@NUPDATEMODE	INT,
	@CRETVAL		NVARCHAR(MAX) OUTPUT,
	@BNEGSTOCKFOUND BIT OUTPUT
)
--WITH ENCRYPTION
AS
BEGIN

BEGIN TRY

	DECLARE @CCMD NVARCHAR(MAX)

	IF LTRIM(RTRIM(@CXNTYPE))='PUR'
	BEGIN
		EXEC SP_VALIDATEXN_BEFORESAVE_PUR @NSPID,@CUSERCODE,@NUPDATEMODE,@CRETVAL OUTPUT,@BNEGSTOCKFOUND OUTPUT
	END

	ELSE IF LTRIM(RTRIM(@CXNTYPE))='PRT'
	BEGIN
		EXEC SP_VALIDATEXN_BEFORESAVE_PRT @NSPID,@CUSERCODE,@NUPDATEMODE,@CRETVAL OUTPUT,@BNEGSTOCKFOUND OUTPUT
	END

	ELSE IF LTRIM(RTRIM(@CXNTYPE))='SLS'
	BEGIN
		EXEC SP_VALIDATEXN_BEFORESAVE_SLS @NSPID,@CUSERCODE,@NUPDATEMODE,@CRETVAL OUTPUT,@BNEGSTOCKFOUND OUTPUT
	END

	ELSE IF LTRIM(RTRIM(@CXNTYPE))='APR'
	BEGIN
		EXEC SP_VALIDATEXN_BEFORESAVE_APR @NSPID,@CUSERCODE,@NUPDATEMODE,@CRETVAL OUTPUT,@BNEGSTOCKFOUND OUTPUT
	END

	ELSE IF LTRIM(RTRIM(@CXNTYPE))='ARC'
	BEGIN
		EXEC SP_VALIDATEXN_BEFORESAVE_ARC @NSPID,@CUSERCODE,@NUPDATEMODE,@CRETVAL OUTPUT
	END

	ELSE IF LTRIM(RTRIM(@CXNTYPE))='CNC'
	BEGIN
		EXEC SP_VALIDATEXN_BEFORESAVE_CNC @NSPID,@CUSERCODE,@NUPDATEMODE,@CRETVAL OUTPUT,@BNEGSTOCKFOUND OUTPUT
	END

	ELSE IF LTRIM(RTRIM(@CXNTYPE))='PTC'
	BEGIN
		EXEC SP_VALIDATEXN_BEFORESAVE_PTC @NSPID,@CUSERCODE,@NUPDATEMODE,@CRETVAL OUTPUT
	END

	ELSE IF LTRIM(RTRIM(@CXNTYPE))='WSL'
	BEGIN
		EXEC SP_VALIDATEXN_BEFORESAVE_WSL @NSPID,@CUSERCODE,@NUPDATEMODE,@CRETVAL OUTPUT,@BNEGSTOCKFOUND OUTPUT
	END

	ELSE IF LTRIM(RTRIM(@CXNTYPE))='WSR'
	BEGIN
		EXEC SP_VALIDATEXN_BEFORESAVE_WSR @NSPID,@CUSERCODE,@NUPDATEMODE,@CRETVAL OUTPUT,@BNEGSTOCKFOUND OUTPUT
	END

	ELSE IF LTRIM(RTRIM(@CXNTYPE))='PRDCNC'  
	BEGIN  
		EXEC SP_VALIDATEXN_BEFORESAVE_PRD_CNC @NSPID,@CUSERCODE,@NUPDATEMODE,@CRETVAL OUTPUT,@BNEGSTOCKFOUND OUTPUT  
	END  

	ELSE IF LTRIM(RTRIM(@CXNTYPE))='GVGEN'  
	BEGIN  
		EXEC SP_VALIDATEXN_BEFORESAVE_GVGEN @NSPID,@CUSERCODE,@NUPDATEMODE,@CRETVAL OUTPUT
	END  
	
	ELSE IF LTRIM(RTRIM(@CXNTYPE))='XNSAPPROVAL'  
	BEGIN  
		EXEC SP_VALIDATEXN_BEFORESAVE_XNSAPPROVAL @NSPID,@CUSERCODE,@NUPDATEMODE,@CRETVAL OUTPUT
	END  	
END TRY

BEGIN CATCH
	SET @CRETVAL=N'ERROR FOUND IN PROCEDURE : SP_VALIDATEXN_BEFORESAVE '+ISNULL(ERROR_PROCEDURE(),'NULL P')+' AT LINE NO. :'+  
	  ISNULL(LTRIM(RTRIM(STR(ERROR_LINE()))),'NULL LINE')+' MSG :'+ISNULL(ERROR_MESSAGE(),'NULL MSG')  
END CATCH

END
