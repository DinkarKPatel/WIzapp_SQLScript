CREATE VIEW SPPPC_VW_ISSUE_RM_PRINT  
AS  
    
    
SELECT   A.MEMO_ID  AS FG_ISSUE_ID,  
         B.AC_CODE AS AGENCY_CODE ,  
         B.MEMO_ID ,B.MEMO_NO,B.MEMO_DT ,  
         ART.ARTICLE_CODE,ART.ARTICLE_NO,ART.ARTICLE_NAME,  
         SUM(A.QUANTITY ) AS QUANTITY,SD.SUB_SECTION_NAME ,
   BOM_QTY AS AVG_QTY,  
   REQ_QTY=CASE WHEN UC.CONVERSION_VALUE =0 THEN SUM(A.QUANTITY)*CONSUME_QTY   
   ELSE SUM(A.QUANTITY)*CONSUME_QTY /UC.CONVERSION_VALUE END ,  
         UOM.UOM_NAME   
  
FROM PPC_AGENCY_ISSUE_FG_FIRST_DET A  
JOIN PPC_AGENCY_ISSUE_FG_FIRST_MST B ON A.MEMO_ID =B.MEMO_ID  
JOIN PPC_FG_SKU SKU ON SKU.PRODUCT_CODE =A.PRODUCT_CODE   
JOIN PPC_FGBCG_DET DET ON DET. ROW_ID=SKU.PPC_FGBCG_DET_ROW_ID  
JOIN PPC_BO_ART_JOBS_CONSUME CN ON CN.REF_ROW_ID=DET.BO_DET_ROW_ID AND CN.JOB_CODE=B.JOB_CODE AND CN.CONSUME_QTY >0  
JOIN ARTICLE ART ON ART.ARTICLE_CODE =CN.BOM_ARTICLE_CODE   
JOIN SECTIOND SD ON ART.SUB_SECTION_CODE =SD.SUB_SECTION_CODE   
JOIN UOM ON UOM.UOM_CODE =ART.UOM_CODE   
LEFT OUTER JOIN PPC_UOM_CONVERSION UC ON UC.UOM_CODE=UOM.UOM_CODE  
LEFT OUTER JOIN PPC_BOM_UOM BU ON BU.CONVERSION_UOM_CODE=UC.CONVERSION_UOM_CODE  
WHERE B.CANCELLED =0  
GROUP BY A.MEMO_ID  ,  
B.AC_CODE  ,B.MEMO_ID ,B.MEMO_NO,B.MEMO_DT ,  
ART.ARTICLE_CODE,ART.ARTICLE_NO,ART.ARTICLE_NAME,  
BOM_QTY ,UOM.UOM_NAME,UC.CONVERSION_VALUE,CONSUME_QTY,SUB_SECTION_NAME   
  
