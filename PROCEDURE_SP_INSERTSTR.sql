CREATE PROCEDURE SP_INSERTSTR
(
	@CTABLENAME VARCHAR(50),
	@CSOURCEDB VARCHAR(50) = ''
)
--WITH ENCRYPTION
AS
BEGIN
	SET NOCOUNT ON
	DECLARE 
			@CINSERTSTR VARCHAR(8000)
	DECLARE @CSYSCOLS TABLE ( COLUMN_NAME VARCHAR(50) )

	IF @CSOURCEDB = ''
		SET @CSOURCEDB = '<SOURCEDB>'

	INSERT @CSYSCOLS SELECT NAME FROM SYSCOLUMNS WHERE ID = OBJECT_ID(@CTABLENAME) AND NAME <> 'TS'

	SET @CINSERTSTR = ''
	UPDATE @CSYSCOLS
		SET @CINSERTSTR = @CINSERTSTR + ( CASE WHEN @CINSERTSTR <> '' THEN ', ' ELSE '' END ) + [COLUMN_NAME]
	SET @CINSERTSTR = ' INSERT ' + @CTABLENAME + 
		   '	( ' + @CINSERTSTR + ' ) ' + 
		   ' SELECT ' + 
		   '	  ' + @CINSERTSTR + 
		   ' FROM ' + @CSOURCEDB + '.[DBO].' + @CTABLENAME
	PRINT @CINSERTSTR
END
