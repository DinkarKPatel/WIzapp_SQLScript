CREATE VIEW VW_PAYSLIP_MST    
--WITH ENCRYPTION
AS    
 SELECT  PSM.*,    
   (SELECT ISNULL(SUM(LM.APPROVED_AMOUNT),0.00)    
   FROM EMP_LOAN_MST LM WHERE LM.EMP_ID=PSM.EMP_ID AND MONTH(LM.LOAN_DATE)=10      
   AND LM.LOAN_STATUS=1 AND LM.SETTLED=0     
   ) AS LOAN_AMOUNT,EM.REF_ID,EM.PAN_NO,EM.EMP_TITLE+' '+EM.EMP_FNAME+' '+EM.EMP_LNAME AS EMPNAME,EM.WEEKLY_OFF1,EM.WEEKLY_OFF2    
   ,'CREATEDBY:- '+ CU.USERNAME AS CREATEDBY,'MODIFIED BY:- '+ MU.USERNAME AS MODIFIEDBY,
   (CASE WHEN PSM.CANCELLED=1 THEN 'CANCELLED BY:- '+CANU.USERNAME  ELSE '' END) AS CANCELLEDBY,EM.BANK_ACC_NO,
    EM.EMP_TITLE,EM.EMP_FNAME,EM.EMP_LNAME,EM.DATE_OF_BIRTH,EM.MOBILE1,EM.LEAVING_DATE,EM.DATE_OF_JOINING,        
   (PSM.NET_SALARY - (PSM.EMPLOYER_ESI_AMOUNT + PSM.EMPLOYER_PF_AMOUNT)) AS INHAND_SALARY,  
    EM.CO_ALIAS,DPT.DEPARTMENT_NAME,DPT.DEPARTMENT_ID,DSG.DESIG_NAME,DSG.DESIG_ID                           
 FROM EMP_PAYSLIP_MST PSM    
 INNER JOIN EMP_MST EM ON EM.EMP_ID=PSM.EMP_ID     
 INNER JOIN EMP_DEPARTMENT DPT ON EM.DEPARTMENT_ID=DPT.DEPARTMENT_ID         
 INNER JOIN EMP_DESIG DSG ON EM.DESIG_ID=DSG.DESIG_ID                       
 INNER JOIN USERS CU ON PSM.USER_CODE=CU.USER_CODE    
 INNER JOIN USERS MU ON PSM.EDIT_USER_CODE=MU.USER_CODE    
 INNER JOIN USERS CANU ON PSM.CANCELLED_USER_CODE=CANU.USER_CODE
