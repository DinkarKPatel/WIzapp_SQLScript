CREATE PROCEDURE SP3S_DSR_SALE_GIFT_VOUCHER--(LocId 3 digit change by Sanjay:05-11-2024)
(
   @DFM_DT DATETIME,
   @DTO_DT DATETIME
)
AS
BEGIN
     
       SELECT ARC.location_Code AS LOC_ID,DEPT_NAME AS LOC_NAME,
             arc.adv_rec_dt AS DATE,A.GV_SRNO AS GV_NO,A.QUANTITY,
			   (case when B.DENOMINATION <=0 then A. DENOMINATION ELSE B.DENOMINATION END ) AS DENOMINATION,
			 
              ADV_REC_NO AS SALE_RECEIPT_NO,
              CUSTOMER_NAME=CASE WHEN ISNULL(C.MOBILE,'')<> '' THEN ISNULL(C.MOBILE,'')+', ' ELSE '' END + 
              ISNULL(C.CUSTOMER_FNAME,'') +' '+ISNULL(CUSTOMER_LNAME,'') ,
               (case when B.DENOMINATION <=0 then A. DENOMINATION ELSE B.DENOMINATION END )AS AMOUNT
       FROM ARC_GVSALE_DETAILS A (NOLOCK)
	   JOIN SKU_GV_MST B (NOLOCK) ON B.GV_SRNO=A.GV_SRNO
	   JOIN ARC01106 ARC (NOLOCK) ON ARC.ADV_REC_ID=A.ADV_REC_ID     
	   JOIN LOCATION L (NOLOCK) ON L.DEPT_ID=ARC.location_Code
	   JOIN CUSTDYM C (NOLOCK) ON C.CUSTOMER_CODE=ARC.CUSTOMER_CODE 
	   WHERE ISNULL(ARC.CANCELLED,0)=0 
	   AND B.DT_CREATED BETWEEN @DFM_DT AND @DTO_DT

END
--END OF PROCEDURE SP3S_DSR_SALE_GIFT_VOUCHER
