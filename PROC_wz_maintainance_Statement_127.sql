

IF NOT EXISTS (SELECT CONFIG_OPTION FROM CONFIG WHERE CONFIG_OPTION='UPDATE_APPROVED_COLUMN_CHALLANS' AND VALUE=1)
BEGIN
	PRINT 'UPDATE_APPROVED_COLUMN_CHALLANS'
	
	DECLARE @CCURLOCID VARCHAR(5)
	SELECT TOP 1 @CCURLOCID=VALUE FROM CONFIG WHERE CONFIG_OPTION='LOCATION_ID'
		
	UPDATE RMM01106 SET APPROVED=1 FROM LOCATION B  WHERE B.DEPT_ID=LEFT(RMM01106.RM_ID,2) 
	AND LEFT(RMM01106.RM_ID,2)=@CCURLOCID AND RM_DT<='2016-12-31' AND B.STN_APPROVAL=1 AND MODE=2

	UPDATE INM01106 SET APPROVED=1 FROM LOCATION B  WHERE B.DEPT_ID=LEFT(INM01106.INV_ID,2) 
	AND LEFT(INM01106.INV_ID,2)=@CCURLOCID AND INV_DT<='2016-12-31' AND B.STN_APPROVAL=1 AND INV_MODE=2
		
	UPDATE CMD01106 SET BASIC_DISCOUNT_PERCENTAGE=DISCOUNT_PERCENTAGE,BASIC_DISCOUNT_AMOUNT=DISCOUNT_AMOUNT
	WHERE BASIC_DISCOUNT_PERCENTAGE IS NULL AND CARD_DISCOUNT_PERCENTAGE IS NULL
	AND DISCOUNT_PERCENTAGE<>0

	IF NOT EXISTS (SELECT CONFIG_OPTION FROM CONFIG WHERE CONFIG_OPTION='UPDATE_APPROVED_COLUMN_CHALLANS')
		INSERT CONFIG (CONFIG_OPTION,VALUE,ROW_ID,LAST_UPDATE)
			   VALUES ('UPDATE_APPROVED_COLUMN_CHALLANS',1,'',GETDATE())	
	ELSE
		UPDATE CONFIG SET VALUE='1' WHERE CONFIG_OPTION='UPDATE_APPROVED_COLUMN_CHALLANS'
	
END		
