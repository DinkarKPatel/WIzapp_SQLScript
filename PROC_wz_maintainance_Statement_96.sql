	

IF NOT EXISTS(SELECT CONFIG_OPTION FROM CONFIG WHERE CONFIG_OPTION='DELETE_PAYMODEXNDET_ORPHANENTRIES' AND VALUE='1')
BEGIN
	---- DOING THIS BECAUSE NOW ONWARDS CHECK CONSTRAINT IS BEING PLACED IN PAYMODE_XN_DET TABLE
	PRINT 'DELETE ORPHAN ENTRIES FROM PAYMODE XN DET TABLE'
	
	DELETE A FROM PAYMODE_XN_DET A LEFT OUTER JOIN CMM01106 B ON A.MEMO_ID=B.CM_ID 
	WHERE A.XN_TYPE='SLS' AND B.CM_ID IS NULL

	DELETE A FROM PAYMODE_XN_DET A LEFT OUTER JOIN ARC01106 B ON A.MEMO_ID=B.ADV_REC_ID 
	WHERE A.XN_TYPE='ARC' AND B.ADV_REC_ID IS NULL

	DELETE A FROM PAYMODE_XN_DET A LEFT OUTER JOIN INM01106 B ON A.MEMO_ID=B.INV_ID 
	WHERE A.XN_TYPE='WSL' AND B.INV_ID IS NULL

	IF NOT EXISTS(SELECT CONFIG_OPTION FROM CONFIG WHERE CONFIG_OPTION='DELETE_PAYMODEXNDET_ORPHANENTRIES')
	   INSERT CONFIG (CONFIG_OPTION,VALUE,ROW_ID,LAST_UPDATE)
	   VALUES ('DELETE_PAYMODEXNDET_ORPHANENTRIES','1','',GETDATE())	
	ELSE	
		UPDATE CONFIG SET VALUE='1' WHERE CONFIG_OPTION='DELETE_PAYMODEXNDET_ORPHANENTRIES'	
		
END
