CREATE PROCEDURE SP_GETIMAGE_BY_XNTYPE_XNID
(
	@cXNTYPE VARCHAR(100),
	@cXNID VARCHAR(100)
)
AS
BEGIN
	DECLARE @IMGID TABLE(IMG_ID VARCHAR(100),[FILENAME] VARCHAR(100),ERRORMSG VARCHAR(MAX))

	SET @cXNTYPE=ISNULL(@cXNTYPE,'')
	SET @cXNID=ISNULL(@cXNID,'')

	IF @cXNTYPE='' OR @cXNTYPE='WSL'
	BEGIN
		INSERT INTO @IMGID(IMG_ID,FILENAME,ERRORMSG)
		SELECT barcode_img_id as IMG_ID,FILENAME=barcode_img_id, ERRORMSG=''
		FROM SKU_NAMES A
		JOIN IND01106 B ON b.product_code=A.product_code
		WHERE B.INV_ID=@cXNID AND ISNULL(barcode_img_id,'')<>''
		GROUP BY barcode_img_id
	END

	IF NOT EXISTS(SELECT TOP 1 IMG_ID FROM @IMGID)
	BEGIN
		INSERT INTO @IMGID(IMG_ID,FILENAME,ERRORMSG)
		SELECT IMG_ID='',FILENAME='', ERRORMSG='Image Not Found in Database'
	END

	SELECT * FROM @IMGID

END
