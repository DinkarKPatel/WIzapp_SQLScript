create PROCEDURE SP_PRD_GETBARCODEDETAILS    
(    
 @NMODE INT,   --* 1 FOR PO 2. FOR SPLIT COMBINE, 3. PURCHASE, 4. OPS MODULE . 5. BARCODE PRINTING   
 @CROWIDSTR VARCHAR(MAX)=''  
)    
----WITH ENCRYPTION  
AS    
BEGIN    
    --CREATE TABLE VI_PARAM(MODE INT,STR1 VARCHAR(MAX),RTIME DATETIME)
 DECLARE @CROWFILTER NVARCHAR(MAX), @CCMD NVARCHAR(MAX),@CLOCID CHAR(10)    
 SELECT @CLOCID = VALUE FROM CONFIG WHERE  CONFIG_OPTION = 'HO_LOCATION_ID'   
     
   
  IF @CROWIDSTR <> ''    
     BEGIN  
       IF @NMODE=10  
          SET @CROWFILTER = N' A.ROW_ID IN ( ''' + @CROWIDSTR + ''' )'  
       ELSE IF @NMODE=15  
          SET @CROWFILTER = N' M.MEMO_ID =  ''' + @CROWIDSTR + ''''   
      ELSE   
  SET @CROWFILTER = N' B.ROW_ID IN ( ''' + @CROWIDSTR + ''' )'  
         
  END  
     
  
 IF @NMODE = 3   -- TRANSFER TO TRADING   
 BEGIN  
 ----CONVERT(VARCHAR,A.INV_DT,101) AS INV_DT --- DONE THIS AFTER DISCUSSION WITH TEJENDER ON 14-04-15 (SANJAY)  
 ---- HE IS SAYING THAT THIS FORMAT PREVIOUSLY USED TO COME , CURRENTLY IT'S COMING AS DD-MM-YYYY     
 SET @CCMD = N' SELECT B.PRODUCT_CODE, B.MRP AS  FIX_MRP,SKU.MRP, B.PURCHASE_PRICE, SKU.WS_PRICE AS WS_PRICE,  
      ((SKU.PURCHASE_PRICE+ ISNULL(SKU_OH.TAX_AMOUNT,0)+ ISNULL(SKU_OH.OTHER_CHARGES,0) +     
      ISNULL(SKU_OH.ROUND_OFF,0) +  ISNULL(SKU_OH.FREIGHT,0))-  ISNULL(SKU_OH.DISCOUNT_AMOUNT,0)+ ISNULL(SKU_OH.EXCISE_DUTY_AMOUNT,0)) AS LANDED_COST,     
       0 AS WHOLESALE_PRICE, C.ARTICLE_NO, C.ARTICLE_NAME, SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME,    
      C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,    
      P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME,     
      P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME,    
      P6.PARA6_CODE, P6.PARA6_NAME,  C.ARTICLE_DESC,LM.AC_NAME, ''''  AS INV_NO,      
      CONVERT(VARCHAR,SKU.INV_DT,101) AS INV_DT, SKU.INV_NO AS CHALLAN_NO, LM.ALIAS, P3.INACTIVE AS PARA3_INACTIVE,       
      (RTRIM(LTRIM(STR(MONTH(SKU.INV_DT)))) + ''/'' + RTRIM(LTRIM(LM.ALIAS)) + ''/''+     
       RTRIM(LTRIM(STR(YEAR(SKU.INV_DT))))+ ''9/'' + RTRIM(LTRIM(SKU.INV_NO)) + ''/''+    
       RTRIM(LTRIM(STR(DAY(SKU.INV_DT))))) AS INV_DETAILS,          
      CONVERT(NUMERIC(10,0),SKU.MRP) AS WMRP,SKU.MRP,B.QTY AS QTY,'''' AS RECEIPT_DT,    
      '''' AS VANDOR_BILL_DT,U.UOM_NAME,SKU.AC_CODE,SKU.PRODUCT_NAME,    
      DBO.FN_GETENCRYPTVAL(B.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT,  
      DBO.FN_GETENCRYPTVAL(SKU.MRP) AS MRP_ENCRYPT,  
      0 AS SRNO ,0 AS USER_SRNO,  
      DBO.FN_GETENCRYPTVAL((SKU.PURCHASE_PRICE+ ISNULL(SKU_OH.TAX_AMOUNT,0)+ ISNULL(SKU_OH.OTHER_CHARGES,0) +     
      ISNULL(SKU_OH.ROUND_OFF,0) +  ISNULL(SKU_OH.FREIGHT,0))-  ISNULL(SKU_OH.DISCOUNT_AMOUNT,0)+ ISNULL(SKU_OH.EXCISE_DUTY_AMOUNT,0)) AS LANDED_COST_ENCRYPT,    
      CUST.USER_CUSTOMER_CODE, CUST.CUSTOMER_TITLE,CUST.CUSTOMER_FNAME,CUST.CUSTOMER_LNAME,CUST.MOBILE    
      ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
		AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
		AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
		AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
		AT25.ATTR25_KEY_NAME 

       ,WO.REF_NO AS BUYER_ORDER_REF_NO, P4.ALIAS AS P4_ALIAS,SKU.ER_FLAG,SKU.INV_DT AS INV_DT1  
      ,ROUND(B.MRP+(B.MRP*11.2/100),-1) AS SUVIDHAMRP,  
      '''' AS OEM_ID,'''' AS OEM_NAME,'''' AS OEM_ADD1,'''' AS OEM_ADD2,'''' AS OEM_ADD3,'''' AS OEM_PHONE,  
      '''' AS OEM_EMAIL,'''' AS OEM_WEB,  
      LMP.ADDRESS0,  
      LMP.ADDRESS1,SKU.VENDOR_EAN_NO,SKU.ONLINE_PRODUCT_CODE  
      
      ,B.WIP_PRODUCT_CODE--ADDED ON 01-DEC-2017
      ,PRD_WO_MST.MEMO_NO ORDER_NO
      ,BM.ORDER_NO AS WSL_ORDER_NO
      ,BM.ORDER_DT  AS WSL_ORDER_DT
      
      FROM PRD_TRANSFER_MAIN_MST A (NOLOCK)      
      JOIN PRD_TRANSFER_MAIN_DET B (NOLOCK) ON A.MEMO_ID=B.MEMO_ID 
      JOIN (SELECT DISTINCT * FROM PRD_WO_ORDERS) ORD ON ORD.MEMO_ID =B.REF_PRD_WORKORDER_MEMOID
      LEFT OUTER JOIN PRD_UPCPMT UPC ON B.WIP_PRODUCT_CODE=UPC.PRODUCT_CODE
      LEFT OUTER JOIN BUYER_ORDER_MST BM ON BM.ORDER_ID=ISNULL(UPC.ORDER_ID,ORD.ORDER_ID)
      LEFT JOIN PRD_WO_MST (NOLOCK) ON PRD_WO_MST.MEMO_ID=B.REF_PRD_WORKORDER_MEMOID
      JOIN ARTICLE C (NOLOCK) ON B.ARTICLE_CODE=C.ARTICLE_CODE      
      LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON c.ARTICLE_CODE = ATTR.ARTICLE_CODE 
		LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
		LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
		LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
		LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
		LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
		LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
		LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
		LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
		LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
		LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
		LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
		LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
		LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
		LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
		LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
		LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
		LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
		LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
		LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
		LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
		LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
		LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
		LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
		LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
		LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE      
      JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=B.PRODUCT_CODE    
      JOIN PARA1 P1 (NOLOCK) ON B.PARA1_CODE= P1.PARA1_CODE      
      JOIN PARA2 P2 (NOLOCK) ON B.PARA2_CODE= P2.PARA2_CODE      
      JOIN PARA3 P3 (NOLOCK) ON B.PARA3_CODE= P3.PARA3_CODE      
      JOIN PARA4 P4 (NOLOCK) ON B.PARA4_CODE= P4.PARA4_CODE      
      JOIN PARA5 P5 (NOLOCK) ON B.PARA5_CODE= P5.PARA5_CODE      
      JOIN PARA6 P6 (NOLOCK) ON B.PARA6_CODE= P6.PARA6_CODE      
      JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE      
      JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE      
      LEFT OUTER  JOIN LM01106 LM (NOLOCK) ON ISNULL(BM.AC_CODE, PRD_WO_MST.AC_CODE)=LM.AC_CODE   
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LM.AC_CODE=LMP.AC_CODE   
      JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE      
      LEFT OUTER JOIN  SKU_BO (NOLOCK) ON B.PRODUCT_CODE= SKU_BO.PRODUCT_CODE    
      LEFT OUTER JOIN WSL_ORDER_MST WO (NOLOCK)  ON SKU_BO.ORDER_ID= WO.ORDER_ID    
      LEFT OUTER JOIN custdym CUST (NOLOCK) ON WO.CUSTOMER_CODE= CUST.CUSTOMER_CODE    
      LEFT OUTER JOIN SKU_OH  (NOLOCK) ON SKU_OH.PRODUCT_CODE=SKU.PRODUCT_CODE   
      LEFT OUTER JOIN UOM AR_U (NOLOCK) ON AR_U.UOM_CODE=C.UOM_CODE   
    
      WHERE '+@CROWFILTER  + ' '  
      
      -----B.PRODUCT_CODE,B.SRNO     
 END     
 ELSE  
 IF @NMODE = 5   -- FROM ITEM RATE REVISION MODULE --WHEN A.TYPE<>1 THEN B.PRODUCT_CODE  CHANGES BY 13.2.15   
 BEGIN     
 SET @CCMD = N'SELECT (CASE WHEN ISNULL(B.NEW_PRODUCT_CODE,'''')='''' THEN B.PRODUCT_CODE  
         ELSE B.NEW_PRODUCT_CODE END)  AS PRODUCT_CODE,   
   CONVERT(NUMERIC(10,0),B.NEW_MRP) AS WMRP,B.NEW_MRP AS MRP,S.PURCHASE_PRICE, B.NEW_WSP AS WS_PRICE,   
   C.ARTICLE_NO, C.ARTICLE_NAME, C.CODING_SCHEME AS CODING_SCHEME,  
   C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,   
   P2.PARA2_CODE, P2.PARA2_NAME,  P3.PARA3_CODE, P3.PARA3_NAME,  
   P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME,   
   P6.PARA6_CODE, P6.PARA6_NAME,    
   C.ARTICLE_DESC, LM.AC_NAME, S.INV_NO,    
   A.IRM_MEMO_DT AS INV_DT,S.INV_DT AS BARCODE_INV_DT, S.INV_NO AS CHALLAN_NO, LM.ALIAS,P3.INACTIVE AS PARA3_INACTIVE,    
   SPACE(100) AS INV_DETAILS, B.QUANTITY AS QTY,CONVERT(VARCHAR,A.IRM_MEMO_DT,105) AS RECEIPT_DT,  
   CONVERT(VARCHAR,A.IRM_MEMO_DT,105) AS VANDOR_BILL_DT ,U.UOM_NAME,S.AC_CODE,'''' AS PRODUCT_NAME,  
   DBO.FN_GETENCRYPTVAL(S.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT,A.IRM_MEMO_ID,A.IRM_MEMO_NO,  
   B.OLD_MRP,B.OLD_WSP
   ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
AT25.ATTR25_KEY_NAME 

   ,P4.ALIAS AS P4_ALIAS,1 AS ER_FLAG,  
   LMP.ADDRESS0,  
            LMP.ADDRESS1,'''' AS ONLINE_PRODUCT_CODE,'''' AS VENDOR_EAN_NO, P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,   
            P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS   
   FROM PRD_IRM01106 A (NOLOCK)    
   JOIN PRD_IRD01106 B (NOLOCK) ON A.IRM_MEMO_ID = B.IRM_MEMO_ID   
   JOIN PRD_SKU S (NOLOCK) ON S.PRODUCT_UID=(CASE WHEN ISNULL(B.NEW_PRODUCT_UID,'''')=''''   
              THEN B.PRODUCT_UID  
              ELSE B.NEW_PRODUCT_UID END)  
   JOIN ARTICLE C (NOLOCK) ON B.ARTICLE_CODE=C.ARTICLE_CODE    
   LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON c.ARTICLE_CODE = ATTR.ARTICLE_CODE 
LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE   
   JOIN PARA1 P1 (NOLOCK) ON B.PARA1_CODE= P1.PARA1_CODE    
   JOIN PARA2 P2 (NOLOCK) ON B.PARA2_CODE= P2.PARA2_CODE    
   JOIN PARA3 P3 (NOLOCK) ON B.PARA3_CODE= P3.PARA3_CODE    
   JOIN PARA4 P4 (NOLOCK) ON B.PARA4_CODE= P4.PARA4_CODE    
   JOIN PARA5 P5 (NOLOCK) ON B.PARA5_CODE= P5.PARA5_CODE    
   JOIN PARA6 P6 (NOLOCK) ON B.PARA6_CODE= P6.PARA6_CODE    
   JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE    
   JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE   
   LEFT OUTER JOIN LMV01106 LM (NOLOCK) ON LM.AC_CODE=S.AC_CODE  
   LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LM.AC_CODE=LMP.AC_CODE  
   JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE      
            WHERE '+@CROWFILTER  +' ORDER BY B.SRNO'  
      
 END    
   
 ELSE  
 IF @NMODE = 15   -- FROM PRD_SNC    
 BEGIN     
  SET @CCMD = N' SELECT A.PRODUCT_CODE, 0 AS FIX_MRP,SKU.MRP, SKU.PURCHASE_PRICE, SKU.WS_PRICE ,  
     C.ARTICLE_NO, C.ARTICLE_NAME, C.CODING_SCHEME AS CODING_SCHEME,  
      C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,  
      P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME,   
      P4.PARA4_CODE, P4.PARA4_NAME,  P5.PARA5_CODE, P5.PARA5_NAME,  
      P6.PARA6_CODE, P6.PARA6_NAME,  C.ARTICLE_DESC,LM.AC_NAME, SKU.INV_NO AS INV_NO,    
      CONVERT(VARCHAR,SKU.INV_DT,105) AS INV_DT, SKU.INV_NO AS CHALLAN_NO, LM.ALIAS, P3.INACTIVE AS PARA3_INACTIVE,     
      (RTRIM(LTRIM(STR(MONTH(SKU.INV_DT)))) + ''/'' + RTRIM(LTRIM(LM.ALIAS)) + ''/''+   
       RTRIM(LTRIM(STR(YEAR(SKU.INV_DT))))+ ''9/'' + RTRIM(LTRIM(SKU.INV_NO)) + ''/''+  
       RTRIM(LTRIM(STR(DAY(SKU.INV_DT))))) AS INV_DETAILS,        
      CONVERT(NUMERIC(10,0),B.MRP) AS WMRP,B.MRP,B.QUANTITY AS QTY,CONVERT(VARCHAR,SKU.RECEIPT_DT,105) AS RECEIPT_DT,  
      ''''VANDOR_BILL_DT,U.UOM_NAME,'''' AS PRODUCT_NAME,  
      DBO.FN_GETENCRYPTVAL(SKU.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT
      ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
AT25.ATTR25_KEY_NAME 
   
      ,''''  AS [CUSTOMER_NAME],'''' AS [MOBILE]  
      ,1 AS ER_FLAG, P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,   
       P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS   
      FROM PRD_SNC_BARCODE_DET A (NOLOCK)                   
   JOIN PRD_SNC_DET B (NOLOCK) ON A.REFROW_ID = B.ROW_ID      
   JOIN PRD_SNC_MST M (NOLOCK) ON M.MEMO_ID = B.MEMO_ID   
      JOIN PRD_SKU SKU (NOLOCK) ON SKU.PRODUCT_UID=A.PRODUCT_UID  
      JOIN ARTICLE C (NOLOCK) ON SKU.ARTICLE_CODE=C.ARTICLE_CODE    
     LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON c.ARTICLE_CODE = ATTR.ARTICLE_CODE 
	LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
	LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
	LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
	LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
	LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
	LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
	LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
	LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
	LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
	LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
	LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
	LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
	LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
	LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
	LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
	LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
	LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
	LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
	LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
	LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
	LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
	LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
	LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
	LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
	LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE     
      JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE= P1.PARA1_CODE    
      JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE= P2.PARA2_CODE    
      JOIN PARA3 P3 (NOLOCK) ON SKU.PARA3_CODE= P3.PARA3_CODE    
      JOIN PARA4 P4 (NOLOCK) ON SKU.PARA4_CODE= P4.PARA4_CODE    
      JOIN PARA5 P5 (NOLOCK) ON SKU.PARA5_CODE= P5.PARA5_CODE    
      JOIN PARA6 P6 (NOLOCK) ON SKU.PARA6_CODE= P6.PARA6_CODE    
      JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE    
      JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE    
      JOIN LM01106 LM (NOLOCK) ON SKU.AC_CODE=LM.AC_CODE  
      JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE    
      WHERE '+@CROWFILTER  +   
      ' ORDER BY A.PRODUCT_CODE'  
 END           
 ELSE  
 IF @NMODE = 1   -- FROM PURCHASE    
 BEGIN  
 ----CONVERT(VARCHAR,A.INV_DT,101) AS INV_DT --- DONE THIS AFTER DISCUSSION WITH TEJENDER ON 14-04-15 (SANJAY)  
 ---- HE IS SAYING THAT THIS FORMAT PREVIOUSLY USED TO COME , CURRENTLY IT'S COMING AS DD-MM-YYYY     
 SET @CCMD = N' SELECT B.PRODUCT_CODE, B.FIX_MRP,SKU.MRP, B.PURCHASE_PRICE, B.WHOLESALE_PRICE AS WS_PRICE,  
      ((SKU.PURCHASE_PRICE+ ISNULL(SKU_OH.TAX_AMOUNT,0)+ ISNULL(SKU_OH.OTHER_CHARGES,0) +     
      ISNULL(SKU_OH.ROUND_OFF,0) +  ISNULL(SKU_OH.FREIGHT,0))-  ISNULL(SKU_OH.DISCOUNT_AMOUNT,0)+ ISNULL(SKU_OH.EXCISE_DUTY_AMOUNT,0)) AS LANDED_COST,     
     B.WHOLESALE_PRICE, C.ARTICLE_NO, C.ARTICLE_NAME, SKU.BARCODE_CODING_SCHEME AS CODING_SCHEME,    
      C.DISCON, SM.SECTION_NAME, SD.SUB_SECTION_NAME, P1.PARA1_CODE, P1.PARA1_NAME,    
      P2.PARA2_CODE, P2.PARA2_NAME, P3.PARA3_CODE, P3.PARA3_NAME,     
      P4.PARA4_CODE, P4.PARA4_NAME,P4.ALIAS AS PARA4_ALIAS,  P5.PARA5_CODE, P5.PARA5_NAME,    
      P6.PARA6_CODE, P6.PARA6_NAME,  C.ARTICLE_DESC,LM.AC_NAME, A.BILL_NO AS INV_NO,      
      CONVERT(VARCHAR,A.INV_DT,101) AS INV_DT, A.INV_NO AS CHALLAN_NO, LM.ALIAS, P3.INACTIVE AS PARA3_INACTIVE,       
      (RTRIM(LTRIM(STR(MONTH(A.INV_DT)))) + ''/'' + RTRIM(LTRIM(LM.ALIAS)) + ''/''+     
       RTRIM(LTRIM(STR(YEAR(A.INV_DT))))+ ''9/'' + RTRIM(LTRIM(A.INV_NO)) + ''/''+    
 RTRIM(LTRIM(STR(DAY(A.INV_DT))))) AS INV_DETAILS,          
      CONVERT(NUMERIC(10,0),SKU.MRP) AS WMRP,SKU.MRP,B.QUANTITY AS QTY,CONVERT(VARCHAR,A.RECEIPT_DT,105) AS RECEIPT_DT,    
      CONVERT(VARCHAR,A.VANDOR_BILL_DT,105) AS VANDOR_BILL_DT,U.UOM_NAME,A.AC_CODE,SKU.PRODUCT_NAME,    
      DBO.FN_GETENCRYPTVAL(B.PURCHASE_PRICE) AS PUR_PRICE_ENCRYPT,  
      DBO.FN_GETENCRYPTVAL(SKU.MRP) AS MRP_ENCRYPT,  
      B.SRNO ,B.USER_SRNO,  
      DBO.FN_GETENCRYPTVAL((SKU.PURCHASE_PRICE+ ISNULL(SKU_OH.TAX_AMOUNT,0)+ ISNULL(SKU_OH.OTHER_CHARGES,0) +     
      ISNULL(SKU_OH.ROUND_OFF,0) +  ISNULL(SKU_OH.FREIGHT,0))-  ISNULL(SKU_OH.DISCOUNT_AMOUNT,0)+ ISNULL(SKU_OH.EXCISE_DUTY_AMOUNT,0)) AS LANDED_COST_ENCRYPT,    
      CUST.USER_CUSTOMER_CODE, CUST.CUSTOMER_TITLE,CUST.CUSTOMER_FNAME,CUST.CUSTOMER_LNAME,CUST.MOBILE
     ,AT1.ATTR1_KEY_NAME,AT2.ATTR2_KEY_NAME,AT3.ATTR3_KEY_NAME,AT4.ATTR4_KEY_NAME,AT5.ATTR5_KEY_NAME,AT6.ATTR6_KEY_NAME,
		AT7.ATTR7_KEY_NAME,AT8.ATTR8_KEY_NAME,AT9.ATTR9_KEY_NAME,AT10.ATTR10_KEY_NAME,AT11.ATTR11_KEY_NAME,AT12.ATTR12_KEY_NAME,
		AT13.ATTR13_KEY_NAME,AT14.ATTR14_KEY_NAME,AT15.ATTR15_KEY_NAME,AT16.ATTR16_KEY_NAME,AT17.ATTR17_KEY_NAME,AT18.ATTR18_KEY_NAME,
		AT19.ATTR19_KEY_NAME,AT20.ATTR20_KEY_NAME,AT21.ATTR21_KEY_NAME,AT22.ATTR22_KEY_NAME,AT23.ATTR23_KEY_NAME,AT24.ATTR24_KEY_NAME,
		AT25.ATTR25_KEY_NAME 
 
      ,WO.REF_NO AS BUYER_ORDER_REF_NO, P4.ALIAS AS P4_ALIAS,SKU.ER_FLAG,A.INV_DT AS INV_DT1  
      ,ROUND(B.MRP+(B.MRP*11.2/100),-1) AS SUVIDHAMRP,  
      '''' AS OEM_ID,'''' AS OEM_NAME,'''' AS OEM_ADD1,'''' AS OEM_ADD2,'''' AS OEM_ADD3,'''' AS OEM_PHONE,  
      '''' AS OEM_EMAIL,'''' AS OEM_WEB,  
      LMP.ADDRESS0,  
      LMP.ADDRESS1,SKU.VENDOR_EAN_NO,SKU.ONLINE_PRODUCT_CODE, P1.ALIAS AS PARA1_ALIAS, P2.ALIAS AS PARA2_ALIAS, P3.ALIAS AS PARA3_ALIAS,   
      P4.ALIAS AS PARA4_ALIAS, P5.ALIAS AS PARA5_ALIAS, P6.ALIAS AS PARA6_ALIAS 
       
      FROM PRD_PIM01106 A (NOLOCK)      
      JOIN PRD_PID01106 B (NOLOCK) ON A.MRR_ID=B.MRR_ID      
      JOIN PRD_SKU SKU ON B.PRODUCT_UID=SKU.PRODUCT_UID  
      JOIN ARTICLE C (NOLOCK) ON SKU.ARTICLE_CODE=C.ARTICLE_CODE      
      LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON C.ARTICLE_CODE = ATTR.ARTICLE_CODE 
		LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
		LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
		LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
		LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
		LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
		LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
		LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
		LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
		LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
		LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
		LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
		LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
		LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
		LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
		LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
		LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
		LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
		LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
		LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
		LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
		LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
		LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
		LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
		LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
		LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE      
      JOIN PARA1 P1 (NOLOCK) ON B.PARA1_CODE= P1.PARA1_CODE      
      JOIN PARA2 P2 (NOLOCK) ON B.PARA2_CODE= P2.PARA2_CODE      
      JOIN PARA3 P3 (NOLOCK) ON B.PARA3_CODE= P3.PARA3_CODE      
      JOIN PARA4 P4 (NOLOCK) ON B.PARA4_CODE= P4.PARA4_CODE      
      JOIN PARA5 P5 (NOLOCK) ON B.PARA5_CODE= P5.PARA5_CODE      
      JOIN PARA6 P6 (NOLOCK) ON B.PARA6_CODE= P6.PARA6_CODE      
      JOIN SECTIOND SD (NOLOCK) ON C.SUB_SECTION_CODE = SD.SUB_SECTION_CODE      
      JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE= SM.SECTION_CODE      
      LEFT OUTER  JOIN LM01106 LM (NOLOCK) ON A.AC_CODE=LM.AC_CODE   
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LM.AC_CODE=LMP.AC_CODE   
      JOIN UOM U (NOLOCK) ON U.UOM_CODE=C.UOM_CODE      
      LEFT OUTER JOIN  SKU_BO (NOLOCK) ON B.PRODUCT_CODE= SKU_BO.PRODUCT_CODE    
      LEFT OUTER JOIN SKU_OH  (NOLOCK) ON SKU_OH.PRODUCT_CODE=SKU.PRODUCT_CODE   
    
      WHERE '+@CROWFILTER  + ' ORDER BY B.SRNO ASC'  
      -----B.PRODUCT_CODE,B.SRNO     
 END                
   PRINT @CCMD    
 EXEC SP_EXECUTESQL @CCMD    
END
