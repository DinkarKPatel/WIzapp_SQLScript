create PROCEDURE  SP3S_ORDER_DETAILS_JWI
(
	@CWHERE VARCHAR(100)=''
)
AS
BEGIN
	--DECLARE @CWHERE VARCHAR(100)=''
 
 ;WITH ORD_PLAN
	AS
	(
		SELECT BMST.MEMO_ID,BMST.MEMO_NO,BDET.WOD_ROW_ID
		FROM JOBWORK_ISSUE_DET G (NOLOCK)  --ON A.ISSUE_ID = G.ISSUE_ID                        
		JOIN ORD_PLAN_BARCODE_DET BAR_DET (NOLOCK) ON BAR_DET.PRODUCT_CODE=G.PRODUCT_CODE --  AND G.WIP_UID = BAR_DET.REFROW_ID
		JOIN ORD_PLAN_DET BDET (NOLOCK) ON BDET.ROW_ID=BAR_DET.REFROW_ID
		JOIN ORD_PLAN_MST BMST (NOLOCK) ON BDET.MEMO_ID=BMST.MEMO_ID
		WHERE G.ISSUE_ID = @CWHERE  
		GROUP BY  BMST.MEMO_ID,BMST.MEMO_NO,BDET.WOD_ROW_ID
	)
	SELECT  A.ORDER_ID AS BUYER_ORDER_ID,A.ORDER_NO AS BUYER_ORDER_NO,A.ORDER_DT AS BUYER_ORDER_DT,A.REF_NO AS BUYER_ORDER_REF_NO
	,A2.MEMO_ID AS JOB_CARD_ID,A2.MEMO_NO AS JOB_CARD_NO
	FROM ORD_PLAN A2
	LEFT JOIN BUYER_ORDER_DET A1 (NOLOCK) ON A2.WOD_ROW_ID=A1.ROW_ID
	LEFT JOIN BUYER_ORDER_MST A (NOLOCK) ON A1.ORDER_ID=A.ORDER_ID
	GROUP BY A.ORDER_ID,A.ORDER_NO,A.ORDER_DT,A.REF_NO,A2.MEMO_ID ,A2.MEMO_NO
END	
