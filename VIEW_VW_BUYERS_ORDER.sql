create VIEW VW_BUYERS_ORDER

AS
SELECT T1.ORDER_DT,T1.ORDER_NO,T1.TAX_AMOUNT,T1.TAX_PERCENTAGE,T2.AC_NAME,T1.TOTAL_AMOUNT,      
     T1.FREIGHT AS FREIGHT,T1.OTHER_CHARGES AS OTHER_CHARGES,T1.DISCOUNT_AMOUNT AS MST_DISCOUNT_AMOUNT,
     T1.SUBTOTAL AS AMOUNT_WO_TAX,PARA1.PARA1_NAME,PARA2.PARA2_NAME,PARA2.PARA2_ORDER,PARA3.PARA3_NAME,  
     PARA4.PARA4_NAME,PARA5.PARA5_NAME,PARA6.PARA6_NAME, UOM.UOM_NAME,  
     T3.*,T1.PAYMENT_DETAILS,SECTIOND.SUB_SECTION_NAME,SECTIONM.SECTION_NAME,ARTICLE.ARTICLE_NO,  
     T3.QUANTITY AS QTY  ,COM.COMPANY_CODE  
     ,T1.TRAIL_DT,T1.DELIVERY_DT  ,T2.ADDRESS0,T2.ADDRESS1,T2.ADDRESS2,T2.AREA_NAME,T2.CITY,T2.STATE,T2.PINCODE,
     CUST.USER_CUSTOMER_CODE,CUST.CUSTOMER_FNAME,CUST.CUSTOMER_LNAME,
     CUST.MOBILE  AS CUST_MOBILE
     ,CUST.ADDRESS1 AS CUST_ADDRESS1
	, CUST.ADDRESS2 AS CUST_ADDRESS2 
     ,ar.AREA_name AS CUST_AREA 
	,CUST.PIN AS CUST_PIN
	,ct.CITY AS CUST_CITY
	,st.STATE AS CUST_STATE
	,e.REGION_NAME AS CUST_REGION_NAME 
	,B.ADV_REC_ID
	,(CASE WHEN C.AMOUNT IS NULL THEN 0 ELSE C.AMOUNT END) AS AMOUNT
	,C.ADV_REC_NO,EMP.EMP_NAME AS EMP_NAME,T1.REF_NO ,D.ATTRIBUTE_NAME ,D.MEASURMENT ,D.PREV_MEASURE,
	 T1.REMARKS AS MST_REMARKS
     FROM WSL_ORDER_MST T1      
     JOIN LMV01106 T2 ON T1.AC_CODE = T2.AC_CODE   
     JOIN custdym CUST (nolock) ON T1.CUSTOMER_CODE = CUST.CUSTOMER_CODE   
	 JOIN AREA ar (nolock) ON Ar.AREA_CODE = cust.AREA_CODE   
	 JOIN CITY Ct (nolock) ON ar.CITY_CODE = Ct.CITY_CODE   
	 JOIN STATE st (nolock) ON ct.STATE_CODE = st.STATE_CODE  
	 JOIN REGIONM E ON st.REGION_CODE = E.REGION_CODE
     JOIN WSL_ORDER_DET T3 ON T3.ORDER_ID = T1.ORDER_ID      
     JOIN ARTICLE ON ARTICLE.ARTICLE_CODE = T3.ARTICLE_CODE      
     JOIN SECTIOND ON SECTIOND.SUB_SECTION_CODE= ARTICLE.SUB_SECTION_CODE      
     JOIN SECTIONM ON SECTIOND.SECTION_CODE = SECTIONM.SECTION_CODE      
     JOIN PARA1 ON PARA1.PARA1_CODE = T3.PARA1_CODE      
     JOIN PARA2 ON PARA2.PARA2_CODE = T3.PARA2_CODE      
     JOIN PARA3 ON PARA3.PARA3_CODE = T3.PARA3_CODE   
     LEFT JOIN PARA4 (NOLOCK) ON PARA4.PARA4_CODE = T3.PARA4_CODE  
     LEFT JOIN PARA5 (NOLOCK) ON PARA5.PARA5_CODE = T3.PARA5_CODE  
     LEFT JOIN PARA6 (NOLOCK) ON PARA6.PARA6_CODE = T3.PARA6_CODE  
     JOIN UOM (NOLOCK) ON UOM.UOM_CODE=ARTICLE.UOM_CODE
     
     LEFT OUTER JOIN COMPANY COM ON 1=1 AND COM.COMPANY_CODE='01'   
     LEFT OUTER JOIN WSL_ORDER_ADV_RECEIPT B ON T1.ORDER_ID = B.ORDER_ID 
	 LEFT OUTER JOIN ARC01106 C ON B.ADV_REC_ID = C.ADV_REC_ID  
	 LEFT OUTER JOIN EMPLOYEE EMP ON T1.SALE_EMP_CODE= EMP.EMP_CODE
	 LEFT OUTER JOIN  
	(
		 SELECT B.TMD_ROW_ID,C.ATTRIBUTE_CODE,C.ATTRIBUTE_NAME ,B.MEASURMENT ,B.PREV_MEASURE  
		 FROM ATTRM (NOLOCK) C   
		 JOIN TDD01106 (NOLOCK) B ON   C.ATTRIBUTE_CODE = B.ATTRIBUTE_CODE  
		 JOIN WSL_ORDER_DET (NOLOCK) A ON B.TMD_ROW_ID = A.ROW_ID  
		 WHERE C.ATTRIBUTE_TYPE = 5 AND C.INACTIVE = 0 
		
	 ) D   
    ON T3.ROW_ID = D.TMD_ROW_ID 	 
     WHERE T1.CANCELLED = 0
