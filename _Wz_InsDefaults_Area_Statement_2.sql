

--*** ONE TIME JOB: AT HO, INSERT ALL CITIES IN AREA TABLE AND UPDATE THE LOCATION TABLE WITH RESPECTIVE AREA_CODE
--*** WE HAVE NOT REMOVED THE CITY CODE IN LOCATION MASTER FOR PRECAUTIONARY PURPOSE
IF NOT EXISTS ( SELECT AREA_CODE FROM AREA WHERE AREA_CODE <> '0000000' )
BEGIN
	DECLARE @CLOCID VARCHAR(2), @CHOLOCID VARCHAR(2)
	SELECT @CLOCID = VALUE FROM CONFIG WHERE CONFIG_OPTION = 'LOCATION_ID'
	SELECT @CHOLOCID = VALUE FROM CONFIG WHERE CONFIG_OPTION = 'HO_LOCATION_ID'
	IF @CLOCID = @CHOLOCID 
	BEGIN
		INSERT AREA ( AREA_CODE, AREA_NAME, PINCODE, CITY_CODE, LAST_UPDATE)
		SELECT STUFF(CITY_CODE,3,3,'') AS AREA_CODE, CITY AS AREA_NAME, '' AS PINCODE, CITY_CODE, GETDATE() AS LAST_UPDATE
		FROM CITY WHERE CITY_CODE <> '0000000'
		AND STUFF(CITY_CODE,3,3,'') NOT IN ( SELECT AREA_CODE FROM AREA )
		AND CITY NOT IN ( SELECT AREA_NAME FROM AREA )
	END
END
