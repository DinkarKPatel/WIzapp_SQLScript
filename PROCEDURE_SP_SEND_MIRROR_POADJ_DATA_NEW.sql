create PROCEDURE SP_SEND_MIRROR_POADJ_DATA_NEW
(	
	 @CUPLOADEDXNID VARCHAR(50)
	,@CCURLOCID VARCHAR(5)	
	,@BACKNOWLEDGE BIT=0
	,@CERRMSG VARCHAR(1000) OUTPUT
)	
--WITH ENCRYPTION
AS
/*
	SP_SEND_MIRROR_PO_DATA_NEW_208_01_02_14 : THIS PROCEDURE WILL SEND PURCHASE ORDER DATA FROM LOCATION TO HO.
*/
BEGIN
	DECLARE @DTSQL NVARCHAR(MAX),@NSPID INT,@CTEMPTABLE VARCHAR(500),@CMEMOID VARCHAR(50),
	@CTEMPEMPLOYEETABLE VARCHAR(200),@DMEMOLASTUPDATE DATETIME,@CTABLENAME VARCHAR(100),
	@BRECFOUND BIT,@CSTEP VARCHAR(5),@CFILTERCONDITION VARCHAR(MAX),
	@CTEMPMASTERTABLE VARCHAR(200),@CTEMPDETAILTABLE VARCHAR(200),@CTEMPLMTABLE VARCHAR(200),
	@CTEMPLMPTABLE VARCHAR(200),@CTEMPAREATABLE VARCHAR(200),@CTEMPCITYTABLE VARCHAR(200),
	@CTEMPSKUTABLE VARCHAR(200),@CTEMPARTTABLE VARCHAR(200),@CTEMPSDTABLE VARCHAR(200),
	@CTEMPARTATTRTABLE VARCHAR(200)
	

	DECLARE @TXNSSENDINFO TABLE (ORG_TABLENAME VARCHAR(50),TMP_TABLENAME VARCHAR(50),XN_ID VARCHAR(40))  	
BEGIN TRY 	
	---- CALL ACKNOWLEDGEMENT OF MEMO SUCCESSFUL MERGING AT MIRRORING SERVER
	DECLARE @CTEMPDBNAME VARCHAR(40)
	
	SET @CTEMPDBNAME=''		
	
	--CHANGE BY BAIJNATH
	 SET @CMEMOID=@CUPLOADEDXNID
	
	SET @CSTEP=40
	---- IF NO MEMO FOUND , JUST END THE PROCESS
	IF ISNULL(@CMEMOID,'')=''
		GOTO END_PROC
LBLTABLEINFO:
	SET @CSTEP=50

	
	
	SET @CSTEP=220
	---- SEND THE PO MEMO MASTER TABLE
	SELECT DISTINCT  A.*,'POADJ_PO_ADJ_MST_UPLOAD' AS TARGET_TABLENAME FROM PO_ADJ_MST A (NOLOCK) WHERE MEMO_ID =@CMEMOID 
	
	SET @CSTEP=230
	---- SEND THE PO MEMO DETAIL TABLE
	SELECT DISTINCT  A.*,'POADJ_PO_ADJ_DET_UPLOAD' AS TARGET_TABLENAME FROM PO_ADJ_DET A (NOLOCK) WHERE MEMO_ID =@CMEMOID 
	

	
	SELECT DISTINCT A.ROW_ID ,A.ADJ_QUANTITY , 'POADJ_POD_UPLOAD' AS TARGET_TABLENAME  FROM POD01106 A (NOLOCK) 
	JOIN PO_ADJ_DET B (NOLOCK) ON A.ROW_ID =B.PO_ROW_ID  
	WHERE B.MEMO_ID=@CMEMOID  and isnull(A.ADJ_QUANTITY,0)<>0
	
	GOTO END_PROC

END TRY
BEGIN CATCH
	SET @CERRMSG='P: SP_SEND_MIRROR_POADJ_DATA_NEW, STEP:'+@CSTEP+', MESSAGE:'+ERROR_MESSAGE()
	GOTO END_PROC
END CATCH 		
END_PROC:
	
END
---END OF PROCEDURE - SP_SEND_MIRROR_POADJ_DATA_NEW

