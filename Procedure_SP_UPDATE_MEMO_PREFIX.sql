create PROCEDURE SP_UPDATE_MEMO_PREFIX
AS
BEGIN

	
     DECLARE @DFMDT DATETIME,@todt datetime ,@DOLDFMDT DATETIME

	SET @DFMDT='2020-04-01'
	SET @TODT=GETDATE()
	set @DOLDFMDT=@DFMDT

	 INSERT INTO XNSAVELOG (XN_TYPE,STEP,START_TIME,SP_ID,STEP_MSG)
	 SELECT 'MEMO_PREFIX' XN_TYPE,1 STEP,GETDATE() AS START_TIME,0 SP_ID,'UPDATE START' STEP_MSG


	if exists  (select top 1 'u' FROM CMM01106 A (ROWLOCK) WHERE ISNULL(MEMO_PREFIX,'') ='' and cm_dt between @DOLDFMDT and @TODT)
	begin

		WHILE @DFMDT<=@TODT
		BEGIN

		UPDATE A SET MEMO_PREFIX= LEFT(CM_NO, CHARINDEX ('-',CM_NO )) FROM CMM01106 A (rowLOCK) WHERE ISNULL(MEMO_PREFIX,'') ='' and cm_dt between @DOLDFMDT and @DFMDT

		SET @DFMDT=@DFMDT+2
		SET @DOLDFMDT=@DFMDT-1
		PRINT @DFMDT

		END

	end

	 INSERT INTO XNSAVELOG (XN_TYPE,STEP,START_TIME,SP_ID,STEP_MSG)
	 SELECT 'MEMO_PREFIX' XN_TYPE,2 STEP,GETDATE() AS START_TIME,0 SP_ID,'UPDATE START' STEP_MSG

	UPDATE A SET Auto_prefix= LEFT(INV_NO, CHARINDEX ('-',INV_NO )) FROM INM01106 A (NOLOCK) WHERE ISNULL(Auto_prefix,'') =''AND  inv_dt >='2020-04-01'


	INSERT INTO XNSAVELOG (XN_TYPE,STEP,START_TIME,SP_ID,STEP_MSG)
	 SELECT 'MEMO_PREFIX' XN_TYPE,3 STEP,GETDATE() AS START_TIME,0 SP_ID,'UPDATE START' STEP_MSG


	UPDATE A SET Auto_prefix= LEFT(MRR_NO, CHARINDEX ('-',MRR_NO )) FROM PIM01106 A (NOLOCK) WHERE ISNULL(Auto_prefix,'') ='' AND  receipt_dt >='2020-04-01'

	INSERT INTO XNSAVELOG (XN_TYPE,STEP,START_TIME,SP_ID,STEP_MSG)
	 SELECT 'MEMO_PREFIX' XN_TYPE,4 STEP,GETDATE() AS START_TIME,0 SP_ID,'UPDATE START' STEP_MSG

	UPDATE A SET Auto_prefix= LEFT(RM_NO, CHARINDEX ('-',RM_NO )) FROM RMM01106 A (NOLOCK) WHERE ISNULL(Auto_prefix,'') ='' AND  rm_dt >='2020-04-01'

	INSERT INTO XNSAVELOG (XN_TYPE,STEP,START_TIME,SP_ID,STEP_MSG)
	 SELECT 'MEMO_PREFIX' XN_TYPE,5 STEP,GETDATE() AS START_TIME,0 SP_ID,'UPDATE START' STEP_MSG

	UPDATE A SET Auto_prefix= LEFT(CN_NO, CHARINDEX ('-',CN_NO )) FROM CNM01106 A (NOLOCK) WHERE ISNULL(Auto_prefix,'') ='' AND  receipt_dt >='2020-04-01'

	INSERT INTO XNSAVELOG (XN_TYPE,STEP,START_TIME,SP_ID,STEP_MSG)
	 SELECT 'MEMO_PREFIX' XN_TYPE,6 STEP,GETDATE() AS START_TIME,0 SP_ID,'UPDATE START' STEP_MSG
END
