CREATE Procedure sp3s_GetPicklistData
( 
 @cspid varchar(50)
)
as
begin
     

	SELECT  SN.PRODUCT_CODE,a.WS_PRICE AS WS_PRICE,a.EXPIRY_DT  AS EXPIRY_DT,
			PLD.BIN_ID  AS BIN_ID,PMT.QUANTITY_IN_STOCK,ISNULL(a.BATCH_NO,'') AS BATCH_NO,CONVERT(VARCHAR(36),NEWID()) AS BATCH_ROW_ID,
			0 AS PERISHABLE,a.FIX_MRP  AS [FIX_MRP] ,a.MRP [MRP],CONVERT(BIT,0) AS SHOW_BATCH_COLUMNS,ISNULL(BIN.BIN_NAME, '') AS [BIN_NAME],
			CAST( 1  AS BIT) AS CHK,SN.SN_BARCODE_CODING_SCHEME  AS CODING_SCHEME,
		    sn.ARTICLE_NO, sn.ARTICLE_NAME,sn.PARA1_NAME, sn.PARA2_NAME, sn.PARA3_NAME,sn.uom   UOM_NAME ,        
		    a.purchase_price ,sn.SECTION_NAME, sn.SUB_SECTION_NAME, PARA4_NAME,PARA5_NAME,PARA6_NAME,ISNULL(sn.SN_Uom_type,0) AS [UOM_TYPE],      
		   '' AS [ART_DT_CREATED],'' AS [PARA3_DT_CREATED],'' AS [SKU_DT_CREATED],      
		    sn.stock_na   STOCK_NA,'' AS EAN,cast('' as varchar(100)) as FORM_NAME,0 as TAX_PERCENTAGE,
			a.PRODUCT_NAME,(CASE WHEN ISNULL(ER_FLAG,0)=0 THEN 1 ELSE A.ER_FLAG END) AS ER_FLAG,
			sn.AC_NAME,A.INV_DT,A.RECEIPT_DT ,'' AS [ARTICLE_ALIAS],'' AS [WIP_UID],
			A.ONLINE_PRODUCT_CODE AS ONLINE_BAR_CODE,A.VENDOR_EAN_NO,0 AS selling_days,
			A.HSN_CODE AS HSN_CODE,Sn.sku_item_type  ITEM_TYPE,'' AS FORM_ID,A.MRP,A.WS_PRICE,a.AC_CODE ,A.ARTICLE_CODE ,A.PARA1_CODE,A.PARA2_CODE,
			A.PARA3_CODE,A.PARA4_CODE,A.PARA5_CODE,A.PARA6_CODE,SN.PARA1_SET,SN.PARA2_SET ,ISNULL(A.FIX_MRP,0) AS [FIX_MRP],PLM.location_code AS DEPT_ID
			,ISNULL(SN.ATTR1_KEY_NAME,'') as ATTR1_KEY_NAME   ,ISNULL(SN.ATTR2_KEY_NAME,'')  as ATTR2_KEY_NAME
		    ,ISNULL(SN.ATTR3_KEY_NAME,'') as ATTR3_KEY_NAME  ,ISNULL(SN.ATTR4_KEY_NAME,'') as ATTR4_KEY_NAME
			,ISNULL(SN.ATTR5_KEY_NAME,'') as ATTR5_KEY_NAME,ISNULL(SN.ATTR6_KEY_NAME,'') as ATTR6_KEY_NAME
			,ISNULL(SN.ATTR7_KEY_NAME,'')  ATTR7_KEY_NAME ,ISNULL(SN.ATTR8_KEY_NAME,'')  ATTR8_KEY_NAME
			,ISNULL(SN.ATTR9_KEY_NAME,'')  ATTR9_KEY_NAME ,ISNULL(SN.ATTR10_KEY_NAME,'') ATTR10_KEY_NAME
			,ISNULL(SN.ATTR11_KEY_NAME,'') ATTR11_KEY_NAME,ISNULL(SN.ATTR12_KEY_NAME,'') ATTR12_KEY_NAME
			,ISNULL(SN.ATTR13_KEY_NAME,'') ATTR13_KEY_NAME ,ISNULL(SN.ATTR14_KEY_NAME,'') ATTR14_KEY_NAME
			,ISNULL(SN.ATTR15_KEY_NAME,'') ATTR15_KEY_NAME     
			,ISNULL(SN.ATTR16_KEY_NAME,'') ATTR16_KEY_NAME,ISNULL(SN.ATTR17_KEY_NAME,'') ATTR17_KEY_NAME
			,ISNULL(SN.ATTR18_KEY_NAME,'') ATTR18_KEY_NAME,ISNULL(SN.ATTR19_KEY_NAME,'') ATTR19_KEY_NAME
			,ISNULL(SN.ATTR20_KEY_NAME,'')  ATTR20_KEY_NAME  ,ISNULL(SN.ATTR21_KEY_NAME,'') ATTR21_KEY_NAME
			,ISNULL(SN.ATTR22_KEY_NAME,'') as ATTR22_KEY_NAME,ISNULL(SN.ATTR23_KEY_NAME,'') as ATTR23_KEY_NAME
			,ISNULL(SN.ATTR24_KEY_NAME,'') ATTR24_KEY_NAME,ISNULL(SN.ATTR25_KEY_NAME,'')  ATTR25_KEY_NAME ,
			0 as value_add ,SN.boxWeight as XNITEMWEIGHT,
			LEFT(A.PRODUCT_CODE, ISNULL(NULLIF(CHARINDEX ('@',A.PRODUCT_CODE)-1,-1),LEN(A.PRODUCT_CODE ))) AS PRODUCT_CODE_WO_BATCH,
			PLD .ROW_ID,PLD .ROW_ID as PICK_LIST_ROW_ID ,bd.order_id as order_id ,pld.ORD_ROW_ID ORD_ROW_ID,pld.MEMO_ID ,PMT.QUANTITY_IN_STOCK QUANTITY 
	FROM PLD01106 PLD
	join PLM01106 PLM on PLD.MEMO_ID= PLM.MEMO_ID 
	join BUYER_ORDER_DET bd (nolock) on pld.ORD_ROW_ID =bd.row_id 
	join sku a (nolock) on pld.PLD_Product_code =a.product_code 
	JOIN SKU_NAMES SN (NOLOCK) ON SN.PRODUCT_CODE= PLD.PLD_PRODUCT_CODE
	JOIN PMT01106 PMT (NOLOCK) ON PLD.PLD_PRODUCT_CODE =PMT.PRODUCT_CODE 
	AND PLD.BIN_ID =PMT.BIN_ID AND PLM.location_code=PMT.DEPT_ID
	and bd.order_id =pmt.bo_order_id and pld.MEMO_ID =pmt.Pick_list_id 
	JOIN BIN (NOLOCK) ON PLD.BIN_ID =BIN.BIN_ID 
	join PLD_PICKLIST_UPLOAD tmp (nolock) on pld.MEMO_ID =tmp.picklist_id
	where tmp.SP_ID =@cspid and isnull(pmt.bo_order_id ,'')<>''
	and PMT.QUANTITY_IN_STOCK>0

	Delete tmp  from PLD_PICKLIST_UPLOAD tmp 	where tmp.SP_ID =@cspid
	                
end



