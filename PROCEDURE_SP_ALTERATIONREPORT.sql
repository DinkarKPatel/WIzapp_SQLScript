CREATE PROCEDURE SP_ALTERATIONREPORT
( 
  @DFDATE DATETIME=''
 ,@DTDATE DATETIME=''

)
----WITH ENCRYPTION
AS
BEGIN
    
    IF @DFDATE='' AND @DTDATE=''
	BEGIN
		SET @DFDATE=GETDATE()
		SET @DTDATE=GETDATE()
		PRINT @DFDATE
		PRINT @DTDATE
	END
	
	SELECT 
	 REGIONM.REGION_NAME AS REGION,L.DEPT_ID AS STOREID,L.DEPT_ALIAS AS STOREALIES,SECTIOND.SUB_SECTION_NAME
	,PARA3.PARA3_NAME AS STYLE,PARA1.PARA1_NAME,ARTICLE.ARTICLE_NO,PARA2.PARA2_NAME AS SIZE	
	,ATTRM.ATTRIBUTE_NAME AS ALTERATIONTYPE	
	,CMD_ALT.TAILORING_REMARKS AS REMARK
	,SUM(CMD01106.QUANTITY)	AS QUANTITY
	,CMM01106.NET_AMOUNT AS VALUE
	,CMM01106.CM_NO AS BILL_NO
	,CMM01106.CM_DT AS BILL_DATE
	,CUS.USER_CUSTOMER_CODE AS CUSTOMERID
	
	FROM CMM01106 (NOLOCK)
	JOIN CMD01106 (NOLOCK) ON CMM01106.CM_ID=CMD01106.CM_ID
	JOIN SKU (NOLOCK) ON CMD01106.PRODUCT_CODE=SKU.PRODUCT_CODE
	JOIN ARTICLE (NOLOCK) ON SKU.ARTICLE_CODE=ARTICLE.ARTICLE_CODE
	JOIN PARA1 (NOLOCK) ON SKU.PARA1_CODE=PARA1.PARA1_CODE
	JOIN PARA2 (NOLOCK) ON SKU.PARA2_CODE=PARA2.PARA2_CODE
	JOIN PARA3 (NOLOCK) ON SKU.PARA3_CODE=PARA3.PARA3_CODE
	JOIN PARA4 (NOLOCK) ON SKU.PARA4_CODE=PARA4.PARA4_CODE
	JOIN PARA5 (NOLOCK) ON SKU.PARA5_CODE=PARA5.PARA5_CODE
	JOIN PARA6 (NOLOCK) ON SKU.PARA6_CODE=PARA6.PARA6_CODE
	LEFT OUTER JOIN ARTICLE_FIX_ATTR ATTR  (NOLOCK) ON ARTICLE.ARTICLE_CODE = ATTR.ARTICLE_CODE 
	LEFT OUTER JOIN ATTR1_MST AT1 (NOLOCK) ON AT1.ATTR1_KEY_CODE=ATTR.ATTR1_KEY_CODE
	LEFT OUTER JOIN ATTR2_MST AT2 (NOLOCK) ON AT2.ATTR2_KEY_CODE=ATTR.ATTR2_KEY_CODE
	LEFT OUTER JOIN ATTR3_MST AT3 (NOLOCK) ON AT3.ATTR3_KEY_CODE=ATTR.ATTR3_KEY_CODE
	LEFT OUTER JOIN ATTR4_MST AT4 (NOLOCK) ON AT4.ATTR4_KEY_CODE=ATTR.ATTR4_KEY_CODE
	LEFT OUTER JOIN ATTR5_MST AT5 (NOLOCK) ON AT5.ATTR5_KEY_CODE=ATTR.ATTR5_KEY_CODE
	LEFT OUTER JOIN ATTR6_MST AT6 (NOLOCK) ON AT6.ATTR6_KEY_CODE=ATTR.ATTR6_KEY_CODE
	LEFT OUTER JOIN ATTR7_MST AT7 (NOLOCK) ON AT7.ATTR7_KEY_CODE=ATTR.ATTR7_KEY_CODE
	LEFT OUTER JOIN ATTR8_MST AT8 (NOLOCK) ON AT8.ATTR8_KEY_CODE=ATTR.ATTR8_KEY_CODE
	LEFT OUTER JOIN ATTR9_MST AT9 (NOLOCK) ON AT9.ATTR9_KEY_CODE=ATTR.ATTR9_KEY_CODE
	LEFT OUTER JOIN ATTR10_MST AT10 (NOLOCK) ON AT10.ATTR10_KEY_CODE=ATTR.ATTR10_KEY_CODE
	LEFT OUTER JOIN ATTR11_MST AT11 (NOLOCK) ON AT11.ATTR11_KEY_CODE=ATTR.ATTR11_KEY_CODE
	LEFT OUTER JOIN ATTR12_MST AT12 (NOLOCK) ON AT12.ATTR12_KEY_CODE=ATTR.ATTR12_KEY_CODE
	LEFT OUTER JOIN ATTR13_MST AT13 (NOLOCK) ON AT13.ATTR13_KEY_CODE=ATTR.ATTR13_KEY_CODE
	LEFT OUTER JOIN ATTR14_MST AT14 (NOLOCK) ON AT14.ATTR14_KEY_CODE=ATTR.ATTR14_KEY_CODE
	LEFT OUTER JOIN ATTR15_MST AT15 (NOLOCK) ON AT15.ATTR15_KEY_CODE=ATTR.ATTR15_KEY_CODE
	LEFT OUTER JOIN ATTR16_MST AT16 (NOLOCK) ON AT16.ATTR16_KEY_CODE=ATTR.ATTR16_KEY_CODE
	LEFT OUTER JOIN ATTR17_MST AT17 (NOLOCK) ON AT17.ATTR17_KEY_CODE=ATTR.ATTR17_KEY_CODE
	LEFT OUTER JOIN ATTR18_MST AT18 (NOLOCK) ON AT18.ATTR18_KEY_CODE=ATTR.ATTR18_KEY_CODE
	LEFT OUTER JOIN ATTR19_MST AT19 (NOLOCK) ON AT19.ATTR19_KEY_CODE=ATTR.ATTR19_KEY_CODE
	LEFT OUTER JOIN ATTR20_MST AT20 (NOLOCK) ON AT20.ATTR20_KEY_CODE=ATTR.ATTR20_KEY_CODE
	LEFT OUTER JOIN ATTR21_MST AT21 (NOLOCK) ON AT21.ATTR21_KEY_CODE=ATTR.ATTR21_KEY_CODE
	LEFT OUTER JOIN ATTR22_MST AT22 (NOLOCK) ON AT22.ATTR22_KEY_CODE=ATTR.ATTR22_KEY_CODE
	LEFT OUTER JOIN ATTR23_MST AT23 (NOLOCK) ON AT23.ATTR23_KEY_CODE=ATTR.ATTR23_KEY_CODE
	LEFT OUTER JOIN ATTR24_MST AT24 (NOLOCK) ON AT24.ATTR24_KEY_CODE=ATTR.ATTR24_KEY_CODE
	LEFT OUTER JOIN ATTR25_MST AT25(NOLOCK) ON AT25.ATTR25_KEY_CODE=ATTR.ATTR25_KEY_CODE
	JOIN SECTIOND (NOLOCK) ON ARTICLE.SUB_SECTION_CODE=SECTIOND.SUB_SECTION_CODE
	JOIN SECTIONM (NOLOCK) ON SECTIOND.SECTION_CODE=SECTIONM.SECTION_CODE
	JOIN LOCATION L ON L.DEPT_ID=CMD01106.DEPT_ID
	JOIN CMD_ALT CMD_ALT ON CMD_ALT.CMD_ROW_ID=CMD01106.ROW_ID 
	JOIN ATTRM ATTRM ON ATTRM.ATTRIBUTE_CODE=CMD_ALT.TAILORING_ATTRIBUTE_CODE
	JOIN CUSTDYM CUS ON CUS.USER_CUSTOMER_CODE=CMM01106.CUSTOMER_CODE 
    JOIN AREA ON AREA.AREA_CODE=CUS.AREA_CODE  
	JOIN CITY ON CITY.CITY_CODE=AREA.CITY_CODE  
	JOIN STATE ON STATE.STATE_CODE=CITY.STATE_CODE  
	JOIN REGIONM  ON REGIONM.REGION_CODE=STATE.REGION_CODE 
	
	WHERE CMM01106.CM_DT BETWEEN @DFDATE AND @DTDATE
	 
	GROUP BY
	 REGIONM.REGION_NAME ,L.DEPT_ID ,L.DEPT_ALIAS ,SECTIOND.SUB_SECTION_NAME
	,PARA3.PARA3_NAME ,PARA1.PARA1_NAME,ARTICLE.ARTICLE_NO,PARA2.PARA2_NAME 	
	,ATTRM.ATTRIBUTE_NAME 
	,CMD_ALT.TAILORING_REMARKS 
	,CMM01106.NET_AMOUNT 
	,CMM01106.CM_NO 
	,CMM01106.CM_DT
	,CUS.USER_CUSTOMER_CODE
	 
	
END
--********************************* END OF PROCEDURE SP_ALTERATIONREPORT
