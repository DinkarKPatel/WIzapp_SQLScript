CREATE FUNCTION FN_GETNEWFINYEAR 
(@CFINYEAR VARCHAR(5),@LGETNEXTFINYEAR BIT,@NCOUNTER NUMERIC(3,0))
RETURNS VARCHAR(5)
--WITH ENCRYPTION
AS
BEGIN
	DECLARE @CNEWFINYEAR CHAR(5),@CPREFIX VARCHAR(3),@NFINYEAR NUMERIC(2,0),@NFACTOR NUMERIC(2,0)
	
	SELECT @CPREFIX=LEFT(@CFINYEAR,3)
	
	SELECT @NFINYEAR = CONVERT(NUMERIC,SUBSTRING(@CFINYEAR,4,LEN(@CFINYEAR)))

	SELECT @NFACTOR = (CASE WHEN @LGETNEXTFINYEAR=1 THEN 1 ELSE -1 END)	
	
	SELECT @CNEWFINYEAR=LTRIM(RTRIM(@CPREFIX))+REPLICATE('0',2-LEN(LTRIM(RTRIM(STR(@NFINYEAR+(@NCOUNTER*@NFACTOR))))))+
						LTRIM(RTRIM(STR(@NFINYEAR+(@NCOUNTER*@NFACTOR))))

	RETURN @CNEWFINYEAR
END
