CREATE PROCEDURE VALIDATEXN_BIN_TRANSFER_BEFORE_EDIT
@CMEMOID VARCHAR(30),
@BCANCELXN BIT,
@CERRORMSG VARCHAR(200) OUTPUT,
@CEXPRERRORMSG VARCHAR(200) OUTPUT
--WITH ENCRYPTION
AS
BEGIN
    DECLARE @CTEXT VARCHAR(10)
    SET @CTEXT=(CASE WHEN @BCANCELXN=1 THEN 'CANCEL' ELSE 'EDIT' END)
    
    IF EXISTS(SELECT TOP 1 'U' FROM FLOOR_ST_MST A JOIN FLOOR_ST_DET B ON A.MEMO_ID=B.MEMO_ID
              JOIN BIN C ON C.BIN_ID=B.ITEM_TARGET_BIN_ID 
              WHERE ISNULL(RECEIPT_DT,'')<>'' AND C.BIN_ID=C.MAJOR_BIN_ID)
     BEGIN	
		SET @CERRORMSG='STOCK HAS BEEN RECEIVED IN THE TARGET ZONE.........CAN NOT '+@CTEXT
		RETURN
	END         
              
END
