create PROCEDURE SP_DAYEND_PCASH
(
 @CWHEREDT VARCHAR(10),
 @CDEPTID VARCHAR(4)
)
--WITH ENCRYPTION

AS
BEGIN
	--(dinkar) Replace  left(memoid,2) to Location_code 
	DECLARE @DMEMODT DATETIME
	DECLARE @TOPBALDT TABLE (CLOSING_BALANCE NUMERIC(10,2))
	 
	DECLARE @TOPBAL TABLE (XN_DT DATETIME,CLOSING_BALANCE NUMERIC(10,2)) 
	
	SET @DMEMODT= CONVERT(DATETIME,@CWHEREDT,110)+1
	
	INSERT @TOPBALDT
	EXEC SP_CASHXN @CDEPTID,'',@DMEMODT
	  
	INSERT @TOPBAL
	SELECT @CWHEREDT,CLOSING_BALANCE FROM @TOPBALDT
	
	SELECT A.PEM_MEMO_ID,A.PEM_MEMO_DT,B.CLOSING_BALANCE AS CBS  
	FROM  PEM01106 A 
	JOIN @TOPBAL B ON A.PEM_MEMO_DT=B.XN_DT
	WHERE A.PEM_MEMO_DT = @CWHEREDT
	AND A.CANCELLED=0

END
