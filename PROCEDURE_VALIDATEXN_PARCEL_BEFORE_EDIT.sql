CREATE PROCEDURE VALIDATEXN_PARCEL_BEFORE_EDIT 
@CMEMOID VARCHAR(30),
@BCANCELXN BIT,
@CERRORMSG VARCHAR(200) OUTPUT,
@CEXPRERRORMSG VARCHAR(200) OUTPUT
--WITH ENCRYPTION
AS
BEGIN
	
	DECLARE @CTEXT VARCHAR(10),@CPRODUCTCODE VARCHAR(50)
	
	SELECT @CPRODUCTCODE=''
	
	SET @CTEXT=(CASE WHEN @BCANCELXN=1 THEN 'CANCEL' ELSE 'EDIT' END)
	
	IF EXISTS (SELECT TOP 1 A.PARCEL_MEMO_ID 
			   FROM PARCEL_MST A (NOLOCK)
			   WHERE A.PARCEL_MEMO_ID=@CMEMOID AND A.CANCELLED=1)
	BEGIN	
		SET @CERRORMSG='Memo is already Cancelled.........Can not '+@CTEXT
		RETURN
	END
	

	IF EXISTS (SELECT TOP 1 A.PARCEL_MEMO_ID 
			   FROM PARCEL_MST A (NOLOCK)
			   WHERE A.PARCEL_MEMO_ID=@CMEMOID and ISNULL(a.ref_converted_transport_bill_memoid,'')<>'')
	BEGIN	
		SET @CERRORMSG='Parcel Challan has been converted into Bill.........Can not '+@CTEXT
		RETURN
	END

END