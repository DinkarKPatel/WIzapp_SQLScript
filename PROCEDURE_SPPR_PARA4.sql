CREATE PROCEDURE [DBO].[SPPR_PARA4]     
(    
 @NMODE    INT, --(1) - VIEW FILTER DATA (2) - VIEW PARA4_CODE WISE    
 @PARA4_CODE   VARCHAR(9)='',    
 @PARA4_NAME   VARCHAR(300)='',    
 @PARA4_SET   VARCHAR(40)='',    
 @INACTIVE   VARCHAR(1)='',    
 @ERRMSG_OUT   VARCHAR(MAX) OUT    
)    
AS    
BEGIN    
 DECLARE @CSTEP INT, @CCMD NVARCHAR(MAX)    
     
 BEGIN TRY    
  SET @ERRMSG_OUT = ''    
      
  SET @CSTEP = 10    
  IF (@NMODE=1)    
  BEGIN    
   SET @CCMD=N'SELECT PARA4_CODE, PARA4_NAME, ALIAS, REMARKS,     
      CASE WHEN ISNULL(INACTIVE, 0) = 0 THEN ''NO'' ELSE ''YES'' END AS INACTIVE FROM [PARA4]    
      WHERE PARA4_NAME LIKE ''%' + @PARA4_NAME + '%'' '    
   IF @INACTIVE = 'Y'    
   BEGIN    
    SET @CCMD+=N' AND ISNULL(INACTIVE, 0)= 1 '    
   END    
   IF @INACTIVE = 'N'    
   BEGIN    
    SET @CCMD+=N' AND ISNULL(INACTIVE, 0)= 0 '    
   END    
   SET @CCMD+=N' ORDER BY PARA4_CODE DESC' 
      
   PRINT @CCMD    
   EXEC SP_EXECUTESQL @CCMD    
  END    
      
  SET @CSTEP = 20    
  IF (@NMODE=2)    
  BEGIN    
   SET @CCMD=N'SELECT PARA4_CODE, PARA4_NAME, ALIAS, REMARKS,     
      CASE WHEN ISNULL(INACTIVE, 0) = 0 THEN ''NO'' ELSE ''YES'' END AS INACTIVE FROM [PARA4]    
      WHERE PARA4_CODE = ''' + @PARA4_CODE + ''' '    
   PRINT @CCMD    
   EXEC SP_EXECUTESQL @CCMD    
  END    
      
 END TRY      
 BEGIN CATCH      
  SET @ERRMSG_OUT='ERROR: [P]: SPPR_PARA4, [STEP]: '+CAST(@CSTEP AS VARCHAR(5))+', [MESSAGE]: ' + ERROR_MESSAGE()    
  PRINT @ERRMSG_OUT    
      
  GOTO END_PROC      
 END CATCH       
    
END_PROC:      
 IF  ISNULL(@ERRMSG_OUT,'')=''     
  SET @ERRMSG_OUT = ''    
END
