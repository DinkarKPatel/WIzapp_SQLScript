


DECLARE @CLOCATIONID VARCHAR(2)

SELECT TOP 1 @CLOCATIONID=VALUE FROM CONFIG WHERE CONFIG_OPTION='LOCATION_ID'

IF OBJECT_ID('TEMPDB..#TMPBR','U') IS NOT NULL
	DROP TABLE #TMPBR
	
SELECT DISTINCT MEMO_ID, CONVERT(VARCHAR(38),'') AS ROW_ID, PREFIX,0 AS INACTIVE,0 AS  START_FROM 
INTO #TMPBR FROM LOC_BILLING_RULES_SERIES A
JOIN LOC_BILLING_RULES B ON A.REF_ROW_ID=B.ROW_ID
JOIN SERIES_SETUP_MST C ON  C.DEPT_ID=B.SOURCE_DEPT_ID
WHERE ((B.DOC_TYPE=1 AND C.XN_TYPE='WSL_GRP')
		OR (B.DOC_TYPE=2 AND C.XN_TYPE='PRT_GRP'))
AND B.SOURCE_DEPT_ID=@CLOCATIONID		



INSERT SERIES_SETUP_MANUAL_DET	( MEMO_ID, ROW_ID, PREFIX, INACTIVE, START_FROM )  
SELECT DISTINCT  A.MEMO_ID, A.ROW_ID, A.PREFIX, A.INACTIVE,A.START_FROM 
FROM 
(
SELECT MEMO_ID, ROW_ID, PREFIX, INACTIVE,0 AS  START_FROM 
FROM MEMO_SERIES A
JOIN SERIES_SETUP_MST B ON A.XN_TYPE=B.XN_TYPE
UNION
SELECT MEMO_ID, CONVERT(VARCHAR(38),NEWID()) AS ROW_ID, PREFIX,0 AS INACTIVE,0 AS  START_FROM 
FROM #TMPBR
) A 
LEFT OUTER JOIN SERIES_SETUP_MANUAL_DET B ON A.MEMO_ID=B.MEMO_ID AND A.PREFIX=B.PREFIX
WHERE B.MEMO_ID IS NULL

UPDATE SERIES_SETUP_MST SET PREFIX_APPLICABLE=1 WHERE PREFIX_DESTINATION_LOCID=1 AND SERIES_SETUP_MODE=2
