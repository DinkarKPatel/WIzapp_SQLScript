CREATE PROCEDURE SP3S_PENDING_ASN_PARCEL
(
 @CAC_CODE VARCHAR(10)=''
)
AS
BEGIN
     
     SELECT CAST(0 AS BIT) AS CHK,
            LM.AC_NAME ,LM.AC_CODE , A.MEMO_NO ,A.MEMO_DT,A.MEMO_ID ,
            A.NO_OF_CARTONS,A.TOTAL_WEIGHT_SHIPMENT,A.DATE_TIME_SHIPMENT,A.EXPECTED_TIME_ARRIVAL ,
            SUM(DET.QUANTITY) AS TOTAL_QTY,UOM_NAME
     FROM ASN_MST  A (NOLOCK)
     JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
     JOIN ASN_DET DET (NOLOCK) ON A.MEMO_ID =DET.MEMO_ID 
     JOIN UOM (NOLOCK) ON UOM.UOM_CODE=A.UOM_CODE
     LEFT JOIN
     (
      SELECT REF_MEMO_ID 
      FROM parcel_det  A (NOLOCK)
      JOIN PARCEL_MST B (NOLOCK) ON A.PARCEL_MEMO_ID =B.PARCEL_MEMO_ID 
      WHERE B.CANCELLED =0 AND B.XN_TYPE ='ASN'
     ) B ON A.MEMO_ID =B.REF_MEMO_ID 
     WHERE A.CANCELLED =0 AND B.REF_MEMO_ID IS NULL
     AND A.AC_CODE =@CAC_CODE
     GROUP BY LM.AC_NAME ,LM.AC_CODE , A.MEMO_NO ,A.MEMO_DT,A.MEMO_ID ,
      A.NO_OF_CARTONS,A.TOTAL_WEIGHT_SHIPMENT,A.DATE_TIME_SHIPMENT,A.EXPECTED_TIME_ARRIVAL,UOM_NAME 

END
