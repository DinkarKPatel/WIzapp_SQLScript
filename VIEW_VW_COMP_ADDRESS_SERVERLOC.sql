create VIEW VW_COMP_ADDRESS_SERVERLOC  
AS  
SELECT  L.DEPT_ID,l.ADDRESS1,l.ADDRESS2,l.tan_no,l.PAN_NO,l.TIN_NO,C.CITY,A.PINCODE,S.STATE,L.PHONE,l.dept_name  
FROM LOCATION L  
LEFT JOIN AREA A ON A.AREA_CODE=L.AREA_CODE  
LEFT JOIN CITY C ON A.CITY_CODE=C.CITY_CODE  
LEFT JOIN STATE S ON S.STATE_CODE=C.STATE_CODE  
join (SELECT TOP 1 VALUE FROM CONFIG WHERE CONFIG_OPTION = 'LOCATION_ID') loc on 1=1  
join (SELECT TOP 1 VALUE FROM CONFIG WHERE CONFIG_OPTION ='HO_LOCATION_ID') ho on 1=1  
WHERE ISNULL(l.server_loc,0)=1  and loc.value =ho.value 
union all  
SELECT TOP 1 L.company_code as  DEPT_ID,l.ADDRESS1,l.ADDRESS2,l.TAN_NO,l.PAN_NO,l.TIN_NO,C.CITY,A.PINCODE,S.STATE,  
PHONES_FAX as PHONE,l.COMPANY_NAME as  dept_name  
FROM COMPANY  L  
LEFT JOIN AREA A ON A.AREA_CODE=L.AREA_CODE  
LEFT JOIN CITY C ON A.CITY_CODE=C.CITY_CODE  
LEFT JOIN STATE S ON S.STATE_CODE=C.STATE_CODE  
join (SELECT TOP 1 VALUE FROM CONFIG WHERE CONFIG_OPTION = 'LOCATION_ID') con on 1=1  
join location loc on loc.dept_id =con.value  
--WHERE L.DEPT_ID IN (SELECT TOP 1 VALUE FROM CONFIG WHERE CONFIG_OPTION LIKE 'LOC%')  
and ISNULL(loc.server_loc,0)=0  and l.COMPANY_CODE='01'
