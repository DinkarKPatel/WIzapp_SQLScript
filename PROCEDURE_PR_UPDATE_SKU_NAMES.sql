CREATE PROCEDURE PR_UPDATE_SKU_NAMES(@LAST_INSERTED DATETIME)
AS
BEGIN
--COMMENTED THE PRODCEDURE DUE TO INSERT TRIGGER CREATED ON SKU FOR INSERTING INTO SKU_NAMES
PRINT ''
RETURN
/*
SET NOCOUNT ON
DECLARE @TAB VARCHAR(1000),@MYSQL VARCHAR(MAX),@TIME VARCHAR(100),@ERR INT
SET @TIME=REPLACE(CONVERT(VARCHAR,@LAST_INSERTED,102),'.','-')+' '+CONVERT(VARCHAR(8),@LAST_INSERTED,108)+'.'+RIGHT(CONVERT(VARCHAR,@LAST_INSERTED,113),3)
SET @TAB='TEMPDB..##GEN_BARCODE_'+DB_NAME()

SET @MYSQL=';WITH CTE AS
(SELECT *,R=ROW_NUMBER()OVER(PARTITION BY PRODUCT_CODE ORDER BY PRODUCT_CODE) FROM '+REPLACE(@TAB,'TEMPDB..','')+' WHERE INSERTED_ON<='''+@TIME+''')
DELETE CTE WHERE R>1'
PRINT @MYSQL 
EXEC(@MYSQL)

SET @MYSQL='DELETE SKU_NAMES FROM (SELECT PRODUCT_CODE FROM '+REPLACE(@TAB,'TEMPDB..','')+' WHERE INSERTED_ON<='''+@TIME+''')G
WHERE SKU_NAMES.PRODUCT_CODE=G.PRODUCT_CODE;'
PRINT @MYSQL
EXEC(@MYSQL)

SET @MYSQL='INSERT SKU_NAMES (PRODUCT_CODE, LC, PP, MRP, WS_PRICE,AC_NAME
				, ARTICLE_NO, ARTICLE_NAME, STOCK_NA, SECTION_NAME, SUB_SECTION_NAME
				, PARA1_NAME, PARA2_NAME, PARA3_NAME, PARA4_NAME, PARA5_NAME, PARA6_NAME
				, ATTR1_KEY_NAME, ATTR2_KEY_NAME, ATTR3_KEY_NAME, ATTR4_KEY_NAME, ATTR5_KEY_NAME
				, ATTR6_KEY_NAME, ATTR7_KEY_NAME, ATTR8_KEY_NAME, ATTR9_KEY_NAME, ATTR10_KEY_NAME
				, ATTR11_KEY_NAME, ATTR12_KEY_NAME, ATTR13_KEY_NAME, ATTR14_KEY_NAME, ATTR15_KEY_NAME
				, ATTR16_KEY_NAME, ATTR17_KEY_NAME, ATTR18_KEY_NAME, ATTR19_KEY_NAME, ATTR20_KEY_NAME
				, ATTR21_KEY_NAME, ATTR22_KEY_NAME, ATTR23_KEY_NAME, ATTR24_KEY_NAME, ATTR25_KEY_NAME)
SELECT A.PRODUCT_CODE
   ,(a.PURCHASE_PRICE+ISNULL(SKU_OH.TAX_AMOUNT,0)+ ISNULL(SKU_OH.OTHER_CHARGES,0) +  
	  ISNULL(SKU_OH.ROUND_OFF,0) + ISNULL(SKU_OH.FREIGHT,0)- ISNULL(SKU_OH.DISCOUNT_AMOUNT,0) + 
	  ISNULL(SKU_OH.EXCISE_DUTY_AMOUNT,0)+ISNULL(SKU_OH.VALUE_ADD,0)) as lc
   ,(a.PURCHASE_PRICE + (CASE WHEN FF.POST_TAX_SEPARATELY =0 AND FF.FORM_ID <> ''0000000'' 
	   THEN ISNULL(SKU_OH.TAX_AMOUNT,0) ELSE 0 END) - ISNULL(SKU_OH.DISCOUNT_AMOUNT,0) + 
	   ISNULL(SKU_OH.EXCISE_DUTY_AMOUNT,0) +ISNULL(SKU_OH.VALUE_ADD,0)) AS pp
   ,A.MRP,A.WS_PRICE,LM01106.AC_NAME
   ,ARTICLE_NO ,ARTICLE_NAME ,ISNULL(ARTICLE.STOCK_NA,0)STOCK_NA, SECTION_NAME ,SUB_SECTION_NAME
   ,PARA1_NAME,PARA2_NAME,PARA3_NAME,PARA4_NAME,PARA5_NAME,PARA6_NAME
   ,A1.ATTR1_KEY_NAME   ,A2.ATTR2_KEY_NAME   ,A3.ATTR3_KEY_NAME   ,A4.ATTR4_KEY_NAME   ,A5.ATTR5_KEY_NAME 
   ,A6.ATTR6_KEY_NAME   ,A7.ATTR7_KEY_NAME   ,A8.ATTR8_KEY_NAME   ,A9.ATTR9_KEY_NAME   ,A10.ATTR10_KEY_NAME 
   ,A11.ATTR11_KEY_NAME ,A12.ATTR12_KEY_NAME ,A13.ATTR13_KEY_NAME ,A14.ATTR14_KEY_NAME ,A15.ATTR15_KEY_NAME      
   ,A16.ATTR16_KEY_NAME ,A17.ATTR17_KEY_NAME ,A18.ATTR18_KEY_NAME ,A19.ATTR19_KEY_NAME ,A20.ATTR20_KEY_NAME      
   ,A21.ATTR21_KEY_NAME ,A22.ATTR22_KEY_NAME ,A23.ATTR23_KEY_NAME ,A24.ATTR24_KEY_NAME ,A25.ATTR25_KEY_NAME      	  
   FROM SKU A
   JOIN '+REPLACE(@TAB,'TEMPDB..','')+' G ON A.PRODUCT_CODE=G.PRODUCT_CODE AND G.INSERTED_ON<='''+@TIME+'''
   JOIN LM01106 (NOLOCK) ON LM01106.AC_CODE=A.AC_CODE
   LEFT JOIN SKU_OH  (NOLOCK) ON A.PRODUCT_CODE=SKU_OH.PRODUCT_CODE 
   JOIN ARTICLE (NOLOCK) ON ARTICLE.ARTICLE_CODE=A.ARTICLE_CODE
   JOIN ARTICLE_FIX_ATTR  AF (NOLOCK) ON AF.ARTICLE_CODE=A.ARTICLE_CODE
   JOIN FORM FF (NOLOCK) ON FF.FORM_ID=A.FORM_ID
   JOIN SECTIOND (NOLOCK) ON SECTIOND.SUB_SECTION_CODE=ARTICLE.SUB_SECTION_CODE
   JOIN SECTIONM (NOLOCK) ON SECTIONM.SECTION_CODE=SECTIOND.SECTION_CODE
   LEFT JOIN PARA1 P1 (NOLOCK) ON P1.PARA1_CODE=A.PARA1_CODE      
   LEFT JOIN PARA2 P2 (NOLOCK) ON P2.PARA2_CODE=A.PARA2_CODE      
   LEFT JOIN PARA3 P3 (NOLOCK) ON P3.PARA3_CODE=A.PARA3_CODE      
   LEFT JOIN PARA4 P4 (NOLOCK) ON P4.PARA4_CODE=A.PARA4_CODE      
   LEFT JOIN PARA5 P5 (NOLOCK) ON P5.PARA5_CODE=A.PARA5_CODE      
   LEFT JOIN PARA6 P6 (NOLOCK) ON P6.PARA6_CODE=A.PARA6_CODE      
   LEFT JOIN ATTR1_MST A1 (NOLOCK) ON A1.ATTR1_KEY_CODE=af.attr1_KEY_CODE      
   LEFT JOIN ATTR2_MST A2 (NOLOCK) ON A2.ATTR2_KEY_CODE=af.attr2_KEY_CODE      
   LEFT JOIN ATTR3_MST A3 (NOLOCK) ON A3.ATTR3_KEY_CODE=af.attr3_KEY_CODE      
   LEFT JOIN ATTR4_MST A4 (NOLOCK) ON A4.ATTR4_KEY_CODE=af.attr4_KEY_CODE      
   LEFT JOIN ATTR5_MST A5 (NOLOCK) ON A5.ATTR5_KEY_CODE=af.attr5_KEY_CODE      
   LEFT JOIN ATTR6_MST A6 (NOLOCK) ON A6.ATTR6_KEY_CODE=af.attr6_KEY_CODE      
   LEFT JOIN ATTR7_MST A7 (NOLOCK) ON A7.ATTR7_KEY_CODE=af.attr7_KEY_CODE      
   LEFT JOIN ATTR8_MST A8 (NOLOCK) ON A8.ATTR8_KEY_CODE=af.attr8_KEY_CODE      
   LEFT JOIN ATTR9_MST A9 (NOLOCK) ON A9.ATTR9_KEY_CODE=af.attr9_KEY_CODE      
   LEFT JOIN ATTR10_MST A10 (NOLOCK) ON A10.ATTR10_KEY_CODE=af.attr10_KEY_CODE      
   LEFT JOIN ATTR11_MST A11 (NOLOCK) ON A11.ATTR11_KEY_CODE=af.attr11_KEY_CODE      
   LEFT JOIN ATTR12_MST A12 (NOLOCK) ON A12.ATTR12_KEY_CODE=af.attr12_KEY_CODE      
   LEFT JOIN ATTR13_MST A13 (NOLOCK) ON A13.ATTR13_KEY_CODE=af.attr13_KEY_CODE      
   LEFT JOIN ATTR14_MST A14 (NOLOCK) ON A14.ATTR14_KEY_CODE=af.attr14_KEY_CODE      
   LEFT JOIN ATTR15_MST A15 (NOLOCK) ON A15.ATTR15_KEY_CODE=af.attr15_KEY_CODE      
   LEFT JOIN ATTR16_MST A16 (NOLOCK) ON A16.ATTR16_KEY_CODE=af.attr16_KEY_CODE      
   LEFT JOIN ATTR17_MST A17 (NOLOCK) ON A17.ATTR17_KEY_CODE=af.attr17_KEY_CODE      
   LEFT JOIN ATTR18_MST A18 (NOLOCK) ON A18.ATTR18_KEY_CODE=af.attr18_KEY_CODE      
   LEFT JOIN ATTR19_MST A19 (NOLOCK) ON A19.ATTR19_KEY_CODE=af.attr19_KEY_CODE      
   LEFT JOIN ATTR20_MST A20 (NOLOCK) ON A20.ATTR20_KEY_CODE=af.attr20_KEY_CODE      
   LEFT JOIN ATTR21_MST A21 (NOLOCK) ON A21.ATTR21_KEY_CODE=af.attr21_KEY_CODE      
   LEFT JOIN ATTR22_MST A22 (NOLOCK) ON A22.ATTR22_KEY_CODE=af.attr22_KEY_CODE      
   LEFT JOIN ATTR23_MST A23 (NOLOCK) ON A23.ATTR23_KEY_CODE=af.attr23_KEY_CODE      
   LEFT JOIN ATTR24_MST A24 (NOLOCK) ON A24.ATTR24_KEY_CODE=af.attr24_KEY_CODE      
   LEFT JOIN ATTR25_MST A25 (NOLOCK) ON A25.ATTR25_KEY_CODE=Af.ATTR25_KEY_CODE;'
   PRINT 'UPDATION '+@MYSQL
   EXEC(@MYSQL)	
   
   SELECT @ERR=@@ERROR,@MYSQL=''
   SET @ERR=ISNULL(@ERR,0)
   /*
   SET @MYSQL='DELETE '+REPLACE(@TAB,'TEMPDB..','')+' WHERE INSERTED_ON<='''+@TIME+''';'   
   PRINT 'MAINTAIN- '+@MYSQL
   IF @@ERROR=0 AND 1=2
      EXEC(@MYSQL)
   */   
SET NOCOUNT OFF
*/
END