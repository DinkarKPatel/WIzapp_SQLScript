create PROCEDURE SP_POSTSALES_JOB_WORK_ISSUE_3    
(        
  @IMODE INT ,        
  @CWHERE VARCHAR(4000)='',    
  @CAGENCYCODE CHAR(7)='',    
  @BMODE BIT = 0 ,  
  @FINYEAR VARCHAR(10)=''  ,  
  @DEPTID VARCHAR(10)=''       
)    
----WITH ENCRYPTION        
      
AS        
BEGIN 

 SELECT CAST(0 AS BIT) AS CHKBILL, A.ISSUE_NO,A.ISSUE_ID,M.CM_NO ,G.*,      
 ART.ARTICLE_CODE, ART.ARTICLE_NO, ART.ARTICLE_NAME, P1.PARA1_CODE,        
 PARA1_NAME, P2.PARA2_CODE,PARA2_NAME,P3.PARA3_CODE,PARA3_NAME,UOM_NAME,           
 CODING_SCHEME,CONVERT(NUMERIC(10,2),0) AS QUANTITY_IN_STOCK,SKU.PURCHASE_PRICE,      
 SKU.MRP,SKU.WS_PRICE,   SM.SECTION_NAME, SD.SUB_SECTION_NAME,        
 P4.PARA4_CODE,P5.PARA5_CODE,P6.PARA6_CODE,        
 PARA4_NAME,PARA5_NAME,PARA6_NAME,E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],        
 ART.DT_CREATED AS [ART_DT_CREATED],P3.DT_CREATED AS [PARA3_DT_CREATED],SKU.DT_CREATED AS [SKU_DT_CREATED],        
 ART.STOCK_NA,JOBS.JOB_CODE,JOBS.JOB_NAME,(G.QUANTITY*G.JOB_RATE) AS AMOUNT,  
 EMP.EMP_CODE,EMP.EMP_NAME ,    
 B.DELIVERY_DT ,(CUST.CUSTOMER_FNAME +' '+ CUST.CUSTOMER_LNAME) AS CUST_NAME,CUST.MOBILE ,  
 ART.ALIAS AS ARTICLE_ALIAS ,M.CM_ID   ,HBM.memo_no AS HBD_MEMO_NO,
 ISNULL(JOBS1.JOB_NAME,'') AS HOLD_BACK_JOB_NAME,C.PRODUCT_CODE AS OLD_PRODUCT_CODE
 FROM POST_SALES_JOBWORK_ISSUE_MST A (NOLOCK)             
 JOIN POST_SALES_JOBWORK_ISSUE_DET  G (NOLOCK)  ON A.ISSUE_ID = G.ISSUE_ID        
 JOIN HOLD_BACK_DELIVER_DET B (NOLOCK) ON G.REF_HBD_ROW_ID = B.ROW_ID             
 JOIN HOLD_BACK_DELIVER_MST HBM (NOLOCK) ON HBM.MEMO_ID=B.MEMO_ID  
 left JOIN CMD01106 C (NOLOCK) ON C.ROW_ID = B.REF_CMD_ROW_ID          
 left JOIN CMM01106 M (NOLOCK) ON C.CM_ID = M.CM_ID          
 JOIN SKU ON SKU.PRODUCT_CODE=isnull(C.PRODUCT_CODE,g.product_code )      
 JOIN ARTICLE ART ON SKU.ARTICLE_CODE = ART.ARTICLE_CODE          
 JOIN SECTIOND SD ON ART.SUB_SECTION_CODE = SD.SUB_SECTION_CODE        
 JOIN SECTIONM SM ON SD.SECTION_CODE = SM.SECTION_CODE        
 JOIN PARA1 P1 ON SKU.PARA1_CODE = P1.PARA1_CODE          
 JOIN PARA2 P2 ON SKU.PARA2_CODE = P2.PARA2_CODE          
 JOIN PARA3 P3 ON SKU.PARA3_CODE = P3.PARA3_CODE          
 JOIN PARA4 P4 ON SKU.PARA4_CODE = P4.PARA4_CODE          
 JOIN PARA5 P5 ON SKU.PARA5_CODE = P5.PARA5_CODE          
 JOIN PARA6 P6 ON SKU.PARA6_CODE = P6.PARA6_CODE          
 JOIN UOM E ON ART.UOM_CODE = E.UOM_CODE       
 LEFT OUTER JOIN JOBS (NOLOCK) ON JOBS.JOB_CODE=G.JOB_CODE  
 LEFT OUTER JOIN JOBS JOBS1 (NOLOCK) ON JOBS1.JOB_CODE=G.HBD_JOB_CODE         
 LEFT OUTER JOIN EMPLOYEE EMP ON EMP.EMP_CODE=C.EMP_CODE  
 LEFT OUTER JOIN CUSTDYM CUST ON CUST.CUSTOMER_CODE=ISNULL(M.CUSTOMER_CODE,HBM.CUSTOMER_CODE)
 WHERE A.ISSUE_ID = @CWHERE 
 
END