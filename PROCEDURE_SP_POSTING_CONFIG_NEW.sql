CREATE PROCEDURE SP_POSTING_CONFIG_NEW
(
	@NQUERYID		INT,
	@CWHERE		VARCHAR(MAX)=''
)	
AS
BEGIN
	IF @NQUERYID=1
		GOTO MST
	ELSE IF @NQUERYID=2
		GOTO DET1
	ELSE IF @NQUERYID=3
		GOTO DET2
	ELSE IF @NQUERYID=4
		GOTO LEDGER
	ELSE 
		GOTO END_PROC

MST:
	SELECT *
	FROM GST_ACCOUNTS_CONFIG_MST
	ORDER BY SNO
	GOTO END_PROC
DET1:
	SELECT A.XN_TYPE
	,A.COLUMNNAME,A.COLUMNDESC,A.VALUE,A.REMARKS,A.FILTER_HEAD_CODE,
	(CASE WHEN (ISNULL(B.PAYMODE_NAME,'')+ISNULL(B1.SUPPLY_NAME,'')+ISNULL(TILL_NAME,'')) ='' THEN COLUMNDESC ELSE (ISNULL(B.PAYMODE_NAME,'')+ISNULL(B1.SUPPLY_NAME,'')+ISNULL(TILL_NAME,''))+ ' '+COLUMNDESC END) AS COLDESC
	FROM GST_ACCOUNTS_CONFIG_DET_1 A 
	LEFT OUTER JOIN PAYMODE_MST B ON B.PAYMODE_CODE=LEFT(A.COLUMNNAME,7) AND A.XN_TYPE IN ('SLS','ARC','WSL')
	LEFT OUTER JOIN SUPPLY_EXPENSE_MST B1 ON B1.SUPPLY_CODE=LEFT(A.COLUMNNAME,7) AND A.XN_TYPE='IWS'
	LEFT OUTER JOIN TILL_MST B2 ON B2.TILL_ID=LEFT(A.COLUMNNAME,10) AND A.XN_TYPE IN ('TLF','BTF')
	UNION
	SELECT B.XN_TYPE
	,A.PAYMODE_CODE+'_DOC_PAYMODE_CODE' AS COLUMNNAME,'A/C' AS COLUMNDESC,'0000000000' AS VALUE,'' AS REMARKS,'' AS FILTER_HEAD_CODE,
	A.PAYMODE_NAME +' A/C' AS COLDESC
	FROM PAYMODE_MST A
	JOIN
	(
		SELECT 'SLS' AS XN_TYPE
		UNION 
		SELECT 'ARC' AS XN_TYPE	
	)B ON 1=1
	LEFT OUTER JOIN GST_ACCOUNTS_CONFIG_DET_1 A1 ON A1.XN_TYPE=B.XN_TYPE AND A1.COLUMNNAME=A.PAYMODE_CODE+'_DOC_PAYMODE_CODE'
	WHERE --PAYMODE_GRP_CODE IN ('0000003','WCGV001','0000002')
	PAYMODE_GRP_CODE IN ('0000000','WCGV001','0000003')
	AND PAYMODE_CODE NOT IN ('0000002','0000001')
	AND A1.XN_TYPE IS NULL
	UNION
	SELECT B.XN_TYPE
	,A.PAYMODE_CODE+'_BANK_AC_CODE' AS COLUMNNAME,'A/C' AS COLUMNDESC,'0000000000' AS VALUE,'' AS REMARKS,'' AS FILTER_HEAD_CODE,
	A.PAYMODE_NAME +' A/C' AS COLDESC
	FROM PAYMODE_MST A
	JOIN
	(
		SELECT 'SLS' AS XN_TYPE
		UNION 
		SELECT 'ARC' AS XN_TYPE
		UNION 
		SELECT 'WSL' AS XN_TYPE		
	)B ON 1=1
	LEFT OUTER JOIN GST_ACCOUNTS_CONFIG_DET_1 A1 ON A1.XN_TYPE=B.XN_TYPE AND A1.COLUMNNAME=A.PAYMODE_CODE+'_BANK_AC_CODE'
	WHERE  PAYMODE_GRP_CODE IN ('0000002')
	AND A1.XN_TYPE IS NULL
	UNION
	SELECT B.XN_TYPE
	,A.PAYMODE_CODE+'_COMMISSION_AC_CODE' AS COLUMNNAME,' COMMISSION A/C' AS COLUMNDESC,'0000000000' AS VALUE,'' AS REMARKS,'' AS FILTER_HEAD_CODE,
	A.PAYMODE_NAME +' COMMISSION A/C' AS COLDESC
	FROM PAYMODE_MST A
	JOIN
	(
		SELECT 'SLS' AS XN_TYPE
		UNION 
		SELECT 'ARC' AS XN_TYPE
		UNION 
		SELECT 'WSL' AS XN_TYPE		
	)B ON 1=1
	LEFT OUTER JOIN GST_ACCOUNTS_CONFIG_DET_1 A1 ON A1.XN_TYPE=B.XN_TYPE AND A1.COLUMNNAME=A.PAYMODE_CODE+'_COMMISSION_AC_CODE'
	WHERE  PAYMODE_GRP_CODE IN ('0000002')
	AND A1.XN_TYPE IS NULL
	UNION
	SELECT B.XN_TYPE
	,A.SUPPLY_CODE+'_AC_CODE' AS COLUMNNAME,'EXPENSE A/C' AS COLUMNDESC,'0000000000' AS VALUE,'' AS REMARKS,'' AS FILTER_HEAD_CODE,
	A.SUPPLY_NAME +' EXPENSE A/C' AS COLDESC
	FROM SUPPLY_EXPENSE_MST A
	JOIN
	(
		SELECT 'IWS' AS XN_TYPE
	)B ON 1=1
	LEFT OUTER JOIN GST_ACCOUNTS_CONFIG_DET_1 A1 ON A1.XN_TYPE+A1.COLUMNNAME=B.XN_TYPE+A.SUPPLY_CODE+'_AC_CODE'
	WHERE A1.XN_TYPE IS NULL
	UNION
	SELECT B.XN_TYPE
	,A.TILL_ID+'_AC_CODE' AS COLUMNNAME,'A/C' AS COLUMNDESC,'0000000000' AS VALUE,'' AS REMARKS,'' AS FILTER_HEAD_CODE,
	A.TILL_NAME +' A/C' AS COLDESC
	FROM TILL_MST A
	JOIN
	(
		SELECT 'TLF' AS XN_TYPE
		UNION
		SELECT 'BTF' AS XN_TYPE
	)B ON 1=1
	LEFT OUTER JOIN GST_ACCOUNTS_CONFIG_DET_1 A1 ON A1.XN_TYPE=B.XN_TYPE AND A1.COLUMNNAME=A.TILL_ID+'_AC_CODE'
	WHERE A1.XN_TYPE IS NULL
	GOTO END_PROC
DET2:
	--SELECT * FROM GST_ACCOUNTS_CONFIG_DET_2 ORDER BY GST_PERCENTAGE
	SELECT GST_PERCENTAGE,XN_TYPE,COLUMNNAME,COLUMNDESC,VALUE,REMARKS,FILTER_HEAD_CODE
	FROM GST_ACCOUNTS_CONFIG_DET_2 
	WHERE XN_TYPE NOT IN ('PTF','BTF','TLF','PTC','CHO_XFR','CHI_XFR') 
	UNION
	SELECT CONVERT(NUMERIC(14,2),0) AS GST_PERCENTAGE,A.XN_TYPE,X.COLUMNNAME,X.COLUMNDESC,
	'0000000000' AS VALUE,'' AS REMARKS,'' AS FILTER_HEAD_CODE
	FROM GST_ACCOUNTS_CONFIG_MST A
	JOIN
	(
		SELECT 'LOCAL_GST_XN_AC_CODE' AS COLUMNNAME,	'LOCAL XN A/C' AS COLUMNDESC		
	)X ON 1=1
	LEFT OUTER JOIN GST_ACCOUNTS_CONFIG_DET_2 B ON B.GST_PERCENTAGE=0
	AND B.XN_TYPE=A.XN_TYPE AND B.COLUMNNAME=X.COLUMNNAME
	WHERE A.XN_TYPE NOT IN ('PTF','BTF','TLF','PTC','CHO_XFR','CHI_XFR') AND B.XN_TYPE IS NULL
	UNION
	SELECT X1.GST_PERCENTAGE,A.XN_TYPE,X.COLUMNNAME,X.COLUMNDESC,
	'0000000000' AS VALUE,'' AS REMARKS,'' AS FILTER_HEAD_CODE
	FROM GST_ACCOUNTS_CONFIG_MST A
	JOIN 
	(
		SELECT DISTINCT TAX_PERCENTAGE AS GST_PERCENTAGE FROM HSN_DET WHERE TAX_PERCENTAGE>0
		UNION
		SELECT DISTINCT RATE_CUTOFF_TAX_PERCENTAGE AS GST_PERCENTAGE FROM HSN_DET WHERE RATE_CUTOFF_TAX_PERCENTAGE>0
	)X1 ON 1=1
	JOIN
	(
		SELECT 'LOCAL_GST_XN_AC_CODE' AS COLUMNNAME,	'LOCAL XN A/C' AS COLUMNDESC
		UNION
		SELECT 'IGST_TAX_AC_CODE' AS COLUMNNAME,	'IGST A/C' AS COLUMNDESC
		UNION
		SELECT 'CGST_TAX_AC_CODE' AS COLUMNNAME,	'CGST A/C' AS COLUMNDESC
		UNION
		SELECT 'SGST_TAX_AC_CODE' AS COLUMNNAME,	'SGST A/C' AS COLUMNDESC
		UNION
		SELECT 'IGST_XN_AC_CODE' AS COLUMNNAME,	'IGST XN A/C' AS COLUMNDESC
	)X ON 1=1
	LEFT OUTER JOIN GST_ACCOUNTS_CONFIG_DET_2 B ON B.GST_PERCENTAGE=X1.GST_PERCENTAGE
	AND B.XN_TYPE=A.XN_TYPE
	AND B.COLUMNNAME=X.COLUMNNAME
	WHERE A.XN_TYPE NOT IN ('PTF','BTF','TLF','PTC','CHO_XFR','CHI_XFR') AND B.XN_TYPE IS NULL
	ORDER BY 	GST_PERCENTAGE,XN_TYPE,COLUMNNAME
	GOTO END_PROC
LEDGER:                    
    EXEC SP3SLEDGER @HEADCODE=@CWHERE
    GOTO END_PROC
END_PROC:

END

