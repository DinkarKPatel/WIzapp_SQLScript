create PROCEDURE VALIDATEXN_IRR
(
		@CXNID VARCHAR(40),
		@NUPDATEMODE INT,					
		@CCMD VARCHAR(1000) OUTPUT
		--*** PARAMETERS :
		--*** @CXNID - TRANSACTION ID ( MEMO ID OF MASTER TABLE )
)
--WITH ENCRYPTION
AS
BEGIN
    DECLARE @NEW_PRODUCT_CODE VARCHAR(50)

	DECLARE @CIRMTABLE TABLE ( IRM_MEMO_ID VARCHAR(22), IRM_MEMO_NO VARCHAR(10), IRM_MEMO_DT DATETIME, 
							   FIN_YEAR VARCHAR(10) )
	
	INSERT @CIRMTABLE
	SELECT IRM_MEMO_ID, IRM_MEMO_NO, IRM_MEMO_DT, FIN_YEAR
	FROM IRM01106 WHERE IRM_MEMO_ID = @CXNID

	SET @CCMD = ''

	IF EXISTS (SELECT IRM_MEMO_ID FROM @CIRMTABLE WHERE FIN_YEAR<>'01'+DBO.FN_GETFINYEAR(IRM_MEMO_DT))
		SET @CCMD=@CCMD+(CASE WHEN @CCMD<>'' THEN ',' ELSE '' END )+'MISMATCH BETWEEN MEMO DATE & FIN YEAR ..... '


	IF EXISTS(SELECT  TOP 1 NEW_PRODUCT_CODE FROM IRD01106 WHERE NEW_PRODUCT_CODE<>'' AND QUANTITY = 0 AND IRM_MEMO_ID = @CXNID)
	BEGIN
	    SELECT TOP 1  @NEW_PRODUCT_CODE=NEW_PRODUCT_CODE FROM IRD01106 WHERE NEW_PRODUCT_CODE<>'' AND QUANTITY=0 AND IRM_MEMO_ID = @CXNID
		SET @CCMD=@CCMD+(CASE WHEN @CCMD<>'' THEN ',' ELSE '' END )+'QUANTITY OF '''+ @NEW_PRODUCT_CODE +''' CAN NOT BE ZERO '

	END

END_PROC:
END
--********************************************** END OF PROCEDURE VALIDATEXN_IRR
