CREATE VIEW  VW_PFESI 
--WITH ENCRYPTION
AS    
SELECT F.PAYSLIP_MONTH, F.PAYSLIP_YEAR, B.DEPT_ID, B.DEPT_ALIAS, B.DEPT_NAME, 
C.DEPARTMENT_ID, C.DEPARTMENT_NAME, A.EMP_ID, A.REF_ID, 
A.EMP_FNAME + ' ' + A.EMP_LNAME AS EMP_NAME, A.PF_ENABLED,
A.ESI_ENABLED, A.PF_AMOUNT, A.BASIC_SALARY, SUM(D.AMOUNT) AS TOTAL_EARNING, 
A.BASIC_SALARY + SUM(D.AMOUNT) AS GROSS_SALARY, A.EMP_STATUS,
0 AS PF_EMP, 0 AS PF_EMPLOYER, 0 AS ESI_EMP, 0 AS ESI_EMPLOYER,
F.SALARY_DAYS, F.MONTH_DAYS, A.CO_ALIAS, '' AS MONTH_NAME,F.NET_SALARY,
ROUND(ROUND(F.NET_SALARY,0) + (F.DEDUCTIONS - F.EMPLOYER_ESI_AMOUNT - F.EMPLOYER_PF_AMOUNT) ,0) AS SALARY
FROM EMP_MST A 
JOIN LOCATION B				(NOLOCK) ON A.DEPT_ID = B.DEPT_ID
JOIN EMP_DEPARTMENT C		(NOLOCK) ON A.DEPARTMENT_ID = C.DEPARTMENT_ID
JOIN EMP_SALARY_PROFILE D	(NOLOCK) ON A.EMP_ID = D.EMP_ID
JOIN EMP_PAY E				(NOLOCK) ON D.PAY_ID = E.PAY_ID
JOIN EMP_PAYSLIP_MST F		(NOLOCK) ON A.EMP_ID = F.EMP_ID
WHERE E.PAY_TYPE = 2 AND F.CANCELLED = 0 AND (A.PF_ENABLED = 1 OR A.ESI_ENABLED = 1)
GROUP BY B.DEPT_ID, B.DEPT_ALIAS, B.DEPT_NAME, C.DEPARTMENT_ID, C.DEPARTMENT_NAME, A.EMP_ID, 
A.REF_ID, A.EMP_FNAME, A.EMP_LNAME, A.EMP_STATUS, A.PF_ENABLED,A.ESI_ENABLED, 
A.PF_AMOUNT, A.BASIC_SALARY,F.PAYSLIP_MONTH, F.PAYSLIP_YEAR, F.SALARY_DAYS, F.MONTH_DAYS,
A.CO_ALIAS,F.NET_SALARY,F.EMPLOYER_ESI_AMOUNT,F.EMPLOYER_PF_AMOUNT,F.DEDUCTIONS
