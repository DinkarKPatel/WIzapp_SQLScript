CREATE FUNCTION DBO.FNIT_MAJORHEADS(@CHEAD_CODE VARCHAR(20))
RETURNS @HEADS TABLE(HEAD_CODE VARCHAR(20))	
--WITH ENCRYPTION
AS
BEGIN
	DECLARE @BEXISTS BIT 
	
	INSERT @HEADS(HEAD_CODE)
	SELECT MAJOR_HEAD_CODE FROM HD01106 WHERE HEAD_CODE=@CHEAD_CODE
	
	SET @BEXISTS=1
	WHILE @BEXISTS=1
	BEGIN
		INSERT @HEADS(HEAD_CODE)
		SELECT MAJOR_HEAD_CODE
		FROM HD01106 WHERE HEAD_CODE IN (SELECT HEAD_CODE FROM @HEADS) 
		AND MAJOR_HEAD_CODE NOT IN (SELECT HEAD_CODE FROM @HEADS)
		
		IF NOT EXISTS(SELECT TOP 1 HEAD_CODE FROM HD01106 WHERE HEAD_CODE IN (SELECT HEAD_CODE FROM @HEADS) 
					  AND MAJOR_HEAD_CODE NOT IN (SELECT HEAD_CODE FROM @HEADS))
		SET @BEXISTS=0			  
	END
RETURN	
END
---END OF FUNCTION - FNIT_MAJORHEADS
