CREATE PROCEDURE SP_GETPRODUCTCODE_PRT 
@CUSERCODE VARCHAR(100),    
@NQTY  NUMERIC(10,2),   
@LOCID VARCHAR(5)='' ,
@CPRODUCTCODE VARCHAR(MAX) 

--WITH ENCRYPTION

AS    
BEGIN    
 
   SELECT DISTINCT TOP 50 SKU.PRODUCT_CODE,SKU.ARTICLE_CODE,
   isnull(P.QUANTITY_IN_STOCK,0) AS [QUANTITY],isnull(P.BIN_ID,'000') as BIN_ID,  
   '' AS JOB_NAME,'' AS WIP_UID,B.BIN_NAME,SKU.PURCHASE_PRICE,ART.ARTICLE_NAME AS [DESC]           
   FROM SKU  (NOLOCK)    
   JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE=SKU.ARTICLE_CODE         
   LEFT OUTER JOIN PMT01106 P (NOLOCK) ON P.PRODUCT_CODE=SKU.PRODUCT_CODE  AND (P.dept_id= @LOCID OR @LOCID= '') 
   LEFT OUTER JOIN BIN B (NOLOCK) ON B.BIN_ID=P.BIN_ID        
   LEFT OUTER JOIN BINUSERS LOC (NOLOCK) ON LOC.BIN_ID=P.BIN_ID AND LOC.USER_CODE=@CUSERCODE      
   WHERE  SKU.PRODUCT_CODE<>''       
   AND (ART.STOCK_NA=1 OR  isnull(P.QUANTITY_IN_STOCK,0)>0)      
   AND @CUSERCODE=(CASE WHEN @CUSERCODE='0000000' THEN @CUSERCODE ELSE isnull(LOC.USER_CODE,@CUSERCODE) END)      
   AND SKU.PRODUCT_CODE LIKE @CPRODUCTCODE      
   ORDER BY SKU.PRODUCT_CODE    
 
END
