CREATE PROCEDURE SP3S_CRT_CUSTOMER_CRM  --(LocId 3 digit change  by Sanjay:04-11-2024)
(  
   @CERRMSG VARCHAR(MAX) OUTPUT,
   @cPmtDbPara VARCHAR(200)=''
)  
--WITH ENCRYPTION  
AS  
BEGIN  
SET NOCOUNT ON   
BEGIN TRY  

  DECLARE @CCMD NVARCHAR(MAX),@CPMTDBNAME VARCHAR(500),@CSTEP VARCHAR(10)
  SET @CSTEP = 10  
 
 IF @cPmtDbPara=''
	SET @CPMTDBNAME=DB_NAME()+'_PMT'  
 ELSE 
	SET @CPMTDBNAME=@cPmtDbPara

 
  IF DB_ID (@CPMTDBNAME) IS  NULL
	RETURN


 SET @CSTEP = 15  
 SET @CCMD=N'IF OBJECT_ID('''+@CPMTDBNAME+'.DBO.CUSTOMER_CRM'',''U'') IS NULL   
    BEGIN  

		 CREATE TABLE '+@CPMTDBNAME+'.DBO.CUSTOMER_CRM  
		 (DEPT_ID VARCHAR(4),DEPT_NAME VARCHAR(200),CUSTOMER_ID VARCHAR(50),MOBILE VARCHAR(50),CUSTOMER_CODE CHAR(12) NOT NULL,  
		 CUSTOMER_NAME VARCHAR(200) NOT NULL,DT_BIRTH DATETIME,DT_ANNIVERSARY DATETIME,DT_CARD_ISSUE DATETIME,  
		 DT_CARD_EXPIRY DATETIME,CARD_NO VARCHAR(50),AREA_NAME VARCHAR(200),CITY VARCHAR(200),STATE VARCHAR(200),  
		 PIN VARCHAR(20),ADDRESS0 VARCHAR(500),ADDRESS1 VARCHAR(500),ADDRESS2 VARCHAR(500),ADDRESS9 VARCHAR(500),  
		 PHONE1 VARCHAR(100),PHONE2 VARCHAR(100),EMAIL VARCHAR(200),DATE_OF_FIRST_VISIT DATETIME,  
		 DATE_OF_LAST_VISIT DATETIME,NO_OF_VISITS NUMERIC(5,0),TOTAL_SPEND NUMERIC(14,2),  
		 FIRST_VISIT_STORE_ID VARCHAR(5),LAST_VISIT_STORE_ID VARCHAR(5),DAYS_SINCE_LAST_VISIT NUMERIC(5,0),  
		 AFD NUMERIC(10,2),ATS NUMERIC(10,2),[ABS] NUMERIC(10,2),CM_ID VARCHAR(40),CM_NO VARCHAR(50),CM_DT DATETIME,  
		 PRODUCT_CODE VARCHAR(50) NOT NULL,CAL_QUANTITY NUMERIC(10,2),CAL_NET_DISCOUNT_AMOUNT NUMERIC(10,2),NET_DISCOUNT_PERCENTAGE NUMERIC(6,2),  
		 MRP NUMERIC(10,2),CAL_NRV NUMERIC(10,2),SECTION_NAME VARCHAR(500),SUB_SECTION_NAME VARCHAR(500),  
		 ARTICLE_NO VARCHAR(500),PARA1_NAME VARCHAR(500),PARA2_NAME VARCHAR(500),PARA3_NAME VARCHAR(500),PARA4_NAME VARCHAR(500),  
		 PARA5_NAME VARCHAR(500),PARA6_NAME VARCHAR(500),MEMBERSHIP_YEARS NUMERIC(3,0),MEMBERSHIP_DAYS NUMERIC(5,0))  
		 CREATE INDEX IX_CRM_CMDT ON '+@CPMTDBNAME+'.DBO.CUSTOMER_CRM (CM_DT)   

      END  
       '  
 PRINT @CCMD  
 EXEC SP_EXECUTESQL @CCMD  
    
 
   
END TRY  
BEGIN CATCH   
 SET @CERRMSG='SP3S_CRT_CUSTOMER_CRM: AT STEP - '+@CSTEP+' ERRMSG : '+ERROR_MESSAGE()  
END CATCH  
END  


