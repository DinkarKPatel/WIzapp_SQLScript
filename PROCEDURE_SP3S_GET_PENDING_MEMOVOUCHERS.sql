CREATE PROCEDURE SP3S_GET_PENDING_MEMOVOUCHERS  
@CACCODE CHAR(10)
AS
BEGIN
	IF OBJECT_ID('TEMPDB..#TMPPENDING','U') IS NOT NULL
		DROP TABLE #TMPPENDING
		
	SELECT DISTINCT A.VM_ID INTO #TMPPENDING FROM VM01106 A (NOLOCK) JOIN VD01106 B (NOLOCK) ON A.VM_ID=B.VM_ID 
	LEFT OUTER JOIN ACC_MEMO_REVERSAL C (NOLOCK) ON C.MEMO_VM_ID=A.VM_ID
	WHERE B.AC_CODE=@CACCODE AND A.VOUCHER_CODE='MEMO000001' AND A.CANCELLED=0
	AND C.MEMO_VM_ID IS NULL	
	
	IF EXISTS (SELECT TOP 1 VM_ID FROM #TMPPENDING)
	BEGIN
		SELECT A.*,CONVERT(BIT,1) AS CHK FROM VM01106 A JOIN #TMPPENDING B ON A.VM_ID=B.VM_ID
		SELECT A.*,CONVERT(BIT,1) AS CHK FROM VD01106 A JOIN #TMPPENDING B ON A.VM_ID=B.VM_ID
	END
	
END


