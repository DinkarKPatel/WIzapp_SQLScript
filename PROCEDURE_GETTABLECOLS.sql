CREATE PROCEDURE GETTABLECOLS
	@CTABLENAME VARCHAR(40),
	@CCOLSLIST VARCHAR(4000) OUTPUT  
--WITH ENCRYPTION	
AS
BEGIN

	DECLARE @CCMD NVARCHAR(4000),@CCOLNAME VARCHAR(100)

	IF EXISTS (SELECT * FROM SYSOBJECTS WHERE NAME=@CTABLENAME)
	BEGIN 	
		DECLARE ABCCOLS CURSOR FOR SELECT NAME FROM SYSCOLUMNS WHERE ID=(SELECT ID FROM SYSOBJECTS WHERE NAME=@CTABLENAME)

		OPEN ABCCOLS
		
		SELECT @CCOLSLIST=''
		FETCH NEXT  FROM ABCCOLS INTO @CCOLNAME
		WHILE @@FETCH_STATUS = 0
		BEGIN
			SELECT @CCOLSLIST=@CCOLSLIST+CASE WHEN @CCOLSLIST='' THEN '' ELSE ',' END+@CCOLNAME
			FETCH NEXT  FROM ABCCOLS  INTO @CCOLNAME
		END	
		CLOSE ABCCOLS
		DEALLOCATE ABCCOLS
	END
	ELSE
		SELECT @CCOLSLIST=''		
END
