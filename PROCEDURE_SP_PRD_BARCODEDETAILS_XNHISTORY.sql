CREATE PROCEDURE SP_PRD_BARCODEDETAILS_XNHISTORY
@CPRODUCTCODE	VARCHAR(MAX),
@NINVMODE		NUMERIC(1)
--WITH ENCRYPTION
AS 
BEGIN
DECLARE @CCMD NVARCHAR(MAX)
SET @CCMD=N'	
SELECT TOP 1 
D.SECTION_NAME AS [SECTION],
C.SUB_SECTION_NAME AS [SUB SECTION],
B.ARTICLE_NO AS [ARTICLE NO],
B.ALIAS AS [ARTICLE ALIAS],
UOM.UOM_NAME AS [UOM],
B.ARTICLE_NAME AS [ARTICLE NAME],
B.ARTICLE_DESC AS [ARTICLE DESCRIPTION],
'''' AS [PRODUCT DESCRIPTION],
E.PARA1_NAME,F.PARA2_NAME,G.PARA3_NAME,H.PARA4_NAME,I.PARA5_NAME,J.PARA6_NAME, 
(CASE WHEN B.CODING_SCHEME=3 THEN ''UNIQUE'' WHEN B.CODING_SCHEME=2 THEN ''LOT'' ELSE ''FIXED'' END ) AS [CODING SCHEME],
A.PURCHASE_PRICE AS [PURCHASE PRICE],
CONVERT(VARCHAR(50),A.INV_DT,105) AS [PURCHASE BILL DATE],
CONVERT(VARCHAR(50),A.RECEIPT_DT,105) AS [PURCHASE RECEIPT DATE],
A.INV_NO AS [BILL NO],
A.MRP,
A.WS_PRICE AS [WHOLESALE PRICE],
''''  AS [IMAGE NAME],
0 AS [TAX AMOUNT],
0 AS [ITEM_TAX_AMOUNT],
A.CHALLAN_NO AS [CHALLAN NO],
0 AS [FIX MRP],
A.PRODUCT_CODE AS [PRODUCT CODE],
(CASE WHEN B.STOCK_NA=1 THEN ''YES'' ELSE ''NO'' END) AS [MAINTAIN STOCK],
ISNULL(PMT.QUANTITY_IN_STOCK,0) AS [STOCK],    
K.AC_NAME  AS [SUPPLIER NAME]  ,
0 AS [OVERHEADS],
''''  AS [ONLINE PRODUCT],'''' AS [VENDOR EAN NO]
FROM PRD_SKU A         
JOIN FORM  (NOLOCK) ON FORM.FORM_ID=A.FORM_ID     
JOIN ARTICLE B ON  A.ARTICLE_CODE= B.ARTICLE_CODE       
JOIN UOM (NOLOCK)  ON UOM.UOM_CODE=B.UOM_CODE
JOIN SECTIOND C ON B.SUB_SECTION_CODE= C.SUB_SECTION_CODE      
JOIN SECTIONM D ON C.SECTION_CODE= D.SECTION_CODE      
JOIN PARA1 E ON A.PARA1_CODE= E.PARA1_CODE      
JOIN PARA2 F ON A.PARA2_CODE= F.PARA2_CODE      
JOIN PARA3 G ON A.PARA3_CODE= G.PARA3_CODE      
JOIN PARA4 H ON A.PARA4_CODE= H.PARA4_CODE      
JOIN PARA5 I ON A.PARA5_CODE= I.PARA5_CODE      
JOIN PARA6 J ON A.PARA6_CODE= J.PARA6_CODE      
JOIN LMV01106  K ON A.AC_CODE= K.AC_CODE    
LEFT OUTER JOIN PRD_PMT PMT ON A.PRODUCT_UID = PMT.PRODUCT_UID         
WHERE '''+@CPRODUCTCODE+'''='+(CASE WHEN @NINVMODE=3 THEN 'G.PARA3_NAME' WHEN @NINVMODE=2 THEN 'B.ARTICLE_NO' ELSE 'A.PRODUCT_CODE' END)
--WHERE G.PARA3_NAME='''+@CPRODUCTCODE+''' OR B.ARTICLE_NO='''+@CPRODUCTCODE+''' OR A.PRODUCT_CODE='''+@CPRODUCTCODE+''''
--(CASE WHEN @NINVMODE=3 THEN 'PARA3.PARA3_NAME' WHEN @NINVMODE=2 THEN 'B.ARTICLE_NO' ELSE 'A.PRODUCT_CODE' END)

PRINT @CCMD

EXEC SP_EXECUTESQL @CCMD
  
END
