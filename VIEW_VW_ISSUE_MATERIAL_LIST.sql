CREATE VIEW VW_ISSUE_MATERIAL_LIST 

AS 
	SELECT DISTINCT T1.MEMO_NO 
	,T1.MEMO_DT AS MEMO_DATE 
	,ISNULL(T6.MEMO_NO,'') AS WORK_ORDER_MEMO_NO
	,(CASE WHEN T6.MEMO_DT <> '' THEN CONVERT(CHAR(10)
	,ISNULL(T6.MEMO_DT,''),105) ELSE ''  END) AS WORK_ORDER_DATE
	,ISNULL(T6.REF_NO,'') AS WORK_ORDER_REFNO
	,T3.DEPARTMENT_NAME AS TARGET_DEPARTMENT_NAME
	,ISNULL(J.JOB_NAME,'') AS JOB_NAME
	,CASE WHEN T1.CANCELLED =0 THEN '' ELSE 'CANCELLED' END AS CANCELLED
	,(CASE WHEN T1.ISSUE_TYPE = 0 THEN 'ISSUE ORDER' WHEN T1.ISSUE_TYPE = 1 THEN 'ISSUE ORDER OUTPUT' ELSE 'ISSUE DIRECT' END ) AS ISSUE_TYPE 
	,T2.USERNAME AS USER_NAME 
	,T1.SOURCE_DEPARTMENT_ID,T1.MEMO_ID ,T1.FIN_YEAR 
	FROM PRD_ISSUE_MATERIAL_MST T1
	JOIN  PRD_ISSUE_MATERIAL_DET  DET ON T1.MEMO_ID =DET .MEMO_ID 
	JOIN USERS T2 ON T1.USER_CODE = T2.USER_CODE
	JOIN PRD_DEPARTMENT_MST T3 ON T3.DEPARTMENT_ID = T1.TARGET_DEPARTMENT_ID
	JOIN JOBS J ON J.JOB_CODE=DET.JOB_CODE
	LEFT OUTER JOIN PRD_WO_MST T6 ON DET.REF_PRD_WORKORDER_MEMOID= T6.MEMO_ID
