CREATE PROCEDURE SP3S_GET_POSTING_BLANKAC
@CXNTYPE VARCHAR(40),
@NLOOP NUMERIC(1,0)=0,
@BCALLEDFROMDEBUG BIT=0,
@CERRORMSG VARCHAR(1000) OUTPUT,@BBLANKACFOUND BIT OUTPUT
AS
BEGIN
	DECLARE @BERRORFOUND BIT,@CCMD NVARCHAR(MAX),@CSTEP VARCHAR(4),@CDISCACCODE CHAR(10),@CROUNDOFFACCODE CHAR(10),
	@BDONOTPOSTCDENTRY BIT,@BPOSTREVENUESECTIONWISE BIT,@BPOSTREVENUESUBSECTIONWISE BIT,@BFREIGHTAPPLICABLE BIT,
	@BOTHERCHARGESAPPLICABLE BIT,@BINSURANCEAPPLICABLE BIT,@BPAYMODEAPPLICABLE BIT,@BITEMGSTAPPLICABLE BIT,
	@BOTHERACCOUNTSAPPLICABLE BIT,@CORGXNTYPE VARCHAR(20),@BPACKINGAPPLICABLE BIT,@bRcmApplicable BIT,@bCustomDutyApplicable BIT,
	@bTcsApplicable BIT,@bGstCessApplicable BIT,@BPOSTGstCessSECTIONWISE BIT,@BPOSTGstCessSubSECTIONWISE BIT
	
	SELECT @BFREIGHTAPPLICABLE=0,@BOTHERCHARGESAPPLICABLE=0,@BOTHERCHARGESAPPLICABLE=0,@BINSURANCEAPPLICABLE=0,
		   @BPAYMODEAPPLICABLE=0,@BOTHERACCOUNTSAPPLICABLE=1,@BPACKINGAPPLICABLE=0,@bCustomDutyApplicable=0	
	
	SELECT @CORGXNTYPE=POSTING_XN_TYPE FROM GST_ACCOUNTS_CONFIG_MST WHERE XN_TYPE=@CXNTYPE			
		
	IF LEFT(@CORGXNTYPE,3)	IN ('PUR','PRT','WSL','WSR','XFR')
		SELECT @BFREIGHTAPPLICABLE=1,@BOTHERCHARGESAPPLICABLE=1,@BITEMGSTAPPLICABLE=1,@bGstCessApplicable=1
	
	IF LEFT(@CORGXNTYPE,3)	IN ('PUR')
		SET @bCustomDutyApplicable=1
		
	IF LEFT(@CORGXNTYPE,3)	IN ('PUR')
		SELECT @bRcmApplicable=1

	IF LEFT(@CORGXNTYPE,3)	IN ('WSL','PUR')
		SET @bTcsApplicable=1
	
	IF @cOrgXnType IN ('JWR')
		SELECT @BITEMGSTAPPLICABLE=1,@BOTHERCHARGESAPPLICABLE=1	,@BFREIGHTAPPLICABLE=1
		
	IF LEFT(@CORGXNTYPE,3)='SLS'
		SELECT @BOTHERCHARGESAPPLICABLE=1,@BITEMGSTAPPLICABLE=1, @bGstCessApplicable=1

	IF LEFT(@CORGXNTYPE,3)='ARC'
		SELECT @BITEMGSTAPPLICABLE=1
		
	IF LEFT(@CORGXNTYPE,3) IN ('WSL','WSR','XFR')
		SELECT @BINSURANCEAPPLICABLE=1
	
	IF LEFT(@CORGXNTYPE,3) IN ('SLS','ARC','WSL','WSR') 
		SET @BPAYMODEAPPLICABLE=1					
		
	SELECT TOP 1 @BPOSTREVENUESECTIONWISE=ISNULL(POST_REVENUEGST_SECTION_WISE,0),
	@BPOSTREVENUESUBSECTIONWISE=ISNULL(POST_REVENUEGST_SUBSECTION_WISE,0),
	@BPOSTGstCessSECTIONWISE=ISNULL(POST_GstCess_SECTION_WISE,0),
	@BPOSTGstCessSubSECTIONWISE=ISNULL(POST_GstCess_SubSECTION_WISE,0)
	FROM GST_ACCOUNTS_CONFIG_MST WHERE XN_TYPE=@CXNTYPE
	
	
	IF @BPOSTREVENUESUBSECTIONWISE=1
		SET @BPOSTREVENUESECTIONWISE=1
			
    SELECT @BERRORFOUND=0,@CERRORMSG='',@BDONOTPOSTCDENTRY=0,@CERRORMSG='',@BBLANKACFOUND=0

BEGIN TRY
	SET @CSTEP = '10'
	
	IF LEFT(@CORGXNTYPE,3)='PUR'
		SELECT @BDONOTPOSTCDENTRY=ISNULL(DONOT_POST_CD_PURCHASE,0) FROM GST_ACCOUNTS_CONFIG_MST WHERE XN_TYPE='PUR' 
	
	IF @BITEMGSTAPPLICABLE=1
	BEGIN
		SET @CSTEP = '12'
		SET @CCMD=N'UPDATE A SET IGST_REVENUE_AC_CODE=B.IGST_REVENUE_AC_CODE,
					LGST_REVENUE_AC_CODE=B.LGST_REVENUE_AC_CODE,
					IGST_TAX_AC_CODE=B.IGST_TAX_AC_CODE,
					SGST_TAX_AC_CODE=B.SGST_TAX_AC_CODE,
					CGST_TAX_AC_CODE=B.CGST_TAX_AC_CODE
					FROM #V_PROCESS A 
					JOIN GST_ACCOUNTS_CONFIG_DET_REVENUE B ON A.GST_PERCENTAGE=B.GST_PERCENTAGE '+
				  (CASE WHEN @BPOSTREVENUESECTIONWISE=1 THEN ' AND A.SECTION_CODE=B.SECTION_CODE ' ELSE ' AND b.section_code IN (''0000000'','''') ' END)+
				  (CASE WHEN @BPOSTREVENUESUBSECTIONWISE=1 THEN ' AND A.SUB_SECTION_CODE=B.SUB_SECTION_CODE ' ELSE ' AND b.sub_section_code IN (''0000000'','''')' END)+
				  ' WHERE B.XN_TYPE=A.POSTING_XN_TYPE'
		PRINT @cCmd		  
		EXEC SP_EXECUTESQL @CCMD

	END

	IF @bGstCessApplicable=1
	BEGIN
		SET @CSTEP = '12.5'
		SET @CCMD=N'UPDATE A SET GST_CESS_AC_CODE=ISNULL(B.GST_CESS_AC_CODE,''0000000000'')
					FROM #V_PROCESS A 
					JOIN GST_ACCOUNTS_CONFIG_DET_CESS B ON A.gst_cess_percentage=B.gst_cess_percentage '+
				  (CASE WHEN @BPOSTGstCessSECTIONWISE=1 THEN ' AND A.SECTION_CODE=B.SECTION_CODE ' ELSE ' AND b.section_code IN (''0000000'','''') ' END)+
				  (CASE WHEN @BPOSTGstCessSUBSECTIONWISE=1 THEN ' AND A.SUB_SECTION_CODE=B.SUB_SECTION_CODE ' ELSE ' AND b.section_code IN (''0000000'','''') ' END)+
				  ' WHERE B.XN_TYPE=A.POSTING_XN_TYPE'
		PRINT @cCmd		  
		EXEC SP_EXECUTESQL @CCMD
	END
	
	IF @bRcmApplicable=1
	BEGIN
		SET @CSTEP = '14'
		SET @CCMD=N'UPDATE A SET IGST_TAX_AC_CODE=B.IGST_TAX_AC_CODE,
					SGST_TAX_AC_CODE=B.SGST_TAX_AC_CODE,
					CGST_TAX_AC_CODE=B.CGST_TAX_AC_CODE
					FROM #V_PROCESS_RCM A 
					JOIN GST_ACCOUNTS_CONFIG_DET_REVENUE B ON A.GST_PERCENTAGE=B.GST_PERCENTAGE '+
				  (CASE WHEN @BPOSTREVENUESECTIONWISE=1 THEN ' AND A.SECTION_CODE=B.SECTION_CODE ' ELSE ' AND b.section_code IN (''0000000'','''')' END)+
				  (CASE WHEN @BPOSTREVENUESUBSECTIONWISE=1 THEN ' AND A.SUB_SECTION_CODE=B.SUB_SECTION_CODE ' ELSE ' AND b.sub_section_code IN (''0000000'','''')' END)+
				  ' WHERE B.XN_TYPE=A.POSTING_XN_TYPE'
		PRINT @cCmd		  
		EXEC SP_EXECUTESQL @CCMD
	END
		
	IF @BFREIGHTAPPLICABLE=1
	BEGIN
		SET @CSTEP = '17'
		SET @CCMD=N'UPDATE A SET FREIGHT_IGST_REVENUE_AC_CODE=B.IGST_REVENUE_AC_CODE,
					FREIGHT_LGST_REVENUE_AC_CODE=B.LGST_REVENUE_AC_CODE,
					FREIGHT_IGST_TAX_AC_CODE=B.IGST_TAX_AC_CODE,
					FREIGHT_SGST_TAX_AC_CODE=B.SGST_TAX_AC_CODE,
					FREIGHT_CGST_TAX_AC_CODE=B.CGST_TAX_AC_CODE
					FROM #V_PROCESS A 
					JOIN GST_ACCOUNTS_CONFIG_DET_OVERHEADS B ON A.FREIGHT_GST_PERCENTAGE=B.GST_PERCENTAGE
					WHERE B.XN_TYPE=A.POSTING_XN_TYPE+''FREIGHT'''
		EXEC SP_EXECUTESQL @CCMD
	END
	
	IF @BOTHERCHARGESAPPLICABLE=1
	BEGIN	
		SET @CSTEP = '20'
		SET @CCMD=N'UPDATE A SET OTHER_CHARGES_IGST_REVENUE_AC_CODE=B.IGST_REVENUE_AC_CODE,
					OTHER_CHARGES_LGST_REVENUE_AC_CODE=B.LGST_REVENUE_AC_CODE,
					OTHER_CHARGES_IGST_TAX_AC_CODE=B.IGST_TAX_AC_CODE,
					OTHER_CHARGES_SGST_TAX_AC_CODE=B.SGST_TAX_AC_CODE,
					OTHER_CHARGES_CGST_TAX_AC_CODE=B.CGST_TAX_AC_CODE
					FROM #V_PROCESS A 
					JOIN GST_ACCOUNTS_CONFIG_DET_OVERHEADS B ON A.OTHER_CHARGES_GST_PERCENTAGE=B.GST_PERCENTAGE
					WHERE B.XN_TYPE=A.POSTING_XN_TYPE+''OC'''
		EXEC SP_EXECUTESQL @CCMD
	END
	
	IF @bCustomDutyApplicable=1
	BEGIN	
	--custom_duty_payable_ac_code=B.custom_duty_payable_ac_code,
		SET @CSTEP = '25'
		SET @CCMD=N'UPDATE A SET custom_duty_expense_ac_code=B.IGST_REVENUE_AC_CODE,
					custom_duty_tax_ac_code=B.IGST_TAX_AC_CODE
					FROM #V_PROCESS A 
					JOIN GST_ACCOUNTS_CONFIG_DET_OVERHEADS B ON A.forex_GST_PERCENTAGE=B.GST_PERCENTAGE
					WHERE B.XN_TYPE=A.POSTING_XN_TYPE+''CDUTY'''
		EXEC SP_EXECUTESQL @CCMD
	END
	
	IF @BINSURANCEAPPLICABLE=1
	BEGIN
		SET @CSTEP = '30'
		SET @CCMD=N'UPDATE A SET INSURANCE_IGST_REVENUE_AC_CODE=B.IGST_REVENUE_AC_CODE,
					INSURANCE_LGST_REVENUE_AC_CODE=B.LGST_REVENUE_AC_CODE,
					INSURANCE_IGST_TAX_AC_CODE=B.IGST_TAX_AC_CODE,
					INSURANCE_SGST_TAX_AC_CODE=B.SGST_TAX_AC_CODE,
					INSURANCE_CGST_TAX_AC_CODE=B.CGST_TAX_AC_CODE
					FROM #V_PROCESS A 
					JOIN GST_ACCOUNTS_CONFIG_DET_OVERHEADS B ON A.INSURANCE_GST_PERCENTAGE=B.GST_PERCENTAGE
					WHERE B.XN_TYPE=A.POSTING_XN_TYPE+''INSURANCE'''
		EXEC SP_EXECUTESQL @CCMD
	END

	
	IF @BPAYMODEAPPLICABLE=1
	BEGIN

		SET @CSTEP = '32'
		SET @CCMD=N'UPDATE A SET AC_CODE=B.VALUE
					FROM #V_PROCESS_PAYMODES A 
					JOIN GST_ACCOUNTS_CONFIG_DET_PAYMODES B ON A.COLUMNNAME=B.COLUMNNAME'
		EXEC SP_EXECUTESQL @CCMD


	END

	--IF @bTcsApplicable=1
	--BEGIN

	--	SET @CSTEP = '35'
	--	SET @CCMD=N'UPDATE A SET tcs_AC_CODE=ISNULL(B.tcs_AC_CODE,''0000000000'')
	--				FROM #V_PROCESS_OTHERS A 
	--				JOIN GST_ACCOUNTS_CONFIG_DET_OTHERS B ON a.xn_type=b.xn_type
	--				WHERE b.columnname=''tcs_ac_code'''
	--	EXEC SP_EXECUTESQL @CCMD


	--END
	
	IF @NLOOP>=1
		GOTO END_PROC
	
	SET @CSTEP = '37'	
	DECLARE @NSPID NUMERIC(4,0)=@@SPID
	
	DELETE FROM GST_ACCOUNTS_CONFIG_DET_CESS_UPLOAD WHERE SP_ID=@NSPID
	DELETE FROM GST_ACCOUNTS_CONFIG_DET_REVENUE_UPLOAD WHERE SP_ID=@NSPID
	DELETE FROM GST_ACCOUNTS_CONFIG_DET_OVERHEADS_UPLOAD WHERE SP_ID=@NSPID
	DELETE FROM GST_ACCOUNTS_CONFIG_DET_OTHERS_UPLOAD WHERE SP_ID=@NSPID
	DELETE FROM GST_ACCOUNTS_CONFIG_DET_PAYMODES_UPLOAD WHERE SP_ID=@NSPID
									
	IF @BITEMGSTAPPLICABLE=1
	BEGIN
	
		SET @CSTEP = '40'
				
		SELECT DISTINCT POSTING_XN_TYPE AS XN_TYPE,isnull(GST_PERCENTAGE,0) gst_percentage,(CASE WHEN @BPOSTREVENUESECTIONWISE=1 THEN SECTION_CODE ELSE '0000000' END) AS SECTION_CODE,
		(CASE WHEN @BPOSTREVENUESUBSECTIONWISE=1 THEN SUB_SECTION_CODE ELSE '0000000' END) AS  SUB_SECTION_CODE, 
		IGST_REVENUE_AC_CODE, LGST_REVENUE_AC_CODE, IGST_TAX_AC_CODE, CGST_TAX_AC_CODE, SGST_TAX_AC_CODE,convert(varchar(40),'') row_id
		INTO #TMPERRORS1 FROM #V_PROCESS 
		
		UPDATE #TMPERRORS1 set row_id=convert(varchar(40),newid())

		IF @bRcmApplicable=1
		BEGIN
			SET @CSTEP = '45'
			SET @cCmd=N'INSERT #TMPERRORS1 (xn_type,gst_percentage,SECTION_CODE,SUB_SECTION_CODE,IGST_REVENUE_AC_CODE,LGST_REVENUE_AC_CODE,
			IGST_TAX_AC_CODE,CGST_TAX_AC_CODE,SGST_TAX_AC_CODE,row_id)
			SELECT DISTINCT POSTING_XN_TYPE AS XN_TYPE,GST_PERCENTAGE,'+
			(CASE WHEN @BPOSTREVENUESECTIONWISE=1 THEN 'SECTION_CODE' ELSE '''0000000''' END)+' AS SECTION_CODE,'+
			(CASE WHEN @BPOSTREVENUESUBSECTIONWISE=1 THEN 'SUB_SECTION_CODE' ELSE '''0000000''' END)+' AS  SUB_SECTION_CODE, 
			''0000000000'' as IGST_REVENUE_AC_CODE,''0000000000'' as  LGST_REVENUE_AC_CODE,
			IGST_TAX_AC_CODE, CGST_TAX_AC_CODE, SGST_TAX_AC_CODE,NEWID() AS ROW_ID FROM #V_PROCESS_RCM '
			
			EXEC SP_EXECUTESQL @cCmd
		END

		print 'update revenue accounts for blank one'		
		SET @CSTEP = '50'
		UPDATE A SET IGST_REVENUE_AC_CODE=B.IGST_REVENUE_AC_CODE
		FROM #TMPERRORS1 A JOIN #TMPERRORS1 B ON  A.GST_PERCENTAGE=B.GST_PERCENTAGE AND A.SECTION_CODE=B.SECTION_CODE AND A.SUB_SECTION_CODE=B.SUB_SECTION_CODE
		WHERE A.IGST_REVENUE_AC_CODE='0000000000' AND B.IGST_REVENUE_AC_CODE NOT IN ('','0000000000')

		
		SET @CSTEP = '60'
		UPDATE A SET LGST_REVENUE_AC_CODE=B.LGST_REVENUE_AC_CODE
		FROM #TMPERRORS1 A JOIN #TMPERRORS1 B ON  A.GST_PERCENTAGE=B.GST_PERCENTAGE AND A.SECTION_CODE=B.SECTION_CODE AND A.SUB_SECTION_CODE=B.SUB_SECTION_CODE
		WHERE A.LGST_REVENUE_AC_CODE='0000000000' AND B.LGST_REVENUE_AC_CODE NOT IN ('','0000000000')
		


		SET @CSTEP = '65'
		UPDATE A SET IGST_TAX_AC_CODE=B.IGST_TAX_AC_CODE
		FROM #TMPERRORS1 A JOIN #TMPERRORS1 B ON  A.GST_PERCENTAGE=B.GST_PERCENTAGE AND A.SECTION_CODE=B.SECTION_CODE AND A.SUB_SECTION_CODE=B.SUB_SECTION_CODE
		WHERE A.IGST_TAX_AC_CODE='0000000000' AND B.IGST_TAX_AC_CODE NOT IN ('','0000000000')
		
		SET @CSTEP = '67'
		UPDATE A SET CGST_TAX_AC_CODE=B.IGST_TAX_AC_CODE
		FROM #TMPERRORS1 A JOIN #TMPERRORS1 B ON  A.GST_PERCENTAGE=B.GST_PERCENTAGE AND A.SECTION_CODE=B.SECTION_CODE AND A.SUB_SECTION_CODE=B.SUB_SECTION_CODE
		WHERE A.CGST_TAX_AC_CODE='0000000000' AND B.CGST_TAX_AC_CODE NOT IN ('','0000000000')
		
		SET @CSTEP = '70'
		UPDATE A SET SGST_TAX_AC_CODE=B.SGST_TAX_AC_CODE
		FROM #TMPERRORS1 A JOIN #TMPERRORS1 B ON  A.GST_PERCENTAGE=B.GST_PERCENTAGE AND A.SECTION_CODE=B.SECTION_CODE AND A.SUB_SECTION_CODE=B.SUB_SECTION_CODE
		WHERE A.SGST_TAX_AC_CODE='0000000000' AND B.SGST_TAX_AC_CODE NOT IN ('','0000000000')
		
		SET @CSTEP = '73'
		DELETE A FROM #TMPERRORS1 A WHERE ROW_ID<>(SELECT TOP 1 B.ROW_ID FROM #TMPERRORS1 B WHERE
		B.GST_PERCENTAGE=A.GST_PERCENTAGE AND B.SECTION_CODE=A.SECTION_CODE AND B.SUB_SECTION_CODE=A.SUB_SECTION_CODE
		AND a.XN_TYPE=b.XN_TYPE)
		
		SET @CSTEP = '75'
		INSERT GST_ACCOUNTS_CONFIG_DET_REVENUE_UPLOAD	(SP_ID, XN_TYPE, GST_PERCENTAGE, SECTION_CODE, 
		SUB_SECTION_CODE, IGST_REVENUE_AC_CODE,LGST_REVENUE_AC_CODE, IGST_TAX_AC_CODE, CGST_TAX_AC_CODE, 
		SGST_TAX_AC_CODE)  
		SELECT DISTINCT @NSPID AS SP_ID,XN_TYPE,ISNULL(GST_PERCENTAGE,0),SECTION_CODE, 
		SUB_SECTION_CODE, IGST_REVENUE_AC_CODE,LGST_REVENUE_AC_CODE, IGST_TAX_AC_CODE, CGST_TAX_AC_CODE, 
		SGST_TAX_AC_CODE FROM #TMPERRORS1
		
		--SELECT 'CHECK GST_ACCOUNTS_CONFIG_DET_REVENUE_UPLOAD',* FROM GST_ACCOUNTS_CONFIG_DET_REVENUE_UPLOAD
		--WHERE SP_ID=@NSPID
	END

	IF @BGstCessAppLICABLE=1
	BEGIN
		SET @CSTEP = '77'
		SELECT DISTINCT POSTING_XN_TYPE AS XN_TYPE,gst_cess_percentage,(CASE WHEN @BPOSTGSTCESSSECTIONWISE=1 THEN SECTION_CODE ELSE '0000000' END) AS SECTION_CODE,
		(CASE WHEN @BPOSTGSTCESSSUBSECTIONWISE=1 THEN SUB_SECTION_CODE ELSE '0000000' END) AS  SUB_SECTION_CODE, 
		GST_CESS_AC_CODE,convert(varchar(40),'') AS ROW_ID 
		INTO #TMPERRORS0 FROM #V_PROCESS 

		UPDATE #TMPERRORS0 set row_id=convert(varchar(40),newid())

		SET @CSTEP = '80'
		UPDATE A SET GST_CESS_AC_CODE=B.GST_CESS_AC_CODE
		FROM #TMPERRORS0 A JOIN #TMPERRORS0 B ON  A.gst_cess_percentage=B.gst_cess_percentage AND A.SECTION_CODE=B.SECTION_CODE AND A.SUB_SECTION_CODE=B.SUB_SECTION_CODE
		WHERE A.GST_CESS_AC_CODE='0000000000' AND B.GST_CESS_AC_CODE NOT IN ('','0000000000')		

		SET @CSTEP = '82'
		DELETE A FROM #TMPERRORS0 A WHERE ROW_ID<>(SELECT TOP 1 B.ROW_ID FROM #TMPERRORS0 B WHERE
		B.gst_cess_percentage=A.gst_cess_percentage AND B.SECTION_CODE=A.SECTION_CODE AND B.SUB_SECTION_CODE=A.SUB_SECTION_CODE
		AND a.XN_TYPE=b.XN_TYPE)
		
		SET @CSTEP = '85'
		INSERT GST_ACCOUNTS_CONFIG_DET_CESS_UPLOAD	(SP_ID, XN_TYPE, gst_cess_percentage, SECTION_CODE,SUB_SECTION_CODE, GST_CESS_AC_CODE)  
		SELECT DISTINCT @NSPID AS SP_ID,XN_TYPE,ISNULL(gst_cess_percentage,0),SECTION_CODE, 
		SUB_SECTION_CODE, GST_CESS_AC_CODE FROM #TMPERRORS0

	END			

	IF @BOTHERCHARGESAPPLICABLE=1 OR @BFREIGHTAPPLICABLE=1 OR @BINSURANCEAPPLICABLE=1 OR @bCustomDutyApplicable=1
	BEGIN
		IF OBJECT_ID('TEMPDB..#TMPERRORS2','U') IS NOT NULL
			DROP TABLE #TMPERRORS2
		
		SET @CSTEP = '105'
		SELECT DISTINCT CONVERT(VARCHAR(30),XN_TYPE+'OC')  AS XN_TYPE,
		GST_PERCENTAGE AS GST_PERCENTAGE,igst_revenue_ac_Code AS IGST_REVENUE_AC_CODE,
		igst_revenue_ac_Code AS LGST_REVENUE_AC_CODE,igst_revenue_ac_Code AS IGST_TAX_AC_CODE,
		igst_revenue_ac_Code AS CGST_TAX_AC_CODE,igst_revenue_ac_Code AS SGST_TAX_AC_CODE ,NEWID() AS ROW_ID
		INTO #TMPERRORS2 FROM gst_accounts_config_det_revenue WHERE 1=2
		
		SET @CSTEP = '107'
		SET @cCmd=N'SELECT DISTINCT CONVERT(VARCHAR(30),POSTING_XN_TYPE+''OC'')  AS XN_TYPE,OTHER_CHARGES_GST_PERCENTAGE AS GST_PERCENTAGE,OTHER_CHARGES_IGST_REVENUE_AC_CODE AS IGST_REVENUE_AC_CODE,
		OTHER_CHARGES_LGST_REVENUE_AC_CODE AS LGST_REVENUE_AC_CODE,OTHER_CHARGES_IGST_TAX_AC_CODE AS IGST_TAX_AC_CODE,
		OTHER_CHARGES_CGST_TAX_AC_CODE AS CGST_TAX_AC_CODE,OTHER_CHARGES_SGST_TAX_AC_CODE AS SGST_TAX_AC_CODE ,NEWID() AS ROW_ID
		FROM #V_PROCESS WHERE OTHERCHARGES<>0'

		INSERT #TMPERRORS2		
		EXEC SP_EXECUTESQL @CCMD
				
		IF @BFREIGHTAPPLICABLE=1
		BEGIN			
			SET @CSTEP = '110'
			SET @CCMD=N'SELECT DISTINCT POSTING_XN_TYPE+''FREIGHT'' AS XN_TYPE,FREIGHT_GST_PERCENTAGE AS GST_PERCENTAGE,FREIGHT_IGST_REVENUE_AC_CODE AS IGST_REVENUE_AC_CODE,
			FREIGHT_LGST_REVENUE_AC_CODE AS LGST_REVENUE_AC_CODE,FREIGHT_IGST_TAX_AC_CODE AS IGST_TAX_AC_CODE,
			FREIGHT_CGST_TAX_AC_CODE AS CGST_TAX_AC_CODE,FREIGHT_SGST_TAX_AC_CODE AS SGST_TAX_AC_CODE,NEWID() AS ROW_ID 
			FROM #V_PROCESS WHERE  FREIGHT<>0'
			
			INSERT #TMPERRORS2
			EXEC SP_EXECUTESQL @CCMD
			
		END
		
		
		IF @BINSURANCEAPPLICABLE=1
		BEGIN	
			SET @CSTEP = '115'
			SET @CCMD=N'SELECT DISTINCT POSTING_XN_TYPE+''INSURANCE'' AS XN_TYPE,INSURANCE_GST_PERCENTAGE AS GST_PERCENTAGE,
			INSURANCE_IGST_REVENUE_AC_CODE AS IGST_REVENUE_AC_CODE,
			INSURANCE_LGST_REVENUE_AC_CODE AS LGST_REVENUE_AC_CODE,INSURANCE_IGST_TAX_AC_CODE AS IGST_TAX_AC_CODE,
			INSURANCE_CGST_TAX_AC_CODE AS CGST_TAX_AC_CODE,INSURANCE_SGST_TAX_AC_CODE AS SGST_TAX_AC_CODE ,NEWID() AS ROW_ID
			FROM #V_PROCESS WHERE  INSURANCE<>0'

			INSERT #TMPERRORS2
			EXEC SP_EXECUTESQL @CCMD			
		END
	
		IF @bCustomDutyApplicable=1
		BEGIN			
			SET @CSTEP = '110'
			SET @CCMD=N'SELECT DISTINCT POSTING_XN_TYPE+''CDUTY'' AS XN_TYPE,FOREX_GST_PERCENTAGE AS GST_PERCENTAGE,
			custom_duty_expense_ac_code AS IGST_REVENUE_AC_CODE,
			''0000000000'' AS LGST_REVENUE_AC_CODE,custom_duty_tax_ac_code AS IGST_TAX_AC_CODE,
			''0000000000'' AS CGST_TAX_AC_CODE,''0000000000'' AS SGST_TAX_AC_CODE,NEWID() AS ROW_ID 
			FROM #V_PROCESS WHERE  ISNULL(Forex_customdutyamt,0)<>0'
			
			INSERT #TMPERRORS2
			EXEC SP_EXECUTESQL @CCMD
			
		END
		
		SET @CSTEP = '120'
		UPDATE A SET IGST_REVENUE_AC_CODE=B.IGST_REVENUE_AC_CODE
		FROM #TMPERRORS2 A JOIN #TMPERRORS2 B ON A.GST_PERCENTAGE=B.GST_PERCENTAGE AND A.XN_TYPE=B.XN_TYPE
		WHERE A.IGST_REVENUE_AC_CODE='0000000000' AND B.IGST_REVENUE_AC_CODE NOT IN ('','0000000000')

		UPDATE A SET LGST_REVENUE_AC_CODE=B.LGST_REVENUE_AC_CODE
		FROM #TMPERRORS2 A JOIN #TMPERRORS2 B ON A.GST_PERCENTAGE=B.GST_PERCENTAGE AND A.XN_TYPE=B.XN_TYPE
		WHERE A.LGST_REVENUE_AC_CODE='0000000000' AND B.LGST_REVENUE_AC_CODE NOT IN ('','0000000000')
		
		SET @CSTEP = '130'
		UPDATE A SET IGST_TAX_AC_CODE=B.IGST_TAX_AC_CODE
		FROM #TMPERRORS2 A JOIN #TMPERRORS2 B ON A.GST_PERCENTAGE=B.GST_PERCENTAGE AND A.XN_TYPE=B.XN_TYPE
		WHERE A.IGST_TAX_AC_CODE='0000000000' AND B.IGST_TAX_AC_CODE NOT IN ('','0000000000')

		UPDATE A SET CGST_TAX_AC_CODE=B.IGST_TAX_AC_CODE
		FROM #TMPERRORS2 A JOIN #TMPERRORS2 B ON A.GST_PERCENTAGE=B.GST_PERCENTAGE AND A.XN_TYPE=B.XN_TYPE
		WHERE A.CGST_TAX_AC_CODE='0000000000' AND B.CGST_TAX_AC_CODE NOT IN ('','0000000000')
		
		SET @CSTEP = '140'
		UPDATE A SET SGST_TAX_AC_CODE=B.SGST_TAX_AC_CODE
		FROM #TMPERRORS2 A JOIN #TMPERRORS2 B ON A.GST_PERCENTAGE=B.GST_PERCENTAGE AND A.XN_TYPE=B.XN_TYPE
		WHERE A.SGST_TAX_AC_CODE='0000000000' AND B.SGST_TAX_AC_CODE NOT IN ('','0000000000')
		
		DELETE A FROM #TMPERRORS2 A WHERE ROW_ID<>(SELECT TOP 1 B.ROW_ID FROM #TMPERRORS2 B WHERE
		B.GST_PERCENTAGE=A.GST_PERCENTAGE AND B.XN_TYPE=A.XN_TYPE)

		SET @CSTEP = '145'

				
		INSERT GST_ACCOUNTS_CONFIG_DET_OVERHEADS_UPLOAD	( SP_ID, XN_TYPE, GST_PERCENTAGE, IGST_REVENUE_AC_CODE, 
		LGST_REVENUE_AC_CODE, IGST_TAX_AC_CODE, CGST_TAX_AC_CODE, SGST_TAX_AC_CODE )  
		SELECT @NSPID AS SP_ID, XN_TYPE, GST_PERCENTAGE, IGST_REVENUE_AC_CODE, LGST_REVENUE_AC_CODE, IGST_TAX_AC_CODE, 
		CGST_TAX_AC_CODE, SGST_TAX_AC_CODE FROM #TMPERRORS2
		
	END
		
	SET @CSTEP = '170'

	
	IF @BOTHERACCOUNTSAPPLICABLE=1
	BEGIN
		INSERT GST_ACCOUNTS_CONFIG_DET_OTHERS_UPLOAD	( SP_ID, XN_TYPE, COLUMNNAME, COLUMNDESC, VALUE )  		
		SELECT @NSPID AS SP_ID,A.XN_TYPE,A.COLUMNNAME, A.COLUMNDESC,ISNULL(B.VALUE,'0000000000') AS VALUE 
		FROM #V_PROCESS_OTHERS A
		LEFT OUTER JOIN GST_ACCOUNTS_CONFIG_DET_OTHERS B ON A.XN_TYPE=B.XN_TYPE AND A.COLUMNNAME=B.COLUMNNAME
		
	END

	
	IF @BPAYMODEAPPLICABLE=1
	BEGIN
		SET @CSTEP = '180'
		
	
		SET @CCMD=N'SELECT '+STR(@NSPID)+' AS SP_ID, PAYMODE_CODE,COLUMNNAME, COLUMNDESC, AC_CODE 
					FROM #V_PROCESS_PAYMODES'
					
		INSERT GST_ACCOUNTS_CONFIG_DET_PAYMODES_UPLOAD	( SP_ID, PAYMODE_CODE, COLUMNNAME, COLUMNDESC, VALUE )  
		EXEC SP_EXECUTESQL @CCMD			
	END
	
	SET @CSTEP = '190'
	SELECT 'PLEASE DEFINE/CHANGE REVENUE ACCOUNTS' AS ERR_DESC,
	'GST_ACCOUNTS_CONFIG_DET_REVENUE_UPLOAD' AS TABLENAME,
	SECTION_NAME,SUB_SECTION_NAME,ISNULL(LM_IGRV.AC_NAME,'') AS IGST_REVENUE_AC_NAME,
	ISNULL(LM_LGRV.AC_NAME,'') AS LGST_REVENUE_AC_NAME,
	ISNULL(LM_IGT.AC_NAME,'') AS IGST_TAX_AC_NAME,
	ISNULL(LM_CGT.AC_NAME,'') AS CGST_TAX_AC_NAME,
	ISNULL(LM_SGT.AC_NAME,'') AS SGST_TAX_AC_NAME,
	A.* FROM GST_ACCOUNTS_CONFIG_DET_REVENUE_UPLOAD A
	LEFT OUTER JOIN LM01106 LM_IGRV ON LM_IGRV.AC_CODE=A.IGST_REVENUE_AC_CODE
	LEFT OUTER JOIN LM01106 LM_LGRV ON LM_LGRV.AC_CODE=A.LGST_REVENUE_AC_CODE
	LEFT OUTER JOIN LM01106 LM_IGT ON LM_IGT.AC_CODE=A.IGST_TAX_AC_CODE
	LEFT OUTER JOIN LM01106 LM_CGT ON LM_CGT.AC_CODE=A.CGST_TAX_AC_CODE
	LEFT OUTER JOIN LM01106 LM_SGT ON LM_SGT.AC_CODE=A.SGST_TAX_AC_CODE
	LEFT OUTER JOIN SECTIOND SD ON SD.SUB_SECTION_CODE=A.SUB_SECTION_CODE
	LEFT OUTER JOIN SECTIONM SM ON SM.SECTION_CODE=A.SECTION_CODE
	WHERE SP_ID=@NSPID


	SELECT 'PLEASE DEFINE/CHANGE OVERHEADS ACCOUNTS' AS ERR_DESC,'GST_ACCOUNTS_CONFIG_DET_OVERHEADS_UPLOAD' AS TABLENAME,
	ISNULL(LM_IGRV.AC_NAME,'') AS IGST_REVENUE_AC_NAME,
	ISNULL(LM_LGRV.AC_NAME,'') AS LGST_REVENUE_AC_NAME,
	ISNULL(LM_IGT.AC_NAME,'') AS IGST_TAX_AC_NAME,
	ISNULL(LM_CGT.AC_NAME,'') AS CGST_TAX_AC_NAME,
	ISNULL(LM_SGT.AC_NAME,'') AS SGST_TAX_AC_NAME,A.* FROM GST_ACCOUNTS_CONFIG_DET_OVERHEADS_UPLOAD A
	LEFT OUTER JOIN LM01106 LM_IGRV ON LM_IGRV.AC_CODE=A.IGST_REVENUE_AC_CODE
	LEFT OUTER JOIN LM01106 LM_LGRV ON LM_LGRV.AC_CODE=A.LGST_REVENUE_AC_CODE
	LEFT OUTER JOIN LM01106 LM_IGT ON LM_IGT.AC_CODE=A.IGST_TAX_AC_CODE
	LEFT OUTER JOIN LM01106 LM_CGT ON LM_CGT.AC_CODE=A.CGST_TAX_AC_CODE
	LEFT OUTER JOIN LM01106 LM_SGT ON LM_SGT.AC_CODE=A.SGST_TAX_AC_CODE
	WHERE SP_ID=@NSPID
	
	SELECT 'PLEASE DEFINE/CHANGE MISC ACCOUNTS' AS ERR_DESC,'GST_ACCOUNTS_CONFIG_DET_OTHERS_UPLOAD' AS TABLENAME,
	SP_ID,XN_TYPE,COLUMNNAME,COLUMNDESC,VALUE,ISNULL(B.AC_NAME,'') AS VALUE_NAME FROM GST_ACCOUNTS_CONFIG_DET_OTHERS_UPLOAD A
	LEFT OUTER JOIN LM01106 B ON B.AC_CODE=A.VALUE
	WHERE SP_ID=@NSPID
	
	SELECT 'PLEASE DEFINE/CHANGE MISC ACCOUNTS' AS ERR_DESC,'GST_ACCOUNTS_CONFIG_DET_PAYMODES_UPLOAD' AS TABLENAME,
	SP_ID,COLUMNNAME,A.PAYMODE_CODE, ISNULL(PAYMODE_NAME,'')+COLUMNDESC AS COLUMNDESC_DISPLAY,COLUMNDESC,VALUE,
	ISNULL(B.AC_NAME,'') AS VALUE_NAME FROM GST_ACCOUNTS_CONFIG_DET_PAYMODES_UPLOAD A
	LEFT OUTER JOIN LM01106 B ON B.AC_CODE=A.VALUE
	LEFT OUTER JOIN PAYMODE_MST PM ON PM.PAYMODE_CODE=A.PAYMODE_CODE
	WHERE SP_ID=@NSPID

	SELECT 'PLEASE DEFINE/CHANGE GST Cess ACCOUNTS' AS ERR_DESC,
	'GST_ACCOUNTS_CONFIG_DET_Cess_UPLOAD' AS TABLENAME,
	SECTION_NAME,SUB_SECTION_NAME,ISNULL(LM.AC_NAME,'') AS GST_CESS_AC_NAME,
	A.* FROM GST_ACCOUNTS_CONFIG_DET_CESS_UPLOAD A
	LEFT OUTER JOIN LM01106 LM ON LM.AC_CODE=A.GST_CESS_AC_CODE
	LEFT OUTER JOIN SECTIOND SD ON SD.SUB_SECTION_CODE=A.SUB_SECTION_CODE
	LEFT OUTER JOIN SECTIONM SM ON SM.SECTION_CODE=A.SECTION_CODE
	WHERE SP_ID=@NSPID

	IF EXISTS (SELECT TOP 1 SP_ID FROM GST_ACCOUNTS_CONFIG_DET_REVENUE_UPLOAD WHERE SP_ID=@NSPID AND 
	(IGST_REVENUE_AC_CODE IN ('','0000000000') OR LGST_REVENUE_AC_CODE  IN ('','0000000000') OR
	 IGST_TAX_AC_CODE IN ('','0000000000') OR CGST_TAX_AC_CODE IN ('','0000000000') OR
	 SGST_TAX_AC_CODE IN ('','0000000000')))
	 
	OR EXISTS (SELECT TOP 1 SP_ID FROM GST_ACCOUNTS_CONFIG_DET_OVERHEADS_UPLOAD WHERE SP_ID=@NSPID AND 
	(IGST_REVENUE_AC_CODE IN ('','0000000000') OR LGST_REVENUE_AC_CODE  IN ('','0000000000') OR
	 IGST_TAX_AC_CODE IN ('','0000000000') OR CGST_TAX_AC_CODE IN ('','0000000000') OR
	 SGST_TAX_AC_CODE IN ('','0000000000')))

	OR EXISTS (SELECT TOP 1 SP_ID FROM GST_ACCOUNTS_CONFIG_DET_CESS_UPLOAD WHERE SP_ID=@NSPID AND 
			   GST_CESS_AC_CODE IN ('','0000000000'))
	
	OR EXISTS (SELECT TOP 1 SP_ID FROM GST_ACCOUNTS_CONFIG_DET_OTHERS_UPLOAD WHERE SP_ID=@NSPID AND VALUE IN ('','0000000000'))
	OR EXISTS (SELECT TOP 1 SP_ID FROM GST_ACCOUNTS_CONFIG_DET_PAYMODES_UPLOAD WHERE SP_ID=@NSPID AND VALUE IN ('','0000000000'))
	BEGIN
		SET @BBLANKACFOUND=1
	END		
	
	GOTO END_PROC
END TRY

BEGIN CATCH
	SET @CERRORMSG='ERROR IN PROCEDURE SP3S_GET_POSTING_BLANKAC AT STEP#'+@CSTEP+' '+ERROR_MESSAGE()
	GOTO END_PROC
END CATCH

END_PROC:
	
END
