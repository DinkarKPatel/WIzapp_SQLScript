create Procedure SP_POSTSALES_JOBWORKRECEIPTPRINT
(
 @creceipt_id varchar(100)=''
)
AS
begin	
   
   Declare @DTSQL NVARCHAR(MAX),@PMTDBNAME VARCHAR(100)
   SET @PMTDBNAME=DB_NAME ()+'_image.dbo.'
	
 set @dtsql=N'	SELECT N.REMARKS AS ISSUE_MST_REMARKS,M.REMARKS AS ISSUE_DET_REMARKS,M.ISSUE_ID AS ISSUE_ID, B.REMARKS ,A.REMARKS AS MST_REMARKS,
	B.TS,B.PRODUCT_CODE,B.JOB_RATE,B.QUANTITY,A.RECEIPT_NO,A.RECEIPT_DT,A.JOB_CODE,A.NET_AMOUNT,
	A.RECEIVED_BY,A.CANCELLED, F.JOB_NAME,
	SN.ARTICLE_NO, SN.ARTICLE_NAME, PARA1_NAME,PARA2_NAME,PARA3_NAME,SN.uom  UOM_NAME,     
    SN.sn_barcode_coding_scheme 	CODING_SCHEME,CONVERT(NUMERIC(10,2),0) AS QUANTITY_IN_STOCK,
	sn.pp PURCHASE_PRICE,sn.MRP,sn.WS_PRICE,   sn.SECTION_NAME, sn.SUB_SECTION_NAME,  
	PARA4_NAME,PARA5_NAME,PARA6_NAME,ISNULL(sn.SN_Uom_type,0) AS [UOM_TYPE],  
	cast('''' as varchar(100)) AS [ART_DT_CREATED],cast('''' as varchar(100)) AS [PARA3_DT_CREATED],
	cast('''' as varchar(100)) AS [SKU_DT_CREATED],  sn.STOCK_NA,P.CM_DT,P.CM_NO 
	,cast('''' as varchar(100)) DT_CREATED ,Y.AGENCY_NAME ,'' AS ADDRESS ,B.REF_ROW_ID ,B.ROW_ID ,N.ISSUE_TYPE ,A.RECEIPT_ID
	,CUST.CUSTOMER_FNAME +''+ CUST.CUSTOMER_LNAME  AS CUSTOMER_NAME,CUST.MOBILE,EMP.EMP_NAME,EMP1.EMP_NAME AS [EMP_NAME2],
	EMP2.EMP_NAME AS [EMP_NAME3],Q.PRODUCT_CODE AS OLD_PRODUCT_CODE
	,LMP.ADDRESS1 AS AGENCY_ADDRESS1
	,LMP.ADDRESS2 AS AGENCY_ADDRESS2
	,LMP.AREA_NAME AS AGENCY_AREA_NAME
	,LMP.PINCODE AS AGENCY_PINCODE
	,LMP.STATE AS AGENCY_STATE
	,LMP.MOBILE AS AGENCY_MOBILE
	,G.DELIVERY_DT
	,img.PROD_IMAGE
	FROM POST_SALES_JOBWORK_RECEIPT_MST A (NOLOCK)                 
	JOIN POST_SALES_JOBWORK_RECEIPT_DET B (NOLOCK) ON A.RECEIPT_ID = B.RECEIPT_ID    
	JOIN POST_SALES_JOBWORK_ISSUE_DET M (NOLOCK) ON M.ROW_ID = B.REF_ROW_ID 
	JOIN POST_SALES_JOBWORK_ISSUE_MST N (NOLOCK) ON M.ISSUE_ID = N.ISSUE_ID 
	JOIN HOLD_BACK_DELIVER_DET G (NOLOCK) ON M.REF_HBD_ROW_ID = G.ROW_ID
	JOIN HOLD_BACK_DELIVER_mst hm (NOLOCK) ON hm.memo_id = G.memo_id
	LEFT JOIN CMD01106 Q (NOLOCK) ON Q.ROW_ID = G.REF_CMD_ROW_ID    
	LEFT JOIN CMM01106 P (NOLOCK) ON Q.CM_ID = P.CM_ID
	JOIN PRD_AGENCY_MST Y (NOLOCK) ON N.AGENCY_CODE = Y.AGENCY_CODE 
	JOIN LMV01106  LMP (NOLOCK) ON y.AC_CODE =LMP.AC_CODE       
	JOIN SKU_NAMES SN (NOLOCK) ON SN.PRODUCT_CODE=B.PRODUCT_CODE
	JOIN JOBS F (NOLOCK) ON F.JOB_CODE = M.JOB_CODE 
	LEFT OUTER JOIN CUSTDYM CUST (NOLOCK) ON CUST.CUSTOMER_CODE = isnull(P.CUSTOMER_CODE,hm.customer_code)
	LEFT JOIN EMPLOYEE EMP(NOLOCK) ON EMP.EMP_CODE=Q.EMP_CODE
	LEFT JOIN EMPLOYEE EMP1(NOLOCK) ON EMP1.EMP_CODE=Q.EMP_CODE1
	LEFT JOIN EMPLOYEE EMP2(NOLOCK) ON EMP2.EMP_CODE=Q.EMP_CODE2 
	LEFT JOIN '+@PMTDBNAME+' IMAGE_INFO IMG ON IMG.IMG_ID=SN.BARCODE_IMG_ID
	where a.receipt_id='''+@creceipt_id+'''
	'

	print @dtsql
	exec sp_executesql @dtsql


END	
