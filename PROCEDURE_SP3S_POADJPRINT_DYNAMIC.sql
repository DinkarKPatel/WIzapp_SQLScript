create  PROCEDURE SP3S_POADJPRINT_DYNAMIC  
(  
@cMemoId VARCHAR(40)  
)  
AS  
BEGIN  
  
  
    DECLARE @cCmdCols VARCHAR(MAX),@cCmd NVARCHAR(MAX),@cCols NVARCHAR(MAX),@cCmd1 NVARCHAR(MAX),@cCmd2 NVARCHAR(MAX),@cCmd3 NVARCHAR(MAX),@cCmdIMG NVARCHAR(MAX)  
    ,@PARA1 NVARCHAR(10),@PARA2 NVARCHAR(10),@PARA3 NVARCHAR(10),@PARA4 NVARCHAR(10),@PARA5 NVARCHAR(10),@PARA6 NVARCHAR(10),  
    @cnullableCols VARCHAR(max),@CERRMSG VARCHAR(1000)  
      

    SET @CERRMSG=''  
  
     SELECT TOP 1 @PARA1=VALUE FROM CONFIG WHERE config_option='PARA1_caption' AND ISNULL(VALUE,'') <>''  
     SELECT TOP 1 @PARA2=VALUE FROM CONFIG WHERE config_option='PARA2_caption' AND ISNULL(VALUE,'') <>''  
     SELECT TOP 1 @PARA3=VALUE FROM CONFIG WHERE config_option='PARA3_caption' AND ISNULL(VALUE,'') <>''  
     SELECT TOP 1 @PARA4=VALUE FROM CONFIG WHERE config_option='PARA4_caption' AND ISNULL(VALUE,'') <>''  
     SELECT TOP 1 @PARA5=VALUE FROM CONFIG WHERE config_option='PARA5_caption' AND ISNULL(VALUE,'') <>''  
     SELECT TOP 1 @PARA6=VALUE FROM CONFIG WHERE config_option='PARA6_caption' AND ISNULL(VALUE,'') <>''  
     SET @PARA1=CASE WHEN ISNULL(@PARA1,'')='' THEN 'Para1' ELSE ISNULL(@PARA1,'') END  
     SET @PARA2=CASE WHEN ISNULL(@PARA2,'')='' THEN 'Para2' ELSE ISNULL(@PARA2,'') END  
     SET @PARA3=CASE WHEN ISNULL(@PARA3,'')='' THEN 'Para3' ELSE ISNULL(@PARA3,'') END  
     SET @PARA4=CASE WHEN ISNULL(@PARA4,'')='' THEN 'Para4' ELSE ISNULL(@PARA4,'') END  
     SET @PARA5=CASE WHEN ISNULL(@PARA5,'')='' THEN 'Para5' ELSE ISNULL(@PARA5,'') END  
     SET @PARA6=CASE WHEN ISNULL(@PARA6,'')='' THEN 'Para6' ELSE ISNULL(@PARA6,'') END  
      
     SELECT @cCols=COALESCE(@cCols+',','')+column_name+' ['+DISPLAY_COLUMN_NAME+']'   
     FROM dynamic_print_cols   
     WHERE LTRIM(RTRIM(xn_type))='poadj' AND selected=1  
   
  
  
  SELECT @cnullableCols=COALESCE(@cnullableCols+',','')+'NULL as '+' ['+DISPLAY_COLUMN_NAME+']'   
  FROM dynamic_print_cols   
     WHERE LTRIM(RTRIM(xn_type))='poadj' AND selected=0  
  SET @cnullableCols=ISNULL(@cnullableCols,'')  
  IF ISNULL(@cnullableCols,'')<>''  
     SET @cnullableCols=','+ISNULL(@cnullableCols,'')  
    
  
    
    SET @cCmdCols=N'  
    SELECT '+@cCols+', POM.LOCATION_CODE, 
    '''+@para1 +''' AS PARA1_CONFIG,'''+@PARA2 +''' AS PARA2_CONFIG,'''+@PARA3 +''' AS PARA3_CONFIG,  
    '''+@PARA4 +''' AS PARA4_CONFIG,'''+@PARA5 +''' AS PARA5_CONFIG,'''+@PARA6 +''' AS PARA6_CONFIG
    
     '+@cnullableCols  
    SET @cCmd=N' 
	  FROM PO_ADJ_MST POADJ (NOLOCK)    
      JOIN USERS U (NOLOCK) ON POADJ.USER_CODE = U.USER_CODE  
	  JOIN USERS U1 (NOLOCK) ON POADJ.EDT_USER_CODE = U1.USER_CODE    
      JOIN PO_ADJ_DET POADJDET (NOLOCK) ON POADJ.memo_id = POADJDET.memo_id    
	  join pod01106 pod (nolock) on pod.row_id =POADJDET.PO_ROW_ID
	  JOIN POM01106 POM (NOLOCK) ON POM.PO_ID=POD.PO_ID
	  JOIN LMV01106 lmv (NOLOCK) ON POM.AC_CODE = lmv.AC_CODE    
      JOIN PARA1 P1 (NOLOCK) ON POD.PARA1_CODE = P1.PARA1_CODE    
      JOIN PARA2 P2 (NOLOCK) ON POD.PARA2_CODE = P2.PARA2_CODE    
      JOIN PARA3 P3 (NOLOCK) ON POD.PARA3_CODE = P3.PARA3_CODE    
      JOIN PARA4 P4 (NOLOCK) ON POD.PARA4_CODE = P4.PARA4_CODE    
      JOIN PARA5 P5 (NOLOCK) ON POD.PARA5_CODE = P5.PARA5_CODE    
      JOIN PARA6 P6 (NOLOCK) ON POD.PARA6_CODE = P6.PARA6_CODE    
      JOIN ARTICLE ART (NOLOCK) ON POD.ARTICLE_CODE = ART.ARTICLE_CODE    
	  JOIN UOM UOM (NOLOCK) ON ART.UOM_CODE = UOM.UOM_CODE    
      LEFT OUTER JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE = POD.PRODUCT_CODE       
      JOIN LOCATION LCT (NOLOCK) ON POM.DEPT_ID=LCT.DEPT_ID    
      JOIN AREA LA (NOLOCK) ON LCT.AREA_CODE=LA.AREA_CODE    
      JOIN CITY LC (NOLOCK) ON LA.CITY_CODE=LC.CITY_CODE    
      JOIN [STATE] LS (NOLOCK) ON LC.STATE_CODE=LS.STATE_CODE    
      JOIN REGIONM LRG (NOLOCK) ON LS.REGION_CODE=LRG.REGION_CODE    
      JOIN SECTIOND SD (NOLOCK) ON ART.SUB_SECTION_CODE=SD.SUB_SECTION_CODE    
      JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE=SM.SECTION_CODE  
	  WHERE POADJ.MEMO_ID='''+@cMemoId+'''
      '    

 END_PROC:  
         
    IF ISNULL(@CERRMSG,'')<>''   
    BEGIN  
     SELECT @CERRMSG AS ERRMSG   
    END  
    ELSE   
    BEGIN  
       PRINT (@cCmdCols+@CCMD)
	   EXEC  (@cCmdCols+@CCMD)      
    END  
  
 
  
  
END  
  