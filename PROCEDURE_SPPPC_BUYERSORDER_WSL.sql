CREATE PROCEDURE SPPPC_BUYERSORDER_WSL  
(  
@NQUERYID NUMERIC(2,0),    
@VNAME VARCHAR(500)  
)  
AS      
BEGIN   
  
 DECLARE @CSTEP INT, @CCMD NVARCHAR(MAX), @ERRMSG_OUT VARCHAR(MAX),@cHEAD_CODE VARCHAR(MAX),@cHEAD_CODE1 VARCHAR(MAX)  
 BEGIN TRY  
  SET NOCOUNT ON;  
    
  SET @ERRMSG_OUT = ''  
    
  IF @NQUERYID = 1  
   -- GET CUSTOMER LIST  
   GOTO LBLGETCUSTOMERLIST  
  IF @NQUERYID = 2      
   -- GET CUSTOMER INFO  
   GOTO LBLGETCUSTOMERINFO  
  IF @NQUERYID = 3  
   -- GET EMPLOYEE LIST  
   GOTO LBLGETEMPLOYEELIST  
  IF @NQUERYID = 4      
   -- GET EMPLOYEE INFO  
   GOTO LBLGETEMPLOYEEINFO   
  IF @NQUERYID = 5  
   -- GET ARTICLE LIST  
   GOTO LBLGETARTICLELIST  
  IF @NQUERYID = 6  
   -- GET ARTICLE INFO  
   GOTO LBLGETARTICLEINFO  
  IF @NQUERYID = 7  
   -- GET COLOR LIST  
   GOTO LBLGETCOLORLIST  
  IF @NQUERYID = 8  
   -- GET COLOR INFO  
   GOTO LBLGETCOLORINFO  
  IF @NQUERYID = 9  
   -- GET SIZE LIST  
   GOTO LBLGETSIZELIST  
  IF @NQUERYID = 10  
   -- GET SIZE INFO  
   GOTO LBLGETSIZEINFO  
  IF @NQUERYID = 11  
   -- GET SIZE INFO  
   GOTO LBLRMARTICLELIST   
     
  ELSE  
   GOTO LAST  
      
LBLGETCUSTOMERLIST:  
  SET @CSTEP = 101 
  
	SET @cHEAD_CODE  = DBO.FN_ACT_TRAVTREE ('0000000018') ----ADD VARIABLE BY GAURI ON 17/4/2019
	SET @cHEAD_CODE1 = DBO.FN_ACT_TRAVTREE ('0000000001') ----ADD VARIABLE BY GAURI ON 17/4/2019
   
    SELECT  TOP 10 A.AC_CODE, A.HEAD_CODE, A.AC_NAME, ISNULL(A.CREDIT_DAYS, 0) AS CREDIT_DAYS, ISNULL(A.DISCOUNT_PERCENTAGE, 0) AS DISCOUNT_PERCENTAGE,   
      A.CITY, A.ADDRESS0 + ' ' + A.ADDRESS1 + ' ' + A.ADDRESS2 + ' ' + A.AREA_NAME + ' ' + A.CITY + ' ' + A.STATE + ' ' + A.MOBILE + ' ' AS SUPP_ADDRESS,   
      A.AC_NAME AS REPCOLNAME, A.DEFAULT_RATE_TYPE, A.DISCOUNT_PERCENTAGE      
  FROM LMV01106 A (NOLOCK)             
  WHERE ( CHARINDEX ( HEAD_CODE, @cHEAD_CODE)>0   ----REPLACE VARIABLE FROM FUNCTION BY GAURI ON 17/4/2019
  OR CHARINDEX ( HEAD_CODE, @cHEAD_CODE1)>0       ----REPLACE VARIABLE FROM FUNCTION BY GAURI ON 17/4/2019
  OR ALLOW_CREDITOR_DEBTOR = 1 )             
  AND INACTIVE = 0 AND A.AC_CODE <> '0000000000' AND ISNULL(A.AC_NAME,'')<>''  
  AND A.AC_NAME LIKE '%'+ @VNAME +'%'  
  GOTO LAST  
    
LBLGETCUSTOMERINFO:  
  SET @CSTEP = 102  
    SELECT A.AC_CODE, A.HEAD_CODE, A.AC_NAME, ISNULL(A.CREDIT_DAYS, 0) AS CREDIT_DAYS, ISNULL(A.DISCOUNT_PERCENTAGE, 0) AS DISCOUNT_PERCENTAGE,   
      A.CITY, A.ADDRESS0 + ' ' + A.ADDRESS1 + ' ' + A.ADDRESS2 + ' ' + A.AREA_NAME + ' ' + A.CITY + ' ' + A.STATE + ' ' + A.MOBILE + ' ' AS SUPP_ADDRESS,   
      A.AC_NAME AS REPCOLNAME, A.DEFAULT_RATE_TYPE, A.DISCOUNT_PERCENTAGE ,
      A.AC_GST_STATE_CODE AS  PARTY_STATE_CODE     
  FROM LMV01106 A (NOLOCK)             
  WHERE A.AC_NAME = @VNAME  
  GOTO LAST  
    
LBLGETEMPLOYEELIST:  
  SET @CSTEP = 103  
  SELECT TOP 10 EMP_CODE, EMP_NAME FROM EMPLOYEE   
  WHERE EMP_CODE <> '0000000' AND INACTIVE = 0  
  AND EMP_NAME LIKE '%'+ @VNAME +'%'  
  GOTO LAST  
    
LBLGETEMPLOYEEINFO:  
  SET @CSTEP = 104  
  SELECT EMP_CODE, EMP_NAME FROM EMPLOYEE   
  WHERE EMP_NAME = @VNAME  
  GOTO LAST  
    
LBLGETARTICLELIST:  
  SET @CSTEP = 105  
  SELECT TOP 10  ARTICLE_CODE, ARTICLE_NO, ARTICLE_NAME FROM (  
   SELECT  A.ARTICLE_CODE, A.ARTICLE_NO, A.ARTICLE_NAME  
   FROM ARTICLE A (NOLOCK)     
   WHERE A.ARTICLE_TYPE =1 AND A.ARTICLE_PRD_MODE <> 3  AND A.INACTIVE =0   
   AND ISNULL(A.ARTICLE_NO,'')<>''   
   UNION ALL  
   SELECT  A.ARTICLE_CODE, A.ALIAS AS [ARTICLE_NO], A.ARTICLE_NAME  
   FROM ARTICLE A (NOLOCK)     
   WHERE A.ARTICLE_TYPE =1 AND A.ARTICLE_PRD_MODE <> 3  AND A.INACTIVE =0   
   AND ISNULL(A.ARTICLE_NO,'')<>'' AND ISNULL(A.ALIAS,'')<>''   
   ) AS ART  
  WHERE ARTICLE_NO LIKE '%'+ @VNAME +'%'  
  ORDER BY ARTICLE_NAME  
  GOTO LAST  
    
LBLGETARTICLEINFO:  
  SET @CSTEP = 106  
  
  SELECT  A1.ARTICLE_CODE, A1.ARTICLE_NO, A1.ARTICLE_NAME, A1.ARTICLE_ALIAS, A1.PURCHASE_PRICE, A1.MRP, A1.WS_PRICE,  
      A2.UOM_CODE, A2.UOM_NAME, A2.UOM_TYPE  
  FROM (SELECT A.ARTICLE_CODE, A.ARTICLE_NO, A.ARTICLE_NAME,   
         A.ALIAS AS ARTICLE_ALIAS, A.PURCHASE_PRICE, A.MRP, A.WHOLESALE_PRICE AS WS_PRICE, A.UOM_CODE  
     FROM ARTICLE A (NOLOCK)     
     WHERE A.ARTICLE_TYPE =1 AND A.ARTICLE_PRD_MODE <> 3  AND A.INACTIVE =0   
     AND ISNULL(A.ARTICLE_NO,'')<>''   
     UNION ALL  
     SELECT  A.ARTICLE_CODE, A.ALIAS AS [ARTICLE_NO], A.ARTICLE_NAME,   
         A.ALIAS AS ARTICLE_ALIAS, A.PURCHASE_PRICE, A.MRP, A.WHOLESALE_PRICE AS WS_PRICE, A.UOM_CODE  
     FROM ARTICLE A (NOLOCK)     
     WHERE A.ARTICLE_TYPE =1 AND A.ARTICLE_PRD_MODE <> 3  AND A.INACTIVE =0   
     AND ISNULL(A.ARTICLE_NO,'')<>'' AND ISNULL(A.ALIAS,'')<>''   
     ) AS A1    
  JOIN UOM A2 (NOLOCK)  ON A1.UOM_CODE = A2.UOM_CODE      
  WHERE A1.ARTICLE_NO = @VNAME 
   
  GOTO LAST  
    
LBLGETCOLORLIST:  
  SET @CSTEP = 107  
  SELECT TOP 10 A.PARA1_CODE, A.PARA1_NAME FROM PARA1 A (NOLOCK)        
  WHERE A.PARA1_NAME <> '' AND INACTIVE = 0     
  AND A.PARA1_NAME LIKE '%'+ @VNAME +'%'    
  ORDER BY A.PARA1_NAME      
  GOTO LAST  
  
LBLGETCOLORINFO:  
  SET @CSTEP = 108  
  SELECT A.PARA1_CODE, A.PARA1_NAME FROM PARA1 A (NOLOCK)        
  WHERE A.PARA1_NAME = @VNAME  
  GOTO LAST  
  
LBLGETSIZELIST:  
  SET @CSTEP = 109  
  SELECT TOP 10 A.PARA2_CODE, A.PARA2_NAME, A.PARA2_ORDER FROM PARA2 A (NOLOCK)        
  WHERE A.PARA2_NAME <> '' AND INACTIVE = 0      
  AND A.PARA2_NAME LIKE '%'+ @VNAME +'%'    
  ORDER BY A.PARA2_ORDER, A.PARA2_NAME    
  GOTO LAST  
    
LBLGETSIZEINFO:  
  SET @CSTEP = 110  
  SELECT A.PARA2_CODE, A.PARA2_NAME, A.PARA2_ORDER FROM PARA2 A (NOLOCK)    
  WHERE A.PARA2_NAME = @VNAME  
  GOTO LAST  
 
 LBLRMARTICLELIST:
    
   SELECT TOP 10  ARTICLE_CODE, ARTICLE_NO, ARTICLE_NAME FROM (  
   SELECT  A.ARTICLE_CODE, A.ARTICLE_NO, A.ARTICLE_NAME  
   FROM ARTICLE A (NOLOCK)     
   WHERE  A.INACTIVE =0   
   AND ISNULL(A.ARTICLE_NO,'')<>''   
   UNION ALL  
   SELECT  A.ARTICLE_CODE, A.ALIAS AS [ARTICLE_NO], A.ARTICLE_NAME  
   FROM ARTICLE A (NOLOCK)     
   WHERE  A.INACTIVE =0   
   AND ISNULL(A.ARTICLE_NO,'')<>'' AND ISNULL(A.ALIAS,'')<>''   
   ) AS ART  
  WHERE ARTICLE_NO LIKE '%'+ @VNAME +'%'  
  ORDER BY ARTICLE_NAME  
  GOTO LAST   
     
 
 GOTO END_PROC  
  
LAST:     
 GOTO END_PROC  
  
  SET NOCOUNT OFF;  
 END TRY    
 BEGIN CATCH    
  SET @ERRMSG_OUT='ERROR: [P]: SPPPC_BUYERSORDER_WSL, [STEP]: '+CAST(@CSTEP AS VARCHAR(5))+', [MESSAGE]: ' + ERROR_MESSAGE()  
  GOTO END_PROC    
 END CATCH     
  
END_PROC:    
 IF  ISNULL(@ERRMSG_OUT,'')<>''   
  SELECT @ERRMSG_OUT AS ERRORMSG  
END
