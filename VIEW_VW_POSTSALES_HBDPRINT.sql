create VIEW  VW_POSTSALES_HBDPRINT 
AS
SELECT A.REMARKS AS REMARKS_MST,
M.CM_ID,M.FIN_YEAR,A.MEMO_NO,A.MEMO_DT,M.CM_NO,M.CM_DT, A.CANCELLED,A.CUSTOMER_CODE,
B.MEMO_ID,B.ROW_ID,REF_CMD_ROW_ID,DELIVERED,B.JOB_CODE,B.LAST_UPDATE,B.REMARKS,B.TS,B.DELIVERY_DT,
SKU.ARTICLE_CODE AS ARTICLE_CODE,c.PRODUCT_CODE ,B.PRODUCT_CODE as hbd_product_code ,ART.ARTICLE_NAME AS DESCRIPTION,B.QUANTITY,C.MRP,
ART.ARTICLE_NO, ART.ARTICLE_NAME, P1.PARA1_CODE, 
P1.PARA1_NAME, P2.PARA2_CODE,PARA2_NAME,P3.PARA3_CODE,PARA3_NAME,UOM_NAME,     
CODING_SCHEME,CONVERT(NUMERIC(10,2),0) AS QUANTITY_IN_STOCK,SKU.PURCHASE_PRICE,
SKU.WS_PRICE,   SM.SECTION_NAME, SD.SUB_SECTION_NAME,  
P4.PARA4_CODE,P5.PARA5_CODE,P6.PARA6_CODE,  
PARA4_NAME,PARA5_NAME,PARA6_NAME,E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],  
ART.DT_CREATED AS [ART_DT_CREATED],P3.DT_CREATED AS [PARA3_DT_CREATED],SKU.DT_CREATED AS [SKU_DT_CREATED],  
ART.STOCK_NA,
F.JOB_NAME,(H.CUSTOMER_FNAME  + ' ' + H.CUSTOMER_LNAME) AS CUSTOMER_NAME,H.USER_CUSTOMER_CODE,  
(H.ADDRESS1 + ',' + H.ADDRESS2 + ',' + I.AREA_NAME + ',' + I.PINCODE + ',' + J.CITY + ',' + K.STATE) AS CUSTOMER_ADDRESS,
ART.DT_CREATED ,B.DELIVERY_DT AS [DUE_DT],EMP.EMP_NAME,EMP1.EMP_NAME AS [EMP_NAME2],EMP2.EMP_NAME AS [EMP_NAME3],B.DELIVERY_TIME
,'01' AS COMPANY_CODE
,COM.PAN_NO AS COMP_PANNO
,COM.EMAIL_ID AS COMP_EMAILID
,COM.PWD AS COMP_PWD
,COM.STATE AS COMP_STATE 
,COM.COUNTRY AS COMP_CONTRY
,COM.MOBILE AS COMP_MOBILE
,COM.CONTACT_NAME AS COMP_CONTACTNAME
,COM.TDS_AC_NO AS COMP_TDSACNO
,COM.COMPANY_NAME AS COMP_COMPANYNAME
,COM.ALIAS AS COMP_ALIAS
,COM.ADDRESS1 AS COMP_ADDRESS1
,COM.ADDRESS2 AS COMP_ADDRESS2 
,cast('' as varchar(100)) AS COMP_area_name
,COM.CITY AS COMP_CITY
,COM.TAN_NO AS COMP_TANNO
,COM.PHONES_FAX AS COMP_PHONES_FAX
,COM.CST_DT AS COMP_CST_DT
,COM.SST_NO AS COMP_SSTNO
,COM.SST_DT AS COMP_SSTDT
,COM.GRP_CODE AS COMP_GRPCODE
,COM.ADDRESS9 AS COMP_ADDRESS9
,COM.AREA_CODE AS COMP_AREACODE
,COM.PRINT_ADDRESS AS COMP_PRINTADDRESS
,COM.WORKABLE AS COMP_WORKABLE
,COM.PIN AS COMP_PIN
,COM.LOGO_PATH AS COMP_LOGOPATH
,COM.WEB_ADDRESS AS COMP_WEBADDRESS
,COM.SSPL_FIRST_HDSR AS COMP_SSPLFIRSTHDSR
,COM.POLICY_NO AS COMP_POLICYNO
,COM.GRP_NAME AS COMP_GRPNAME 
,COM.CIN AS COMP_CIN
,0 AS CUSTBAL
,C.DISCOUNT_AMOUNT AS ITEM_DISCOUNT_AMOUNT
,m.DISCOUNT_AMOUNT as Bill_DISCOUNT_AMOUNT
,M.NET_AMOUNT As CMM_NET_AMOUNT
,COM.gst_no as COMP_GSTIN
,b.JOB_RATE 
,b.Additional_job
,cast(0 as numeric(10,2)) as Total_JOB_RATE
,cast(0 as numeric(14,2)) as CREDIT_AMOUNT
,cast(0 as numeric(14,2)) as Bill_pending_amount
,cast('' as varchar(1000)) as Sale_person
,a.Entry_mode 	
FROM HOLD_BACK_DELIVER_MST A (NOLOCK) 
JOIN HOLD_BACK_DELIVER_DET B (NOLOCK) ON A.MEMO_ID = B.MEMO_ID 
JOIN CMD01106 C (NOLOCK) ON C.ROW_ID = B.REF_CMD_ROW_ID    
JOIN CMM01106 M (NOLOCK) ON C.CM_ID = M.CM_ID    
JOIN SKU (NOLOCK) ON SKU.PRODUCT_CODE=C.PRODUCT_CODE
JOIN ARTICLE ART (NOLOCK) ON SKU.ARTICLE_CODE = ART.ARTICLE_CODE    
JOIN SECTIOND SD (NOLOCK) ON ART.SUB_SECTION_CODE = SD.SUB_SECTION_CODE  
JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE = SM.SECTION_CODE  
JOIN PARA1 P1 (NOLOCK) ON SKU.PARA1_CODE = P1.PARA1_CODE    
JOIN PARA2 P2 (NOLOCK) ON SKU.PARA2_CODE = P2.PARA2_CODE    
JOIN PARA3 P3 (NOLOCK)ON SKU.PARA3_CODE = P3.PARA3_CODE    
JOIN PARA4 P4 (NOLOCK)ON SKU.PARA4_CODE = P4.PARA4_CODE    
JOIN PARA5 P5 (NOLOCK)ON SKU.PARA5_CODE = P5.PARA5_CODE    
JOIN PARA6 P6 (NOLOCK)ON SKU.PARA6_CODE = P6.PARA6_CODE    
JOIN UOM E (NOLOCK)ON ART.UOM_CODE = E.UOM_CODE 
LEFT OUTER JOIN JOBS F (NOLOCK) ON F.JOB_CODE = B.JOB_CODE         
JOIN CUSTDYM H (NOLOCK) ON A.CUSTOMER_CODE = H.CUSTOMER_CODE
JOIN AREA I (NOLOCK) ON I.AREA_CODE = H.AREA_CODE 
JOIN CITY J (NOLOCK) ON J.CITY_CODE = I.CITY_CODE 
JOIN STATE K (NOLOCK) ON K.STATE_CODE = J.STATE_CODE 
JOIN EMPLOYEE EMP(NOLOCK) ON EMP.EMP_CODE=C.EMP_CODE
JOIN EMPLOYEE EMP1(NOLOCK) ON EMP1.EMP_CODE=C.EMP_CODE1
JOIN EMPLOYEE EMP2(NOLOCK) ON EMP2.EMP_CODE=C.EMP_CODE2
JOIN COMPANY COM ON COM.COMPANY_CODE ='01' 
WHERE A.MODE<>2


UNION
SELECT A.REMARKS AS REMARKS_MST,
'' AS CM_ID,'' AS FIN_YEAR,A.MEMO_NO,A.MEMO_DT,'' AS CM_NO,'' AS CM_DT, A.CANCELLED,A.CUSTOMER_CODE,
B.MEMO_ID,B.ROW_ID,REF_CMD_ROW_ID,DELIVERED,B.JOB_CODE,B.LAST_UPDATE,B.REMARKS,B.TS,B.DELIVERY_DT,
(CASE WHEN MODE=2 THEN  B.ARTICLE_CODE ELSE SKU.ARTICLE_CODE END) AS ARTICLE_CODE,b.PRODUCT_CODE ,B.PRODUCT_CODE,B.DESCRIPTION,B.QUANTITY,0 AS MRP,
ART.ARTICLE_NO, ART.ARTICLE_NAME,'0000000' AS PARA1_CODE,'' AS  PARA1_NAME,'0000000' AS PARA2_CODE,
'' AS PARA2_NAME,'0000000' AS PARA3_CODE,'' AS PARA3_NAME,UOM_NAME,     
CODING_SCHEME,CONVERT(NUMERIC(10,2),0) AS QUANTITY_IN_STOCK,0 AS PURCHASE_PRICE,
0 AS WS_PRICE,SM.SECTION_NAME, SD.SUB_SECTION_NAME,'0000000' AS PARA4_CODE,'0000000' AS PARA5_CODE,'0000000' AS PARA6_CODE,  
'' AS PARA4_NAME,'' AS PARA5_NAME,'' AS PARA6_NAME,E.UOM_CODE,ISNULL(E.UOM_TYPE,0) AS [UOM_TYPE],  
ART.DT_CREATED AS [ART_DT_CREATED],' 'AS [PARA3_DT_CREATED],'' AS [SKU_DT_CREATED],  
ART.STOCK_NA,
F.JOB_NAME,(H.CUSTOMER_FNAME  + ' ' + H.CUSTOMER_LNAME) AS CUSTOMER_NAME,H.USER_CUSTOMER_CODE,  
(H.ADDRESS1 + ',' + H.ADDRESS2 + ',' + I.AREA_NAME + ',' + I.PINCODE + ',' + J.CITY + ',' + K.STATE) AS CUSTOMER_ADDRESS,
ART.DT_CREATED ,B.DELIVERY_DT AS [DUE_DT],'' AS EMP_NAME,'' AS [EMP_NAME2],'' AS [EMP_NAME3],B.DELIVERY_TIME
,'01' AS COMPANY_CODE
,COM.PAN_NO AS COMP_PANNO
,COM.EMAIL_ID AS COMP_EMAILID
,COM.PWD AS COMP_PWD
,COM.STATE AS COMP_STATE 
,COM.COUNTRY AS COMP_CONTRY
,COM.MOBILE AS COMP_MOBILE
,COM.CONTACT_NAME AS COMP_CONTACTNAME
,COM.TDS_AC_NO AS COMP_TDSACNO
,COM.COMPANY_NAME AS COMP_COMPANYNAME
,COM.ALIAS AS COMP_ALIAS
,COM.ADDRESS1 AS COMP_ADDRESS1
,COM.ADDRESS2 AS COMP_ADDRESS2 
,cast('' as varchar(100)) AS COMP_area_name
,COM.CITY AS COMP_CITY
,COM.TAN_NO AS COMP_TANNO
,COM.PHONES_FAX AS COMP_PHONES_FAX
,COM.CST_DT AS COMP_CST_DT
,COM.SST_NO AS COMP_SSTNO
,COM.SST_DT AS COMP_SSTDT
,COM.GRP_CODE AS COMP_GRPCODE
,COM.ADDRESS9 AS COMP_ADDRESS9
,COM.AREA_CODE AS COMP_AREACODE
,COM.PRINT_ADDRESS AS COMP_PRINTADDRESS
,COM.WORKABLE AS COMP_WORKABLE
,COM.PIN AS COMP_PIN
,COM.LOGO_PATH AS COMP_LOGOPATH
,COM.WEB_ADDRESS AS COMP_WEBADDRESS
,COM.SSPL_FIRST_HDSR AS COMP_SSPLFIRSTHDSR
,COM.POLICY_NO AS COMP_POLICYNO
,COM.GRP_NAME AS COMP_GRPNAME 
,COM.CIN AS COMP_CIN
,0 AS CUSTBAL
,0 AS ITEM_DISCOUNT_AMOUNT
,0 as Bill_DISCOUNT_AMOUNT
,0 As CMM_NET_AMOUNT
,COM.gst_no as COMP_GSTIN
,b.JOB_RATE 
,b.Additional_job
,cast(0 as numeric(10,2)) as Total_JOB_RATE
,cast(0 as numeric(10,2)) as Total_Rec_Amount
,cast(0 as numeric(10,2)) as Pending_Amt
,cast('' as varchar(1000)) as Sale_person
,a.Entry_mode 	

FROM HOLD_BACK_DELIVER_MST A (NOLOCK) 
JOIN HOLD_BACK_DELIVER_DET B (NOLOCK) ON A.MEMO_ID = B.MEMO_ID 
JOIN sku SKU (NOLOCK) ON SKU.PRODUCT_CODE=B.PRODUCT_CODE
JOIN ARTICLE ART (NOLOCK) ON SKU.ARTICLE_CODE = ART.ARTICLE_CODE    
JOIN SECTIOND SD (NOLOCK) ON ART.SUB_SECTION_CODE = SD.SUB_SECTION_CODE  
JOIN SECTIONM SM (NOLOCK) ON SD.SECTION_CODE = SM.SECTION_CODE  
JOIN UOM E (NOLOCK)ON ART.UOM_CODE = E.UOM_CODE 
LEFT OUTER JOIN JOBS F (NOLOCK) ON F.JOB_CODE = B.JOB_CODE         
JOIN CUSTDYM H (NOLOCK) ON A.CUSTOMER_CODE = H.CUSTOMER_CODE
JOIN AREA I (NOLOCK) ON I.AREA_CODE = H.AREA_CODE 
JOIN CITY J (NOLOCK) ON J.CITY_CODE = I.CITY_CODE 
JOIN STATE K (NOLOCK) ON K.STATE_CODE = J.STATE_CODE 
JOIN COMPANY COM ON COM.COMPANY_CODE ='01' 
WHERE A.MODE=2


