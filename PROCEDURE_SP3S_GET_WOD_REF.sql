CREATE PROCEDURE SP3S_GET_WOD_REF
@CMEMOID VARCHAR(30)
AS
BEGIN
	SELECT  D.ROW_ID INTO #tmpWod
	FROM POM01106 A (NOLOCK)
	JOIN POD01106 B (NOLOCK) ON A.PO_ID=B.PO_ID 
	JOIN BUYER_ORDER_DET D (NOLOCK) ON B.WOD_ROW_ID=D.ROW_ID
	JOIN BUYER_ORDER_MST E (NOLOCK) ON E.ORDER_ID=D.ORDER_ID
	WHERE E.ORDER_ID=@CMEMOID AND A.CANCELLED=0 AND E.CANCELLED=0 AND E.MEMO_TYPE=2
	
	INSERT INTO #tmpWod (row_id)
	SELECT D.ROW_ID 
	FROM PLM01106 A (NOLOCK) 
	JOIN PLD01106 B (NOLOCK) ON A.MEMO_ID=B.MEMO_ID 
	JOIN BUYER_ORDER_DET D (NOLOCK) ON B.ORD_ROW_ID=D.ROW_ID
	JOIN BUYER_ORDER_MST E (NOLOCK) ON E.ORDER_ID=D.ORDER_ID
	LEFT JOIN #tmpWod w ON w.row_id=d.row_id
	WHERE E.ORDER_ID=@CMEMOID AND A.CANCELLED=0 AND E.CANCELLED=0 AND E.MEMO_TYPE=2 AND w.row_id IS NULL
	
	INSERT INTO #tmpWod (row_id)
	SELECT D.ROW_ID
	FROM WPS_MST A (NOLOCK) 
	JOIN WPS_DET B (NOLOCK) ON A.PS_ID=B.PS_ID 
	JOIN BUYER_ORDER_DET D (NOLOCK) ON B.BO_DET_ROW_ID=D.ROW_ID
	JOIN BUYER_ORDER_MST E (NOLOCK) ON E.ORDER_ID=D.ORDER_ID
	LEFT JOIN #tmpWod w ON w.row_id=d.row_id
	WHERE E.ORDER_ID=@CMEMOID AND A.CANCELLED=0 AND E.CANCELLED=0 AND A.ENTRY_MODE=3 AND E.MEMO_TYPE=1 AND w.row_id IS NULL
	
	INSERT INTO #tmpWod (row_id)
	SELECT D.ROW_ID			   
	FROM INM01106 A 
	JOIN IND01106 B ON A.INV_ID=B.INV_ID 
	JOIN BUYER_ORDER_DET D ON B.ORDER_ID=D.ORDER_ID
	JOIN BUYER_ORDER_MST E ON E.ORDER_ID=D.ORDER_ID
	LEFT JOIN #tmpWod w ON w.row_id=d.row_id
	WHERE E.ORDER_ID=@CMEMOID AND A.CANCELLED=0 AND E.CANCELLED=0 AND E.MEMO_TYPE=1 AND w.row_id IS NULL

	SELECT * FROM #tmpWod
		
END