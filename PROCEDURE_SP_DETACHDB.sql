CREATE PROCEDURE SP_DETACHDB
(
  @DBNAME VARCHAR(1000)=''
)
AS
BEGIN

   

     declare @CDB_PATH varchar(100),@CERRMSG varchar(100),@mdfname vARCHAR(100)

	 BEGIN TRY

	  IF @DBNAME=DB_NAME()
	  BEGIN
	      SET @CERRMSG='CURRENT DATABASE CAN NOT BE DEATTACHED'
		  GOTO EXIT_PROC
	  END

     SELECT TOP 1   @CDB_PATH=REVERSE(RIGHT(REVERSE(PHYSICAL_NAME), LEN(PHYSICAL_NAME) - CHARINDEX('\', REVERSE(PHYSICAL_NAME)))),
	 @MDFNAME=F.NAME 
	 FROM SYS.DATABASES DB JOIN SYS.MASTER_FILES F ON DB.DATABASE_ID=F.DATABASE_ID
	 WHERE DB.NAME =@dbname AND FILE_ID = 1

	 EXEC master.dbo.sp_detach_db @dbname = @dbname


	 END TRY
BEGIN CATCH
	SET @CERRMSG='P:SP_DETACHDB, MEMO ID MESSAGE:'+ERROR_MESSAGE()
	GOTO EXIT_PROC
END CATCH

EXIT_PROC:

SELECT @CDB_PATH AS DB_PATH,@MDFNAME as DBNAME ,@CERRMSG as errmsg


end
