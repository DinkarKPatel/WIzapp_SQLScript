CREATE PROCEDURE SPPPC_PRD_MULTIPLE_BOM    
(  
 @NQUERYID INT=0,  
 @CARTICLE_CODE VARCHAR(100)='',  
 @CSIZEGROUPCODE VARCHAR(10)='',  
 @NARTICLE_TYPE INT=0  
)  
AS  
BEGIN         
   
     
IF @NQUERYID=1    
BEGIN    
SELECT CAST(1 AS BIT) AS CHK,CASE WHEN B.ARTICLE_TYPE=1 THEN 'FINISH GOOD'    
       WHEN B.ARTICLE_TYPE=2 THEN 'RAW MATERIAL'    
       WHEN B.ARTICLE_TYPE=3 THEN 'FABRIC'    
       WHEN B.ARTICLE_TYPE=4 THEN 'TRIM' ELSE 'PACKING' END AS ARTICLE_TYPE,     
    A.ARTICLE_CODE AS ARTICLE_CODE,--@CARTICLE_CODE    
 A.BOM_ARTICLE_CODE AS BOM_ARTICLE_CODE,    
 AVG_QTY,    
 ROW_ID,    
 A.LAST_UPDATE,    
 A.COMPANY_CODE,    
 RATE,    
 BOM_PARA1_CODE,    
 USES,    
 BOM_SIZEGROUP_CODE,    
 ADD_AVG_QTY, 
 CASE WHEN UC.CONVERSION_VALUE<>0 THEN    
 CONVERT(NUMERIC(12,2),(RATE*AVG_QTY)/UC.CONVERSION_VALUE) 
 ELSE CONVERT(NUMERIC(12,2),(RATE*AVG_QTY))  END AS TOTALCOST,         
 B.ARTICLE_NO AS BOM_ARTICLE_NO,         
 B.ARTICLE_NAME AS BOM_ARTICLE_NAME,   
 E.UOM_NAME AS STOCK_UOM,
 CAST(UC.CONVERSION_VALUE AS NUMERIC(12,3)) AS BOM_QTY,
 BU.CONVERSION_UOM_NAME AS BOM_UOM_NAME, 
 E.UOM_TYPE,    
 0 AS QUANTITY_IN_STOCK,    
 SD.SUB_SECTION_NAME,    
 SD.SUB_SECTION_CODE,    
 SM.SECTION_NAME,    
 SM.SECTION_CODE,    
 P1.PARA1_NAME AS BOM_PARA1_NAME,    
 SG.SIZEGROUP_NAME AS BOM_SIZEGROUP_NAME, 
 '' AS IMAGE_1     ,
 A.WO_ADD_AVG_QTY,
 ISNULL(A.COMPLETED,0) AS COMPLETED
 FROM PPC_ART_BOM A    
 JOIN ARTICLE B ON A.BOM_ARTICLE_CODE=B.ARTICLE_CODE    
 JOIN UOM E ON B.UOM_CODE = E.UOM_CODE     
 LEFT OUTER JOIN PPC_UOM_CONVERSION UC ON UC.UOM_CODE=E.UOM_CODE
 LEFT OUTER JOIN PPC_BOM_UOM BU ON BU.CONVERSION_UOM_CODE=UC.CONVERSION_UOM_CODE
 LEFT JOIN PARA1 P1 ON P1.PARA1_CODE=A.BOM_PARA1_CODE    
 JOIN PPC_SIZEGROUP SG ON SG.SIZEGROUP_CODE=A.BOM_SIZEGROUP_CODE    
 JOIN COMPANY COM ON COM.COMPANY_CODE='01'    
 JOIN SECTIOND SD ON SD.SUB_SECTION_CODE=B.SUB_SECTION_CODE    
 JOIN SECTIONM SM ON SD.SECTION_CODE=SM.SECTION_CODE    
 WHERE A.ARTICLE_CODE=@CARTICLE_CODE AND BOM_SIZEGROUP_CODE=@CSIZEGROUPCODE    
 ORDER BY ISNULL(A.SR_NO,0)
     
END      
ELSE IF @NQUERYID=2     
BEGIN        
SELECT CAST(1 AS BIT) AS CHK,CASE WHEN B.ARTICLE_TYPE=1 THEN 'FINISH GOOD'    
       WHEN B.ARTICLE_TYPE=2 THEN 'RAW MATERIAL'    
       WHEN B.ARTICLE_TYPE=3 THEN 'FABRIC'    
       WHEN B.ARTICLE_TYPE=4 THEN 'TRIM' ELSE 'PACKING' END AS ARTICLE_TYPE,     
    A.ARTICLE_CODE AS ARTICLE_CODE,--@CARTICLE_CODE    
 A.BOM_ARTICLE_CODE AS BOM_ARTICLE_CODE,    
 AVG_QTY,    
 ROW_ID,    
 A.LAST_UPDATE,    
 A.COMPANY_CODE,    
 RATE,    
 BOM_PARA1_CODE,    
 USES,    
 BOM_SIZEGROUP_CODE,    
 ADD_AVG_QTY,    
 CONVERT(NUMERIC(12,2),(RATE*AVG_QTY)) AS TOTALCOST,         
 B.ARTICLE_NO AS BOM_ARTICLE_NO,         
 B.ARTICLE_NAME AS BOM_ARTICLE_NAME,         
 E.UOM_NAME AS STOCK_UOM,
  CAST(UC.CONVERSION_VALUE AS NUMERIC(12,3)) AS BOM_QTY,
 BU.CONVERSION_UOM_NAME AS BOM_UOM_NAME, 
 E.UOM_TYPE,    
 0 AS QUANTITY_IN_STOCK,    
 SD.SUB_SECTION_NAME,    
 SD.SUB_SECTION_CODE,    
 SM.SECTION_NAME,    
 SM.SECTION_CODE,    
 P1.PARA1_NAME AS BOM_PARA1_NAME,    
 SG.SIZEGROUP_NAME AS BOM_SIZEGROUP_NAME  
 ,'' AS IMAGE_1       
 FROM PPC_ART_BOM A    
 JOIN ARTICLE B ON A.BOM_ARTICLE_CODE=B.ARTICLE_CODE    
 JOIN UOM E ON B.UOM_CODE = E.UOM_CODE     
 LEFT OUTER JOIN PPC_UOM_CONVERSION UC ON UC.UOM_CODE=E.UOM_CODE
 LEFT OUTER JOIN PPC_BOM_UOM BU ON BU.CONVERSION_UOM_CODE=UC.CONVERSION_UOM_CODE
 LEFT JOIN PARA1 P1 ON P1.PARA1_CODE=A.BOM_PARA1_CODE    
 JOIN PPC_SIZEGROUP SG ON SG.SIZEGROUP_CODE=A.BOM_SIZEGROUP_CODE    
 JOIN COMPANY COM ON COM.COMPANY_CODE='01'    
 JOIN SECTIOND SD ON SD.SUB_SECTION_CODE=B.SUB_SECTION_CODE    
 JOIN SECTIONM SM ON SD.SECTION_CODE=SM.SECTION_CODE    
 WHERE A.ARTICLE_CODE=@CARTICLE_CODE AND BOM_SIZEGROUP_CODE=@CSIZEGROUPCODE    
 UNION ALL         
 SELECT CAST(0 AS BIT) AS CHK,    
 CASE WHEN A.ARTICLE_TYPE=1 THEN 'FINISH GOOD'    
       WHEN A.ARTICLE_TYPE=2 THEN 'RAW MATERIAL'    
       WHEN A.ARTICLE_TYPE=3 THEN 'FABRIC'    
       WHEN A.ARTICLE_TYPE=4 THEN 'TRIM' ELSE 'PACKING' END AS ARTICLE_TYPE,    
  @CARTICLE_CODE AS ARTICLE_CODE,--@CARTICLE_CODE    
 A.ARTICLE_CODE AS BOM_ARTICLE_CODE,    
 AVG_QTY=CAST(0 AS NUMERIC(10,4)),    
 ROW_ID=CAST('LATER'+CAST(NEWID () AS VARCHAR(40)) AS VARCHAR(40)),    
 LAST_UPDATE=GETDATE(),    
 COMPANY_CODE=COM.COMPANY_CODE,    
 RATE=A.PURCHASE_PRICE,    
 BOM_PARA1_CODE=CAST('0000000' AS VARCHAR(100)),    
 USES=CAST('' AS VARCHAR(10)),    
 @CSIZEGROUPCODE AS BOM_SIZEGROUP_CODE,    
 ADD_AVG_QTY=CAST(0 AS NUMERIC(10,4)),    
 0 AS TOTALCOST,         
 A.ARTICLE_NO AS BOM_ARTICLE_NO,         
 A.ARTICLE_NAME AS BOM_ARTICLE_NAME,         
 E.UOM_NAME AS STOCK_UOM,
 CAST(UC.CONVERSION_VALUE AS NUMERIC(12,3)) AS BOM_QTY,
 BU.CONVERSION_UOM_NAME AS BOM_UOM_NAME, 
 E.UOM_TYPE,    
 0 AS QUANTITY_IN_STOCK,    
 B.SUB_SECTION_NAME,    
 B.SUB_SECTION_CODE,    
 C.SECTION_NAME,    
 C.SECTION_CODE,    
 CAST('' AS VARCHAR(100)) AS BOM_PARA1_NAME,    
 CAST('' AS VARCHAR(100)) AS BOM_SIZEGROUP_NAME  
  ,'' AS IMAGE_1
 FROM ARTICLE A    
 JOIN SECTIOND B ON A.SUB_SECTION_CODE=B.SUB_SECTION_CODE    
 JOIN SECTIONM C ON B.SECTION_CODE=C.SECTION_CODE    
 JOIN COMPANY COM ON COM.COMPANY_CODE='01'    
 JOIN UOM E ON A.UOM_CODE = E.UOM_CODE 
 LEFT OUTER JOIN PPC_UOM_CONVERSION UC ON UC.UOM_CODE=E.UOM_CODE  
 LEFT OUTER JOIN PPC_BOM_UOM BU ON BU.CONVERSION_UOM_CODE=UC.CONVERSION_UOM_CODE
 JOIN PPC_SIZEGROUP S ON S.SIZEGROUP_CODE=@CSIZEGROUPCODE    
 LEFT OUTER JOIN PPC_ART_BOM BOM ON BOM.BOM_ARTICLE_CODE=A.ARTICLE_CODE AND BOM.ARTICLE_CODE=@CARTICLE_CODE AND BOM_SIZEGROUP_CODE=@CSIZEGROUPCODE    
 WHERE  A.INACTIVE=0 AND A.ARTICLE_TYPE<>1  AND BOM.BOM_ARTICLE_CODE IS NULL    
END    
ELSE IF @NQUERYID=3     
BEGIN    
        
    SELECT ARTICLE_CODE AS BOM_ARTICLE_CODE,ARTICLE_NO,ARTICLE_NAME,     
           CASE WHEN A.ARTICLE_TYPE=1 THEN 'FINISH GOOD'    
           WHEN A.ARTICLE_TYPE=2 THEN 'RAW MATERIAL'    
           WHEN A.ARTICLE_TYPE=3 THEN 'FABRIC'    
           WHEN A.ARTICLE_TYPE=4 THEN 'TRIM' ELSE 'PACKING' END AS ARTICLE_TYPE,    
           B.SUB_SECTION_CODE,B.SUB_SECTION_NAME,    
           C.SECTION_CODE,C.SECTION_NAME,
           U.UOM_NAME AS STOCK_UOM,
		   BU.CONVERSION_UOM_NAME AS BOM_UOM_NAME,
		   CAST(UC.CONVERSION_VALUE AS NUMERIC(12,3)) AS BOM_QTY ,
		   BU.CONVERSION_UOM_NAME AS UOM_NAME,
		   CAST('LATER' AS VARCHAR(100)) AS ROW_ID,
		   A.PURCHASE_PRICE AS RATE,   
	       ISNULL(A.DEBIT_MATERIAL,0) AS DEBIT_MATERIAL
    FROM ARTICLE A    
    JOIN SECTIOND B ON A.SUB_SECTION_CODE=B.SUB_SECTION_CODE    
    JOIN SECTIONM C ON B.SECTION_CODE=C.SECTION_CODE   
    JOIN UOM U ON A.UOM_CODE=U.UOM_CODE 
    LEFT OUTER JOIN PPC_UOM_CONVERSION UC ON UC.UOM_CODE=U.UOM_CODE
     LEFT OUTER JOIN PPC_BOM_UOM BU ON BU.CONVERSION_UOM_CODE=UC.CONVERSION_UOM_CODE
    WHERE A.ARTICLE_NO=@CARTICLE_CODE ---REQUUIRED TO BE CHANGES    
    
END    
ELSE IF @NQUERYID=4     
BEGIN    

        
    SELECT CAST(0 AS BIT) AS CHK,    
 CASE WHEN A.ARTICLE_TYPE=1 THEN 'FINISH GOOD'    
       WHEN A.ARTICLE_TYPE=2 THEN 'RAW MATERIAL'    
       WHEN A.ARTICLE_TYPE=3 THEN 'FABRIC'    
       WHEN A.ARTICLE_TYPE=4 THEN 'TRIM' ELSE 'PACKING' END AS ARTICLE_TYPE,    
  @CARTICLE_CODE AS ARTICLE_CODE,--@CARTICLE_CODE    
 A.ARTICLE_CODE AS BOM_ARTICLE_CODE,    
 AVG_QTY=CAST(0 AS NUMERIC(10,4)),    
 ROW_ID=CAST('LATER'+CAST(NEWID () AS VARCHAR(40)) AS VARCHAR(40)),    
 LAST_UPDATE=GETDATE(),    
 COMPANY_CODE=COM.COMPANY_CODE,    
 RATE=A.PURCHASE_PRICE,    
 BOM_PARA1_CODE=CAST('0000000' AS VARCHAR(100)),    
 USES=CAST('' AS VARCHAR(10)),    
 @CSIZEGROUPCODE AS BOM_SIZEGROUP_CODE,    
 ADD_AVG_QTY=CAST(0 AS NUMERIC(10,4)),    
 0 AS TOTALCOST,         
 A.ARTICLE_NO AS BOM_ARTICLE_NO,         
 A.ARTICLE_NAME AS BOM_ARTICLE_NAME, 
 E.UOM_NAME AS STOCK_UOM,     
 ISNULL(BU.CONVERSION_UOM_NAME,E.UOM_NAME) AS BOM_UOM_NAME, 
 CAST(UC.CONVERSION_VALUE AS NUMERIC(12,3)) AS BOM_QTY,
 E.UOM_TYPE,    
 0 AS QUANTITY_IN_STOCK,    
 B.SUB_SECTION_NAME,    
 B.SUB_SECTION_CODE,    
 C.SECTION_NAME,    
 C.SECTION_CODE,    
 CAST('' AS VARCHAR(100)) AS BOM_PARA1_NAME,    
 CAST('' AS VARCHAR(100)) AS BOM_SIZEGROUP_NAME ,
 BU.CONVERSION_UOM_NAME AS UOM_NAME
    
 FROM ARTICLE A    
 JOIN SECTIOND B ON A.SUB_SECTION_CODE=B.SUB_SECTION_CODE    
 JOIN SECTIONM C ON B.SECTION_CODE=C.SECTION_CODE    
 JOIN COMPANY COM ON COM.COMPANY_CODE='01'    
 JOIN UOM E ON A.UOM_CODE = E.UOM_CODE 
 LEFT OUTER JOIN PPC_UOM_CONVERSION UC ON UC.UOM_CODE=E.UOM_CODE
 LEFT OUTER JOIN PPC_BOM_UOM BU ON BU.CONVERSION_UOM_CODE=UC.CONVERSION_UOM_CODE
 JOIN PPC_SIZEGROUP S ON S.SIZEGROUP_CODE=@CSIZEGROUPCODE    
 LEFT OUTER JOIN PPC_ART_BOM BOM ON BOM.BOM_ARTICLE_CODE=A.ARTICLE_CODE AND BOM.ARTICLE_CODE=@CARTICLE_CODE AND BOM_SIZEGROUP_CODE=@CSIZEGROUPCODE    
 WHERE  A.INACTIVE=0  AND A.ARTICLE_TYPE =@NARTICLE_TYPE    
    
END    
    
END
