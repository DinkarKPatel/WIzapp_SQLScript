CREATE VIEW VW_SPLIT_N_COMBINE_QBF 

AS             
SELECT       
A.MEMO_ID,   
A.TAXFORM_STORAGE_MODE AS MST_TAXFORM_STORAGE_MODE,    
A.BILL_LEVEL_TAX_METHOD AS MST_BILL_LEVEL_TAX_METHOD,    
'' AS MST_FORM_NAME,    
A.RECEIPT_DT AS 'MST_RECEIPT_DT',       
A.MEMO_NO AS 'MST_MEMO_NO',          
A.CHECKED_BY AS 'MST_CHECKED_BY',      
A.TOTAL_AMOUNT AS 'MST_TOTAL_AMOUNT',                     
A.REMARKS AS 'MST_REMARKS',      
A.SUBTOTAL AS 'MST_SUBTOTAL',      
C.TAX_AMOUNT AS 'MST_TAX_AMOUNT',      
C.TAX_PERCENTAGE AS 'MST_TAX_PERCENTAGE',      
A.FIN_YEAR AS 'MST_FIN_YEAR',      
B.AC_NAME AS 'MST_SUPP_NAME',      
B.ADDRESS0 AS 'MST_ADDRESS0',      
B.ADDRESS1 AS 'MST_ADDRESS1',      
B.ADDRESS2 AS 'MST_ADDRESS2',      
B.AREA_NAME AS 'MST_AREA_NAME',      
B.CITY AS 'MST_CITY',      
B.PINCODE AS 'MST_PINCODE',      
B.STATE AS 'MST_STATE',      
H.USERNAME AS 'MST_CREATED_USERNAME',      
C.TS AS 'TS',      
C.QUANTITY AS 'QUANTITY',       
C.PURCHASE_PRICE AS 'PURCHASE_PRICE',      
C.MRP AS 'MRP',      
C.PURCHASE_PRICE * C.QUANTITY AS 'AMOUNT',      
BC.PRODUCT_CODE AS 'PRODUCT_CODE',      
C.MP_PERCENTAGE AS 'MP_PERCENTAGE',      
P1.PARA1_NAME AS 'PARA1_NAME',       
P2.PARA2_NAME AS 'PARA2_NAME',       
P3.PARA3_NAME AS 'PARA3_NAME',             
P4.PARA4_NAME AS 'PARA4_NAME',       
P5.PARA5_NAME AS 'PARA5_NAME',       
P6.PARA6_NAME AS 'PARA6_NAME',             
D.ARTICLE_NO AS 'ARTICLE_NO',       
D.ARTICLE_NAME AS 'ARTICLE_NAME',      
D.ARTICLE_DESC AS 'ARTICLE_DESC',      
E.SUB_SECTION_NAME AS 'SUB_SECTION_NAME',       
F.SECTION_NAME AS 'SECTION_NAME',            
U.UOM_NAME AS 'UOM_NAME'       
,A.CHECKED_BY         
,C.FORM_ID      
,A.USER_CODE      
,A.SENT_TO_HO      
,A.FIN_YEAR      
,A.EDT_USER_CODE        
,A.RECEIPT_DT      
,A.AC_CODE      
,A.TOTAL_AMOUNT      
,A.REMARKS      
,A.SUBTOTAL          
,A.CANCELLED      
,A.DEPT_ID       
,B.AC_NAME      
,B.ALIAS      
,B.HEAD_CODE      
,B.CLOSING_BALANCE      
,B.CLOSING_BALANCE_CR_DR      
,B.PRINT_LEDGER      
,B.PRINT_NAME      
,B.ADDRESS0      
,B.ADDRESS1      
,B.ADDRESS2      
,B.AREA_CODE      
,B.AREA_NAME      
,B.PINCODE      
,B.CITY_CODE      
,B.CITY      
,B.STATE_CODE      
,B.STATE      
,B.CST_NO      
,B.CST_DT      
,B.SST_NO      
,B.SST_DT      
,B.TIN_NO      
,B.TIN_DT      
,B.PHONES_R      
,B.PHONES_O      
,B.PHONES_FAX      
,B.MOBILE      
,B.E_MAIL      
,B.TAX_CODE      
,B.BILL_BY_BILL      
,B.ON_HOLD      
,B.THROUGH_BROKER      
,B.BROKER_AC_CODE      
,B.BROKER_COMM_PERCENT      
,B.CREDIT_LIMIT      
,B.ALLOW_CREDITOR_DEBTOR      
,B.DPWEF_DT      
,B.CST_PERCENTAGE      
,B.PAN_NO      
,B.CUSTOMER_CODE      
,B.GLN_NO      
,B.MRP_CALC_MODE      
,B.TDS_CODE      
,B.INV_RATE_TYPE      
,B.OUTSTATION_PARTY      
,B.SALES_AC_CODE      
,B.USERNAME      
,B.EDT_USERNAME      
,C.PARA4_CODE      
,C.PARA5_CODE      
,C.PARA6_CODE      
,C.ARTICLE_CODE      
,C.PARA1_CODE      
,C.PARA2_CODE      
,C.PRINT_LABEL      
,C.ROW_ID      
,C.PARA3_CODE      
,C.SRNO      
,C.WHOLESALE_PRICE      
,C.WSP_PERCENTAGE        
,D.CODING_SCHEME      
,D.UOM_CODE      
,D.PARA1_SET      
,D.PARA2_SET      
,D.INACTIVE      
,D.SKU_CODE      
,D.DT_CREATED      
,D.SUB_SECTION_CODE      
,D.DISCON      
,D.MIN_PRICE      
,D.STOCK_NA      
,D.ARTICLE_TYPE      
,D.CREATED_ON      
,D.ARTICLE_GROUP_CODE      
,COM.COMPANY_CODE      
,D.GENERATE_BARCODES_WITHARTICLE_PREFIX      
,D.ARTICLE_GEN_MODE      
,D.ARTICLE_PRD_MODE      
,D.ARTICLE_SET_CODE      
,D.OH_PERCENTAGE      
,D.OH_AMOUNT      
,D.FIX_MRP      
,E.SECTION_CODE      
,E.MFG_CATEGORY      
,H.MAJOR_USER_CODE      
,H.USER_ALIAS      
,H.DISCOUNT_PERCENTAGE_LEVEL      
,H.VIEW_DATA_AFTER_DFM      
,H.EMAIL      
,U.UOM_TYPE      
,LCT.DEPT_ID AS LOCATION_DEPT_ID      
,LCT.DEPT_NAME AS LOCATION_DEPT_NAME      
,LCT.MAJOR_DEPT_ID AS LOCATION_MAJOR_DEPT_ID      
,LCT.AREA_CODE AS LOCATION_AREA_CODE      
,LCT.PRIMARY_EMAIL AS LOCATION_PRIMARY_EMAIL      
,LCT.PRIMARY_EMAIL_SMTP AS LOCATION_PRIMARY_EMAIL_SMTP      
,LCT.PRIMARY_EMAIL_PWD AS LOCATION_PRIMARY_EMAIL_PWD      
,LCT.PRIMARY_EMAIL_SSL AS LOCATION_PRIMARY_EMAIL_SSL      
,LCT.SSPL_GRP_CODE AS LOCATION_SSPL_GRP_CODE      
,LCT.PUR_LOC AS LOCATION_PUR_LOC      
,LCT.ADDRESS1 AS LOCATION_ADDRESS1      
,LCT.ADDRESS2 AS LOCATION_ADDRESS2      
,LCT.DEPT_AC_CODE AS LOCATION_DEPT_AC_CODE      
,LCT.CST_NO AS LOCATION_CST_NO      
,LCT.CST_DT AS LOCATION_CST_DT      
,LCT.LST_NO AS LOCATION_LST_NO      
,LCT.LST_DT AS LOCATION_LST_DT      
,LCT.DEPT_ALIAS AS LOCATION_DEPT_ALIAS      
,LCT.PHONE AS LOCATION_PHONE      
,LCT.DATE_OF_OPENING AS LOCATION_DATE_OF_OPENING      
,LCT.REPORT_BLOCKED AS LOCATION_REPORT_BLOCKED      
,LCT.INACTIVE AS LOCATION_INACTIVE      
,LCT.LOC_TYPE AS LOCATION_LOC_TYPE      
,LCT.ACCOUNTS_POSTING_DEPT_ID AS LOCATION_ACCOUNTS_POSTING_DEPT_ID      
,LCT.CONTROL_AC_CODE AS LOCATION_CONTROL_AC_CODE      
,LCT.UPD_PURINFO AS LOCATION_UPD_PURINFO      
,LCT.SSPL_REG_KEY AS LOCATION_SSPL_REG_KEY      
,LCT.WIZCOM_ENABLED AS LOCATION_WIZCOM_ENABLED      
,LCT.EXCISABLE AS LOCATION_EXCISABLE      
,LCT.TIN_NO AS LOCATION_TIN_NO      
,LCT.FR_TYPE AS LOCATION_FR_TYPE      
,LCT.PRIMARY_EMAIL_PORT AS LOCATION_PRIMARY_EMAIL_PORT      
,LA.AREA_NAME AS LOCATION_AREA      
,LC.CITY AS LOCATION_CITY      
,LS.STATE AS LOCATION_STATE      
,LRG.REGION_NAME AS LOCATION_REGION      
,EU.USERNAME AS EDIT_USERNAME      
,G.FORM_NAME AS FORM_NAME       
,MU.USERNAME AS MAJOR_USERNAME,SKU.PRODUCT_NAME      
 ,A.MEMO_PREFIX AS MST_MEMO_PREFIX,      
 C.MD_PERCENTAGE,C.WD_PERCENTAGE       
,BIN.BIN_NAME      
,BIN.BIN_NAME AS MST_BIN_NAME  
,C.CONSUMED_ITEM_COST  
,C.VALUE_ADDITION_PER_UNIT  
,C.VALUE_ADDITION  
,A.SNC_MST_MODE AS MST_SNC_MST_MODE  
,A.WIP AS MST_WIP   ,A.location_Code
, D_CONSUME.* 
FROM SNC_MST (NOLOCK) A                  
JOIN LMV01106 (NOLOCK) B ON A.AC_CODE = B.AC_CODE              
JOIN SNC_DET (NOLOCK) C ON A.MEMO_ID = C.MEMO_ID        
JOIN ARTICLE (NOLOCK) D ON C.ARTICLE_CODE = D.ARTICLE_CODE              
JOIN SECTIOND (NOLOCK) E ON D.SUB_SECTION_CODE = E.SUB_SECTION_CODE               
JOIN SECTIONM (NOLOCK) F ON E.SECTION_CODE = F.SECTION_CODE               
JOIN PARA1 (NOLOCK) P1 ON C.PARA1_CODE = P1.PARA1_CODE              
JOIN PARA2 (NOLOCK) P2 ON C.PARA2_CODE = P2.PARA2_CODE              
JOIN PARA3 (NOLOCK) P3 ON C.PARA3_CODE = P3.PARA3_CODE              
JOIN PARA4 (NOLOCK) P4 ON C.PARA4_CODE = P4.PARA4_CODE              
JOIN PARA5 (NOLOCK) P5 ON C.PARA5_CODE = P5.PARA5_CODE              
JOIN PARA6 (NOLOCK) P6 ON C.PARA6_CODE = P6.PARA6_CODE              
JOIN USERS (NOLOCK) H ON A.USER_CODE = H.USER_CODE     
JOIN BIN  (NOLOCK) ON BIN.BIN_ID = A.BIN_ID      
JOIN UOM (NOLOCK) U ON D.UOM_CODE = U.UOM_CODE      
JOIN SNC_BARCODE_DET BC (NOLOCK) ON BC.REFROW_ID=C.ROW_ID  
JOIN SKU (NOLOCK)  ON SKU.PRODUCT_CODE = BC.PRODUCT_CODE      
JOIN LOCATION LCT ON A.DEPT_ID=LCT.DEPT_ID      
JOIN USERS EU ON A.EDT_USER_CODE=EU.USER_CODE      
JOIN AREA LA ON LCT.AREA_CODE=LA.AREA_CODE      
JOIN CITY LC ON LA.CITY_CODE=LC.CITY_CODE      
JOIN STATE LS ON LC.STATE_CODE=LS.STATE_CODE      
JOIN REGIONM LRG ON LS.REGION_CODE=LRG.REGION_CODE      
JOIN FORM G ON G.FORM_ID=C.FORM_ID         
JOIN USERS MU ON H.MAJOR_USER_CODE=MU.USER_CODE       
JOIN COMPANY COM ON 1=1 AND COM.COMPANY_CODE ='01'    
JOIN
(
SELECT DISTINCT
CD.MEMO_ID AS CMEMO_ID,
D.ARTICLE_NAME AS COM_ARTICLE_NAME
,E.SUB_SECTION_NAME AS COM_SUB_SECTION_NAME
,F.SECTION_NAME  AS COM_SECTION_NAME
,CD.PRODUCT_CODE AS COM_PRODUCT_CODE, CD.QUANTITY AS COM_QUANTITY ,
CD.WASTAGE_QUANTITY AS COM_WASTAGE_QUANTITY, CD.AVG_QUANTITY AS COM_AVG_QUANTITY,
CD.PURCHASE_PRICE AS COM_PURCHASE_PRICE, CD.BIN_ID AS COM_BIN_ID, CD.SRNO AS COM_SRNO
,CD.AUTO_SRNO AS COM_AUTO_SRNO, CD.LAST_UPDATE AS COM_LAST_UPDATE, CD.ROW_ID AS COM_ROW_ID
 ,CD.REF_ROW_ID AS COM_REF_ROW_ID, CD.WIP AS COM_WIP, CD.WIP_UID AS COM_WIP_UID,CD.MANUAL_QTY AS COM_MANUAL_QTY,c.ROW_ID  as snc_det_row_id
FROM SNC_MST (NOLOCK) A                  
JOIN LMV01106 (NOLOCK) B ON A.AC_CODE = B.AC_CODE              
JOIN SNC_DET (NOLOCK) C ON A.MEMO_ID = C.MEMO_ID  
JOIN SNC_CONSUMABLE_DET (NOLOCK) CD ON A.MEMO_ID = CD.MEMO_ID              
JOIN ARTICLE (NOLOCK) D ON C.ARTICLE_CODE = D.ARTICLE_CODE              
JOIN SECTIOND (NOLOCK) E ON D.SUB_SECTION_CODE = E.SUB_SECTION_CODE               
JOIN SECTIONM (NOLOCK) F ON E.SECTION_CODE = F.SECTION_CODE               
JOIN PARA1 (NOLOCK) P1 ON C.PARA1_CODE = P1.PARA1_CODE              
JOIN PARA2 (NOLOCK) P2 ON C.PARA2_CODE = P2.PARA2_CODE              
JOIN PARA3 (NOLOCK) P3 ON C.PARA3_CODE = P3.PARA3_CODE              
JOIN PARA4 (NOLOCK) P4 ON C.PARA4_CODE = P4.PARA4_CODE              
JOIN PARA5 (NOLOCK) P5 ON C.PARA5_CODE = P5.PARA5_CODE              
JOIN PARA6 (NOLOCK) P6 ON C.PARA6_CODE = P6.PARA6_CODE              
JOIN BIN  (NOLOCK) ON BIN.BIN_ID = A.BIN_ID      
JOIN UOM (NOLOCK) U ON D.UOM_CODE = U.UOM_CODE      
JOIN SNC_BARCODE_DET BC (NOLOCK) ON BC.REFROW_ID=C.ROW_ID  
JOIN SKU (NOLOCK)  ON SKU.PRODUCT_CODE = BC.PRODUCT_CODE      
)D_CONSUME 
ON D_CONSUME.CMEMO_ID=A.MEMO_ID and c.row_id =D_CONSUME.snc_det_row_id
