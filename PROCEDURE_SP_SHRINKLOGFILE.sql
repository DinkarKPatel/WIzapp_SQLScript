CREATE PROCEDURE SP_SHRINKLOGFILE  
(    
  @CDBNAME NVARCHAR(1000)    =''
)   
--WITH ENCRYPTION  
AS    
BEGIN  
   
    
 DECLARE @CLOGFILENAME NVARCHAR(100) ,@CCMD NVARCHAR(MAX),@NLOOP INT  
	
    
 SET @CLOGFILENAME =''    
   IF ISNULL(@CDBNAME,'')=''
		SET @CDBNAME=DB_NAME()
 SELECT @CLOGFILENAME = NAME     
 FROM SYS.master_files     
 WHERE FILE_ID=2    
 AND database_id=DB_ID(@CDBNAME)
 
 IF ISNULL(@CLOGFILENAME,'') =''  return
   
--SET NOEXEC ON	
 BEGIN TRY  
 SET @NLOOP=1  
 WHILE @NLOOP<=3  
 BEGIN   
	
	SET @CCMD=N'USE '+@CDBNAME+'; DBCC SHRINKFILE ('''+ @CLOGFILENAME +''',1) WITH NO_INFOMSGS'
	PRINT    @CCMD
	
	EXEC(@CCMD )
    SET @NLOOP=@NLOOP+1  
   
 END  
 END TRY  
 BEGIN CATCH  
	SELECT ERROR_MESSAGE()
 END CATCH
   
   
 --SELECT  * from @ShrinkFileResults
 SET @CCMD=N'ALTER DATABASE '+@CDBNAME + ' SET RECOVERY FULL' 
 PRINT    @CCMD   
 EXEC SP_EXECUTESQL @CCMD    
 
END  