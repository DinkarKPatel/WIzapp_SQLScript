create PROCEDURE SP3S_CREATE_MISSING_SKUNAMES   --- Do not verwrite in May2022 Release Folder	
@bRunOptimizedProcess BIT=0
AS
BEGIN
      DECLARE @nSkuCnt INT,@nSkuNamesCnt INT		

	   PRINT 'Step 0.2#'+convert(varchar,getdate(),113)
	  SELECT @nSkuCnt=COUNT(product_code) FROM sku (NOLOCK)
	  SELECT @nSkuNamesCnt=COUNT(product_code) FROM sku_names (NOLOCK)

	   PRINT 'Step 0.4#'+convert(varchar,getdate(),113)
	  IF EXISTS (SELECT TOP 1 product_code FROM  sku_diff (NOLOCK) WHERE sp_id=@@spid)	
  		DELETE FROM sku_diff WITH (ROWLOCK) WHERE sp_id=@@spid
	  
	  IF ISNULL(@nSkuNamesCnt,0)<ISNULL(@nSkuCnt,0)
	  BEGIN
		PRINT 'Step 0.5#'+convert(varchar,getdate(),113)
			INSERT sku_diff (product_code,diff_type,sp_id)
			SELECT a.product_code,1 as diff_type,@@spid sp_id from sku a (NOLOCK)
			LEFT OUTER JOIN sku_names b (NOLOCK) ON a.product_code=b.product_Code
			WHERE b.product_Code IS NULL	
	  
		    INSERT SKU_NAMES (PRODUCT_CODE, LC, PP,PP_WO_DP, MRP, WS_PRICE,AC_NAME
							, ARTICLE_NO, ARTICLE_NAME, STOCK_NA, SECTION_NAME, SUB_SECTION_NAME
							, PARA1_NAME, PARA2_NAME, PARA3_NAME, PARA4_NAME, PARA5_NAME, PARA6_NAME
							, ATTR1_KEY_NAME, ATTR2_KEY_NAME, ATTR3_KEY_NAME, ATTR4_KEY_NAME, ATTR5_KEY_NAME
							, ATTR6_KEY_NAME, ATTR7_KEY_NAME, ATTR8_KEY_NAME, ATTR9_KEY_NAME, ATTR10_KEY_NAME
							, ATTR11_KEY_NAME, ATTR12_KEY_NAME, ATTR13_KEY_NAME, ATTR14_KEY_NAME, ATTR15_KEY_NAME
							, ATTR16_KEY_NAME, ATTR17_KEY_NAME, ATTR18_KEY_NAME, ATTR19_KEY_NAME, ATTR20_KEY_NAME
							, ATTR21_KEY_NAME, ATTR22_KEY_NAME, ATTR23_KEY_NAME, ATTR24_KEY_NAME, ATTR25_KEY_NAME
							, sku_item_type,section_alias,sub_section_alias,para1_alias,para2_alias,para3_alias
							, para4_alias,para5_alias,para6_alias,PURCHASE_BILL_DT,PURCHASE_BILL_NO,AC_CODE
							, para2_order,article_alias,purchase_receipt_Dt,uom,alternate_uom_name,alt_uom_conversion_factor,batch_no,expiry_dt
							,purchase_challan_no,purchase_gst_percentage,purchase_gst_amount,para1_set,para2_set
							,sn_hsn_code,sn_barcode_coding_scheme,sn_article_desc,SKU_ITEM_TYPE_DESC,para7_name,Fix_mrp,basic_purchase_price,SN_Uom_type,SN_ARTICLE_PACK_SIZE)
			SELECT A.PRODUCT_CODE
			,(a.PURCHASE_PRICE+ISNULL(SKU_OH.TAX_AMOUNT,0)+ 
			      ISNULL(SKU_OH.OTHER_CHARGES,0) +  
				  ISNULL(SKU_OH.ROUND_OFF,0) + ISNULL(SKU_OH.FREIGHT,0) + 
				  ISNULL(SKU_OH.EXCISE_DUTY_AMOUNT,0)+ISNULL(SKU_OH.VALUE_ADD,0)) as lc
			,(a.PURCHASE_PRICE + (CASE WHEN  ISNULL(FF.POST_TAX_SEPARATELY,0) =0 AND  ISNULL(FF.FORM_ID,'') <> '0000000' 
				   THEN ISNULL(SKU_OH.TAX_AMOUNT,0) ELSE 0 END)  +
				   ISNULL(SKU_OH.EXCISE_DUTY_AMOUNT,0) +ISNULL(SKU_OH.VALUE_ADD,0)+ISNULL(sku_oh.depreciation,0))
				   AS pp

            ,(a.PURCHASE_PRICE + (CASE WHEN  ISNULL(FF.POST_TAX_SEPARATELY,0) =0 AND  ISNULL(FF.FORM_ID,'') <> '0000000' 
				   THEN ISNULL(SKU_OH.TAX_AMOUNT,0) ELSE 0 END)  +
				   ISNULL(SKU_OH.EXCISE_DUTY_AMOUNT,0) +ISNULL(SKU_OH.VALUE_ADD,0))
				   AS PP_WO_DP

			,A.MRP,A.WS_PRICE,LM01106.AC_NAME
			,ISNULL(ARTICLE_NO,'') ,ISNULL(ARTICLE_NAME,'') ,ISNULL(ARTICLE.STOCK_NA,0)STOCK_NA, ISNULL(SECTION_NAME,'') ,ISNULL(SUB_SECTION_NAME,'')
			,ISNULL(PARA1_NAME,''),ISNULL(PARA2_NAME,''),ISNULL(PARA3_NAME,''),ISNULL(PARA4_NAME,''),ISNULL(PARA5_NAME,''),ISNULL(PARA6_NAME,'')
			,ISNULL(A1.ATTR1_KEY_NAME,'')   ,ISNULL(A2.ATTR2_KEY_NAME,'')   ,ISNULL(A3.ATTR3_KEY_NAME,'')   ,ISNULL(A4.ATTR4_KEY_NAME,'')   ,ISNULL(A5.ATTR5_KEY_NAME,'') 
			,ISNULL(A6.ATTR6_KEY_NAME,'')   ,ISNULL(A7.ATTR7_KEY_NAME,'')   ,ISNULL(A8.ATTR8_KEY_NAME,'')   ,ISNULL(A9.ATTR9_KEY_NAME,'')   ,ISNULL(A10.ATTR10_KEY_NAME,'') 
			,ISNULL(A11.ATTR11_KEY_NAME,'') ,ISNULL(A12.ATTR12_KEY_NAME,'') ,ISNULL(A13.ATTR13_KEY_NAME,'') ,ISNULL(A14.ATTR14_KEY_NAME,'') ,ISNULL(A15.ATTR15_KEY_NAME,'')      
			,ISNULL(A16.ATTR16_KEY_NAME,'') ,ISNULL(A17.ATTR17_KEY_NAME,'') ,ISNULL(A18.ATTR18_KEY_NAME,'') ,ISNULL(A19.ATTR19_KEY_NAME,'') ,ISNULL(A20.ATTR20_KEY_NAME,'')      
			,ISNULL(A21.ATTR21_KEY_NAME,'') ,ISNULL(A22.ATTR22_KEY_NAME,'') ,ISNULL(A23.ATTR23_KEY_NAME,'') ,ISNULL(A24.ATTR24_KEY_NAME,'') ,ISNULL(A25.ATTR25_KEY_NAME,'') 
			,SECTIONM.ITEM_TYPE,SECTIONM.ALIAS AS section_alias,SECTIOND.ALIAS AS sub_section_alias,p1.ALIAS AS para1_alias,p2.ALIAS AS para2_alias
            ,p3.ALIAS AS para3_alias,p4.ALIAS AS para4_alias,p5.ALIAS AS para5_alias,p6.ALIAS AS para6_alias,
			A.inv_dt ,A.inv_no ,A.ac_code,isnull(p2.para2_order,0) as para2_order, article.alias as article_alias,a.receipt_dt ,
			uom.uom_name,ua.uom_name as alternate_uom_name,a.alt_uom_conversion_factor,batch_no,expiry_dt,a.challan_no purchase_challan_no,a.gst_percentage purchase_gst_percentage,
			sku_oh.tax_amount purchase_gst_amount,p1.para1_set,p2.para2_set,a.hsn_code,a.barcode_coding_scheme,ARTICLE.article_desc,
			 (CASE WHEN isnull(SECTIONM.ITEM_TYPE,0) in(0,1) THEN 'INV'   WHEN SECTIONM.ITEM_TYPE =2 THEN 'CONS' WHEN SECTIONM.ITEM_TYPE =3 THEN 'ASSESTS' 
			     WHEN SECTIONM.ITEM_TYPE =4 THEN 'SERVICE' ELSE  '' END),ISNULL(P7.para7_name,'') AS para7_name,
				a.Fix_mrp,a.basic_purchase_price,uom.uom_type,ISNULL(ARTICLE.ARTICLE_PACK_SIZE,1) AS SN_ARTICLE_PACK_SIZE
				
			FROM sku A (NOLOCK)
			JOIN SKU_DIFF df (NOLOCK) ON df.PRODUCT_CODE=a.product_code
			JOIN LM01106 (NOLOCK) ON LM01106.AC_CODE=A.AC_CODE
			LEFT JOIN SKU_OH (NOLOCK) ON A.PRODUCT_CODE=SKU_OH.PRODUCT_CODE 
			LEFT JOIN ARTICLE (NOLOCK) ON ARTICLE.ARTICLE_CODE=A.ARTICLE_CODE
			LEFT JOIN uom (NOLOCK) ON uom.uom_code=article.uom_code
			LEFT JOIN uom ua (NOLOCK) ON ua.uom_code=a.alternate_uom_code
			LEFT JOIN ARTICLE_FIX_ATTR  AF (NOLOCK) ON AF.ARTICLE_CODE=A.ARTICLE_CODE
			LEFT JOIN FORM FF (NOLOCK) ON FF.FORM_ID=A.FORM_ID
			LEFT JOIN SECTIOND (NOLOCK) ON SECTIOND.SUB_SECTION_CODE=ARTICLE.SUB_SECTION_CODE
			LEFT JOIN SECTIONM (NOLOCK) ON SECTIONM.SECTION_CODE=SECTIOND.SECTION_CODE
			LEFT JOIN PARA1 P1 (NOLOCK) ON P1.PARA1_CODE=A.PARA1_CODE      
			LEFT JOIN PARA2 P2 (NOLOCK) ON P2.PARA2_CODE=A.PARA2_CODE      
			LEFT JOIN PARA3 P3 (NOLOCK) ON P3.PARA3_CODE=A.PARA3_CODE      
			LEFT JOIN PARA4 P4 (NOLOCK) ON P4.PARA4_CODE=A.PARA4_CODE      
			LEFT JOIN PARA5 P5 (NOLOCK) ON P5.PARA5_CODE=A.PARA5_CODE      
			LEFT JOIN PARA6 P6 (NOLOCK) ON P6.PARA6_CODE=A.PARA6_CODE  
			LEFT JOIN PARA7 P7 (NOLOCK) ON P7.PARA7_CODE=A.PARA7_CODE  
			LEFT JOIN ATTR1_MST A1 (NOLOCK) ON A1.ATTR1_KEY_CODE=af.attr1_KEY_CODE      
			LEFT JOIN ATTR2_MST A2 (NOLOCK) ON A2.ATTR2_KEY_CODE=af.attr2_KEY_CODE      
			LEFT JOIN ATTR3_MST A3 (NOLOCK) ON A3.ATTR3_KEY_CODE=af.attr3_KEY_CODE      
			LEFT JOIN ATTR4_MST A4 (NOLOCK) ON A4.ATTR4_KEY_CODE=af.attr4_KEY_CODE      
			LEFT JOIN ATTR5_MST A5 (NOLOCK) ON A5.ATTR5_KEY_CODE=af.attr5_KEY_CODE      
			LEFT JOIN ATTR6_MST A6 (NOLOCK) ON A6.ATTR6_KEY_CODE=af.attr6_KEY_CODE      
			LEFT JOIN ATTR7_MST A7 (NOLOCK) ON A7.ATTR7_KEY_CODE=af.attr7_KEY_CODE      
			LEFT JOIN ATTR8_MST A8 (NOLOCK) ON A8.ATTR8_KEY_CODE=af.attr8_KEY_CODE      
			LEFT JOIN ATTR9_MST A9 (NOLOCK) ON A9.ATTR9_KEY_CODE=af.attr9_KEY_CODE      
			LEFT JOIN ATTR10_MST A10 (NOLOCK) ON A10.ATTR10_KEY_CODE=af.attr10_KEY_CODE      
			LEFT JOIN ATTR11_MST A11 (NOLOCK) ON A11.ATTR11_KEY_CODE=af.attr11_KEY_CODE      
			LEFT JOIN ATTR12_MST A12 (NOLOCK) ON A12.ATTR12_KEY_CODE=af.attr12_KEY_CODE      
			LEFT JOIN ATTR13_MST A13 (NOLOCK) ON A13.ATTR13_KEY_CODE=af.attr13_KEY_CODE      
			LEFT JOIN ATTR14_MST A14 (NOLOCK) ON A14.ATTR14_KEY_CODE=af.attr14_KEY_CODE      
			LEFT JOIN ATTR15_MST A15 (NOLOCK) ON A15.ATTR15_KEY_CODE=af.attr15_KEY_CODE      
			LEFT JOIN ATTR16_MST A16 (NOLOCK) ON A16.ATTR16_KEY_CODE=af.attr16_KEY_CODE      
			LEFT JOIN ATTR17_MST A17 (NOLOCK) ON A17.ATTR17_KEY_CODE=af.attr17_KEY_CODE      
			LEFT JOIN ATTR18_MST A18 (NOLOCK) ON A18.ATTR18_KEY_CODE=af.attr18_KEY_CODE      
			LEFT JOIN ATTR19_MST A19 (NOLOCK) ON A19.ATTR19_KEY_CODE=af.attr19_KEY_CODE      
			LEFT JOIN ATTR20_MST A20 (NOLOCK) ON A20.ATTR20_KEY_CODE=af.attr20_KEY_CODE      
			LEFT JOIN ATTR21_MST A21 (NOLOCK) ON A21.ATTR21_KEY_CODE=af.attr21_KEY_CODE      
			LEFT JOIN ATTR22_MST A22 (NOLOCK) ON A22.ATTR22_KEY_CODE=af.attr22_KEY_CODE      
			LEFT JOIN ATTR23_MST A23 (NOLOCK) ON A23.ATTR23_KEY_CODE=af.attr23_KEY_CODE      
			LEFT JOIN ATTR24_MST A24 (NOLOCK) ON A24.ATTR24_KEY_CODE=af.attr24_KEY_CODE      
			LEFT JOIN ATTR25_MST A25 (NOLOCK) ON A25.ATTR25_KEY_CODE=Af.ATTR25_KEY_CODE
			WHERE df.sp_id=@@SPID
			

			DELETE FROM sku_diff WITH (ROWLOCK) WHERE sp_id=@@spid
			

	  END

END