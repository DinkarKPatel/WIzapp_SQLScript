CREATE PROCEDURE SP_WL_ARTICLELIST
(
	@CWHERE NVARCHAR(100) = ''
)
--WITH ENCRYPTION
AS  
BEGIN	
		---- COnverted into Dynamic statement to avoid case when in the static statement (Sanjay)
		deCLARe @cCmd NvArchar(max)
				
		SeT @cCmd=N'SELECT A.ARTICLE_CODE, A.ARTICLE_NAME, A.ARTICLE_NO,   
		B.SUB_SECTION_NAME, C.SECTION_NAME    ,A.MRP_RESTRICTION_FROM,A.MRP_RESTRICTION_TO,A.MRP_RESTRICTION
		FROM ARTICLE A (NOLOCK)  
		JOIN SECTIOND B  (NOLOCK) ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE  
		JOIN SECTIONM C  (NOLOCK) ON B.SECTION_CODE = C.SECTION_CODE  
		WHERE A.ARTICLE_NO <> '''' AND A.INACTIVE=0 AND A.CODING_SCHEME <> 1  
		AND A.ARTICLE_CODE = '+(CASE WHEN @CWHERE = '' THEN 'A.ARTICLE_CODE' ELSE ''''+@CWHERE+'''' END)+' 
		--Rohit : 19-05-2022 Reference Goenka Andman Nicobar Island
		--UNION ALL
		--SELECT A.ARTICLE_CODE, A.ARTICLE_NAME, A1.PRODUCT_CODE AS [ARTICLE_NO],   
		--B.SUB_SECTION_NAME, C.SECTION_NAME 
		--FROM SKU A1   (NOLOCK) 
		--JOIN ARTICLE A   (NOLOCK) ON A.ARTICLE_CODE=A1.ARTICLE_CODE
		--JOIN SECTIOND B  (NOLOCK) ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE  
		--JOIN SECTIONM C  (NOLOCK) ON B.SECTION_CODE = C.SECTION_CODE  
		--WHERE A.ARTICLE_NO <> '''' AND A.INACTIVE=0 AND A1.BARCODE_CODING_SCHEME = 1 AND isnull(A.gen_ean_codes,0)<>1 
		--AND A1.PRODUCT_CODE = '+(CASE WHEN @CWHERE = '' THEN 'A1.product_code' ELSE ''''+@CWHERE+'''' END)+' 
		UNION ALL   
		SELECT A.ARTICLE_CODE, A.ARTICLE_NAME, EAN.EAN AS [ARTICLE_NO],     
		B.SUB_SECTION_NAME, C.SECTION_NAME   ,A.MRP_RESTRICTION_FROM,A.MRP_RESTRICTION_TO,A.MRP_RESTRICTION
		FROM EAN_SYNC EAN  (NOLOCK)
		JOIN SKU A1  (NOLOCK)    ON EAN.PRODUCT_CODE=A1.PRODUCT_CODE
		JOIN ARTICLE A  (NOLOCK)  ON A.ARTICLE_CODE=A1.ARTICLE_CODE  
		JOIN SECTIOND B  (NOLOCK)  ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE    
		JOIN SECTIONM C  (NOLOCK) ON B.SECTION_CODE = C.SECTION_CODE    
		WHERE A.ARTICLE_NO <> '''' AND A.INACTIVE=0 AND A1.BARCODE_CODING_SCHEME= 1	AND isnull(A.gen_ean_codes,0)<>1
		AND EAN.EAN= '+(CASE WHEN @CWHERE = '' THEN 'EAN.EAN' ELSE ''''+@CWHERE+'''' END)+' 
		ORDER BY  ARTICLE_NO'
		
		print @cCmd
		EXeC Sp_EXECuTeSQl @cCmd  
END