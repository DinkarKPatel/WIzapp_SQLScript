CREATE FUNCTION FN_CASHMEMO_HEADER_CAPTION
(
 @CMEMO_ID VARCHAR(40)
)
RETURNS VARCHAR(50)
AS
BEGIN
     DECLARE @CCOUNT INT,@NAME VARCHAR(50),@PC1 CHAR(7),@PC2 CHAR(7),@PC3 CHAR(7),@PC4 CHAR(7),@PC5 CHAR(7),@CM_NO CHAR(15)
     SELECT @CCOUNT=COUNT(PAYMODE_CODE) FROM PAYMODE_XN_DET WHERE MEMO_ID=@CMEMO_ID
     SELECT @CM_NO= CM_NO FROM CMM01106 WHERE CM_ID=@CMEMO_ID
      
      IF @CCOUNT=1
       BEGIN
		   SELECT @PC1=PG.PAYMODE_GRP_CODE,@PC2=P.PAYMODE_CODE,@PC3=SIGN(P.AMOUNT) FROM PAYMODE_XN_DET P
			JOIN PAYMODE_MST PM ON PM.PAYMODE_CODE=P.PAYMODE_CODE
			JOIN PAYMODE_GRP_MST PG ON PG.PAYMODE_GRP_CODE=PM.PAYMODE_GRP_CODE
			 WHERE P.MEMO_ID=@CMEMO_ID
	       
			   IF @PC1='0000001'AND @PC2='0000000' AND @PC3<> '-1.00'
				 SET @NAME='CASH MEMO'
			 ELSE  IF @PC1='0000001'AND @PC2='0000000' AND @PC3='-1.00' AND LEFT(@CMEMO_ID,5)<>'N'
				 SET @NAME='CASH REFUND'
			   ELSE IF @PC1='0000004' AND @PC2='0000004'
				 SET @NAME='CREDIT ISSUE'
			   ELSE IF SUBSTRING(@CM_NO,5,1)='N'
				 SET @NAME='CRDEIT NOTE ISSUE'
			   ELSE IF @PC1='0000004' AND @PC2='CMR0001'
				 SET @NAME='CRDEIT REFUND'
			   ELSE IF @PC1='0000002' AND @PC2 IN ('0000005','0000006')
				 SET @NAME='CASH MEMO'
			   ELSE 
			     SET @NAME='CASH MEMO'	 	 
       END

     IF @CCOUNT >1
      BEGIN
		   SELECT @PC1=COUNT(*) FROM PAYMODE_XN_DET WHERE PAYMODE_CODE='0000000' AND MEMO_ID=@CMEMO_ID 
		   SELECT @PC2=COUNT(*) FROM PAYMODE_XN_DET WHERE PAYMODE_CODE='0000004' AND MEMO_ID=@CMEMO_ID
		   SELECT @PC3=COUNT(*) FROM PAYMODE_XN_DET WHERE PAYMODE_CODE IN ('0000005','0000006') AND MEMO_ID=@CMEMO_ID
		   SELECT @PC4=COUNT(*) FROM PAYMODE_XN_DET WHERE PAYMODE_CODE='CMR0001' AND MEMO_ID=@CMEMO_ID
	       
		   IF (@PC1=1 AND @PC2=1 AND @PC3=0 AND @PC4=0)
			 SET @NAME='CASH/CRDIT ISSUE'
		  ELSE IF (@PC1=1 AND @PC2=1 AND @PC3=1 AND @PC4=0)
			 SET @NAME='CASH/CRDIT ISSUE'
		  ELSE IF (@PC1=1 AND @PC2=0 AND @PC3=1 AND @PC4=0)
			 SET @NAME='CASH MEMO'
		  ELSE IF (@PC1=1 AND @PC2=1 AND @PC3=1 AND @PC4=0)
			 SET @NAME='CREDIT ISSUE'
		 ELSE
		     SET @NAME='CASH MEMO'	 
      END
     
     RETURN @NAME

END