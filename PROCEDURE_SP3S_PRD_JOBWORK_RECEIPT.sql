CREATE PROCEDURE SP3S_PRD_JOBWORK_RECEIPT
(
  @DFROM_DT DATETIME,
  @DTO_DT DATETIME,
  @AGENCY_CODE VARCHAR(100)='',
  @CANCELLED INT=0
)
AS
BEGIN
   
   
SELECT A.RECEIPT_NO,
A.RECEIPT_DT,
A.AC_CODE,
A.JOB_CODE,
A.CANCELLED,
A.SUBTOTAL,
A.TDS,
A.OTHER_CHARGES,
A.NET_AMOUNT,
A.DEPT_ID,
A.RECEIPT_ID AS MEMO_ID,
DEPARTMENT_NAME,
A.REF_NO,
A.REMARKS,
A.AGENCY_CODE,
AGENCY_NAME,
A.CHALLAN_NO,
A.DEPARTMENT_ID,
A.CHALLAN_DT,
SUM(QUANTITY) AS QUANTITY 
FROM PRD_JOBWORK_RECEIPT_MST (NOLOCK) A
JOIN PRD_JOBWORK_RECEIPT_DET (NOLOCK) B ON A.RECEIPT_ID=B.RECEIPT_ID 
JOIN PRD_DEPARTMENT_MST (NOLOCK) C ON A.DEPARTMENT_ID=C.DEPARTMENT_ID
JOIN PRD_AGENCY_MST (NOLOCK) D ON A.AGENCY_CODE=D.AGENCY_CODE
WHERE A.RECEIPT_DT BETWEEN @DFROM_DT AND @DTO_DT
AND (@AGENCY_CODE='' OR A.AGENCY_CODE=@AGENCY_CODE)
GROUP BY A.RECEIPT_NO,
A.RECEIPT_DT,
A.AC_CODE,
A.JOB_CODE,
A.CANCELLED,
A.SUBTOTAL,
A.TDS,
A.OTHER_CHARGES,
A.NET_AMOUNT,
A.DEPT_ID,
A.RECEIPT_ID,
A.REF_NO,
A.REMARKS,
A.AGENCY_CODE,
A.CHALLAN_NO,
A.DEPARTMENT_ID,
A.CHALLAN_DT,
DEPARTMENT_NAME,
AGENCY_NAME



END
