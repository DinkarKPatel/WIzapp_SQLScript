CREATE  PROC SP_PRD_ARTICLE_SUMMARY_DET        
(        
 @NMODE INT = 0,        
 @CSUBSECTIONCODE VARCHAR(20)='',        
 @CARTICLENO VARCHAR(20)='',        
 @CARTICLENAME VARCHAR(10)='',        
 @CARTICLEDESC VARCHAR(10) = '' ,
 @CARTICLETYPE VARCHAR(2) =1 
) 
--WITH ENCRYPTION   
       
AS      
BEGIN        
 DECLARE @CCMD NVARCHAR(MAX)        
    
 SET @CCMD = N'SELECT DISTINCT B.SUB_SECTION_NAME, B.SUB_SECTION_CODE, A.ARTICLE_NO, A.ARTICLE_CODE,               
    A.ARTICLE_NAME, A.ARTICLE_DESC, ISNULL(E.MRP,A.MRP) AS MRP,ISNULL(E.PURCHASE_PRICE,A.PURCHASE_PRICE) AS PURCHASE_PRICE,
    ISNULL(E.WS_PRICE,A.WHOLESALE_PRICE) AS WS_PRICE,0 AS QUANTITY_IN_STOCK      
    FROM ARTICLE A               
    JOIN SECTIOND B ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE        
    LEFT OUTER JOIN SKU C ON A.ARTICLE_CODE = C.ARTICLE_CODE        
    LEFT OUTER JOIN ART_DET E ON A.ARTICLE_CODE = E.ARTICLE_CODE    
    LEFT OUTER JOIN PARA2 P2 ON E.PARA2_CODE = P2.PARA2_CODE     
    WHERE A.ARTICLE_TYPE = '+@CARTICLETYPE +' AND A.ARTICLE_NO <> '''''+         
    (CASE WHEN @CSUBSECTIONCODE <>'' THEN  ' AND A.SUB_SECTION_CODE = ''' + @CSUBSECTIONCODE + '''' ELSE '' END ) +         
    (CASE WHEN @CARTICLENO <>'' THEN ' AND A.ARTICLE_NO LIKE ''' + @CARTICLENO + '%''' ELSE '' END ) +        
    (CASE WHEN @CARTICLENAME <>'' THEN ' AND A.ARTICLE_NAME LIKE ''' + @CARTICLENAME + '%''' ELSE '' END ) +        
    (CASE WHEN @CARTICLEDESC <>'' THEN ' AND A.ARTICLE_DESC LIKE ''' + @CARTICLEDESC + '%''' ELSE '' END ) +        
    (CASE WHEN @NMODE =1 THEN ' AND B.MFG_CATEGORY =1 ' ELSE ' AND B.MFG_CATEGORY IN(0,2) ' END) + 
    (CASE WHEN @CARTICLETYPE =2 THEN ' AND A.ARTICLE_TYPE =2 ' ELSE '' END) +  
    N' ORDER BY B.SUB_SECTION_NAME, A.ARTICLE_NO'        
 PRINT @CCMD        
 EXEC SP_EXECUTESQL @CCMD          
END
