create VIEW VW_GSTREPS    
AS 
 
 
    SELECT  SENDER_NAME,SENDER_GSTN_ID,SENDER_STATE_CODE,
			SENDER_STATE_NAME,RECEIVER_NAME,RECEIVER_GSTN_ID,
			RECEIVER_STATE_CODE,SUB_TRANSACTION_TYPE,
			TRANSACTION_TYPE+' '+ +
			CASE WHEN isnull(A.XN_ITEM_TYPE,0) in(0,1) THEN 'INV' 
			     WHEN A.XN_ITEM_TYPE =2 THEN 'CONS' 
			     WHEN A.XN_ITEM_TYPE =3 THEN 'ASSESTS' 
			     WHEN A.XN_ITEM_TYPE =4 THEN 'SERVICE' 
			ELSE '' END AS TRANSACTION_TYPE,
			SENDER_INVOICE_NO,
			SENDER_INVOICE_DATE,HSN_CODE,GST_PERCENTAGE,
			LOCATION_ID,LOCATION_NAME,REFERENCE_NUMBER,REFERENCE_DATE,
			OH_TYPE,PRODUCT_CODE,INVOICE_VALUE,VAT_PERCENTAGE,
			TRANSACTION_MODE,A.LOC_GST_NO,TRANSACTION_GROUP,ORDER_NO,
			ONLINE_BILL_REF_NO,BIN.BIN_ID,PARTY_REGISTRATION_STATUS,
			MRR_NO,MRR_DT,
			CASE WHEN TRANSACTION_GROUP='OUTWARD' THEN QUANTITY ELSE 0 END AS QUANTITY_OW,
			CASE WHEN TRANSACTION_GROUP='INWARD' THEN QUANTITY ELSE 0 END AS  QUANTITY_IW,
			CASE WHEN TRANSACTION_GROUP='OUTWARD' THEN TAXABLE_VALUE ELSE 0 END AS TAXABLE_VALUE_OW,
			CASE WHEN TRANSACTION_GROUP='INWARD' THEN TAXABLE_VALUE ELSE 0 END AS  TAXABLE_VALUE_IW,
			CASE WHEN TRANSACTION_GROUP='OUTWARD' THEN  CGST_AMOUNT  ELSE 0 END AS CGST_AMOUNT_OW,
			CASE WHEN TRANSACTION_GROUP='INWARD' THEN CGST_AMOUNT ELSE 0 END AS    CGST_AMOUNT_IW,
			CASE WHEN TRANSACTION_GROUP='OUTWARD' THEN SGST_AMOUNT  ELSE 0 END AS  SGST_AMOUNT_OW,
			CASE WHEN TRANSACTION_GROUP='INWARD' THEN SGST_AMOUNT ELSE 0 END AS    SGST_AMOUNT_IW,
			CASE WHEN TRANSACTION_GROUP='OUTWARD' THEN IGST_AMOUNT  ELSE 0 END AS  IGST_AMOUNT_OW,
			CASE WHEN TRANSACTION_GROUP='INWARD' THEN IGST_AMOUNT ELSE 0 END AS    IGST_AMOUNT_IW,
			CASE WHEN TRANSACTION_GROUP='OUTWARD' THEN UTGST_AMOUNT  ELSE 0 END AS UTGST_AMOUNT_OW,
			CASE WHEN TRANSACTION_GROUP='INWARD' THEN UTGST_AMOUNT ELSE 0 END AS   UTGST_AMOUNT_IW,
			CASE WHEN TRANSACTION_GROUP='OUTWARD' THEN TRANSACTION_VALUE_INCLUDING_GST  ELSE 0 END AS TRANSACTION_VALUE_INCLUDING_GST_OW,
			CASE WHEN TRANSACTION_GROUP='INWARD' THEN TRANSACTION_VALUE_INCLUDING_GST ELSE 0 END AS   TRANSACTION_VALUE_INCLUDING_GST_IW,
			CASE WHEN TRANSACTION_GROUP='OUTWARD' THEN TAX_ROUND_OFF  ELSE 0 END AS TAX_ROUND_OFF_OW,
			CASE WHEN TRANSACTION_GROUP='INWARD' THEN TAX_ROUND_OFF ELSE 0 END AS   TAX_ROUND_OFF_IW,
			CASE WHEN TRANSACTION_GROUP='OUTWARD' THEN VAT_AMOUNT ELSE 0 END AS VAT_AMOUNT_OW,
			CASE WHEN TRANSACTION_GROUP='INWARD' THEN VAT_AMOUNT ELSE 0 END AS  VAT_AMOUNT_IW,
    BIN.BIN_NAME ,
    VENDOR_BILL_DATE,
    CASE WHEN ISNULL(A.XN_ITEM_TYPE,1) in(0,1) THEN 'INVENTORY'
         WHEN ISNULL(A.XN_ITEM_TYPE,1) =2 THEN 'CONSUMABLE'
         WHEN ISNULL(A.XN_ITEM_TYPE,1) =3 THEN 'ASSESTS'
         ELSE 'SERVICE' END AS XN_ITEM_TYPE,
         DISCOUNT_PERCENTAGE AS DISC_PCT,
         CASE WHEN TRANSACTION_GROUP='OUTWARD' THEN DISCOUNT_AMOUNT ELSE 0 END AS DISC_AMT_OW,
		 CASE WHEN TRANSACTION_GROUP='INWARD' THEN DISCOUNT_AMOUNT ELSE 0 END AS  DISC_AMT_IW,
         PROFIT_PERCENTAGE,
         CASE WHEN TRANSACTION_GROUP='OUTWARD' THEN PROFIT_AMOUNT ELSE 0 END AS PROFIT_AMOUNT_OW,
		 CASE WHEN TRANSACTION_GROUP='INWARD' THEN PROFIT_AMOUNT ELSE 0 END AS  PROFIT_AMOUNT_IW,
		 CASE WHEN TRANSACTION_GROUP='OUTWARD' THEN CESS_AMOUNT ELSE 0 END AS CESS_AMOUNT_OW,
		 CASE WHEN TRANSACTION_GROUP='INWARD' THEN CESS_AMOUNT ELSE 0 END AS  CESS_AMOUNT_IW,
		 L.dept_alias AS LOCATION_ALIAS 
		 
         
    FROM 
    (
    --1CASH MEMO
    SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,
           D.CUSTOMER_FNAME +' '+D.CUSTOMER_LNAME  AS RECEIVER_NAME,
           ISNULL(A.Party_Gst_No,'') AS RECEIVER_GSTN_ID,
           ISNULL(A.PARTY_STATE_CODE  ,'') AS RECEIVER_STATE_CODE,
           CAST('RETAIL SALE' AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST('RETAIL SALE' AS VARCHAR(100)) AS TRANSACTION_TYPE,
           CAST(A.CM_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.CM_DT AS SENDER_INVOICE_DATE,
           A.OTHER_CHARGES_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE ,0) AS TAXABLE_VALUE,
           ISNULL(A.OTHER_CHARGES_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           A.location_code/*LEFT(M.MEMO_ID,2)*//*Rohit 04-11-2024*/AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.OTHER_CHARGES_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN A.OTHER_CHARGES_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.OTHER_CHARGES_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN A.OTHER_CHARGES_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)+ ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)+ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST,
           CAST('OTHER_CHARGES' AS VARCHAR(100)) AS OH_TYPE,
           CAST('' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT,
           CAST(CASE WHEN  ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)<>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE,
           B.LOC_GST_NO ,
           CAST('OUTWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,
           CAST(CASE WHEN ISNULL(A.Party_Gst_No,'')<>'' THEN 'REGISTERED' ELSE 'UNREGISTERED' END AS VARCHAR(50)) AS PARTY_REGISTRATION_STATUS,
           CAST('' AS VARCHAR(20)) AS MRR_NO,
           CAST('' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('' AS DATETIME) AS  VENDOR_BILL_DATE,
           ISNULL(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(25,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT
             
    FROM CMM01106 A (NOLOCK)
    JOIN LOCATION B (NOLOCK) ON A.location_code/*LEFT(A.CM_ID,2)*//*Rohit 04-11-2024*/=B.DEPT_ID 
    JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE     
    JOIN CUSTDYM D (NOLOCK) ON A.CUSTOMER_CODE =D.CUSTOMER_CODE    
    WHERE A.CANCELLED =0 AND ATD_CHARGES>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
    AND ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)<>0
    UNION ALL
    SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,
           D.CUSTOMER_FNAME +' '+D.CUSTOMER_LNAME  AS RECEIVER_NAME,
           ISNULL(A.Party_Gst_No,'') AS RECEIVER_GSTN_ID,
           ISNULL(A.PARTY_STATE_CODE  ,'') AS RECEIVER_STATE_CODE,
           CASE WHEN CMD.QUANTITY >0 THEN 'RETAIL SALE' ELSE 'RETAIL SALE RETURN' END AS SUB_TRANSACTION_TYPE,
           'RETAIL SALE' AS TRANSACTION_TYPE,
           CAST(A.CM_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.CM_DT AS SENDER_INVOICE_DATE,
           CMD.HSN_CODE  AS HSN_CODE ,
           CMD.QUANTITY  AS QUANTITY,
           CMD.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(CMD.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           A.location_code/*LEFT(A.CM_ID,2)*//*Rohit 04-11-2024*/ AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           CMD.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN CMD.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           CMD.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN CMD.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST(REF_SLS_MEMO_NO  AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST(REF_SLS_MEMO_DT AS DATETIME) AS REFERENCE_DATE,
           CASE WHEN ISNULL(CMD.XN_VALUE_WITH_GST,0)<>0 THEN ISNULL(CMD.XN_VALUE_WITH_GST,0) ELSE NET-CMM_DISCOUNT_AMOUNT END   AS TRANSACTION_VALUE_INCLUDING_GST,
           '' AS OH_TYPE,
           CMD.PRODUCT_CODE,
           A.NET_AMOUNT AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS VAT_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS VAT_AMOUNT ,
           CAST(CASE WHEN  ISNULL(CMD.IGST_AMOUNT ,0)<>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE,
           B.LOC_GST_NO ,
           CAST('OUTWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           CMD.BIN_ID AS BIN_ID,
           CAST(CASE WHEN ISNULL(A.Party_Gst_No,'')<>'' THEN 'REGISTERED' ELSE 'UNREGISTERED' END AS VARCHAR(50)) AS PARTY_REGISTRATION,
           CAST('' AS VARCHAR(20)) AS MRR_NO,
           CAST('' AS DATETIME) AS MRR_DT,
           CAST(CMD.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           CAST('' AS DATETIME) AS  VENDOR_BILL_DATE ,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           
           CAST(CASE WHEN CMD.MRP*CMD.QUANTITY<>0 THEN 
           (ISNULL(CMD.DISCOUNT_AMOUNT ,0)+ISNULL(CMD.CMM_DISCOUNT_AMOUNT ,0))/(CMD.MRP*CMD.QUANTITY ) *100
            ELSE 0 END AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           
           CAST(ISNULL(CMD.DISCOUNT_AMOUNT ,0)+ISNULL(CMD.CMM_DISCOUNT_AMOUNT ,0) AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(CASE WHEN abs(SKU.PURCHASE_PRICE*CMD.QUANTITY )>1 THEN 
           ((CMD.XN_VALUE_WITHOUT_GST -(SKU.PURCHASE_PRICE*CMD.QUANTITY))/(SKU.PURCHASE_PRICE*CMD.QUANTITY ))*100
           ELSE 0 END AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           
           CAST(CMD.XN_VALUE_WITHOUT_GST -(SKU.PURCHASE_PRICE*CMD.QUANTITY) AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CMD.CESS_AMOUNT AS CESS_AMOUNT
    FROM CMM01106 A (NOLOCK)
    JOIN CMD01106 CMD (NOLOCK) ON A.CM_ID=CMD.CM_ID 
    JOIN LOCATION B (NOLOCK) ON A.location_code/*LEFT(A.CM_ID,2)*//*Rohit 04-11-2024*/=B.DEPT_ID 
    JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE 
    JOIN CUSTDYM D (NOLOCK) ON A.CUSTOMER_CODE =D.CUSTOMER_CODE 
    JOIN SKU (NOLOCK) ON SKU.product_code =CMD.PRODUCT_CODE 
    WHERE A.CANCELLED =0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
    AND ISNULL(CMD.GST_PERCENTAGE,0)>0
    UNION ALL
    SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,
           D.CUSTOMER_FNAME +' '+D.CUSTOMER_LNAME  AS RECEIVER_NAME,
           ISNULL(A.Party_Gst_No,'') AS RECEIVER_GSTN_ID,
           ISNULL(A.PARTY_STATE_CODE  ,'') AS RECEIVER_STATE_CODE,
           CASE WHEN CMD.QUANTITY >0 THEN 'RETAIL SALE' ELSE 'RETAIL SALE RETURN' END AS SUB_TRANSACTION_TYPE,
           'RETAIL SALE' AS TRANSACTION_TYPE,
           CAST(A.CM_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.CM_DT AS SENDER_INVOICE_DATE,
           ISNULL(CMD.HSN_CODE,'') AS HSN_CODE ,
           CMD.QUANTITY  AS QUANTITY,
           CAST((CMD.NET -CMM_DISCOUNT_AMOUNT)-CASE WHEN CMD.TAX_METHOD =1 THEN cmd.TAX_AMOUNT ELSE 0 END AS NUMERIC(12,2))    AS TAXABLE_VALUE,
           0  AS GST_PERCENTAGE,
           A.location_code/*LEFT(A.CM_ID,2)*//*Rohit 04-11-2024*/ AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           0 AS CGST_AMOUNT,
           0 AS SGST_AMOUNT,
           0 AS IGST_AMOUNT,
           0 AS UTGST_AMOUNT,
           CAST(REF_SLS_MEMO_NO  AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST(REF_SLS_MEMO_DT AS DATETIME) AS REFERENCE_DATE,
           (NET-CMM_DISCOUNT_AMOUNT)+CASE WHEN CMD.TAX_METHOD =2 THEN CMD.TAX_AMOUNT ELSE 0 END   AS TRANSACTION_VALUE_INCLUDING_GST,
           '' AS OH_TYPE,
           CMD.PRODUCT_CODE,
           A.NET_AMOUNT AS INVOICE_VALUE,
           CMD .TAX_PERCENTAGE AS VAT_PERCENTAGE,
           CMD.TAX_AMOUNT AS VAT_AMOUNT,
           CAST(CASE WHEN  ISNULL(CMD.IGST_AMOUNT ,0)<>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE,
           B.LOC_GST_NO ,
           CAST('OUTWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           CMD.BIN_ID AS BIN_ID,
           CAST(CASE WHEN ISNULL(A.Party_Gst_No,'')<>'' THEN 'REGISTERED' ELSE 'UNREGISTERED' END AS VARCHAR(50)) AS PARTY_REGISTRATION,
           CAST('' AS VARCHAR(20)) AS MRR_NO,
           CAST('' AS DATETIME) AS MRR_DT,
           CAST(CMD.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('' AS DATETIME) AS  VENDOR_BILL_DATE,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           
           CAST(CASE WHEN CMD.MRP*CMD.QUANTITY<>0 THEN 
           (ISNULL(CMD.DISCOUNT_AMOUNT ,0)+ISNULL(CMD.CMM_DISCOUNT_AMOUNT ,0))/(CMD.MRP*CMD.QUANTITY ) *100
            ELSE 0 END AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           
           CAST(ISNULL(CMD.DISCOUNT_AMOUNT ,0)+ISNULL(CMD.CMM_DISCOUNT_AMOUNT ,0) AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(CASE WHEN (SKU.PURCHASE_PRICE*CMD.QUANTITY )<>0 THEN 
           ((CMD.XN_VALUE_WITHOUT_GST -(SKU.PURCHASE_PRICE*CMD.QUANTITY))/(SKU.PURCHASE_PRICE*CMD.QUANTITY ))*100
           ELSE 0 END AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(CMD.XN_VALUE_WITHOUT_GST -(SKU.PURCHASE_PRICE*CMD.QUANTITY) AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CMD.CESS_AMOUNT AS CESS_AMOUNT
    FROM CMM01106 A (NOLOCK)
    JOIN CMD01106 CMD (NOLOCK) ON A.CM_ID=CMD.CM_ID 
    JOIN LOCATION B (NOLOCK) ON A.location_code/*LEFT(A.CM_ID,2)*//*Rohit 04-11-2024*/=B.DEPT_ID 
    JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE 
    JOIN CUSTDYM D (NOLOCK) ON A.CUSTOMER_CODE =D.CUSTOMER_CODE 
    JOIN SKU (NOLOCK) ON SKU.product_code =CMD.PRODUCT_CODE 
    WHERE A.CANCELLED =0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
    AND ISNULL(CMD.GST_PERCENTAGE,0)=0
    UNION ALL
    --2 WSOSALE
    SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,
           CAST(CASE WHEN A.INV_MODE =1 THEN LM.AC_NAME ELSE TL.DEPT_NAME END AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(CASE WHEN A.INV_MODE =1 THEN LMP.AC_GST_NO  ELSE TL.LOC_GST_NO END AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(CASE WHEN A.INV_MODE =1 THEN  ISNULL(A.PARTY_STATE_CODE  ,'')   ELSE TL.GST_STATE_CODE  END AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(CASE WHEN A.INV_MODE =1 THEN 'PARTY INVOICE' ELSE 'GROUP INVOICE' END AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(CASE WHEN A.INV_MODE =1 THEN 'PARTY INVOICE' ELSE 'GROUP INVOICE' END AS VARCHAR(100)) AS TRANSACTION_TYPE,
           CAST(A.INV_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.INV_DT AS SENDER_INVOICE_DATE,
           A.OTHER_CHARGES_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.OTHER_CHARGES_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           A.location_code/*LEFT(A.INV_ID,2)*//*Rohit 04-11-2024*/ AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.OTHER_CHARGES_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN A.OTHER_CHARGES_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.OTHER_CHARGES_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN A.OTHER_CHARGES_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)+ ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)+ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           CAST('OTHER_CHARGES' AS VARCHAR(100)) AS OH_TYPE,
           CAST('' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT ,
           CAST(CASE WHEN  ISNULL(A.OTHER_CHARGES_IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE,
           B.LOC_GST_NO ,
           CAST('OUTWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,
           CASE WHEN  ISNULL(CASE WHEN INV_MODE =1 THEN LMP.AC_GST_NO ELSE TL.LOC_GST_NO END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           CAST('' AS VARCHAR(20)) AS MRR_NO,
           CAST('' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           CAST('' AS DATETIME) AS  VENDOR_BILL_DATE,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT
      FROM INM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =A.location_code/*LEFT(A.INV_ID,2)*//*Rohit 04-11-2024*/
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      WHERE A.CANCELLED =0 AND A.OTHER_CHARGES>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)>0
      UNION ALL
     SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,
           CAST(CASE WHEN A.INV_MODE =1 THEN LM.AC_NAME ELSE TL.DEPT_NAME END AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(CASE WHEN A.INV_MODE =1 THEN LMP.AC_GST_NO  ELSE TL.LOC_GST_NO END AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(CASE WHEN A.INV_MODE =1 THEN  ISNULL(A.PARTY_STATE_CODE  ,'')   ELSE TL.GST_STATE_CODE  END AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(CASE WHEN A.INV_MODE =1 THEN 'PARTY INVOICE' ELSE 'GROUP INVOICE' END AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(CASE WHEN A.INV_MODE =1 THEN 'PARTY INVOICE' ELSE 'GROUP INVOICE' END AS VARCHAR(100)) AS TRANSACTION_TYPE,
           CAST(A.INV_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.INV_DT AS SENDER_INVOICE_DATE,
           A.FREIGHT_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0) AS TAXABLE_VALUE,
           ISNULL(A.FREIGHT_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           A.location_code/*LEFT(A.INV_ID,2)*//*Rohit 04-11-2024*/ AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.FREIGHT_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN A.FREIGHT_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.FREIGHT_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN A.FREIGHT_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)+ ISNULL(FREIGHT_IGST_AMOUNT ,0)+ISNULL(FREIGHT_CGST_AMOUNT,0)+ISNULL(FREIGHT_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           CAST('FREIGHT' AS VARCHAR(100)) AS OH_TYPE,
           CAST('' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT,
           CAST(CASE WHEN  ISNULL(A.FREIGHT_IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE ,
           B.LOC_GST_NO ,
           CAST('OUTWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,
           CASE WHEN  ISNULL(CASE WHEN INV_MODE =1 THEN LMP.AC_GST_NO ELSE TL.LOC_GST_NO END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           CAST('' AS VARCHAR(20)) AS MRR_NO,
           CAST('' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           CAST('' AS DATETIME) AS  VENDOR_BILL_DATE,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT
      FROM INM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =A.location_code/*LEFT(A.INV_ID,2)*//*Rohit 04-11-2024*/
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      WHERE A.CANCELLED =0 AND A.FREIGHT>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.FREIGHT_TAXABLE_VALUE,0)>0
      UNION ALL
      SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,
           CAST(CASE WHEN A.INV_MODE =1 THEN LM.AC_NAME ELSE TL.DEPT_NAME END AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(CASE WHEN A.INV_MODE =1 THEN LMP.AC_GST_NO  ELSE TL.LOC_GST_NO END AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(CASE WHEN A.INV_MODE =1 THEN  ISNULL(A.PARTY_STATE_CODE  ,'')   ELSE TL.GST_STATE_CODE  END AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(CASE WHEN A.INV_MODE =1 THEN 'PARTY INVOICE' ELSE 'GROUP INVOICE' END AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(CASE WHEN A.INV_MODE =1 THEN 'PARTY INVOICE' ELSE 'GROUP INVOICE' END AS VARCHAR(100)) AS TRANSACTION_TYPE,
           CAST(A.INV_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.INV_DT AS SENDER_INVOICE_DATE,
           A.INSURANCE_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.INSURANCE_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.INSURANCE_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           A.location_code/*LEFT(A.INV_ID,2)*//*Rohit 04-11-2024*/ AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.INSURANCE_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN A.INSURANCE_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.INSURANCE_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN A.INSURANCE_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.INSURANCE_TAXABLE_VALUE,0)+ ISNULL(INSURANCE_IGST_AMOUNT ,0)+ISNULL(INSURANCE_CGST_AMOUNT,0)+ISNULL(INSURANCE_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST ,
           'INSURANCE' AS OH_TYPE,
           CAST('' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT ,
           CAST(CASE WHEN  ISNULL(A.INSURANCE_IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE ,
           B.LOC_GST_NO ,
           CAST('OUTWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,
           CASE WHEN  ISNULL(CASE WHEN INV_MODE =1 THEN LMP.AC_GST_NO ELSE TL.LOC_GST_NO END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           CAST('' AS VARCHAR(20)) AS MRR_NO,
           CAST('' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           CAST('' AS DATETIME) AS  VENDOR_BILL_DATE ,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT
      FROM INM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =A.location_code/*LEFT(A.INV_ID,2)*//*Rohit 04-11-2024*/
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      WHERE A.CANCELLED =0 AND A.INSURANCE>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.INSURANCE_TAXABLE_VALUE,0)>0
      UNION ALL
      SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,
           CAST(CASE WHEN A.INV_MODE =1 THEN LM.AC_NAME ELSE TL.DEPT_NAME END AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(CASE WHEN A.INV_MODE =1 THEN LMP.AC_GST_NO  ELSE TL.LOC_GST_NO END AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(CASE WHEN A.INV_MODE =1 THEN  ISNULL(A.PARTY_STATE_CODE  ,'')   ELSE TL.GST_STATE_CODE  END AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(CASE WHEN A.INV_MODE =1 THEN 'PARTY INVOICE' ELSE 'GROUP INVOICE' END AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(CASE WHEN A.INV_MODE =1 THEN 'PARTY INVOICE' ELSE 'GROUP INVOICE' END AS VARCHAR(100)) AS TRANSACTION_TYPE,
           CAST(A.INV_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.INV_DT AS SENDER_INVOICE_DATE,
           A.PACKING_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.PACKING_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.PACKING_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           A.location_code/*LEFT(A.INV_ID,2)*//*Rohit 04-11-2024*/ AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.PACKING_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN A.PACKING_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.PACKING_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN A.PACKING_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.PACKING_TAXABLE_VALUE,0)+ ISNULL(PACKING_IGST_AMOUNT ,0)+ISNULL(PACKING_CGST_AMOUNT,0)+ISNULL(PACKING_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           'PACKING' AS OH_TYPE,
           CAST('' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT ,
           CAST(CASE WHEN  ISNULL(A.PACKING_IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE ,
           B.LOC_GST_NO ,
           CAST('OUTWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,
           CASE WHEN  ISNULL(CASE WHEN INV_MODE =1 THEN LMP.AC_GST_NO ELSE TL.LOC_GST_NO END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           CAST('' AS VARCHAR(20)) AS MRR_NO,
           CAST('' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           CAST('' AS DATETIME) AS  VENDOR_BILL_DATE,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT
      FROM INM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =A.location_code/*LEFT(A.INV_ID,2)*//*Rohit 04-11-2024*/
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      WHERE A.CANCELLED =0 AND A.PACKING>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.PACKING_TAXABLE_VALUE,0)>0
      UNION ALL
       SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,
           CAST(CASE WHEN A.INV_MODE =1 THEN LM.AC_NAME ELSE TL.DEPT_NAME END AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(CASE WHEN A.INV_MODE =1 THEN LMP.AC_GST_NO  ELSE TL.LOC_GST_NO END AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(CASE WHEN A.INV_MODE =1 THEN  ISNULL(A.PARTY_STATE_CODE  ,'')   ELSE TL.GST_STATE_CODE  END AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(CASE WHEN A.INV_MODE =1 THEN 'PARTY INVOICE' ELSE 'GROUP INVOICE' END AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(CASE WHEN A.INV_MODE =1 THEN 'PARTY INVOICE' ELSE 'GROUP INVOICE' END AS VARCHAR(100)) AS TRANSACTION_TYPE,
           CAST(A.INV_NO AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.INV_DT AS SENDER_INVOICE_DATE,
           IND.HSN_CODE  AS HSN_CODE ,
           IND.QUANTITY  AS QUANTITY,
           XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(IND.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           A.location_code/*LEFT(A.INV_ID,2)*//*Rohit 04-11-2024*/ AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           IND.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN IND.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           IND.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN IND.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           IND.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
           CAST('' AS VARCHAR(5)) AS OH_TYPE,
           IND.PRODUCT_CODE    ,
           A.NET_AMOUNT  AS INVOICE_VALUE ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT ,
           CAST(CASE WHEN  ISNULL(IND.IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE     ,
           B.LOC_GST_NO ,
           CAST('OUTWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           IND.ORDER_NO,
           IND.ONLINE_BILL_REF_NO,
           IND.BIN_ID AS BIN_ID,
           CASE WHEN  ISNULL(CASE WHEN INV_MODE =1 THEN LMP.AC_GST_NO ELSE TL.LOC_GST_NO END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           CAST('' AS VARCHAR(20)) AS MRR_NO,
           CAST('' AS DATETIME) AS MRR_DT,
           CAST(IND.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('' AS DATETIME) AS  VENDOR_BILL_DATE,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           
            CAST(CASE WHEN ind.RATE*ind.QUANTITY<>0 THEN 
            (ISNULL(ind.DISCOUNT_AMOUNT ,0)+ISNULL(ind.INMDISCOUNTAMOUNT  ,0))/(ind.rate*ind.QUANTITY ) *100 
            ELSE 0 END AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           
           CAST(ISNULL(ind.DISCOUNT_AMOUNT ,0)+ISNULL(ind.INMDISCOUNTAMOUNT  ,0) AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(CASE WHEN (SKU.PURCHASE_PRICE*ind.QUANTITY )<>0 THEN 
           ((ind.XN_VALUE_WITHOUT_GST -(SKU.PURCHASE_PRICE*ind.QUANTITY))/(SKU.PURCHASE_PRICE*ind.QUANTITY ))*100
           ELSE 0 END AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           
           CAST(ind.XN_VALUE_WITHOUT_GST -(SKU.PURCHASE_PRICE*ind.QUANTITY) AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           IND.CESS_AMOUNT AS CESS_AMOUNT
         
      FROM INM01106 A (NOLOCK)
      JOIN IND01106 IND (NOLOCK) ON A.INV_ID =IND.INV_ID 
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =A.location_code/*LEFT(A.INV_ID,2)*//*Rohit 04-11-2024*/
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE
      JOIN SKU (NOLOCK) ON SKU.product_code =IND.product_code 
      WHERE A.CANCELLED =0  AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
     -- AND ISNULL(IND.GST_PERCENTAGE,0)>0
      UNION ALL
     --3 DEBIT NOTE
     SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,
           CAST(CASE WHEN A.MODE =1 THEN LM.AC_NAME ELSE TL.DEPT_NAME END AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(CASE WHEN A.MODE =1 THEN LMP.AC_GST_NO  ELSE TL.LOC_GST_NO END AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(CASE WHEN A.MODE =1 THEN  ISNULL(A.PARTY_STATE_CODE  ,'')   ELSE TL.GST_STATE_CODE  END AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(CASE WHEN A.MODE =1 THEN 'PARTY DEBIT NOTE' ELSE 'GROUP DEBIT NOTE' END AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(CASE WHEN A.MODE =1 THEN 'PARTY DEBIT NOTE' ELSE 'GROUP DEBIT NOTE' END AS VARCHAR(100)) AS TRANSACTION_TYPE,
           CAST(A.RM_NO  AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.RM_DT  AS SENDER_INVOICE_DATE,
           A.OTHER_CHARGES_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.OTHER_CHARGES_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           B.dept_id  AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.OTHER_CHARGES_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN A.OTHER_CHARGES_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.OTHER_CHARGES_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN A.OTHER_CHARGES_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)+ ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)+ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST,
           'OTHER_CHARGES' AS OH_TYPE,
           CAST('' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT ,
           CAST(CASE WHEN  ISNULL(A.OTHER_CHARGES_IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE ,
           B.LOC_GST_NO ,
           CAST('OUTWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,
           CASE WHEN  ISNULL(CASE WHEN MODE  =1 THEN LMP.AC_GST_NO ELSE TL.LOC_GST_NO END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           CAST('' AS VARCHAR(20)) AS MRR_NO,
           CAST('' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('' AS DATETIME) AS  VENDOR_BILL_DATE,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT
      FROM RMM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =CASE WHEN ISNULL(A.ACCOUNTS_DEPT_ID,'')<>'' THEN ACCOUNTS_DEPT_ID ELSE  A.location_code/*LEFT(A.RM_ID,2)*//*Rohit 04-11-2024*/ END 
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      WHERE A.CANCELLED =0 AND A.OTHER_CHARGES>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)>0
      UNION ALL
     SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,
           CAST(CASE WHEN A.MODE  =1 THEN LM.AC_NAME ELSE TL.DEPT_NAME END AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(CASE WHEN A.MODE =1 THEN LMP.AC_GST_NO  ELSE TL.LOC_GST_NO END AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(CASE WHEN A.MODE =1 THEN  ISNULL(A.PARTY_STATE_CODE  ,'')   ELSE TL.GST_STATE_CODE  END AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(CASE WHEN A.MODE =1 THEN 'PARTY DEBIT NOTE' ELSE 'GROUP DEBIT NOTE' END AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(CASE WHEN A.MODE =1 THEN 'PARTY DEBIT NOTE' ELSE 'GROUP DEBIT NOTE' END AS VARCHAR(100)) AS TRANSACTION_TYPE,
           CAST(A.RM_NO  AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.RM_DT  AS SENDER_INVOICE_DATE,
           A.FREIGHT_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0) AS TAXABLE_VALUE,
           ISNULL(A.FREIGHT_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           B.DEPT_ID AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.FREIGHT_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN A.FREIGHT_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.FREIGHT_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN A.FREIGHT_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)+ ISNULL(FREIGHT_IGST_AMOUNT ,0)+ISNULL(FREIGHT_CGST_AMOUNT,0)+ISNULL(FREIGHT_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           'FREIGHT' AS OH_TYPE,
           CAST('' AS VARCHAR(100)) AS PRODUCT_CODE,
            A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT,
           CAST(CASE WHEN  ISNULL(A.FREIGHT_IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE  ,
           B.LOC_GST_NO ,
           CAST('OUTWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,
           CASE WHEN  ISNULL(CASE WHEN MODE  =1 THEN LMP.AC_GST_NO ELSE TL.LOC_GST_NO END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           CAST('' AS VARCHAR(20)) AS MRR_NO,
           CAST('' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('' AS DATETIME) AS  VENDOR_BILL_DATE,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS CESS_AMOUNT
      FROM RMM01106 A (NOLOCK)
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =CASE WHEN ISNULL(A.ACCOUNTS_DEPT_ID,'')<>'' THEN ACCOUNTS_DEPT_ID ELSE  A.location_code/*LEFT(A.RM_ID,2)*//*Rohit 04-11-2024*/ END 
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      WHERE A.CANCELLED =0 AND A.FREIGHT>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.FREIGHT_TAXABLE_VALUE,0)>0
      UNION ALL
       SELECT B.DEPT_NAME AS SENDER_NAME,
           B.LOC_GST_NO AS SENDER_GSTN_ID,
           C.GST_STATE_CODE AS SENDER_STATE_CODE,
           C.GST_STATE_NAME AS SENDER_STATE_NAME,
           CAST(CASE WHEN A.MODE =1 THEN LM.AC_NAME ELSE TL.DEPT_NAME END AS VARCHAR(100))  AS RECEIVER_NAME,
           CAST(CASE WHEN A.MODE =1 THEN LMP.AC_GST_NO  ELSE TL.LOC_GST_NO END AS VARCHAR(100))  AS RECEIVER_GSTN_ID,
           CAST(CASE WHEN A.MODE =1 THEN  ISNULL(A.PARTY_STATE_CODE  ,'')   ELSE TL.GST_STATE_CODE  END AS VARCHAR(2)) AS RECEIVER_STATE_CODE,
           CAST(CASE WHEN A.MODE =1 THEN 'PARTY DEBIT NOTE' ELSE 'GROUP DEBIT NOTE' END AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(CASE WHEN A.MODE =1 THEN 'PARTY DEBIT NOTE' ELSE 'GROUP DEBIT NOTE' END AS VARCHAR(100)) AS TRANSACTION_TYPE,
           CAST(A.RM_NO  AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.RM_DT  AS SENDER_INVOICE_DATE,
           RMD.HSN_CODE  AS HSN_CODE ,
           RMD.QUANTITY  AS QUANTITY,
           XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(RMD.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           B.DEPT_ID AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           RMD.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN RMD.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           RMD.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN RMD.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST(RMD.BILL_NO  AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST(RMD.BILL_DT AS DATETIME) AS REFERENCE_DATE,
           RMD.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
           CAST('' AS VARCHAR(5)) AS OH_TYPE,
           RMD.PRODUCT_CODE   ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT,
           CAST(CASE WHEN  ISNULL(RMD.IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE         ,
           B.LOC_GST_NO ,
           CAST('OUTWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           RMD.BIN_ID AS BIN_ID,
           CASE WHEN  ISNULL(CASE WHEN MODE  =1 THEN LMP.AC_GST_NO ELSE TL.LOC_GST_NO END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           CAST('' AS VARCHAR(20)) AS MRR_NO,
           CAST('' AS DATETIME) AS MRR_DT,
           CAST(RMD.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('' AS DATETIME) AS  VENDOR_BILL_DATE,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           
           CAST(CASE WHEN RMD.RATE*RMD.QUANTITY<>0 THEN 
           (ISNULL(RMD.DISCOUNT_AMOUNT ,0)+ISNULL(RMD.RMMDISCOUNTAMOUNT ,0))/(RMD.RATE*RMD.QUANTITY ) *100
            ELSE 0 END AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           
           CAST(ISNULL(RMD.DISCOUNT_AMOUNT ,0)+ISNULL(RMD.RMMDISCOUNTAMOUNT ,0) AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           RMD.CESS_AMOUNT  AS CESS_AMOUNT
      FROM RMM01106  A (NOLOCK)
      JOIN RMD01106 RMD (NOLOCK) ON A.RM_ID =RMD.RM_ID 
      LEFT JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =CASE WHEN ISNULL(A.ACCOUNTS_DEPT_ID,'')<>'' THEN ACCOUNTS_DEPT_ID ELSE  A.location_code/*LEFT(A.RM_ID,2)*//*Rohit 04-11-2024*/ END 
      LEFT JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION TL (NOLOCK) ON TL.DEPT_ID =A.PARTY_DEPT_ID  
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      WHERE A.CANCELLED =0  AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      --AND ISNULL(RMD.GST_PERCENTAGE,0)>0
      UNION ALL
      SELECT CASE WHEN ISNULL(A.CUSTOMER_CODE ,'000000000000') ='000000000000' THEN LM.AC_NAME ELSE CUST.CUSTOMER_FNAME +' '+CUSTOMER_LNAME END  AS SENDER_NAME,
           CASE WHEN ISNULL(A.CUSTOMER_CODE ,'000000000000') ='000000000000' THEN LMP.AC_GST_NO ELSE CUST.CUS_GST_NO  END AS SENDER_GSTN_ID,
           A.PARTY_STATE_CODE  AS SENDER_STATE_CODE,
           PS.GST_STATE_NAME AS SENDER_STATE_NAME, 
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           CAST(CASE WHEN A.ARCT =2 THEN  'ADVANCE' 
                     WHEN A.ARCT =3 THEN  'GV VOUCHER' 
                     WHEN A.ARCT =4 THEN  'OTHER CHARGES'
                     WHEN A.ARCT =5 THEN  'DISC CARD'  
            ELSE '' END AS VARCHAR(100)) AS SUB_TRANSACTION_TYPE,
           CAST(CASE WHEN A.ARCT =2 THEN  'ADVANCE' 
                     WHEN A.ARCT =3 THEN  'GV VOUCHER' 
                     WHEN A.ARCT =4 THEN  'OTHER CHARGES'
                     WHEN A.ARCT =5 THEN  'DISC CARD'  
            ELSE '' END AS VARCHAR(100)) AS TRANSACTION_TYPE,
           CAST(A.ADV_REC_NO  AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           A.ADV_REC_DT  AS SENDER_INVOICE_DATE,
           A.HSN_CODE  AS HSN_CODE ,
           0  AS QUANTITY,
           ISNULL(A.TAXABLE_VALUE,0) AS TAXABLE_VALUE,
           ISNULL(A.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           A.location_code/*LEFT(A.ADV_REC_ID ,2)*//*Rohit 04-11-2024*/ AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN A.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN A.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST(''  AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           A.NET_AMOUNT   AS TRANSACTION_VALUE_INCLUDING_GST,
           CAST(CASE WHEN A.ARCT =2 THEN  'ADVANCE' 
                     WHEN A.ARCT =3 THEN  'GV VOUCHER' 
                     WHEN A.ARCT =4 THEN  'OTHER CHARGES'
                     WHEN A.ARCT =5 THEN  'DISC CARD'  
            ELSE '' END AS VARCHAR(100)) AS OH_TYPE,
           CAST('' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT,
           CAST(CASE WHEN  ISNULL(A.IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE   ,
           B.LOC_GST_NO ,
           CAST('OUTWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,
           CASE WHEN  ISNULL(CASE WHEN ISNULL(A.PARTY_TYPE,0) <>2 THEN LMP.AC_GST_NO ELSE CUST.CUS_GST_NO  END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           CAST('' AS VARCHAR(20)) AS MRR_NO,
           CAST('' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('' AS DATETIME) AS  VENDOR_BILL_DATE,
           1 as XN_ITEM_TYPE,
           CAST(A.DISCOUNT_PERCENTAGE  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(A.discount_amount  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT
      FROM ARC01106   A (NOLOCK) 
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =A.location_code/*LEFT(A.ADV_REC_ID ,2)*//*Rohit 04-11-2024*/
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE 
      JOIN GST_STATE_MST PS (NOLOCK)  ON A.PARTY_STATE_CODE  =PS.GST_STATE_CODE 
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      LEFT OUTER JOIN CUSTDYM CUST (NOLOCK) ON CUST.CUSTOMER_CODE =A.CUSTOMER_CODE 
      WHERE A.CANCELLED =0
      AND ARC_TYPE =1 AND ARCT<>1
     -- AND ISNULL(A.GST_PERCENTAGE,0)>0
      
      UNION ALL
      SELECT CASE WHEN ISNULL(A.CUSTOMER_CODE ,'000000000000') ='000000000000' THEN LM.AC_NAME ELSE CUST.CUSTOMER_FNAME +' '+CUSTOMER_LNAME END  AS SENDER_NAME,
           CASE WHEN ISNULL(A.CUSTOMER_CODE ,'000000000000') ='000000000000' THEN LMP.AC_GST_NO ELSE CUST.CUS_GST_NO  END AS SENDER_GSTN_ID,
           A.PARTY_STATE_CODE  AS SENDER_STATE_CODE,
           PS.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           'ADVANCE ADJUSTED' AS SUB_TRANSACTION_TYPE,
           'ADVANCE ADJUSTED' AS TRANSACTION_TYPE,
           CAST(A.ADV_REC_NO  AS VARCHAR(100)) AS SENDER_INVOICE_NO,
           CM.CM_DT  AS SENDER_INVOICE_DATE,
           A.HSN_CODE  AS HSN_CODE ,
           0  AS QUANTITY,
           ISNULL(A.TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           A.location_code/*LEFT(A.ADV_REC_ID ,2)*//*Rohit 04-11-2024*/ AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN A.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN A.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST(''  AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           A.NET_AMOUNT   AS TRANSACTION_VALUE_INCLUDING_GST,
           'ADVANCE ADJUSTED' AS OH_TYPE,
           CAST('' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.NET_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT,
           CAST(CASE WHEN  ISNULL(A.IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE   ,
           B.LOC_GST_NO ,
           CAST('INWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,
           CASE WHEN  ISNULL(CASE WHEN ISNULL(A.PARTY_TYPE,0) <>2 THEN LMP.AC_GST_NO ELSE CUST.CUS_GST_NO  END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           CAST('' AS VARCHAR(20)) AS MRR_NO,
           CAST('' AS DATETIME) AS MRR_DT,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           CAST('' AS DATETIME) AS  VENDOR_BILL_DATE,
           1 as XN_ITEM_TYPE,
           CAST(A.DISCOUNT_PERCENTAGE  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(A.discount_amount  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT
      FROM ARC01106   A (NOLOCK) 
      JOIN PAYMODE_XN_DET PX (NOLOCK) ON PX.ADJ_MEMO_ID=A.ADV_REC_ID
	  JOIN CMM01106 CM (NOLOCK) ON CM.CM_ID=PX.MEMO_ID
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =A.location_code/*LEFT(A.ADV_REC_ID ,2)*//*Rohit 04-11-2024*/
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE 
      JOIN GST_STATE_MST PS (NOLOCK)  ON A.PARTY_STATE_CODE  =PS.GST_STATE_CODE 
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      LEFT OUTER JOIN CUSTDYM CUST (NOLOCK) ON CUST.CUSTOMER_CODE =A.CUSTOMER_CODE 
      WHERE A.CANCELLED =0
      AND ARC_TYPE =1 AND ARCT=2  AND PAYMODE_CODE='0000002'
     -- AND ISNULL(A.GST_PERCENTAGE,0)>0
 
      UNION ALL
      SELECT CASE WHEN A.INV_MODE =1 THEN LM.AC_NAME ELSE SL.DEPT_NAME END AS SENDER_NAME,
           CASE WHEN A.INV_MODE =1 THEN LMP.AC_GST_NO  ELSE SL.LOC_GST_NO END AS SENDER_GSTN_ID,
           CASE WHEN A.INV_MODE =1 THEN A.PARTY_STATE_CODE    ELSE SL.GST_STATE_CODE  END AS SENDER_STATE_CODE,
           CASE WHEN A.INV_MODE =1 THEN PS.GST_STATE_NAME     ELSE PSSL.GST_STATE_NAME  END AS SENDER_STATE_NAME,
           --CASE WHEN A.INV_MODE =1 THEN A.PARTY_STATE_CODE    ELSE SL.GST_STATE_CODE  END AS SENDER_STATE_CODE,
           --CASE WHEN A.INV_MODE =1 THEN PS.GST_STATE_NAME     ELSE SL.GST_STATE_CODE  END AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,     
           CASE WHEN INV_MODE=1 THEN 'PARTY PURCHASE' ELSE 'GROUP PURCHASE' END AS SUB_TRANSACTION_TYPE,      
           CASE WHEN INV_MODE=1 THEN 'PARTY PURCHASE' ELSE 'GROUP PURCHASE' END AS TRANSACTION_TYPE,
           A.BILL_NO AS SENDER_INVOICE_NO,
           A.BILL_DT  AS SENDER_INVOICE_DATE,
           A.OTHER_CHARGES_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.OTHER_CHARGES_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           B.DEPT_ID  AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.OTHER_CHARGES_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN A.OTHER_CHARGES_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.OTHER_CHARGES_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN A.OTHER_CHARGES_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)+ ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)+ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           'OTHER_CHARGES' AS OH_TYPE,
           CAST('' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT,
           CAST(CASE WHEN  ISNULL(A.OTHER_CHARGES_IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE   ,
           B.LOC_GST_NO ,
           CAST('INWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,
           CASE WHEN  ISNULL(CASE WHEN ISNULL(A.INV_MODE ,0) =1 THEN LMP.AC_GST_NO ELSE B.LOC_GST_NO   END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           A.MRR_NO ,
           A.MRR_DT ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           a.inv_dt   AS VENDOR_BILL_DATE,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT
      FROM PIM01106  A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =CASE WHEN isnull(A.PUR_FOR_DEPT_ID,'')<>'' THEN A.PUR_FOR_DEPT_ID ELSE A.DEPT_ID END
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION SL (NOLOCK) ON SL.DEPT_ID =A.location_code/*LEFT(A.INV_ID ,2)*//*Rohit 04-11-2024*/
      LEFT JOIN GST_STATE_MST PSSL (NOLOCK)  ON SL.GST_STATE_CODE  =PSSL.GST_STATE_CODE 
      JOIN GST_STATE_MST PS (NOLOCK)  ON A.PARTY_STATE_CODE  =PS.GST_STATE_CODE 
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
  --    LEFT JOIN
  --    (
		       
		--SELECT A.MRR_ID AS  REF_MRR_ID,BILL_NO,INV_DT AS BILL_DT,A.RECEIPT_DT ,A.BILL_DT AS ITC_BILL_DT,
		--A.TOTAL_AMOUNT  AS TOTAL_AMOUNT ,ROUND_OFF  
		--FROM PIM01106  A (NOLOCK)
		--WHERE A.CANCELLED=0
		--AND  ISNULL(A.PIM_MODE,0)=5
  --    ) MRRN ON A.REF_CONVERTED_MRNTOBILL_MRRID=MRRN.REF_MRR_ID
    --  LEFT JOIN (SELECT TOP 1 VALUE  FROM CONFIG (NOLOCK) WHERE CONFIG_OPTION='GST_REPORT_FROM_RECEIPT_DT') CNF ON 1=1
      WHERE A.CANCELLED =0 AND A.OTHER_CHARGES>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)>0
      AND ISNULL(A.BILL_CHALLAN_MODE,0)=0
      UNION ALL
      SELECT CASE WHEN A.INV_MODE =1 THEN LM.AC_NAME ELSE SL.DEPT_NAME END AS SENDER_NAME,
           CASE WHEN A.INV_MODE =1 THEN LMP.AC_GST_NO  ELSE SL.LOC_GST_NO END AS SENDER_GSTN_ID,
           CASE WHEN A.INV_MODE =1 THEN A.PARTY_STATE_CODE    ELSE SL.GST_STATE_CODE  END AS SENDER_STATE_CODE,
           CASE WHEN A.INV_MODE =1 THEN PS.GST_STATE_NAME     ELSE PSSL.GST_STATE_NAME  END AS SENDER_STATE_NAME,
           --CASE WHEN A.INV_MODE =1 THEN LMP.AC_GST_STATE_CODE   ELSE SL.GST_STATE_CODE  END AS SENDER_STATE_CODE,
           --C.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           CASE WHEN INV_MODE=1 THEN 'PARTY PURCHASE' ELSE 'GROUP PURCHASE' END AS SUB_TRANSACTION_TYPE,      
           CASE WHEN INV_MODE=1 THEN 'PARTY PURCHASE' ELSE 'GROUP PURCHASE' END AS TRANSACTION_TYPE,
           A.BILL_NO AS SENDER_INVOICE_NO,
           A.BILL_DT  AS SENDER_INVOICE_DATE,
           A.FREIGHT_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.FREIGHT_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           B.DEPT_ID  AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.FREIGHT_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN A.FREIGHT_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.FREIGHT_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN A.FREIGHT_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)+ ISNULL(FREIGHT_IGST_AMOUNT ,0)+ISNULL(FREIGHT_CGST_AMOUNT,0)+ISNULL(FREIGHT_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           'FREIGHT' AS OH_TYPE,
           CAST('' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT ,
           CAST(CASE WHEN  ISNULL(A.FREIGHT_IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE   ,
           B.LOC_GST_NO ,
           CAST('INWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,
           CASE WHEN  ISNULL(CASE WHEN ISNULL(A.INV_MODE ,0) =1 THEN LMP.AC_GST_NO ELSE B.LOC_GST_NO   END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           A.MRR_NO ,
           A.MRR_DT ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
           A.INV_DT   AS VENDOR_BILL_DATE ,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT
      FROM PIM01106  A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =CASE WHEN isnull(A.PUR_FOR_DEPT_ID,'')<>'' THEN A.PUR_FOR_DEPT_ID ELSE A.DEPT_ID END
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION SL (NOLOCK) ON SL.DEPT_ID =A.location_code/*LEFT(A.INV_ID ,2)*//*Rohit 04-11-2024*/
      LEFT JOIN GST_STATE_MST PSSL (NOLOCK)  ON SL.GST_STATE_CODE  =PSSL.GST_STATE_CODE 
      JOIN GST_STATE_MST PS (NOLOCK)  ON A.PARTY_STATE_CODE  =PS.GST_STATE_CODE 
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      WHERE A.CANCELLED =0 AND A.FREIGHT>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.FREIGHT_TAXABLE_VALUE,0)>0
      AND ISNULL(A.BILL_CHALLAN_MODE,0)=0
      UNION ALL
      SELECT CASE WHEN A.INV_MODE =1 THEN LM.AC_NAME ELSE SL.DEPT_NAME END AS SENDER_NAME,
           CASE WHEN A.INV_MODE =1 THEN LMP.AC_GST_NO  ELSE SL.LOC_GST_NO END AS SENDER_GSTN_ID,
            CASE WHEN A.INV_MODE =1 THEN A.PARTY_STATE_CODE    ELSE SL.GST_STATE_CODE  END AS SENDER_STATE_CODE,
           CASE WHEN A.INV_MODE =1 THEN PS.GST_STATE_NAME     ELSE PSSL.GST_STATE_NAME  END AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           CASE WHEN INV_MODE=1 THEN 'PARTY PURCHASE' ELSE 'GROUP PURCHASE' END AS SUB_TRANSACTION_TYPE,      
           CASE WHEN INV_MODE=1 THEN 'PARTY PURCHASE' ELSE 'GROUP PURCHASE' END AS TRANSACTION_TYPE,
           A.BILL_NO AS SENDER_INVOICE_NO,
           A.BILL_DT  AS SENDER_INVOICE_DATE,
           PID.HSN_CODE AS HSN_CODE ,
           PID.QUANTITY  AS QUANTITY,
           PID.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(PID.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           B.DEPT_ID  AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           PID.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN PID.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           PID.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN PID.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           PID.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
           CAST('' AS VARCHAR(10)) AS OH_TYPE,
           PID.PRODUCT_CODE  ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT,
           CAST(CASE WHEN  ISNULL(PID.IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE          ,
           B.LOC_GST_NO ,
           CAST('INWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,
           CASE WHEN  ISNULL(CASE WHEN ISNULL(A.INV_MODE ,0) =1 THEN LMP.AC_GST_NO ELSE B.LOC_GST_NO   END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           A.MRR_NO ,
           A.MRR_DT ,
           CAST(PID.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           a.inv_dt  AS VENDOR_BILL_DATE ,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE ,
           
            CAST(CASE WHEN pid.gross_purchase_price *pid.QUANTITY<>0 THEN 
           (ISNULL(pid.DISCOUNT_AMOUNT ,0)+ISNULL(pid.PIMDISCOUNTAMOUNT ,0))/(pid.gross_purchase_price*pid.QUANTITY ) *100
            ELSE 0 END AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(ISNULL(PID.DISCOUNT_AMOUNT,0)+ISNULL(PID.PIMDISCOUNTAMOUNT,0)   AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT ,
           PID.CESS_AMOUNT 
      FROM PIM01106  A (NOLOCK)
      JOIN PID01106 PID (NOLOCK) ON A.MRR_ID =PID.MRR_ID  
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =CASE WHEN isnull(A.PUR_FOR_DEPT_ID,'')<>'' THEN A.PUR_FOR_DEPT_ID ELSE A.DEPT_ID END
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION SL (NOLOCK) ON SL.DEPT_ID =A.location_code/*LEFT(A.INV_ID ,2)*//*Rohit 04-11-2024*/
      LEFT JOIN GST_STATE_MST PSSL (NOLOCK)  ON SL.GST_STATE_CODE  =PSSL.GST_STATE_CODE 
      JOIN GST_STATE_MST PS (NOLOCK)  ON A.PARTY_STATE_CODE  =PS.GST_STATE_CODE 
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  JOIN (SELECT TOP 1 VALUE FROM CONFIG (NOLOCK) WHERE CONFIG_OPTION='HO_LOCATION_ID') CNF1 ON 1=1      
      JOIN (SELECT TOP 1 VALUE FROM CONFIG (NOLOCK) WHERE CONFIG_OPTION='LOCATION_ID') CNF2 ON 1=1    
      WHERE A.CANCELLED =0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.BILL_CHALLAN_MODE,0)=0
	  and (a.INV_MODE =1 or  CNF1.VALUE<>CNF2.VALUE )
	  union ALL
	  SELECT CASE WHEN A.INV_MODE =1 THEN LM.AC_NAME ELSE SL.DEPT_NAME END AS SENDER_NAME,
           CASE WHEN A.INV_MODE =1 THEN LMP.AC_GST_NO  ELSE SL.LOC_GST_NO END AS SENDER_GSTN_ID,
            CASE WHEN A.INV_MODE =1 THEN A.PARTY_STATE_CODE    ELSE SL.GST_STATE_CODE  END AS SENDER_STATE_CODE,
           CASE WHEN A.INV_MODE =1 THEN PS.GST_STATE_NAME     ELSE PSSL.GST_STATE_NAME  END AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           CASE WHEN a.INV_MODE=1 THEN 'PARTY PURCHASE' ELSE 'GROUP PURCHASE' END AS SUB_TRANSACTION_TYPE,      
           CASE WHEN a.INV_MODE=1 THEN 'PARTY PURCHASE' ELSE 'GROUP PURCHASE' END AS TRANSACTION_TYPE,
           A.BILL_NO AS SENDER_INVOICE_NO,
           A.BILL_DT  AS SENDER_INVOICE_DATE,
           PID.HSN_CODE AS HSN_CODE ,
           PID.QUANTITY  AS QUANTITY,
           PID.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(PID.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           B.DEPT_ID  AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           PID.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN PID.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           PID.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN PID.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           PID.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
           CAST('' AS VARCHAR(10)) AS OH_TYPE,
           PID.PRODUCT_CODE  ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT,
           CAST(CASE WHEN  ISNULL(PID.IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE          ,
           B.LOC_GST_NO ,
           CAST('INWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,
           CASE WHEN  ISNULL(CASE WHEN ISNULL(A.INV_MODE ,0) =1 THEN LMP.AC_GST_NO ELSE B.LOC_GST_NO   END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           A.MRR_NO ,
           A.MRR_DT ,
           CAST(PID.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           a.inv_dt  AS VENDOR_BILL_DATE ,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE ,
           
            CAST(CASE WHEN pid.rate *pid.QUANTITY<>0 THEN 
           (ISNULL(pid.DISCOUNT_AMOUNT ,0)+ISNULL(pid.inMDISCOUNTAMOUNT ,0))/(pid.rate*pid.QUANTITY ) *100
            ELSE 0 END AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(ISNULL(PID.DISCOUNT_AMOUNT,0)+ISNULL(PID.INMDISCOUNTAMOUNT,0)   AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT ,
           PID.CESS_AMOUNT 
      FROM PIM01106  A (NOLOCK)
	  join INM01106 inm (nolock) on A.inv_id =inm.INV_ID 
      JOIN IND01106  pid (NOLOCK) ON inm.inv_id =pid.inv_id  
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =CASE WHEN isnull(A.PUR_FOR_DEPT_ID,'')<>'' THEN A.PUR_FOR_DEPT_ID ELSE A.DEPT_ID END
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION SL (NOLOCK) ON SL.DEPT_ID =A.location_code/*LEFT(A.INV_ID ,2)*//*Rohit 04-11-2024*/
      LEFT JOIN GST_STATE_MST PSSL (NOLOCK)  ON SL.GST_STATE_CODE  =PSSL.GST_STATE_CODE 
      JOIN GST_STATE_MST PS (NOLOCK)  ON A.PARTY_STATE_CODE  =PS.GST_STATE_CODE 
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
	  JOIN (SELECT TOP 1 VALUE FROM CONFIG (NOLOCK) WHERE CONFIG_OPTION='HO_LOCATION_ID') CNF1 ON 1=1      
      JOIN (SELECT TOP 1 VALUE FROM CONFIG (NOLOCK) WHERE CONFIG_OPTION='LOCATION_ID') CNF2 ON 1=1    
      WHERE A.CANCELLED =0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.BILL_CHALLAN_MODE,0)=0
	  and (a.INV_MODE =2 and a.receipt_dt <>'' and   CNF1.VALUE=CNF2.VALUE )
      
      UNION ALL
       SELECT CASE WHEN A.MODE  =1 THEN LM.AC_NAME ELSE SL.DEPT_NAME END AS SENDER_NAME,
           CASE WHEN A.MODE =1 THEN LMP.AC_GST_NO  ELSE SL.LOC_GST_NO END AS SENDER_GSTN_ID,
           CASE WHEN A.MODE =1 THEN A.PARTY_STATE_CODE    ELSE SL.GST_STATE_CODE  END AS SENDER_STATE_CODE,
           CASE WHEN A.MODE =1 THEN ST2.GST_STATE_NAME   ELSE ST1.GST_STATE_NAME  END AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           CASE WHEN A.MODE =1 THEN 'PARTY CREDIT NOTE'   ELSE 'GROUP CREDIT NOTE'  END AS SUB_TRANSACTION_TYPE,
           CASE WHEN A.MODE =1 THEN 'PARTY CREDIT NOTE'   ELSE 'GROUP CREDIT NOTE'  END AS TRANSACTION_TYPE,
          -- CASE WHEN A.MODE =1 THEN CN_NO   ELSE MANUAL_INV_NO  END  AS SENDER_INVOICE_NO,
		   A.CN_NO AS SENDER_INVOICE_NO,
           A.RECEIPT_DT  AS SENDER_INVOICE_DATE,
           A.OTHER_CHARGES_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.OTHER_CHARGES_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           LEFT(A.CN_ID  ,2) AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.OTHER_CHARGES_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN A.OTHER_CHARGES_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.OTHER_CHARGES_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN A.OTHER_CHARGES_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           (ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)+ ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)+ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0)) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           'OTHER_CHARGES' AS OH_TYPE,
           CAST('' AS VARCHAR(100)) AS PRODUCT_CODE ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT,
           CAST(CASE WHEN  ISNULL(A.OTHER_CHARGES_IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE    ,
           B.LOC_GST_NO ,
           CAST('INWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,
           CASE WHEN ISNULL(CASE WHEN ISNULL(A.MODE  ,0) =1 THEN LMP.AC_GST_NO ELSE B.LOC_GST_NO   END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           '' AS MRR_NO ,
           '' AS  MRR_DT ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
           A.CN_DT AS  VENDOR_BILL_DATE ,
           isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT
      FROM CNM01106   A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =A.location_code/*LEFT(A.CN_ID ,2)*//*Rohit 04-11-2024*/
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION SL (NOLOCK) ON SL.DEPT_ID =A.PARTY_DEPT_ID 
      LEFT  JOIN GST_STATE_MST ST1 (NOLOCK)  ON SL.GST_STATE_CODE =ST1.GST_STATE_CODE
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      LEFT  JOIN GST_STATE_MST ST2 (NOLOCK)  ON ST2.GST_STATE_CODE =A.PARTY_STATE_CODE 
      LEFT JOIN (SELECT TOP 1 VALUE  FROM CONFIG WHERE CONFIG_OPTION='GST_REPORT_FROM_RECEIPT_DT') CNF ON 1=1
      WHERE A.CANCELLED =0 AND A.OTHER_CHARGES>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)>0
      UNION ALL
      
  
       SELECT CASE WHEN A.MODE  =1 THEN LM.AC_NAME ELSE SL.DEPT_NAME END AS SENDER_NAME,
           CASE WHEN A.MODE =1 THEN LMP.AC_GST_NO  ELSE SL.LOC_GST_NO END AS SENDER_GSTN_ID,
           CASE WHEN A.MODE =1 THEN A.PARTY_STATE_CODE   ELSE SL.GST_STATE_CODE  END AS SENDER_STATE_CODE,
           CASE WHEN A.MODE =1 THEN ST2.GST_STATE_NAME   ELSE ST1.GST_STATE_NAME  END  AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           CASE WHEN A.MODE =1 THEN 'PARTY CREDIT NOTE'   ELSE 'GROUP CREDIT NOTE'  END AS SUB_TRANSACTION_TYPE,
           CASE WHEN A.MODE =1 THEN 'PARTY CREDIT NOTE'   ELSE 'GROUP CREDIT NOTE'  END  AS TRANSACTION_TYPE,
		   A.CN_NO AS SENDER_INVOICE_NO,
          -- CASE WHEN A.MODE =1 THEN CN_NO   ELSE MANUAL_INV_NO  END  AS SENDER_INVOICE_NO,
           A.RECEIPT_DT  AS SENDER_INVOICE_DATE,
           A.FREIGHT_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.FREIGHT_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           A.location_code/*LEFT(A.CN_ID ,2)*//*Rohit 04-11-2024*/ AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.FREIGHT_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN A.FREIGHT_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.FREIGHT_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN A.FREIGHT_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           ( ISNULL(A.FREIGHT_TAXABLE_VALUE,0)+ ISNULL(FREIGHT_IGST_AMOUNT ,0)+ISNULL(FREIGHT_CGST_AMOUNT,0)+ISNULL(FREIGHT_SGST_AMOUNT,0)) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           'FREIGHT' AS OH_TYPE,
           CAST('' AS VARCHAR(100)) AS PRODUCT_CODE ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT,
           CAST(CASE WHEN  ISNULL(A.FREIGHT_IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE     ,
           B.LOC_GST_NO ,
           CAST('INWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           A.BIN_ID AS BIN_ID,
           CASE WHEN  ISNULL(CASE WHEN ISNULL(A.MODE  ,0) =1 THEN LMP.AC_GST_NO ELSE B.LOC_GST_NO   END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           '' AS MRR_NO ,
           '' AS  MRR_DT ,
            CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
            A.CN_DT  AS  VENDOR_BILL_DATE,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
            CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT
      FROM CNM01106   A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =A.location_code/*LEFT(A.CN_ID ,2)*//*Rohit 04-11-2024*/
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION SL (NOLOCK) ON SL.DEPT_ID =A.PARTY_DEPT_ID 
      LEFT  JOIN GST_STATE_MST ST1 (NOLOCK)  ON SL.GST_STATE_CODE =ST1.GST_STATE_CODE
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      LEFT  JOIN GST_STATE_MST ST2 (NOLOCK)  ON ST2.GST_STATE_CODE =A.PARTY_STATE_CODE
      LEFT JOIN (SELECT TOP 1 VALUE  FROM CONFIG WHERE CONFIG_OPTION='GST_REPORT_FROM_RECEIPT_DT') CNF ON 1=1
      WHERE A.CANCELLED =0 AND A.FREIGHT>0 AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
      AND ISNULL(A.FREIGHT_TAXABLE_VALUE,0)>0
      UNION ALL
      
        -- CASE WHEN A.MODE =1 THEN ST2.GST_STATE_NAME   ELSE ST1.GST_STATE_NAME  END AS SENDER_STATE_NAME,
      -- LEFT  JOIN GST_STATE_MST ST1 (NOLOCK)  ON SL.GST_STATE_CODE =ST1.GST_STATE_CODE
      -- LEFT  JOIN GST_STATE_MST ST2 (NOLOCK)  ON ST2.GST_STATE_CODE =LMP.AC_GST_STATE_CODE 
      
      
       SELECT CASE WHEN A.MODE  =1 THEN LM.AC_NAME ELSE SL.DEPT_NAME END AS SENDER_NAME,
           CASE WHEN A.MODE =1 THEN LMP.AC_GST_NO  ELSE SL.LOC_GST_NO END AS SENDER_GSTN_ID,
           CASE WHEN A.MODE =1 THEN A.PARTY_STATE_CODE   ELSE SL.GST_STATE_CODE  END AS SENDER_STATE_CODE,
           CASE WHEN A.MODE =1 THEN ST2.GST_STATE_NAME   ELSE ST1.GST_STATE_NAME  END   AS SENDER_STATE_NAME,
           B.DEPT_NAME AS RECEIVER_NAME ,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           CASE WHEN A.MODE =1 THEN 'PARTY CREDIT NOTE'   ELSE 'GROUP CREDIT NOTE'  END AS SUB_TRANSACTION_TYPE,
           CASE WHEN A.MODE =1 THEN 'PARTY CREDIT NOTE'   ELSE 'GROUP CREDIT NOTE'  END  AS TRANSACTION_TYPE,
		    A.CN_NO AS SENDER_INVOICE_NO,
           --CASE WHEN A.MODE =1 THEN CN_NO   ELSE MANUAL_INV_NO  END  AS SENDER_INVOICE_NO,
          -- RTRIM(LTRIM(CN_NO))+'/'+RTRIM(LTRIM(CND.INV_NO))+'/'+REPLACE(CAST (CND.GST_PERCENTAGE  AS VARCHAR(10)),'.00','') AS SENDER_INVOICE_NO,
           A.RECEIPT_DT  AS SENDER_INVOICE_DATE,
           CND.HSN_CODE AS HSN_CODE ,
           CND.QUANTITY  AS QUANTITY,
           CND.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(CND.GST_PERCENTAGE ,0) AS GST_PERCENTAGE,
           A.location_code/*LEFT(A.CN_ID ,2)*//*Rohit 04-11-2024*/ AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           CND.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN CND.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           CND.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN CND.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           A.MANUAL_DN_NO    AS REFERENCE_NUMBER,
           A.MANUAL_DN_DT  AS REFERENCE_DATE,
           CND.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST,
           CAST('' AS VARCHAR(10)) AS OH_TYPE,
           CND.PRODUCT_CODE    ,
           A.TOTAL_AMOUNT  AS INVOICE_VALUE ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT ,
           CAST(CASE WHEN  ISNULL(CND.IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE           ,
           B.LOC_GST_NO ,
           CAST('INWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CND.ORDER_NO,
           CND.ONLINE_BILL_REF_NO,
           CND.BIN_ID AS BIN_ID,
           CASE WHEN  ISNULL(CASE WHEN ISNULL(A.MODE  ,0) =1 THEN LMP.AC_GST_NO ELSE B.LOC_GST_NO   END,'')<>'' THEN  'REGISTERED' ELSE 'UNREGISTERED' END AS PARTY_REGISTRATION,
           '' AS MRR_NO ,
           '' AS  MRR_DT,
            CAST(CND.TAX_ROUND_OFF AS NUMERIC(10,2)) AS TAX_ROUND_OFF, 
            A.CN_DT  AS  VENDOR_BILL_DATE,
            isnull(A.XN_ITEM_TYPE,1) as XN_ITEM_TYPE,
            
            CAST(CASE WHEN cnd.RATE*cnd.QUANTITY<>0 THEN 
           (ISNULL(cnd.DISCOUNT_AMOUNT ,0)+ISNULL(cnd.cnmDISCOUNTAMOUNT ,0))/(cnd.RATE*cnd.QUANTITY ) *100
            ELSE 0 END AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           
           CAST(ISNULL(cnd.DISCOUNT_AMOUNT ,0)+ISNULL(cnd.cnmDISCOUNTAMOUNT ,0) AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(CASE WHEN (SKU.PURCHASE_PRICE*cnd.QUANTITY )<>0 THEN 
           ((cnd.XN_VALUE_WITHOUT_GST -(SKU.PURCHASE_PRICE*cnd.QUANTITY))/(SKU.PURCHASE_PRICE*cnd.QUANTITY ))*100
           ELSE 0 END AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(cnd.XN_VALUE_WITHOUT_GST -(SKU.PURCHASE_PRICE*cnd.QUANTITY) AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           CND.CESS_AMOUNT
      FROM CNM01106   A (NOLOCK)
      JOIN CND01106 CND (NOLOCK) ON A.CN_ID =CND.CN_ID 
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =A.location_code/*LEFT(A.CN_ID ,2)*//*Rohit 04-11-2024*/
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LOCATION SL (NOLOCK) ON SL.DEPT_ID =A.PARTY_DEPT_ID 
      LEFT  JOIN GST_STATE_MST ST1 (NOLOCK)  ON SL.GST_STATE_CODE =ST1.GST_STATE_CODE
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      LEFT  JOIN GST_STATE_MST ST2 (NOLOCK)  ON ST2.GST_STATE_CODE =A.PARTY_STATE_CODE
      LEFT JOIN (SELECT TOP 1 VALUE  FROM CONFIG WHERE CONFIG_OPTION='GST_REPORT_FROM_RECEIPT_DT') CNF ON 1=1
      JOIN SKU (NOLOCK) ON SKU.product_code =cnd.product_code
      WHERE A.CANCELLED =0  AND ISNULL(A.MEMO_TYPE,0) IN(0,1)
     -- AND ISNULL(CND.GST_PERCENTAGE ,0)>0
      UNION ALL
       SELECT LM.AC_NAME AS SENDER_NAME,
         LMP.AC_GST_NO  AS SENDER_GSTN_ID,
         A.PARTY_STATE_CODE  AS SENDER_STATE_CODE,
         PS.GST_STATE_NAME AS SENDER_STATE_NAME,
         B.DEPT_NAME   AS RECEIVER_NAME,
         B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
         B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
         'BOOK INWARD SUPPLIERS'  AS SUB_TRANSACTION_TYPE,      
         'BOOK INWARD SUPPLIERS' AS TRANSACTION_TYPE,
         CAST(A.BILL_NO   AS VARCHAR(100)) AS SENDER_INVOICE_NO,
         A.bill_dt     AS SENDER_INVOICE_DATE,
         DET.HSN_CODE AS HSN_CODE ,
         DET.QUANTITY  AS QUANTITY,
         DET.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
         ISNULL(DET.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
         A.DEPT_ID AS LOCATION_ID,
         B.DEPT_NAME AS LOCATION_NAME,
         DET.CGST_AMOUNT AS CGST_AMOUNT,
         CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN DET.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
         DET.IGST_AMOUNT AS IGST_AMOUNT,
         CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN DET.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
         CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
         CAST('' AS DATETIME) AS REFERENCE_DATE,
         DET.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
         CAST('' AS VARCHAR(10)) AS OH_TYPE,
         '' AS PRODUCT_CODE  ,
         A.TOTAL_AMOUNT  AS INVOICE_VALUE ,
         CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
         CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT,
         CAST(CASE WHEN  ISNULL(DET.IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE          ,
         B.LOC_GST_NO ,
         CAST('INWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
         CAST('' AS VARCHAR(100)) AS ORDER_NO,
         CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
         '000'   AS BIN_ID,
         CAST(CASE WHEN ISNULL(LMP.AC_GST_NO ,'')<>'' THEN 'REGISTERED' ELSE 'UNREGISTERED' END AS VARCHAR(50)) AS PARTY_REGISTRATION,
         '' AS MRR_NO ,
         '' AS  MRR_DT ,
          CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF, 
          A.BILL_DT AS  VENDOR_BILL_DATE,
          1 as XN_ITEM_TYPE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT
 FROM SUPPLY_EXPENSE_XN_MST  A (NOLOCK)
 JOIN SUPPLY_EXPENSE_XN_DET DET (NOLOCK) ON A.MEMO_ID  =DET.MEMO_ID  
 JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =A.DEPT_ID
 JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
 JOIN GST_STATE_MST PS (NOLOCK)  ON PS.GST_STATE_CODE =A.PARTY_STATE_CODE 
 JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
 JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
 WHERE A.CANCELLED =0 
 UNION ALL
 SELECT LM.AC_NAME AS SENDER_NAME,
         LMP.AC_GST_NO  AS SENDER_GSTN_ID,
         LMP.AC_GST_STATE_CODE AS SENDER_STATE_CODE,
         C.GST_STATE_NAME AS SENDER_STATE_NAME,
         B.DEPT_NAME   AS RECEIVER_NAME,
         B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
         B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,     
         'REVERSE CHARGES' AS SUB_TRANSACTION_TYPE,      
         'REVERSE CHARGES' AS TRANSACTION_TYPE,
         ''  AS SENDER_INVOICE_NO,
         ''  AS SENDER_INVOICE_DATE,
         A.OTHER_CHARGES_HSN_CODE AS HSN_CODE ,
         CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
         ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
         ISNULL(A.OTHER_CHARGES_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
         A.location_code/*LEFT(A.MEMO_ID ,2)*//*Rohit 04-11-2024*/ AS LOCATION_ID,
         B.DEPT_NAME AS LOCATION_NAME,
         A.OTHER_CHARGES_CGST_AMOUNT AS CGST_AMOUNT,
         CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN A.OTHER_CHARGES_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
         A.OTHER_CHARGES_IGST_AMOUNT AS IGST_AMOUNT,
         CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN A.OTHER_CHARGES_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
         CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
         CAST('' AS DATETIME) AS REFERENCE_DATE,
         ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)+ ISNULL(OTHER_CHARGES_IGST_AMOUNT ,0)+ISNULL(OTHER_CHARGES_CGST_AMOUNT,0)+ISNULL(OTHER_CHARGES_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
         'OTHER_CHARGES' AS OH_TYPE,
         CAST('' AS VARCHAR(100)) AS PRODUCT_CODE,
         A.TOTAL_REVERSE_CHARGES  AS INVOICE_VALUE,
         CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
         CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT,
         CAST(CASE WHEN  ISNULL(A.OTHER_CHARGES_IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE   ,
         B.LOC_GST_NO ,
         CAST('INWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
         CAST('' AS VARCHAR(100)) AS ORDER_NO,
         CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
         '000'   AS BIN_ID,
         CAST(CASE WHEN ISNULL(LMP.AC_GST_NO ,'')<>'' THEN 'REGISTERED' ELSE 'UNREGISTERED' END AS VARCHAR(50)) AS PARTY_REGISTRATION,
         '' AS MRR_NO ,
         '' AS  MRR_DT ,
          CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
          CAST('' AS DATETIME) AS  VENDOR_BILL_DATE  ,
          1 as XN_ITEM_TYPE ,
          CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
           CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
           CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
           0 AS CESS_AMOUNT
      FROM RCM01106   A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =A.location_code/*LEFT(A.MEMO_ID ,2)*//*Rohit 04-11-2024*/
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      WHERE A.CANCELLED =0 AND A.OTHER_CHARGES>0 
      AND ISNULL(A.OTHER_CHARGES_TAXABLE_VALUE,0)>0
      
      UNION ALL
      SELECT LM.AC_NAME AS SENDER_NAME,
            LMP.AC_GST_NO AS SENDER_GSTN_ID,
            PS.GST_STATE_CODE  AS SENDER_STATE_CODE,
            PS.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           'REVERSE CHARGES' AS SUB_TRANSACTION_TYPE,      
           'REVERSE CHARGES' AS TRANSACTION_TYPE,
           ''  AS SENDER_INVOICE_NO,
           ''  AS SENDER_INVOICE_DATE,
           A.FREIGHT_HSN_CODE AS HSN_CODE ,
           CAST(0 AS NUMERIC(10,3)) AS QUANTITY,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)  AS TAXABLE_VALUE,
           ISNULL(A.FREIGHT_GST_PERCENTAGE,0) AS GST_PERCENTAGE,
           A.location_code/*LEFT(A.MEMO_ID ,2)*//*Rohit 04-11-2024*/ AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           A.FREIGHT_CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN A.FREIGHT_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           A.FREIGHT_IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN A.FREIGHT_SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           ISNULL(A.FREIGHT_TAXABLE_VALUE,0)+ ISNULL(FREIGHT_IGST_AMOUNT ,0)+ISNULL(FREIGHT_CGST_AMOUNT,0)+ISNULL(FREIGHT_SGST_AMOUNT,0) AS TRANSACTION_VALUE_INCLUDING_GST          ,
           'FREIGHT' AS OH_TYPE,
           CAST('' AS VARCHAR(100)) AS PRODUCT_CODE,
           A.TOTAL_REVERSE_CHARGES  AS INVOICE_VALUE,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT ,
           CAST(CASE WHEN  ISNULL(A.FREIGHT_IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE   ,
           B.LOC_GST_NO ,
           CAST('INWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           '000'   AS BIN_ID,
           CAST(CASE WHEN ISNULL(LMP.AC_GST_NO ,'')<>'' THEN 'REGISTERED' ELSE 'UNREGISTERED' END AS VARCHAR(50)) AS PARTY_REGISTRATION,
         '' AS MRR_NO ,
         '' AS  MRR_DT ,
          CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF,
          CAST('' AS DATETIME) AS  VENDOR_BILL_DATE  ,
          1 as XN_ITEM_TYPE  ,
          CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
          CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
          CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
          CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT,
          0 AS CESS_AMOUNT
      FROM RCM01106   A (NOLOCK)
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =A.location_code/*LEFT(A.MEMO_ID ,2)*//*Rohit 04-11-2024*/
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      LEFT OUTER JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      LEFT OUTER JOIN
      (
       SELECT DISTINCT RCM_MEMO_ID  ,B.PARTY_STATE_CODE 
       FROM RCM_PUR_EXPENSE A
       JOIN PIM01106 B ON A.MEMO_ID =B.MRR_ID 
       WHERE B.CANCELLED =0 AND A.XN_TYPE ='PUR'
      )P ON P.RCM_MEMO_ID =A.MEMO_ID  
       JOIN GST_STATE_MST PS (NOLOCK)  ON P.PARTY_STATE_CODE =PS.GST_STATE_CODE
      WHERE A.CANCELLED =0  AND A.FREIGHT>0 
      AND ISNULL(A.FREIGHT_TAXABLE_VALUE,0)>0
      
      
      UNION ALL
      SELECT LM.AC_NAME AS SENDER_NAME,
           LMP.AC_GST_NO AS SENDER_GSTN_ID,
           PS.GST_STATE_CODE  AS SENDER_STATE_CODE,
           PS.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           'REVERSE CHARGES' AS SUB_TRANSACTION_TYPE,      
           'REVERSE CHARGES' AS TRANSACTION_TYPE,
           ''  AS SENDER_INVOICE_NO,
           ''  AS SENDER_INVOICE_DATE,
           RCD.HSN_CODE AS HSN_CODE ,
           RCD.QUANTITY  AS QUANTITY,
           RCD.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(RCD.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           A.location_code/*LEFT(A.MEMO_ID ,2)*//*Rohit 04-11-2024*/ AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           RCD.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN RCD.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           RCD.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN RCD.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           RCD.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
           CAST('' AS VARCHAR(10)) AS OH_TYPE,
           '' AS PRODUCT_CODE  ,
           A.TOTAL_REVERSE_CHARGES  AS INVOICE_VALUE ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT,
           CAST(CASE WHEN  ISNULL(RCD.IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE          ,
           B.LOC_GST_NO ,
           CAST('INWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           '000'   AS BIN_ID,
           CAST(CASE WHEN ISNULL(LMP.AC_GST_NO ,'')<>'' THEN 'REGISTERED' ELSE 'UNREGISTERED' END AS VARCHAR(50)) AS PARTY_REGISTRATION,
          '' AS MRR_NO ,
          '' AS  MRR_DT ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
          CAST('' AS DATETIME) AS  VENDOR_BILL_DATE,
          1 as XN_ITEM_TYPE,
          CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
          CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
          CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
          CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT ,
          0 AS CESS_AMOUNT
      FROM RCM01106  A (NOLOCK)
      JOIN RCD01106 RCD (NOLOCK) ON A.MEMO_ID  =RCD.MEMO_ID  
      JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =A.location_code/*LEFT(A.MEMO_ID ,2)*//*Rohit 04-11-2024*/
      JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
      JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =A.AC_CODE 
      JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
      LEFT OUTER JOIN
      (
       SELECT DISTINCT RCM_MEMO_ID  ,B.PARTY_STATE_CODE 
       FROM RCM_PUR_EXPENSE A
       JOIN PIM01106 B ON A.MEMO_ID =B.MRR_ID 
       WHERE B.CANCELLED =0 AND A.XN_TYPE ='PUR'
      )P ON P.RCM_MEMO_ID =A.MEMO_ID  
       JOIN GST_STATE_MST PS (NOLOCK)  ON P.PARTY_STATE_CODE =PS.GST_STATE_CODE
      WHERE A.CANCELLED =0 
      UNION ALL
      
      SELECT LM.AC_NAME AS SENDER_NAME,
           LMP.AC_GST_NO AS SENDER_GSTN_ID,
           PS.GST_STATE_CODE  AS SENDER_STATE_CODE,
           PS.GST_STATE_NAME AS SENDER_STATE_NAME,
           B.DEPT_NAME   AS RECEIVER_NAME,
           B.LOC_GST_NO  AS RECEIVER_GSTN_ID,
           B.GST_STATE_CODE  AS RECEIVER_STATE_CODE,
           'JOBWORK RECEIVE' AS SUB_TRANSACTION_TYPE,      
           'JOBWORK RECEIVE' AS TRANSACTION_TYPE,
           A.receipt_no   AS SENDER_INVOICE_NO,
           A.challan_dt    AS SENDER_INVOICE_DATE,
           REC.HSN_CODE AS HSN_CODE ,
           REC.QUANTITY  AS QUANTITY,
           REC.XN_VALUE_WITHOUT_GST  AS TAXABLE_VALUE,
           ISNULL(REC.GST_PERCENTAGE,0)  AS GST_PERCENTAGE,
           A.location_code/*LEFT(A.RECEIPT_ID   ,2)*//*Rohit 04-11-2024*/ AS LOCATION_ID,
           B.DEPT_NAME AS LOCATION_NAME,
           REC.CGST_AMOUNT AS CGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=0 THEN REC.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS SGST_AMOUNT,
           REC.IGST_AMOUNT AS IGST_AMOUNT,
           CAST(CASE WHEN ISNULL(C.UT,0)=1 THEN REC.SGST_AMOUNT ELSE 0 END AS NUMERIC(12,2)) AS UTGST_AMOUNT,
           CAST('' AS VARCHAR(100)) AS REFERENCE_NUMBER,
           CAST('' AS DATETIME) AS REFERENCE_DATE,
           REC.XN_VALUE_WITH_GST  AS TRANSACTION_VALUE_INCLUDING_GST ,
           CAST('' AS VARCHAR(10)) AS OH_TYPE,
           REC.PRODUCT_CODE AS PRODUCT_CODE  ,
           A.net_amount  AS INVOICE_VALUE ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE ,
           CAST(0 AS NUMERIC(12,2)) AS TAX_AMOUNT,
           CAST(CASE WHEN  ISNULL(REC.IGST_AMOUNT ,0)>0 THEN 'INTER STATE' ELSE 'LOCAL' END AS VARCHAR(100)) AS TRANSACTION_MODE          ,
           B.LOC_GST_NO ,
           CAST('INWARD' AS VARCHAR(10)) AS TRANSACTION_GROUP,
           CAST('' AS VARCHAR(100)) AS ORDER_NO,
           CAST('' AS VARCHAR(100)) AS ONLINE_BILL_REF_NO,
           '000'   AS BIN_ID,
           CAST(CASE WHEN ISNULL(LMP.AC_GST_NO ,'')<>'' THEN 'REGISTERED' ELSE 'UNREGISTERED' END AS VARCHAR(50)) AS PARTY_REGISTRATION,
          '' AS MRR_NO ,
          '' AS  MRR_DT ,
           CAST(0 AS NUMERIC(10,2)) AS TAX_ROUND_OFF ,
          CAST('' AS DATETIME) AS  VENDOR_BILL_DATE,
          1 as XN_ITEM_TYPE,
          CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_PERCENTAGE,
          CAST(0  AS NUMERIC(10,2)) AS DISCOUNT_AMOUNT,
          CAST(0 AS NUMERIC(10,2)) AS PROFIT_PERCENTAGE,
          CAST(0 AS NUMERIC(10,2)) AS PROFIT_AMOUNT   ,
          REC.CESS_AMOUNT 
     FROM JOBWORK_RECEIPT_MST A (NOLOCK)
     JOIN JOBWORK_RECEIPT_DET REC (NOLOCK) ON A.receipt_id   =REC.receipt_id 
     JOIN LOCATION B (NOLOCK) ON B.DEPT_ID =A.location_code/*LEFT(A.RECEIPT_ID   ,2)*//*Rohit 04-11-2024*/ 
     JOIN GST_STATE_MST C (NOLOCK)  ON B.GST_STATE_CODE =C.GST_STATE_CODE
     JOIN PRD_AGENCY_MST AM (NOLOCK) ON AM.agency_code =A.agency_code 
     JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =AM.AC_CODE 
     JOIN LMP01106 LMP (NOLOCK) ON LMP.AC_CODE =LM.AC_CODE 
     JOIN GST_STATE_MST PS (NOLOCK)  ON A.PARTY_STATE_CODE =PS.GST_STATE_CODE
     WHERE A.CANCELLED =0 
 ) A
 LEFT JOIN BIN (NOLOCK) ON BIN.BIN_ID =A.BIN_ID
 LEFT JOIN location L (NOLOCK) ON L.dept_id =A.LOCATION_ID 