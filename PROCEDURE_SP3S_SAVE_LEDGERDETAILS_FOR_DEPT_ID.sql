CREATE PROCEDURE SP3S_SAVE_LEDGERDETAILS_FOR_DEPT_ID
(
	@cdept_id VARCHAR(10),
	@cAC_Name VARCHAR(100)
)
AS
BEGIN
DECLARE @cAC_CODE VARCHAR(50),@cPrefix VARCHAR(10),@cErrMsg VARCHAR(MAX)
--SELECT @cdept_id='JM'
--select @cAC_CODE =ac_code from lm01106(NOLOCK) where ac_name =(select dept_name+'('+dept_alias+')' from location(NOLOCK) where dept_id=@cdept_id)
SELECT @cPrefix=value FROM config where CONFIG_OPTION ='HO_LOCATION_ID'
BEGIN TRY
IF ISNULL(@cAC_CODE,'')<>''
BEGIN
	SELECT * FROM LMV01106(NOLOCK) WHERE AC_CODE=@cAC_CODE
END
ELSE
BEGIN

	EXEC GETNEXTKEY @CTABLENAME='LMV01106',
	@CCOLNAME='AC_CODE',
	@NWIDTH=10,
	@CPREFIX=@cPrefix,
	@NLZEROS=1,
	@CFINYEAR='',
	@NROWCOUNT=2,
	@CNEWKEYVAL=@cAC_CODE OUTPUT


 INSERT LMV01106	( AC_CODE,  AC_GST_NO, AC_GST_STATE_CODE, AC_NAME, ADDRESS0, ADDRESS1, ADDRESS2, ALIAS, 
 ALIAS_TO_BE_SUFFIXED, ALLOW_ALLOCATION_WIP_STK, ALLOW_CREDITOR_DEBTOR, ANGADIA_CODE, ANGADIA_NAME, AR_ID, AR_NAME, AREA_CODE, AREA_NAME, BILL_BY_BILL, 
 BROKER_AC_CODE, BROKER_COMM_PERCENT, CITY, CITY_CODE, CLOSING_BALANCE, CLOSING_BALANCE_CR_DR, COMPANY_CODE, CONTACT_PERSON_NAME, COUNTRY_CODE, COUNTRY_NAME, 
 CREDIT_DAYS, CREDIT_LIMIT, CST_DT, CST_NO, CST_PERCENTAGE, CUSTOM_RATE_TYPE, CUSTOMER_CODE, DEFAULT_RATE_TYPE, DISCOUNT_PERCENTAGE, DO_NOT_ALLOW_DIRECT_PUR, 
 DPWEF_DT, E_MAIL, EDT_USER_CODE, EDT_USERNAME, ENABLE_EMAIL, EOSS_DISCOUNT_PER, EOSS_DISCOUNT_SHARE, EXPORT_GST_MODE, EXPORT_GST_PERCENTAGE, 
 EXPORT_GST_PERCENTAGE_APPLICABLE, FORM_ID, GLN_NO, HEAD_CODE, HOLD_FOR_PAYMENT, HSN_CODE, INACTIVE, INV_RATE_TYPE, LAST_UPDATE, LM_REMARKS, MAJOR_AC_CODE, MAJOR_AC_NAME, MOBILE, 
 MP_PERCENTAGE, MRP_CALC_MODE, ON_HOLD, ORDER_ALLOCATION_PRIORITY, OUTSTATION_PARTY, PAN_NO, PARTY_ERP_CODE, PARTY_RATE_DESCRIPTION, PARTY_RATE_MEMO_ID, 
 PARTY_RATE_SUPP, PARTY_RATE_SUPP_DESCRIPTION, PHONES_FAX, PHONES_O, PHONES_R, PINCODE, PRINT_LEDGER, PRINT_NAME, PUR_CAL_METHOD, PURCHASE_AGAINST_TERMS, 
 RCM_APPLICABLE, REGION_CODE, REGION_NAME, REGISTERED_GST_DEALER, RESTRICT_PUR_ENTRY, ROUND_OFF_GST_AMT, SALES_AC_CODE, SHARE_WITH_COMPANY_OWNED_POS, 
 SHARE_WITH_FRANCHISE_CONSIGNEE, SHARE_WITH_FRANCHISE_OUTRIGHT, SHARE_WITH_WH, SHIPPING_ADDRESS, SHIPPING_ADDRESS2, SHIPPING_ADDRESS3, SST_DT, SST_NO, 
 STATE, STATE_CODE, TAX_CODE, TDS_CODE, THROUGH_BROKER, THRU_RTGS, TIN_DT, TIN_NO, TRADE_DISCOUNT_PERCENTAGE, USER_CODE, USERNAME, WHATSAPP_NO, 
 WP_PERCENTAGE, WSL_RATE_CALC_METHOD )  
 SELECT 	@cAC_CODE  AC_CODE, a.loc_gst_no AC_GST_NO,gst.gst_state_code AC_GST_STATE_CODE,@cAC_Name AC_NAME,a.Registered_Add ADDRESS0, a.ADDRESS1, a.ADDRESS2,  a.dept_alias ALIAS, 
 '' ALIAS_TO_BE_SUFFIXED, 0 ALLOW_ALLOCATION_WIP_STK, 0 ALLOW_CREDITOR_DEBTOR, ''ANGADIA_CODE, ''ANGADIA_NAME, ''AR_ID, ''AR_NAME, a.AREA_CODE,b1.AREA_NAME, 0 BILL_BY_BILL, '' BROKER_AC_CODE, 0 BROKER_COMM_PERCENT, 
 c.CITY, c.CITY_CODE, 0CLOSING_BALANCE, ''CLOSING_BALANCE_CR_DR, '01' COMPANY_CODE, '' CONTACT_PERSON_NAME, rc.COUNTRY_CODE, rc.COUNTRY_NAME, 0 CREDIT_DAYS, 0 CREDIT_LIMIT, 
 '' CST_DT, '' CST_NO, 0 CST_PERCENTAGE, '' CUSTOM_RATE_TYPE, '' CUSTOMER_CODE, 0 DEFAULT_RATE_TYPE, 0 DISCOUNT_PERCENTAGE, 0 DO_NOT_ALLOW_DIRECT_PUR,''  DPWEF_DT, '' E_MAIL, 
''  EDT_USER_CODE, '' EDT_USERNAME, 0 ENABLE_EMAIL, 0 EOSS_DISCOUNT_PER, 0 EOSS_DISCOUNT_SHARE,0 EXPORT_GST_MODE, 0 EXPORT_GST_PERCENTAGE, 0 EXPORT_GST_PERCENTAGE_APPLICABLE, 
'' FORM_ID, '' GLN_NO, b.HEAD_CODE, 0 HOLD_FOR_PAYMENT, '' HSN_CODE, 0 INACTIVE, 0 INV_RATE_TYPE, GETDATE() LAST_UPDATE,''  LM_REMARKS, @cAC_CODE MAJOR_AC_CODE, 
 '' MAJOR_AC_NAME, '' MOBILE,0 MP_PERCENTAGE, 0 MRP_CALC_MODE, 0 ON_HOLD, 0 ORDER_ALLOCATION_PRIORITY, 0 OUTSTATION_PARTY, a.PAN_NO, '' PARTY_ERP_CODE, '' PARTY_RATE_DESCRIPTION, 
 '' PARTY_RATE_MEMO_ID,'' PARTY_RATE_SUPP, '' PARTY_RATE_SUPP_DESCRIPTION, '' PHONES_FAX, a.phone, '' PHONES_R, PINCODE, 0 PRINT_LEDGER,@cAC_CODE PRINT_NAME, 0 PUR_CAL_METHOD, '' PURCHASE_AGAINST_TERMS, 
 0 RCM_APPLICABLE, r.REGION_CODE, r.REGION_NAME, a.registered_gst REGISTERED_GST_DEALER, 0 RESTRICT_PUR_ENTRY, 0 ROUND_OFF_GST_AMT, '' SALES_AC_CODE, '' SHARE_WITH_COMPANY_OWNED_POS, 
''  SHARE_WITH_FRANCHISE_CONSIGNEE, '' SHARE_WITH_FRANCHISE_OUTRIGHT, '' SHARE_WITH_WH, '' SHIPPING_ADDRESS, '' SHIPPING_ADDRESS2, '' SHIPPING_ADDRESS3, '' SST_DT, '' SST_NO, d.STATE, d.STATE_CODE, 
 '' TAX_CODE, '' TDS_CODE, 0 THROUGH_BROKER, 0 THRU_RTGS, '' TIN_DT, a.TIN_NO, 0 TRADE_DISCOUNT_PERCENTAGE, '0000000' USER_CODE, 'SUPER' USERNAME,''  WHATSAPP_NO, 0 WP_PERCENTAGE, 0 WSL_RATE_CALC_METHOD 

	from location a (NOLOCK)  
	join hd01106 b (NOLOCK) on '0000000018'=b.Head_code  
	join area b1(NOLOCK) on a.area_code = b1.area_code 
	join CITY c (NOLOCK)on b1.city_code = c.CITY_CODE 
	join state d (NOLOCK)on c.state_code = d.state_code 
	Left outer join regionm r (NOLOCK)on d.region_code = r.region_code 
	Left outer join country rc (NOLOCK)on r.country_code = rc.country_code 
	left outer JOIN gst_state_mst gst (NOLOCK) on a.gst_state_code=gst.gst_state_code  
	where a.dept_id =@cdept_id
	
END
END TRY

	BEGIN CATCH
	SET @cErrMsg= ERROR_MESSAGE()
	END CATCH

	SELECT @cAC_CODE AS AC_CODE,ISNULL(@cErrMsg,'') AS ERR_MSG
END