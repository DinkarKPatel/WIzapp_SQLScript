create PROCEDURE DBO.SP_SEND_MIRROR_MSTHSN_NEW
(
 @CTARGETLOCID VARCHAR(5)
)
AS
 BEGIN
   DECLARE @DTSQL NVARCHAR(MAX),@CSTEP VARCHAR(10),@CFILTERCONDITION NVARCHAR(MAX)
           ,@CTABLENAME VARCHAR(100),@CTEMPTABLE VARCHAR(100),@CTEMPHSNTABLE VARCHAR(100)
           ,@CTEMPSDTABLE VARCHAR(100),@CTEMPDBNAME VARCHAR(200),@CCURDEPTID VARCHAR(5)
           ,@CHODEPTID VARCHAR(5),@CERRORMSG VARCHAR(MAX),@CREPLOCTABLE VARCHAR(500),@NLOCTYPE INT
           ,@CLOCMERGINGTHRUWIZCOM VARCHAR(2),@JOINMASTERTABLE VARCHAR(200),@JOINTEMPTABLE VARCHAR(200)
           ,@CTEMPGSTOHCONFIGTABLE VARCHAR(60),@CTEMPHSNDETTABLE VARCHAR(1000),@CTEMPTCSMSTTABLE varchar(500)

    DECLARE @TXNSSENDINFO TABLE (ORG_TABLENAME VARCHAR(100),TMP_TABLENAME VARCHAR(100),ERRMSG VARCHAR(MAX)) 
    
    BEGIN TRY
    
	SET @CSTEP=0

	SET @CTEMPDBNAME = ''
	
	SET @CSTEP=10
	
	PRINT @CSTEP+':'+CONVERT(VARCHAR,GETDATE(),113)
	SET @CFILTERCONDITION=''
	 
	SET @CSTEP=15

	SELECT @CCURDEPTID = VALUE FROM CONFIG WHERE CONFIG_OPTION='LOCATION_ID'
	SELECT @CHODEPTID = VALUE FROM CONFIG WHERE CONFIG_OPTION='HO_LOCATION_ID'		
	
	SELECT @NLOCTYPE=LOC_TYPE FROM LOCATION WHERE DEPT_ID=@CTARGETLOCID
	
	PRINT @CSTEP+':'+CONVERT(VARCHAR,GETDATE(),113)
	
	IF @CCURDEPTID<>@CHODEPTID
	BEGIN
		SELECT '' AS LAST_UPDATE,'' AS ERRMSG
		
		GOTO END_PROC
	END		
	
	SET @CSTEP=20
	SET @CTABLENAME = 'GST_STATE_MST'
	SELECT DISTINCT  'MSTHSN_GST_STATE_MST_MIRROR' AS TARGET_TABLENAME,GST_STATE_MST.*,1 AS PICK_FROM_CURRENT_DB FROM GST_STATE_MST (NOLOCK)
	 


	
	---INSERT TEMP TABLE AND ORGINAL TABLE NAME INTO OUTPUT TABLE
    INSERT INTO @TXNSSENDINFO(ORG_TABLENAME,TMP_TABLENAME) SELECT @CTABLENAME,'TMP_MSTHSN_'+@CTABLENAME+'_'+@CTARGETLOCID
	--BY CHNADAN ON 04-09-2019
	SET @CSTEP=25
	SET @CTABLENAME = 'GST_STATE_DET'

    SELECT DISTINCT  'MSTHSN_GST_STATE_DET_MIRROR' AS TARGET_TABLENAME,GST_STATE_DET.*,1 AS PICK_FROM_CURRENT_DB FROM GST_STATE_DET (NOLOCK)

	SET @CSTEP=35

	SET @CTABLENAME = 'GST_OH_CONFIG'
	
	SELECT DISTINCT  'MSTHSN_GST_OH_CONFIG_MIRROR' AS TARGET_TABLENAME,GST_OH_CONFIG.*,1 AS PICK_FROM_CURRENT_DB FROM GST_OH_CONFIG (NOLOCK)

	---SELECT DATA FROM LOC_BILLING_RULES TABLE
	SET @CTABLENAME = 'HSN_MST'
	SELECT DISTINCT  'MSTHSN_HSN_MST_MIRROR' AS TARGET_TABLENAME,HSN_MST.*,1 AS PICK_FROM_CURRENT_DB FROM HSN_MST (NOLOCK)

	
	---INSERT TEMP TABLE AND ORGINAL TABLE NAME INTO OUTPUT TABLE
	INSERT INTO @TXNSSENDINFO(ORG_TABLENAME,TMP_TABLENAME) SELECT @CTABLENAME,'TMP_MSTHSN_'+@CTABLENAME+'_'+@CTARGETLOCID
	
	---SELECT DATA FROM LOC_BILLING_RULES TABLE
	SET @CTABLENAME = 'HSN_DET'
	SELECT DISTINCT  'MSTHSN_HSN_DET_MIRROR' AS TARGET_TABLENAME,HSN_DET.*,1 AS PICK_FROM_CURRENT_DB FROM HSN_DET (NOLOCK)
	
	
	---SELECT DATA FROM tcs mst TABLE
	SET @CTABLENAME = 'Tcs_mst'
	SELECT DISTINCT  'MSTHSN_Tcs_mst_MIRROR' AS TARGET_TABLENAME,Tcs_mst.*,1 AS PICK_FROM_CURRENT_DB FROM Tcs_mst (NOLOCK)
	
	END TRY
	
	BEGIN CATCH
	    SET @CERRORMSG='P: SP_SEND_MIRROR_MSTHSN_NEW, STEP:'+@CSTEP+', MESSAGE:'+ERROR_MESSAGE()+ 'ERROR QUERY || '+@DTSQL
	    GOTO END_PROC
    END CATCH 
    
    END_PROC:
    
    SELECT ISNULL(@CERRORMSG,'')  AS ERRMSG
 END
------ ' END OF CREATING PROCEDURE SP_SEND_MIRROR_MSTHSN'
