CREATE PROCEDURE SP_BUYERSORDER_WSL_2 
@CMEMOID VARCHAR(40),  
@CWHERE VARCHAR(500),  
@CFINYEAR VARCHAR(10),  
@NNAVMODE NUMERIC(2,0),
@CARTICLECODE CHAR(9)='',  
@CPARA2CODE CHAR(7)='',
@DTWHERE DATETIME ='',
@cLocId VARCHAR(5)=''
--WITH ENCRYPTION
 
AS    
BEGIN 

SELECT (CASE WHEN A.SHIPPING_MODE =1 THEN '' ELSE ISNULL(SHIP.AC_NAME,'') END) AS SHIPPING_AC_NAME
,(CASE WHEN A.SHIPPING_MODE =1 THEN ISNULL(A.Shipping_address,'') ELSE ISNULL(SHIP.address0,'') END) AS Shipping_address, 
	(CASE WHEN A.SHIPPING_MODE =1 THEN ISNULL(A.shipping_address2,'') ELSE ISNULL(SHIP.address1,'') END) AS shipping_address2,
	(CASE WHEN A.SHIPPING_MODE =1 THEN ISNULL(A.shipping_address3,'') ELSE ISNULL(SHIP.address2,'') END) AS shipping_address3
	,(CASE WHEN A.SHIPPING_MODE =1 THEN ISNULL(A.SHIPPING_AREA_NAME,'') ELSE ISNULL(SHIP.AREA_NAME,'') END) AS SHIPPING_AREA_NAME
	 ,(CASE WHEN A.SHIPPING_MODE =1 THEN ISNULL(A.SHIPPING_CITY_NAME,'') ELSE ISNULL(SHIP.CITY,'') END) AS SHIPPING_CITY_NAME
	 ,(CASE WHEN A.SHIPPING_MODE =1 THEN ISNULL(A.SHIPPING_STATE_NAME,'') ELSE ISNULL(SHIP.STATE,'') END) AS SHIPPING_STATE_NAME
	 ,A.*, 0.00 AS TOTAL_QTY, CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE, CAST(0 AS NUMERIC(10,2)) AS TAX_AMOUNT,   
		B.AC_NAME, C.DEPT_NAME,C.DEPT_ID , B.ADDRESS0,      
		B.ADDRESS1, B.ADDRESS2, B.AREA_NAME, B.CITY, B.PINCODE, B.STATE, B.SST_NO, 
		B.CITY, B.ADDRESS0 + ' ' + B.ADDRESS1 + ' ' + B.ADDRESS2 + ' ' + 
		B.AREA_NAME + ' ' + B.CITY + ' ' + B.STATE + ' ' + (CASE WHEN B.PINCODE = '' THEN '' ELSE 'PIN :' +B.PINCODE END)+ ' ' + B.MOBILE + ' ' AS SUPP_ADDRESS,     
		B.CREDIT_DAYS,B.DISCOUNT_PERCENTAGE AS LM_DISC_PER,
		B.SST_DT, B.TIN_NO, B.TIN_DT,D.USERNAME,E.USERNAME AS EDT_USERNAME,
		ISNULL(T4.EMP_NAME,'') AS EMP_NAME ,
		ISNULL(T5.EMP_NAME,'') AS SALE_EMP_NAME ,
		A.SALE_EMP_CODE AS SALE_EMP_CODE,
		T6.EMP_CODE AS MERCHANT_CODE, 
		T6.EMP_NAME AS MERCHANT_NAME ,
		--AR.AREA_NAME AS SHIPPING_AREA_NAME,
       -- CT.CITY AS SHIPPING_CITY_NAME,
        --ST.STATE AS SHIPPING_STATE_NAME,
        AG.ANGADIA_NAME,AG.INSURANCE_PERCENTAGE,
        LMB.AC_NAME AS BROKER_AC_NAME,CAST(0 AS INT) AS SP_ID,LF.DEPT_NAME AS WBO_FOR_DEPT_NAME, FC.FC_NAME AS XN_FC_NAME
		,se.Season_Name,(case when B.freightPaidBy =2 then 'Party' else 'Company' end) as freightmethod
		FROM BUYER_ORDER_MST A  (NOLOCK)     
		JOIN LMV01106 B (NOLOCK)  ON A.AC_CODE = B.AC_CODE       
		JOIN USERS D  (NOLOCK)  ON A.USER_CODE = D.USER_CODE       
		LEFT JOIN USERS E (NOLOCK)  ON A.EDT_USER_CODE = E.USER_CODE       
		JOIN LOCATION C (NOLOCK)  ON A.DEPT_ID = C.DEPT_ID       
		LEFT OUTER JOIN EMPLOYEE T4 ON A.EMP_CODE= T4.EMP_CODE  
		LEFT OUTER JOIN EMPLOYEE T5 ON A.SALE_EMP_CODE= T5.EMP_CODE  
		LEFT OUTER JOIN EMPLOYEE T6 ON A.MERCHANT_CODE= T6.EMP_CODE 
		--LEFT JOIN AREA AR ON A.SHIPPING_AREA_CODE=AR.AREA_CODE
  --      LEFT JOIN CITY CT ON CT.CITY_CODE=AR.CITY_CODE
  --      LEFT JOIN STATE ST ON CT.STATE_CODE=ST.STATE_CODE
        LEFT JOIN ANGM AG ON AG.ANGADIA_CODE=A.ANGADIA_CODE 
        LEFT OUTER JOIN LMV01106 LMB ON A.BROKER_AC_CODE= LMB.AC_CODE 
        LEFT OUTER JOIN LOCATION LF (NOLOCK)  ON A.WBO_FOR_DEPT_ID = LF.DEPT_ID      
		LEFT OUTER JOIN fc  (NOLOCK) ON A.xn_fc_code = fc.fc_code
		LEFT OUTER JOIN SEASON_MST SE (NOLOCK) ON A.season_id= se.Season_Id
		LEFT OUTER JOIN LMV01106 SHIP(NOLOCK) ON SHIP.AC_CODE=A.SHIPPING_AC_CODE
		WHERE A.ORDER_ID = @CMEMOID  
END		