CREATE PROCEDURE SP_RETAILSALE_8 -- (LocId 3 digit change by Sanjay:30-10-2024)
(  
	 @CQUERYID			NUMERIC(2),  
	 @CWHERE			VARCHAR(MAX)='',  
	 @CFINYEAR			VARCHAR(5)='',  
	 @CDEPTID			VARCHAR(4)='',  
	 @NNAVMODE			NUMERIC(2)=1,  
	 @CWIZAPPUSERCODE	VARCHAR(10)='',  
	 @CREFMEMOID		VARCHAR(40)='',  
	 @CREFMEMODT		DATETIME='',  
	 @BINCLUDEESTIMATE	BIT=1,  
	 @CFROMDT			DATETIME='',  
	 @CTODT				VARCHAR(50)='',
	 @bCardDiscount		BIT=0,
	 @cCustCode			VARCHAR(15)=''
) 
AS  
BEGIN  
  SELECT B.CM_ID,B.CM_NO,B.CM_DT,B.NET_AMOUNT,  
  DBO.FN_ARC_AMOUNT( B.CM_ID ) + DBO.FN_CREDIT_REFUND_AMOUNT( B.CM_ID, A.REF_CM_ID) AS RECEIVED_AMOUNT,   
  A.CREDIT_REFUND_AMOUNT AS ADJ_AMOUNT   
  FROM CMR01106 A  (NOLOCK)  
  JOIN CMM01106 B  (NOLOCK) ON B.CM_ID =A.CM_ID  
  WHERE A.CM_ID=@CWHERE  
end
