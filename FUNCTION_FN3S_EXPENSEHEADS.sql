CREATE FUNCTION DBO.FN3S_EXPENSEHEADS()
RETURNS @HEADS TABLE(HEAD_CODE VARCHAR(20))	
--WITH ENCRYPTION
AS
BEGIN
	DECLARE @CHEAD_CODE VARCHAR(20),@BEXISTS BIT 
	
	SELECT @CHEAD_CODE=HEAD_CODE FROM HD01106 WHERE HEAD_NAME='EXPENDITURE A/C'
	
	INSERT @HEADS(HEAD_CODE)
	SELECT @CHEAD_CODE
	
	SET @BEXISTS=1
	WHILE @BEXISTS=1
	BEGIN
		INSERT @HEADS(HEAD_CODE)
		SELECT HEAD_CODE
		FROM HD01106 WHERE MAJOR_HEAD_CODE IN (SELECT HEAD_CODE FROM @HEADS) 
		AND HEAD_CODE NOT IN (SELECT HEAD_CODE FROM @HEADS)
		
		IF NOT EXISTS(SELECT TOP 1 HEAD_CODE FROM HD01106 WHERE MAJOR_HEAD_CODE IN (SELECT HEAD_CODE FROM @HEADS) 
					  AND HEAD_CODE NOT IN (SELECT HEAD_CODE FROM @HEADS))
		SET @BEXISTS=0			  
	END
RETURN	
END
---END OF FUNCTION - FN3S_EXPENSEHEADS
