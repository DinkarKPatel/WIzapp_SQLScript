CREATE VIEW VW_JOBCARD_REPS
AS
  
  
     SELECT A.DEPT_ID ,ISNULL(LM.AC_NAME,'') AS BUYER_NAME,
            ISNULL(BM.ORDER_NO,'') AS ORDER_NO,
            ISNULL(BM.ORDER_DT,'') AS ORDER_DT,
            ISNULL(BM.REF_NO,'') AS REF_NO,
            ISNULL(OM.MEMO_NO,'') AS JOBCARD_NO,
            ISNULL(OM.MEMO_DT ,'') AS JOBCARD_DT,
            A.XN_TYPE,JOBWORK_NAME ,
            JOBWORKER_NAME,
            A.XN_DT ,A.PRODUCT_CODE ,A.XN_QTY,
            JWI_NO,JWI_DT,JWI_DUE_DT,
            JWR_NO,JWR_DT,
            EMP.EMP_NAME,
            CASE WHEN ISNULL(PMT.ORDER_ID ,'')<>'' THEN 1 ELSE 0 END AS ALLOCATION_QTY,
			JOB_RATE,JOB_AMOUNT,LOC.DEPT_NAME
			
     FROM
     (
		  SELECT A.location_code/*LEFT (A.MEMO_ID,2)*//*Rohit 04-11-2024*/ AS DEPT_ID,
				 CAST('JCC' AS VARCHAR(10)) AS XN_TYPE,
				 CAST('' AS VARCHAR(100)) AS JOBWORK_NAME,
				 LM.AC_CODE AS AC_CODE ,
				 LM.AC_NAME AS JOBWORKER_NAME ,
				 A.MEMO_DT AS XN_DT ,C.PRODUCT_CODE ,
				 CAST(1 AS NUMERIC(1,0)) AS  XN_QTY,
				 CAST('' AS VARCHAR(100)) AS JWI_NO,
				 CAST('' AS DATETIME ) AS JWI_DT,
				 CAST('' AS DATETIME ) AS JWI_DUE_DT,
				 CAST('' AS VARCHAR(100)) AS JWR_NO,
				 CAST('' AS DATETIME ) AS JWR_DT,
				 cast(0 as numeric(18,2)) as JOB_RATE,
				 cast(0 as numeric(18,2)) as JOB_AMOUNT

		  FROM ORD_PLAN_MST A (NOLOCK)
		  JOIN ORD_PLAN_DET B (NOLOCK) ON A.MEMO_ID =B.MEMO_ID 
		  JOIN ORD_PLAN_BARCODE_DET C (NOLOCK) ON C.REFROW_ID =B.ROW_ID 
		  JOIN LM01106 LM (NOLOCK) ON A.AC_CODE =LM.AC_CODE 
		  WHERE A.CANCELLED =0
		  UNION ALL
		  SELECT B.location_code/*LEFT (A.ISSUE_ID ,2)*//*Rohit 04-11-2024*/ AS DEPT_ID,
				 CAST('JWI' AS VARCHAR(10)) AS XN_TYPE,
				 JOBS.JOB_NAME  AS JOBWORK_NAME,
				 B.AGENCY_CODE ,AM.AGENCY_NAME  AS  JOBWORKER_NAME ,
				 B.ISSUE_DT AS XN_DT ,A.PRODUCT_CODE ,
				 A.QUANTITY  AS  XN_QTY ,
				 CAST(B.issue_no AS VARCHAR(100)) AS JWI_NO,
				 CAST(B.ISSUE_DT AS DATETIME ) AS JWI_DT,
				 CAST(a.due_dt AS DATETIME ) AS JWI_DUE_DT,
				 CAST('' AS VARCHAR(100)) AS JWR_NO,
				 CAST('' AS DATETIME ) AS JWR_DT,
				 A.JOB_RATE,
				 CAST(A.JOB_RATE*A.QUANTITY AS NUMERIC(10,2)) AS JOB_AMOUNT
		  FROM JOBWORK_ISSUE_DET A (NOLOCK)
		  JOIN JOBWORK_ISSUE_MST B (NOLOCK) ON A.ISSUE_ID =B.ISSUE_ID 
		  JOIN PRD_AGENCY_MST AM (NOLOCK) ON AM.AGENCY_CODE =B.AGENCY_CODE 
		  JOIN JOBS (NOLOCK) ON JOBS.JOB_CODE=A.JOB_CODE
		  WHERE B.CANCELLED =0 AND ISNULL(B.ISSUE_MODE ,0)=1
		  UNION ALL
		  SELECT B.location_code/*LEFT (A.RECEIPT_ID  ,2)*//*Rohit 04-11-2024*/ AS DEPT_ID,
				 CAST('JWR' AS VARCHAR(10)) AS XN_TYPE,
				 JOBS.JOB_NAME AS JOBWORK_NAME,
				 B.AGENCY_CODE ,AM.AGENCY_NAME AS JOBWORKER_NAME  ,
				 B.RECEIPT_DT AS XN_DT ,A.PRODUCT_CODE ,
				 A.QUANTITY  AS  XN_QTY ,
				 CAST('' AS VARCHAR(100)) AS JWI_NO,
				 CAST('' AS DATETIME ) AS JWI_DT,
				 CAST('' AS DATETIME ) AS JWI_DUE_DT,
				 CAST(B.receipt_no AS VARCHAR(100)) AS JWR_NO,
				 CAST(B.receipt_DT AS DATETIME ) AS JWR_DT,
				  A.JOB_RATE,
				 CAST(A.JOB_RATE*A.QUANTITY AS NUMERIC(10,2)) AS JOB_AMOUNT
		  FROM JOBWORK_RECEIPT_DET A (NOLOCK)
		  JOIN JOBWORK_RECEIPT_MST B (NOLOCK) ON A.RECEIPT_ID  =B.RECEIPT_ID 
		  JOIN PRD_AGENCY_MST AM (NOLOCK) ON AM.AGENCY_CODE =B.AGENCY_CODE 
		  JOIN JOBS (NOLOCK) ON JOBS.JOB_CODE=A.JOB_CODE
		  WHERE B.CANCELLED =0 AND ISNULL(B.RECEIVE_MODE ,0)=1
		  UNION ALL
		  SELECT B.location_code/*LEFT (A.MEMO_ID  ,2) *//*Rohit 04-11-2024*/ AS DEPT_ID,
				  CAST('TTT' AS VARCHAR(10)) AS XN_TYPE,
				  CAST('' AS VARCHAR(100)) AS JOBWORK_NAME,
				  '' AS AC_CODE ,'' AS JOBWORKER_NAME  ,
				  B.MEMO_DT AS XN_DT ,A.PRODUCT_CODE ,
				  A.QUANTITY  AS  XN_QTY ,
				 CAST('' AS VARCHAR(100)) AS JWI_NO,
				 CAST('' AS DATETIME ) AS JWI_DT,
				 CAST('' AS DATETIME ) AS JWI_DUE_DT,
				 CAST('' AS VARCHAR(100)) AS JWR_NO,
				 CAST('' AS DATETIME ) AS JWR_DT ,
				  cast(0 as numeric(18,2)) as JOB_RATE,
				 cast(0 as numeric(18,2)) as JOB_AMOUNT
		  FROM TRANSFER_TO_TRADING_DET A (NOLOCK)
		  JOIN TRANSFER_TO_TRADING_MST  B (NOLOCK) ON A.MEMO_ID=B.MEMO_ID
		  WHERE B.CANCELLED=0
		  UNION ALL
		  SELECT B.location_code/*LEFT (A.CNC_MEMO_ID   ,2)*//*Rohit 04-11-2024*/ AS DEPT_ID,
				  CAST('CNC' AS VARCHAR(10)) AS XN_TYPE,
				  CAST('' AS VARCHAR(100)) AS JOBWORK_NAME,
				  '' AS AC_CODE ,'' AS JOBWORKER_NAME  ,
				  B.CNC_MEMO_DT  AS XN_DT ,A.PRODUCT_CODE ,
				  A.QUANTITY  AS  XN_QTY ,
				 CAST('' AS VARCHAR(100)) AS JWI_NO,
				 CAST('' AS DATETIME ) AS JWI_DT,
				 CAST('' AS DATETIME ) AS JWI_DUE_DT,
				 CAST('' AS VARCHAR(100)) AS JWR_NO,
				 CAST('' AS DATETIME ) AS JWR_DT ,
				  cast(0 as numeric(18,2)) as JOB_RATE,
				 cast(0 as numeric(18,2)) as JOB_AMOUNT
		  FROM ICD01106  A (NOLOCK)
		  JOIN ICM01106  B (NOLOCK) ON A.CNC_MEMO_ID =B.CNC_MEMO_ID
		  WHERE B.CANCELLED=0
		  --UNION ALL
		  --SELECT LEFT (A.INV_ID    ,2) AS DEPT_ID,
				--  CAST('wsl' AS VARCHAR(10)) AS XN_TYPE,
				--  CAST('' AS VARCHAR(100)) AS JOBWORK_NAME,
				--  b.AC_CODE ,'' AS JOBWORKER_NAME  ,
				--  B.inv_dt  AS XN_DT ,A.PRODUCT_CODE ,
				--  A.QUANTITY  AS  XN_QTY ,
				-- CAST('' AS VARCHAR(100)) AS JWI_NO,
				-- CAST('' AS DATETIME ) AS JWI_DT,
				-- CAST('' AS VARCHAR(100)) AS JWR_NO,
				-- CAST('' AS DATETIME ) AS JWR_DT 
		  --FROM IND01106   A (NOLOCK)
		  --JOIN INM01106   B (NOLOCK) ON A.INV_ID  =B.INV_ID 
		  --join JOBWORK_PMT pmt on a.PRODUCT_CODE =pmt.PRODUCT_CODE 
		  --WHERE B.CANCELLED=0
  ) A
  JOIN JOBWORK_PMT PMT (NOLOCK) ON PMT.PRODUCT_CODE =A.PRODUCT_CODE 
  LEFT JOIN ORD_PLAN_BARCODE_DET OBD (NOLOCK) ON A.PRODUCT_CODE =OBD.PRODUCT_CODE 
  LEFT JOIN ORD_PLAN_DET  OD (NOLOCK) ON OD.ROW_ID=OBD.REFROW_ID 
  LEFT JOIN ORD_PLAN_MST OM ON OM.MEMO_ID =OD.MEMO_ID 
  LEFT JOIN BUYER_ORDER_DET BD (NOLOCK) ON BD.row_id =OD.WOD_ROW_ID
  LEFT OUTER JOIN EMPLOYEE EMP (NOLOCK) ON EMP.EMP_CODE =ISNULL(PMT.ITEM_MERCHANT_CODE,BD.ITEM_MERCHANT_CODE )
  LEFT JOIN BUYER_ORDER_MST BM (NOLOCK ) ON BM.ORDER_ID=isnull(pmt.ORDER_ID, BD.ORDER_ID )
  LEFT JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE =BM.AC_CODE
  LEFT JOIN LOC_VIEW LOC (NOLOCK) ON A.DEPT_ID =LOC.DEPT_ID
  WHERE ISNULL(BM.CANCELLED,0)=0 and ISNULL(OM .CANCELLED,0)=0
