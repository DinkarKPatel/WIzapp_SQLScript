CREATE PROCEDURE SP3S_GET_FREEZE_DATE_FOR_SALE
(
	@dtFromDT		DATETIME,
	@CUSERCODE		VARCHAR(20),
	@cReportName	VARCHAR(100)
)
AS
BEGIN
	DECLARE @REPORT_GROUP VARCHAR(MAX)
	DECLARE @FREEZE_DT DATE='1900-01-01',@bALLOW_VIEW BIT=0
	IF OBJECT_ID('TEMPDB..#FREEZED_DATE','U') IS NOT NULL
				DROP TABLE #FREEZED_DATE

	CREATE TABLE #FREEZED_DATE  (FREEZED_DATE DATETIME, ALLOW_VIEW BIT)

	INSERT INTO #FREEZED_DATE  (FREEZED_DATE , ALLOW_VIEW )
	VALUES (CAST('' AS datetime),0)

	SELECT  @REPORT_GROUP=REPORT_GROUP
	FROM REPORTS 
	WHERE MODULE_NAME = 'FIXREPORTS_BETA' AND ISNULL(REPORT_HIDE,0)=0
	AND g_report_file=@cReportName

	IF @REPORT_GROUP='1. POS'
	BEGIN

		--'SALESSUMMARY.rdlc','DetailedSalesReportBillNo.rdlc','CashFundFlow_New.rdlc','1.rdlc',
		--'CREDITCARDSUMMARY.rdlc','SALEPERSONWISE.rdlc','SalesPersonWiseCustomerBalcance.rdlc',
		--'CusTrial.rdlc','PendingDocuments.rdlc','PendingDelivery.rdlc','SPIncentive.rdlc',
		--'POSBillWiseSales.RDLC','categorysale.rdlc','SPTARGETIncentive.rdlc'
		;WITH FZ
		AS
		(
			SELECT  *  FROM DBO.GET_DATAFREEZE_DATE(@CUSERCODE,'FRMSALE',@dtFromDT)
		)
		INSERT INTO #FREEZED_DATE(FREEZED_DATE , ALLOW_VIEW)
		SELECT  FREEZED_DATE , ALLOW_VIEW
		FROM FZ 
		
	END
	if EXISTS(SELECT 'U' FROM #FREEZED_DATE WHERE ISNULL(ALLOW_VIEW,0)=1)
		SELECT * FROM #FREEZED_DATE WHERE  @dtFromDT>(SELECT MAX(FREEZED_DATE) FROM #FREEZED_DATE)  
	ELSE
		SELECT * FROM #FREEZED_DATE WHERE ISNULL(FREEZED_DATE,'')=''
END