CREATE PROCEDURE SP_ITEMSTATUS_1
(   
  @CQUERYID INT=0,   
  @BILLNO NVARCHAR(50)='',     
  @PRODUCT_CODE NVARCHAR(20)='',  
  @CFINYEAR NVARCHAR(10)='' ,  
  @CCUSTCODE NVARCHAR(20)='',  
  @NMODE  INT=1,  
  @DTDELIVERYFROM NVARCHAR(20)='',  
  @DTDELIVERYTO NVARCHAR(20)='',  
  @AGENCY NVARCHAR(500)='',  
  @NMODE1 INT=0,--PENDING STATUS (1: LEVEL1) (2: LEVEL2) (3: LEVEL3)  
  @CLOCID VARCHAR(4)=''  ,
  @bsummary bit=0,
  @DTHBDFROM NVARCHAR(20)='',  
  @DTHBDTO NVARCHAR(20)=''
)   
--WITH ENCRYPTION  
AS   
BEGIN  
  
   DECLARE @CCMD NVARCHAR(MAX),@CCMD01 NVARCHAR(MAX) ,@CHODEPT_ID VARCHAR(4),@DLAST_DT DATETIME,
           @CCMD3 VARCHAR(MAX)

    SELECT @DLAST_DT=DATEADD (YY,-1, DBO.FN_GETFINYEARDATE (@CFINYEAR,1))  

	PRINT @DLAST_DT  
    SELECT @CHODEPT_ID=value  FROM CONFIG WHERE CONFIG_OPTION ='HO_LOCATION_ID'
     
	 if @CLOCID=@CHODEPT_ID
	   set @CLOCID=''

   ;WITH HBD_STATUS
	AS
	(
		SELECT CAST(0 AS INT) AS HBD_STATUS,'' AS HBD_STATUS_NAME		
		UNION ALL
		SELECT CAST(1 AS INT) AS HBD_STATUS,'Approve & Issue Advance Note' AS HBD_STATUS_NAME 
		UNION ALL
		SELECT CAST(2 AS INT) AS HBD_STATUS,'Free Repair & Return' AS HBD_STATUS_NAME 
		UNION ALL
		SELECT CAST(3 AS INT) AS HBD_STATUS,'Charged Repair & Return' AS HBD_STATUS_NAME 
		UNION ALL
		SELECT CAST(4 AS INT) AS HBD_STATUS,'Disapprove & Return' AS HBD_STATUS_NAME 
	)


	SELECT A.PRODUCT_CODE AS PRODUCT_CODE, A.quantity QUANTITY, A.DELIVERED, B.MEMO_DT,   
	A.DELIVERY_DT DUE_DT ,A.REMARKS REMARKS, B.REMARKS AS REMARKS_MST,  
	A.row_id ROW_ID,B.CANCELLED ,B.CUSTOMER_CODE  ,A.REF_CMD_ROW_ID , 
	A.JOB_CODE  ,ISNULL( C.CM_NO,B.MEMO_NO) AS CM_NO, isnull(C1.EMP_CODE,b.hbd_emp_code )  EMP_CODE,
	C1.EMP_CODE1,C1.EMP_CODE2,  C1.MRP,ISNULL(C.FIN_YEAR,@CFINYEAR) AS FIN_YEAR,  
	ISNULL(C.CM_DT,B.MEMO_DT) AS CM_DT  ,ISNULL(B.MEMO_NO,'') HOLDBACK_NO  
	,HOLDBACK_DT=CASE YEAR(ISNULL(B.MEMO_DT,'')) WHEN 1900 THEN '' ELSE B.MEMO_DT END ,
	CAST('' AS VARCHAR(50)) AS ISSUE_ID ,CAST('' AS VARCHAR(50)) AS  receipt_id ,CAST('' AS VARCHAR(50)) AS DELIVER_MEMO_ID,
	cast('' as DateTime) as ISSUE_DUE_DT ,cast(A.JOB_RATE as numeric(14,0)) as JOB_RATE,cast(JOB_RATE*a.quantity as numeric(14,0)) AMOUNT,
	CAST(ISNULL(A.SEND_TO_HO,0) AS VARCHAR(5))  SEND_TO_HO,
	CAST(ISNULL(A.RECEIVE_FROM_HO,0) AS VARCHAR(5)) RECEIVE_FROM_HO,
	C1.PRODUCT_CODE AS ORG_PRODUCT_CODE,A.SEND_TO_HO_DT,A.RECEIVE_FROM_HO_DT,a.Additional_job,ISNULL(HBD.HBD_STATUS_NAME,'') AS HBD_STATUS_NAME,
	ISNULL(EMP.EMP_NAME,'') as RECEIVE_SALES_PERSON ,A.SEND_TO_LOC_DT,A.RECEIPT_AT_LOC_DT,A.CN_PRODUCT_CODE,
	cast(a.quantity as Numeric(10,3)) as RECEIVEQTY,
	cast(0 as Numeric(10,3)) as DELIVERQTY,
	cast(a.quantity as Numeric(10,3)) as PENDINGQTY,
	A.CN_REF_BILL_NO,C1.NET as Sale_Price,
	DeliverNo=cast('' as varchar(100)),
	A.SEND_TO_HO_NO,A.RECEIVE_FROM_HO_NO,A.SEND_TO_LOC_NO,A.RECEIPT_AT_LOC_NO,
	ReceivedFor=(case when isnull(C.CM_NO,'')<>'' then 'Sold Item' else 'Repair/Defective Item' END),
	CAST('' as varchar(25)) as CreditNoteNo,
	CAST('' as varchar(25)) as AdjMemoNo,
	a.Additional_Job_HO,b.location_Code 
	INTO #TMPHOLDS
	FROM HOLD_BACK_DELIVER_DET   A WITH  (NOLOCK)   
	JOIN HOLD_BACK_DELIVER_MST B WITH (NOLOCK) ON A.MEMO_ID = B.MEMO_ID  
	LEFT JOIN cmd01106 C1 WITH (NOLOCK) ON C1.ROW_ID =A.REF_CMD_ROW_ID 
	LEFT JOIN cmm01106 C WITH (NOLOCK) ON C1.CM_ID =C.cm_id 
	LEFT OUTER JOIN HBD_STATUS HBD  WITH (NOLOCK)  ON HBD.HBD_STATUS=a.HBD_STATUS
	LEFT JOIN EMPLOYEE EMP  WITH (NOLOCK)  ON EMP.EMP_CODE=B.HBD_EMP_CODE
	WHERE B.MEMO_DT>=@DLAST_DT  
	--and memo_dt ='2023-07-31'
	AND B.CANCELLED=0  and delivered =0
	and b.location_Code =(CASE WHEN @CLOCID='' THEN b.location_Code  ELSE @CLOCID END)
	AND (@DTDELIVERYFROM='' OR ( A.DELIVERY_DT>=@DTDELIVERYFROM AND A.DELIVERY_DT<=@DTDELIVERYTO))
	AND (@DTHBDFROM='' OR ( b.memo_dt>=@DTHBDFROM AND b.memo_dt<=@DTHBDTO))
	--and a.product_code ='01-RPR-645'

	
	


	SELECT 'ISSUE' AS XNTYPE, A.PRODUCT_CODE ,COUNT(*) AS IssueCOUNT,MAX(C.ISSUE_NO) AS ISSUE_NO,MAX(C.ISSUE_DT) AS Issue_dt,
	        cast(0 as numeric(2,0)) as RECCOUNT,RECEIPT_NO =cast('' as varchar(20)),RECEIVED_DT =cast('' as DateTime),
			DeliverNo =cast('' as varchar(20)),DeliverDT =cast('' as DateTime),max(b.due_dt) ISSUE_DUE_DT,
			cast('' as varchar(100)) as delivered_to,cast('' as varchar(500))  DELIVER_SALES_PERSON,
			cast(0 as numeric(5,2)) as DELIVERQTY,max(b.ISSUE_ID ) as ISSUE_ID
	       into #tmpDetails
	FROM #TMPHOLDS A
	JOIN POST_SALES_JOBWORK_ISSUE_DET B (NOLOCK) ON A.PRODUCT_CODE =B.PRODUCT_CODE 
	JOIN POST_SALES_JOBWORK_ISSUE_MST C (NOLOCK) ON B.ISSUE_ID=C.ISSUE_ID
	WHERE C.CANCELLED =0
	GROUP BY A.PRODUCT_CODE

	
	

	INSERT INTO #TMPDETAILS(XNTYPE,PRODUCT_CODE,IssueCOUNT,ISSUE_NO,Issue_dt,RECCOUNT,RECEIPT_NO,RECEIVED_DT,DeliverNo,DeliverDT,ISSUE_DUE_DT,delivered_to,DELIVER_SALES_PERSON,DELIVERQTY)
	SELECT 'REC' AS XNTYPE, A.PRODUCT_CODE ,0,'','',
	        COUNT(*) AS XNCOUNT,MAX(C.receipt_no) AS xnno,MAX(C.receipt_dt) AS xndt,'','','','','',0 as DELIVERQTY
	FROM #TMPHOLDS A
	JOIN POST_SALES_JOBWORK_receipt_DET B (NOLOCK) ON A.PRODUCT_CODE =B.PRODUCT_CODE 
	JOIN POST_SALES_JOBWORK_receipt_mst C (NOLOCK) ON B.receipt_id=C.receipt_id
	WHERE C.CANCELLED =0
	GROUP BY A.PRODUCT_CODE

	INSERT INTO #TMPDETAILS(XNTYPE,PRODUCT_CODE,IssueCOUNT,ISSUE_NO,Issue_dt,RECCOUNT,RECEIPT_NO,RECEIVED_DT,DeliverNo,DeliverDT,ISSUE_DUE_DT,delivered_to,DELIVER_SALES_PERSON,DELIVERQTY)
	select 'DLV' AS XNTYPE, A.PRODUCT_CODE ,0,'','',0,'','',memo_no,c.memo_dt,'',delivered_to,SLSEMP.emp_name,b.QUANTITY  as DELIVERQTY
	FROM #TMPHOLDS A
	JOIN sls_delivery_det B (NOLOCK) ON A.PRODUCT_CODE =B.PRODUCT_CODE 
	JOIN sls_delivery_mst C (NOLOCK) ON B.memo_id=C.memo_id
	LEFT JOIN EMPLOYEE SLSEMP (NOLOCK) ON SLSEMP.EMP_CODE =c.EMP_CODE
	WHERE C.CANCELLED =0




	SELECT A.PRODUCT_CODE ,cast('' as varchar(5)) JOBWORKS_ISSUE,
	     SUM(ISSUECOUNT) AS ISSUECOUNT,
		 CONVERT(VARCHAR,MAX(a.ISSUE_DT),105) as ISSUE_DT_STR,
	     MAX(ISSUE_DT) AS ISSUE_DT,
		 MAX(ISSUE_NO) AS ISSUE_NO,
		 MAX(ISSUE_DUE_DT) AS ISSUE_DUE_DT,
		 MAX(ISSUE_id) AS ISSUE_id,
		 cast('' as varchar(100)) as Agency_name,

		 cast('' as varchar(5)) JOBWORKS_RECEIVED,
		 sum(RECCOUNT) as RECCOUNT,
		 CONVERT(VARCHAR,MAX(a.RECEIVED_DT),105) as RECEIVED_DT_STR,
		 max(RECEIVED_DT) as RECEIVED_DT,
		 max(RECEIPT_NO) as RECEIPT_NO,

		 cast('' as varchar(5)) DELIVERED_TO_CUSTOMER,
		 CONVERT(VARCHAR,MAX(DeliverDT),105)  DELIVERED_DATE_STR,
		 max(DeliverDT) as DELIVERED_DATE,
		 max(DeliverNo) as DeliverNo,
		 max(delivered_to) as delivered_to,
		 max(DELIVER_SALES_PERSON) as DELIVER_SALES_PERSON,
		 DELIVERQTY=sum(DELIVERQTY)
    into #tmphbdDtatus
	FROM #TMPDETAILS A
	GROUP BY A.PRODUCT_CODE

	

	UPDATE A SET AGENCY_NAME =C.AGENCY_NAME 
	FROM #TMPHBDDTATUS A
	JOIN POST_SALES_JOBWORK_ISSUE_MST B (NOLOCK) ON A.ISSUE_ID =B.ISSUE_ID
	JOIN PRD_AGENCY_MST C (NOLOCK) ON B.AGENCY_CODE =C.AGENCY_CODE 

	
	Update #tmphbdDtatus set JOBWORKS_ISSUE='Yes'  where ISSUECOUNT>0
	Update #tmphbdDtatus set JOBWORKS_RECEIVED='Yes' where   RECCOUNT>0  and ISSUECOUNT =RECCOUNT
	
	
	UPDATE A SET CREDITNOTENO =B.CM_NO 
	FROM #TMPHOLDS A
	JOIN CMM01106 B (NOLOCK) ON CN_REF_BILL_NO=B.CM_ID 

	UPDATE a SET DeliverNo= CMM.CM_ID,
		         DELIVERQTY=A.QUANTITY,
		         AdjMemoNo=cmm.CM_NO 
	FROM #TMPHOLDS A
    JOIN PAYMODE_XN_DET B (NOLOCK) ON A.CN_REF_BILL_NO =B.ADJ_MEMO_ID 
	JOIN CMM01106 CMM (NOLOCK) ON B.MEMO_ID =CMM.CM_ID 
	WHERE CN_REF_BILL_NO <>'' AND CMM.CANCELLED =0


		

	if @bsummary=0
    begin
	      
   SET @CCMD=N'SELECT  HLDS.PRODUCT_CODE,SN.ARTICLE_NAME,HLDS.CM_NO,SN.ARTICLE_NO,SN.article_alias, SN.SECTION_NAME,  
					SN.SUB_SECTION_NAME,HLDS.QUANTITY,SN.PARA1_NAME,SN.PARA2_NAME,  SN.PARA3_NAME,SN.PARA4_NAME,SN.PARA5_NAME,  SN.PARA6_NAME,
					ISNULL(JOBS.JOB_NAME,'''') AS JOB_NAME,  
					(CASE WHEN HLDS.DELIVERED = 0 THEN ''YES'' ELSE ''NO'' END)  HOLD_DELIVER,
			
			        ISNULL(CONVERT(VARCHAR, HLDS.MEMO_DT,105),'''') AS HOLD_DELIVER_DT_STR,  
					REPLACE(CONVERT(varchar(11), HLDS.MEMO_DT, 106),'' '',''-'')   AS HOLD_DELIVER_DT, 

					isnull(b.JOBWORKS_ISSUE,''No'') AS JOBWORKS_ISSUE,  
					b.ISSUE_DT_STR AS ISSUE_DT_STR,  
					REPLACE(CONVERT(varchar(11), b.ISSUE_DT, 106),'' '',''-'') ISSUE_DT,  
					ISNULL(b.ISSUE_NO,'''') AS ISSUE_NO,  
					isnull(b.JOBWORKS_RECEIVED,''NO'') AS JOBWORKS_RECEIVED,  
					ISNULL(b.RECEIVED_DT_STR,'''') AS RECEIVED_DT_STR,  
					REPLACE(CONVERT(varchar(11), isnull(b.RECEIVED_DT,''''), 106),'' '',''-'')   AS RECEIVED_DT,  
					ISNULL(b.RECEIPT_NO,'''') AS RECEIPT_NO,  
					case when (ISNULL(HLDS.DELIVERQTY,0)+isnull(B.DELIVERQTY,0)) >0 then ''Yes'' else 
					isnull(b.DELIVERED_TO_CUSTOMER,'''') end  AS DELIVERED_TO_CUSTOMER,  
					isnull(b.DELIVERED_DATE_STR,'''')  AS DELIVERED_DATE_STR,  
					REPLACE(CONVERT(varchar(11), isnull(b.DELIVERED_DATE,''''), 106),'' '',''-'')  AS DELIVERED_DATE,  
					b.DELIVERED_TO,
					CONVERT(VARCHAR,HLDS.DUE_DT,105) AS DUE_DT_STR,
					REPLACE(CONVERT(varchar(11), isnull(HLDS.DUE_DT,''''), 106),'' '',''-'')  AS DUE_DT,
					EMP.EMP_NAME,  EMP1.EMP_NAME EMP_NAME2,EMP2.EMP_NAME EMP_NAME3 ,
					HLDS.REMARKS AS ITEM_REMARKS,HLDS.REMARKS_MST AS BILL_REMARKS,HLDS.MRP,  
					LTRIM(RTRIM(H.CUSTOMER_TITLE+'' ''+H.CUSTOMER_FNAME+'' ''+H.CUSTOMER_LNAME)) AS [CUSTOMER_NAME] ,
					CONVERT(VARCHAR,HLDS.CM_DT,105) AS CM_DT_STR, 
					REPLACE(CONVERT(varchar(11), HLDS.CM_DT, 106),'' '',''-'') AS  CM_DT ,
					DATEDIFF(D,HLDS.DUE_DT,(CASE WHEN ISNULL(B.DELIVERED_DATE,'''')='''' THEN GETDATE() ELSE B.DELIVERED_DATE END)) AS DUE_DAYS  
					,ISNULL(CONVERT(VARCHAR,b.ISSUE_DUE_DT,105),'''') AS JOBOWRK_DUE_DT_STR  
					,REPLACE(CONVERT(varchar(11),(CASE WHEN ISNULL( b.ISSUE_DUE_DT,'''')<>'''' THEN  b.ISSUE_DUE_DT ELSE CAST(NULL AS DATETIME) END), 106),'' '',''-'') AS JOBOWRK_DUE_DT  
					,DATEDIFF(D,case when isnull(b.ISSUE_DUE_DT,'''')='''' then getdate() else b.ISSUE_DUE_DT end ,
					ISNULL(b.RECEIVED_DT,GETDATE())) AS JOBOWRK_DUE_DAYS  
					,h.USER_CUSTOMER_CODE  
					--ADDED ON 7 MAR 2019  
					,HLDS.HOLDBACK_NO,
					CONVERT(VARCHAR,HLDS.HOLDBACK_DT,105) as HOLDBACK_DT_STR  ,
					REPLACE(CONVERT(varchar(11), (CASE WHEN ISNULL(HLDS.HOLDBACK_DT ,'''')<>'''' THEN  HLDS.HOLDBACK_DT ELSE null END), 106),'' '',''-'')  AS HOLDBACK_DT  
					,hlds.JOB_RATE,  
					hlds.AMOUNT,
					(CASE WHEN HLDS.SEND_TO_HO = 0 THEN ''NO'' ELSE ''Yes'' END) SEND_TO_HO,
					(CASE WHEN HLDS.RECEIVE_FROM_HO = 0 THEN ''NO'' ELSE ''Yes'' END) RECEIVE_FROM_HO,
					ORG_PRODUCT_CODE, 
					REPLACE(CONVERT(varchar(11), HLDS.SEND_TO_HO_DT, 106),'' '',''-'')  SEND_TO_HO_DT,
					REPLACE(CONVERT(varchar(11), HLDS.RECEIVE_FROM_HO_DT, 106),'' '',''-'')  RECEIVE_FROM_HO_DT,
					HLDS.Additional_job,HLDS.HBD_STATUS_NAME,
					RECEIVE_SALES_PERSON,DELIVER_SALES_PERSON,loc.DEPT_ID,loc.DEPT_NAME,loc.DEPT_ALIAS,
					REPLACE(CONVERT(varchar(11), SEND_TO_LOC_DT, 106),'' '',''-'') SEND_TO_LOC_DT,
					REPLACE(CONVERT(varchar(11), hlds.RECEIPT_AT_LOC_DT, 106),'' '',''-'') RECEIPT_AT_LOC_DT,
					HLDS.CN_PRODUCT_CODE,
					HLDS.RECEIVEQTY,
					(ISNULL(HLDS.DELIVERQTY,0)+isnull(B.DELIVERQTY,0)) AS DELIVERQTY,
					PENDINGQTY=HLDS.RECEIVEQTY-(ISNULL(HLDS.DELIVERQTY,0)+isnull(B.DELIVERQTY,0)),
					HLDS.Sale_Price,isnull(b.agency_name,'''') AS AGENCY_NAME,
					DATEDIFF(D,isnull(nullif(hlds.RECEIPT_AT_LOC_DT,''''),null),isnull(nullif(b.DELIVERED_DATE,''''),GETDATE()) ) AS AgeingDAYS,
					HLDS.SEND_TO_HO_NO,HLDS.RECEIVE_FROM_HO_NO,HLDS.SEND_TO_LOC_NO,HLDS.RECEIPT_AT_LOC_NO,hlds.ReceivedFor,
					hlds.CreditNoteNo,hlds.AdjMemoNo,hlds.Additional_Job_HO
			FROM #TMPHOLDS HLDS
			join location loc (nolock) on loc.dept_id=HLDS.location_Code
			left join #tmphbdDtatus b on b.product_code=hlds.product_code
			join SKU_NAMES SN (NOLOCK) ON SN.PRODUCT_CODE =HLDS.PRODUCT_CODE 
			JOIN CUSTDYM H (NOLOCK) ON hlds.CUSTOMER_CODE=H.CUSTOMER_CODE 
			LEFT JOIN JOBS (NOLOCK) ON JOBS.JOB_CODE=HLDS.JOB_CODE
			LEFT JOIN EMPLOYEE EMP (NOLOCK) ON EMP.EMP_CODE =HLDS.EMP_CODE
			LEFT JOIN EMPLOYEE EMP1 (NOLOCK) ON EMP1.EMP_CODE =HLDS.EMP_CODE1
			LEFT JOIN EMPLOYEE EMP2 (NOLOCK) ON EMP2.EMP_CODE =HLDS.EMP_CODE2
	
	'
	  SET @CCMD3=N'WHERE 1=1  '  
    + (CASE WHEN ISNULL(@BILLNO,'''')<>'' THEN ' AND ( (HLDS.CM_NO='''+@BILLNO+''' OR HLDS.HOLDBACK_NO='''+@BILLNO+''') AND HLDS.CANCELLED=0 AND HLDS.FIN_YEAR='''+@CFINYEAR+''' )' ELSE '' END)  
    + (CASE WHEN ISNULL(@PRODUCT_CODE,'''')<>'' THEN ' AND ((HLDS.CANCELLED=0 AND HLDS.FIN_YEAR='''+@CFINYEAR+''' AND HLDS.PRODUCT_CODE='''+@PRODUCT_CODE+''') OR HLDS.ORG_PRODUCT_CODE='''+@PRODUCT_CODE+''')' ELSE '' END)  
    + (CASE WHEN ISNULL(@CCUSTCODE,'''')<>'' THEN ' AND (HLDS.CUSTOMER_CODE='''+ @CCUSTCODE+ ''' ) ' ELSE '' END)  
    + (CASE WHEN ISNULL(@NMODE,1)=1 THEN ' AND  (isnull(HLDS.DeliverNo,'''')+isnull(b.DeliverNo,'''')='''' ) '   
      WHEN ISNULL(@NMODE,1)=2 THEN ' AND  isnull(HLDS.DeliverNo,'''')+isnull(b.DeliverNo,'''')<>'''' ' ELSE '' END)  
    + (CASE WHEN ISNULL(@NMODE1,1)=1 THEN ' AND  isnull(b.ISSUE_NO,'''')='''' '   
      WHEN ISNULL(@NMODE1,1)=2 THEN ' AND  (isnull(b.ISSUE_NO,'''')<>''''  AND isnull(b.RECEIPT_NO,'''') ='''') '   
      WHEN ISNULL(@NMODE1,1)=3 THEN ' AND  (isnull(b.ISSUE_NO,'''')<>'''' AND isnull(b.RECEIPT_NO,'''')<>'''' AND isnull(HLDS.DeliverNo,'''')+isnull(b.DeliverNo,'''')='''') '  
      ELSE '' END)  
    +' AND '+CASE @AGENCY WHEN '' THEN '1=1' ELSE 'b.AGENCY_NAME='''+@AGENCY+'''' END  
    +' ORDER BY HLDS.PRODUCT_CODE '  

	PRINT @CCMD+@CCMD3
	EXEC ( @CCMD+@CCMD3)
	
	


	END
	ELSE
	BEGIN
	       
		   	SELECT ISNULL(SN.SECTION_NAME,'') AS SECTION_NAME,
		       ISNULL(SN.sub_SECTION_NAME,'') AS SUB_SECTION_NAME, 
			   isnull(sn.article_no ,'') as Article_no,
			   sum(B.RECEIVEQTY) as Receiveqty,
			   sum(DELIVERQTY) as DeliverQty,
			   sum(PENDINGQTY) as PendingQty
		
		FROM #TMPHOLDS B (NOLOCK)
		LEFT JOIN SKU_NAMES SN (NOLOCK) ON SN.PRODUCT_CODE =b.PRODUCT_CODE 
		group by ISNULL(SN.SECTION_NAME,'') ,ISNULL(SN.sub_SECTION_NAME,''), isnull(sn.article_no ,'') 
		order  by ISNULL(SN.SECTION_NAME,'') ,ISNULL(SN.sub_SECTION_NAME,''), isnull(sn.article_no ,'') 
		

	END



	

END	