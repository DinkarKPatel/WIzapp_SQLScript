CREATE PROCEDURE SP_RETURN_TRANSPORTER_DETAILS  
(  
 @NQUERYID INT,  
 @CAC_CODE VARCHAR(10)=''  
)  
AS  
BEGIN  
     
   IF @NQUERYID=1  
      GOTO LBLTRANSPORTER  
   ELSE IF @NQUERYID=2  
      GOTO LBLMST  
   ELSE  
   GOTO END_PROC  
     
   LBLTRANSPORTER:  
        
    SELECT MEMO_NO AS GP_MEMO_NO,MEMO_ID,TRANSPORTER_CODE ,B.ANGADIA_NAME AS TRANSPORTER_NAME  
 FROM TBL_GP_ISSUE_MST A  
 JOIN ANGM B ON A.TRANSPORTER_CODE=B.ANGADIA_CODE  
 WHERE (@CAC_CODE='' OR A.TRANSPORTER_CODE=@CAC_CODE)  
   
   GOTO END_PROC  
     
   LBLMST:  
        
      SELECT A.MEMO_NO,A.MEMO_ID,A.MEMO_DT,  
             A.TRANSPORTER_CODE,ANGM.ANGADIA_NAME AS TRANSPORTER_NAME,  
             A.REMARKS,CANCELLED ,USER_CODE,COUNT(*) AS NOOFMEMOES  
             ,A.RECEIVED_FROM
      FROM TBL_GP_RETURN_MST A  
      JOIN ANGM ON ANGM.ANGADIA_CODE=A.TRANSPORTER_CODE  
      JOIN TBL_GP_RETURN_DET B ON A.MEMO_ID=B.MEMO_ID  
      GROUP BY A.MEMO_NO,A.MEMO_ID,A.MEMO_DT,  
             A.TRANSPORTER_CODE,ANGM.ANGADIA_NAME ,  
             A.REMARKS,CANCELLED,USER_CODE  
            ,A.RECEIVED_FROM
            
       
     
   GOTO END_PROC  
     
     
     
   END_PROC:  
  
END
