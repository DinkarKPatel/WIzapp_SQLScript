CREATE PROCEDURE SP_USERROLE     
@NQUERYID NUMERIC(3,0),          
@CMEMO VARCHAR(50)='',  
@CFINYEAR VARCHAR(5) ,  
@CWHERE VARCHAR(50)='',  
@NNAVMODE NUMERIC(1,0)  
--WITH ENCRYPTION
AS          
BEGIN          
----- PROCEDURE TO STORE GRID SETTINGS OF EACH USER    
IF @NQUERYID=1       
   GOTO LBLNAVIGATE     
ELSE IF @NQUERYID=2      
   GOTO LBLMASTER             
ELSE IF @NQUERYID=3      
   GOTO LBLDETAIL 
ELSE IF @NQUERYID=4      
   GOTO LBLUSERROLEDET  

  
ELSE     
 GOTO LAST    
               
LBLNAVIGATE:  -- CREATING LOOK UP TABLE   
            
  SELECT USERROLE_ID FROM USERROLE_MST  WHERE MODULE_NAME=@CWHERE OR @CWHERE=''
    
  GOTO LAST                          
                                 
             
LBLMASTER:    
    
   SELECT A.*,B.USERNAME FROM USERROLE_MST A (NOLOCK)     
   JOIN USERS B (NOLOCK) ON A.USER_CODE= B.USER_CODE    
   WHERE A.USERROLE_ID= @CMEMO    
        
   GOTO LAST      
            
LBLDETAIL:      
     
   SELECT * FROM USERROLE_COL_DET  A  (NOLOCK)              
   WHERE A.USERROLE_ID= @CMEMO    

LBLUSERROLEDET:           
		SELECT CAST(1 AS BIT) AS CHK, A.USERROLE_ID,A.USER_CODE,B.USERNAME FROM USERROLE_USERS  A 
		JOIN USERS B ON A.USER_CODE= B.USER_CODE
		WHERE B.INACTIVE=0 AND A.USERROLE_ID=@CMEMO
		UNION ALL
		SELECT CAST(0 AS BIT) AS CHK,'' AS USERROLE_ID,A.USER_CODE,A.USERNAME 
		FROM USERS A WHERE A.INACTIVE=0 AND USER_CODE NOT IN 
		(SELECT USER_CODE FROM USERROLE_USERS WHERE USERROLE_ID = @CMEMO)

            
LAST:            
END
