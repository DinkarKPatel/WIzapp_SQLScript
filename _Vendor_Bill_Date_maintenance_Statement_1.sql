DECLARE @CCMD NVARCHAR(MAX)
IF OBJECT_ID('PIM01106_BKP_VANDOR_BILL_DT','U') IS NULL
BEGIN
	SET @CCMD=N'SELECT MRR_ID,VANDOR_BILL_DT,INV_DT,RECEIPT_DT INTO PIM01106_BKP_VANDOR_BILL_DT FROM PIM01106'
	EXEC SP_EXECUTESQL @CCMD
END

DECLARE @CDEFCONSTNAME VARCHAR(200)
SELECT TOP 1 @CDEFCONSTNAME=B.NAME
FROM SYSCONSTRAINTS A
JOIN SYSOBJECTS B ON A.CONSTID = B.ID 
JOIN SYSOBJECTS C ON A.ID = C.ID 
JOIN SYSCOMMENTS D ON A.CONSTID = D.ID 
JOIN SYSCOLUMNS E ON E.COLID = A.COLID AND E.ID=A.ID 
WHERE E.NAME='VANDOR_BILL_DT' AND C.NAME='PIM01106'

	
IF @CDEFCONSTNAME IS NOT NULL
BEGIN

	SET @CCMD=N'ALTER TABLE PIM01106 DROP CONSTRAINT '+@CDEFCONSTNAME
	PRINT @CCMD
	EXEC SP_EXECUTESQL @CCMD
END

IF  EXISTS(SELECT A.NAME FROM SYS.COLUMNS A        JOIN SYS.TABLES B ON A.OBJECT_ID=B.OBJECT_ID 
		   WHERE A.NAME='VANDOR_BILL_DT' AND B.NAME='PIM01106') 
BEGIN		   

	SET @CCMD=N'UPDATE PIM01106 SET INV_DT=VANDOR_BILL_DT WHERE INV_DT=RECEIPT_DT AND ISNULL(VANDOR_BILL_DT,'''')<>''''
				AND INV_DT<>ISNULL(VANDOR_BILL_DT,'''')'
	EXEC SP_EXECUTESQL @CCMD

	SET @CCMD=N'ALTER TABLE PIM01106 DROP COLUMN VANDOR_BILL_DT'
	PRINT @CCMD
	EXEC SP_EXECUTESQL @CCMD
END

IF  EXISTS(SELECT A.NAME FROM SYS.COLUMNS A        JOIN SYS.TABLES B ON A.OBJECT_ID=B.OBJECT_ID 
		   WHERE A.NAME='VANDOR_BILL_DT' AND B.NAME='PUR_PIM01106_UPLOAD') 	
BEGIN		   
	SET @CCMD=N'ALTER TABLE PUR_PIM01106_UPLOAD DROP COLUMN VANDOR_BILL_DT'
	PRINT @CCMD
	EXEC SP_EXECUTESQL @CCMD
END	

IF  EXISTS(SELECT A.NAME FROM SYS.COLUMNS A        JOIN SYS.TABLES B ON A.OBJECT_ID=B.OBJECT_ID 
		   WHERE A.NAME='VANDOR_BILL_DT' AND B.NAME='PUR_PIM01106_MIRROR') 	
BEGIN		   
	SET @CCMD=N'ALTER TABLE PUR_PIM01106_MIRROR DROP COLUMN VANDOR_BILL_DT'
	PRINT @CCMD
	EXEC SP_EXECUTESQL @CCMD
END	
