CREATE PROCEDURE SP_BUYERSORDER_WSL
(  
	@NQUERYID NUMERIC(2,0),  
	@CMEMOID VARCHAR(40),  
	@CWHERE VARCHAR(500),  
	@CFINYEAR VARCHAR(10),  
	@NNAVMODE NUMERIC(2,0),
	@CARTICLECODE CHAR(9)='',  
	@CPARA2CODE CHAR(7)='',
	@DTWHERE DATETIME ='',
	@cLocId VARCHAR(5)=''
)
AS    
BEGIN    
	IF @NQUERYID = 1    
		EXEC SP_BUYERSORDER_WSL_1  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId
	ELSE IF @NQUERYID = 2    
		EXEC SP_BUYERSORDER_WSL_2  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId
	ELSE IF @NQUERYID = 3    
		EXEC SP_BUYERSORDER_WSL_3  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId
	ELSE IF @NQUERYID = 4    
		EXEC SP_BUYERSORDER_WSL_4  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId    
	ELSE IF @NQUERYID = 5    
		EXEC SP_BUYERSORDER_WSL_5  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId        
	ELSE IF @NQUERYID = 6    
		EXEC SP_BUYERSORDER_WSL_6  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId        
	ELSE IF @NQUERYID = 7    
		EXEC SP_BUYERSORDER_WSL_7  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId           
	ELSE IF @NQUERYID = 8    
		EXEC SP_BUYERSORDER_WSL_8  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId          
	ELSE IF @NQUERYID = 9    
		EXEC SP_BUYERSORDER_WSL_9  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId            
	ELSE IF @NQUERYID = 10    
		EXEC SP_BUYERSORDER_WSL_10  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId            
	ELSE IF @NQUERYID = 11    
		EXEC SP_BUYERSORDER_WSL_11  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                
	ELSE IF @NQUERYID = 12    
		EXEC SP_BUYERSORDER_WSL_12  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID = 13    
		EXEC SP_BUYERSORDER_WSL_13  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID = 14    
		EXEC SP_BUYERSORDER_WSL_14  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID = 15    
		EXEC SP_BUYERSORDER_WSL_15  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID = 16    
		EXEC SP_BUYERSORDER_WSL_16  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID = 19    
		EXEC SP_BUYERSORDER_WSL_19  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID = 20    
		EXEC SP_BUYERSORDER_WSL_20  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID = 21    
		EXEC SP_BUYERSORDER_WSL_21  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID = 22    
		EXEC SP_BUYERSORDER_WSL_22  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID = 23  
		EXEC SP_BUYERSORDER_WSL_23  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID = 24  
		EXEC SP_BUYERSORDER_WSL_24  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID = 25  
		EXEC SP_BUYERSORDER_WSL_25  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID = 26    
		EXEC SP_BUYERSORDER_WSL_26  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID = 27    
		EXEC SP_BUYERSORDER_WSL_27  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID= 28
		EXEC SP_BUYERSORDER_WSL_28  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID= 29  
		EXEC SP_BUYERSORDER_WSL_29  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID= 30  
		EXEC SP_BUYERSORDER_WSL_30  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID =31
		EXEC SP_BUYERSORDER_WSL_31  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID =32
		EXEC SP_BUYERSORDER_WSL_32  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
	ELSE IF @NQUERYID =33
		EXEC SP_BUYERSORDER_WSL_33  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
END

/*
CREATE PROCEDURE SP_BUYERSORDER_WSL  
@NQUERYID NUMERIC(2,0),  
@CMEMOID VARCHAR(40),  
@CWHERE VARCHAR(500),  
@CFINYEAR VARCHAR(10),  
@NNAVMODE NUMERIC(2,0),
@CARTICLECODE CHAR(9)='',  
@CPARA2CODE CHAR(7)='',
@DTWHERE DATETIME ='',
@cLocId VARCHAR(5)=''
--WITH ENCRYPTION
 
AS    
BEGIN    
    
DECLARE @CCMD NVARCHAR(MAX),@cHeadCode VARCHAR(MAX),@cHeadCode1 VARCHAR(MAX)    
DECLARE @nWsPrice NUMERIC(10,2)    
IF @NQUERYID = 1    
GOTO LBLNAVIGATE    
	--EXEC SP_BUYERSORDER_WSL_1  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId
ELSE IF @NQUERYID = 2    
GOTO LBLGETMASTER    
    --EXEC SP_BUYERSORDER_WSL_2  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId
ELSE IF @NQUERYID = 3    
GOTO LBLGETDETAILS    
    --EXEC SP_BUYERSORDER_WSL_3  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId
ELSE IF @NQUERYID = 4    
GOTO LBLGETPARA1LIST    
	--EXEC SP_BUYERSORDER_WSL_4  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId    
ELSE IF @NQUERYID = 5    
GOTO LBLGETPARA2LIST    
	--EXEC SP_BUYERSORDER_WSL_5  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId        
ELSE IF @NQUERYID = 6    
GOTO LBLGETPARA3LIST    
    --EXEC SP_BUYERSORDER_WSL_6  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId        
ELSE IF @NQUERYID = 7    
GOTO LBLGETPARA4LIST    
	--EXEC SP_BUYERSORDER_WSL_7  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId           
ELSE IF @NQUERYID = 8    
GOTO LBLGETPARA5LIST    
	--EXEC SP_BUYERSORDER_WSL_8  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId          
ELSE IF @NQUERYID = 9    
GOTO LBLGETPARA6LIST    
	--EXEC SP_BUYERSORDER_WSL_9  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId            
ELSE IF @NQUERYID = 10    
GOTO LBLCUSTOMER    
	--EXEC SP_BUYERSORDER_WSL_10  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId            
ELSE IF @NQUERYID = 11    
GOTO LBLARTICLELIST    
	--EXEC SP_BUYERSORDER_WSL_11  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                
ELSE IF @NQUERYID = 12    
GOTO LBLARTICLEINFO    
	--EXEC SP_BUYERSORDER_WSL_12  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID = 13    
GOTO LBLFORMNAME    
    --EXEC SP_BUYERSORDER_WSL_13  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID = 14    
GOTO LBLARTICLESKUINFO    
    --EXEC SP_BUYERSORDER_WSL_14  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID = 15    
GOTO LBLARTICLEPARA2LIST    
    --EXEC SP_BUYERSORDER_WSL_15  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID = 16    
GOTO LBLARTICLEPARA1LIST    
    --EXEC SP_BUYERSORDER_WSL_16  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID = 19    
GOTO LBLMEASUREMENTDET    
    --EXEC SP_BUYERSORDER_WSL_19  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID = 20    
GOTO LBLGETREPORTSUMMARY    
    --EXEC SP_BUYERSORDER_WSL_20  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID = 21    
GOTO LBLMEASUREMENTADD     
    --EXEC SP_BUYERSORDER_WSL_21  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID = 22    
GOTO LBLGETBOLIST    
    --EXEC SP_BUYERSORDER_WSL_22  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID = 23  
GOTO LBLGETARTICLEINFO    
--EXEC SP_BUYERSORDER_WSL_23  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID = 24  
GOTO LBLGETLINKADV
--EXEC SP_BUYERSORDER_WSL_24  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID = 25  
GOTO LBLGETSALEPERSON
--EXEC SP_BUYERSORDER_WSL_25  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID = 26    
GOTO LBLBOMDET 
--EXEC SP_BUYERSORDER_WSL_26  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID = 27    
GOTO LBLBOMPRODUCTDET 
--EXEC SP_BUYERSORDER_WSL_27  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID= 28
	GOTO LBLGETTRIALDATA
	--EXEC SP_BUYERSORDER_WSL_28  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID= 29  
	GOTO LBLGETDELIVERYDATA
--EXEC SP_BUYERSORDER_WSL_29  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID= 30  
	GOTO LBLGETARTPARASSTOCK	
	--EXEC SP_BUYERSORDER_WSL_30  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID =31
	GOTO LBLPRODUCTINFO
	--EXEC SP_BUYERSORDER_WSL_31  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID =32
	GOTO LBLBOM_NOTSET
	--EXEC SP_BUYERSORDER_WSL_32  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE IF @NQUERYID =33
	GOTO LBLBOM_TOTALQTY
	--EXEC SP_BUYERSORDER_WSL_33  @CMEMOID=@CMEMOID,@CWHERE=@CWHERE,@CFINYEAR=@CFINYEAR,@NNAVMODE=@NNAVMODE,@CARTICLECODE=@CARTICLECODE,@CPARA2CODE=@CPARA2CODE,@DTWHERE=@DTWHERE,@cLocId=@cLocId                    
ELSE    
GOTO LAST    

LBLBOM_NOTSET:
	SELECT A.article_no,A.article_name ,'BOM Not Specified' AS [Message]
	FROM ARTICLE	A
	JOIN BUYER_ORDER_DET B ON B.article_code=A.article_code
	LEFT OUTER JOIN ART_BOM C ON C.article_code=A.article_code
	WHERE C.article_code IS NULL AND B.order_id=@CMEMOID
	GROUP BY A.article_no,A.article_name,A.article_code 
	GOTO LAST    
	
LBLBOM_TOTALQTY:
    DECLARE @ORDERNO VARCHAR(100),@REFNO VARCHAR(100)
    SELECT TOP 1 @ORDERNO=order_no,@REFNO=REF_NO FROM BUYER_ORDER_MST (NOLOCK) WHERE ORDER_ID=@CMEMOID
    SELECT @ORDERNO=ISNULL(@ORDERNO,''),@REFNO=ISNULL(@REFNO,'')

	;WITH BOM_DET
	AS
	(
		SELECT article_code,bom_article_code,bom_para1_code,bom_para2_code,
		CONVERT(NUMERIC(14,3), ISNULL(avg_qty,0)+ISNULL(ADD_AVG_QTY,0)) AS QTY 
		FROM ART_BOM (NOLOCK)
	),
	BO
	AS
	(
		SELECT article_code,SUM(CONVERT(NUMERIC(14,3), ISNULL(quantity,0))) AS BO_QTY 
		FROM BUYER_ORDER_DET D (NOLOCK)
		WHERE order_id=@CMEMOID
		GROUP BY article_code
	)
	SELECT --C.bom_article_code,C.bom_para1_code,C.bom_para2_code,
	A.ARTICLE_NO,A.article_name,D.para1_name,E.para2_name, SUM(CONVERT(NUMERIC(14,3), C.QTY * B.BO_QTY)) AS QTY,F.UOM_NAME ,@ORDERNO [ORDER NO],@REFNO [REF NO]
	FROM BOM_DET C
	JOIN BO B ON B.article_code=C.article_code
	JOIN ARTICLE A (NOLOCK) ON A.ARTICLE_CODE=C.BOM_ARTICLE_CODE
	JOIN para1 D (NOLOCK) ON D.para1_code=C.bom_para1_code
	JOIN PARA2 E (NOLOCK) ON E.para2_code=C.bom_para2_code
	JOIN uom F (NOLOCK) ON F.uom_code=A.uom_code
	GROUP BY --C.bom_article_CODE,C.bom_para1_code,C.bom_para2_code,
	A.ARTICLE_NO,A.article_name,D.para1_name,E.para2_name,F.UOM_NAME
	GOTO LAST    
    
LBLNAVIGATE:    

-- SET @CCMD=N'SELECT ORDER_NO , ORDER_ID , ORDER_DT   
--			FROM BUYER_ORDER_MST (NOLOCK)     
--			WHERE FIN_YEAR ='''+ @CFINYEAR +''''

--IF @CWHERE<>'' 
--SET @CCMD=@CCMD+@CWHERE

--SET @CCMD=@CCMD+' ORDER BY ORDER_DT ASC, ORDER_NO ASC'    
--PRINT @CCMD
--EXEC SP_EXECUTESQL @CCMD    
EXECUTE SP_NAVIGATE 'BUYER_ORDER_MST',@NNAVMODE,@CMEMOID,@CFINYEAR,'ORDER_NO','ORDER_DT','ORDER_ID',@CWHERE,0 

GOTO LAST    
    
LBLGETMASTER:  
		
		SELECT  A.*, 0.00 AS TOTAL_QTY, CAST(0 AS NUMERIC(10,2)) AS TAX_PERCENTAGE, CAST(0 AS NUMERIC(10,2)) AS TAX_AMOUNT,   
		B.AC_NAME, C.DEPT_NAME,C.DEPT_ID , B.ADDRESS0,      
		B.ADDRESS1, B.ADDRESS2, B.AREA_NAME, B.CITY, B.PINCODE, B.STATE, B.SST_NO, 
		B.CITY, B.ADDRESS0 + ' ' + B.ADDRESS1 + ' ' + B.ADDRESS2 + ' ' + B.AREA_NAME + ' ' + B.CITY + ' ' + B.STATE + ' ' + B.MOBILE + ' ' AS SUPP_ADDRESS,     
		B.CREDIT_DAYS,B.DISCOUNT_PERCENTAGE AS LM_DISC_PER,
		B.SST_DT, B.TIN_NO, B.TIN_DT,D.USERNAME,E.USERNAME AS EDT_USERNAME,
		ISNULL(T4.EMP_NAME,'') AS EMP_NAME ,
		ISNULL(T5.EMP_NAME,'') AS SALE_EMP_NAME ,
		A.SALE_EMP_CODE AS SALE_EMP_CODE,
		T6.EMP_CODE AS MERCHANT_CODE, 
		T6.EMP_NAME AS MERCHANT_NAME ,
		--AR.AREA_NAME AS SHIPPING_AREA_NAME,
       -- CT.CITY AS SHIPPING_CITY_NAME,
        --ST.STATE AS SHIPPING_STATE_NAME,
        AG.ANGADIA_NAME,AG.INSURANCE_PERCENTAGE,
        LMB.AC_NAME AS BROKER_AC_NAME,CAST(0 AS INT) AS SP_ID,LF.DEPT_NAME AS WBO_FOR_DEPT_NAME
		FROM BUYER_ORDER_MST A  (NOLOCK)     
		JOIN LMV01106 B (NOLOCK)  ON A.AC_CODE = B.AC_CODE       
		JOIN USERS D  (NOLOCK)  ON A.USER_CODE = D.USER_CODE       
		JOIN USERS E (NOLOCK)  ON A.EDT_USER_CODE = E.USER_CODE       
		JOIN LOCATION C (NOLOCK)  ON A.DEPT_ID = C.DEPT_ID       
		LEFT OUTER JOIN EMPLOYEE T4 ON A.EMP_CODE= T4.EMP_CODE  
		LEFT OUTER JOIN EMPLOYEE T5 ON A.SALE_EMP_CODE= T5.EMP_CODE  
		LEFT OUTER JOIN EMPLOYEE T6 ON A.MERCHANT_CODE= T6.EMP_CODE 
		--LEFT JOIN AREA AR ON A.SHIPPING_AREA_CODE=AR.AREA_CODE
  --      LEFT JOIN CITY CT ON CT.CITY_CODE=AR.CITY_CODE
  --      LEFT JOIN STATE ST ON CT.STATE_CODE=ST.STATE_CODE
        LEFT JOIN ANGM AG ON AG.ANGADIA_CODE=A.ANGADIA_CODE 
        LEFT OUTER JOIN LMV01106 LMB ON A.BROKER_AC_CODE= LMB.AC_CODE 
        LEFT OUTER JOIN LOCATION LF (NOLOCK)  ON A.WBO_FOR_DEPT_ID = LF.DEPT_ID                
		WHERE A.ORDER_ID = @CMEMOID  
		
		
		
		
		
		
       
GOTO LAST    
    
LBLGETDETAILS:   

   -----------------CHANGE
   
   IF OBJECT_ID('TEMPDB..#TMPBO','U') IS NOT NULL
      DROP TABLE #TMPBO
   
    SELECT R.AC_CODE, B.ARTICLE_NAME,A.*,  0 AS SERIAL_NO,    
    B.ARTICLE_NO,C.PARA1_NAME,D.PARA2_NAME,D.PARA2_ORDER,C.PARA1_ORDER ,  E.PARA3_NAME,
    (A.QUANTITY * A.WS_PRICE) AS AMOUNT,B.UOM_CODE,UOM.UOM_NAME,UOM.UOM_TYPE,B.DT_CREATED  
    ,B.CODING_SCHEME,B.PARA1_SET,B.PARA2_SET, B.ALIAS AS ARTICLE_ALIAS,
    EMP.EMP_NAME AS ITEM_EMP_NAME,
    EMP1.EMP_NAME AS ITEM_MERCHANT_NAME ,
   -- ISNULL(WPS.WPS_QTY,0) AS WPS_QTY,
    SR=ROW_NUMBER() OVER (PARTITION BY A.ORDER_ID, A.ARTICLE_CODE,R.AC_CODE,A.PARA1_CODE,A.PARA2_CODE,A.PARA3_CODE,A.PARA4_CODE,A.PARA5_CODE,A.PARA6_CODE ORDER BY A. TS ),
    F.PARA4_NAME,
    G.PARA5_NAME,
    H.PARA6_NAME,sd.sub_section_name ,sm.section_name 
    INTO #TMPBO
    FROM BUYER_ORDER_DET A  (NOLOCK)   
    JOIN ARTICLE B (NOLOCK)  ON A.ARTICLE_CODE = B.ARTICLE_CODE     
    join Sectiond sd (nolock) on B.sub_section_code = sd.sub_section_code 
    join Sectionm sm (nolock) on sd.section_code = sm.section_code 
    LEFT OUTER JOIN PARA1 C (NOLOCK)  ON A.PARA1_CODE = C.PARA1_CODE      
    LEFT OUTER JOIN PARA2 D (NOLOCK)  ON A.PARA2_CODE = D.PARA2_CODE  
    LEFT OUTER JOIN PARA3 E (NOLOCK)  ON A.PARA3_CODE = E.PARA3_CODE
    LEFT OUTER JOIN PARA4 F (NOLOCK)  ON A.PARA4_CODE = F.PARA4_CODE
    LEFT OUTER JOIN PARA5 G (NOLOCK)  ON A.PARA5_CODE = G.PARA5_CODE
    LEFT OUTER JOIN PARA6 H (NOLOCK)  ON A.PARA6_CODE = H.PARA6_CODE  
    JOIN UOM (NOLOCK) ON UOM.UOM_CODE=B.UOM_CODE         
    JOIN BUYER_ORDER_MST R ON R.ORDER_ID= A.ORDER_ID 
    LEFT OUTER JOIN EMPLOYEE EMP (NOLOCK) ON EMP.EMP_CODE=A.ITEM_EMP_CODE   
    LEFT OUTER JOIN EMPLOYEE EMP1 (NOLOCK) ON EMP1.EMP_CODE=A.ITEM_MERCHANT_CODE  
    WHERE A.ORDER_ID = @CMEMOID 
    
    
    IF OBJECT_ID('TEMPDB..#TMPWSP','U') IS NOT NULL
      DROP TABLE #TMPWSP
      
     SELECT B.AC_CODE, A.ORDER_ID,A.BO_DET_ROW_ID,
     --,A.PACKSLIP_ARTICLE_CODE, A.PACKSLIP_PARA1_CODE, A.PACKSLIP_PARA2_CODE,
     SUM(QUANTITY) AS WPS_QTY
     INTO #TMPWSP
     FROM WPS_DET A
     JOIN WPS_MST B ON A.PS_ID=B.PS_ID
     WHERE B.CANCELLED=0 AND A.ORDER_ID<>''
     AND A.ORDER_ID=@CMEMOID
     GROUP BY B.AC_CODE,A.ORDER_ID,A.BO_DET_ROW_ID
     --A.PACKSLIP_ARTICLE_CODE , A.PACKSLIP_PARA1_CODE, A.PACKSLIP_PARA2_CODE
   
     SELECT A.ARTICLE_NAME,A.ORDER_ID,A.PARA1_CODE,A.PARA2_CODE,A.QUANTITY
           ,A.ROW_ID,A.LAST_UPDATE,A.WS_PRICE,A.RFNET,A.ARTICLE_CODE
           ,A.GROSS_WSP,A.DISCOUNT_PERCENTAGE,A.DISCOUNT_AMOUNT,A.REMARKS
           ,A.PRODUCT_CODE,A.MANUAL_DISCOUNT,A.PARA3_CODE,A.ONLINE_PRODUCT_CODE
           ,A.ITEM_EMP_CODE,A.ITEM_MERCHANT_CODE,A.SERIAL_NO,A.ARTICLE_NO,A.PARA1_NAME,
           A.PARA2_NAME,A.PARA2_ORDER,A.PARA1_ORDER,A.PARA3_NAME,A.AMOUNT,A.UOM_CODE,A.UOM_NAME,A.UOM_TYPE
           ,A.DT_CREATED,A.CODING_SCHEME,A.PARA1_SET,A.PARA2_SET,A.ARTICLE_ALIAS,A.ITEM_EMP_NAME,
           A.ITEM_MERCHANT_NAME,A.ADJ_QTY,A.SR_NO,A.HSN_CODE,A.GST_PERCENTAGE ,A.XN_VALUE_WITHOUT_GST ,A.XN_VALUE_WITH_GST ,
           A.IGST_AMOUNT ,A.CGST_AMOUNT ,A.SGST_AMOUNT ,
           A.SR,
           A.QUANTITY AS CUMM_SUM,
           ISNULL(WPS.WPS_QTY,0) AS WPS_QTY, (A.QUANTITY-ISNULL(WPS.WPS_QTY,0)) AS PEND_QTY,
           CASE WHEN  (A.QUANTITY-ISNULL(WPS.WPS_QTY,0)) =0 THEN 2
                WHEN  (A.QUANTITY-ISNULL(WPS.WPS_QTY,0)) >0 AND (A.QUANTITY-ISNULL(WPS.WPS_QTY,0))<> A.QUANTITY THEN 1
                ELSE 0 END AS  TYPE,
          CAST(0 AS INT) AS SP_ID,A.TS,A.GROSS_QUANTITY,A.PL_QTY,A.INV_QTY,
          A.PARA4_CODE ,A.PARA4_NAME ,
          A.PARA5_CODE ,A.PARA5_NAME ,
          A.PARA6_CODE ,A.PARA6_NAME, sub_section_name ,section_name 
		 FROM #TMPBO A
		--JOIN #TMPBO B ON A.ARTICLE_CODE=B.ARTICLE_CODE AND B.SR<=A.SR
		LEFT JOIN #TMPWSP WPS ON A.ORDER_ID=WPS.ORDER_ID
        AND A.AC_CODE=WPS.AC_CODE AND A.ROW_ID=WPS.BO_DET_ROW_ID 
        ORDER BY A.SR_NO,A.TS
   
  
GOTO LAST    
    
LBLGETPARA1LIST:    
    
 SELECT A.PARA1_CODE, A.PARA1_NAME FROM PARA1 A (NOLOCK)      
 WHERE PARA1_NAME <> '' AND INACTIVE = 0     
 ORDER BY A.PARA1_NAME     
    
GOTO LAST    
    
LBLGETPARA2LIST:    
    
 SELECT A.PARA2_CODE, A.PARA2_NAME, A.PARA2_ORDER FROM PARA2 A (NOLOCK)      
 WHERE A.PARA2_NAME <> '' AND INACTIVE = 0    
 ORDER BY A.PARA2_ORDER, A.PARA2_NAME   
    
GOTO LAST    
    
LBLGETPARA3LIST:    
    
 SELECT A.PARA3_CODE, A.PARA3_NAME FROM PARA3 A   
 WHERE A.PARA3_NAME <> '' AND INACTIVE = 0    
 ORDER BY A.PARA3_NAME    
    
GOTO LAST    
    
LBLGETPARA4LIST:    
    
 SELECT PARA4_CODE, PARA4_NAME FROM PARA4 (NOLOCK)  
 WHERE PARA4_NAME <> '' AND INACTIVE = 0     
 ORDER BY PARA4_NAME    
    
GOTO LAST    
    
LBLGETPARA5LIST:    
    
 SELECT PARA5_CODE, PARA5_NAME FROM PARA5 (NOLOCK)  
 WHERE PARA5_NAME <> ''   AND INACTIVE = 0  
 ORDER BY PARA5_NAME    
    
GOTO LAST    
    
LBLGETPARA6LIST:    
    
 SELECT PARA6_CODE, PARA6_NAME FROM PARA6 (NOLOCK)  
 WHERE PARA6_NAME <> ''   AND INACTIVE = 0  
 ORDER BY PARA6_NAME    
    
GOTO LAST    
   

LBLCUSTOMER:    
 SET  @cHeadCode	= DBO.FN_ACT_TRAVTREE ('0000000018') ----ADD VARIABLE BY GAURI ON 17/4/2019	
 SET  @cHeadCode1   = DBO.FN_ACT_TRAVTREE ('0000000001') ---ADD VARIABLE BY GAURI ON 17/4/2019

    
 SELECT  A.AC_CODE,A.HEAD_CODE,  A.AC_NAME, ISNULL(A.CREDIT_DAYS, 0) AS CREDIT_DAYS,    
    ISNULL(A.DISCOUNT_PERCENTAGE, 0) AS DISCOUNT_PERCENTAGE, A.CITY, A.ADDRESS0 + ' ' +    
    A.ADDRESS1 + ' ' + A.ADDRESS2 + ' ' + A.AREA_NAME + ' ' + A.CITY + ' ' +    
    A.STATE + ' ' + A.MOBILE + ' ' AS SUPP_ADDRESS, A.AC_NAME AS REPCOLNAME,A.DEFAULT_RATE_TYPE,
    A.BROKER_AC_CODE ,B.AC_NAME AS BROKER_AC_NAME ,A.TIN_NO,
    A.ADDRESS0,A.ADDRESS1,A.ADDRESS2,A.AREA_NAME,A.CITY,A.STATE,A.PINCODE,A.ANGADIA_CODE,A.ANGADIA_NAME
    FROM LMV01106 A (NOLOCK)  
    LEFT OUTER JOIN LMV01106 B ON A.BROKER_AC_CODE= B.AC_CODE         
    WHERE ( CHARINDEX ( A.HEAD_CODE, @cHeadCode)>0				----REPLACE VARIABLE FROM FUNCTION BY GAURI ON 17/4/2019
		   OR	CHARINDEX ( A.HEAD_CODE,@cHeadCode1)>0			----REPLACE VARIABLE FROM FUNCTION BY GAURI ON 17/4/2019
    OR A.ALLOW_CREDITOR_DEBTOR = 1 )           
    AND A.INACTIVE = 0 AND A.AC_CODE <> '0000000000' AND ISNULL(A.AC_NAME,'')<>''
    
GOTO LAST    
    
  

LBLARTICLELIST:    
   
  SELECT  A.ARTICLE_CODE, A.ARTICLE_NO, A.ARTICLE_NAME ,     
       B.SUB_SECTION_NAME,B.SUB_SECTION_CODE,C.SECTION_CODE, C.SECTION_NAME,A.DT_CREATED 
       ,A.CODING_SCHEME   ,A.PARA1_SET,A.PARA2_SET,A.ALIAS AS ARTICLE_ALIAS    
  FROM ARTICLE A (NOLOCK)   
  JOIN SECTIOND B (NOLOCK) ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE      
  JOIN SECTIONM C (NOLOCK)  ON B.SECTION_CODE = C.SECTION_CODE  
  WHERE A.ARTICLE_TYPE =1 AND ARTICLE_PRD_MODE <> 3  AND A.INACTIVE =0 
  AND ISNULL(A.ARTICLE_NO,'')<>''   AND ISNULL(C.ITEM_TYPE,1)=1 
  UNION ALL
  SELECT  A.ARTICLE_CODE, A.ALIAS AS [ARTICLE_NO], A.ARTICLE_NAME ,     
       B.SUB_SECTION_NAME,B.SUB_SECTION_CODE,C.SECTION_CODE, C.SECTION_NAME,A.DT_CREATED 
       ,A.CODING_SCHEME   ,A.PARA1_SET,A.PARA2_SET,A.ALIAS AS ARTICLE_ALIAS    
  FROM ARTICLE A (NOLOCK)   
  JOIN SECTIOND B (NOLOCK) ON A.SUB_SECTION_CODE = B.SUB_SECTION_CODE      
  JOIN SECTIONM C (NOLOCK)  ON B.SECTION_CODE = C.SECTION_CODE  
  WHERE A.ARTICLE_TYPE =1 AND ARTICLE_PRD_MODE <> 3  AND A.INACTIVE =0 
  AND ISNULL(A.ARTICLE_NO,'')<>'' AND ISNULL(A.ALIAS,'')<>''   AND ISNULL(C.ITEM_TYPE,1)=1 
  ORDER BY ARTICLE_NO  
                                    
GOTO LAST    
    
LBLARTICLEINFO:    
  
 SELECT TOP 1 @nWsPrice=sfp.fc_rate 
 FROM sku_fc_prices sfp (NOLOCK)
 JOIN location loc (NOLOCK) ON 1=1
 JOIN sku (NOLOCK) ON sku.product_code=sfp.product_code
 WHERE article_CODE=@CWHERE and loc.dept_id= @CLOCID AND sfp.fc_code=loc.fc_code      
 ORDER BY sfp.last_update DESC
 						  
 SELECT A.ARTICLE_CODE, A.ARTICLE_DESC, A.ARTICLE_NAME,   
         A.ARTICLE_NO, A.CODING_SCHEME,    
   A.PURCHASE_PRICE, (CASE WHEN ISNULL(@nWsPrice,0)<>0 THEN @nWsPrice ELSE A.MRP END) AS MRP,(CASE WHEN ISNULL(@nWsPrice,0)<>0 THEN @nWsPrice ELSE A.WHOLESALE_PRICE END) AS WS_PRICE, A.CREATED_ON,   
         A.PARA1_SET, A.PARA2_SET, B.UOM_CODE,B.UOM_NAME, B.UOM_TYPE,A.DT_CREATED,
         A.ALIAS AS ARTICLE_ALIAS   ,A.HSN_CODE 
         FROM ARTICLE A (NOLOCK)     
 JOIN UOM B (NOLOCK)  ON A.UOM_CODE = B.UOM_CODE    
 WHERE A.ARTICLE_TYPE =1 AND ARTICLE_PRD_MODE <> 3 AND  A.ARTICLE_CODE = @CWHERE  AND  A.INACTIVE =0   
   
    
GOTO LAST    
    
LBLFORMNAME:    
    
 SELECT FORM_ID, FORM_NAME, TAX_PERCENTAGE FROM FORM  (NOLOCK)      
 WHERE FORM_NAME <> ''     
 ORDER BY FORM_NAME    
     
GOTO LAST    
    
LBLARTICLESKUINFO:    
    
 SELECT TOP 1 A.PARA1_CODE, A.PARA2_CODE, A.PARA3_CODE, A.PARA4_CODE, A.PARA5_CODE,     
    A.PARA6_CODE, P1.PARA1_NAME, P2.PARA2_NAME, P3.PARA3_NAME, P4.PARA4_NAME,     
    P5.PARA5_NAME, P6.PARA6_NAME, ART.DT_CREATED AS [ART_DT_CREATED],     
    P3.DT_CREATED AS [PARA3_DT_CREATED],ISNULL(A.DT_CREATED,'''') AS [SKU_DT_CREATED],
    ART.ALIAS AS ARTICLE_ALIAS     
    FROM SKU A (NOLOCK)     
    JOIN ARTICLE ART (NOLOCK)  ON ART.ARTICLE_CODE= A.ARTICLE_CODE     
    JOIN PARA1 P1(NOLOCK)  ON A.PARA1_CODE = P1.PARA1_CODE     
    JOIN PARA2 P2(NOLOCK)  ON A.PARA2_CODE = P2.PARA2_CODE     
    JOIN PARA3 P3(NOLOCK)  ON A.PARA3_CODE = P3.PARA3_CODE     
    JOIN PARA4 P4(NOLOCK)  ON A.PARA4_CODE = P4.PARA4_CODE     
    JOIN PARA5 P5(NOLOCK)  ON A.PARA5_CODE = P5.PARA5_CODE     
    JOIN PARA6 P6(NOLOCK)  ON A.PARA6_CODE = P6.PARA6_CODE     
    WHERE A.ARTICLE_CODE = @CWHERE    
        
GOTO LAST    
    
LBLARTICLEPARA2LIST:    
   
  SELECT DISTINCT A.ARTICLE_CODE, A.PARA2_CODE, B.PARA2_NAME,B.PARA2_ORDER ,A.MRP,A.WS_PRICE 
  FROM ART_DET A (NOLOCK)     
  JOIN PARA2 B (NOLOCK)  ON A.PARA2_CODE = B.PARA2_CODE    
  WHERE A.ARTICLE_CODE = @CWHERE     
  ORDER BY B.PARA2_ORDER    
   
     
GOTO LAST    
    
LBLARTICLEPARA1LIST:    
  SELECT DISTINCT A.ARTICLE_CODE, A.PARA1_CODE, B.PARA1_NAME     
  FROM ART_PARA1 A (NOLOCK)     
  JOIN PARA1 B (NOLOCK)  ON A.PARA1_CODE = B.PARA1_CODE  
  WHERE A.ARTICLE_CODE = @CWHERE      
  ORDER BY B.PARA1_NAME     
    
GOTO LAST    
    
   
  
    
LBLGETREPORTSUMMARY:    
     SELECT T1.ORDER_DT,T1.ORDER_NO,T2.AC_NAME,T1.TOTAL_AMOUNT, 
     T1.OTHER_CHARGES AS OTHER_CHARGES,T1.DISCOUNT_AMOUNT AS MST_DISCOUNT_AMOUNT,      
     T1.SUBTOTAL AS AMOUNT_WO_TAX,PARA1.PARA1_NAME,PARA2.PARA2_NAME,PARA2.PARA2_ORDER,PARA3.PARA3_NAME, 
     PARA4.PARA4_NAME,PARA5.PARA5_NAME,PARA6.PARA6_NAME, 
     T3.*,T1.PAYMENT_DETAILS,SECTIOND.SUB_SECTION_NAME,SECTIONM.SECTION_NAME,ARTICLE.ARTICLE_NO,  
     T3.QUANTITY AS QTY  ,COM.COMPANY_CODE ,COM.LOGO_PATH,COM.COMPANY_NAME ,
     COM.ADDRESS1 AS COM_ADDRESS1,
     COM.ADDRESS2 AS COM_ADDRESS2,
     COM.CITY AS COM_CITY,
     COM.PHONES_FAX
     ,T1.TRAIL_DT,T1.DELIVERY_DT  ,T2.ADDRESS0,T2.ADDRESS1,T2.ADDRESS2,T2.AREA_NAME,T2.CITY,T2.STATE,T2.PINCODE,
	 ARTICLE.DT_CREATED, EMP.EMP_NAME,T1.REF_NO,ARTICLE.MRP,ARTICLE.WHOLESALE_PRICE,ARTICLE.PURCHASE_PRICE,
	 ARTICLE.ALIAS AS ARTICLE_ALIAS,ARTICLE.ARTICLE_NAME,T2.TIN_NO,T1.REMARKS AS MST_REMARKS,
	 SNO=ROW_NUMBER() OVER (ORDER BY T1.ORDER_DT) ,
	 (T3.QUANTITY*T3.WS_PRICE) AS AMOUNT,T3.GROSS_QUANTITY
     FROM BUYER_ORDER_MST T1      
     JOIN LMV01106 T2 ON T1.AC_CODE = T2.AC_CODE   
     JOIN BUYER_ORDER_DET T3 ON T3.ORDER_ID = T1.ORDER_ID      
     JOIN ARTICLE ON ARTICLE.ARTICLE_CODE = T3.ARTICLE_CODE      
     JOIN SECTIOND ON SECTIOND.SUB_SECTION_CODE= ARTICLE.SUB_SECTION_CODE      
     JOIN SECTIONM ON SECTIOND.SECTION_CODE = SECTIONM.SECTION_CODE      
     JOIN PARA1 ON PARA1.PARA1_CODE = T3.PARA1_CODE      
     JOIN PARA2 ON PARA2.PARA2_CODE = T3.PARA2_CODE      
     JOIN PARA3 ON PARA3.PARA3_CODE = ARTICLE.PARA3_CODE   
     JOIN PARA4 ON PARA4.PARA4_CODE = ARTICLE.PARA4_CODE   
     JOIN PARA5 ON PARA5.PARA5_CODE = ARTICLE.PARA5_CODE   
     JOIN PARA6 ON PARA6.PARA6_CODE = ARTICLE.PARA6_CODE   
     LEFT OUTER JOIN COMPANY COM ON 1=1 AND COM.COMPANY_CODE='01'   
	 LEFT OUTER JOIN EMPLOYEE EMP ON T1.EMP_CODE = EMP.EMP_CODE        
     WHERE T1.ORDER_ID=@CWHERE
    
   
     GOTO LAST   
    
    
LBLGETBOLIST:    
    
 SELECT * FROM BUYER_ORDER_MST    
     
 GOTO LAST    
  
LBLGETARTICLEINFO:  
 DECLARE @NCOUNT INT     
 SET @NCOUNT = 0   
  
   
 SELECT @NCOUNT = COUNT(*) FROM ART_DET A    
 WHERE A.ARTICLE_CODE = @CARTICLECODE AND A.PARA2_CODE = @CPARA2CODE    
       
 PRINT @NCOUNT    
       
 IF ( @NCOUNT > 0 )     
       
        
      SELECT TOP 1 A.PURCHASE_PRICE, A.MRP, A.WS_PRICE FROM ART_DET A     
      WHERE A.ARTICLE_CODE = @CARTICLECODE AND A.PARA2_CODE = @CPARA2CODE    
      
 ELSE    
      
    SELECT TOP 1 A.PURCHASE_PRICE, A.MRP, A.WHOLESALE_PRICE AS WS_PRICE  
    FROM  ARTICLE A   
    WHERE A.ARTICLE_CODE = @CARTICLECODE    
GOTO LAST

LBLMEASUREMENTDET:
	SET @CCMD = N'SELECT CONVERT(BIT,1) AS BILLCHECK,B.TMD_ROW_ID,C.ATTRIBUTE_CODE,C.ATTRIBUTE_NAME,C.ATTRIBUTE_GROUP ,B.*
		FROM ATTRM (NOLOCK) C 
		JOIN TDD01106 (NOLOCK) B ON   C.ATTRIBUTE_CODE = B.ATTRIBUTE_CODE
		JOIN BUYER_ORDER_DET (NOLOCK) A ON B.TMD_ROW_ID = A.ROW_ID
		WHERE C.ATTRIBUTE_TYPE = 5 AND C.INACTIVE = 0 
		AND A.ORDER_ID = '''+@CMEMOID+''''
		
		IF @NNAVMODE = 1
		BEGIN
			SET @CCMD = @CCMD + N' UNION
			SELECT CONVERT(BIT,CASE WHEN ISNULL(D.TMD_ROW_ID,'''') = '''' THEN 0 ELSE 1 END ) AS BILLCHECK,
			A.ROW_ID AS TMD_ROW_ID
			,C.ATTRIBUTE_CODE,C.ATTRIBUTE_NAME,C.ATTRIBUTE_GROUP
			,B.*
			FROM BUYER_ORDER_DET (NOLOCK) A 
			LEFT OUTER JOIN TDD01106 (NOLOCK) B ON B.TMD_ROW_ID = A.ROW_ID AND 1=2
			CROSS JOIN ATTRM (NOLOCK) C 
			LEFT OUTER JOIN
				(SELECT B.TMD_ROW_ID,C.ATTRIBUTE_CODE FROM ATTRM (NOLOCK) C 
				 JOIN TDD01106 (NOLOCK) B ON   C.ATTRIBUTE_CODE = B.ATTRIBUTE_CODE
				 JOIN BUYER_ORDER_DET (NOLOCK) A ON B.TMD_ROW_ID = A.ROW_ID
				 WHERE C.ATTRIBUTE_TYPE = 5 AND C.INACTIVE = 0
				 AND A.ORDER_ID = '''+@CMEMOID+''' ) D 
				 ON A.ROW_ID = D.TMD_ROW_ID AND C.ATTRIBUTE_CODE = D.ATTRIBUTE_CODE
			WHERE C.ATTRIBUTE_TYPE = 5 AND C.INACTIVE = 0  AND 
			A.ORDER_ID = '''+@CMEMOID+''' AND 
			CONVERT(BIT,CASE WHEN ISNULL(D.TMD_ROW_ID,'''') = '''' THEN 0 ELSE 1 END ) = 0'
		END
		
		
	PRINT @CCMD      
    EXECUTE SP_EXECUTESQL @CCMD     

GOTO LAST
LBLMEASUREMENTADD:
SELECT CONVERT(BIT,0) AS BILLCHECK,'' AS TMD_ROW_ID,C.ATTRIBUTE_CODE,C.ATTRIBUTE_NAME,C.ATTRIBUTE_GROUP ,B.*
		FROM ATTRM (NOLOCK) C 
		LEFT OUTER JOIN TDD01106 (NOLOCK) B ON   C.ATTRIBUTE_CODE = B.ATTRIBUTE_CODE --AND 1=2
		WHERE C.ATTRIBUTE_TYPE = 5 AND C.INACTIVE = 0
		ORDER BY C.ATTRIBUTE_ORDER
    
GOTO LAST

LBLGETLINKADV:
	SELECT CONVERT(BIT,0) AS CHK, A.ORDER_ID,B.ADV_REC_ID,C.AMOUNT,A.ORDER_NO,C.ADV_REC_NO ,A.CUSTOMER_CODE,A.AC_CODE 
	FROM BUYER_ORDER_MST A (NOLOCK)
	JOIN WSL_ORDER_ADV_RECEIPT B (NOLOCK) ON A.ORDER_ID = B.ORDER_ID 
	JOIN ARC01106 C (NOLOCK) ON B.ADV_REC_ID = C.ADV_REC_ID 
	WHERE A.CANCELLED = 1 AND (A.CUSTOMER_CODE = @CWHERE OR A.AC_CODE = @CWHERE )

	UNION ALL

	SELECT CONVERT(BIT,0) AS CHK,'' AS ORDER_ID,C.ADV_REC_ID,C.AMOUNT,'' AS ORDER_NO,C.ADV_REC_NO ,C.CUSTOMER_CODE,C.AC_CODE 
	FROM ARC01106 C (NOLOCK)
	LEFT OUTER JOIN WSL_ORDER_ADV_RECEIPT B (NOLOCK) ON C.ADV_REC_ID = B.ADV_REC_ID
	WHERE C.ARCT<> 1 AND C.CANCELLED = 0 AND  ISNULL(B.ADV_REC_ID,'') = '' AND (C.CUSTOMER_CODE = @CWHERE OR C.AC_CODE = @CWHERE )
GOTO LAST

LBLGETSALEPERSON:
	SELECT * FROM EMPLOYEE WHERE EMP_CODE <> '0000000' AND INACTIVE = 0
GOTO LAST

LBLBOMDET:
		SELECT A.*,D.QUANTITY,A.CONS_QTY_PER_PICE * D.QUANTITY AS TOTAL_QTY,ART.ARTICLE_NO,S.MRP 
		FROM WSL_ORDER_BOM A (NOLOCK) 
		JOIN BUYER_ORDER_DET D (NOLOCK) ON A.REF_ROW_ID = D.ROW_ID
		JOIN BUYER_ORDER_MST M (NOLOCK) ON D.ORDER_ID = M.ORDER_ID 
		JOIN SKU S (NOLOCK) ON S.PRODUCT_CODE = A.PRODUCT_CODE
		JOIN ARTICLE ART (NOLOCK) ON ART.ARTICLE_CODE = S.ARTICLE_CODE 
		WHERE M.ORDER_ID = @CMEMOID
    
GOTO LAST

LBLBOMPRODUCTDET:
		SELECT TOP 1 A.PRODUCT_CODE,A.ARTICLE_CODE,ART.ARTICLE_NO, ART.DT_CREATED AS [ART_DT_CREATED], 
		P3.DT_CREATED AS [PARA3_DT_CREATED],ISNULL(A.DT_CREATED,'') AS [SKU_DT_CREATED],A.WS_PRICE,A.PURCHASE_PRICE,
		A.MRP,ART.ARTICLE_TYPE,ART.ALIAS AS ARTICLE_ALIAS  
		FROM SKU A (NOLOCK) 
		JOIN ARTICLE (NOLOCK) ART ON ART.ARTICLE_CODE= A.ARTICLE_CODE 
		JOIN PARA1 (NOLOCK) P1 ON A.PARA1_CODE = P1.PARA1_CODE 
		JOIN PARA2 (NOLOCK) P2 ON A.PARA2_CODE = P2.PARA2_CODE 
		JOIN PARA3 (NOLOCK) P3 ON A.PARA3_CODE = P3.PARA3_CODE 
		JOIN PARA4 (NOLOCK) P4 ON A.PARA4_CODE = P4.PARA4_CODE 
		JOIN PARA5 (NOLOCK) P5 ON A.PARA5_CODE = P5.PARA5_CODE 
		JOIN PARA6 (NOLOCK) P6 ON A.PARA6_CODE = P6.PARA6_CODE 
		WHERE A.PRODUCT_CODE =  @CWHERE AND ART.ARTICLE_TYPE = 2
GOTO LAST

LBLGETTRIALDATA:

	SELECT 0 AS CHK_SMS,A.ORDER_NO,A.ORDER_ID,CONVERT(VARCHAR(15),A.ORDER_DT,105) AS ORDER_DT,A.REF_NO
	,CONVERT(VARCHAR(15),A.TRAIL_DT,105) AS TRIAL_DT
	,(CASE WHEN A.AC_CODE='0000000000' 
	THEN (C.CUSTOMER_FNAME + ' ' + ISNULL(C.CUSTOMER_LNAME,'')) ELSE B.AC_NAME END) AS CUSTOMER_NAME
	,CONVERT(VARCHAR(15),A.DELIVERY_DT,105) AS DELIVERY_DT 
	FROM BUYER_ORDER_MST A 
	JOIN LMV01106 B ON A.AC_CODE = B.AC_CODE 
	JOIN SKU_BO SBO ON SBO.ORDER_ID = A.ORDER_ID
	JOIN CUSTDYM C ON A.CUSTOMER_CODE = C.CUSTOMER_CODE 
	LEFT OUTER JOIN
	(
	SELECT TOP 1 ORDER_ID FROM SKU_BO A 
	JOIN CMD01106 B ON A.PRODUCT_CODE= B.PRODUCT_CODE 
	JOIN CMM01106 C ON B.CM_ID = C.CM_ID WHERE C.CANCELLED = 0
	) DET ON A.ORDER_ID = DET.ORDER_ID
	WHERE A.CANCELLED = 0 AND A.APPROVED=1 
	AND DET.ORDER_ID IS NULL
	AND CONVERT(VARCHAR(15),TRAIL_DT,101) <= @DTWHERE
	
    GOTO LAST
	 
LBLGETDELIVERYDATA:
	
	SELECT 0 AS CHK_SMS,A.ORDER_NO,A.ORDER_ID,CONVERT(VARCHAR(15),A.ORDER_DT,105) AS ORDER_DT,A.REF_NO
	,CONVERT(VARCHAR(15),A.TRAIL_DT,105) AS TRIAL_DT
	,(CASE WHEN A.AC_CODE='0000000000' 
	THEN (C.CUSTOMER_FNAME + ' ' + ISNULL(C.CUSTOMER_LNAME,'')) ELSE B.AC_NAME END) AS CUSTOMER_NAME
	,CONVERT(VARCHAR(15),A.DELIVERY_DT,105) AS DELIVERY_DT 
	FROM BUYER_ORDER_MST A 
	JOIN LMV01106 B ON A.AC_CODE = B.AC_CODE 
	JOIN SKU_BO SBO ON SBO.ORDER_ID = A.ORDER_ID
	JOIN CUSTDYM C ON A.CUSTOMER_CODE = C.CUSTOMER_CODE 
	LEFT OUTER JOIN
	(
		 SELECT TOP 1 ORDER_ID FROM SKU_BO A 
		 JOIN CMD01106 B ON A.PRODUCT_CODE= B.PRODUCT_CODE 
		 JOIN CMM01106 C ON B.CM_ID = C.CM_ID WHERE C.CANCELLED = 0
	)DET ON A.ORDER_ID = DET.ORDER_ID
	WHERE A.CANCELLED = 0 
	AND A.APPROVED=1
	AND DET.ORDER_ID IS NULL 
	AND CONVERT(VARCHAR(15),DELIVERY_DT,101) <= @DTWHERE

GOTO LAST

LBLGETARTPARASSTOCK:
DECLARE @DTSQL NVARCHAR(MAX),@CCOLS NVARCHAR(MAX),@CDEPT_ID VARCHAR(2)


IF OBJECT_ID('TEMPDB..#ARTPARAS','U') IS NOT NULL
	DROP TABLE #ARTPARAS
	
IF OBJECT_ID('TEMPDB..#ARTPARAS_DUP','U') IS NOT NULL
	DROP TABLE #ARTPARAS_DUP	

IF OBJECT_ID('TEMPDB..#SIZES','U') IS NOT NULL
	DROP TABLE #SIZES

IF OBJECT_ID('TEMPDB..#PICKLIST_QTY','U') IS NOT NULL
	DROP TABLE #PICKLIST_QTY

--SET @CARTICLECODE='010000008'
SELECT X.ARTICLE_CODE,X.PARA1_CODE,X.PARA2_CODE
	  ,SUM(X.PICK_LIST_QTY+X.ADD_QTY-ISNULL(Y.QTY,0)) AS PICKLIST_QTY
INTO #PICKLIST_QTY	  
FROM WSL_PICKLIST_DET X
LEFT OUTER JOIN 
(
	SELECT A.ROW_ID AS PICKLIST_ROW_ID,SUM(B.QUANTITY) AS QTY 
	FROM WSL_PICKLIST_DET A 
    JOIN IND01106 B ON A.PICK_LIST_ID=B.PICK_LIST_ID AND A.ARTICLE_CODE=B.PICKLIST_ARTICLE_CODE
	AND A.PARA1_CODE=B.PICKLIST_PARA1_CODE AND A.PARA2_CODE=B.PICKLIST_PARA2_CODE
	JOIN INM01106 C ON B.INV_ID = C.INV_ID
	WHERE C.CANCELLED = 0 
	GROUP BY A.ROW_ID
)Y ON X.ROW_ID = Y.PICKLIST_ROW_ID
JOIN WSL_PICKLIST_MST Z ON X.PICK_LIST_ID = Z.PICK_LIST_ID
WHERE Z.CANCELLED = 0 AND X.PICK_LIST_QTY+X.ADD_QTY > ISNULL(Y.QTY,0)
AND X.ARTICLE_CODE=@CARTICLECODE
GROUP BY X.ARTICLE_CODE,X.PARA1_CODE,X.PARA2_CODE

SELECT AP.ARTICLE_CODE,P1.PARA1_CODE,P1.PARA1_NAME,P2.PARA2_ORDER,P2.PARA2_NAME
,SUM(ISNULL(P.QUANTITY_IN_STOCK,0))-ISNULL(PQ.PICKLIST_QTY,0) AS QUANTITY
INTO #ARTPARAS
FROM 
(
	---CARTESIAN PRODUCT OF MATCHING ARTICLES 
	SELECT DISTINCT AP1.ARTICLE_CODE,AP1.PARA1_CODE,AP2.PARA2_CODE
	FROM ART_PARA1 AP1(NOLOCK)
	JOIN ART_DET AP2(NOLOCK) ON AP1.ARTICLE_CODE=AP2.ARTICLE_CODE
	WHERE AP1.ARTICLE_CODE=@CARTICLECODE
	UNION
	---DETAILS FOR MISSING ARTICLES IN ART_DET
	SELECT DISTINCT AP1.ARTICLE_CODE,AP1.PARA1_CODE,'0000000' AS PARA2_CODE
	FROM ART_PARA1 AP1(NOLOCK)
	LEFT JOIN ART_DET AP2(NOLOCK) ON AP1.ARTICLE_CODE=AP2.ARTICLE_CODE
	WHERE AP2.ARTICLE_CODE IS NULL AND AP1.ARTICLE_CODE=@CARTICLECODE
	UNION
	---DETAILS FOR MISSING ARTICLES IN ART_PARA1
	SELECT DISTINCT AP2.ARTICLE_CODE,'0000000' AS PARA1_CODE,AP2.PARA2_CODE
	FROM ART_DET AP2(NOLOCK)
	LEFT JOIN ART_PARA1 AP1(NOLOCK) ON AP1.ARTICLE_CODE=AP2.ARTICLE_CODE
	WHERE AP1.ARTICLE_CODE IS NULL AND AP2.ARTICLE_CODE=@CARTICLECODE
)AP
JOIN PARA1 P1(NOLOCK) ON P1.PARA1_CODE=AP.PARA1_CODE
JOIN PARA2 P2(NOLOCK) ON P2.PARA2_CODE=AP.PARA2_CODE
LEFT JOIN SKU S(NOLOCK) ON S.ARTICLE_CODE=AP.ARTICLE_CODE AND S.PARA1_CODE=AP.PARA1_CODE AND S.PARA2_CODE=AP.PARA2_CODE
LEFT JOIN PMT01106 P(NOLOCK) ON S.PRODUCT_CODE=P.PRODUCT_CODE AND P.DEPT_ID=@CDEPT_ID
LEFT JOIN #PICKLIST_QTY PQ ON AP.ARTICLE_CODE=PQ.ARTICLE_CODE AND AP.PARA1_CODE=PQ.PARA1_CODE AND AP.PARA2_CODE=PQ.PARA2_CODE
GROUP BY AP.ARTICLE_CODE,P1.PARA1_CODE,P1.PARA1_NAME,P2.PARA2_ORDER,P2.PARA2_NAME,ISNULL(PQ.PICKLIST_QTY,0)

--SELECT * FROM #ARTPARAS 
SELECT DISTINCT UPPER(PARA2_NAME) AS PARA2_NAME ,PARA2_ORDER INTO #SIZES FROM #ARTPARAS  

ALTER TABLE #ARTPARAS DROP COLUMN PARA2_ORDER 

SELECT @CCOLS=ISNULL(@CCOLS+',','')+QUOTENAME(PARA2_NAME)
FROM #SIZES
ORDER BY PARA2_ORDER ASC
--SELECT @CCOLS

SELECT * INTO #ARTPARAS_DUP FROM #ARTPARAS
UPDATE #ARTPARAS_DUP SET QUANTITY=0

SET @DTSQL=N'SELECT PARA1_CODE AS COLOR_CODE,PARA1_NAME AS COLOR,CAST(0 AS NUMERIC(14,2)) AS TOTAL,'+@CCOLS+',0 AS IS_ENTRYCOL ,CAST(0 AS BIT) AS IS_MANUAL 
			 FROM #ARTPARAS 
			 PIVOT(SUM(QUANTITY) FOR PARA2_NAME IN ('+@CCOLS+')) AS PTABLE
			 UNION ALL
			 SELECT PARA1_CODE AS COLOR_CODE,PARA1_NAME AS COLOR,CAST(0 AS NUMERIC(14,2)) AS TOTAL,'+@CCOLS+',1 AS IS_ENTRYCOL  ,CAST(0 AS BIT) AS IS_MANUAL 
			 FROM #ARTPARAS_DUP 
			 PIVOT(SUM(QUANTITY) FOR PARA2_NAME IN ('+@CCOLS+')) AS PTABLE
			 ORDER BY PARA1_NAME,IS_ENTRYCOL ASC'
PRINT @DTSQL
EXEC SP_EXECUTESQL @DTSQL			 

GOTO LAST

LBLPRODUCTINFO:
 
 
 SELECT TOP 1 @nWsPrice=sfp.fc_rate 
 FROM sku_fc_prices sfp (NOLOCK)
 JOIN location loc (NOLOCK) ON 1=1
 JOIN sku (NOLOCK) ON sku.product_code=sfp.product_code
 WHERE sku.PRODUCT_CODE = @CWHERE and loc.dept_id= @CLOCID AND sfp.fc_code=loc.fc_code      
 ORDER BY sfp.last_update DESC
 
 SELECT A.ARTICLE_CODE, A.ARTICLE_DESC, A.ARTICLE_NAME,   
         A.ARTICLE_NO, A.CODING_SCHEME,    
   A.PURCHASE_PRICE, (CASE WHEN ISNULL(@nWsPrice,0)<>0 THEN @nWsPrice ELSE A.MRP END) AS MRP, 
   (CASE WHEN ISNULL(@nWsPrice,0)<>0 THEN @nWsPrice ELSE A.WHOLESALE_PRICE END) AS WS_PRICE, A.CREATED_ON,   
         A.PARA1_SET, A.PARA2_SET, B.UOM_CODE,B.UOM_NAME, B.UOM_TYPE,A.DT_CREATED,
         A.ALIAS AS ARTICLE_ALIAS   ,A.HSN_CODE ,S.product_code,P.para1_code ,P2.para2_code ,p.para1_name ,p2.para2_name  
         FROM  SKU S  (NOLOCK)
         JOIN  ARTICLE A (NOLOCK)   ON S.Article_code= A.Article_code  
         JOIN PARA1 P (NOLOCK) on S.para1_code = P.para1_code  
         JOIN PARA2 P2 (NOLOCK) on S.para2_code = P2.para2_code  
 JOIN UOM B (NOLOCK)  ON A.UOM_CODE = B.UOM_CODE    
 WHERE A.ARTICLE_TYPE =1 AND ARTICLE_PRD_MODE <> 3 AND  S.PRODUCT_CODE = @CWHERE  AND  A.INACTIVE =0   

GOTO LAST

LAST:   
  
END
*/