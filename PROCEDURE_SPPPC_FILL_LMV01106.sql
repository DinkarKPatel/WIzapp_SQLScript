CREATE PROCEDURE [DBO].[SPPPC_FILL_LMV01106]  
(  
 @NQUERYID   INT,    
 @VPARAMETER  VARCHAR(500)  
)  
AS      
BEGIN   
  
 DECLARE @CSTEP INT, @CCMD NVARCHAR(MAX), @ERRMSG_OUT VARCHAR(MAX),@cHEAD_CODE VARCHAR(MAX),@cHEAD_CODE1 VARCHAR(MAX)  
 BEGIN TRY  
  SET NOCOUNT ON;  
    
  SET @ERRMSG_OUT = ''  
    
  IF @NQUERYID = 1  
   -- GET LEDGER LIST  
   GOTO LBLGETLEDGERLIST  
  ELSE IF @NQUERYID = 2  
   -- GET LEDGER USING LIKE  
   GOTO LBLGETLEDGERLIKE  
    
  ELSE IF @NQUERYID = 7  
   -- GET LEDGER INFO BY NAME  
   GOTO LBLGETLEDGERINFOBYNAME  
  
  ELSE  
   GOTO LAST  
  
-- GET LEDGER LIST  
LBLGETLEDGERLIST:

  SET @cHEAD_CODE  = DBO.FN_ACT_TRAVTREE ('0000000018') ----ADD VARIABLE BY GAURI ON 17/4/2019
  SET @cHEAD_CODE1 = DBO.FN_ACT_TRAVTREE ('0000000001')	----ADD VARIABLE BY GAURI ON 17/4/2019
  
  SET @CSTEP = 101  
  SELECT A.AC_CODE, A.AC_NAME  
  FROM LMV01106 A (NOLOCK)             
  WHERE ( CHARINDEX ( HEAD_CODE, @cHEAD_CODE)>0   ----REPLACE VARIABLE FROM FUNCTION BY GAURI ON 17/4/2019 
  OR CHARINDEX ( HEAD_CODE, @cHEAD_CODE1)>0       ----REPLACE VARIABLE FROM FUNCTION BY GAURI ON 17/4/2019 
  OR ALLOW_CREDITOR_DEBTOR = 1 )             
  AND INACTIVE = 0 AND A.AC_CODE <> '0000000000' AND ISNULL(A.AC_NAME,'')<>''  
  ORDER BY A.AC_NAME  
    
  GOTO LAST  
  
  
-- GET LEDGER USING LIKE  
LBLGETLEDGERLIKE:  
  SET @CSTEP = 102  
  SELECT TOP 10 A.AC_CODE, A.AC_NAME  
  FROM LMV01106 A (NOLOCK)             
  WHERE ( CHARINDEX ( HEAD_CODE, @cHEAD_CODE)>0 ----REPLACE VARIABLE FROM FUNCTION BY GAURI ON 17/4/2019   
  OR CHARINDEX ( HEAD_CODE, @cHEAD_CODE1)>0     ----REPLACE VARIABLE FROM FUNCTION BY GAURI ON 17/4/2019
  OR ALLOW_CREDITOR_DEBTOR = 1 )             
  AND INACTIVE = 0 AND A.AC_CODE <> '0000000000' AND ISNULL(A.AC_NAME,'')<>''  
  AND A.AC_NAME LIKE '%'+ @VPARAMETER +'%'  
  ORDER BY A.AC_NAME  
    
  GOTO LAST  
  
  
-- GET LEDGER INFO BY NAME  
LBLGETLEDGERINFOBYNAME:  
  SET @CSTEP = 107  
  SELECT  A.AC_CODE, A.HEAD_CODE, A.AC_NAME, ISNULL(A.CREDIT_DAYS, 0) AS CREDIT_DAYS, ISNULL(A.DISCOUNT_PERCENTAGE, 0) AS DISCOUNT_PERCENTAGE,   
      ISNULL(A.CITY, '') AS CITY, ISNULL(A.ADDRESS0, '') + ' ' + ISNULL(A.ADDRESS1, '') + ' ' + ISNULL(A.ADDRESS2, '') + ' ' + ISNULL(A.AREA_NAME, '') + ' ' + ISNULL(A.CITY, '')   
      + ' ' + ISNULL(A.[STATE], '') + ' ' + ISNULL(A.MOBILE, '') AS SUPP_ADDRESS,   
      A.AC_NAME AS REPCOLNAME, ISNULL(A.DEFAULT_RATE_TYPE, 0) AS DEFAULT_RATE_TYPE, ISNULL(A.DISCOUNT_PERCENTAGE, 0.00) AS DISCOUNT_PERCENTAGE  
  FROM LMV01106 A (NOLOCK)             
  WHERE ( CHARINDEX ( HEAD_CODE,@cHEAD_CODE)>0  ----REPLACE VARIABLE FROM FUNCTION BY GAURI ON 17/4/2019  
  OR CHARINDEX ( HEAD_CODE, @cHEAD_CODE1)>0     ----REPLACE VARIABLE FROM FUNCTION BY GAURI ON 17/4/2019 
  OR ALLOW_CREDITOR_DEBTOR = 1 )             
  AND INACTIVE = 0 AND A.AC_CODE <> '0000000000' AND ISNULL(A.AC_NAME,'')<>''  
  AND A.AC_NAME = @VPARAMETER  
    
  GOTO LAST  
    
LAST:     
 GOTO END_PROC  
  
  SET NOCOUNT OFF;  
 END TRY    
 BEGIN CATCH    
  SET @ERRMSG_OUT='ERROR: [P]: SPPPC_FILL_LMV01106, [STEP]: '+CAST(@CSTEP AS VARCHAR(5))+', [MESSAGE]: ' + ERROR_MESSAGE()  
  GOTO END_PROC    
 END CATCH     
  
END_PROC:    
 IF  ISNULL(@ERRMSG_OUT,'')<>''   
  SELECT @ERRMSG_OUT AS ERRORMSG  
END
