CREATE PROCEDURE SP_GETUPDATEINSERTSTR 
@CTABLENAME VARCHAR(100),
@CKEYFIELD1 VARCHAR(100),
@CKEYFIELD2 VARCHAR(100)='',
@CKEYFIELD3 VARCHAR(100)='',
@CUPDATESTR VARCHAR(MAX) OUTPUT,
@CINSERTSTR VARCHAR(MAX) OUTPUT,
@CINSERTSTRVALUE VARCHAR(MAX) OUTPUT
--WITH ENCRYPTION
AS
BEGIN
	SET NOCOUNT ON

	DECLARE @CCMD NVARCHAR(MAX),@CMIRRORTABLENAME VARCHAR(400)
	
	IF OBJECT_ID('TEMPDB..#TTARGETCOL','U') IS NOT NULL
		DROP TABLE #TTARGETCOL
	
	CREATE TABLE #TTARGETCOL (COLNAME VARCHAR(100),COLTYPE VARCHAR(20),SOURCECOLNAME VARCHAR(100),ISNULLABLE BIT)
	
		
	
	SET @CCMD = 'SELECT A.NAME AS COLNAME, B.NAME AS COLTYPE,A.NAME AS SOURCECOLNAME,A.ISNULLABLE 
				 FROM SYSCOLUMNS A 
				 JOIN SYSTYPES B ON A.XTYPE = B.XTYPE  AND B.NAME<>''SYSNAME''
				 LEFT OUTER JOIN SYS.IDENTITY_COLUMNS C ON C.OBJECT_ID=A.ID AND C.NAME=A.NAME				 
				 WHERE A.ID = OBJECT_ID('''+@CTABLENAME+''')
				 AND   A.NAME <> ''TS'' AND C.OBJECT_ID IS NULL'
	INSERT #TTARGETCOL
	EXEC SP_EXECUTESQL @CCMD		
	
--	PRINT '3'
	EXEC SP_UPDATECOLUMNLIST @CTABLENAME, @CKEYFIELD1, @CKEYFIELD2, @CKEYFIELD3, 1,'',@CUPDATESTR OUTPUT 
	
	EXEC SP_INSERTCOLUMNLIST @CTABLENAME,1,'',@CINSERTSTR OUTPUT, @CINSERTSTRVALUE OUTPUT, 'B'
	
END
--*************************************** END OF PROCEDURE SP_GETUPDATEINSERTSTR
