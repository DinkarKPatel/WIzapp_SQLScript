CREATE VIEW VW_WL_CASHMEMOLIST

AS
SELECT  D.USER_CUSTOMER_CODE AS CUSTOMER_ID,
		D.CUSTOMER_FNAME+' '+D.CUSTOMER_LNAME AS CUSTOMER_NAME,
		MST.CM_NO AS MEMO_NO,
		MST.CM_DT AS MEMO_DT,
		MST.SUBTOTAL ,
		MST.DISCOUNT_PERCENTAGE AS BILL_DISCOUNT_PERCENTAGE,
		MST.DISCOUNT_AMOUNT AS BILL_DISCOUNT_AMOUNT,
		MST.REMARKS, 
		E.USERNAME ,
		ISNULL(B.TOTAL_QUANTITY,0) AS TOTAL_QUANTITY,
		ISNULL(B.GROSS_SALE_VALUE,0) AS GROSS_SALE_VALUE,
		ISNULL(B.TOTAL_DISCOUNT_AMOUNT,0) AS TOTAL_DISCOUNT_AMOUNT,
		ISNULL(B.ITEM_DISCOUNT_AMOUNT,0) AS ITEM_DISCOUNT_AMOUNT,
		MST.NET_AMOUNT AS NET_SALE_VALUE,PAYDET.*	
		
FROM CMM01106 MST
LEFT OUTER JOIN
(SELECT A.CM_ID,SUM(A.QUANTITY) AS TOTAL_QUANTITY,
		SUM(A.MRP*A.QUANTITY) AS GROSS_SALE_VALUE,
		SUM((A.MRP*A.QUANTITY)-B.NET2) AS TOTAL_DISCOUNT_AMOUNT,
		SUM(A.DISCOUNT_AMOUNT) AS ITEM_DISCOUNT_AMOUNT FROM CMD01106 A
		JOIN CMV01106 B ON A.CM_ID=B.CM_ID GROUP BY A.CM_ID)
B ON B.CM_ID=MST.CM_ID
JOIN CUSTDYM D ON D.CUSTOMER_CODE=MST.CUSTOMER_CODE 
JOIN USERS E ON E.USER_CODE = MST.USER_CODE
LEFT OUTER JOIN VW_PAYMODEXNDET PAYDET ON PAYDET.MEMO_ID=MST.CM_ID AND PAYDET.XN_TYPE='SLS'
WHERE MST.MEMO_TYPE=1
