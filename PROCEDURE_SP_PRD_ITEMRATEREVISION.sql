CREATE PROCEDURE SP_PRD_ITEMRATEREVISION    
@NQUERYID NUMERIC(3,0),        
@CMEMO VARCHAR(50)='',
@CFINYEAR VARCHAR(5) ,
@CWHERE VARCHAR(50)='',
@NNAVMODE NUMERIC(1,0)
--WITH ENCRYPTION   
AS
BEGIN        
  
IF @NQUERYID=1     
   GOTO LBLNAVIGATE   
ELSE IF @NQUERYID=2    
   GOTO LBLMASTER           
ELSE IF @NQUERYID=3    
   GOTO LBLDETAIL
ELSE IF @NQUERYID=4    
   GOTO LBLARTICLE  
ELSE IF @NQUERYID=5  
  GOTO LBLPARA 
ELSE IF @NQUERYID=6  
  GOTO LBLSCAN 
ELSE IF @NQUERYID=7  
  GOTO LBLPREFIX  
ELSE IF @NQUERYID =8
  GOTO LBLMASTERCOL  
ELSE IF @NQUERYID =9
  GOTO  LBLTMASTER 
ELSE IF @NQUERYID =10
  GOTO  LBLTATTR 
ELSE IF @NQUERYID =11
  GOTO  LBLMEMOATTR 
ELSE IF @NQUERYID =12
  GOTO  LBLATTRLIST       
ELSE   
 GOTO LAST  
             
LBLNAVIGATE:  -- CREATING LOOK UP TABLE 
            
	 EXEC SP_NAVIGATE 'PRD_IRM01106',@NNAVMODE,@CMEMO,@CFINYEAR,'IRM_MEMO_NO','IRM_MEMO_DT','IRM_MEMO_ID',@CWHERE        
               
	 GOTO LAST                        
                               
           
LBLMASTER:  
  
	  SELECT A.*,B.USERNAME ,B1.BIN_NAME
	  FROM PRD_IRM01106 A (NOLOCK)   
	  JOIN USERS B (NOLOCK) ON A.USER_CODE= B.USER_CODE  
	  JOIN BIN B1 (NOLOCK) ON A.BIN_ID= B1.BIN_ID
	  WHERE A.IRM_MEMO_ID= @CMEMO  
	     
	  GOTO LAST    
          
LBLDETAIL:    
     
      
	  SELECT A.*,ARTICLE.ARTICLE_NO ,ARTICLE.ARTICLE_NAME,PARA1.PARA1_NAME,PARA2.PARA2_NAME,
	         PARA3.PARA3_NAME,PARA4.PARA4_NAME,PARA5.PARA5_NAME,PARA6.PARA6_NAME,UOM.UOM_NAME,
	         OA.ARTICLE_NO AS OLD_ARTICLE_NO,OP1.PARA1_NAME AS OLD_PARA1_NAME ,
	         OP2.PARA2_NAME AS OLD_PARA2_NAME ,OP3.PARA3_NAME AS OLD_PARA3_NAME ,
	         OP4.PARA4_NAME AS OLD_PARA4_NAME,OP5.PARA5_NAME AS OLD_PARA5_NAME,
	         OP6.PARA6_NAME AS OLD_PARA6_NAME,SECTIOND.SUB_SECTION_NAME ,SECTIONM.SECTION_NAME,
	         SECTIOND.SUB_SECTION_CODE ,SECTIONM.SECTION_CODE,
	         ARTICLE.CODING_SCHEME AS CODING_SCHEME,
	         SKU.PURCHASE_PRICE,0 AS FIX_MRP,'' AS PRODUCT_NAME ,
	         ARTICLE.DT_CREATED AS [ART_DT_CREATED],PARA3.DT_CREATED AS [PARA3_DT_CREATED],
	         SKU.DT_CREATED AS [SKU_DT_CREATED] , LM.AC_NAME, 
             SKU.INV_DT ,SKU.RECEIPT_DT  ,B1.BIN_NAME,ARTICLE.ALIAS AS ARTICLE_ALIAS
            ,'' AS ONLINE_BAR_CODE,'' AS ONLINE_PRODUCT_CODE
	        
	  FROM PRD_IRD01106 A (NOLOCK)   
	  JOIN PRD_IRM01106 B ON A.IRM_MEMO_ID= B.IRM_MEMO_ID 
	  JOIN PRD_SKU SKU ON A.PRODUCT_UID = SKU.PRODUCT_UID 
	  JOIN ARTICLE  (NOLOCK) ON A.ARTICLE_CODE= ARTICLE.ARTICLE_CODE
	  JOIN SECTIOND  (NOLOCK) ON ARTICLE.SUB_SECTION_CODE= SECTIOND.SUB_SECTION_CODE   
	  JOIN SECTIONM  (NOLOCK) ON SECTIOND.SECTION_CODE= SECTIONM.SECTION_CODE   
	  JOIN PARA1  (NOLOCK) ON A.PARA1_CODE= PARA1.PARA1_CODE   
	  JOIN PARA2  (NOLOCK) ON A.PARA2_CODE= PARA2.PARA2_CODE 
	  JOIN PARA3  (NOLOCK) ON A.PARA3_CODE= PARA3.PARA3_CODE   
	  JOIN PARA4  (NOLOCK) ON A.PARA4_CODE= PARA4.PARA4_CODE 
	  JOIN PARA5  (NOLOCK) ON A.PARA5_CODE= PARA5.PARA5_CODE   
	  JOIN PARA6  (NOLOCK) ON A.PARA6_CODE= PARA6.PARA6_CODE 
	  JOIN UOM  (NOLOCK) ON ARTICLE.UOM_CODE= UOM.UOM_CODE 
	  
	  JOIN ARTICLE OA (NOLOCK) ON A.OLD_ARTICLE_CODE= OA.ARTICLE_CODE   
	  JOIN SECTIOND OS (NOLOCK) ON OA.SUB_SECTION_CODE= OS .SUB_SECTION_CODE   
	  JOIN SECTIONM OSM (NOLOCK) ON OS.SECTION_CODE= OSM.SECTION_CODE   
	  JOIN PARA1 OP1 (NOLOCK) ON A.OLD_PARA1_CODE= OP1.PARA1_CODE
	  JOIN PARA2 OP2 (NOLOCK) ON A.OLD_PARA2_CODE= OP2.PARA2_CODE 
	  JOIN PARA3 OP3 (NOLOCK) ON A.OLD_PARA3_CODE= OP3.PARA3_CODE  
	  JOIN PARA4 OP4 (NOLOCK) ON A.OLD_PARA4_CODE= OP4.PARA4_CODE 
	  JOIN PARA5 OP5 (NOLOCK) ON A.OLD_PARA5_CODE= OP5.PARA5_CODE
	  JOIN PARA6 OP6 (NOLOCK) ON A.OLD_PARA6_CODE= OP6.PARA6_CODE 
	  JOIN LM01106 LM (NOLOCK) ON LM.AC_CODE = SKU.AC_CODE         
	  JOIN BIN B1 (NOLOCK) ON B1.BIN_ID=ISNULL(A.BIN_ID,'000')	 		          
	  WHERE A.IRM_MEMO_ID= @CMEMO  
	  ORDER BY A.SRNO
    
     
 GOTO LAST         
    
  LBLARTICLE:
  
    SELECT ARTICLE_CODE,ARTICLE_NO,ARTICLE_NAME,CODING_SCHEME
    FROM ARTICLE (NOLOCK) WHERE ARTICLE_NO <> '' AND INACTIVE =0
	AND  CODING_SCHEME<>1 AND 1=2
	
    GOTO LAST 
    
 LBLPARA:
    
    SELECT PARA1_CODE, PARA1_NAME FROM PARA1 (NOLOCK) WHERE PARA1_NAME <> '' AND 1=2   
    SELECT PARA2_CODE, PARA2_NAME FROM PARA2 (NOLOCK) WHERE PARA2_NAME <> '' AND 1=2   
    SELECT PARA3_CODE, PARA3_NAME FROM PARA3 (NOLOCK) WHERE PARA3_NAME <> '' AND 1=2  
    SELECT PARA4_CODE, PARA4_NAME FROM PARA4 (NOLOCK) WHERE PARA4_NAME <> '' AND 1=2
    SELECT PARA5_CODE, PARA5_NAME FROM PARA5 (NOLOCK) WHERE PARA5_NAME <> '' AND 1=2
    SELECT PARA6_CODE, PARA6_NAME FROM PARA6 (NOLOCK) WHERE PARA6_NAME <> '' AND 1=2

    GOTO LAST  
    
  LBLSCAN:
    
         EXEC SP_PRD_CHECKSTOCKNEW @CWHERE,0,'',''
    
         GOTO LAST  
         
   LBLPREFIX:
        
         SELECT * FROM BARCODE_PREFIX  
          
    GOTO LAST  
    
    
    LBLMASTERCOL:
    
		SELECT 'SECTION NAME' AS MASTER_COL,'SECTION_NAME' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		UNION ALL
		SELECT 'SUB SECTION NAME' AS MASTER_COL,'SUB_SECTION_NAME' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		UNION ALL
		SELECT 'ARTICLE NO' AS MASTER_COL,'ARTICLE_NO' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		UNION ALL
		SELECT 'PRODUCT CODE' AS MASTER_COL,'PRODUCT_CODE' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		UNION ALL
		SELECT 'ONLINE PRODUCT CODE' AS MASTER_COL,'ONLINE_PRODUCT_CODE' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		UNION ALL
		SELECT 'NEW PRODUCT CODE' AS MASTER_COL,'NEW_PRODUCT_CODE' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		UNION ALL
		SELECT 'PARA1' AS MASTER_COL,'PARA1_NAME' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		UNION ALL
		SELECT 'PARA2' AS MASTER_COL,'PARA2_NAME' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		UNION ALL
		SELECT 'PARA3' AS MASTER_COL,'PARA3_NAME' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		UNION ALL
		SELECT 'PARA4' AS MASTER_COL,'PARA4_NAME' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		UNION ALL
		SELECT 'PARA5' AS MASTER_COL,'PARA5_NAME' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		UNION ALL
		SELECT 'PARA6' AS MASTER_COL,'PARA6_NAME' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		UNION ALL
		SELECT 'PURCHASE PRICE' AS MASTER_COL,'PURCHASE_PRICE' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		UNION ALL
		SELECT 'MRP' AS MASTER_COL,'MRP' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		UNION ALL
		SELECT 'WS PRICE' AS MASTER_COL,'WS_PRICE' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		UNION ALL
		SELECT 'CODING SCHEME' AS MASTER_COL,'CODING_SCHEME' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		UNION ALL
		SELECT 'UOM' AS MASTER_COL,'UOM_NAME' AS MASTER_COL_EXPR,'' AS MAPPED_COL
		
		
	 GOTO LAST 
	 
	 LBLTMASTER:
	 
	  IF OBJECT_ID('_TMPMASTERS','U') IS NOT NULL 
		DROP TABLE _TMPMASTERS	
		
		SELECT SECTION_NAME,SUB_SECTION_NAME,ARTICLE_NO,PARA1_NAME,PARA2_NAME,PARA3_NAME,PARA4_NAME,PARA5_NAME,
		PARA6_NAME,A.PURCHASE_PRICE,A.MRP,A.WS_PRICE,B.ALIAS AS ARTICLE_ALIAS, 
		B.CODING_SCHEME,A.PRODUCT_CODE,UOM_NAME,AC_NAME,'' AS ONLINE_PRODUCT_CODE  
		INTO _TMPMASTERS 
		FROM PRD_SKU A 
		JOIN ARTICLE B ON A.ARTICLE_CODE=B.ARTICLE_CODE 
		JOIN PARA1 C ON A.PARA1_CODE=C.PARA1_CODE 
		JOIN PARA2 D ON A.PARA2_CODE=D.PARA2_CODE 
		JOIN PARA3 G ON A.PARA3_CODE=G.PARA3_CODE 
		JOIN PARA4 H ON A.PARA4_CODE=H.PARA4_CODE 
		JOIN PARA5 I ON A.PARA5_CODE=I.PARA5_CODE 
		JOIN PARA6 J ON A.PARA6_CODE=J.PARA6_CODE 							
		JOIN SECTIOND E ON E.SUB_SECTION_CODE=B.SUB_SECTION_CODE 
		JOIN SECTIONM F ON F.SECTION_CODE=E.SECTION_CODE 
		JOIN LM01106 K ON K.AC_CODE=A.AC_CODE 
		JOIN UOM L ON L.UOM_CODE=B.UOM_CODE 
		WHERE 1=2 
		
		GOTO LAST 
		
	LBLTATTR:	

            IF OBJECT_ID('_TMPARTATTR','U') IS NOT NULL 
				DROP TABLE _TMPARTATTR	
				
			SELECT ARTICLE_NO,A.ATTRIBUTE_CODE,ATTRIBUTE_NAME,KEY_NAME 
			INTO _TMPARTATTR  
			FROM ART_ATTR A 
			JOIN ATTR_KEY B ON 
			A.ATTRIBUTE_CODE=B.ATTRIBUTE_CODE AND A.KEY_CODE=B.KEY_CODE 
			JOIN ATTRM C ON C.ATTRIBUTE_CODE=A.ATTRIBUTE_CODE 
			JOIN ARTICLE D ON D.ARTICLE_CODE=A.ARTICLE_CODE WHERE 1=2 
	 GOTO LAST 
	 
	LBLMEMOATTR:
	 
	    SELECT A1.PRODUCT_CODE,A1.ARTICLE_CODE,A.ATTRIBUTE_CODE,B.ATTRIBUTE_NAME,C.KEY_NAME
		FROM PRD_SKU A1 (NOLOCK)
		JOIN PRD_IRD01106 B1 (NOLOCK) ON A1.PRODUCT_UID = B1.PRODUCT_UID
		LEFT OUTER JOIN ART_ATTR A (NOLOCK) ON A.ARTICLE_CODE= A1.ARTICLE_CODE
		LEFT OUTER JOIN ATTRM B (NOLOCK) ON B.ATTRIBUTE_CODE = A.ATTRIBUTE_CODE 
		LEFT OUTER JOIN ATTR_KEY C (NOLOCK) ON C.KEY_CODE = A.KEY_CODE
		WHERE B1.IRM_MEMO_ID= @CMEMO 		
		
		GOTO LAST
		
	LBLATTRLIST:
		
		--SELECT  A.PRODUCT_CODE,ATTRIBUTE_CODE,ATTRIBUTE_NAME,KEY_NAME
		--FROM SKU A
		--JOIN 
		--(SELECT ARTICLE_CODE,B.ATTRIBUTE_CODE,ATTRIBUTE_NAME,KEY_NAME FROM  ART_ATTR A (NOLOCK)
		--JOIN ATTRM B (NOLOCK) ON B.ATTRIBUTE_CODE = A.ATTRIBUTE_CODE 
		--JOIN ATTR_KEY C (NOLOCK) ON C.KEY_CODE = A.KEY_CODE)  F ON A.ARTICLE_CODE = F.ARTICLE_CODE
		--WHERE A.PRODUCT_CODE= @CWHERE
		SELECT  A1.PRODUCT_CODE,A.ATTRIBUTE_CODE,B.ATTRIBUTE_NAME,C.KEY_NAME
		FROM PRD_SKU A1
		JOIN ART_ATTR A (NOLOCK) ON A.ARTICLE_CODE=A1.ARTICLE_CODE
		JOIN ATTRM B (NOLOCK) ON B.ATTRIBUTE_CODE = A.ATTRIBUTE_CODE 
		JOIN ATTR_KEY C (NOLOCK) ON C.KEY_CODE = A.KEY_CODE
		WHERE A1.PRODUCT_CODE= @CWHERE

		
		GOTO LAST
		
		    
LAST:          
END
