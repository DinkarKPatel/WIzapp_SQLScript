CREATE VIEW APPLOGINVIEW    
--WITH ENCRYPTION
 AS

SELECT DISTINCT A.USER_CODE, A.DEPT_ID, B.DEPT_NAME, C.USERNAME ,ISNULL(X.FORM_OPTION,'') AS [DEPARTMENT_NAME],
ISNULL(X.DEPARTMENT_ID     ,'') AS [DEPARTMENT_ID],B.MAJOR_DEPT_ID 
FROM LOCUSERS A (NOLOCK)      
JOIN LOCATION B (NOLOCK)  ON A.DEPT_ID=B.DEPT_ID      
JOIN USERS C (NOLOCK)  ON A.USER_CODE=C.USER_CODE
LEFT OUTER JOIN
(
	SELECT U.USER_CODE, FORM_OPTION,B.DEPARTMENT_ID  
	FROM USER_ROLE_DET A (NOLOCK) 
	JOIN USERS U (NOLOCK) ON A.ROLE_ID= U.ROLE_ID  
	JOIN PRD_DEPARTMENT_MST  B (NOLOCK)   ON ISNULL(B.DEPARTMENT_NAME,'')=ISNULL(A.FORM_OPTION,'')
	WHERE A.FORM_NAME='DEPARTMENT' AND ISNULL(A.VALUE,'0')='1'
)X ON X.USER_CODE=A.USER_CODE
UNION 

SELECT DISTINCT B.USER_CODE, A.DEPT_ID, A.DEPT_NAME, B.USERNAME ,
'' AS [DEPARTMENT_NAME],
'' AS [DEPARTMENT_ID],A.MAJOR_DEPT_ID 
FROM LOCATION A (NOLOCK)    
Left outer join LOCUSERS c on A.dept_id= c.dept_id
join users B (NOLOCK)  ON 1=1  and B.inactive =0 
and b.viewLoginLocationMode= 1
where  c.dept_id is null