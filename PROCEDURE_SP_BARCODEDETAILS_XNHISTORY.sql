CREATE PROCEDURE SP_BARCODEDETAILS_XNHISTORY
@CPRODUCTCODE	VARCHAR(MAX),
@NINVMODE		NUMERIC(1)
--WITH ENCRYPTION
AS 
BEGIN
DECLARE @CCMD NVARCHAR(MAX)
SET @CCMD=N'	
SELECT TOP 1 
D.SECTION_NAME AS [SECTION],
C.SUB_SECTION_NAME AS [SUB SECTION],
B.ARTICLE_NO AS [ARTICLE NO],
B.ALIAS AS [ARTICLE ALIAS],
UOM.UOM_NAME AS [UOM],
B.ARTICLE_NAME AS [ARTICLE NAME],
B.ARTICLE_DESC AS [ARTICLE DESCRIPTION],
A.PRODUCT_NAME AS [PRODUCT DESCRIPTION],
E.PARA1_NAME,F.PARA2_NAME,G.PARA3_NAME,H.PARA4_NAME,I.PARA5_NAME,J.PARA6_NAME, 
(CASE WHEN A.BARCODE_CODING_SCHEME=3 THEN ''UNIQUE'' WHEN A.BARCODE_CODING_SCHEME=2 THEN ''LOT'' ELSE ''FIXED'' END ) AS [CODING SCHEME],
A.PURCHASE_PRICE AS [PURCHASE PRICE],
CONVERT(VARCHAR(50),A.INV_DT,105) AS [PURCHASE BILL DATE],
CONVERT(VARCHAR(50),A.RECEIPT_DT,105) AS [PURCHASE RECEIPT DATE],
A.INV_NO AS [BILL NO],
A.MRP,
A.WS_PRICE AS [WHOLESALE PRICE],
A.IMAGE_NAME AS [IMAGE NAME],
SKU_OH.TAX_AMOUNT AS [TAX AMOUNT],
SKU_OH.TAX_AMOUNT AS [ITEM_TAX_AMOUNT],
A.CHALLAN_NO AS [CHALLAN NO],
A.FIX_MRP AS [FIX MRP],
A.PRODUCT_CODE AS [PRODUCT CODE],
(CASE WHEN B.STOCK_NA=1 THEN ''YES'' ELSE ''NO'' END) AS [MAINTAIN STOCK],
ISNULL(PMT.QUANTITY_IN_STOCK,0) AS [STOCK],    
K.AC_NAME  AS [SUPPLIER NAME]  ,
------ABS((CASE WHEN ISNULL(POST_TAX_SEPARATELY,0)=0  AND FORM.FORM_ID <> ''0000000'' 
------   THEN  ISNULL(SKU_OH.TAX_AMOUNT,0) ELSE 0 END) - ISNULL(SKU_OH.DISCOUNT_AMOUNT,0) +   
------ISNULL(SKU_OH.VALUE_ADD,0)  + ISNULL(SKU_OH.EXCISE_DUTY_AMOUNT,0)  +   
------ISNULL(SKU_OH.FREIGHT,0)  + ISNULL(SKU_OH.OTHER_CHARGES,0)  +  ISNULL(SKU_OH.ROUND_OFF,0)) AS [OVERHEADS],
A.ONLINE_PRODUCT_CODE  AS [ONLINE PRODUCT],A.VENDOR_EAN_NO AS [VENDOR EAN NO],
A.HSN_CODE AS [HSN CODE],
CAST(ISNULL(SKU_OH.DISCOUNT_AMOUNT,0)AS NUMERIC(10,2)) AS [DISCOUNT AMOUNT],
CAST(ISNULL(SKU_OH.VALUE_ADD,0)AS NUMERIC(10,2)) AS [VALUE ADD],
CAST(ISNULL(SKU_OH.EXCISE_DUTY_AMOUNT,0)AS NUMERIC(10,2)) AS [EXCISE DUTY AMOUNT],
CAST(ISNULL(SKU_OH.FREIGHT,0)AS NUMERIC(10,2)) AS [FREIGHT],
CAST(ISNULL(SKU_OH.OTHER_CHARGES,0)AS NUMERIC(10,2)) AS [OTHER CHARGES],
CAST(ISNULL(SKU_OH.ROUND_OFF,0)AS NUMERIC(10,2)) AS [ROUND OFF],
A.BASIC_PURCHASE_PRICE AS [BASIC PURCHASE PRICE],
OEMLM.AC_NAME [OEM SUPPLIER NAME],
OEMLM.ALIAS [OEM SUPPLIER ALIAS]
FROM SKU A(NOLOCK)             
JOIN ARTICLE B(NOLOCK) ON  A.ARTICLE_CODE= B.ARTICLE_CODE       
JOIN UOM (NOLOCK)  ON UOM.UOM_CODE=B.UOM_CODE
JOIN SECTIOND C(NOLOCK) ON B.SUB_SECTION_CODE= C.SUB_SECTION_CODE      
JOIN SECTIONM D(NOLOCK) ON C.SECTION_CODE= D.SECTION_CODE      
JOIN PARA1 E(NOLOCK) ON A.PARA1_CODE= E.PARA1_CODE      
JOIN PARA2 F(NOLOCK) ON A.PARA2_CODE= F.PARA2_CODE      
JOIN PARA3 G(NOLOCK) ON A.PARA3_CODE= G.PARA3_CODE      
JOIN PARA4 H(NOLOCK) ON A.PARA4_CODE= H.PARA4_CODE      
JOIN PARA5 I(NOLOCK) ON A.PARA5_CODE= I.PARA5_CODE      
JOIN PARA6 J(NOLOCK) ON A.PARA6_CODE= J.PARA6_CODE      
JOIN LMV01106  K(NOLOCK) ON A.AC_CODE= K.AC_CODE    
LEFT OUTER JOIN PMT01106 PMT(NOLOCK) ON A.PRODUCT_CODE = PMT.PRODUCT_CODE         
LEFT OUTER JOIN SKU_OH(NOLOCK) ON A.PRODUCT_CODE=SKU_OH.PRODUCT_CODE 
LEFT JOIN LM01106 OEMLM (NOLOCK) ON OEMLM.AC_CODE=A.SHIPPING_FROM_AC_CODE
WHERE '''+@CPRODUCTCODE+'''='+(CASE WHEN @NINVMODE=3 THEN 'G.PARA3_NAME' WHEN @NINVMODE=2 THEN 'B.ARTICLE_NO' ELSE 'A.PRODUCT_CODE' END)
--WHERE G.PARA3_NAME='''+@CPRODUCTCODE+''' OR B.ARTICLE_NO='''+@CPRODUCTCODE+''' OR A.PRODUCT_CODE='''+@CPRODUCTCODE+''''
--(CASE WHEN @NINVMODE=3 THEN 'PARA3.PARA3_NAME' WHEN @NINVMODE=2 THEN 'B.ARTICLE_NO' ELSE 'A.PRODUCT_CODE' END)

PRINT @CCMD

EXEC SP_EXECUTESQL @CCMD
  
END
