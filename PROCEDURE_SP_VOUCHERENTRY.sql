CREATE PROCEDURE SP_VOUCHERENTRY
  
 @NQUERYID NUMERIC (3,0) ,  
 @CMEMOID NVARCHAR(MAX) = '',  
 @CWHERE NVARCHAR(MAX) = '',  
 @CWHERE1 NVARCHAR(MAX) = ''
-- WITH ENCRYPTION

AS  
BEGIN  
    
    DECLARE @CQUERY NVARCHAR(MAX) 
    DECLARE @CHEADCODE VARCHAR(4000),@CHEADCODE1 VARCHAR(4000),@CHEADCODE2 VARCHAR(4000)
    SET @CQUERY=''
	--IF @NQUERYID = 1  
	--GOTO LBLNAVIGATE  
  
	IF @NQUERYID =  2 
	GOTO LBLVOUCHER
  
	ELSE  IF @NQUERYID =  3 
	GOTO LBLACCOUNTS

	ELSE  IF @NQUERYID=4
	GOTO LBLACCOUNTSCONTRA

	ELSE  IF @NQUERYID=5
	GOTO LBLACCOUNTSBANK

	ELSE  IF @NQUERYID=6
	GOTO LBLACCOUNTSJOURNAL

	ELSE  IF @NQUERYID=7
	GOTO LBLACCOUNTSDUTYNTAX

	ELSE IF @NQUERYID=8
	GOTO LBLACCOUNTSDVAT

	ELSE IF @NQUERYID=9
	GOTO LBLVM01106S

	ELSE IF @NQUERYID=10
	GOTO LBLVD01106

	ELSE IF @NQUERYID=11
	GOTO LBLLOCATION1

	ELSE IF @NQUERYID=12
	GOTO LBLTACTLOCATION

	ELSE IF @NQUERYID=13
	GOTO LBLANGADIA

	ELSE IF @NQUERYID=14
	GOTO LBLVDD

	ELSE IF @NQUERYID=15
	GOTO LBLVDN

	ELSE IF @NQUERYID=16
	GOTO LBLVDA

	ELSE IF @NQUERYID=17
	GOTO LBLCASH

	ELSE IF @NQUERYID=18
	GOTO LBLSUNDRYCREDITORS

	ELSE IF @NQUERYID=19
	GOTO LBLSUNDRYDEBTORS

	ELSE IF @NQUERYID=20
	GOTO LBLCHQS

	ELSE IF @NQUERYID=21
	GOTO LBLCHQD

	ELSE IF @NQUERYID=22
	GOTO LBLTDSDET

	ELSE IF @NQUERYID=23
	GOTO LBLVDT01106
	
	ELSE IF @NQUERYID=24
	GOTO LBLVDVAT01106
	
	ELSE IF @NQUERYID=25
	GOTO LBLVDVATSLS
	
	ELSE IF @NQUERYID=26
	GOTO LBLADJUSTEDVDID

	ELSE IF @NQUERYID=27
	GOTO LBLISSUEDCHQVDID
	ELSE IF @NQUERYID=100
	GOTO LBLCHQPRINT
	ELSE IF @NQUERYID=110
		GOTO LBLPRINTDOC
	ELSE IF @NQUERYID=120
		GOTO LBLVOUCHERPRINT
	ELSE IF @NQUERYID=130
		GOTO LBLLEDGER_CURSOR
	ELSE IF @NQUERYID=140
		GOTO LBLTEMPCHQD
	ELSE IF @NQUERYID=150
		GOTO TACCOUNTS_CBS
	ELSE IF @NQUERYID=160
		GOTO LBLVOUCHER_TCS
	ELSE IF @NQUERYID=170
		GOTO LBLVOUCHER_TDS
	ELSE IF @NQUERYID=180
		GOTO LBLACTCOMPANY
	ELSE IF @NQUERYID=190
		GOTO TAUTOPOSTED
		ELSE IF @NQUERYID=200
		GOTO LBLVOUCHER_PAYMENT
		ELSE IF @NQUERYID=210
		GOTO LBLVOUCHER_RECEIPT
		ELSE IF @NQUERYID=220
		GOTO LBLVOUCHER_EDIT_CANCEL
	ELSE  
	GOTO LAST  

	LBLVOUCHER_EDIT_CANCEL:
		SELECT 'YOU ARE NOT AUTHORIZED TO EDIT/CANCEL VOUCHER FOR ONE OR MULTIPLE LOCATION' AS ERRMSG 
		FROM VD01106 A (NOLOCK)
		JOIN LOCUSERS B (NOLOCK) ON B.DEPT_ID=A.COST_CENTER_DEPT_ID
		WHERE B.USER_CODE=@CWHERE AND A.VM_ID=@CMEMOID
		HAVING COUNT(A.COST_CENTER_DEPT_ID)=0
		GOTO LAST

	LBLACTCOMPANY:
	SELECT A.PAN_NO,A.company_name 
	FROM loc_accounting_company A (NOLOCK)
	JOIN 
	(
		SELECT A.PAN_NO
		FROM LOCATION A (NOLOCK) 
		JOIN locusers B (NOLOCK)  ON B.dept_id=A.dept_id
		WHERE A.DEPT_ID=A.MAJOR_DEPT_ID AND (A.LOC_TYPE=1) AND B.user_code=@CMEMOID
		AND ISNULL(A.PAN_NO,'')<>''
		UNION
		SELECT SUBSTRING(A.LOC_GST_NO,3,10)
		FROM LOCATION A (NOLOCK) 
		JOIN locusers B (NOLOCK)  ON B.dept_id=A.dept_id
		WHERE A.DEPT_ID=A.MAJOR_DEPT_ID AND (A.LOC_TYPE=1) AND B.user_code=@CMEMOID
		AND ISNULL(A.LOC_GST_NO,'')<>''
		UNION
		SELECT A.PAN_NO
		FROM LOCATION A (NOLOCK) 
		JOIN locusers B (NOLOCK)  ON B.dept_id=A.dept_id
		WHERE A.DEPT_ID=A.MAJOR_DEPT_ID AND (LOC_TYPE=2 AND enable_accounting_at_loc=1) AND B.user_code=@CMEMOID
		AND ISNULL(A.PAN_NO,'')<>''
		UNION
		SELECT SUBSTRING(A.LOC_GST_NO,3,10)
		FROM LOCATION A (NOLOCK) 
		JOIN locusers B (NOLOCK)  ON B.dept_id=A.dept_id
		WHERE A.DEPT_ID=A.MAJOR_DEPT_ID AND (LOC_TYPE=2 AND enable_accounting_at_loc=1) AND B.user_code=@CMEMOID
		AND ISNULL(A.LOC_GST_NO,'')<>''
		--SELECT PAN_NO
		--FROM LOCATION (NOLOCK) 
		--WHERE DEPT_ID=MAJOR_DEPT_ID AND (LOC_TYPE=1)
		--AND ISNULL(PAN_NO,'')<>''
		--UNION
		--SELECT SUBSTRING(LOC_GST_NO,3,10)
		--FROM LOCATION (NOLOCK) 
		--WHERE DEPT_ID=MAJOR_DEPT_ID AND (LOC_TYPE=1)
		--AND ISNULL(LOC_GST_NO,'')<>''
		--UNION
		--SELECT PAN_NO
		--FROM LOCATION (NOLOCK) 
		--WHERE DEPT_ID=MAJOR_DEPT_ID AND (LOC_TYPE=2 AND enable_accounting_at_loc=1)
		--AND ISNULL(PAN_NO,'')<>''
		--UNION
		--SELECT SUBSTRING(LOC_GST_NO,3,10)
		--FROM LOCATION (NOLOCK) 
		--WHERE DEPT_ID=MAJOR_DEPT_ID AND (LOC_TYPE=2 AND enable_accounting_at_loc=1)
		--AND ISNULL(LOC_GST_NO,'')<>''
	)X ON X.PAN_NO=A.pan_no
	ORDER BY A.company_name
	GOTO LAST

	LBLLEDGER_CURSOR:
		SELECT AC_CODE, AC_NAME,BILL_BY_BILL,HEAD_CODE, AC_NAME AS PARSE_AC_NAME, AC_NAME AS REPL_AC_NAME FROM LMV01106 (NOLOCK) WHERE 1=2
	GOTO LAST

	LBLVOUCHERPRINT:
		SELECT A.*,A.DEPT_ID + ' ' + B.DEPT_NAME AS DEPT_NAME,C.*,
		D.ANGADIA_NAME,E.USERNAME,ISNULL(AUDIT.USERNAME,'') AS AUDITUSER ,
		vd.vd_id,  vd.ac_code, vd.narration, 
		( CASE WHEN vd.X_TYPE='Cr' THEN  vd.CREDIT_AMOUNT ELSE NULL END) AS CREDIT_AMOUNT, 
		( CASE WHEN vd.X_TYPE='Dr' THEN  vd.DEBIT_AMOUNT ELSE NULL END) AS DEBIT_AMOUNT,
		vd.X_type, vd.vs_ac_code, vd.chk_recon, vd.recon_dt, vd.last_update, vd.company_code,  vd.autoentry, lmv.ac_name,
		isnull(lmv.print_name,'')as print_name,  lmv.BILL_BY_BILL, lmv.head_code,vd.Cost_center_dept_id,isnull(vd.Cost_center_dept_id,'') AS Cost_center_code, 
		vd.control_ac,ISNULL(lmv.Credit_days,0) as CR_DAYS,ISNULL(lmv.discount_percentage,0.00) as discount_percentage,vd.cost_center_ac_code  
		,ISNULL(vd.online_chq_ref_no,'') AS online_chq_ref_no,ISNULL(vd.chq_pay_mode,1) as chq_pay_mode,ISNULL(open_cheque_no,'') AS open_cheque_no,
		ISNULL(open_cheque_dt,'') AS open_cheque_dt,l.dept_name as cost_center_dept_name  ,lmv.hold_for_payment
		,ISNULL(BILLS.REF_NO,'') nbill_no,ISNULL(BILLS.X_TYPE,'') nbill_type,ISNULL(BILLS.AMOUNT,0) feeded_amount     
		 FROM VM01106 A (NOLOCK)   
		JOIN vd01106 vd (NOLOCK) ON vd.VM_ID=A.VM_ID 
		left outer join BILL_BY_BILL_REF BILLS on BILLS.VD_ID=vd.VD_ID
		JOIN lmv01106 lmv (NOLOCK) ON vd.ac_code = lmv.ac_code  
		Left outer join location l (nolock) on vd.cost_center_dept_id= l.dept_id 
		JOIN LOCATION B (NOLOCK) ON A.DEPT_ID = B.DEPT_ID    
		JOIN USERS E (NOLOCK) ON E.USER_CODE = A.USER_CODE    
		LEFT OUTER JOIN USERS AUDIT (NOLOCK) ON AUDIT.USER_CODE = A.AUDITED_USER_CODE    
		JOIN VCHTYPE C (NOLOCK) ON A.VOUCHER_CODE=C.VOUCHER_CODE
		LEFT OUTER JOIN ANGM D (NOLOCK) ON A.ANGADIA_CODE=D.ANGADIA_CODE 
		WHERE ISNULL(vd.autoentry,0)=0 AND A.vm_id=@CMEMOID
		GOTO LAST

	LBLPRINTDOC:
		SELECT COUNT( A.VM_ID) FROM VM01106 A
		JOIN VD01106 VD ON VD.VM_ID=A.VM_ID
		JOIN VCHTYPE B ON B.VOUCHER_CODE=A.VOUCHER_CODE
		JOIN BILL_BY_BILL_REF C ON C.VD_ID=VD.VD_ID
		WHERE B.VOUCHER_MAJOR_HEAD_CODE IN ('0000000002','0000000003')
		AND A.VM_ID=@CMEMOID
	GOTO LAST 

	LBLCHQPRINT:  
			--DECLARE @CHEADCODE VARCHAR(4000),@CHEADCODE1 VARCHAR(4000) 
			SET @CHEADCODE=DBO.FN_ACT_TRAVTREE('0000000013') 
			SET @CHEADCODE1=DBO.FN_ACT_TRAVTREE('0000000022') 
			SELECT COUNT(A.AC_CODE) AS PRINT_CHQ
			FROM LMV01106 A (NOLOCK)
			JOIN vd01106 B (NOLOCK) ON A.AC_CODE=B.AC_CODE
			WHERE (CHARINDEX(HEAD_CODE,@CHEADCODE)>0 
			OR CHARINDEX( HEAD_CODE, @CHEADCODE1)>0 )
			AND B.VM_ID=@CMEMOID 
			and B.X_TYPE='CR'
	GOTO LAST  
  
	LBLVOUCHER:
		SELECT * FROM VCHTYPE ORDER BY VOUCHER_CODE
		

	GOTO LAST  
	LBLVOUCHER_TCS:
			SET @CHEADCODE=DBO.FN_VCH_TRAVTREESTR('0000000003') 
			SELECT *
			FROM VCHTYPE A (NOLOCK)
			WHERE CHARINDEX(VOUCHER_CODE,@CHEADCODE)>0 
	GOTO LAST  
	LBLVOUCHER_TDS:
			SET @CHEADCODE=DBO.FN_VCH_TRAVTREESTR('0000000001') 
			SET @CHEADCODE1=DBO.FN_VCH_TRAVTREESTR('0000000002') 
			SET @CHEADCODE2=DBO.FN_VCH_TRAVTREESTR('0000000006') 
			SELECT *
			FROM VCHTYPE A (NOLOCK)
			WHERE (CHARINDEX(VOUCHER_CODE,@CHEADCODE)>0 
			OR CHARINDEX( VOUCHER_CODE, @CHEADCODE1)>0
			OR CHARINDEX( VOUCHER_CODE, @CHEADCODE2)>0)
	GOTO LAST 
	LBLVOUCHER_PAYMENT:
			SET @CHEADCODE=DBO.FN_VCH_TRAVTREESTR('0000000002') 
			SELECT *
			FROM VCHTYPE A (NOLOCK)
			WHERE (CHARINDEX(VOUCHER_CODE,@CHEADCODE)>0)
	GOTO LAST 
	LBLVOUCHER_RECEIPT:
			SET @CHEADCODE=DBO.FN_VCH_TRAVTREESTR('0000000003') 
			SELECT *
			FROM VCHTYPE A (NOLOCK)
			WHERE (CHARINDEX(VOUCHER_CODE,@CHEADCODE)>0)
	GOTO LAST 
	LBLACCOUNTS:
		SET @CQUERY=N'SELECT AC_CODE,AC_NAME,BILL_BY_BILL,HEAD_CODE,ISNULL(CREDIT_DAYS,0) AS CR_DAYS, 
			ISNULL(DISCOUNT_PERCENTAGE,0) AS DISCOUNT_PERCENTAGE,PRINT_NAME,TDS_CODE,PAN_NO, 
			REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(AC_NAME,''.'','''++'''),''@'','''++'''),'''+' '+''','''++'''),''_'','''++'''),''('','''++'''),'')'','''++'''),''-'','''++''')  AS PARSE_AC_NAME, 
			AC_NAME AS REPL_AC_NAME 
			FROM LMV01106 (NOLOCK)
			WHERE ISNULL(INACTIVE,0)=0'		
		IF @CWHERE<>1
		BEGIN
		SET @CQUERY=@CQUERY+N' 	UNION ALL
			SELECT AC_CODE,ALIAS AS [AC_NAME],BILL_BY_BILL,HEAD_CODE,ISNULL(CREDIT_DAYS,0) AS CR_DAYS, 
			ISNULL(DISCOUNT_PERCENTAGE,0) AS DISCOUNT_PERCENTAGE,PRINT_NAME,TDS_CODE,PAN_NO, 
			REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(AC_NAME,''.'','''++'''),''@'','''++'''),'''+' '+''','''++'''),''_'','''++'''),''('','''++'''),'')'','''++'''),''-'','''++''')  AS PARSE_AC_NAME, 
			AC_NAME AS REPL_AC_NAME 
			FROM LMV01106 (NOLOCK)
			WHERE ISNULL(INACTIVE,0)=0 AND ISNULL(ALIAS,'''++''')<>'''++'''' 		
		END
		SET @CQUERY=@CQUERY+N'ORDER BY AC_NAME'
		EXEC SP_EXECUTESQL  @CQUERY
	GOTO LAST


	LBLACCOUNTSCONTRA:
		SET @CQUERY=N'DECLARE @CHEADCODE VARCHAR(4000),@CHEADCODE1 VARCHAR(4000),@CHEADCODE2 VARCHAR(4000),@CHEADCODE3 VARCHAR(4000) 
			SET @CHEADCODE=DBO.FN_ACT_TRAVTREE(''0000000013'') 
			SET @CHEADCODE1=DBO.FN_ACT_TRAVTREE(''0000000014'') 
			SET @CHEADCODE2=DBO.FN_ACT_TRAVTREE(''0000000007'') 
			SET @CHEADCODE3=DBO.FN_ACT_TRAVTREE(''0000000031'') 
			SELECT AC_CODE, AC_NAME,BILL_BY_BILL,HEAD_CODE, 
			REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(AC_NAME,''.'','''++'''),''@'','''++'''),'''+' '+''','''++'''),''_'','''++'''),''('','''++'''),'')'','''++'''),''-'','''++''')  AS PARSE_AC_NAME, 
			AC_NAME AS REPL_AC_NAME 
			FROM LMV01106 (NOLOCK)
			WHERE (CHARINDEX(HEAD_CODE,@CHEADCODE)>0 
			OR CHARINDEX( HEAD_CODE, @CHEADCODE1)>0 
			OR CHARINDEX( HEAD_CODE, @CHEADCODE2)>0 ) AND NOT CHARINDEX( HEAD_CODE, @CHEADCODE3)>0 AND ISNULL(INACTIVE,0)=0 '
		IF @CWHERE<>1
		BEGIN
		SET @CQUERY=@CQUERY+N'UNION ALL
			SELECT AC_CODE,ALIAS AS [AC_NAME],BILL_BY_BILL,HEAD_CODE, 
			REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(AC_NAME,''.'','''++'''),''@'','''++'''),'''+' '+''','''++'''),''_'','''++'''),''('','''++'''),'')'','''++'''),''-'','''++''')  AS PARSE_AC_NAME, 
			AC_NAME AS REPL_AC_NAME 
			FROM LMV01106 (NOLOCK)
			WHERE (CHARINDEX(HEAD_CODE,@CHEADCODE)>0 
			OR CHARINDEX( HEAD_CODE, @CHEADCODE1)>0 
			OR CHARINDEX( HEAD_CODE, @CHEADCODE2)>0 ) AND NOT CHARINDEX( HEAD_CODE, @CHEADCODE3)>0 AND ISNULL(INACTIVE,0)=0 AND ISNULL(ALIAS,'''++''')<>'''++''' '
			
		END
		SET @CQUERY=@CQUERY+N'ORDER BY AC_NAME'
		EXEC SP_EXECUTESQL   @CQUERY
	GOTO LAST

	LBLACCOUNTSBANK:
		SET @CQUERY=N'DECLARE @CHEADCODE VARCHAR(4000),@CHEADCODE1 VARCHAR(4000),@CHEADCODE2 VARCHAR(4000) 
			SET @CHEADCODE=DBO.FN_ACT_TRAVTREE(''0000000013'') 
			SET @CHEADCODE1=DBO.FN_ACT_TRAVTREE(''0000000007'') 
			SET @CHEADCODE2=DBO.FN_ACT_TRAVTREE(''0000000031'') 
			SELECT AC_CODE, AC_NAME,BILL_BY_BILL,HEAD_CODE, 
			REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(AC_NAME,''.'','''++'''),''@'','''++'''),'''+' '+''','''++'''),''_'','''++'''),''('','''++'''),'')'','''++'''),''-'','''++''')  AS PARSE_AC_NAME, 
			AC_NAME AS REPL_AC_NAME 
			FROM LMV01106 (NOLOCK)
			WHERE (CHARINDEX(HEAD_CODE,@CHEADCODE)>0  
			OR CHARINDEX( HEAD_CODE, @CHEADCODE1)>0 )  AND NOT CHARINDEX( HEAD_CODE, @CHEADCODE2)>0 
			AND ISNULL(INACTIVE,0)=0  '
		IF @CWHERE<>1
		BEGIN
		SET @CQUERY=@CQUERY+N' UNION ALL
			SELECT AC_CODE,ALIAS AS [AC_NAME],BILL_BY_BILL,HEAD_CODE, 
			REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(AC_NAME,''.'','''++'''),''@'','''++'''),'''+' '+''','''++'''),''_'','''++'''),''('','''++'''),'')'','''++'''),''-'','''++''')  AS PARSE_AC_NAME
			,AC_NAME AS REPL_AC_NAME 
			FROM LMV01106 (NOLOCK)
			WHERE (CHARINDEX(HEAD_CODE,@CHEADCODE)>0 
			OR CHARINDEX( HEAD_CODE, @CHEADCODE1)>0) AND NOT CHARINDEX( HEAD_CODE, @CHEADCODE2)>0  
			AND ISNULL(INACTIVE,0)=0 AND ISNULL(ALIAS,'''++''')<>'''++''' '
		END
		SET @CQUERY=@CQUERY+N' ORDER BY AC_NAME'
		
		EXEC SP_EXECUTESQL   @CQUERY
	GOTO LAST
	
	
	LBLACCOUNTSJOURNAL:
		SET @CQUERY=N'DECLARE @CHEADCODE VARCHAR(4000),@CHEADCODE1 VARCHAR(4000),@CHEADCODE2 VARCHAR(4000),@CHEADCODE3 VARCHAR(4000) 
			SET @CHEADCODE=DBO.FN_ACT_TRAVTREE(''0000000013'') 
			SET @CHEADCODE1=DBO.FN_ACT_TRAVTREE(''0000000014'') 
			SET @CHEADCODE2=DBO.FN_ACT_TRAVTREE(''0000000007'') 
			SET @CHEADCODE3=DBO.FN_ACT_TRAVTREE(''0000000031'') 
			SELECT AC_CODE, AC_NAME,BILL_BY_BILL,HEAD_CODE, 
			REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(AC_NAME,''.'','''++'''),''@'','''++'''),'''+' '+''','''++'''),''_'','''++'''),''('','''++'''),'')'','''++'''),''-'','''++''')  AS PARSE_AC_NAME,
			AC_NAME AS REPL_AC_NAME
			 FROM LMV01106 (NOLOCK)
			WHERE ((NOT (CHARINDEX(HEAD_CODE,@CHEADCODE)>0 
			OR CHARINDEX( HEAD_CODE, @CHEADCODE1)>0 
			OR CHARINDEX( HEAD_CODE, @CHEADCODE2)>0)) OR CHARINDEX( HEAD_CODE, @CHEADCODE3)>0)  AND ISNULL(INACTIVE,0)=0 '
		IF @CWHERE<>1
		BEGIN
		SET @CQUERY=@CQUERY+N' UNION ALL
			SELECT AC_CODE,ALIAS AS [AC_NAME],BILL_BY_BILL,HEAD_CODE, 
			REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(AC_NAME,''.'','''++'''),''@'','''++'''),'''+' '+''','''++'''),''_'','''++'''),''('','''++'''),'')'','''++'''),''-'','''++''')  AS PARSE_AC_NAME
			,AC_NAME AS REPL_AC_NAME 
			FROM LMV01106 (NOLOCK)
			WHERE ((NOT (CHARINDEX(HEAD_CODE,@CHEADCODE)>0 
			OR CHARINDEX( HEAD_CODE, @CHEADCODE1)>0 
			OR CHARINDEX( HEAD_CODE, @CHEADCODE2)>0)) OR CHARINDEX( HEAD_CODE, @CHEADCODE3)>0)  
			AND ISNULL(INACTIVE,0)=0 AND ISNULL(ALIAS,'''++''')<>'''++''' '   
		END
		SET @CQUERY=@CQUERY+N' ORDER BY AC_NAME'
		EXEC SP_EXECUTESQL   @CQUERY
	GOTO LAST


	LBLACCOUNTSDUTYNTAX:
		SET @CQUERY=N'DECLARE @CHEADCODE VARCHAR(4000) 
			SET @CHEADCODE=DBO.FN_ACT_TRAVTREE(''0000000019'') 
			SELECT AC_CODE, AC_NAME,BILL_BY_BILL,HEAD_CODE, 
			REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(AC_NAME,''.'','''++'''),''@'','''++'''),'''+' '+''','''++'''),''_'','''++'''),''('','''++'''),'')'','''++'''),''-'','''++''')  AS PARSE_AC_NAME
			,AC_NAME AS REPL_AC_NAME 
			FROM LMV01106 (NOLOCK) 
			WHERE CHARINDEX(HEAD_CODE,@CHEADCODE)>0  AND ISNULL(INACTIVE,0)=0 '
		IF @CWHERE<>1
		BEGIN
		SET @CQUERY=@CQUERY+N' UNION ALL
			SELECT AC_CODE,ALIAS AS [AC_NAME],BILL_BY_BILL,HEAD_CODE, 
			REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(AC_NAME,''.'','''++'''),''@'','''++'''),'''+' '+''','''++'''),''_'','''++'''),''('','''++'''),'')'','''++'''),''-'','''++''')  AS PARSE_AC_NAME
			,AC_NAME AS REPL_AC_NAME 
			FROM LMV01106 (NOLOCK)
			WHERE (CHARINDEX(HEAD_CODE,@CHEADCODE)>0) 
			AND ISNULL(INACTIVE,0)=0 AND ISNULL(ALIAS,'''++''')<>'''++'''  '
		END
		SET @CQUERY=@CQUERY+ N'ORDER BY AC_NAME '
		EXEC SP_EXECUTESQL   @CQUERY	
	GOTO LAST


	LBLACCOUNTSDVAT:		
		SET @CHEADCODE=DBO.FN_ACT_TRAVTREE('0000000013') 
		SET @CHEADCODE1=DBO.FN_ACT_TRAVTREE('0000000014') 
		SET @CHEADCODE2=DBO.FN_ACT_TRAVTREE('0000000001') 
		SELECT AC_CODE, AC_NAME,BILL_BY_BILL,HEAD_CODE, 
		REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(AC_NAME,'.',''),'@',''),' ',''),'_',''),'(',''),')',''),'-','')  AS PARSE_AC_NAME,AC_NAME AS REPL_AC_NAME
		FROM LMV01106 (NOLOCK)
		WHERE (CHARINDEX(HEAD_CODE,@CHEADCODE)>0 	OR CHARINDEX( HEAD_CODE, @CHEADCODE1)>0 
		OR CHARINDEX( HEAD_CODE, @CHEADCODE1)>0) AND ISNULL(INACTIVE,0)=0 
		ORDER BY AC_NAME
	GOTO LAST
	
	
	LBLNARRATION:
		SELECT NRM_ID, NARRATION FROM NRM (NOLOCK) WHERE NRM_ID <> '0000000' ORDER BY NARRATION
	GOTO LAST
	
	LBLVM01106S:
		SET @CQUERY=N' SELECT A.*,A.DEPT_ID + '''+ +''' + B.DEPT_NAME AS DEPT_NAME,C.*,
		   D.ANGADIA_NAME,E.USERNAME,ISNULL(AUDIT.USERNAME,'''') AS AUDITUSER ,     ISNULL(EDIT.USERNAME,'''') AS EDT_USERNAME 
		   FROM VM01106 A (NOLOCK)   
		   JOIN LOCATION B (NOLOCK) ON A.DEPT_ID = B.DEPT_ID    
		   JOIN USERS E (NOLOCK) ON E.USER_CODE = A.USER_CODE    
		   LEFT OUTER JOIN USERS EDIT (NOLOCK) ON EDIT.USER_CODE = A.EDT_USER_CODE    
		   LEFT OUTER JOIN USERS AUDIT (NOLOCK) ON AUDIT.USER_CODE = A.AUDITED_USER_CODE    
		   JOIN VCHTYPE C (NOLOCK) ON A.VOUCHER_CODE=C.VOUCHER_CODE    
		   LEFT OUTER JOIN ANGM D (NOLOCK) ON A.ANGADIA_CODE=D.ANGADIA_CODE 
		   WHERE '
	   IF ISNULL(@CWHERE,'')<>''
			SET @CQUERY=@CQUERY+N' VM_ID='''+@CWHERE+''' '
	   ELSE	
			SET @CQUERY=@CQUERY+N'1=2'
			
		EXEC SP_EXECUTESQL   @CQUERY	
	GOTO LAST
	
	
	LBLVD01106:

	SELECT ac_code,sum(balance) as balance INTO #all_loc_ledger_balance from loc_ledger_balance a (NOLOCK)
	WHERE ac_code IN (SELECT ac_code FROM vd01106 (NOLOCK) WHERE vm_id=@cWhere)
	GROUP BY ac_code

	SET @CQUERY=N'SELECT a.vd_id, a.vm_id, d.voucher_dt, a.ac_code, a.narration, 
                            ( CASE WHEN A.X_TYPE=''Cr'' THEN  A.CREDIT_AMOUNT ELSE NULL END) AS CREDIT_AMOUNT, 
							( CASE WHEN A.X_TYPE=''Dr'' THEN  A.DEBIT_AMOUNT ELSE NULL END) AS DEBIT_AMOUNT,
                           a.X_type, a.vs_ac_code, a.chk_recon, a.recon_dt, a.last_update, a.company_code, d.fin_year, a.autoentry, b.ac_name,
						   isnull(b.print_name,'''')as print_name,  b.BILL_BY_BILL, b.head_code,a.Cost_center_dept_id,isnull(a.Cost_center_dept_id,'''') AS Cost_center_code, 
                           a.control_ac,ISNULL(b.Credit_days,0) as CR_DAYS,ISNULL(b.discount_percentage,0.00) as discount_percentage,a.cost_center_ac_code  
                           ,ISNULL(a.online_chq_ref_no,'''') AS online_chq_ref_no,ISNULL(a.chq_pay_mode,1) as chq_pay_mode,ISNULL(open_cheque_no,'''') AS open_cheque_no,
						   ISNULL(open_cheque_dt,'''') AS open_cheque_dt,l.dept_name as cost_center_dept_name  ,b.hold_for_payment,b.on_hold,
						   (CASE WHEN (isnull(bal.balance,0))>0 THEN CONVERT(VARCHAR(20), bal.balance)+''Dr''
							WHEN (isnull(bal.balance,0))<0 THEN CONVERT (VARCHAR(20), ABS(bal.balance))+''Cr'' ELSE NULL END)   AS CBS_LOC,
							(CASE WHEN isnull(all_bal.balance,0)>0 THEN CONVERT (VARCHAR(20), all_bal.balance)+''Dr''
							WHEN isnull(all_bal.balance,0)<0 THEN CONVERT (VARCHAR(20), ABS(all_bal.balance))+''Cr'' ELSE NULL END)   AS  CBS_ALL,a.ref_vd_id
							,(CASE WHEN ISNULL(a.recon_dt,'''')='''' THEN NULL ELSE CONVERT(VARCHAR(20),a.recon_dt,105) END) AS DISPLAY_RECON_DT
							,ISNULL(b.SOR_PARTY,0) AS SOR_PARTY,ISNULL(a.party_fc_code,''0000000'') AS PARTY_FC_CODE,ISNULL(fc.fc_name,''INR'') AS PARTY_FC_NAME,ISNULL(a.forex_rate,1) AS forex_rate
							,a.debit_amount_forex,a.credit_amount_forex,CAST ((CASE WHEN ISNULL(B.fc_code,''0000000'') =''0000000'' THEN 0 ELSE 1 END) AS BIT) AS FC
                           FROM vd01106 a (NOLOCK)  
                           JOIN vm01106 d (NOLOCK) ON a.vm_id = d.vm_id  
                           JOIN lmv01106 b (NOLOCK) ON a.ac_code = b.ac_code  
						   LEFT OUTER JOIN fc (NOLOCK) ON fc.fc_code=a.party_fc_code
                           Left outer join location l (nolock) on a.cost_center_dept_id= l.dept_id 
						   Left outer join  loc_ledger_balance bal (nolock) on a.ac_code= bal.ac_code AND a.cost_center_dept_id= bal.dept_id 
						   Left outer join  #all_loc_ledger_balance all_bal (nolock) on a.ac_code= all_bal.ac_code
	                       WHERE   '+ (case when ISNULL(@CWHERE,'')='' THEN '1=2' ELSE '  a.VM_ID = ''' + ISNULL(@CWHERE,'') + ''' ' END)+
                           ' ORDER BY a.ts,a.vd_id'
		--IF ISNULL(@CWHERE1,'')<>''
		--BEGIN 
		--/*
		--( CASE WHEN CONVERT(VARCHAR(14),A.CREDIT_AMOUNT)  = ''0.00'' THEN ''0.00'' ELSE CONVERT(VARCHAR(14),A.CREDIT_AMOUNT) END ) AS CREDIT_AMOUNT, 
		--		( CASE WHEN CONVERT(VARCHAR(14),A.DEBIT_AMOUNT) = ''0.00'' THEN ''0.00'' ELSE CONVERT(VARCHAR(14),A.DEBIT_AMOUNT) END ) AS DEBIT_AMOUNT,
		--*/
		--	SET @CQUERY=@CQUERY+N'SELECT A.VD_ID, A.VM_ID, D.VOUCHER_DT, A.AC_CODE, A.NARRATION, 
		--		 ( CASE WHEN A.X_TYPE=''Cr'' THEN  A.CREDIT_AMOUNT ELSE NULL END) AS CREDIT_AMOUNT, 
		--		( CASE WHEN A.X_TYPE=''Dr'' THEN  A.DEBIT_AMOUNT ELSE NULL END) AS DEBIT_AMOUNT,
		--		A.X_TYPE, A.VS_AC_CODE, A.CHK_RECON, A.RECON_DT, A.LAST_UPDATE, A.COMPANY_CODE, D.FIN_YEAR, A.AUTOENTRY, B.AC_NAME,ISNULL(B.PRINT_NAME,'''++''')AS PRINT_NAME, 
		--		,B.BILL_BY_BILL, B.HEAD_CODE,D.DEPT_ID AS COST_CENTER_CODE,A.CONTROL_AC,ISNULL(B.CREDIT_DAYS,0) AS CR_DAYS,ISNULL(B.DISCOUNT_PERCENTAGE,0.00) AS DISCOUNT_PERCENTAGE 
		--		,A.VAT_ENTRY,A.SECONDARY_NARRATION,A.COST_CENTER_AC_CODE,B.HOLD_FOR_PAYMENT,A.COST_CENTER_DEPT_ID
		--		FROM VD01106 A (NOLOCK) 
		--		JOIN VM01106 D  (NOLOCK) ON A.VM_ID = D.VM_ID 
		--		JOIN LMV01106 B (NOLOCK) ON A.AC_CODE = B.AC_CODE 
		--		WHERE D.CANCELLED=0 '

		--	IF ISNULL(@CWHERE,'')<>''
		--		SET @CQUERY=@CQUERY+N' AND (A.VM_ID = '''+@CWHERE+''' OR ISNULL(D.REF_VM_ID,'')='''+ @CWHERE +''') AND ISNULL(A.CONTROL_AC,0)=0 '
		--	ELSE	  
		--		SET @CQUERY=@CQUERY+' AND 1=2'
		--	SET @CQUERY=@CQUERY+N' ORDER BY A.VD_ID '
		--END
		--ELSE		
		--BEGIN
		--/*
		--( CASE WHEN CONVERT(VARCHAR(14),A.CREDIT_AMOUNT)  = ''0.00'' THEN ''0.00'' ELSE CONVERT(VARCHAR(14),A.CREDIT_AMOUNT) END ) AS CREDIT_AMOUNT, 
		--		( CASE WHEN CONVERT(VARCHAR(14),A.DEBIT_AMOUNT) = ''0.00'' THEN ''0.00'' ELSE CONVERT(VARCHAR(14),A.DEBIT_AMOUNT) END ) AS DEBIT_AMOUNT, 
		--*/
		--	SET @CQUERY=N'SELECT A.VD_ID, A.VM_ID, D.VOUCHER_DT, A.AC_CODE, A.NARRATION, 
		--		( CASE WHEN A.X_TYPE=''Cr'' THEN A.CREDIT_AMOUNT ELSE NULL END ) AS CREDIT_AMOUNT, 
		--		( CASE WHEN A.X_TYPE=''Dr'' THEN A.DEBIT_AMOUNT ELSE NULL END ) AS DEBIT_AMOUNT, 
		--		A.X_TYPE, A.VS_AC_CODE, A.CHK_RECON, A.RECON_DT, A.LAST_UPDATE, A.COMPANY_CODE, D.FIN_YEAR, A.AUTOENTRY, B.AC_NAME,ISNULL(B.PRINT_NAME,'''++''')AS PRINT_NAME, 
		--		B.BILL_BY_BILL, B.HEAD_CODE,D.DEPT_ID AS COST_CENTER_CODE,A.CONTROL_AC,ISNULL(B.CREDIT_DAYS,0) AS CR_DAYS,ISNULL(B.DISCOUNT_PERCENTAGE,0.00) AS DISCOUNT_PERCENTAGE 
		--		,A.VAT_ENTRY,A.SECONDARY_NARRATION,A.COST_CENTER_AC_CODE,B.HOLD_FOR_PAYMENT,A.COST_CENTER_DEPT_ID
		--		FROM VD01106 A (NOLOCK) 
		--		JOIN VM01106 D ON A.VM_ID = D.VM_ID 
		--		JOIN LMV01106 B ON A.AC_CODE = B.AC_CODE 
		--		WHERE   '
		--	IF ISNULL(@CWHERE,'')<>''
		--		SET @CQUERY=@CQUERY+N'A.VM_ID ='''+@CWHERE+''' ' 
		--	ELSE	
		--		SET @CQUERY=@CQUERY+N' 1=2' 
		--	SET @CQUERY=@CQUERY+N' ORDER BY A.VD_ID'
		--END	 
		PRINT @CQUERY
		EXEC SP_EXECUTESQL   @CQUERY
	GOTO LAST
	
		
	LBLLOCATION1:
		IF ISNULL(@CMEMOID,'')<>''
			SELECT A.DEPT_ID,A.DEPT_ID  + ' ' +  A.DEPT_NAME AS  DEPT_NAME,A.CONTROL_AC_CODE 
			FROM LOCATION A (NOLOCK) 
			JOIN locusers B (NOLOCK)  ON B.dept_id=A.dept_id
			WHERE A.DEPT_ID=A.MAJOR_DEPT_ID AND (A.LOC_TYPE=1 OR A.Account_posting_at_ho=1)
			 AND ISNULL(A.PAN_NO,'')<>''AND A.PAN_NO=ISNULL(@CMEMOID,'')
			  AND B.user_code=@CWHERE
			UNION
			SELECT A.DEPT_ID,A.DEPT_ID  + ' ' +  A.DEPT_NAME AS  DEPT_NAME,A.CONTROL_AC_CODE 
			FROM LOCATION A(NOLOCK)
			JOIN locusers B (NOLOCK)  ON B.dept_id=A.dept_id
			WHERE A.DEPT_ID=A.MAJOR_DEPT_ID AND (A.LOC_TYPE=1 OR A.Account_posting_at_ho=1)
			AND ISNULL(A.LOC_GST_NO,'')<>'' AND SUBSTRING(A.LOC_GST_NO,3,10)=ISNULL(@CMEMOID,'')
			 AND B.user_code=@CWHERE
			ORDER BY DEPT_ID
		ELSE IF ISNULL(@CWHERE,'')<>''
			SELECT DEPT_ID,DEPT_ID  + ' ' +  DEPT_NAME AS  DEPT_NAME,CONTROL_AC_CODE 
			FROM LOCATION (NOLOCK) 
			WHERE DEPT_ID=@CWHERE 
			ORDER BY DEPT_ID
		ELSE	
			SELECT DEPT_ID,DEPT_ID  + ' ' +  DEPT_NAME AS  DEPT_NAME,CONTROL_AC_CODE 
			FROM LOCATION (NOLOCK) 
			WHERE DEPT_ID=MAJOR_DEPT_ID AND (LOC_TYPE=1 OR Account_posting_at_ho=1)
			ORDER BY DEPT_ID
	GOTO LAST
	
	
	LBLTACTLOCATION:
		SELECT DEPT_ID,DEPT_ID  + ' ' +  DEPT_NAME AS  DEPT_NAME,CONTROL_AC_CODE 
		FROM LOCATION (NOLOCK) 
		WHERE ACCOUNTS_POSTING_DEPT_ID=@CWHERE 
	GOTO LAST
	
	
	LBLANGADIA:
		SELECT * FROM ANGM (NOLOCK)
	GOTO LAST
	
	
	LBLVDD:
		SET @CQUERY=N'	SELECT  A.VD_ID, A.VDN_ID, B.AC_CODE, 
			(CASE WHEN A.ON_ACCOUNT=0 THEN ''NEW'' ELSE ''ONACCOUNT'' END) AS REF_TYPE, A.REF_NO AS BILL_NO, 
			A.INV_AMT AS BILL_AMOUNT,0 AS AMOUNT_ADJUSTABLE, ''DR'' AS BILL_TYPE, A.NX_TYPE AS NBILL_TYPE,
			0 AS ADJ_BILL_AMOUNT, A.CR_DAYS,(A.REF_DATE+A.CR_DAYS) AS DUE_DATE, SPACE(20) AS VDDID, 
			0 AS FREEZEEDITING, A.REF_DATE, '''++''' AS ROW_ID, A.DISCOUNT_PERCENTAGE, C.AC_CODE,C.AC_NAME,
			ISNULL(A.INV_AMT*(A.DISCOUNT_PERCENTAGE/100),0.00) AS DISC_AMT,A.INV_AMT  AS FEEDED_AMOUNT,
			(A.INV_AMT-ISNULL(A.INV_AMT*(A.DISCOUNT_PERCENTAGE/100),0.00)) AS NET_AMOUNT ,A.ON_ACCOUNT ,
			'''++''' AS VDN_TEMP,A.DEPT_ID 
			FROM VDN01106 A (NOLOCK) 
			JOIN VD01106 B ON A.VD_ID = B.VD_ID 
			JOIN LMV01106 C ON C.AC_CODE=B.AC_CODE WHERE '
		IF ISNULL(@CWHERE,'')<>''
			SET @CQUERY=@CQUERY+N'B.VM_ID IN ('+@CWHERE+') ' 
		ELSE	
			SET @CQUERY=@CQUERY+N' 1=2' 
		SET @CQUERY=@CQUERY+N' UNION ALL 
			SELECT  A.VD_ID, C.VDN_ID, B.AC_CODE, ''ADJUST'' AS REF_TYPE, C.REF_NO AS BILL_NO, C.INV_AMT AS BILL_AMOUNT,
			0 AS AMOUNT_ADJUSTABLE, ''DR'' AS BILL_TYPE, A.X_TYPE AS NBILL_TYPE, A.AMOUNT AS ADJ_BILL_AMOUNT,
			C.CR_DAYS,'''++''' AS DUE_DATE, SPACE(20) AS VDDID, 0 AS FREEZEEDITING, C.REF_DATE, A.ROW_ID, 
			A.DISCOUNT_PERCENTAGE, D.AC_CODE,D.AC_NAME,A.DISCOUNT_AMOUNT AS DISC_AMT,A.AMOUNT  AS FEEDED_AMOUNT,
			ISNULL(A.AMOUNT-A.DISCOUNT_AMOUNT,0) AS NET_AMOUNT,0 AS ON_ACCOUNT,'''++''' AS VDN_TEMP,C.DEPT_ID  
			FROM VDA01106 A (NOLOCK) 
			JOIN VD01106 B ON A.VD_ID = B.VD_ID 
			JOIN VDN01106 C ON A.VDN_ID = C.VDN_ID 
			JOIN LMV01106 D ON D.AC_CODE=B.AC_CODE WHERE '
		IF ISNULL(@CWHERE,'')<>''
			SET @CQUERY=@CQUERY+N'B.VM_ID IN ('+@CWHERE+') ' 
		ELSE	
			SET @CQUERY=@CQUERY+N' 1=2' 
		EXEC SP_EXECUTESQL   @CQUERY
	GOTO LAST
 
 
	 LBLVDN:
		SET @CQUERY=N' SELECT  A.*,B.AC_CODE 
			FROM VDN01106 A (NOLOCK) 
			JOIN VD01106 B ON B.VD_ID=A.VD_ID WHERE '
		IF ISNULL(@CWHERE,'')<>''
			SET @CQUERY=@CQUERY+N' A.VD_ID='+@CWHERE+' ' 
		ELSE	
			SET @CQUERY=@CQUERY+N' 1=2' 
		EXEC SP_EXECUTESQL   @CQUERY
	 GOTO LAST
	 
 
	 LBLVDA:
		SET @CQUERY=N'SELECT  A.*,B.AC_CODE FROM VDA01106 A (NOLOCK) 
			JOIN VD01106 B ON B.VD_ID=A.VD_ID WHERE '
		IF ISNULL(@CWHERE,'')<>''
			SET @CQUERY=@CQUERY+N' A.VD_ID='+@CWHERE+' ' 
		ELSE	
			 SET @CQUERY=@CQUERY+N' 1=2' 
		EXEC SP_EXECUTESQL   @CQUERY
	 GOTO LAST
 	
 	LBLCASH:
 		SET @CHEADCODE=DBO.FN_ACT_TRAVTREE('0000000014') 
 		SELECT AC_CODE, AC_NAME,BILL_BY_BILL,HEAD_CODE FROM LMV01106 (NOLOCK) 
 		WHERE CHARINDEX(HEAD_CODE,@CHEADCODE)>0 
 		ORDER BY AC_NAME
	GOTO LAST
 
	 LBLSUNDRYCREDITORS:
		SET @CHEADCODE=DBO.FN_ACT_TRAVTREE('0000000021') 
		SELECT AC_CODE, AC_NAME,BILL_BY_BILL,ADDRESS0,ADDRESS1,ADDRESS2,AREA_NAME,CITY,
		PINCODE, STATE ,PHONES_O,PHONES_R,PHONES_FAX,CST_NO,TIN_NO 
		FROM LMV01106 (NOLOCK) 
		WHERE CHARINDEX(HEAD_CODE,@CHEADCODE)>0 OR ISNULL(ALLOW_CREDITOR_DEBTOR,0) =1 
		ORDER BY AC_NAME
	GOTO LAST

	LBLSUNDRYDEBTORS:
		SET @CHEADCODE=DBO.FN_ACT_TRAVTREE('0000000018') 
		SELECT AC_CODE, AC_NAME,BILL_BY_BILL,ADDRESS0,ADDRESS1,ADDRESS2,AREA_NAME,CITY,
		PINCODE, STATE ,PHONES_O,PHONES_R,PHONES_FAX,CST_NO,TIN_NO
		FROM LMV01106 (NOLOCK) 
		WHERE CHARINDEX(HEAD_CODE,@CHEADCODE)>0 OR ISNULL(ALLOW_CREDITOR_DEBTOR,0) =1 
		ORDER BY AC_NAME
	GOTO LAST 

	
	LBLCHQS:
		SET @CQUERY=N' SELECT a.*,a1.* FROM CHQBOOK_D a(NOLOCK) 
		JOIN CHQBOOK_M a1(NOLOCK) ON a1.chq_book_id=a.chq_book_id
		LEFT OUTER JOIN vd_chqbook b (NOLOCK) ON b.chqbook_row_id=a.row_id
			WHERE ISNULL(a1.closed,0)=0 AND ISNULL(a.CANCELLED,0)=0 AND b.chqbook_row_id IS NULL AND '
		IF ISNULL(@CWHERE,'')<>''
			SET @CQUERY=@CQUERY+N' BANK_AC_CODE='''+@CWHERE+''' ' 
		ELSE	
			SET @CQUERY=@CQUERY+N' 1=2' 
		SET @CQUERY=@CQUERY+N' ORDER BY BANK_AC_CODE,a.CHQ_BOOK_ID'
		PRINT @CQUERY
		EXEC SP_EXECUTESQL   @CQUERY
	 GOTO LAST
	 
	 
	 LBLCHQD:
		SET @CQUERY=N' SELECT A.*,B.AC_NAME FROM CHQBOOK_D A (NOLOCK) 
			JOIN LMV01106 B ON B.AC_CODE=A.BANK_AC_CODE WHERE A.CANCELLED=0 AND  '
			SET @CQUERY=N'			
			
			SELECT ISNULL(f.issue_dt,C1.VOUCHER_DT) AS issue_dt,a.*,f.*,b.ac_name,
			(CASE WHEN ISNULL(D1.PRINT_NAME,'''')<> '''' THEN ISNULL(D1.PRINT_NAME,'''') WHEN ISNULL (d.PRINT_NAME,'''')='''' THEN d.AC_NAME elsE  d.print_name end) as print_name 
			,ISNULL(f.issue_dt,C1.VOUCHER_DT) AS issue_dt,CAST(isnull(C.chq_pay_mode,1) AS INT) AS PAY_MODE,(c.debit_amount+c.credit_amount) as chq_amount
			,ISNULL(c.online_chq_ref_no,'''') as ref_no
			FROM chqbook_D a (NOLOCK) 
			JOIN lmv01106					b  (NOLOCK) ON b.ac_code=a.bank_ac_code 
			LEFT OUTER JOIN vd_chqbook		f (NOLOCK) ON f.chqbook_row_id=a.row_id
			lEFT OUTER JOIN VD01106			C  (NOLOCK) ON C.VD_ID=f.VD_ID  
			lEFT OUTER JOIN VM01106			C1  (NOLOCK) ON C.VM_ID=C1.VM_ID  
			lEFT OUTER JOIN LMV01106		D (nolock) on C.VS_AC_CODE = D.AC_CODE 
			lEFT OUTER JOIN LM_PRINTNAME	D1 (nolock) on f.ref_row_id = D1.ROW_ID and d1.ac_code<>''0000000000''
			WHERE a.cancelled=0 AND '
								--" & IIf(cWhere <> "", cWhere, " 1=2") 
        --                        ORDER BY a.chq_leaf_no"

		IF ISNULL(@CWHERE,'')<>''
			SET @CQUERY=@CQUERY + @CWHERE 
		ELSE	
			 SET @CQUERY=@CQUERY+N' 1=2' 
		SET @CQUERY=@CQUERY+N' ORDER BY A.CHQ_LEAF_NO'
		PRINT @CQUERY
		EXEC SP_EXECUTESQL   @CQUERY
	GOTO LAST

	LBLTEMPCHQD:
			SET @CQUERY=N'SELECT a.*,f.*,b.ac_name,
                                (CASE WHEN ISNULL(D1.PRINT_NAME,'''')<> '''' THEN ISNULL(D1.PRINT_NAME,'''') WHEN ISNULL (d.PRINT_NAME,'''')='''' THEN d.AC_NAME elsE  d.print_name end) as print_name 
                                ,C1.VOUCHER_DT AS issue_dt,CAST(isnull(C.chq_pay_mode,1) AS INT) AS PAY_MODE,(c.debit_amount+c.credit_amount) as chq_amount
                                ,ISNULL(c.online_chq_ref_no,'''') as ref_no
                                FROM chqbook_D a (NOLOCK) 
                                JOIN lmv01106 b  (NOLOCK) ON b.ac_code=a.bank_ac_code 
                                LEFT OUTER JOIN vd_chqbook f (NOLOCK) ON f.chqbook_row_id=a.row_id
                                lEFT OUTER JOIN VD01106  C  (NOLOCK) ON C.VD_ID=f.VD_ID  
                                lEFT OUTER JOIN VM01106  C1  (NOLOCK) ON C.VM_ID=C1.VM_ID  
                                lEFT OUTER JOIN LMV01106 D (nolock) on C.VS_AC_CODE = D.AC_CODE 
                                lEFT OUTER JOIN LM_PRINTNAME D1 (nolock) on f.ref_row_id = D1.ROW_ID 
                                WHERE a.cancelled=0 AND a.chq_leaf_no='''+@CWHERE+''' AND a.bank_ac_code='''+@CWHERE1+''''
								--" & IIf(cWhere <> "", cWhere, " 1=2") 
        --                        ORDER BY a.chq_leaf_no"

		--IF ISNULL(@CWHERE,'')<>''
		--	SET @CQUERY=@CQUERY + @CWHERE 
		--ELSE	
		--	 SET @CQUERY=@CQUERY+N' 1=2' 
		--SET @CQUERY=@CQUERY+N' ORDER BY A.CHQ_LEAF_NO'
		PRINT @CQUERY
		EXEC SP_EXECUTESQL   @CQUERY
	GOTO LAST


	LBLTDSDET:
		SELECT A.* FROM TDS_SECTION A (NOLOCK) ORDER BY A.TDS_CODE
	GOTO LAST


	LBLVDT01106:
		SET @CQUERY=N'SELECT  A.*,D.TDS_NAME,E.AC_NAME AS  TDS_AC_NAME, 
		(CASE WHEN B.X_TYPE=''CR'' THEN B.CREDIT_AMOUNT ELSE B.DEBIT_AMOUNT END) AS PYMT_AMT, 
		(A.TDS_AMT+A.SURCHARGE_AMT+A.EDU_AMT) AS TDS_AMT1,B.AC_CODE 
		FROM VDT01106 A (NOLOCK) 
		JOIN VD01106 B ON B.VD_ID=A.VD_ID 
		JOIN VM01106 C ON C.VM_ID=B.VM_ID 
		JOIN TDS_SECTION D  ON D.TDS_CODE=A.TDS_CODE 
		JOIN LM01106 E ON E.AC_CODE=A.TDS_AC_CODE 
		WHERE '
		IF ISNULL(@CWHERE,'')<>''
			SET @CQUERY=@CQUERY+ N'C.VM_ID='''+@CWHERE+''' ' 
		ELSE	
			SET @CQUERY=@CQUERY+N' 1=2' 
			--PRINT 'ASHU'+@CQUERY
		EXEC SP_EXECUTESQL @CQUERY
	GOTO LAST


	LBLVDVAT01106:
		SET @CQUERY=N' SELECT A.INV_NO,B.AC_CODE,A.VD_ID, ROW_ID, OS_IMPORTED_AMT, OS_PUR_AMT, OS_FORM_NO, OS_PUR_EXEMPTED, 
			OS_TOTAL_PUR, LO_PUR_AMT, LO_OTHER, LO_TAX_RATE, LO_INPUT_TAX, LO_TOTAL_PUR,A.LAST_UPDATE
			FROM VDVAT01106 A
			JOIN VD01106 B ON B.VD_ID=A.VD_ID
			WHERE '
		IF ISNULL(@CWHERE,'')<>''
			SET @CQUERY=@CQUERY+ N'B.VM_ID IN ('+@CWHERE+') ' 
		ELSE	
			SET @CQUERY=@CQUERY+N' 1=2'
						
		EXEC SP_EXECUTESQL  @CQUERY
	GOTO LAST


	LBLVDVATSLS:
		SET @CQUERY=N' SELECT A.*,B.AC_CODE FROM VDVAT_SLS A
			JOIN VD01106 B ON B.VD_ID=A.VD_ID
			WHERE '
		IF ISNULL(@CWHERE,'')<>''
			SET @CQUERY=@CQUERY+ N'B.VM_ID IN ('+@CWHERE+')  ' 
		ELSE	
			SET @CQUERY=@CQUERY+N' 1=2' 
		EXEC SP_EXECUTESQL   @CQUERY
	GOTO LAST
	 
	 
	LBLADJUSTEDVDID:
		SET @CQUERY=N' SELECT DISTINCT VD.VD_ID,VM.DEPT_ID FROM VDA01106 VDA (NOLOCK)  
		JOIN VDN01106 VDN ON VDN.VDN_ID=VDA.VDN_ID 
		JOIN VD01106 VD ON VDN.VD_ID = VD.VD_ID  
		JOIN VM01106 VM ON VD.VM_ID = VM.VM_ID  '
		IF ISNULL(@CWHERE,'')<>''
			SET @CQUERY=@CQUERY+ N' WHERE VM.VM_ID IN ('+@CWHERE+') '		
		EXEC SP_EXECUTESQL   @CQUERY
	GOTO LAST 
	
	
	LBLISSUEDCHQVDID:
		SET @CQUERY=N' SELECT A.VD_ID  FROM VD_CHQBOOK A 
		JOIN VD01106 B ON B.VD_ID=A.VD_ID 
		JOIN VM01106 C ON C.VM_ID=B.VM_ID '
		IF ISNULL(@CWHERE,'')<>''
			SET @CQUERY=@CQUERY+ N' WHERE C.VM_ID IN  ('+@CWHERE+') '
		EXEC SP_EXECUTESQL   @CQUERY
	GOTO LAST
TACCOUNTS_CBS:
		;WITH ALL_LOC
		AS
		(
			SELECT ac_code,sum(balance) as CBS_ALL 
			from loc_ledger_balance a (NOLOCK)
			WHERE ac_code =@cWhere
			GROUP BY ac_code
		)
		,LOC
		AS
		(
			SELECT TOP 1 dept_id, ac_code,balance AS CBS_LOC
			from loc_ledger_balance  (NOLOCK)
			WHERE ac_code =@cWhere and dept_id=@CWHERE1
		)
		SELECT isnull(b.dept_id,'') dept_id,isnull(b.ac_code,a.ac_code) ac_code,
		(CASE WHEN isnull(b.CBS_LOC,0)>0 THEN CONVERT (VARCHAR(20), b.CBS_LOC)+'Dr'
		WHEN isnull(b.CBS_LOC,0)<0 THEN CONVERT (VARCHAR(20), ABS(b.CBS_LOC))+'Cr' ELSE NULL END)   AS CBS_LOC,
		(CASE WHEN isnull(a.CBS_ALL,0)>0 THEN CONVERT (VARCHAR(20), a.CBS_ALL)+'Dr'
		WHEN isnull(a.CBS_ALL,0)<0 THEN CONVERT (VARCHAR(20), ABS(a.CBS_ALL))+'Cr' ELSE NULL END)   AS  CBS_ALL
		FROM ALL_LOC a 
		left JOIN LOC b ON b.ac_code=a.ac_code
		GOTO LAST
TAUTOPOSTED:
	SELECT * FROM POSTACT_VOUCHER_LINK lnk (NOLOCK) WHERE lnk.vm_id=ISNULL(@CMEMOID,'')
	GOTO LAST
	
LAST:  
END
