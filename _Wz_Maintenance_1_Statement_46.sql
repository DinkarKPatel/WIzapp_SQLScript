IF NOT EXISTS(SELECT TOP 1 'U' FROM CONFIG WHERE CONFIG_OPTION='UPDATE_TAXABLE_VALUE_1')
BEGIN
	
	 PRINT 'UPDATING TAXABLE VALUE OF OVERHEAD COLUMNS'	
	 UPDATE CMM SET OTHER_CHARGES_TAXABLE_VALUE =ROUND(ATD_CHARGES -(ATD_CHARGES*(CASE WHEN OH_TAX_METHOD =2 THEN ((ISNULL(CMM.OTHER_CHARGES_GST_PERCENTAGE,0))/  
	 (100 + ISNULL(CMM.OTHER_CHARGES_GST_PERCENTAGE,0))) ELSE 0 END)),2)
	 FROM CMM01106  CMM
	 WHERE CM_DT >'2017-06-30'
	 
	 
	  UPDATE INM SET FREIGHT_TAXABLE_VALUE =ROUND(FREIGHT-(FREIGHT*(CASE WHEN OH_TAX_METHOD =2 THEN ((ISNULL(INM.FREIGHT_GST_PERCENTAGE,0))/  
	 (100 + ISNULL(INM.FREIGHT_GST_PERCENTAGE,0))) ELSE 0 END)),2),
				 
	  OTHER_CHARGES_TAXABLE_VALUE =ROUND(OTHER_CHARGES-(OTHER_CHARGES*(CASE WHEN OH_TAX_METHOD =2 THEN ((ISNULL(INM.OTHER_CHARGES_GST_PERCENTAGE,0))/  
	 (100 + ISNULL(INM.OTHER_CHARGES_GST_PERCENTAGE,0))) ELSE 0 END)),2),
				 
	  PACKING_TAXABLE_VALUE =ROUND(PACKING-(PACKING*(CASE WHEN OH_TAX_METHOD =2 THEN ((ISNULL(INM.PACKING_GST_PERCENTAGE,0))/  
	  (100 + ISNULL(INM.PACKING_GST_PERCENTAGE,0))) ELSE 0 END)),2),
				 
	  INSURANCE_TAXABLE_VALUE =ROUND(INSURANCE-(INSURANCE*(CASE WHEN OH_TAX_METHOD =2 THEN ((ISNULL(INM.INSURANCE_GST_PERCENTAGE,0))/  
	 (100 + ISNULL(INM.INSURANCE_GST_PERCENTAGE,0))) ELSE 0 END)),2)
	 FROM INM01106  INM
	 WHERE INV_DT >'2017-06-30'
	 
	 
	 UPDATE RMM SET FREIGHT_TAXABLE_VALUE =ROUND(FREIGHT-(FREIGHT*(CASE WHEN OH_TAX_METHOD =2 THEN ((ISNULL(RMM.FREIGHT_GST_PERCENTAGE,0))/  
	 (100 + ISNULL(RMM.FREIGHT_GST_PERCENTAGE,0))) ELSE 0 END)),2),
				 
	  OTHER_CHARGES_TAXABLE_VALUE =ROUND(OTHER_CHARGES-(OTHER_CHARGES*(CASE WHEN OH_TAX_METHOD =2 THEN ((ISNULL(RMM.OTHER_CHARGES_GST_PERCENTAGE,0))/  
	 (100 + ISNULL(RMM.OTHER_CHARGES_GST_PERCENTAGE,0))) ELSE 0 END)),2) 
	 FROM RMM01106   RMM
	 WHERE RM_DT >'2017-06-30'
	 
	  UPDATE CNM SET FREIGHT_TAXABLE_VALUE =ROUND(FREIGHT-(FREIGHT*(CASE WHEN OH_TAX_METHOD =2 THEN ((ISNULL(CNM.FREIGHT_GST_PERCENTAGE,0))/  
	 (100 + ISNULL(CNM.FREIGHT_GST_PERCENTAGE,0))) ELSE 0 END)),2),
				 
	  OTHER_CHARGES_TAXABLE_VALUE =ROUND(OTHER_CHARGES-(OTHER_CHARGES*(CASE WHEN OH_TAX_METHOD =2 THEN ((ISNULL(CNM.OTHER_CHARGES_GST_PERCENTAGE,0))/  
	 (100 + ISNULL(CNM.OTHER_CHARGES_GST_PERCENTAGE,0))) ELSE 0 END)),2),
				 		 
	  INSURANCE_TAXABLE_VALUE =ROUND(INSURANCE-(INSURANCE*(CASE WHEN OH_TAX_METHOD =2 THEN ((ISNULL(CNM.INSURANCE_GST_PERCENTAGE,0))/  
	 (100 + ISNULL(CNM.INSURANCE_GST_PERCENTAGE,0))) ELSE 0 END)),2)
	 FROM CNM01106  CNM
	 WHERE CN_DT >'2017-06-30'
	 
	 
	 UPDATE PIM SET FREIGHT_TAXABLE_VALUE =ROUND(FREIGHT-(FREIGHT*(CASE WHEN OH_TAX_METHOD =2 THEN ((ISNULL(PIM.FREIGHT_GST_PERCENTAGE,0))/  
	 (100 + ISNULL(PIM.FREIGHT_GST_PERCENTAGE,0))) ELSE 0 END)),2),
				 
	  OTHER_CHARGES_TAXABLE_VALUE =ROUND(OTHER_CHARGES-(OTHER_CHARGES*(CASE WHEN OH_TAX_METHOD =2 THEN ((ISNULL(PIM.OTHER_CHARGES_GST_PERCENTAGE,0))/  
	 (100 + ISNULL(PIM.OTHER_CHARGES_GST_PERCENTAGE,0))) ELSE 0 END)),2)
				 
	 FROM PIM01106   PIM
	 WHERE MRR_DT >'2017-06-30'
	 
	 
	 UPDATE ARC SET TAXABLE_VALUE =ROUND((AMOUNT-DISCOUNT_AMOUNT )-((AMOUNT-DISCOUNT_AMOUNT )*(CASE WHEN OH_TAX_METHOD =2 THEN ((ISNULL(ARC.GST_PERCENTAGE,0))/  
	 (100 + ISNULL(ARC.GST_PERCENTAGE,0))) ELSE 0 END)),2)	 
	 FROM ARC01106    ARC
	 WHERE ADV_REC_DT >'2017-06-30'
	 
	  INSERT CONFIG	( CONFIG_OPTION, VALUE, ROW_ID, LAST_UPDATE,  REMARKS )  
	  SELECT 	  CONFIG_OPTION='UPDATE_TAXABLE_VALUE_1', VALUE=1, 
	  ROW_ID=NEWID(), LAST_UPDATE=GETDATE(), REMARKS=''

END
