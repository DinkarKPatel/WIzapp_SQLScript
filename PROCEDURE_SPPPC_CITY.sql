CREATE PROCEDURE SPPPC_CITY  
(  
 @NQUERYID   NUMERIC(2,0),    
 @VPARAMETER  VARCHAR(500)  
)  
AS      
BEGIN   
  
 DECLARE @CSTEP INT, @CCMD NVARCHAR(MAX), @ERRMSG_OUT VARCHAR(MAX)  
 BEGIN TRY  
  SET NOCOUNT ON;  
    
  SET @ERRMSG_OUT = ''  
    
  IF @NQUERYID = 1  
   -- GET CITY LIST  
   GOTO LBLGETCITYLIST  
  IF @NQUERYID = 2      
   -- GET CITY USING LIKE  
   GOTO LBLGETCITYLIKE  
  IF @NQUERYID = 3  
   -- GET CITY INFO  
   GOTO LBLGETCITYINFO   
  ELSE  
   GOTO LAST  
      
LBLGETCITYLIST:  
  SET @CSTEP = 101  
  SELECT A.CITY_CODE, DBO.UDF_PROPERCASE(A.CITY) AS [CITY]  
  FROM CITY A (NOLOCK)   
  WHERE INACTIVE = 0 AND A.CITY_CODE <> '0000000' AND ISNULL(A.CITY,'')<>''  
  ORDER BY A.CITY  
    
  GOTO LAST  
    
LBLGETCITYLIKE:  
  SET @CSTEP = 102  
    SELECT  TOP 10 A.CITY_CODE, DBO.UDF_PROPERCASE(A.CITY) AS [CITY]  
  FROM CITY A (NOLOCK)   
  WHERE INACTIVE = 0 AND A.CITY_CODE <> '0000000' AND ISNULL(A.CITY,'')<>''  
  AND A.CITY LIKE '%'+ @VPARAMETER +'%'  
  ORDER BY A.CITY  
    
  GOTO LAST  
    
LBLGETCITYINFO:  
  SET @CSTEP = 103  
    
  SELECT CITY_CODE, CITY, STATE_CODE, [STATE] FROM (    
  SELECT A.CITY_CODE, DBO.UDF_PROPERCASE(A.CITY) AS [CITY],   
   A.STATE_CODE, DBO.UDF_PROPERCASE(B.STATE) AS [STATE]  
  FROM CITY A (NOLOCK)   
  JOIN [STATE] B (NOLOCK) ON B.STATE_CODE=A.STATE_CODE   
  WHERE CITY<> '') AS VCITY  
  WHERE CITY = @VPARAMETER  
    
  GOTO LAST  
  
LAST:     
 GOTO END_PROC  
  
  SET NOCOUNT OFF;  
 END TRY    
 BEGIN CATCH    
  SET @ERRMSG_OUT='ERROR: [P]: SPPPC_CITY, [STEP]: '+CAST(@CSTEP AS VARCHAR(5))+', [MESSAGE]: ' + ERROR_MESSAGE()  
  GOTO END_PROC    
 END CATCH     
  
END_PROC:    
 IF  ISNULL(@ERRMSG_OUT,'')<>''   
  SELECT @ERRMSG_OUT AS ERRORMSG  
END
