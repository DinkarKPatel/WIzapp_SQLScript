CREATE PROCEDURE SP3S_GETMONTHWISE_LEDGER_CBS
@CFINYEAR VARCHAR(10)
AS
BEGIN
	/*
	--DECLARE @CFINYEAR VARCHAR(10)='01121'
	DECLARE @DFROMDT DATETIME,@DTODT DATETIME
	
	SELECT @DFROMDT=DBO.FN_GETFINYEARDATE (@CFINYEAR,1)
	SELECT @DTODT=DBO.FN_GETFINYEARDATE(@CFINYEAR,2)
	--SELECT @DFROMDT,@DTODT
	DECLARE @TMONTHLIST TABLE ( MONTH_NAME VARCHAR(20),YEAR_NO INT,MONTH_NO INT,FROM_DT DATETIME,XN_DT DATETIME)
	--EXEC ACT_MONTHLIST @DFROMDT,@DTODT
	/*
	INSERT @TMONTHLIST
	EXEC ACT_MONTHLIST @DFROMDT,@DTODT

	
	
	SELECT C.CBS,CBS_APPROVAL,CBS_JWI,CBS_CHGIT,CBS_PURGIT,CBS_WIP, 
	MONTH_NAME,B.DEPT_ID,A.XN_DT,CBS_PACKSLIPS,
	ABS(ISNULL(C.CBP,0)) AS CLOSING_BALANCE,  ISNULL(C.CBP,0) AS CBP,ISNULL(C.MANUAL_ENTRY,0) AS MANUAL_ENTRY,
	(CASE WHEN ISNULL(C.CBP,0)>=0 THEN 'DR' ELSE 'CR' END) AS CLOSING_BALANCE_CR_DR,
	ISNULL(C.CBS_PHYSICAL,0) AS CBS_PHYSICAL,B.DEPT_ID+CONVERT(VARCHAR(36),NEWID()) AS ROW_ID 
	FROM @TMONTHLIST A  
	JOIN LOCATION B ON 1=1  
	LEFT OUTER JOIN YEAR_WISE_CBS C ON C.DEPT_ID=B.DEPT_ID AND C.XN_DT=A.XN_DT  
	WHERE B.LOC_TYPE=1 OR Account_posting_at_ho=1  
	ORDER BY B.DEPT_ID  
	*/
	*/
	--SELECT B.DEPT_ID,@CFINYEAR AS FIN_YEAR,ISNULL(closing_stock_value_pp,0) AS closing_stock_value_pp,D.mode, B.DEPT_ID+CONVERT(VARCHAR(36),NEWID()) AS ROW_ID ,B.dept_name
	--FROM LOCATION B 
	--LEFT OUTER JOIN year_wise_act_cbsstk_det C ON C.DEPT_ID=B.DEPT_ID AND C.fin_year=@CFINYEAR
	--LEFT OUTER JOIN year_wise_act_cbsstk_mst D ON D.fin_year=C.fin_year
	--JOIN loc_accounting_company lc (NOLOCK) ON lc.pan_no=b.PAN_NO
	--ORDER BY B.DEPT_ID 
	SELECT B.DEPT_ID,@CFINYEAR AS FIN_YEAR,ISNULL(closing_stock_value_pp,0) AS closing_stock_value_pp,
	ISNULL(C.mode,0) AS MODE, B.DEPT_ID+CONVERT(VARCHAR(36),NEWID()) AS ROW_ID ,
	B.dept_name,B.inactive
	FROM LOCATION B 
	LEFT OUTER JOIN year_wise_act_cbsstk_mst c ON c.fin_year=@CFINYEAR
	LEFT OUTER JOIN year_wise_act_cbsstk_det d ON D.fin_year=C.fin_year AND B.dept_id=d.dept_id
	JOIN loc_accounting_company lc (NOLOCK) ON lc.pan_no=b.PAN_NO
	ORDER BY B.DEPT_ID 
END
